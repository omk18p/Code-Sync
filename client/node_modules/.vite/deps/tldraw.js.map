{
  "version": 3,
  "sources": ["../../lodash.isequal/index.js", "../../lodash.throttle/index.js", "../../lodash.uniq/index.js", "../../eventemitter3/index.js", "../../core-js/internals/global.js", "../../core-js/internals/fails.js", "../../core-js/internals/descriptors.js", "../../core-js/internals/function-bind-native.js", "../../core-js/internals/function-call.js", "../../core-js/internals/object-property-is-enumerable.js", "../../core-js/internals/create-property-descriptor.js", "../../core-js/internals/function-uncurry-this.js", "../../core-js/internals/classof-raw.js", "../../core-js/internals/indexed-object.js", "../../core-js/internals/is-null-or-undefined.js", "../../core-js/internals/require-object-coercible.js", "../../core-js/internals/to-indexed-object.js", "../../core-js/internals/is-callable.js", "../../core-js/internals/is-object.js", "../../core-js/internals/get-built-in.js", "../../core-js/internals/object-is-prototype-of.js", "../../core-js/internals/engine-user-agent.js", "../../core-js/internals/engine-v8-version.js", "../../core-js/internals/symbol-constructor-detection.js", "../../core-js/internals/use-symbol-as-uid.js", "../../core-js/internals/is-symbol.js", "../../core-js/internals/try-to-string.js", "../../core-js/internals/a-callable.js", "../../core-js/internals/get-method.js", "../../core-js/internals/ordinary-to-primitive.js", "../../core-js/internals/is-pure.js", "../../core-js/internals/define-global-property.js", "../../core-js/internals/shared-store.js", "../../core-js/internals/shared.js", "../../core-js/internals/to-object.js", "../../core-js/internals/has-own-property.js", "../../core-js/internals/uid.js", "../../core-js/internals/well-known-symbol.js", "../../core-js/internals/to-primitive.js", "../../core-js/internals/to-property-key.js", "../../core-js/internals/document-create-element.js", "../../core-js/internals/ie8-dom-define.js", "../../core-js/internals/object-get-own-property-descriptor.js", "../../core-js/internals/v8-prototype-define-bug.js", "../../core-js/internals/an-object.js", "../../core-js/internals/object-define-property.js", "../../core-js/internals/create-non-enumerable-property.js", "../../core-js/internals/function-name.js", "../../core-js/internals/inspect-source.js", "../../core-js/internals/weak-map-basic-detection.js", "../../core-js/internals/shared-key.js", "../../core-js/internals/hidden-keys.js", "../../core-js/internals/internal-state.js", "../../core-js/internals/make-built-in.js", "../../core-js/internals/define-built-in.js", "../../core-js/internals/math-trunc.js", "../../core-js/internals/to-integer-or-infinity.js", "../../core-js/internals/to-absolute-index.js", "../../core-js/internals/to-length.js", "../../core-js/internals/length-of-array-like.js", "../../core-js/internals/array-includes.js", "../../core-js/internals/object-keys-internal.js", "../../core-js/internals/enum-bug-keys.js", "../../core-js/internals/object-get-own-property-names.js", "../../core-js/internals/object-get-own-property-symbols.js", "../../core-js/internals/own-keys.js", "../../core-js/internals/copy-constructor-properties.js", "../../core-js/internals/is-forced.js", "../../core-js/internals/export.js", "../../core-js/internals/object-keys.js", "../../core-js/internals/object-define-properties.js", "../../core-js/internals/html.js", "../../core-js/internals/object-create.js", "../../core-js/internals/add-to-unscopables.js", "../../core-js/modules/es.array.at.js", "../../core-js/internals/entry-unbind.js", "../../core-js/es/array/at.js", "../../core-js/stable/array/at.js", "../../core-js/internals/is-array.js", "../../core-js/internals/does-not-exceed-safe-integer.js", "../../core-js/internals/function-uncurry-this-clause.js", "../../core-js/internals/function-bind-context.js", "../../core-js/internals/flatten-into-array.js", "../../core-js/internals/to-string-tag-support.js", "../../core-js/internals/classof.js", "../../core-js/internals/is-constructor.js", "../../core-js/internals/array-species-constructor.js", "../../core-js/internals/array-species-create.js", "../../core-js/modules/es.array.flat-map.js", "../../core-js/modules/es.array.unscopables.flat-map.js", "../../core-js/es/array/flat-map.js", "../../core-js/stable/array/flat-map.js", "../../core-js/modules/es.array.flat.js", "../../core-js/modules/es.array.unscopables.flat.js", "../../core-js/es/array/flat.js", "../../core-js/stable/array/flat.js", "../../core-js/internals/to-string.js", "../../core-js/modules/es.string.at-alternative.js", "../../core-js/es/string/at.js", "../../core-js/stable/string/at.js", "../../core-js/internals/regexp-flags.js", "../../core-js/internals/regexp-sticky-helpers.js", "../../core-js/internals/regexp-unsupported-dot-all.js", "../../core-js/internals/regexp-unsupported-ncg.js", "../../core-js/internals/regexp-exec.js", "../../core-js/modules/es.regexp.exec.js", "../../core-js/internals/function-apply.js", "../../core-js/internals/fix-regexp-well-known-symbol-logic.js", "../../core-js/internals/string-multibyte.js", "../../core-js/internals/advance-string-index.js", "../../core-js/internals/get-substitution.js", "../../core-js/internals/regexp-exec-abstract.js", "../../core-js/modules/es.string.replace.js", "../../core-js/internals/is-regexp.js", "../../core-js/internals/regexp-get-flags.js", "../../core-js/modules/es.string.replace-all.js", "../../core-js/es/string/replace-all.js", "../../core-js/stable/string/replace-all.js", "../../lz-string/libs/lz-string.js", "../../tldraw/src/lib/utils/assets/preload-font.ts", "../../@tldraw/state/src/lib/core/helpers.ts", "../../@tldraw/state/src/lib/core/ArraySet.ts", "../../@tldraw/state/src/lib/core/types.ts", "../../@tldraw/state/src/lib/core/HistoryBuffer.ts", "../../@tldraw/state/src/lib/core/capture.ts", "../../@tldraw/state/src/lib/core/constants.ts", "../../@tldraw/state/src/lib/core/EffectScheduler.ts", "../../@tldraw/state/src/lib/core/transactions.ts", "../../@tldraw/state/src/lib/core/Atom.ts", "../../@tldraw/state/src/lib/core/warnings.ts", "../../@tldraw/state/src/lib/core/Computed.ts", "../../@tldraw/state/src/lib/core/index.ts", "../../@tldraw/state/src/lib/react/track.ts", "../../@tldraw/state/src/lib/react/useStateTracking.ts", "../../@tldraw/state/src/lib/react/useAtom.ts", "../../@tldraw/state/src/lib/react/useComputed.ts", "../../@tldraw/state/src/lib/react/useQuickReactor.ts", "../../@tldraw/state/src/lib/react/useReactor.ts", "../../@tldraw/state/src/lib/react/useValue.ts", "../../@tldraw/store/src/lib/IncrementalSetConstructor.ts", "../../@tldraw/utils/src/lib/array.ts", "../../@tldraw/utils/src/lib/function.ts", "../../@tldraw/utils/src/lib/control.ts", "../../@tldraw/utils/src/lib/debounce.ts", "../../@tldraw/utils/src/lib/error.ts", "../../@tldraw/utils/src/lib/file.ts", "../../@tldraw/utils/src/lib/hash.ts", "../../@tldraw/utils/src/lib/iterable.ts", "../../@tldraw/utils/src/lib/png.ts", "../../@tldraw/utils/src/lib/media.ts", "../../@tldraw/utils/src/lib/number.ts", "../../@tldraw/utils/src/lib/object.ts", "../../@tldraw/utils/src/lib/perf.ts", "../../@tldraw/utils/src/lib/reordering/dgreensp/dgreensp.ts", "../../@tldraw/utils/src/lib/reordering/reordering.ts", "../../@tldraw/utils/src/lib/sort.ts", "../../@tldraw/utils/src/lib/storage.tsx", "../../@tldraw/utils/src/lib/throttle.ts", "../../@tldraw/utils/src/lib/value.ts", "../../@tldraw/utils/src/lib/warnDeprecatedGetter.ts", "../../@tldraw/store/node_modules/nanoid/index.browser.js", "../../@tldraw/store/src/lib/RecordType.ts", "../../@tldraw/store/src/lib/Cache.ts", "../../@tldraw/store/src/lib/StoreQueries.ts", "../../@tldraw/store/src/lib/setUtils.ts", "../../@tldraw/store/src/lib/executeQuery.ts", "../../@tldraw/store/src/lib/devFreeze.ts", "../../@tldraw/store/src/lib/Store.ts", "../../@tldraw/store/src/lib/migrate.ts", "../../@tldraw/store/src/lib/StoreSchema.ts", "../../@tldraw/validate/src/lib/validation.ts", "../../@tldraw/tlschema/src/misc/id-validator.ts", "../../@tldraw/tlschema/src/assets/TLBaseAsset.ts", "../../@tldraw/tlschema/src/records/TLCamera.ts", "../../@tldraw/tlschema/src/misc/geometry-types.ts", "../../@tldraw/tlschema/src/misc/TLCursor.ts", "../../@tldraw/tlschema/src/misc/TLOpacity.ts", "../../@tldraw/tlschema/src/misc/TLColor.ts", "../../@tldraw/tlschema/src/misc/TLScribble.ts", "../../@tldraw/tlschema/src/records/TLPage.ts", "../../@tldraw/tlschema/src/records/TLInstance.ts", "../../@tldraw/tlschema/src/shapes/TLBaseShape.ts", "../../@tldraw/tlschema/src/records/TLPageState.ts", "../../@tldraw/tlschema/src/records/TLPointer.ts", "../../@tldraw/tlschema/src/records/TLPresence.ts", "../../@tldraw/tlschema/src/createPresenceStateDerivation.ts", "../../@tldraw/tlschema/src/records/TLDocument.ts", "../../@tldraw/tlschema/src/TLStore.ts", "../../@tldraw/tlschema/src/assets/TLBookmarkAsset.ts", "../../@tldraw/tlschema/src/assets/TLImageAsset.ts", "../../@tldraw/tlschema/src/assets/TLVideoAsset.ts", "../../@tldraw/tlschema/src/records/TLAsset.ts", "../../@tldraw/tlschema/node_modules/nanoid/index.browser.js", "../../@tldraw/tlschema/src/styles/StyleProp.ts", "../../@tldraw/tlschema/src/records/TLShape.ts", "../../@tldraw/tlschema/src/styles/TLColorStyle.ts", "../../@tldraw/tlschema/src/styles/TLDashStyle.ts", "../../@tldraw/tlschema/src/styles/TLFillStyle.ts", "../../@tldraw/tlschema/src/styles/TLFontStyle.ts", "../../@tldraw/tlschema/src/styles/TLSizeStyle.ts", "../../@tldraw/tlschema/src/shapes/TLArrowShape.ts", "../../@tldraw/tlschema/src/shapes/TLBookmarkShape.ts", "../../@tldraw/tlschema/src/shapes/TLDrawShape.ts", "../../@tldraw/tlschema/src/shapes/TLEmbedShape.ts", "../../@tldraw/tlschema/src/shapes/TLFrameShape.ts", "../../@tldraw/tlschema/src/styles/TLHorizontalAlignStyle.ts", "../../@tldraw/tlschema/src/styles/TLVerticalAlignStyle.ts", "../../@tldraw/tlschema/src/shapes/TLGeoShape.ts", "../../@tldraw/tlschema/src/shapes/TLGroupShape.ts", "../../@tldraw/tlschema/src/shapes/TLHighlightShape.ts", "../../@tldraw/tlschema/src/shapes/TLImageShape.ts", "../../@tldraw/tlschema/src/shapes/TLLineShape.ts", "../../@tldraw/tlschema/src/shapes/TLNoteShape.ts", "../../@tldraw/tlschema/src/shapes/TLTextShape.ts", "../../@tldraw/tlschema/src/shapes/TLVideoShape.ts", "../../@tldraw/tlschema/src/store-migrations.ts", "../../@tldraw/tlschema/src/createTLSchema.ts", "../../@tldraw/tlschema/src/translations/languages.ts", "../../@tldraw/tlschema/src/translations/translations.ts", "../../@tldraw/editor/src/lib/TldrawEditor.tsx", "../../@tldraw/editor/src/lib/components/ErrorBoundary.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultErrorFallback.tsx", "../../@tldraw/editor/src/lib/hooks/useEditor.ts", "../../@tldraw/editor/src/lib/hooks/useEditorComponents.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultBackground.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultBrush.tsx", "../../@tldraw/editor/src/lib/hooks/useTransform.ts", "../../@tldraw/editor/src/lib/primitives/easings.ts", "../../@tldraw/editor/src/lib/primitives/Vec.ts", "../../@tldraw/editor/src/lib/primitives/utils.ts", "../../@tldraw/editor/src/lib/components/default-components/DefaultCanvas.tsx", "../../@tldraw/editor/src/lib/constants.ts", "../../@tldraw/editor/src/lib/hooks/useCanvasEvents.ts", "../../@tldraw/editor/src/lib/utils/debug-flags.ts", "../../@tldraw/editor/src/lib/utils/dom.ts", "../../@tldraw/editor/src/lib/utils/getPointerInfo.ts", "../../@tldraw/editor/src/lib/hooks/useCoarsePointer.ts", "../../@tldraw/editor/src/lib/hooks/useContainer.tsx", "../../@tldraw/editor/src/lib/hooks/useDocumentEvents.ts", "../../@tldraw/editor/src/lib/hooks/useFixSafariDoubleTapZoomPencilEvents.ts", "../../@use-gesture/core/dist/maths-0ab39ae9.esm.js", "../../@use-gesture/core/dist/actions-fe213e88.esm.js", "../../@use-gesture/react/dist/use-gesture-react.esm.js", "../../@use-gesture/core/dist/use-gesture-core.esm.js", "../../@tldraw/editor/src/lib/hooks/useGestureEvents.ts", "../../@tldraw/editor/src/lib/utils/normalizeWheel.ts", "../../@tldraw/editor/src/lib/hooks/useHandleEvents.ts", "../../@tldraw/editor/src/lib/hooks/useScreenBounds.ts", "../../@tldraw/editor/src/lib/primitives/Box.ts", "../../@tldraw/editor/src/lib/primitives/Mat.ts", "../../@tldraw/editor/src/lib/utils/nearestMultiple.ts", "../../@tldraw/editor/src/lib/components/GeometryDebuggingView.tsx", "../../@tldraw/editor/src/lib/primitives/geometry/Geometry2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Group2d.ts", "../../@tldraw/editor/src/lib/components/LiveCollaborators.tsx", "../../@tldraw/editor/src/lib/utils/uniq.ts", "../../@tldraw/editor/src/lib/hooks/usePeerIds.ts", "../../@tldraw/editor/src/lib/hooks/usePresence.ts", "../../@tldraw/editor/src/lib/components/Shape.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultCollaboratorHint.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultCursor.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultGrid.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultHandle.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultHandles.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultScribble.tsx", "../../@tldraw/editor/src/lib/utils/getSvgPathFromPoints.ts", "../../@tldraw/editor/src/lib/components/default-components/DefaultSelectionBackground.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultSelectionForeground.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultShapeErrorFallback.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultShapeIndicator.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultShapeIndicatorErrorFallback.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultSnapIndictor.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultSpinner.tsx", "../../@tldraw/editor/src/lib/components/default-components/DefaultSvgDefs.tsx", "../../@tldraw/editor/src/lib/hooks/useIdentity.tsx", "../../@tldraw/editor/src/lib/utils/runtime.ts", "../../@tldraw/editor/src/lib/utils/hardResetEditor.ts", "../../@tldraw/editor/src/lib/utils/refreshPage.ts", "../../@tldraw/editor/node_modules/nanoid/index.browser.js", "../../@tldraw/editor/src/lib/utils/uniqueId.ts", "../../@tldraw/editor/src/lib/config/TLUserPreferences.ts", "../../@tldraw/editor/src/lib/config/createTLUser.ts", "../../@tldraw/editor/src/lib/editor/Editor.ts", "../../@tldraw/editor/src/lib/editor/shapes/group/GroupShapeUtil.tsx", "../../@tldraw/editor/src/lib/components/SVGContainer.tsx", "../../@tldraw/editor/src/lib/primitives/intersect.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Edge2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Polyline2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Polygon2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Rectangle2d.ts", "../../@tldraw/editor/src/lib/editor/shapes/ShapeUtil.ts", "../../@tldraw/editor/src/lib/editor/shapes/group/DashedOutlineBox.tsx", "../../@tldraw/editor/src/lib/editor/shapes/shared/getPerfectDashProps.ts", "../../@tldraw/editor/src/lib/config/defaultShapes.ts", "../../@tldraw/editor/src/lib/utils/SharedStylesMap.ts", "../../@tldraw/editor/src/lib/utils/WeakMapCache.ts", "../../@tldraw/editor/src/lib/utils/assets.ts", "../../@tldraw/editor/src/lib/utils/getIncrementedName.ts", "../../@tldraw/editor/src/lib/utils/reorderShapes.ts", "../../@tldraw/editor/src/lib/utils/rotation.ts", "../../@tldraw/editor/src/lib/editor/derivations/arrowBindingsIndex.ts", "../../@tldraw/editor/src/lib/editor/derivations/notVisibleShapes.ts", "../../@tldraw/editor/src/lib/editor/derivations/parentsToChildren.ts", "../../@tldraw/editor/src/lib/editor/derivations/shapeIdsInCurrentPage.ts", "../../@tldraw/editor/src/lib/editor/getSvgJsx.tsx", "../../@tldraw/editor/src/lib/editor/types/SvgExportContext.tsx", "../../@tldraw/editor/src/lib/editor/managers/ClickManager.ts", "../../@tldraw/editor/src/lib/editor/managers/EnvironmentManager.ts", "../../@tldraw/editor/src/lib/editor/managers/Stack.ts", "../../@tldraw/editor/src/lib/editor/managers/HistoryManager.ts", "../../@tldraw/editor/src/lib/editor/managers/ScribbleManager.ts", "../../@tldraw/editor/src/lib/editor/managers/SideEffectManager.ts", "../../@tldraw/editor/src/lib/editor/managers/SnapManager/BoundsSnaps.ts", "../../@tldraw/editor/src/lib/editor/managers/SnapManager/HandleSnaps.ts", "../../@tldraw/editor/src/lib/editor/managers/SnapManager/SnapManager.ts", "../../@tldraw/editor/src/lib/editor/managers/TextManager.ts", "../../@tldraw/editor/src/lib/editor/managers/TickManager.ts", "../../@tldraw/editor/src/lib/editor/managers/UserPreferencesManager.ts", "../../@tldraw/editor/src/lib/editor/shapes/shared/arrow/shared.ts", "../../@tldraw/editor/src/lib/editor/shapes/shared/arrow/straight-arrow.ts", "../../@tldraw/editor/src/lib/editor/shapes/shared/arrow/curved-arrow.ts", "../../@tldraw/editor/src/lib/editor/types/event-types.ts", "../../@tldraw/editor/src/lib/editor/tools/StateNode.ts", "../../@tldraw/editor/src/lib/editor/tools/RootState.ts", "../../@tldraw/editor/src/lib/hooks/useIsDarkMode.ts", "../../@tldraw/editor/src/lib/hooks/useCursor.ts", "../../@tldraw/editor/src/lib/hooks/useDarkMode.ts", "../../@tldraw/editor/src/lib/hooks/useEvent.tsx", "../../@tldraw/editor/src/lib/hooks/useFocusEvents.ts", "../../@tldraw/editor/src/lib/hooks/useForceUpdate.ts", "../../@tldraw/editor/src/lib/hooks/useLocalStore.ts", "../../@tldraw/editor/src/lib/config/TLSessionStateSnapshot.ts", "../../@tldraw/editor/src/lib/utils/sync/alerts.ts", "../../idb/build/wrap-idb-value.js", "../../idb/build/index.js", "../../@tldraw/editor/src/lib/utils/sync/indexedDb.ts", "../../@tldraw/editor/src/lib/utils/sync/TLLocalSyncClient.ts", "../../@tldraw/editor/src/lib/hooks/useTLStore.ts", "../../@tldraw/editor/src/lib/config/createTLStore.ts", "../../@tldraw/editor/src/lib/hooks/useSafariFocusOutFix.ts", "../../@tldraw/editor/src/lib/hooks/useZoomCss.ts", "../../@tldraw/editor/src/lib/components/HTMLContainer.tsx", "../../@tldraw/editor/src/lib/editor/shapes/shared/resizeBox.ts", "../../@tldraw/editor/src/lib/editor/shapes/BaseBoxShapeUtil.tsx", "../../@tldraw/editor/src/lib/editor/tools/BaseBoxShapeTool/children/Idle.ts", "../../@tldraw/editor/src/lib/editor/tools/BaseBoxShapeTool/children/Pointing.ts", "../../@tldraw/editor/src/lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool.ts", "../../@tldraw/editor/src/lib/hooks/useIsCropping.ts", "../../@tldraw/editor/src/lib/hooks/useIsEditing.ts", "../../@tldraw/editor/src/lib/hooks/useSafeId.ts", "../../@tldraw/editor/src/lib/hooks/useSelectionEvents.ts", "../../@tldraw/editor/src/lib/primitives/geometry/geometry-constants.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Arc2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Circle2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/CubicBezier2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/CubicSpline2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Ellipse2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Point2d.ts", "../../@tldraw/editor/src/lib/primitives/geometry/Stadium2d.ts", "../../@tldraw/editor/src/lib/utils/edgeScrolling.ts", "../../@tldraw/editor/src/lib/utils/sync/hardReset.ts", "../../@tldraw/editor/src/lib/utils/window-open.ts", "../../@tldraw/editor/src/index.ts", "../../tldraw/src/lib/ui/hooks/menu-hooks.ts", "../../tldraw/src/lib/Tldraw.tsx", "../../tldraw/src/lib/canvas/TldrawHandles.tsx", "../../tldraw/src/lib/canvas/TldrawScribble.tsx", "../../tldraw/src/lib/shapes/shared/freehand/getStrokeOutlinePoints.ts", "../../tldraw/src/lib/shapes/shared/freehand/getStrokePoints.ts", "../../tldraw/src/lib/shapes/shared/freehand/setStrokePointRadii.ts", "../../tldraw/src/lib/shapes/shared/freehand/getStroke.ts", "../../tldraw/src/lib/canvas/TldrawSelectionBackground.tsx", "../../tldraw/src/lib/canvas/TldrawSelectionForeground.tsx", "../../tldraw/src/lib/ui/hooks/useReadonly.ts", "../../tldraw/src/lib/canvas/TldrawCropHandles.tsx", "../../tldraw/src/lib/shapes/shared/default-shape-constants.ts", "../../canvas-size/src/canvas-test.js", "../../canvas-size/src/test-sizes.js", "../../canvas-size/src/index.js", "../../tldraw/src/lib/shapes/shared/getBrowserCanvasMaxSize.tsx", "../../tldraw/src/lib/utils/assets/is-gif-animated.ts", "../../tldraw/src/lib/utils/assets/assets.ts", "../../tldraw/src/lib/utils/embeds/embeds.ts", "../../tldraw/src/lib/shapes/shared/TextHelpers.ts", "../../tldraw/src/lib/utils/text/text.ts", "../../tldraw/src/lib/defaultExternalContentHandlers.ts", "../../tldraw/src/lib/shapes/arrow/toolStates/Idle.ts", "../../tldraw/src/lib/shapes/arrow/toolStates/Pointing.ts", "../../tldraw/src/lib/shapes/arrow/ArrowShapeTool.ts", "../../tldraw/src/lib/shapes/draw/toolStates/Drawing.ts", "../../tldraw/src/lib/shapes/draw/toolStates/Idle.ts", "../../tldraw/src/lib/shapes/draw/DrawShapeTool.ts", "../../tldraw/src/lib/shapes/frame/FrameShapeTool.ts", "../../tldraw/src/lib/shapes/geo/toolStates/Idle.ts", "../../tldraw/src/lib/shapes/geo/toolStates/Pointing.ts", "../../tldraw/src/lib/shapes/geo/GeoShapeTool.ts", "../../tldraw/src/lib/shapes/highlight/HighlightShapeTool.ts", "../../tldraw/src/lib/shapes/line/toolStates/Idle.ts", "../../tldraw/src/lib/shapes/line/toolStates/Pointing.ts", "../../tldraw/src/lib/shapes/line/LineShapeTool.ts", "../../tldraw/src/lib/shapes/note/toolStates/Idle.ts", "../../tldraw/src/lib/tools/SelectTool/selectHelpers.ts", "../../tldraw/src/lib/shapes/note/noteHelpers.ts", "../../tldraw/src/lib/shapes/note/toolStates/Pointing.ts", "../../tldraw/src/lib/shapes/note/NoteShapeTool.ts", "../../tldraw/src/lib/tools/selection-logic/updateHoveredId.ts", "../../tldraw/src/lib/shapes/text/toolStates/Idle.ts", "../../tldraw/src/lib/shapes/text/toolStates/Pointing.ts", "../../tldraw/src/lib/shapes/text/TextShapeTool.ts", "../../tldraw/src/lib/defaultShapeTools.ts", "../../tldraw/src/lib/shapes/arrow/ArrowShapeUtil.tsx", "../../tldraw/src/lib/shapes/shared/ShapeFill.tsx", "../../tldraw/src/lib/shapes/shared/SvgTextLabel.tsx", "../../tldraw/src/lib/shapes/shared/createTextJsxFromSpans.tsx", "../../tldraw/src/lib/shapes/shared/legacyProps.ts", "../../tldraw/src/lib/shapes/shared/defaultStyleDefs.tsx", "../../tldraw/src/lib/shapes/shared/getPerfectDashProps.ts", "../../tldraw/src/lib/shapes/arrow/arrowLabel.ts", "../../tldraw/src/lib/shapes/arrow/arrowheads.ts", "../../tldraw/src/lib/shapes/arrow/arrowpaths.ts", "../../tldraw/src/lib/shapes/arrow/components/ArrowTextLabel.tsx", "../../tldraw/src/lib/shapes/shared/TextLabel.tsx", "../../tldraw/src/lib/shapes/text/TextArea.tsx", "../../tldraw/src/lib/shapes/shared/useEditableText.ts", "../../tldraw/src/lib/shapes/bookmark/BookmarkShapeUtil.tsx", "../../tldraw/src/lib/shapes/shared/HyperlinkButton.tsx", "../../tldraw/src/lib/shapes/shared/rotated-box-shadow.ts", "../../tldraw/src/lib/shapes/draw/DrawShapeUtil.tsx", "../../tldraw/src/lib/shapes/shared/freehand/svg.ts", "../../tldraw/src/lib/shapes/shared/freehand/svgInk.ts", "../../tldraw/src/lib/shapes/shared/useForceSolid.ts", "../../tldraw/src/lib/shapes/draw/getPath.ts", "../../tldraw/src/lib/shapes/embed/EmbedShapeUtil.tsx", "../../tldraw/src/lib/shapes/shared/resizeBox.ts", "../../tldraw/src/lib/shapes/frame/FrameShapeUtil.tsx", "../../tldraw/src/lib/shapes/frame/components/FrameHeading.tsx", "../../tldraw/src/lib/shapes/frame/components/FrameLabelInput.tsx", "../../tldraw/src/lib/shapes/geo/GeoShapeUtil.tsx", "../../tldraw/src/lib/shapes/shared/polygon-helpers.ts", "../../tldraw/src/lib/shapes/geo/cloudOutline.ts", "../../tldraw/src/lib/shapes/geo/components/DrawStyleEllipse.tsx", "../../tldraw/src/lib/shapes/geo/components/GeoShapeBody.tsx", "../../tldraw/src/lib/shapes/geo/getLines.tsx", "../../tldraw/src/lib/shapes/geo/components/DashStyleCloud.tsx", "../../tldraw/src/lib/shapes/geo/components/DashStyleEllipse.tsx", "../../tldraw/src/lib/shapes/geo/components/DashStyleOval.tsx", "../../tldraw/src/lib/shapes/geo/helpers.ts", "../../tldraw/src/lib/shapes/geo/components/DashStylePolygon.tsx", "../../tldraw/src/lib/shapes/geo/components/DrawStyleCloud.tsx", "../../tldraw/src/lib/shapes/geo/components/DrawStylePolygon.tsx", "../../tldraw/src/lib/shapes/geo/components/SolidStyleCloud.tsx", "../../tldraw/src/lib/shapes/geo/components/SolidStyleEllipse.tsx", "../../tldraw/src/lib/shapes/geo/components/SolidStyleOval.tsx", "../../tldraw/src/lib/shapes/geo/components/SolidStylePolygon.tsx", "../../tldraw/src/lib/shapes/highlight/HighlightShapeUtil.tsx", "../../tldraw/src/lib/shapes/shared/useColorSpace.tsx", "../../tldraw/src/lib/shapes/image/ImageShapeUtil.tsx", "../../tldraw/src/lib/shapes/shared/BrokenAssetIcon.tsx", "../../tldraw/src/lib/shapes/shared/usePrefersReducedMotion.tsx", "../../tldraw/src/lib/shapes/line/LineShapeUtil.tsx", "../../tldraw/src/lib/shapes/line/components/svg.ts", "../../tldraw/src/lib/shapes/line/components/getLinePath.ts", "../../tldraw/src/lib/shapes/note/NoteShapeUtil.tsx", "../../tldraw/src/lib/ui/hooks/useTranslation/useTranslation.tsx", "../../tldraw/src/lib/ui/context/asset-urls.tsx", "../../tldraw/src/lib/ui/hooks/useTranslation/defaultTranslation.ts", "../../tldraw/src/lib/ui/hooks/useTranslation/translations.ts", "../../tldraw/src/lib/shapes/text/TextShapeUtil.tsx", "../../tldraw/src/lib/shapes/shared/resizeScaled.ts", "../../tldraw/src/lib/shapes/video/VideoShapeUtil.tsx", "../../tldraw/src/lib/defaultShapeUtils.ts", "../../tldraw/src/lib/defaultSideEffects.ts", "../../tldraw/src/lib/tools/EraserTool/childStates/Erasing.ts", "../../tldraw/src/lib/tools/EraserTool/childStates/Idle.ts", "../../tldraw/src/lib/tools/EraserTool/childStates/Pointing.ts", "../../tldraw/src/lib/tools/EraserTool/EraserTool.ts", "../../tldraw/src/lib/tools/HandTool/childStates/Dragging.ts", "../../tldraw/src/lib/tools/HandTool/childStates/Idle.ts", "../../tldraw/src/lib/tools/HandTool/childStates/Pointing.ts", "../../tldraw/src/lib/tools/HandTool/HandTool.ts", "../../tldraw/src/lib/tools/LaserTool/childStates/Idle.ts", "../../tldraw/src/lib/tools/LaserTool/childStates/Lasering.ts", "../../tldraw/src/lib/tools/LaserTool/LaserTool.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Brushing.ts", "../../tldraw/src/lib/tools/selection-logic/getHitShapeOnCanvasPointerDown.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Crop/children/crop_helpers.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Crop/children/Idle.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Crop/children/PointingCrop.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Crop/children/TranslatingCrop.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Crop/Crop.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Crop/crop-constants.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/PointingResizeHandle.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Cropping.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/DraggingHandle.tsx", "../../tldraw/src/lib/utils/shapes/shapes.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/EditingShape.ts", "../../tldraw/src/lib/tools/selection-logic/getShouldEnterCropModeOnPointerDown.ts", "../../tldraw/src/lib/tools/selection-logic/selectOnCanvasPointerUp.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Idle.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/PointingArrowLabel.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/PointingCanvas.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/PointingCropHandle.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/PointingHandle.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/PointingRotateHandle.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/PointingSelection.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/PointingShape.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Resizing.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Rotating.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/ScribbleBrushing.ts", "../../tldraw/src/lib/tools/SelectTool/DragAndDropManager.ts", "../../tldraw/src/lib/tools/SelectTool/childStates/Translating.ts", "../../tldraw/src/lib/tools/SelectTool/SelectTool.ts", "../../tldraw/src/lib/tools/ZoomTool/childStates/Idle.ts", "../../tldraw/src/lib/tools/ZoomTool/childStates/Pointing.ts", "../../tldraw/src/lib/tools/ZoomTool/childStates/ZoomBrushing.ts", "../../tldraw/src/lib/tools/ZoomTool/ZoomTool.ts", "../../tldraw/src/lib/defaultTools.ts", "../../tldraw/src/lib/ui/TldrawUi.tsx", "../../@radix-ui/primitive/dist/packages/core/primitive/src/index.ts", "../../@radix-ui/primitive/dist/packages/core/primitive/src/primitive.tsx", "../../@radix-ui/react-compose-refs/dist/packages/react/compose-refs/src/index.ts", "../../@radix-ui/react-compose-refs/dist/packages/react/compose-refs/src/composeRefs.tsx", "../../@radix-ui/react-context/dist/packages/react/context/src/index.ts", "../../@radix-ui/react-context/dist/packages/react/context/src/createContext.tsx", "../../@radix-ui/react-slot/dist/packages/react/slot/src/index.ts", "../../@radix-ui/react-slot/dist/packages/react/slot/src/Slot.tsx", "../../@radix-ui/react-collection/dist/packages/react/collection/src/index.ts", "../../@radix-ui/react-collection/dist/packages/react/collection/src/Collection.tsx", "../../@radix-ui/react-primitive/dist/packages/react/primitive/src/index.ts", "../../@radix-ui/react-primitive/dist/packages/react/primitive/src/Primitive.tsx", "../../@radix-ui/react-use-callback-ref/dist/packages/react/use-callback-ref/src/index.ts", "../../@radix-ui/react-use-callback-ref/dist/packages/react/use-callback-ref/src/useCallbackRef.tsx", "../../@radix-ui/react-use-escape-keydown/dist/packages/react/use-escape-keydown/src/index.ts", "../../@radix-ui/react-use-escape-keydown/dist/packages/react/use-escape-keydown/src/useEscapeKeydown.tsx", "../../@radix-ui/react-dismissable-layer/dist/packages/react/dismissable-layer/src/index.ts", "../../@radix-ui/react-dismissable-layer/dist/packages/react/dismissable-layer/src/DismissableLayer.tsx", "../../@radix-ui/react-portal/dist/packages/react/portal/src/index.ts", "../../@radix-ui/react-portal/dist/packages/react/portal/src/Portal.tsx", "../../@radix-ui/react-use-layout-effect/dist/packages/react/use-layout-effect/src/index.ts", "../../@radix-ui/react-use-layout-effect/dist/packages/react/use-layout-effect/src/useLayoutEffect.tsx", "../../@radix-ui/react-presence/dist/packages/react/presence/src/index.ts", "../../@radix-ui/react-presence/dist/packages/react/presence/src/Presence.tsx", "../../@radix-ui/react-presence/dist/packages/react/presence/src/useStateMachine.tsx", "../../@radix-ui/react-use-controllable-state/dist/packages/react/use-controllable-state/src/index.ts", "../../@radix-ui/react-use-controllable-state/dist/packages/react/use-controllable-state/src/useControllableState.tsx", "../../@radix-ui/react-visually-hidden/dist/packages/react/visually-hidden/src/index.ts", "../../@radix-ui/react-visually-hidden/dist/packages/react/visually-hidden/src/VisuallyHidden.tsx", "../../@radix-ui/react-toast/dist/packages/react/toast/src/index.ts", "../../@radix-ui/react-toast/dist/packages/react/toast/src/Toast.tsx", "../../tldraw/src/lib/ui/components/Dialogs.tsx", "../../@radix-ui/react-id/dist/packages/react/id/src/index.ts", "../../@radix-ui/react-id/dist/packages/react/id/src/id.tsx", "../../@radix-ui/react-focus-scope/dist/packages/react/focus-scope/src/index.ts", "../../@radix-ui/react-focus-scope/dist/packages/react/focus-scope/src/FocusScope.tsx", "../../@radix-ui/react-focus-guards/dist/packages/react/focus-guards/src/index.ts", "../../@radix-ui/react-focus-guards/dist/packages/react/focus-guards/src/FocusGuards.tsx", "../../tslib/tslib.es6.mjs", "../../react-remove-scroll/dist/es2015/Combination.js", "../../react-remove-scroll/dist/es2015/UI.js", "../../react-remove-scroll-bar/dist/es2015/constants.js", "../../use-callback-ref/dist/es2015/assignRef.js", "../../use-callback-ref/dist/es2015/useRef.js", "../../use-callback-ref/dist/es2015/useMergeRef.js", "../../use-sidecar/dist/es2015/hoc.js", "../../use-sidecar/dist/es2015/hook.js", "../../use-sidecar/dist/es2015/medium.js", "../../use-sidecar/dist/es2015/renderProp.js", "../../use-sidecar/dist/es2015/exports.js", "../../react-remove-scroll/dist/es2015/medium.js", "../../react-remove-scroll/dist/es2015/SideEffect.js", "../../react-remove-scroll-bar/dist/es2015/component.js", "../../react-style-singleton/dist/es2015/hook.js", "../../get-nonce/dist/es2015/index.js", "../../react-style-singleton/dist/es2015/singleton.js", "../../react-style-singleton/dist/es2015/component.js", "../../react-remove-scroll-bar/dist/es2015/utils.js", "../../react-remove-scroll/dist/es2015/aggresiveCapture.js", "../../react-remove-scroll/dist/es2015/handleScroll.js", "../../react-remove-scroll/dist/es2015/sidecar.js", "../../aria-hidden/dist/es2015/index.js", "../../@radix-ui/react-dialog/dist/packages/react/dialog/src/index.ts", "../../@radix-ui/react-dialog/dist/packages/react/dialog/src/Dialog.tsx", "../../tldraw/src/lib/ui/context/dialogs.tsx", "../../tldraw/src/lib/ui/context/events.tsx", "../../tldraw/src/lib/ui/components/FollowingIndicator.tsx", "../../tldraw/src/lib/ui/components/Toasts.tsx", "../../tldraw/src/lib/ui/context/toasts.tsx", "../../tldraw/src/lib/ui/components/primitives/Button/TldrawUiButton.tsx", "../../tldraw/src/lib/ui/components/primitives/Button/TldrawUiButtonLabel.tsx", "../../tldraw/src/lib/ui/components/primitives/TldrawUiIcon.tsx", "../../tldraw/src/lib/ui/components/primitives/Button/TldrawUiButtonIcon.tsx", "../../tldraw/src/lib/ui/constants.ts", "../../tldraw/src/lib/ui/context/TldrawUiContextProvider.tsx", "../../tldraw/src/lib/ui/version.ts", "../../tldraw/src/lib/utils/static-assets/assetUrls.ts", "../../tldraw/src/lib/ui/icon-types.ts", "../../tldraw/src/lib/ui/assetUrls.ts", "../../tldraw/src/lib/ui/hooks/useTools.tsx", "../../tldraw/src/lib/ui/components/EmbedDialog.tsx", "../../tldraw/src/lib/ui/components/primitives/TldrawUiDialog.tsx", "../../tldraw/src/lib/ui/components/primitives/TldrawUiInput.tsx", "../../tldraw/src/lib/ui/hooks/useInsertMedia.ts", "../../tldraw/src/lib/ui/overrides.ts", "../../tldraw/src/lib/ui/context/breakpoints.tsx", "../../tldraw/src/lib/ui/context/actions.tsx", "../../tldraw/src/lib/utils/frames/frames.ts", "../../tldraw/src/lib/ui/components/EditLinkDialog.tsx", "../../tldraw/src/lib/ui/hooks/useClipboardEvents.ts", "../../tldraw/src/lib/ui/hooks/clipboard/pasteExcalidrawContent.ts", "../../tldraw/src/lib/ui/hooks/clipboard/pasteFiles.ts", "../../tldraw/src/lib/ui/hooks/clipboard/pasteTldrawContent.ts", "../../tldraw/src/lib/ui/hooks/clipboard/pasteUrl.ts", "../../tldraw/src/lib/ui/hooks/useCopyAs.ts", "../../tldraw/src/lib/utils/export/export.ts", "../../tldraw/src/lib/utils/export/copyAs.ts", "../../tldraw/src/lib/ui/hooks/useExportAs.ts", "../../tldraw/src/lib/utils/export/exportAs.ts", "../../tldraw/src/lib/ui/hooks/usePrint.ts", "../../tldraw/src/lib/ui/context/components.tsx", "../../tldraw/src/lib/ui/components/ActionsMenu/DefaultActionsMenu.tsx", "../../tldraw/src/lib/ui/components/primitives/TldrawUiPopover.tsx", "../../@floating-ui/react-dom/dist/floating-ui.react-dom.mjs", "../../@radix-ui/react-arrow/dist/packages/react/arrow/src/index.ts", "../../@radix-ui/react-arrow/dist/packages/react/arrow/src/Arrow.tsx", "../../@radix-ui/react-use-size/dist/packages/react/use-size/src/index.ts", "../../@radix-ui/react-use-size/dist/packages/react/use-size/src/useSize.tsx", "../../@radix-ui/react-popper/dist/packages/react/popper/src/index.ts", "../../@radix-ui/react-popper/dist/packages/react/popper/src/Popper.tsx", "../../@radix-ui/react-popover/dist/packages/react/popover/src/index.ts", "../../@radix-ui/react-popover/dist/packages/react/popover/src/Popover.tsx", "../../tldraw/src/lib/ui/hooks/useMenuIsOpen.ts", "../../tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuContext.tsx", "../../tldraw/src/lib/ui/components/ActionsMenu/DefaultActionsMenuContent.tsx", "../../tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuItem.tsx", "../../@radix-ui/react-direction/dist/packages/react/direction/src/index.ts", "../../@radix-ui/react-direction/dist/packages/react/direction/src/Direction.tsx", "../../@radix-ui/react-roving-focus/dist/packages/react/roving-focus/src/index.ts", "../../@radix-ui/react-roving-focus/dist/packages/react/roving-focus/src/RovingFocusGroup.tsx", "../../@radix-ui/react-menu/dist/packages/react/menu/src/index.ts", "../../@radix-ui/react-menu/dist/packages/react/menu/src/Menu.tsx", "../../@radix-ui/react-context-menu/dist/packages/react/context-menu/src/index.ts", "../../@radix-ui/react-context-menu/dist/packages/react/context-menu/src/ContextMenu.tsx", "../../tldraw/src/lib/ui/kbd-utils.ts", "../../tldraw/src/lib/ui/components/Spinner.tsx", "../../tldraw/src/lib/ui/components/primitives/TldrawUiDropdownMenu.tsx", "../../@radix-ui/react-dropdown-menu/dist/packages/react/dropdown-menu/src/index.ts", "../../@radix-ui/react-dropdown-menu/dist/packages/react/dropdown-menu/src/DropdownMenu.tsx", "../../tldraw/src/lib/ui/components/primitives/TldrawUiKbd.tsx", "../../tldraw/src/lib/ui/components/ContextMenu/DefaultContextMenu.tsx", "../../tldraw/src/lib/ui/components/ContextMenu/DefaultContextMenuContent.tsx", "../../tldraw/src/lib/ui/components/menu-items.tsx", "../../tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuCheckboxItem.tsx", "../../tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuGroup.tsx", "../../tldraw/src/lib/ui/components/primitives/menus/TldrawUiMenuSubmenu.tsx", "../../tldraw/src/lib/ui/components/DebugMenu/DefaultDebugMenu.tsx", "../../tldraw/src/lib/ui/components/DebugMenu/DefaultDebugMenuContent.tsx", "../../tldraw/src/lib/ui/components/primitives/Button/TldrawUiButtonCheck.tsx", "../../tldraw/src/lib/ui/components/DefaultDebugPanel.tsx", "../../tldraw/src/lib/ui/components/HelpMenu/DefaultHelpMenu.tsx", "../../tldraw/src/lib/ui/components/HelpMenu/DefaultHelpMenuContent.tsx", "../../tldraw/src/lib/ui/components/LanguageMenu.tsx", "../../tldraw/src/lib/ui/components/HelperButtons/DefaultHelperButtons.tsx", "../../tldraw/src/lib/ui/components/HelperButtons/DefaultHelperButtonsContent.tsx", "../../tldraw/src/lib/ui/components/HelperButtons/BackToContent.tsx", "../../tldraw/src/lib/ui/components/HelperButtons/ExitPenMode.tsx", "../../tldraw/src/lib/ui/components/HelperButtons/StopFollowing.tsx", "../../tldraw/src/lib/ui/components/KeyboardShortcutsDialog/DefaultKeyboardShortcutsDialog.tsx", "../../tldraw/src/lib/ui/components/KeyboardShortcutsDialog/DefaultKeyboardShortcutsDialogContent.tsx", "../../tldraw/src/lib/ui/components/MainMenu/DefaultMainMenu.tsx", "../../tldraw/src/lib/ui/components/MainMenu/DefaultMainMenuContent.tsx", "../../tldraw/src/lib/ui/components/MenuPanel.tsx", "../../tldraw/src/lib/ui/components/Minimap/DefaultMinimap.tsx", "../../tldraw/src/lib/ui/components/Minimap/getRgba.ts", "../../tldraw/src/lib/ui/components/Minimap/minimap-webgl-shapes.ts", "../../tldraw/src/lib/ui/components/Minimap/minimap-webgl-setup.ts", "../../tldraw/src/lib/ui/components/Minimap/MinimapManager.ts", "../../tldraw/src/lib/ui/components/NavigationPanel/DefaultNavigationPanel.tsx", "../../tldraw/src/lib/ui/hooks/useLocalStorageState.ts", "../../tldraw/src/lib/ui/components/PageMenu/DefaultPageMenu.tsx", "../../tldraw/src/lib/ui/components/PageMenu/PageItemInput.tsx", "../../tldraw/src/lib/ui/components/PageMenu/PageItemSubmenu.tsx", "../../tldraw/src/lib/ui/components/PageMenu/edit-pages-shared.ts", "../../tldraw/src/lib/ui/components/QuickActions/DefaultQuickActions.tsx", "../../tldraw/src/lib/ui/components/QuickActions/DefaultQuickActionsContent.tsx", "../../tldraw/src/lib/ui/components/StylePanel/DefaultStylePanel.tsx", "../../tldraw/src/lib/ui/hooks/useRelevantStyles.ts", "../../tldraw/src/lib/ui/components/StylePanel/DefaultStylePanelContent.tsx", "../../tldraw/src/lib/styles.tsx", "../../tldraw/src/lib/ui/components/primitives/TldrawUiButtonPicker.tsx", "../../tldraw/src/lib/ui/components/primitives/TldrawUiSlider.tsx", "../../@radix-ui/number/dist/packages/core/number/src/index.ts", "../../@radix-ui/number/dist/packages/core/number/src/number.ts", "../../@radix-ui/react-use-previous/dist/packages/react/use-previous/src/index.ts", "../../@radix-ui/react-use-previous/dist/packages/react/use-previous/src/usePrevious.tsx", "../../@radix-ui/react-slider/dist/packages/react/slider/src/index.ts", "../../@radix-ui/react-slider/dist/packages/react/slider/src/Slider.tsx", "../../tldraw/src/lib/ui/components/StylePanel/DoubleDropdownPicker.tsx", "../../tldraw/src/lib/ui/components/StylePanel/DropdownPicker.tsx", "../../tldraw/src/lib/ui/components/Toolbar/DefaultToolbar.tsx", "../../tldraw/src/lib/ui/components/MobileStylePanel.tsx", "../../tldraw/src/lib/ui/components/Toolbar/DefaultToolbarContent.tsx", "../../tldraw/src/lib/ui/components/Toolbar/OverflowingToolbar.tsx", "../../hotkeys-js/dist/hotkeys.esm.js", "../../tldraw/src/lib/ui/hooks/useKeyboardShortcuts.ts", "../../tldraw/src/lib/ui/components/Toolbar/ToggleToolLockedButton.tsx", "../../tldraw/src/lib/ui/components/ZoomMenu/DefaultZoomMenu.tsx", "../../tldraw/src/lib/ui/components/ZoomMenu/DefaultZoomMenuContent.tsx", "../../tldraw/src/lib/ui/hooks/useEditorEvents.ts", "../../tldraw/src/lib/ui/hooks/usePreloadAssets.ts", "../../tldraw/src/lib/TldrawImage.tsx", "../../tldraw/src/lib/ui/components/OfflineIndicator/OfflineIndicator.tsx", "../../tldraw/src/lib/utils/tldr/buildFromV1Document.ts", "../../tldraw/src/lib/utils/tldr/file.ts"],
  "sourcesContent": ["/**\n * Lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright JS Foundation and other contributors <https://js.foundation/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    asyncTag = '[object AsyncFunction]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    nullTag = '[object Null]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    proxyTag = '[object Proxy]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    undefinedTag = '[object Undefined]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * A specialized version of `_.filter` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {Array} Returns the new filtered array.\n */\nfunction arrayFilter(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      resIndex = 0,\n      result = [];\n\n  while (++index < length) {\n    var value = array[index];\n    if (predicate(value, index, array)) {\n      result[resIndex++] = value;\n    }\n  }\n  return result;\n}\n\n/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\n/**\n * A specialized version of `_.some` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {boolean} Returns `true` if any element passes the predicate check,\n *  else `false`.\n */\nfunction arraySome(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (predicate(array[index], index, array)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\n/**\n * Checks if a `cache` value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\n/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined,\n    Symbol = root.Symbol,\n    Uint8Array = root.Uint8Array,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    splice = arrayProto.splice,\n    symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols,\n    nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,\n    nativeKeys = overArg(Object.keys, Object);\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView'),\n    Map = getNative(root, 'Map'),\n    Promise = getNative(root, 'Promise'),\n    Set = getNative(root, 'Set'),\n    WeakMap = getNative(root, 'WeakMap'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values == null ? 0 : values.length;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\n/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  var data = this.__data__ = new ListCache(entries);\n  this.size = data.size;\n}\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n  this.size = 0;\n}\n\n/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  var data = this.__data__,\n      result = data['delete'](key);\n\n  this.size = data.size;\n  return result;\n}\n\n/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\n/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var data = this.__data__;\n  if (data instanceof ListCache) {\n    var pairs = data.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      this.size = ++data.size;\n      return this;\n    }\n    data = this.__data__ = new MapCache(pairs);\n  }\n  data.set(key, value);\n  this.size = data.size;\n  return this;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\n/**\n * The base implementation of `_.isEqual` which supports partial comparisons\n * and tracks traversed objects.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Unordered comparison\n *  2 - Partial comparison\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {Object} [stack] Tracks traversed `value` and `other` objects.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n */\nfunction baseIsEqual(value, other, bitmask, customizer, stack) {\n  if (value === other) {\n    return true;\n  }\n  if (value == null || other == null || (!isObjectLike(value) && !isObjectLike(other))) {\n    return value !== value && other !== other;\n  }\n  return baseIsEqualDeep(value, other, bitmask, customizer, baseIsEqual, stack);\n}\n\n/**\n * A specialized version of `baseIsEqual` for arrays and objects which performs\n * deep comparisons and tracks traversed objects enabling objects with circular\n * references to be compared.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} [stack] Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) {\n  var objIsArr = isArray(object),\n      othIsArr = isArray(other),\n      objTag = objIsArr ? arrayTag : getTag(object),\n      othTag = othIsArr ? arrayTag : getTag(other);\n\n  objTag = objTag == argsTag ? objectTag : objTag;\n  othTag = othTag == argsTag ? objectTag : othTag;\n\n  var objIsObj = objTag == objectTag,\n      othIsObj = othTag == objectTag,\n      isSameTag = objTag == othTag;\n\n  if (isSameTag && isBuffer(object)) {\n    if (!isBuffer(other)) {\n      return false;\n    }\n    objIsArr = true;\n    objIsObj = false;\n  }\n  if (isSameTag && !objIsObj) {\n    stack || (stack = new Stack);\n    return (objIsArr || isTypedArray(object))\n      ? equalArrays(object, other, bitmask, customizer, equalFunc, stack)\n      : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);\n  }\n  if (!(bitmask & COMPARE_PARTIAL_FLAG)) {\n    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),\n        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');\n\n    if (objIsWrapped || othIsWrapped) {\n      var objUnwrapped = objIsWrapped ? object.value() : object,\n          othUnwrapped = othIsWrapped ? other.value() : other;\n\n      stack || (stack = new Stack);\n      return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);\n    }\n  }\n  if (!isSameTag) {\n    return false;\n  }\n  stack || (stack = new Stack);\n  return equalObjects(object, other, bitmask, customizer, equalFunc, stack);\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for arrays with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Array} array The array to compare.\n * @param {Array} other The other array to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `array` and `other` objects.\n * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.\n */\nfunction equalArrays(array, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      arrLength = array.length,\n      othLength = other.length;\n\n  if (arrLength != othLength && !(isPartial && othLength > arrLength)) {\n    return false;\n  }\n  // Assume cyclic values are equal.\n  var stacked = stack.get(array);\n  if (stacked && stack.get(other)) {\n    return stacked == other;\n  }\n  var index = -1,\n      result = true,\n      seen = (bitmask & COMPARE_UNORDERED_FLAG) ? new SetCache : undefined;\n\n  stack.set(array, other);\n  stack.set(other, array);\n\n  // Ignore non-index properties.\n  while (++index < arrLength) {\n    var arrValue = array[index],\n        othValue = other[index];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, arrValue, index, other, array, stack)\n        : customizer(arrValue, othValue, index, array, other, stack);\n    }\n    if (compared !== undefined) {\n      if (compared) {\n        continue;\n      }\n      result = false;\n      break;\n    }\n    // Recursively compare arrays (susceptible to call stack limits).\n    if (seen) {\n      if (!arraySome(other, function(othValue, othIndex) {\n            if (!cacheHas(seen, othIndex) &&\n                (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {\n              return seen.push(othIndex);\n            }\n          })) {\n        result = false;\n        break;\n      }\n    } else if (!(\n          arrValue === othValue ||\n            equalFunc(arrValue, othValue, bitmask, customizer, stack)\n        )) {\n      result = false;\n      break;\n    }\n  }\n  stack['delete'](array);\n  stack['delete'](other);\n  return result;\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for comparing objects of\n * the same `toStringTag`.\n *\n * **Note:** This function only supports comparing values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {string} tag The `toStringTag` of the objects to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalByTag(object, other, tag, bitmask, customizer, equalFunc, stack) {\n  switch (tag) {\n    case dataViewTag:\n      if ((object.byteLength != other.byteLength) ||\n          (object.byteOffset != other.byteOffset)) {\n        return false;\n      }\n      object = object.buffer;\n      other = other.buffer;\n\n    case arrayBufferTag:\n      if ((object.byteLength != other.byteLength) ||\n          !equalFunc(new Uint8Array(object), new Uint8Array(other))) {\n        return false;\n      }\n      return true;\n\n    case boolTag:\n    case dateTag:\n    case numberTag:\n      // Coerce booleans to `1` or `0` and dates to milliseconds.\n      // Invalid dates are coerced to `NaN`.\n      return eq(+object, +other);\n\n    case errorTag:\n      return object.name == other.name && object.message == other.message;\n\n    case regexpTag:\n    case stringTag:\n      // Coerce regexes to strings and treat strings, primitives and objects,\n      // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring\n      // for more details.\n      return object == (other + '');\n\n    case mapTag:\n      var convert = mapToArray;\n\n    case setTag:\n      var isPartial = bitmask & COMPARE_PARTIAL_FLAG;\n      convert || (convert = setToArray);\n\n      if (object.size != other.size && !isPartial) {\n        return false;\n      }\n      // Assume cyclic values are equal.\n      var stacked = stack.get(object);\n      if (stacked) {\n        return stacked == other;\n      }\n      bitmask |= COMPARE_UNORDERED_FLAG;\n\n      // Recursively compare objects (susceptible to call stack limits).\n      stack.set(object, other);\n      var result = equalArrays(convert(object), convert(other), bitmask, customizer, equalFunc, stack);\n      stack['delete'](object);\n      return result;\n\n    case symbolTag:\n      if (symbolValueOf) {\n        return symbolValueOf.call(object) == symbolValueOf.call(other);\n      }\n  }\n  return false;\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for objects with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalObjects(object, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      objProps = getAllKeys(object),\n      objLength = objProps.length,\n      othProps = getAllKeys(other),\n      othLength = othProps.length;\n\n  if (objLength != othLength && !isPartial) {\n    return false;\n  }\n  var index = objLength;\n  while (index--) {\n    var key = objProps[index];\n    if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {\n      return false;\n    }\n  }\n  // Assume cyclic values are equal.\n  var stacked = stack.get(object);\n  if (stacked && stack.get(other)) {\n    return stacked == other;\n  }\n  var result = true;\n  stack.set(object, other);\n  stack.set(other, object);\n\n  var skipCtor = isPartial;\n  while (++index < objLength) {\n    key = objProps[index];\n    var objValue = object[key],\n        othValue = other[key];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, objValue, key, other, object, stack)\n        : customizer(objValue, othValue, key, object, other, stack);\n    }\n    // Recursively compare objects (susceptible to call stack limits).\n    if (!(compared === undefined\n          ? (objValue === othValue || equalFunc(objValue, othValue, bitmask, customizer, stack))\n          : compared\n        )) {\n      result = false;\n      break;\n    }\n    skipCtor || (skipCtor = key == 'constructor');\n  }\n  if (result && !skipCtor) {\n    var objCtor = object.constructor,\n        othCtor = other.constructor;\n\n    // Non `Object` object instances with different constructors are not equal.\n    if (objCtor != othCtor &&\n        ('constructor' in object && 'constructor' in other) &&\n        !(typeof objCtor == 'function' && objCtor instanceof objCtor &&\n          typeof othCtor == 'function' && othCtor instanceof othCtor)) {\n      result = false;\n    }\n  }\n  stack['delete'](object);\n  stack['delete'](other);\n  return result;\n}\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\n/**\n * Creates an array of the own enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = !nativeGetSymbols ? stubArray : function(object) {\n  if (object == null) {\n    return [];\n  }\n  object = Object(object);\n  return arrayFilter(nativeGetSymbols(object), function(symbol) {\n    return propertyIsEnumerable.call(object, symbol);\n  });\n};\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = baseGetTag(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : '';\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\n/**\n * Performs a deep comparison between two values to determine if they are\n * equivalent.\n *\n * **Note:** This method supports comparing arrays, array buffers, booleans,\n * date objects, error objects, maps, numbers, `Object` objects, regexes,\n * sets, strings, symbols, and typed arrays. `Object` objects are compared\n * by their own, not inherited, enumerable properties. Functions and DOM\n * nodes are compared by strict equality, i.e. `===`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.isEqual(object, other);\n * // => true\n *\n * object === other;\n * // => false\n */\nfunction isEqual(value, other) {\n  return baseIsEqual(value, other);\n}\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\n/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\n/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nmodule.exports = isEqual;\n", "/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = throttle;\n", "/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** `Object#toString` result references. */\nvar funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * A specialized version of `_.includes` for arrays without support for\n * specifying an index to search from.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludes(array, value) {\n  var length = array ? array.length : 0;\n  return !!length && baseIndexOf(array, value, 0) > -1;\n}\n\n/**\n * This function is like `arrayIncludes` except that it accepts a comparator.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @param {Function} comparator The comparator invoked per element.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludesWith(array, value, comparator) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  while (++index < length) {\n    if (comparator(value, array[index])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.indexOf` without `fromIndex` bounds checks.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} value The value to search for.\n * @param {number} fromIndex The index to search from.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseIndexOf(array, value, fromIndex) {\n  if (value !== value) {\n    return baseFindIndex(array, baseIsNaN, fromIndex);\n  }\n  var index = fromIndex - 1,\n      length = array.length;\n\n  while (++index < length) {\n    if (array[index] === value) {\n      return index;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.isNaN` without support for number objects.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.\n */\nfunction baseIsNaN(value) {\n  return value !== value;\n}\n\n/**\n * Checks if a cache value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map'),\n    Set = getNative(root, 'Set'),\n    nativeCreate = getNative(Object, 'create');\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values ? values.length : 0;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\n/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.uniqBy` without support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new duplicate free array.\n */\nfunction baseUniq(array, iteratee, comparator) {\n  var index = -1,\n      includes = arrayIncludes,\n      length = array.length,\n      isCommon = true,\n      result = [],\n      seen = result;\n\n  if (comparator) {\n    isCommon = false;\n    includes = arrayIncludesWith;\n  }\n  else if (length >= LARGE_ARRAY_SIZE) {\n    var set = iteratee ? null : createSet(array);\n    if (set) {\n      return setToArray(set);\n    }\n    isCommon = false;\n    includes = cacheHas;\n    seen = new SetCache;\n  }\n  else {\n    seen = iteratee ? [] : result;\n  }\n  outer:\n  while (++index < length) {\n    var value = array[index],\n        computed = iteratee ? iteratee(value) : value;\n\n    value = (comparator || value !== 0) ? value : 0;\n    if (isCommon && computed === computed) {\n      var seenIndex = seen.length;\n      while (seenIndex--) {\n        if (seen[seenIndex] === computed) {\n          continue outer;\n        }\n      }\n      if (iteratee) {\n        seen.push(computed);\n      }\n      result.push(value);\n    }\n    else if (!includes(seen, computed, comparator)) {\n      if (seen !== result) {\n        seen.push(computed);\n      }\n      result.push(value);\n    }\n  }\n  return result;\n}\n\n/**\n * Creates a set object of `values`.\n *\n * @private\n * @param {Array} values The values to add to the set.\n * @returns {Object} Returns the new set.\n */\nvar createSet = !(Set && (1 / setToArray(new Set([,-0]))[1]) == INFINITY) ? noop : function(values) {\n  return new Set(values);\n};\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates a duplicate-free version of an array, using\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons, in which only the first occurrence of each\n * element is kept.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @returns {Array} Returns the new duplicate free array.\n * @example\n *\n * _.uniq([2, 1, 2]);\n * // => [2, 1]\n */\nfunction uniq(array) {\n  return (array && array.length)\n    ? baseUniq(array)\n    : [];\n}\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * This method returns `undefined`.\n *\n * @static\n * @memberOf _\n * @since 2.3.0\n * @category Util\n * @example\n *\n * _.times(2, _.noop);\n * // => [undefined, undefined]\n */\nfunction noop() {\n  // No operation performed.\n}\n\nmodule.exports = uniq;\n", "'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n", "'use strict';\nvar check = function (it) {\n  return it && it.Math === Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  check(typeof this == 'object' && this) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n", "'use strict';\nmodule.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n", "'use strict';\nvar fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] !== 7;\n});\n", "'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-function-prototype-bind -- safe\n  var test = (function () { /* empty */ }).bind();\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return typeof test != 'function' || test.hasOwnProperty('prototype');\n});\n", "'use strict';\nvar NATIVE_BIND = require('../internals/function-bind-native');\n\nvar call = Function.prototype.call;\n\nmodule.exports = NATIVE_BIND ? call.bind(call) : function () {\n  return call.apply(call, arguments);\n};\n", "'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n", "'use strict';\nmodule.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n", "'use strict';\nvar NATIVE_BIND = require('../internals/function-bind-native');\n\nvar FunctionPrototype = Function.prototype;\nvar call = FunctionPrototype.call;\nvar uncurryThisWithBind = NATIVE_BIND && FunctionPrototype.bind.bind(call, call);\n\nmodule.exports = NATIVE_BIND ? uncurryThisWithBind : function (fn) {\n  return function () {\n    return call.apply(fn, arguments);\n  };\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nvar toString = uncurryThis({}.toString);\nvar stringSlice = uncurryThis(''.slice);\n\nmodule.exports = function (it) {\n  return stringSlice(toString(it), 8, -1);\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar $Object = Object;\nvar split = uncurryThis(''.split);\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !$Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) === 'String' ? split(it, '') : $Object(it);\n} : $Object;\n", "'use strict';\n// we can't use just `it == null` since of `document.all` special case\n// https://tc39.es/ecma262/#sec-IsHTMLDDA-internal-slot-aec\nmodule.exports = function (it) {\n  return it === null || it === undefined;\n};\n", "'use strict';\nvar isNullOrUndefined = require('../internals/is-null-or-undefined');\n\nvar $TypeError = TypeError;\n\n// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (isNullOrUndefined(it)) throw new $TypeError(\"Can't call method on \" + it);\n  return it;\n};\n", "'use strict';\n// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n", "'use strict';\n// https://tc39.es/ecma262/#sec-IsHTMLDDA-internal-slot\nvar documentAll = typeof document == 'object' && document.all;\n\n// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\n// eslint-disable-next-line unicorn/no-typeof-undefined -- required for testing\nmodule.exports = typeof documentAll == 'undefined' && documentAll !== undefined ? function (argument) {\n  return typeof argument == 'function' || argument === documentAll;\n} : function (argument) {\n  return typeof argument == 'function';\n};\n", "'use strict';\nvar isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it == 'object' ? it !== null : isCallable(it);\n};\n", "'use strict';\nvar global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = uncurryThis({}.isPrototypeOf);\n", "'use strict';\nmodule.exports = typeof navigator != 'undefined' && String(navigator.userAgent) || '';\n", "'use strict';\nvar global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  // in old Chrome, versions of V8 isn't V8 = Chrome / 10\n  // but their correct versions are not interesting for us\n  version = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);\n}\n\n// BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`\n// so check `userAgent` even if `.v8` exists, but 0\nif (!version && userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = +match[1];\n  }\n}\n\nmodule.exports = version;\n", "'use strict';\n/* eslint-disable es/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\nvar global = require('../internals/global');\n\nvar $String = global.String;\n\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol('symbol detection');\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  // nb: Do not call `String` directly to avoid this being optimized out to `symbol+''` which will,\n  // of course, fail.\n  return !$String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n", "'use strict';\n/* eslint-disable es/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/symbol-constructor-detection');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n", "'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar isCallable = require('../internals/is-callable');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar $Object = Object;\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && isPrototypeOf($Symbol.prototype, $Object(it));\n};\n", "'use strict';\nvar $String = String;\n\nmodule.exports = function (argument) {\n  try {\n    return $String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n", "'use strict';\nvar isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\nvar $TypeError = TypeError;\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw new $TypeError(tryToString(argument) + ' is not a function');\n};\n", "'use strict';\nvar aCallable = require('../internals/a-callable');\nvar isNullOrUndefined = require('../internals/is-null-or-undefined');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return isNullOrUndefined(func) ? undefined : aCallable(func);\n};\n", "'use strict';\nvar call = require('../internals/function-call');\nvar isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\nvar $TypeError = TypeError;\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = call(fn, input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  throw new $TypeError(\"Can't convert object to primitive value\");\n};\n", "'use strict';\nmodule.exports = false;\n", "'use strict';\nvar global = require('../internals/global');\n\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar defineProperty = Object.defineProperty;\n\nmodule.exports = function (key, value) {\n  try {\n    defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n", "'use strict';\nvar IS_PURE = require('../internals/is-pure');\nvar globalThis = require('../internals/global');\nvar defineGlobalProperty = require('../internals/define-global-property');\n\nvar SHARED = '__core-js_shared__';\nvar store = module.exports = globalThis[SHARED] || defineGlobalProperty(SHARED, {});\n\n(store.versions || (store.versions = [])).push({\n  version: '3.37.1',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '© 2014-2024 Denis Pushkarev (zloirock.ru)',\n  license: 'https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE',\n  source: 'https://github.com/zloirock/core-js'\n});\n", "'use strict';\nvar store = require('../internals/shared-store');\n\nmodule.exports = function (key, value) {\n  return store[key] || (store[key] = value || {});\n};\n", "'use strict';\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar $Object = Object;\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return $Object(requireObjectCoercible(argument));\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar toObject = require('../internals/to-object');\n\nvar hasOwnProperty = uncurryThis({}.hasOwnProperty);\n\n// `HasOwnProperty` abstract operation\n// https://tc39.es/ecma262/#sec-hasownproperty\n// eslint-disable-next-line es/no-object-hasown -- safe\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty(toObject(it), key);\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nvar id = 0;\nvar postfix = Math.random();\nvar toString = uncurryThis(1.0.toString);\n\nmodule.exports = function (key) {\n  return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString(++id + postfix, 36);\n};\n", "'use strict';\nvar global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar hasOwn = require('../internals/has-own-property');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/symbol-constructor-detection');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar Symbol = global.Symbol;\nvar WellKnownSymbolsStore = shared('wks');\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol['for'] || Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!hasOwn(WellKnownSymbolsStore, name)) {\n    WellKnownSymbolsStore[name] = NATIVE_SYMBOL && hasOwn(Symbol, name)\n      ? Symbol[name]\n      : createWellKnownSymbol('Symbol.' + name);\n  } return WellKnownSymbolsStore[name];\n};\n", "'use strict';\nvar call = require('../internals/function-call');\nvar isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar $TypeError = TypeError;\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = call(exoticToPrim, input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw new $TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n", "'use strict';\nvar toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : key + '';\n};\n", "'use strict';\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n", "'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thanks to IE8 for its funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a !== 7;\n});\n", "'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar call = require('../internals/function-call');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar hasOwn = require('../internals/has-own-property');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (hasOwn(O, P)) return createPropertyDescriptor(!call(propertyIsEnumerableModule.f, O, P), O[P]);\n};\n", "'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\n\n// V8 ~ Chrome 36-\n// https://bugs.chromium.org/p/v8/issues/detail?id=3334\nmodule.exports = DESCRIPTORS && fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(function () { /* empty */ }, 'prototype', {\n    value: 42,\n    writable: false\n  }).prototype !== 42;\n});\n", "'use strict';\nvar isObject = require('../internals/is-object');\n\nvar $String = String;\nvar $TypeError = TypeError;\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw new $TypeError($String(argument) + ' is not an object');\n};\n", "'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar V8_PROTOTYPE_DEFINE_BUG = require('../internals/v8-prototype-define-bug');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\nvar $TypeError = TypeError;\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nvar ENUMERABLE = 'enumerable';\nvar CONFIGURABLE = 'configurable';\nvar WRITABLE = 'writable';\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? V8_PROTOTYPE_DEFINE_BUG ? function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (typeof O === 'function' && P === 'prototype' && 'value' in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {\n    var current = $getOwnPropertyDescriptor(O, P);\n    if (current && current[WRITABLE]) {\n      O[P] = Attributes.value;\n      Attributes = {\n        configurable: CONFIGURABLE in Attributes ? Attributes[CONFIGURABLE] : current[CONFIGURABLE],\n        enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],\n        writable: false\n      };\n    }\n  } return $defineProperty(O, P, Attributes);\n} : $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw new $TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n", "'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n", "'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar hasOwn = require('../internals/has-own-property');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = hasOwn(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = uncurryThis(Function.toString);\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n", "'use strict';\nvar global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(String(WeakMap));\n", "'use strict';\nvar shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n", "'use strict';\nmodule.exports = {};\n", "'use strict';\nvar NATIVE_WEAK_MAP = require('../internals/weak-map-basic-detection');\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar hasOwn = require('../internals/has-own-property');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar TypeError = global.TypeError;\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw new TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  /* eslint-disable no-self-assign -- prototype methods protection */\n  store.get = store.get;\n  store.has = store.has;\n  store.set = store.set;\n  /* eslint-enable no-self-assign -- prototype methods protection */\n  set = function (it, metadata) {\n    if (store.has(it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    store.set(it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return store.get(it) || {};\n  };\n  has = function (it) {\n    return store.has(it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (hasOwn(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return hasOwn(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return hasOwn(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\nvar hasOwn = require('../internals/has-own-property');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\n\nvar enforceInternalState = InternalStateModule.enforce;\nvar getInternalState = InternalStateModule.get;\nvar $String = String;\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar defineProperty = Object.defineProperty;\nvar stringSlice = uncurryThis(''.slice);\nvar replace = uncurryThis(''.replace);\nvar join = uncurryThis([].join);\n\nvar CONFIGURABLE_LENGTH = DESCRIPTORS && !fails(function () {\n  return defineProperty(function () { /* empty */ }, 'length', { value: 8 }).length !== 8;\n});\n\nvar TEMPLATE = String(String).split('String');\n\nvar makeBuiltIn = module.exports = function (value, name, options) {\n  if (stringSlice($String(name), 0, 7) === 'Symbol(') {\n    name = '[' + replace($String(name), /^Symbol\\(([^)]*)\\).*$/, '$1') + ']';\n  }\n  if (options && options.getter) name = 'get ' + name;\n  if (options && options.setter) name = 'set ' + name;\n  if (!hasOwn(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n    if (DESCRIPTORS) defineProperty(value, 'name', { value: name, configurable: true });\n    else value.name = name;\n  }\n  if (CONFIGURABLE_LENGTH && options && hasOwn(options, 'arity') && value.length !== options.arity) {\n    defineProperty(value, 'length', { value: options.arity });\n  }\n  try {\n    if (options && hasOwn(options, 'constructor') && options.constructor) {\n      if (DESCRIPTORS) defineProperty(value, 'prototype', { writable: false });\n    // in V8 ~ Chrome 53, prototypes of some methods, like `Array.prototype.values`, are non-writable\n    } else if (value.prototype) value.prototype = undefined;\n  } catch (error) { /* empty */ }\n  var state = enforceInternalState(value);\n  if (!hasOwn(state, 'source')) {\n    state.source = join(TEMPLATE, typeof name == 'string' ? name : '');\n  } return value;\n};\n\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n// eslint-disable-next-line no-extend-native -- required\nFunction.prototype.toString = makeBuiltIn(function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n}, 'toString');\n", "'use strict';\nvar isCallable = require('../internals/is-callable');\nvar definePropertyModule = require('../internals/object-define-property');\nvar makeBuiltIn = require('../internals/make-built-in');\nvar defineGlobalProperty = require('../internals/define-global-property');\n\nmodule.exports = function (O, key, value, options) {\n  if (!options) options = {};\n  var simple = options.enumerable;\n  var name = options.name !== undefined ? options.name : key;\n  if (isCallable(value)) makeBuiltIn(value, name, options);\n  if (options.global) {\n    if (simple) O[key] = value;\n    else defineGlobalProperty(key, value);\n  } else {\n    try {\n      if (!options.unsafe) delete O[key];\n      else if (O[key]) simple = true;\n    } catch (error) { /* empty */ }\n    if (simple) O[key] = value;\n    else definePropertyModule.f(O, key, {\n      value: value,\n      enumerable: false,\n      configurable: !options.nonConfigurable,\n      writable: !options.nonWritable\n    });\n  } return O;\n};\n", "'use strict';\nvar ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `Math.trunc` method\n// https://tc39.es/ecma262/#sec-math.trunc\n// eslint-disable-next-line es/no-math-trunc -- safe\nmodule.exports = Math.trunc || function trunc(x) {\n  var n = +x;\n  return (n > 0 ? floor : ceil)(n);\n};\n", "'use strict';\nvar trunc = require('../internals/math-trunc');\n\n// `ToIntegerOrInfinity` abstract operation\n// https://tc39.es/ecma262/#sec-tointegerorinfinity\nmodule.exports = function (argument) {\n  var number = +argument;\n  // eslint-disable-next-line no-self-compare -- NaN check\n  return number !== number || number === 0 ? 0 : trunc(number);\n};\n", "'use strict';\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toIntegerOrInfinity(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n", "'use strict';\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  var len = toIntegerOrInfinity(argument);\n  return len > 0 ? min(len, 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n", "'use strict';\nvar toLength = require('../internals/to-length');\n\n// `LengthOfArrayLike` abstract operation\n// https://tc39.es/ecma262/#sec-lengthofarraylike\nmodule.exports = function (obj) {\n  return toLength(obj.length);\n};\n", "'use strict';\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = lengthOfArrayLike(O);\n    if (length === 0) return !IS_INCLUDES && -1;\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el !== el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value !== value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar hasOwn = require('../internals/has-own-property');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar push = uncurryThis([].push);\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !hasOwn(hiddenKeys, key) && hasOwn(O, key) && push(result, key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (hasOwn(O, key = names[i++])) {\n    ~indexOf(result, key) || push(result, key);\n  }\n  return result;\n};\n", "'use strict';\n// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n", "'use strict';\nvar internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n", "'use strict';\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n", "'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\nvar concat = uncurryThis([].concat);\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? concat(keys, getOwnPropertySymbols(it)) : keys;\n};\n", "'use strict';\nvar hasOwn = require('../internals/has-own-property');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source, exceptions) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!hasOwn(target, key) && !(exceptions && hasOwn(exceptions, key))) {\n      defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n    }\n  }\n};\n", "'use strict';\nvar fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value === POLYFILL ? true\n    : value === NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n", "'use strict';\nvar global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar defineBuiltIn = require('../internals/define-built-in');\nvar defineGlobalProperty = require('../internals/define-global-property');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target         - name of the target object\n  options.global         - target is the global object\n  options.stat           - export as static methods of target\n  options.proto          - export as prototype methods of target\n  options.real           - real prototype method for the `pure` version\n  options.forced         - export even if the native feature is available\n  options.bind           - bind methods to the target, required for the `pure` version\n  options.wrap           - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe         - use the simple assignment of property instead of delete + defineProperty\n  options.sham           - add a flag to not completely full polyfills\n  options.enumerable     - export as enumerable property\n  options.dontCallGetSet - prevent calling a getter on target\n  options.name           - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || defineGlobalProperty(TARGET, {});\n  } else {\n    target = global[TARGET] && global[TARGET].prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.dontCallGetSet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty == typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    defineBuiltIn(target, key, sourceProperty, options);\n  }\n};\n", "'use strict';\nvar internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n", "'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar V8_PROTOTYPE_DEFINE_BUG = require('../internals/v8-prototype-define-bug');\nvar definePropertyModule = require('../internals/object-define-property');\nvar anObject = require('../internals/an-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar objectKeys = require('../internals/object-keys');\n\n// `Object.defineProperties` method\n// https://tc39.es/ecma262/#sec-object.defineproperties\n// eslint-disable-next-line es/no-object-defineproperties -- safe\nexports.f = DESCRIPTORS && !V8_PROTOTYPE_DEFINE_BUG ? Object.defineProperties : function defineProperties(O, Properties) {\n  anObject(O);\n  var props = toIndexedObject(Properties);\n  var keys = objectKeys(Properties);\n  var length = keys.length;\n  var index = 0;\n  var key;\n  while (length > index) definePropertyModule.f(O, key = keys[index++], props[key]);\n  return O;\n};\n", "'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('document', 'documentElement');\n", "'use strict';\n/* global ActiveXObject -- old IE, WSH */\nvar anObject = require('../internals/an-object');\nvar definePropertiesModule = require('../internals/object-define-properties');\nvar enumBugKeys = require('../internals/enum-bug-keys');\nvar hiddenKeys = require('../internals/hidden-keys');\nvar html = require('../internals/html');\nvar documentCreateElement = require('../internals/document-create-element');\nvar sharedKey = require('../internals/shared-key');\n\nvar GT = '>';\nvar LT = '<';\nvar PROTOTYPE = 'prototype';\nvar SCRIPT = 'script';\nvar IE_PROTO = sharedKey('IE_PROTO');\n\nvar EmptyConstructor = function () { /* empty */ };\n\nvar scriptTag = function (content) {\n  return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;\n};\n\n// Create object with fake `null` prototype: use ActiveX Object with cleared prototype\nvar NullProtoObjectViaActiveX = function (activeXDocument) {\n  activeXDocument.write(scriptTag(''));\n  activeXDocument.close();\n  var temp = activeXDocument.parentWindow.Object;\n  activeXDocument = null; // avoid memory leak\n  return temp;\n};\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar NullProtoObjectViaIFrame = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = documentCreateElement('iframe');\n  var JS = 'java' + SCRIPT + ':';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  html.appendChild(iframe);\n  // https://github.com/zloirock/core-js/issues/475\n  iframe.src = String(JS);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(scriptTag('document.F=Object'));\n  iframeDocument.close();\n  return iframeDocument.F;\n};\n\n// Check for document.domain and active x support\n// No need to use active x approach when document.domain is not set\n// see https://github.com/es-shims/es5-shim/issues/150\n// variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346\n// avoid IE GC bug\nvar activeXDocument;\nvar NullProtoObject = function () {\n  try {\n    activeXDocument = new ActiveXObject('htmlfile');\n  } catch (error) { /* ignore */ }\n  NullProtoObject = typeof document != 'undefined'\n    ? document.domain && activeXDocument\n      ? NullProtoObjectViaActiveX(activeXDocument) // old IE\n      : NullProtoObjectViaIFrame()\n    : NullProtoObjectViaActiveX(activeXDocument); // WSH\n  var length = enumBugKeys.length;\n  while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];\n  return NullProtoObject();\n};\n\nhiddenKeys[IE_PROTO] = true;\n\n// `Object.create` method\n// https://tc39.es/ecma262/#sec-object.create\n// eslint-disable-next-line es/no-object-create -- safe\nmodule.exports = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    EmptyConstructor[PROTOTYPE] = anObject(O);\n    result = new EmptyConstructor();\n    EmptyConstructor[PROTOTYPE] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO] = O;\n  } else result = NullProtoObject();\n  return Properties === undefined ? result : definePropertiesModule.f(result, Properties);\n};\n", "'use strict';\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar create = require('../internals/object-create');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar UNSCOPABLES = wellKnownSymbol('unscopables');\nvar ArrayPrototype = Array.prototype;\n\n// Array.prototype[@@unscopables]\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\nif (ArrayPrototype[UNSCOPABLES] === undefined) {\n  defineProperty(ArrayPrototype, UNSCOPABLES, {\n    configurable: true,\n    value: create(null)\n  });\n}\n\n// add a key to Array.prototype[@@unscopables]\nmodule.exports = function (key) {\n  ArrayPrototype[UNSCOPABLES][key] = true;\n};\n", "'use strict';\nvar $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// `Array.prototype.at` method\n// https://tc39.es/ecma262/#sec-array.prototype.at\n$({ target: 'Array', proto: true }, {\n  at: function at(index) {\n    var O = toObject(this);\n    var len = lengthOfArrayLike(O);\n    var relativeIndex = toIntegerOrInfinity(index);\n    var k = relativeIndex >= 0 ? relativeIndex : len + relativeIndex;\n    return (k < 0 || k >= len) ? undefined : O[k];\n  }\n});\n\naddToUnscopables('at');\n", "'use strict';\nvar global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = function (CONSTRUCTOR, METHOD) {\n  return uncurryThis(global[CONSTRUCTOR].prototype[METHOD]);\n};\n", "'use strict';\nrequire('../../modules/es.array.at');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'at');\n", "'use strict';\nvar parent = require('../../es/array/at');\n\nmodule.exports = parent;\n", "'use strict';\nvar classof = require('../internals/classof-raw');\n\n// `IsArray` abstract operation\n// https://tc39.es/ecma262/#sec-isarray\n// eslint-disable-next-line es/no-array-isarray -- safe\nmodule.exports = Array.isArray || function isArray(argument) {\n  return classof(argument) === 'Array';\n};\n", "'use strict';\nvar $TypeError = TypeError;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF; // 2 ** 53 - 1 == 9007199254740991\n\nmodule.exports = function (it) {\n  if (it > MAX_SAFE_INTEGER) throw $TypeError('Maximum allowed index exceeded');\n  return it;\n};\n", "'use strict';\nvar classofRaw = require('../internals/classof-raw');\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = function (fn) {\n  // Nashorn bug:\n  //   https://github.com/zloirock/core-js/issues/1128\n  //   https://github.com/zloirock/core-js/issues/1130\n  if (classofRaw(fn) === 'Function') return uncurryThis(fn);\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this-clause');\nvar aCallable = require('../internals/a-callable');\nvar NATIVE_BIND = require('../internals/function-bind-native');\n\nvar bind = uncurryThis(uncurryThis.bind);\n\n// optional / simple context binding\nmodule.exports = function (fn, that) {\n  aCallable(fn);\n  return that === undefined ? fn : NATIVE_BIND ? bind(fn, that) : function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n", "'use strict';\nvar isArray = require('../internals/is-array');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar doesNotExceedSafeInteger = require('../internals/does-not-exceed-safe-integer');\nvar bind = require('../internals/function-bind-context');\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg) : false;\n  var element, elementLen;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        elementLen = lengthOfArrayLike(element);\n        targetIndex = flattenIntoArray(target, original, element, elementLen, targetIndex, depth - 1) - 1;\n      } else {\n        doesNotExceedSafeInteger(targetIndex + 1);\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n", "'use strict';\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n", "'use strict';\nvar TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar $Object = Object;\n\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) === 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = $Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) === 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\nvar classof = require('../internals/classof');\nvar getBuiltIn = require('../internals/get-built-in');\nvar inspectSource = require('../internals/inspect-source');\n\nvar noop = function () { /* empty */ };\nvar construct = getBuiltIn('Reflect', 'construct');\nvar constructorRegExp = /^\\s*(?:class|function)\\b/;\nvar exec = uncurryThis(constructorRegExp.exec);\nvar INCORRECT_TO_STRING = !constructorRegExp.test(noop);\n\nvar isConstructorModern = function isConstructor(argument) {\n  if (!isCallable(argument)) return false;\n  try {\n    construct(noop, [], argument);\n    return true;\n  } catch (error) {\n    return false;\n  }\n};\n\nvar isConstructorLegacy = function isConstructor(argument) {\n  if (!isCallable(argument)) return false;\n  switch (classof(argument)) {\n    case 'AsyncFunction':\n    case 'GeneratorFunction':\n    case 'AsyncGeneratorFunction': return false;\n  }\n  try {\n    // we can't check .prototype since constructors produced by .bind haven't it\n    // `Function#toString` throws on some built-it function in some legacy engines\n    // (for example, `DOMQuad` and similar in FF41-)\n    return INCORRECT_TO_STRING || !!exec(constructorRegExp, inspectSource(argument));\n  } catch (error) {\n    return true;\n  }\n};\n\nisConstructorLegacy.sham = true;\n\n// `IsConstructor` abstract operation\n// https://tc39.es/ecma262/#sec-isconstructor\nmodule.exports = !construct || fails(function () {\n  var called;\n  return isConstructorModern(isConstructorModern.call)\n    || !isConstructorModern(Object)\n    || !isConstructorModern(function () { called = true; })\n    || called;\n}) ? isConstructorLegacy : isConstructorModern;\n", "'use strict';\nvar isArray = require('../internals/is-array');\nvar isConstructor = require('../internals/is-constructor');\nvar isObject = require('../internals/is-object');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar SPECIES = wellKnownSymbol('species');\nvar $Array = Array;\n\n// a part of `ArraySpeciesCreate` abstract operation\n// https://tc39.es/ecma262/#sec-arrayspeciescreate\nmodule.exports = function (originalArray) {\n  var C;\n  if (isArray(originalArray)) {\n    C = originalArray.constructor;\n    // cross-realm fallback\n    if (isConstructor(C) && (C === $Array || isArray(C.prototype))) C = undefined;\n    else if (isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return C === undefined ? $Array : C;\n};\n", "'use strict';\nvar arraySpeciesConstructor = require('../internals/array-species-constructor');\n\n// `ArraySpeciesCreate` abstract operation\n// https://tc39.es/ecma262/#sec-arrayspeciescreate\nmodule.exports = function (originalArray, length) {\n  return new (arraySpeciesConstructor(originalArray))(length === 0 ? 0 : length);\n};\n", "'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://tc39.es/ecma262/#sec-array.prototype.flatmap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = lengthOfArrayLike(O);\n    var A;\n    aCallable(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n", "'use strict';\n// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flatMap');\n", "'use strict';\nrequire('../../modules/es.array.flat-map');\nrequire('../../modules/es.array.unscopables.flat-map');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'flatMap');\n", "'use strict';\nvar parent = require('../../es/array/flat-map');\n\nmodule.exports = parent;\n", "'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flat` method\n// https://tc39.es/ecma262/#sec-array.prototype.flat\n$({ target: 'Array', proto: true }, {\n  flat: function flat(/* depthArg = 1 */) {\n    var depthArg = arguments.length ? arguments[0] : undefined;\n    var O = toObject(this);\n    var sourceLen = lengthOfArrayLike(O);\n    var A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, depthArg === undefined ? 1 : toIntegerOrInfinity(depthArg));\n    return A;\n  }\n});\n", "'use strict';\n// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flat');\n", "'use strict';\nrequire('../../modules/es.array.flat');\nrequire('../../modules/es.array.unscopables.flat');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'flat');\n", "'use strict';\nvar parent = require('../../es/array/flat');\n\nmodule.exports = parent;\n", "'use strict';\nvar classof = require('../internals/classof');\n\nvar $String = String;\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw new TypeError('Cannot convert a Symbol value to a string');\n  return $String(argument);\n};\n", "'use strict';\nvar $ = require('../internals/export');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\n\nvar charAt = uncurryThis(''.charAt);\n\nvar FORCED = fails(function () {\n  // eslint-disable-next-line es/no-array-string-prototype-at -- safe\n  return '𠮷'.at(-2) !== '\\uD842';\n});\n\n// `String.prototype.at` method\n// https://tc39.es/ecma262/#sec-string.prototype.at\n$({ target: 'String', proto: true, forced: FORCED }, {\n  at: function at(index) {\n    var S = toString(requireObjectCoercible(this));\n    var len = S.length;\n    var relativeIndex = toIntegerOrInfinity(index);\n    var k = relativeIndex >= 0 ? relativeIndex : len + relativeIndex;\n    return (k < 0 || k >= len) ? undefined : charAt(S, k);\n  }\n});\n", "'use strict';\nrequire('../../modules/es.string.at-alternative');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('String', 'at');\n", "'use strict';\nvar parent = require('../../es/string/at');\n\nmodule.exports = parent;\n", "'use strict';\nvar anObject = require('../internals/an-object');\n\n// `RegExp.prototype.flags` getter implementation\n// https://tc39.es/ecma262/#sec-get-regexp.prototype.flags\nmodule.exports = function () {\n  var that = anObject(this);\n  var result = '';\n  if (that.hasIndices) result += 'd';\n  if (that.global) result += 'g';\n  if (that.ignoreCase) result += 'i';\n  if (that.multiline) result += 'm';\n  if (that.dotAll) result += 's';\n  if (that.unicode) result += 'u';\n  if (that.unicodeSets) result += 'v';\n  if (that.sticky) result += 'y';\n  return result;\n};\n", "'use strict';\nvar fails = require('../internals/fails');\nvar global = require('../internals/global');\n\n// babel-minify and Closure Compiler transpiles RegExp('a', 'y') -> /a/y and it causes SyntaxError\nvar $RegExp = global.RegExp;\n\nvar UNSUPPORTED_Y = fails(function () {\n  var re = $RegExp('a', 'y');\n  re.lastIndex = 2;\n  return re.exec('abcd') !== null;\n});\n\n// UC Browser bug\n// https://github.com/zloirock/core-js/issues/1008\nvar MISSED_STICKY = UNSUPPORTED_Y || fails(function () {\n  return !$RegExp('a', 'y').sticky;\n});\n\nvar BROKEN_CARET = UNSUPPORTED_Y || fails(function () {\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=773687\n  var re = $RegExp('^r', 'gy');\n  re.lastIndex = 2;\n  return re.exec('str') !== null;\n});\n\nmodule.exports = {\n  BROKEN_CARET: BROKEN_CARET,\n  MISSED_STICKY: MISSED_STICKY,\n  UNSUPPORTED_Y: UNSUPPORTED_Y\n};\n", "'use strict';\nvar fails = require('../internals/fails');\nvar global = require('../internals/global');\n\n// babel-minify and Closure Compiler transpiles RegExp('.', 's') -> /./s and it causes SyntaxError\nvar $RegExp = global.RegExp;\n\nmodule.exports = fails(function () {\n  var re = $RegExp('.', 's');\n  return !(re.dotAll && re.test('\\n') && re.flags === 's');\n});\n", "'use strict';\nvar fails = require('../internals/fails');\nvar global = require('../internals/global');\n\n// babel-minify and Closure Compiler transpiles RegExp('(?<a>b)', 'g') -> /(?<a>b)/g and it causes SyntaxError\nvar $RegExp = global.RegExp;\n\nmodule.exports = fails(function () {\n  var re = $RegExp('(?<a>b)', 'g');\n  return re.exec('b').groups.a !== 'b' ||\n    'b'.replace(re, '$<a>c') !== 'bc';\n});\n", "'use strict';\n/* eslint-disable regexp/no-empty-capturing-group, regexp/no-empty-group, regexp/no-lazy-ends -- testing */\n/* eslint-disable regexp/no-useless-quantifier -- testing */\nvar call = require('../internals/function-call');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar toString = require('../internals/to-string');\nvar regexpFlags = require('../internals/regexp-flags');\nvar stickyHelpers = require('../internals/regexp-sticky-helpers');\nvar shared = require('../internals/shared');\nvar create = require('../internals/object-create');\nvar getInternalState = require('../internals/internal-state').get;\nvar UNSUPPORTED_DOT_ALL = require('../internals/regexp-unsupported-dot-all');\nvar UNSUPPORTED_NCG = require('../internals/regexp-unsupported-ncg');\n\nvar nativeReplace = shared('native-string-replace', String.prototype.replace);\nvar nativeExec = RegExp.prototype.exec;\nvar patchedExec = nativeExec;\nvar charAt = uncurryThis(''.charAt);\nvar indexOf = uncurryThis(''.indexOf);\nvar replace = uncurryThis(''.replace);\nvar stringSlice = uncurryThis(''.slice);\n\nvar UPDATES_LAST_INDEX_WRONG = (function () {\n  var re1 = /a/;\n  var re2 = /b*/g;\n  call(nativeExec, re1, 'a');\n  call(nativeExec, re2, 'a');\n  return re1.lastIndex !== 0 || re2.lastIndex !== 0;\n})();\n\nvar UNSUPPORTED_Y = stickyHelpers.BROKEN_CARET;\n\n// nonparticipating capturing group, copied from es5-shim's String#split patch.\nvar NPCG_INCLUDED = /()??/.exec('')[1] !== undefined;\n\nvar PATCH = UPDATES_LAST_INDEX_WRONG || NPCG_INCLUDED || UNSUPPORTED_Y || UNSUPPORTED_DOT_ALL || UNSUPPORTED_NCG;\n\nif (PATCH) {\n  patchedExec = function exec(string) {\n    var re = this;\n    var state = getInternalState(re);\n    var str = toString(string);\n    var raw = state.raw;\n    var result, reCopy, lastIndex, match, i, object, group;\n\n    if (raw) {\n      raw.lastIndex = re.lastIndex;\n      result = call(patchedExec, raw, str);\n      re.lastIndex = raw.lastIndex;\n      return result;\n    }\n\n    var groups = state.groups;\n    var sticky = UNSUPPORTED_Y && re.sticky;\n    var flags = call(regexpFlags, re);\n    var source = re.source;\n    var charsAdded = 0;\n    var strCopy = str;\n\n    if (sticky) {\n      flags = replace(flags, 'y', '');\n      if (indexOf(flags, 'g') === -1) {\n        flags += 'g';\n      }\n\n      strCopy = stringSlice(str, re.lastIndex);\n      // Support anchored sticky behavior.\n      if (re.lastIndex > 0 && (!re.multiline || re.multiline && charAt(str, re.lastIndex - 1) !== '\\n')) {\n        source = '(?: ' + source + ')';\n        strCopy = ' ' + strCopy;\n        charsAdded++;\n      }\n      // ^(? + rx + ) is needed, in combination with some str slicing, to\n      // simulate the 'y' flag.\n      reCopy = new RegExp('^(?:' + source + ')', flags);\n    }\n\n    if (NPCG_INCLUDED) {\n      reCopy = new RegExp('^' + source + '$(?!\\\\s)', flags);\n    }\n    if (UPDATES_LAST_INDEX_WRONG) lastIndex = re.lastIndex;\n\n    match = call(nativeExec, sticky ? reCopy : re, strCopy);\n\n    if (sticky) {\n      if (match) {\n        match.input = stringSlice(match.input, charsAdded);\n        match[0] = stringSlice(match[0], charsAdded);\n        match.index = re.lastIndex;\n        re.lastIndex += match[0].length;\n      } else re.lastIndex = 0;\n    } else if (UPDATES_LAST_INDEX_WRONG && match) {\n      re.lastIndex = re.global ? match.index + match[0].length : lastIndex;\n    }\n    if (NPCG_INCLUDED && match && match.length > 1) {\n      // Fix browsers whose `exec` methods don't consistently return `undefined`\n      // for NPCG, like IE8. NOTE: This doesn't work for /(.?)?/\n      call(nativeReplace, match[0], reCopy, function () {\n        for (i = 1; i < arguments.length - 2; i++) {\n          if (arguments[i] === undefined) match[i] = undefined;\n        }\n      });\n    }\n\n    if (match && groups) {\n      match.groups = object = create(null);\n      for (i = 0; i < groups.length; i++) {\n        group = groups[i];\n        object[group[0]] = match[group[1]];\n      }\n    }\n\n    return match;\n  };\n}\n\nmodule.exports = patchedExec;\n", "'use strict';\nvar $ = require('../internals/export');\nvar exec = require('../internals/regexp-exec');\n\n// `RegExp.prototype.exec` method\n// https://tc39.es/ecma262/#sec-regexp.prototype.exec\n$({ target: 'RegExp', proto: true, forced: /./.exec !== exec }, {\n  exec: exec\n});\n", "'use strict';\nvar NATIVE_BIND = require('../internals/function-bind-native');\n\nvar FunctionPrototype = Function.prototype;\nvar apply = FunctionPrototype.apply;\nvar call = FunctionPrototype.call;\n\n// eslint-disable-next-line es/no-reflect -- safe\nmodule.exports = typeof Reflect == 'object' && Reflect.apply || (NATIVE_BIND ? call.bind(apply) : function () {\n  return call.apply(apply, arguments);\n});\n", "'use strict';\n// TODO: Remove from `core-js@4` since it's moved to entry points\nrequire('../modules/es.regexp.exec');\nvar call = require('../internals/function-call');\nvar defineBuiltIn = require('../internals/define-built-in');\nvar regexpExec = require('../internals/regexp-exec');\nvar fails = require('../internals/fails');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\n\nvar SPECIES = wellKnownSymbol('species');\nvar RegExpPrototype = RegExp.prototype;\n\nmodule.exports = function (KEY, exec, FORCED, SHAM) {\n  var SYMBOL = wellKnownSymbol(KEY);\n\n  var DELEGATES_TO_SYMBOL = !fails(function () {\n    // String methods call symbol-named RegExp methods\n    var O = {};\n    O[SYMBOL] = function () { return 7; };\n    return ''[KEY](O) !== 7;\n  });\n\n  var DELEGATES_TO_EXEC = DELEGATES_TO_SYMBOL && !fails(function () {\n    // Symbol-named RegExp methods call .exec\n    var execCalled = false;\n    var re = /a/;\n\n    if (KEY === 'split') {\n      // We can't use real regex here since it causes deoptimization\n      // and serious performance degradation in V8\n      // https://github.com/zloirock/core-js/issues/306\n      re = {};\n      // RegExp[@@split] doesn't call the regex's exec method, but first creates\n      // a new one. We need to return the patched regex when creating the new one.\n      re.constructor = {};\n      re.constructor[SPECIES] = function () { return re; };\n      re.flags = '';\n      re[SYMBOL] = /./[SYMBOL];\n    }\n\n    re.exec = function () {\n      execCalled = true;\n      return null;\n    };\n\n    re[SYMBOL]('');\n    return !execCalled;\n  });\n\n  if (\n    !DELEGATES_TO_SYMBOL ||\n    !DELEGATES_TO_EXEC ||\n    FORCED\n  ) {\n    var nativeRegExpMethod = /./[SYMBOL];\n    var methods = exec(SYMBOL, ''[KEY], function (nativeMethod, regexp, str, arg2, forceStringMethod) {\n      var $exec = regexp.exec;\n      if ($exec === regexpExec || $exec === RegExpPrototype.exec) {\n        if (DELEGATES_TO_SYMBOL && !forceStringMethod) {\n          // The native String method already delegates to @@method (this\n          // polyfilled function), leasing to infinite recursion.\n          // We avoid it by directly calling the native @@method method.\n          return { done: true, value: call(nativeRegExpMethod, regexp, str, arg2) };\n        }\n        return { done: true, value: call(nativeMethod, str, regexp, arg2) };\n      }\n      return { done: false };\n    });\n\n    defineBuiltIn(String.prototype, KEY, methods[0]);\n    defineBuiltIn(RegExpPrototype, SYMBOL, methods[1]);\n  }\n\n  if (SHAM) createNonEnumerableProperty(RegExpPrototype[SYMBOL], 'sham', true);\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar toString = require('../internals/to-string');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar charAt = uncurryThis(''.charAt);\nvar charCodeAt = uncurryThis(''.charCodeAt);\nvar stringSlice = uncurryThis(''.slice);\n\nvar createMethod = function (CONVERT_TO_STRING) {\n  return function ($this, pos) {\n    var S = toString(requireObjectCoercible($this));\n    var position = toIntegerOrInfinity(pos);\n    var size = S.length;\n    var first, second;\n    if (position < 0 || position >= size) return CONVERT_TO_STRING ? '' : undefined;\n    first = charCodeAt(S, position);\n    return first < 0xD800 || first > 0xDBFF || position + 1 === size\n      || (second = charCodeAt(S, position + 1)) < 0xDC00 || second > 0xDFFF\n        ? CONVERT_TO_STRING\n          ? charAt(S, position)\n          : first\n        : CONVERT_TO_STRING\n          ? stringSlice(S, position, position + 2)\n          : (first - 0xD800 << 10) + (second - 0xDC00) + 0x10000;\n  };\n};\n\nmodule.exports = {\n  // `String.prototype.codePointAt` method\n  // https://tc39.es/ecma262/#sec-string.prototype.codepointat\n  codeAt: createMethod(false),\n  // `String.prototype.at` method\n  // https://github.com/mathiasbynens/String.prototype.at\n  charAt: createMethod(true)\n};\n", "'use strict';\nvar charAt = require('../internals/string-multibyte').charAt;\n\n// `AdvanceStringIndex` abstract operation\n// https://tc39.es/ecma262/#sec-advancestringindex\nmodule.exports = function (S, index, unicode) {\n  return index + (unicode ? charAt(S, index).length : 1);\n};\n", "'use strict';\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar toObject = require('../internals/to-object');\n\nvar floor = Math.floor;\nvar charAt = uncurryThis(''.charAt);\nvar replace = uncurryThis(''.replace);\nvar stringSlice = uncurryThis(''.slice);\n// eslint-disable-next-line redos/no-vulnerable -- safe\nvar SUBSTITUTION_SYMBOLS = /\\$([$&'`]|\\d{1,2}|<[^>]*>)/g;\nvar SUBSTITUTION_SYMBOLS_NO_NAMED = /\\$([$&'`]|\\d{1,2})/g;\n\n// `GetSubstitution` abstract operation\n// https://tc39.es/ecma262/#sec-getsubstitution\nmodule.exports = function (matched, str, position, captures, namedCaptures, replacement) {\n  var tailPos = position + matched.length;\n  var m = captures.length;\n  var symbols = SUBSTITUTION_SYMBOLS_NO_NAMED;\n  if (namedCaptures !== undefined) {\n    namedCaptures = toObject(namedCaptures);\n    symbols = SUBSTITUTION_SYMBOLS;\n  }\n  return replace(replacement, symbols, function (match, ch) {\n    var capture;\n    switch (charAt(ch, 0)) {\n      case '$': return '$';\n      case '&': return matched;\n      case '`': return stringSlice(str, 0, position);\n      case \"'\": return stringSlice(str, tailPos);\n      case '<':\n        capture = namedCaptures[stringSlice(ch, 1, -1)];\n        break;\n      default: // \\d\\d?\n        var n = +ch;\n        if (n === 0) return match;\n        if (n > m) {\n          var f = floor(n / 10);\n          if (f === 0) return match;\n          if (f <= m) return captures[f - 1] === undefined ? charAt(ch, 1) : captures[f - 1] + charAt(ch, 1);\n          return match;\n        }\n        capture = captures[n - 1];\n    }\n    return capture === undefined ? '' : capture;\n  });\n};\n", "'use strict';\nvar call = require('../internals/function-call');\nvar anObject = require('../internals/an-object');\nvar isCallable = require('../internals/is-callable');\nvar classof = require('../internals/classof-raw');\nvar regexpExec = require('../internals/regexp-exec');\n\nvar $TypeError = TypeError;\n\n// `RegExpExec` abstract operation\n// https://tc39.es/ecma262/#sec-regexpexec\nmodule.exports = function (R, S) {\n  var exec = R.exec;\n  if (isCallable(exec)) {\n    var result = call(exec, R, S);\n    if (result !== null) anObject(result);\n    return result;\n  }\n  if (classof(R) === 'RegExp') return call(regexpExec, R, S);\n  throw new $TypeError('RegExp#exec called on incompatible receiver');\n};\n", "'use strict';\nvar apply = require('../internals/function-apply');\nvar call = require('../internals/function-call');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fixRegExpWellKnownSymbolLogic = require('../internals/fix-regexp-well-known-symbol-logic');\nvar fails = require('../internals/fails');\nvar anObject = require('../internals/an-object');\nvar isCallable = require('../internals/is-callable');\nvar isNullOrUndefined = require('../internals/is-null-or-undefined');\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar toLength = require('../internals/to-length');\nvar toString = require('../internals/to-string');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar advanceStringIndex = require('../internals/advance-string-index');\nvar getMethod = require('../internals/get-method');\nvar getSubstitution = require('../internals/get-substitution');\nvar regExpExec = require('../internals/regexp-exec-abstract');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar REPLACE = wellKnownSymbol('replace');\nvar max = Math.max;\nvar min = Math.min;\nvar concat = uncurryThis([].concat);\nvar push = uncurryThis([].push);\nvar stringIndexOf = uncurryThis(''.indexOf);\nvar stringSlice = uncurryThis(''.slice);\n\nvar maybeToString = function (it) {\n  return it === undefined ? it : String(it);\n};\n\n// IE <= 11 replaces $0 with the whole match, as if it was $&\n// https://stackoverflow.com/questions/6024666/getting-ie-to-replace-a-regex-with-the-literal-string-0\nvar REPLACE_KEEPS_$0 = (function () {\n  // eslint-disable-next-line regexp/prefer-escape-replacement-dollar-char -- required for testing\n  return 'a'.replace(/./, '$0') === '$0';\n})();\n\n// Safari <= 13.0.3(?) substitutes nth capture where n>m with an empty string\nvar REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE = (function () {\n  if (/./[REPLACE]) {\n    return /./[REPLACE]('a', '$0') === '';\n  }\n  return false;\n})();\n\nvar REPLACE_SUPPORTS_NAMED_GROUPS = !fails(function () {\n  var re = /./;\n  re.exec = function () {\n    var result = [];\n    result.groups = { a: '7' };\n    return result;\n  };\n  // eslint-disable-next-line regexp/no-useless-dollar-replacements -- false positive\n  return ''.replace(re, '$<a>') !== '7';\n});\n\n// @@replace logic\nfixRegExpWellKnownSymbolLogic('replace', function (_, nativeReplace, maybeCallNative) {\n  var UNSAFE_SUBSTITUTE = REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE ? '$' : '$0';\n\n  return [\n    // `String.prototype.replace` method\n    // https://tc39.es/ecma262/#sec-string.prototype.replace\n    function replace(searchValue, replaceValue) {\n      var O = requireObjectCoercible(this);\n      var replacer = isNullOrUndefined(searchValue) ? undefined : getMethod(searchValue, REPLACE);\n      return replacer\n        ? call(replacer, searchValue, O, replaceValue)\n        : call(nativeReplace, toString(O), searchValue, replaceValue);\n    },\n    // `RegExp.prototype[@@replace]` method\n    // https://tc39.es/ecma262/#sec-regexp.prototype-@@replace\n    function (string, replaceValue) {\n      var rx = anObject(this);\n      var S = toString(string);\n\n      if (\n        typeof replaceValue == 'string' &&\n        stringIndexOf(replaceValue, UNSAFE_SUBSTITUTE) === -1 &&\n        stringIndexOf(replaceValue, '$<') === -1\n      ) {\n        var res = maybeCallNative(nativeReplace, rx, S, replaceValue);\n        if (res.done) return res.value;\n      }\n\n      var functionalReplace = isCallable(replaceValue);\n      if (!functionalReplace) replaceValue = toString(replaceValue);\n\n      var global = rx.global;\n      var fullUnicode;\n      if (global) {\n        fullUnicode = rx.unicode;\n        rx.lastIndex = 0;\n      }\n\n      var results = [];\n      var result;\n      while (true) {\n        result = regExpExec(rx, S);\n        if (result === null) break;\n\n        push(results, result);\n        if (!global) break;\n\n        var matchStr = toString(result[0]);\n        if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n      }\n\n      var accumulatedResult = '';\n      var nextSourcePosition = 0;\n      for (var i = 0; i < results.length; i++) {\n        result = results[i];\n\n        var matched = toString(result[0]);\n        var position = max(min(toIntegerOrInfinity(result.index), S.length), 0);\n        var captures = [];\n        var replacement;\n        // NOTE: This is equivalent to\n        //   captures = result.slice(1).map(maybeToString)\n        // but for some reason `nativeSlice.call(result, 1, result.length)` (called in\n        // the slice polyfill when slicing native arrays) \"doesn't work\" in safari 9 and\n        // causes a crash (https://pastebin.com/N21QzeQA) when trying to debug it.\n        for (var j = 1; j < result.length; j++) push(captures, maybeToString(result[j]));\n        var namedCaptures = result.groups;\n        if (functionalReplace) {\n          var replacerArgs = concat([matched], captures, position, S);\n          if (namedCaptures !== undefined) push(replacerArgs, namedCaptures);\n          replacement = toString(apply(replaceValue, undefined, replacerArgs));\n        } else {\n          replacement = getSubstitution(matched, S, position, captures, namedCaptures, replaceValue);\n        }\n        if (position >= nextSourcePosition) {\n          accumulatedResult += stringSlice(S, nextSourcePosition, position) + replacement;\n          nextSourcePosition = position + matched.length;\n        }\n      }\n\n      return accumulatedResult + stringSlice(S, nextSourcePosition);\n    }\n  ];\n}, !REPLACE_SUPPORTS_NAMED_GROUPS || !REPLACE_KEEPS_$0 || REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE);\n", "'use strict';\nvar isObject = require('../internals/is-object');\nvar classof = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar MATCH = wellKnownSymbol('match');\n\n// `IsRegExp` abstract operation\n// https://tc39.es/ecma262/#sec-isregexp\nmodule.exports = function (it) {\n  var isRegExp;\n  return isObject(it) && ((isRegExp = it[MATCH]) !== undefined ? !!isRegExp : classof(it) === 'RegExp');\n};\n", "'use strict';\nvar call = require('../internals/function-call');\nvar hasOwn = require('../internals/has-own-property');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar regExpFlags = require('../internals/regexp-flags');\n\nvar RegExpPrototype = RegExp.prototype;\n\nmodule.exports = function (R) {\n  var flags = R.flags;\n  return flags === undefined && !('flags' in RegExpPrototype) && !hasOwn(R, 'flags') && isPrototypeOf(RegExpPrototype, R)\n    ? call(regExpFlags, R) : flags;\n};\n", "'use strict';\nvar $ = require('../internals/export');\nvar call = require('../internals/function-call');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar isCallable = require('../internals/is-callable');\nvar isNullOrUndefined = require('../internals/is-null-or-undefined');\nvar isRegExp = require('../internals/is-regexp');\nvar toString = require('../internals/to-string');\nvar getMethod = require('../internals/get-method');\nvar getRegExpFlags = require('../internals/regexp-get-flags');\nvar getSubstitution = require('../internals/get-substitution');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar IS_PURE = require('../internals/is-pure');\n\nvar REPLACE = wellKnownSymbol('replace');\nvar $TypeError = TypeError;\nvar indexOf = uncurryThis(''.indexOf);\nvar replace = uncurryThis(''.replace);\nvar stringSlice = uncurryThis(''.slice);\nvar max = Math.max;\n\n// `String.prototype.replaceAll` method\n// https://tc39.es/ecma262/#sec-string.prototype.replaceall\n$({ target: 'String', proto: true }, {\n  replaceAll: function replaceAll(searchValue, replaceValue) {\n    var O = requireObjectCoercible(this);\n    var IS_REG_EXP, flags, replacer, string, searchString, functionalReplace, searchLength, advanceBy, replacement;\n    var position = 0;\n    var endOfLastMatch = 0;\n    var result = '';\n    if (!isNullOrUndefined(searchValue)) {\n      IS_REG_EXP = isRegExp(searchValue);\n      if (IS_REG_EXP) {\n        flags = toString(requireObjectCoercible(getRegExpFlags(searchValue)));\n        if (!~indexOf(flags, 'g')) throw new $TypeError('`.replaceAll` does not allow non-global regexes');\n      }\n      replacer = getMethod(searchValue, REPLACE);\n      if (replacer) {\n        return call(replacer, searchValue, O, replaceValue);\n      } else if (IS_PURE && IS_REG_EXP) {\n        return replace(toString(O), searchValue, replaceValue);\n      }\n    }\n    string = toString(O);\n    searchString = toString(searchValue);\n    functionalReplace = isCallable(replaceValue);\n    if (!functionalReplace) replaceValue = toString(replaceValue);\n    searchLength = searchString.length;\n    advanceBy = max(1, searchLength);\n    position = indexOf(string, searchString);\n    while (position !== -1) {\n      replacement = functionalReplace\n        ? toString(replaceValue(searchString, position, string))\n        : getSubstitution(searchString, string, position, [], undefined, replaceValue);\n      result += stringSlice(string, endOfLastMatch, position) + replacement;\n      endOfLastMatch = position + searchLength;\n      position = position + advanceBy > string.length ? -1 : indexOf(string, searchString, position + advanceBy);\n    }\n    if (endOfLastMatch < string.length) {\n      result += stringSlice(string, endOfLastMatch);\n    }\n    return result;\n  }\n});\n", "'use strict';\nrequire('../../modules/es.regexp.exec');\nrequire('../../modules/es.string.replace');\nrequire('../../modules/es.string.replace-all');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('String', 'replaceAll');\n", "'use strict';\nvar parent = require('../../es/string/replace-all');\n\nmodule.exports = parent;\n", "// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.5\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n} else if( typeof angular !== 'undefined' && angular != null ) {\n  angular.module('LZString', [])\n  .factory('LZString', function () {\n    return LZString;\n  });\n}\n", "/** @public */\nexport type TLTypeFace = {\n\turl: string\n\tdisplay?: any // FontDisplay\n\tfeatureSettings?: string\n\tstretch?: string\n\tstyle?: string\n\tunicodeRange?: string\n\tvariant?: string\n\tweight?: string\n\tformat?: string\n}\n\n/** @public */\nexport async function preloadFont(id: string, font: TLTypeFace) {\n\tconst {\n\t\turl,\n\t\tstyle = 'normal',\n\t\tweight = '500',\n\t\tdisplay,\n\t\tfeatureSettings,\n\t\tstretch,\n\t\tunicodeRange,\n\t\tvariant,\n\t\tformat,\n\t} = font\n\n\tconst descriptors: FontFaceDescriptors = {\n\t\tstyle,\n\t\tweight,\n\t\tdisplay,\n\t\tfeatureSettings,\n\t\tstretch,\n\t\tunicodeRange,\n\t\t// @ts-expect-error why is this here\n\t\tvariant,\n\t}\n\n\tconst fontInstance = new FontFace(id, `url(${url})`, descriptors)\n\tawait fontInstance.load()\n\tdocument.fonts.add(fontInstance)\n\n\t// @ts-expect-error\n\tfontInstance.$$_url = url\n\n\t// @ts-expect-error\n\tfontInstance.$$_fontface = `\n@font-face {\n\tfont-family: ${fontInstance.family};\n\tfont-stretch: ${fontInstance.stretch};\n\tfont-weight: ${fontInstance.weight};\n\tfont-style: ${fontInstance.style};\n\tsrc: url(\"${url}\") format(\"${format}\")\n}`\n\n\treturn fontInstance\n}\n", "import { Child, Signal } from './types'\n\n/**\n * Get whether the given value is a child.\n *\n * @param x The value to check.\n * @returns True if the value is a child, false otherwise.\n */\nfunction isChild(x: any): x is Child {\n\treturn x && typeof x === 'object' && 'parents' in x\n}\n\n/**\n * Get whether a child's parents have changed.\n *\n * @param child The child to check.\n * @returns True if the child's parents have changed, false otherwise.\n */\nexport function haveParentsChanged(child: Child) {\n\tfor (let i = 0, n = child.parents.length; i < n; i++) {\n\t\t// Get the parent's value without capturing it.\n\t\tchild.parents[i].__unsafe__getWithoutCapture(true)\n\n\t\t// If the parent's epoch does not match the child's view of the parent's epoch, then the parent has changed.\n\t\tif (child.parents[i].lastChangedEpoch !== child.parentEpochs[i]) {\n\t\t\treturn true\n\t\t}\n\t}\n\n\treturn false\n}\n\n/**\n * Detach a child from a parent.\n *\n * @param parent The parent to detach from.\n * @param child The child to detach.\n */\nexport const detach = (parent: Signal<any>, child: Child) => {\n\t// If the child is not attached to the parent, do nothing.\n\tif (!parent.children.remove(child)) {\n\t\treturn\n\t}\n\n\t// If the parent has no more children, then detach the parent from its parents.\n\tif (parent.children.isEmpty && isChild(parent)) {\n\t\tfor (let i = 0, n = parent.parents.length; i < n; i++) {\n\t\t\tdetach(parent.parents[i], parent)\n\t\t}\n\t}\n}\n\n/**\n * Attach a child to a parent.\n *\n * @param parent The parent to attach to.\n * @param child The child to attach.\n */\nexport const attach = (parent: Signal<any>, child: Child) => {\n\t// If the child is already attached to the parent, do nothing.\n\tif (!parent.children.add(child)) {\n\t\treturn\n\t}\n\n\t// If the parent itself is a child, add the parent to the parent's parents.\n\tif (isChild(parent)) {\n\t\tfor (let i = 0, n = parent.parents.length; i < n; i++) {\n\t\t\tattach(parent.parents[i], parent)\n\t\t}\n\t}\n}\n\n/**\n * Get whether two values are equal (insofar as @tldraw/state is concerned).\n *\n * @param a The first value.\n * @param b The second value.\n */\nexport function equals(a: any, b: any): boolean {\n\tconst shallowEquals =\n\t\ta === b || Object.is(a, b) || Boolean(a && b && typeof a.equals === 'function' && a.equals(b))\n\treturn shallowEquals\n}\n\nexport declare function assertNever(x: never): never\n\nexport function singleton<T>(key: string, init: () => T): T {\n\tconst symbol = Symbol.for(`com.tldraw.state/${key}`)\n\tconst global = globalThis as any\n\tglobal[symbol] ??= init()\n\treturn global[symbol]\n}\n\n/**\n * @public\n */\nexport const EMPTY_ARRAY: [] = singleton('empty_array', () => Object.freeze([]) as any)\n", "// The maximum size for an array in an ArraySet\nexport const ARRAY_SIZE_THRESHOLD = 8\n\n/**\n * An ArraySet operates as an array until it reaches a certain size, after which a Set is used\n * instead. In either case, the same methods are used to get, set, remove, and visit the items.\n * @internal\n */\nexport class ArraySet<T> {\n\tprivate arraySize = 0\n\n\tprivate array: (T | undefined)[] | null = Array(ARRAY_SIZE_THRESHOLD)\n\n\tprivate set: Set<T> | null = null\n\n\t/**\n\t * Get whether this ArraySet has any elements.\n\t *\n\t * @returns True if this ArraySet has any elements, false otherwise.\n\t */\n\t// eslint-disable-next-line no-restricted-syntax\n\tget isEmpty() {\n\t\tif (this.array) {\n\t\t\treturn this.arraySize === 0\n\t\t}\n\n\t\tif (this.set) {\n\t\t\treturn this.set.size === 0\n\t\t}\n\n\t\tthrow new Error('no set or array')\n\t}\n\n\t/**\n\t * Add an item to the ArraySet if it is not already present.\n\t *\n\t * @param elem - The element to add.\n\t */\n\n\tadd(elem: T) {\n\t\tif (this.array) {\n\t\t\tconst idx = this.array.indexOf(elem)\n\n\t\t\t// Return false if the element is already in the array.\n\t\t\tif (idx !== -1) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tif (this.arraySize < ARRAY_SIZE_THRESHOLD) {\n\t\t\t\t// If the array is below the size threshold, push items into the array.\n\n\t\t\t\t// Insert the element into the array's next available slot.\n\t\t\t\tthis.array[this.arraySize] = elem\n\t\t\t\tthis.arraySize++\n\n\t\t\t\treturn true\n\t\t\t} else {\n\t\t\t\t// If the array is full, convert it to a set and remove the array.\n\t\t\t\tthis.set = new Set(this.array as any)\n\t\t\t\tthis.array = null\n\t\t\t\tthis.set.add(elem)\n\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\n\t\tif (this.set) {\n\t\t\t// Return false if the element is already in the set.\n\t\t\tif (this.set.has(elem)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tthis.set.add(elem)\n\t\t\treturn true\n\t\t}\n\n\t\tthrow new Error('no set or array')\n\t}\n\n\t/**\n\t * Remove an item from the ArraySet if it is present.\n\t *\n\t * @param elem - The element to remove\n\t */\n\tremove(elem: T) {\n\t\tif (this.array) {\n\t\t\tconst idx = this.array.indexOf(elem)\n\n\t\t\t// If the item is not in the array, return false.\n\t\t\tif (idx === -1) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tthis.array[idx] = undefined\n\t\t\tthis.arraySize--\n\n\t\t\tif (idx !== this.arraySize) {\n\t\t\t\t// If the item is not the last item in the array, move the last item into the\n\t\t\t\t// removed item's slot.\n\t\t\t\tthis.array[idx] = this.array[this.arraySize]\n\t\t\t\tthis.array[this.arraySize] = undefined\n\t\t\t}\n\n\t\t\treturn true\n\t\t}\n\n\t\tif (this.set) {\n\t\t\t// If the item is not in the set, return false.\n\t\t\tif (!this.set.has(elem)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tthis.set.delete(elem)\n\n\t\t\treturn true\n\t\t}\n\n\t\tthrow new Error('no set or array')\n\t}\n\n\t/**\n\t * Run a callback for each element in the ArraySet.\n\t *\n\t * @param visitor - The callback to run for each element.\n\t */\n\tvisit(visitor: (item: T) => void) {\n\t\tif (this.array) {\n\t\t\tfor (let i = 0; i < this.arraySize; i++) {\n\t\t\t\tconst elem = this.array[i]\n\n\t\t\t\tif (typeof elem !== 'undefined') {\n\t\t\t\t\tvisitor(elem)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn\n\t\t}\n\n\t\tif (this.set) {\n\t\t\tthis.set.forEach(visitor)\n\n\t\t\treturn\n\t\t}\n\n\t\tthrow new Error('no set or array')\n\t}\n\n\thas(elem: T) {\n\t\tif (this.array) {\n\t\t\treturn this.array.indexOf(elem) !== -1\n\t\t} else {\n\t\t\treturn this.set!.has(elem)\n\t\t}\n\t}\n\n\tclear() {\n\t\tif (this.set) {\n\t\t\tthis.set.clear()\n\t\t} else {\n\t\t\tthis.arraySize = 0\n\t\t\tthis.array = []\n\t\t}\n\t}\n\n\tsize() {\n\t\tif (this.set) {\n\t\t\treturn this.set.size\n\t\t} else {\n\t\t\treturn this.arraySize\n\t\t}\n\t}\n}\n", "import { ArraySet } from './ArraySet'\n\n/** @public */\nexport const RESET_VALUE: unique symbol = Symbol.for('com.tldraw.state/RESET_VALUE')\n\n/** @public */\nexport type RESET_VALUE = typeof RESET_VALUE\n\n/**\n * A Signal is a reactive value container. The value may change over time, and it may keep track of the diffs between sequential values.\n *\n * There are two types of signal:\n *\n * - Atomic signals, created using [[atom]]. These are mutable references to values that can be changed using [[Atom.set]].\n * - Computed signals, created using [[computed]]. These are values that are computed from other signals. They are recomputed lazily if their dependencies change.\n *\n * @public\n */\nexport interface Signal<Value, Diff = unknown> {\n\t/**\n\t * The name of the signal. This is used at runtime for debugging and perf profiling only. It does not need to be globally unique.\n\t */\n\tname: string\n\t/**\n\t * The current value of the signal. This is a reactive value, and will update when the signal changes.\n\t * Any computed signal that depends on this signal will be lazily recomputed if this signal changes.\n\t * Any effect that depends on this signal will be rescheduled if this signal changes.\n\t */\n\tget(): Value\n\n\t/**\n\t * The epoch when this signal's value last changed. Note tha this is not the same as when the value was last computed.\n\t * A signal may recopmute it's value without changing it.\n\t */\n\tlastChangedEpoch: number\n\t/**\n\t * Returns the sequence of diffs between the the value at the given epoch and the current value.\n\t * Returns the [[RESET_VALUE]] constant if there is not enough information to compute the diff sequence.\n\t * @param epoch - The epoch to get diffs since.\n\t */\n\tgetDiffSince(epoch: number): RESET_VALUE | Diff[]\n\t/**\n\t * Returns the current value of the signal without capturing it as a dependency.\n\t * Use this if you need to retrieve the signal's value in a hot loop where the performance overhead of dependency tracking is too high.\n\t */\n\t__unsafe__getWithoutCapture(ignoreErrors?: boolean): Value\n\t/** @internal */\n\tchildren: ArraySet<Child>\n}\n\n/** @internal */\nexport type Child = {\n\tlastTraversedEpoch: number\n\treadonly parentSet: ArraySet<Signal<any, any>>\n\treadonly parents: Signal<any, any>[]\n\treadonly parentEpochs: number[]\n\tisActivelyListening: boolean\n}\n\n/**\n * Computes the diff between the previous and current value.\n *\n * If the diff cannot be computed for whatever reason, it should return [[RESET_VALUE]].\n *\n * @public\n */\nexport type ComputeDiff<Value, Diff> = (\n\tpreviousValue: Value,\n\tcurrentValue: Value,\n\tlastComputedEpoch: number,\n\tcurrentEpoch: number\n) => Diff | RESET_VALUE\n", "import { RESET_VALUE } from './types'\n\ntype RangeTuple<Diff> = [fromEpoch: number, toEpoch: number, diff: Diff]\n\n/**\n * A structure that stores diffs between values of an atom.\n *\n * @internal\n */\nexport class HistoryBuffer<Diff> {\n\tprivate index = 0\n\n\t// use a wrap around buffer to store the last N values\n\tbuffer: Array<RangeTuple<Diff> | undefined>\n\n\tconstructor(private readonly capacity: number) {\n\t\tthis.buffer = new Array(capacity)\n\t}\n\n\t/**\n\t * Add a diff to the history buffer.\n\t *\n\t * @param lastComputedEpoch - The epoch when the diff was computed.\n\t * @param currentEpoch - The current epoch.\n\t * @param diff - The diff to add, or else a reset value.\n\t */\n\tpushEntry(lastComputedEpoch: number, currentEpoch: number, diff: Diff | RESET_VALUE) {\n\t\tif (diff === undefined) {\n\t\t\treturn\n\t\t}\n\n\t\tif (diff === RESET_VALUE) {\n\t\t\tthis.clear()\n\t\t\treturn\n\t\t}\n\n\t\t// Add the diff to the buffer as a range tuple.\n\t\tthis.buffer[this.index] = [lastComputedEpoch, currentEpoch, diff]\n\n\t\t// Bump the index, wrapping around if necessary.\n\t\tthis.index = (this.index + 1) % this.capacity\n\t}\n\n\t/**\n\t * Clear the history buffer.\n\t */\n\tclear() {\n\t\tthis.index = 0\n\t\tthis.buffer.fill(undefined)\n\t}\n\n\t/**\n\t * Get the diffs since the given epoch.\n\t *\n\t * @param epoch - The epoch to get diffs since.\n\t * @returns An array of diffs or a flag to reset the history buffer.\n\t */\n\tgetChangesSince(sinceEpoch: number): RESET_VALUE | Diff[] {\n\t\tconst { index, capacity, buffer } = this\n\n\t\t// For each item in the buffer...\n\t\tfor (let i = 0; i < capacity; i++) {\n\t\t\tconst offset = (index - 1 + capacity - i) % capacity\n\n\t\t\tconst elem = buffer[offset]\n\n\t\t\t// If there's no element in the offset position, return the reset value\n\t\t\tif (!elem) {\n\t\t\t\treturn RESET_VALUE\n\t\t\t}\n\n\t\t\tconst [fromEpoch, toEpoch] = elem\n\n\t\t\t// If the first element is already too early, bail\n\t\t\tif (i === 0 && sinceEpoch >= toEpoch) {\n\t\t\t\treturn []\n\t\t\t}\n\n\t\t\t// If the element is since the given epoch, return an array with all diffs from this element and all following elements\n\t\t\tif (fromEpoch <= sinceEpoch && sinceEpoch < toEpoch) {\n\t\t\t\tconst len = i + 1\n\t\t\t\tconst result = new Array(len)\n\n\t\t\t\tfor (let j = 0; j < len; j++) {\n\t\t\t\t\tresult[j] = buffer[(offset + j) % capacity]![2]\n\t\t\t\t}\n\n\t\t\t\treturn result\n\t\t\t}\n\t\t}\n\n\t\t// If we haven't returned yet, return the reset value\n\t\treturn RESET_VALUE\n\t}\n}\n", "import { attach, detach, singleton } from './helpers'\nimport type { Child, Signal } from './types'\n\nclass CaptureStackFrame {\n\toffset = 0\n\n\tmaybeRemoved?: Signal<any>[]\n\n\tconstructor(\n\t\tpublic readonly below: CaptureStackFrame | null,\n\t\tpublic readonly child: Child\n\t) {}\n}\n\nconst inst = singleton('capture', () => ({ stack: null as null | CaptureStackFrame }))\n\n/**\n * Executes the given function without capturing any parents in the current capture context.\n *\n * This is mainly useful if you want to run an effect only when certain signals change while also\n * dereferencing other signals which should not cause the effect to rerun on their own.\n *\n * @example\n * ```ts\n * const name = atom('name', 'Sam')\n * const time = atom('time', () => new Date().getTime())\n *\n * setInterval(() => {\n *   time.set(new Date().getTime())\n * })\n *\n * react('log name changes', () => {\n * \t print(name.get(), 'was changed at', unsafe__withoutCapture(() => time.get()))\n * })\n *\n * ```\n *\n * @public\n */\nexport function unsafe__withoutCapture<T>(fn: () => T): T {\n\tconst oldStack = inst.stack\n\tinst.stack = null\n\ttry {\n\t\treturn fn()\n\t} finally {\n\t\tinst.stack = oldStack\n\t}\n}\n\nexport function startCapturingParents(child: Child) {\n\tinst.stack = new CaptureStackFrame(inst.stack, child)\n\tchild.parentSet.clear()\n}\n\nexport function stopCapturingParents() {\n\tconst frame = inst.stack!\n\tinst.stack = frame.below\n\n\tif (frame.offset < frame.child.parents.length) {\n\t\tfor (let i = frame.offset; i < frame.child.parents.length; i++) {\n\t\t\tconst maybeRemovedParent = frame.child.parents[i]\n\t\t\tif (!frame.child.parentSet.has(maybeRemovedParent)) {\n\t\t\t\tdetach(maybeRemovedParent, frame.child)\n\t\t\t}\n\t\t}\n\n\t\tframe.child.parents.length = frame.offset\n\t\tframe.child.parentEpochs.length = frame.offset\n\t}\n\n\tif (frame.maybeRemoved) {\n\t\tfor (let i = 0; i < frame.maybeRemoved.length; i++) {\n\t\t\tconst maybeRemovedParent = frame.maybeRemoved[i]\n\t\t\tif (!frame.child.parentSet.has(maybeRemovedParent)) {\n\t\t\t\tdetach(maybeRemovedParent, frame.child)\n\t\t\t}\n\t\t}\n\t}\n}\n\n// this must be called after the parent is up to date\nexport function maybeCaptureParent(p: Signal<any, any>) {\n\tif (inst.stack) {\n\t\tconst wasCapturedAlready = inst.stack.child.parentSet.has(p)\n\t\t// if the child didn't deref this parent last time it executed, then idx will be -1\n\t\t// if the child did deref this parent last time but in a different order relative to other parents, then idx will be greater than stack.offset\n\t\t// if the child did deref this parent last time in the same order, then idx will be the same as stack.offset\n\t\t// if the child did deref this parent already during this capture session then 0 <= idx < stack.offset\n\n\t\tif (wasCapturedAlready) {\n\t\t\treturn\n\t\t}\n\n\t\tinst.stack.child.parentSet.add(p)\n\t\tif (inst.stack.child.isActivelyListening) {\n\t\t\tattach(p, inst.stack.child)\n\t\t}\n\n\t\tif (inst.stack.offset < inst.stack.child.parents.length) {\n\t\t\tconst maybeRemovedParent = inst.stack.child.parents[inst.stack.offset]\n\t\t\tif (maybeRemovedParent !== p) {\n\t\t\t\tif (!inst.stack.maybeRemoved) {\n\t\t\t\t\tinst.stack.maybeRemoved = [maybeRemovedParent]\n\t\t\t\t} else {\n\t\t\t\t\tinst.stack.maybeRemoved.push(maybeRemovedParent)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinst.stack.child.parents[inst.stack.offset] = p\n\t\tinst.stack.child.parentEpochs[inst.stack.offset] = p.lastChangedEpoch\n\t\tinst.stack.offset++\n\t}\n}\n\n/**\n * A debugging tool that tells you why a computed signal or effect is running.\n * Call in the body of a computed signal or effect function.\n *\n * @example\n * ```ts\n * const name = atom('name', 'Bob')\n * react('greeting', () => {\n * \twhyAmIRunning()\n *\tprint('Hello', name.get())\n * })\n *\n * name.set('Alice')\n *\n * // 'greeting' is running because:\n * //     'name' changed => 'Alice'\n * ```\n *\n * @public\n */\nexport function whyAmIRunning() {\n\tconst child = inst.stack?.child\n\tif (!child) {\n\t\tthrow new Error('whyAmIRunning() called outside of a reactive context')\n\t}\n\n\tconst changedParents = []\n\tfor (let i = 0; i < child.parents.length; i++) {\n\t\tconst parent = child.parents[i]\n\n\t\tif (parent.lastChangedEpoch > child.parentEpochs[i]) {\n\t\t\tchangedParents.push(parent)\n\t\t}\n\t}\n\n\tif (changedParents.length === 0) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.log((child as any).name, 'is running but none of the parents changed')\n\t} else {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.log((child as any).name, 'is running because:')\n\t\tfor (const changedParent of changedParents) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log(\n\t\t\t\t'\\t',\n\t\t\t\t(changedParent as any).name,\n\t\t\t\t'changed =>',\n\t\t\t\tchangedParent.__unsafe__getWithoutCapture(true)\n\t\t\t)\n\t\t}\n\t}\n}\n", "// Derivations start on GLOBAL_START_EPOCH so they are dirty before having been computed\nexport const GLOBAL_START_EPOCH = -1\n", "import { ArraySet } from './ArraySet'\nimport { startCapturingParents, stopCapturingParents } from './capture'\nimport { GLOBAL_START_EPOCH } from './constants'\nimport { attach, detach, haveParentsChanged, singleton } from './helpers'\nimport { getGlobalEpoch } from './transactions'\nimport { Signal } from './types'\n\ninterface EffectSchedulerOptions {\n\t/**\n\t * scheduleEffect is a function that will be called when the effect is scheduled.\n\t *\n\t * It can be used to defer running effects until a later time, for example to batch them together with requestAnimationFrame.\n\t *\n\t *\n\t * @example\n\t * ```ts\n\t * let isRafScheduled = false\n\t * const scheduledEffects: Array<() => void> = []\n\t * const scheduleEffect = (runEffect: () => void) => {\n\t * \tscheduledEffects.push(runEffect)\n\t * \tif (!isRafScheduled) {\n\t * \t\tisRafScheduled = true\n\t * \t\trequestAnimationFrame(() => {\n\t * \t\t\tisRafScheduled = false\n\t * \t\t\tscheduledEffects.forEach((runEffect) => runEffect())\n\t * \t\t\tscheduledEffects.length = 0\n\t * \t\t})\n\t * \t}\n\t * }\n\t * const stop = react('set page title', () => {\n\t * \tdocument.title = doc.title,\n\t * }, scheduleEffect)\n\t * ```\n\t *\n\t * @param execute - A function that will execute the effect.\n\t * @returns\n\t */\n\tscheduleEffect?: (execute: () => void) => void\n}\n\nclass __EffectScheduler__<Result> {\n\tprivate _isActivelyListening = false\n\t/**\n\t * Whether this scheduler is attached and actively listening to its parents.\n\t * @public\n\t */\n\t// eslint-disable-next-line no-restricted-syntax\n\tget isActivelyListening() {\n\t\treturn this._isActivelyListening\n\t}\n\t/** @internal */\n\tlastTraversedEpoch = GLOBAL_START_EPOCH\n\n\tprivate lastReactedEpoch = GLOBAL_START_EPOCH\n\tprivate _scheduleCount = 0\n\n\t/**\n\t * The number of times this effect has been scheduled.\n\t * @public\n\t */\n\t// eslint-disable-next-line no-restricted-syntax\n\tget scheduleCount() {\n\t\treturn this._scheduleCount\n\t}\n\n\t/** @internal */\n\treadonly parentSet = new ArraySet<Signal<any, any>>()\n\t/** @internal */\n\treadonly parentEpochs: number[] = []\n\t/** @internal */\n\treadonly parents: Signal<any, any>[] = []\n\tprivate readonly _scheduleEffect?: (execute: () => void) => void\n\tconstructor(\n\t\tpublic readonly name: string,\n\t\tprivate readonly runEffect: (lastReactedEpoch: number) => Result,\n\t\toptions?: EffectSchedulerOptions\n\t) {\n\t\tthis._scheduleEffect = options?.scheduleEffect\n\t}\n\n\t/** @internal */\n\tmaybeScheduleEffect() {\n\t\t// bail out if we have been cancelled by another effect\n\t\tif (!this._isActivelyListening) return\n\t\t// bail out if no atoms have changed since the last time we ran this effect\n\t\tif (this.lastReactedEpoch === getGlobalEpoch()) return\n\n\t\t// bail out if we have parents and they have not changed since last time\n\t\tif (this.parents.length && !haveParentsChanged(this)) {\n\t\t\tthis.lastReactedEpoch = getGlobalEpoch()\n\t\t\treturn\n\t\t}\n\t\t// if we don't have parents it's probably the first time this is running.\n\t\tthis.scheduleEffect()\n\t}\n\n\t/** @internal */\n\tscheduleEffect() {\n\t\tthis._scheduleCount++\n\t\tif (this._scheduleEffect) {\n\t\t\t// if the effect should be deferred (e.g. until a react render), do so\n\t\t\tthis._scheduleEffect(this.maybeExecute)\n\t\t} else {\n\t\t\t// otherwise execute right now!\n\t\t\tthis.execute()\n\t\t}\n\t}\n\n\t/** @internal */\n\treadonly maybeExecute = () => {\n\t\t// bail out if we have been detached before this runs\n\t\tif (!this._isActivelyListening) return\n\t\tthis.execute()\n\t}\n\n\t/**\n\t * Makes this scheduler become 'actively listening' to its parents.\n\t * If it has been executed before it will immediately become eligible to receive 'maybeScheduleEffect' calls.\n\t * If it has not executed before it will need to be manually executed once to become eligible for scheduling, i.e. by calling [[EffectScheduler.execute]].\n\t * @public\n\t */\n\tattach() {\n\t\tthis._isActivelyListening = true\n\t\tfor (let i = 0, n = this.parents.length; i < n; i++) {\n\t\t\tattach(this.parents[i], this)\n\t\t}\n\t}\n\n\t/**\n\t * Makes this scheduler stop 'actively listening' to its parents.\n\t * It will no longer be eligible to receive 'maybeScheduleEffect' calls until [[EffectScheduler.attach]] is called again.\n\t */\n\tdetach() {\n\t\tthis._isActivelyListening = false\n\t\tfor (let i = 0, n = this.parents.length; i < n; i++) {\n\t\t\tdetach(this.parents[i], this)\n\t\t}\n\t}\n\n\t/**\n\t * Executes the effect immediately and returns the result.\n\t * @returns The result of the effect.\n\t */\n\texecute(): Result {\n\t\ttry {\n\t\t\tstartCapturingParents(this)\n\t\t\tconst result = this.runEffect(this.lastReactedEpoch)\n\t\t\tthis.lastReactedEpoch = getGlobalEpoch()\n\t\t\treturn result\n\t\t} finally {\n\t\t\tstopCapturingParents()\n\t\t}\n\t}\n}\n\n/**\n * An EffectScheduler is responsible for executing side effects in response to changes in state.\n *\n * You probably don't need to use this directly unless you're integrating this library with a framework of some kind.\n *\n * Instead, use the [[react]] and [[reactor]] functions.\n *\n * @example\n * ```ts\n * const render = new EffectScheduler('render', drawToCanvas)\n *\n * render.attach()\n * render.execute()\n * ```\n *\n * @public\n */\nexport const EffectScheduler = singleton('EffectScheduler', () => __EffectScheduler__)\n/** @public */\nexport type EffectScheduler<Result> = __EffectScheduler__<Result>\n\n/**\n * Starts a new effect scheduler, scheduling the effect immediately.\n *\n * Returns a function that can be called to stop the scheduler.\n *\n * @example\n * ```ts\n * const color = atom('color', 'red')\n * const stop = react('set style', () => {\n *   divElem.style.color = color.get()\n * })\n * color.set('blue')\n * // divElem.style.color === 'blue'\n * stop()\n * color.set('green')\n * // divElem.style.color === 'blue'\n * ```\n *\n *\n * Also useful in React applications for running effects outside of the render cycle.\n *\n * @example\n * ```ts\n * useEffect(() => react('set style', () => {\n *   divRef.current.style.color = color.get()\n * }), [])\n * ```\n *\n * @public\n */\nexport function react(\n\tname: string,\n\tfn: (lastReactedEpoch: number) => any,\n\toptions?: EffectSchedulerOptions\n) {\n\tconst scheduler = new EffectScheduler(name, fn, options)\n\tscheduler.attach()\n\tscheduler.scheduleEffect()\n\treturn () => {\n\t\tscheduler.detach()\n\t}\n}\n\n/**\n * The reactor is a user-friendly interface for starting and stopping an [[EffectScheduler]].\n *\n * Calling .start() will attach the scheduler and execute the effect immediately the first time it is called.\n *\n * If the reactor is stopped, calling `.start()` will re-attach the scheduler but will only execute the effect if any of its parents have changed since it was stopped.\n *\n * You can create a reactor with [[reactor]].\n * @public\n */\nexport interface Reactor<T = unknown> {\n\t/**\n\t * The underlying effect scheduler.\n\t * @public\n\t */\n\tscheduler: EffectScheduler<T>\n\t/**\n\t * Start the scheduler. The first time this is called the effect will be scheduled immediately.\n\t *\n\t * If the reactor is stopped, calling this will start the scheduler again but will only execute the effect if any of its parents have changed since it was stopped.\n\t *\n\t * If you need to force re-execution of the effect, pass `{ force: true }`.\n\t * @public\n\t */\n\tstart(options?: { force?: boolean }): void\n\t/**\n\t * Stop the scheduler.\n\t * @public\n\t */\n\tstop(): void\n}\n\n/**\n * Creates a [[Reactor]], which is a thin wrapper around an [[EffectScheduler]].\n *\n * @public\n */\nexport function reactor<Result>(\n\tname: string,\n\tfn: (lastReactedEpoch: number) => Result,\n\toptions?: EffectSchedulerOptions\n): Reactor<Result> {\n\tconst scheduler = new EffectScheduler<Result>(name, fn, options)\n\treturn {\n\t\tscheduler,\n\t\tstart: (options?: { force?: boolean }) => {\n\t\t\tconst force = options?.force ?? false\n\t\t\tscheduler.attach()\n\t\t\tif (force) {\n\t\t\t\tscheduler.scheduleEffect()\n\t\t\t} else {\n\t\t\t\tscheduler.maybeScheduleEffect()\n\t\t\t}\n\t\t},\n\t\tstop: () => {\n\t\t\tscheduler.detach()\n\t\t},\n\t}\n}\n", "import { _Atom } from './Atom'\nimport { GLOBAL_START_EPOCH } from './constants'\nimport { EffectScheduler } from './EffectScheduler'\nimport { singleton } from './helpers'\nimport { Child, Signal } from './types'\n\nclass Transaction {\n\tconstructor(public readonly parent: Transaction | null) {}\n\tinitialAtomValues = new Map<_Atom, any>()\n\n\t/**\n\t * Get whether this transaction is a root (no parents).\n\t *\n\t * @public\n\t */\n\t// eslint-disable-next-line no-restricted-syntax\n\tget isRoot() {\n\t\treturn this.parent === null\n\t}\n\n\t/**\n\t * Commit the transaction's changes.\n\t *\n\t * @public\n\t */\n\tcommit() {\n\t\tif (this.isRoot) {\n\t\t\t// For root transactions, flush changes to each of the atom's initial values.\n\t\t\tconst atoms = this.initialAtomValues\n\t\t\tthis.initialAtomValues = new Map()\n\t\t\tflushChanges(atoms.keys())\n\t\t} else {\n\t\t\t// For transaction's with parents, add the transaction's initial values to the parent's.\n\t\t\tthis.initialAtomValues.forEach((value, atom) => {\n\t\t\t\tif (!this.parent!.initialAtomValues.has(atom)) {\n\t\t\t\t\tthis.parent!.initialAtomValues.set(atom, value)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * Abort the transaction.\n\t *\n\t * @public\n\t */\n\tabort() {\n\t\tinst.globalEpoch++\n\n\t\t// Reset each of the transaction's atoms to its initial value.\n\t\tthis.initialAtomValues.forEach((value, atom) => {\n\t\t\tatom.set(value)\n\t\t\tatom.historyBuffer?.clear()\n\t\t})\n\n\t\t// Commit the changes.\n\t\tthis.commit()\n\t}\n}\n\nconst inst = singleton('transactions', () => ({\n\t// The current epoch (global to all atoms).\n\tglobalEpoch: GLOBAL_START_EPOCH + 1,\n\t// Whether any transaction is reacting.\n\tglobalIsReacting: false,\n\tcurrentTransaction: null as Transaction | null,\n}))\n\nexport function getGlobalEpoch() {\n\treturn inst.globalEpoch\n}\n\n/**\n * Collect all of the reactors that need to run for an atom and run them.\n *\n * @param atom The atom to flush changes for.\n */\nfunction flushChanges(atoms: Iterable<_Atom>) {\n\tif (inst.globalIsReacting) {\n\t\tthrow new Error('cannot change atoms during reaction cycle')\n\t}\n\n\ttry {\n\t\tinst.globalIsReacting = true\n\n\t\t// Collect all of the visited reactors.\n\t\tconst reactors = new Set<EffectScheduler<unknown>>()\n\n\t\t// Visit each descendant of the atom, collecting reactors.\n\t\tconst traverse = (node: Child) => {\n\t\t\tif (node.lastTraversedEpoch === inst.globalEpoch) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tnode.lastTraversedEpoch = inst.globalEpoch\n\n\t\t\tif (node instanceof EffectScheduler) {\n\t\t\t\treactors.add(node)\n\t\t\t} else {\n\t\t\t\t;(node as any as Signal<any>).children.visit(traverse)\n\t\t\t}\n\t\t}\n\n\t\tfor (const atom of atoms) {\n\t\t\tatom.children.visit(traverse)\n\t\t}\n\n\t\t// Run each reactor.\n\t\tfor (const r of reactors) {\n\t\t\tr.maybeScheduleEffect()\n\t\t}\n\t} finally {\n\t\tinst.globalIsReacting = false\n\t}\n}\n\n/**\n * Handle a change to an atom.\n *\n * @param atom The atom that changed.\n * @param previousValue The atom's previous value.\n *\n * @internal\n */\nexport function atomDidChange(atom: _Atom, previousValue: any) {\n\tif (!inst.currentTransaction) {\n\t\tflushChanges([atom])\n\t} else if (!inst.currentTransaction.initialAtomValues.has(atom)) {\n\t\tinst.currentTransaction.initialAtomValues.set(atom, previousValue)\n\t}\n}\n\nexport function advanceGlobalEpoch() {\n\tinst.globalEpoch++\n}\n\n/**\n * Batches state updates, deferring side effects until after the transaction completes.\n *\n * @example\n * ```ts\n * const firstName = atom('John')\n * const lastName = atom('Doe')\n *\n * react('greet', () => {\n *   print(`Hello, ${firstName.get()} ${lastName.get()}!`)\n * })\n *\n * // Logs \"Hello, John Doe!\"\n *\n * transaction(() => {\n *  firstName.set('Jane')\n *  lastName.set('Smith')\n * })\n *\n * // Logs \"Hello, Jane Smith!\"\n * ```\n *\n * If the function throws, the transaction is aborted and any signals that were updated during the transaction revert to their state before the transaction began.\n *\n * @example\n * ```ts\n * const firstName = atom('John')\n * const lastName = atom('Doe')\n *\n * react('greet', () => {\n *   print(`Hello, ${firstName.get()} ${lastName.get()}!`)\n * })\n *\n * // Logs \"Hello, John Doe!\"\n *\n * transaction(() => {\n *  firstName.set('Jane')\n *  throw new Error('oops')\n * })\n *\n * // Does not log\n * // firstName.get() === 'John'\n * ```\n *\n * A `rollback` callback is passed into the function.\n * Calling this will prevent the transaction from committing and will revert any signals that were updated during the transaction to their state before the transaction began.\n *\n *  * @example\n * ```ts\n * const firstName = atom('John')\n * const lastName = atom('Doe')\n *\n * react('greet', () => {\n *   print(`Hello, ${firstName.get()} ${lastName.get()}!`)\n * })\n *\n * // Logs \"Hello, John Doe!\"\n *\n * transaction((rollback) => {\n *  firstName.set('Jane')\n *  lastName.set('Smith')\n *  rollback()\n * })\n *\n * // Does not log\n * // firstName.get() === 'John'\n * // lastName.get() === 'Doe'\n * ```\n *\n * @param fn - The function to run in a transaction, called with a function to roll back the change.\n * @public\n */\nexport function transaction<T>(fn: (rollback: () => void) => T) {\n\tconst txn = new Transaction(inst.currentTransaction)\n\n\t// Set the current transaction to the transaction\n\tinst.currentTransaction = txn\n\n\ttry {\n\t\tlet rollback = false\n\n\t\t// Run the function.\n\t\tconst result = fn(() => (rollback = true))\n\n\t\tif (rollback) {\n\t\t\t// If the rollback was triggered, abort the transaction.\n\t\t\ttxn.abort()\n\t\t} else {\n\t\t\t// Otherwise, commit the transaction.\n\t\t\ttxn.commit()\n\t\t}\n\n\t\treturn result\n\t} catch (e) {\n\t\t// Abort the transaction if the function throws.\n\t\ttxn.abort()\n\t\tthrow e\n\t} finally {\n\t\t// Set the current transaction to the transaction's parent.\n\t\tinst.currentTransaction = inst.currentTransaction.parent\n\t}\n}\n\n/**\n * Like [transaction](#transaction), but does not create a new transaction if there is already one in progress.\n *\n * @param fn - The function to run in a transaction.\n * @public\n */\nexport function transact<T>(fn: () => T): T {\n\tif (inst.currentTransaction) {\n\t\treturn fn()\n\t}\n\treturn transaction(fn)\n}\n", "import { ArraySet } from './ArraySet'\nimport { HistoryBuffer } from './HistoryBuffer'\nimport { maybeCaptureParent } from './capture'\nimport { EMPTY_ARRAY, equals, singleton } from './helpers'\nimport { advanceGlobalEpoch, atomDidChange, getGlobalEpoch } from './transactions'\nimport { Child, ComputeDiff, RESET_VALUE, Signal } from './types'\n\n/**\n * The options to configure an atom, passed into the [[atom]] function.\n * @public\n */\nexport interface AtomOptions<Value, Diff> {\n\t/**\n\t * The maximum number of diffs to keep in the history buffer.\n\t *\n\t * If you don't need to compute diffs, or if you will supply diffs manually via [[Atom.set]], you can leave this as `undefined` and no history buffer will be created.\n\t *\n\t * If you expect the value to be part of an active effect subscription all the time, and to not change multiple times inside of a single transaction, you can set this to a relatively low number (e.g. 10).\n\t *\n\t * Otherwise, set this to a higher number based on your usage pattern and memory constraints.\n\t *\n\t */\n\thistoryLength?: number\n\t/**\n\t * A method used to compute a diff between the atom's old and new values. If provided, it will not be used unless you also specify [[AtomOptions.historyLength]].\n\t */\n\tcomputeDiff?: ComputeDiff<Value, Diff>\n\t/**\n\t * If provided, this will be used to compare the old and new values of the atom to determine if the value has changed.\n\t * By default, values are compared using first using strict equality (`===`), then `Object.is`, and finally any `.equals` method present in the object's prototype chain.\n\t * @param a - The old value\n\t * @param b - The new value\n\t * @returns\n\t */\n\tisEqual?: (a: any, b: any) => boolean\n}\n\n/**\n * An Atom is a signal that can be updated directly by calling [[Atom.set]] or [[Atom.update]].\n *\n * Atoms are created using the [[atom]] function.\n *\n * @example\n * ```ts\n * const name = atom('name', 'John')\n *\n * print(name.get()) // 'John'\n * ```\n *\n * @public\n */\nexport interface Atom<Value, Diff = unknown> extends Signal<Value, Diff> {\n\t/**\n\t * Sets the value of this atom to the given value. If the value is the same as the current value, this is a no-op.\n\t *\n\t * @param value - The new value to set.\n\t * @param diff - The diff to use for the update. If not provided, the diff will be computed using [[AtomOptions.computeDiff]].\n\t */\n\tset(value: Value, diff?: Diff): Value\n\t/**\n\t * Updates the value of this atom using the given updater function. If the returned value is the same as the current value, this is a no-op.\n\t *\n\t * @param updater - A function that takes the current value and returns the new value.\n\t */\n\tupdate(updater: (value: Value) => Value): Value\n}\n\n/**\n * @internal\n */\nclass __Atom__<Value, Diff = unknown> implements Atom<Value, Diff> {\n\tconstructor(\n\t\tpublic readonly name: string,\n\t\tprivate current: Value,\n\t\toptions?: AtomOptions<Value, Diff>\n\t) {\n\t\tthis.isEqual = options?.isEqual ?? null\n\n\t\tif (!options) return\n\n\t\tif (options.historyLength) {\n\t\t\tthis.historyBuffer = new HistoryBuffer(options.historyLength)\n\t\t}\n\n\t\tthis.computeDiff = options.computeDiff\n\t}\n\n\treadonly isEqual: null | ((a: any, b: any) => boolean)\n\n\tcomputeDiff?: ComputeDiff<Value, Diff>\n\n\tlastChangedEpoch = getGlobalEpoch()\n\n\tchildren = new ArraySet<Child>()\n\n\thistoryBuffer?: HistoryBuffer<Diff>\n\n\t__unsafe__getWithoutCapture(_ignoreErrors?: boolean): Value {\n\t\treturn this.current\n\t}\n\n\tget() {\n\t\tmaybeCaptureParent(this)\n\t\treturn this.current\n\t}\n\n\tset(value: Value, diff?: Diff): Value {\n\t\t// If the value has not changed, do nothing.\n\t\tif (this.isEqual?.(this.current, value) ?? equals(this.current, value)) {\n\t\t\treturn this.current\n\t\t}\n\n\t\t// Tick forward the global epoch\n\t\tadvanceGlobalEpoch()\n\n\t\t// Add the diff to the history buffer.\n\t\tif (this.historyBuffer) {\n\t\t\tthis.historyBuffer.pushEntry(\n\t\t\t\tthis.lastChangedEpoch,\n\t\t\t\tgetGlobalEpoch(),\n\t\t\t\tdiff ??\n\t\t\t\t\tthis.computeDiff?.(this.current, value, this.lastChangedEpoch, getGlobalEpoch()) ??\n\t\t\t\t\tRESET_VALUE\n\t\t\t)\n\t\t}\n\n\t\t// Update the atom's record of the epoch when last changed.\n\t\tthis.lastChangedEpoch = getGlobalEpoch()\n\n\t\tconst oldValue = this.current\n\t\tthis.current = value\n\n\t\t// Notify all children that this atom has changed.\n\t\tatomDidChange(this as any, oldValue)\n\n\t\treturn value\n\t}\n\n\tupdate(updater: (value: Value) => Value): Value {\n\t\treturn this.set(updater(this.current))\n\t}\n\n\tgetDiffSince(epoch: number): RESET_VALUE | Diff[] {\n\t\tmaybeCaptureParent(this)\n\n\t\t// If no changes have occurred since the given epoch, return an empty array.\n\t\tif (epoch >= this.lastChangedEpoch) {\n\t\t\treturn EMPTY_ARRAY\n\t\t}\n\n\t\treturn this.historyBuffer?.getChangesSince(epoch) ?? RESET_VALUE\n\t}\n}\n\nexport const _Atom = singleton('Atom', () => __Atom__)\nexport type _Atom = InstanceType<typeof _Atom>\n\n/**\n * Creates a new [[Atom]].\n *\n * An Atom is a signal that can be updated directly by calling [[Atom.set]] or [[Atom.update]].\n *\n * @example\n * ```ts\n * const name = atom('name', 'John')\n *\n * name.get() // 'John'\n *\n * name.set('Jane')\n *\n * name.get() // 'Jane'\n * ```\n *\n * @public\n */\nexport function atom<Value, Diff = unknown>(\n\t/**\n\t * A name for the signal. This is used for debugging and profiling purposes, it does not need to be unique.\n\t */\n\tname: string,\n\t/**\n\t * The initial value of the signal.\n\t */\n\tinitialValue: Value,\n\t/**\n\t * The options to configure the atom. See [[AtomOptions]].\n\t */\n\toptions?: AtomOptions<Value, Diff>\n): Atom<Value, Diff> {\n\treturn new _Atom(name, initialValue, options)\n}\n\n/**\n * Returns true if the given value is an [[Atom]].\n * @public\n */\nexport function isAtom(value: unknown): value is Atom<unknown> {\n\treturn value instanceof _Atom\n}\n", "let didWarnComputedGetter = false\n\nexport function logComputedGetterWarning() {\n\tif (didWarnComputedGetter) return\n\tdidWarnComputedGetter = true\n\tconsole.warn(\n\t\t`Using \\`@computed\\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \\`@computed\\` as a decorator for methods.\n\n// Before\n@computed\nget foo() {\n\treturn 'foo'\n}\n\n// After\n@computed\ngetFoo() {\n\treturn 'foo'\n}\n`\n\t)\n}\n", "/* eslint-disable prefer-rest-params */\nimport { ArraySet } from './ArraySet'\nimport { HistoryBuffer } from './HistoryBuffer'\nimport { maybeCaptureParent, startCapturingParents, stopCapturingParents } from './capture'\nimport { GLOBAL_START_EPOCH } from './constants'\nimport { EMPTY_ARRAY, equals, haveParentsChanged, singleton } from './helpers'\nimport { getGlobalEpoch } from './transactions'\nimport { Child, ComputeDiff, RESET_VALUE, Signal } from './types'\nimport { logComputedGetterWarning } from './warnings'\n\n/**\n * @public\n */\nexport const UNINITIALIZED = Symbol.for('com.tldraw.state/UNINITIALIZED')\n/**\n * The type of the first value passed to a computed signal function as the 'prevValue' parameter.\n *\n * @see [[isUninitialized]].\n * @public\n */\nexport type UNINITIALIZED = typeof UNINITIALIZED\n\n/**\n * Call this inside a computed signal function to determine whether it is the first time the function is being called.\n *\n * Mainly useful for incremental signal computation.\n *\n * @example\n * ```ts\n * const count = atom('count', 0)\n * const double = computed('double', (prevValue) => {\n *   if (isUninitialized(prevValue)) {\n *     print('First time!')\n *   }\n *   return count.get() * 2\n * })\n * ```\n *\n * @param value - The value to check.\n * @public\n */\nexport const isUninitialized = (value: any): value is UNINITIALIZED => {\n\treturn value === UNINITIALIZED\n}\n\nexport const WithDiff = singleton(\n\t'WithDiff',\n\t() =>\n\t\tclass WithDiff<Value, Diff> {\n\t\t\tconstructor(\n\t\t\t\tpublic value: Value,\n\t\t\t\tpublic diff: Diff\n\t\t\t) {}\n\t\t}\n)\nexport type WithDiff<Value, Diff> = { value: Value; diff: Diff }\n\n/**\n * When writing incrementally-computed signals it is convenient (and usually more performant) to incrementally compute the diff too.\n *\n * You can use this function to wrap the return value of a computed signal function to indicate that the diff should be used instead of calculating a new one with [[AtomOptions.computeDiff]].\n *\n * @example\n * ```ts\n * const count = atom('count', 0)\n * const double = computed('double', (prevValue) => {\n *   const nextValue = count.get() * 2\n *   if (isUninitialized(prevValue)) {\n *     return nextValue\n *   }\n *   return withDiff(nextValue, nextValue - prevValue)\n * }, { historyLength: 10 })\n * ```\n *\n *\n * @param value - The value.\n * @param diff - The diff.\n * @public\n */\nexport function withDiff<Value, Diff>(value: Value, diff: Diff): WithDiff<Value, Diff> {\n\treturn new WithDiff(value, diff)\n}\n\n/**\n * Options for creating computed signals. Used when calling [[computed]].\n * @public\n */\nexport interface ComputedOptions<Value, Diff> {\n\t/**\n\t * The maximum number of diffs to keep in the history buffer.\n\t *\n\t * If you don't need to compute diffs, or if you will supply diffs manually via [[Atom.set]], you can leave this as `undefined` and no history buffer will be created.\n\t *\n\t * If you expect the value to be part of an active effect subscription all the time, and to not change multiple times inside of a single transaction, you can set this to a relatively low number (e.g. 10).\n\t *\n\t * Otherwise, set this to a higher number based on your usage pattern and memory constraints.\n\t *\n\t */\n\thistoryLength?: number\n\t/**\n\t * A method used to compute a diff between the atom's old and new values. If provided, it will not be used unless you also specify [[AtomOptions.historyLength]].\n\t */\n\tcomputeDiff?: ComputeDiff<Value, Diff>\n\t/**\n\t * If provided, this will be used to compare the old and new values of the atom to determine if the value has changed.\n\t * By default, values are compared using first using strict equality (`===`), then `Object.is`, and finally any `.equals` method present in the object's prototype chain.\n\t * @param a - The old value\n\t * @param b - The new value\n\t * @returns\n\t */\n\tisEqual?: (a: any, b: any) => boolean\n}\n\n/**\n * A computed signal created via [[computed]].\n *\n * @public\n */\nexport interface Computed<Value, Diff = unknown> extends Signal<Value, Diff> {\n\t/**\n\t * Whether this computed child is involved in an actively-running effect graph.\n\t * @public\n\t */\n\treadonly isActivelyListening: boolean\n\n\t/** @internal */\n\treadonly parentSet: ArraySet<Signal<any, any>>\n\t/** @internal */\n\treadonly parents: Signal<any, any>[]\n\t/** @internal */\n\treadonly parentEpochs: number[]\n}\n\n/**\n * @internal\n */\nclass __UNSAFE__Computed<Value, Diff = unknown> implements Computed<Value, Diff> {\n\tlastChangedEpoch = GLOBAL_START_EPOCH\n\tlastTraversedEpoch = GLOBAL_START_EPOCH\n\n\t/**\n\t * The epoch when the reactor was last checked.\n\t */\n\tprivate lastCheckedEpoch = GLOBAL_START_EPOCH\n\n\tparentSet = new ArraySet<Signal<any, any>>()\n\tparents: Signal<any, any>[] = []\n\tparentEpochs: number[] = []\n\n\tchildren = new ArraySet<Child>()\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget isActivelyListening(): boolean {\n\t\treturn !this.children.isEmpty\n\t}\n\n\thistoryBuffer?: HistoryBuffer<Diff>\n\n\t// The last-computed value of this signal.\n\tprivate state: Value = UNINITIALIZED as unknown as Value\n\t// If the signal throws an error we stash it so we can rethrow it on the next get()\n\tprivate error: null | { thrownValue: any } = null\n\n\tprivate computeDiff?: ComputeDiff<Value, Diff>\n\n\tprivate readonly isEqual: (a: any, b: any) => boolean\n\n\tconstructor(\n\t\t/**\n\t\t * The name of the signal. This is used for debugging and performance profiling purposes. It does not need to be globally unique.\n\t\t */\n\t\tpublic readonly name: string,\n\t\t/**\n\t\t * The function that computes the value of the signal.\n\t\t */\n\t\tprivate readonly derive: (\n\t\t\tpreviousValue: Value | UNINITIALIZED,\n\t\t\tlastComputedEpoch: number\n\t\t) => Value | WithDiff<Value, Diff>,\n\t\toptions?: ComputedOptions<Value, Diff>\n\t) {\n\t\tif (options?.historyLength) {\n\t\t\tthis.historyBuffer = new HistoryBuffer(options.historyLength)\n\t\t}\n\t\tthis.computeDiff = options?.computeDiff\n\t\tthis.isEqual = options?.isEqual ?? equals\n\t}\n\n\t__unsafe__getWithoutCapture(ignoreErrors?: boolean): Value {\n\t\tconst isNew = this.lastChangedEpoch === GLOBAL_START_EPOCH\n\n\t\tif (!isNew && (this.lastCheckedEpoch === getGlobalEpoch() || !haveParentsChanged(this))) {\n\t\t\tthis.lastCheckedEpoch = getGlobalEpoch()\n\t\t\tif (this.error) {\n\t\t\t\tif (!ignoreErrors) {\n\t\t\t\t\tthrow this.error.thrownValue\n\t\t\t\t} else {\n\t\t\t\t\treturn this.state // will be UNINITIALIZED\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn this.state\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstartCapturingParents(this)\n\t\t\tconst result = this.derive(this.state, this.lastCheckedEpoch)\n\t\t\tconst newState = result instanceof WithDiff ? result.value : result\n\t\t\tconst isUninitialized = this.state === UNINITIALIZED\n\t\t\tif (isUninitialized || !this.isEqual(newState, this.state)) {\n\t\t\t\tif (this.historyBuffer && !isUninitialized) {\n\t\t\t\t\tconst diff = result instanceof WithDiff ? result.diff : undefined\n\t\t\t\t\tthis.historyBuffer.pushEntry(\n\t\t\t\t\t\tthis.lastChangedEpoch,\n\t\t\t\t\t\tgetGlobalEpoch(),\n\t\t\t\t\t\tdiff ??\n\t\t\t\t\t\t\tthis.computeDiff?.(this.state, newState, this.lastCheckedEpoch, getGlobalEpoch()) ??\n\t\t\t\t\t\t\tRESET_VALUE\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\tthis.lastChangedEpoch = getGlobalEpoch()\n\t\t\t\tthis.state = newState\n\t\t\t}\n\t\t\tthis.error = null\n\t\t\tthis.lastCheckedEpoch = getGlobalEpoch()\n\n\t\t\treturn this.state\n\t\t} catch (e) {\n\t\t\t// if a derived value throws an error, we reset the state to UNINITIALIZED\n\t\t\tif (this.state !== UNINITIALIZED) {\n\t\t\t\tthis.state = UNINITIALIZED as unknown as Value\n\t\t\t\tthis.lastChangedEpoch = getGlobalEpoch()\n\t\t\t}\n\t\t\tthis.lastCheckedEpoch = getGlobalEpoch()\n\t\t\t// we also clear the history buffer if an error was thrown\n\t\t\tif (this.historyBuffer) {\n\t\t\t\tthis.historyBuffer.clear()\n\t\t\t}\n\t\t\tthis.error = { thrownValue: e }\n\t\t\t// we don't wish to propagate errors when derefed via haveParentsChanged()\n\t\t\tif (!ignoreErrors) throw e\n\t\t\treturn this.state\n\t\t} finally {\n\t\t\tstopCapturingParents()\n\t\t}\n\t}\n\n\tget(): Value {\n\t\ttry {\n\t\t\treturn this.__unsafe__getWithoutCapture()\n\t\t} finally {\n\t\t\t// if the deriver throws an error we still need to capture\n\t\t\tmaybeCaptureParent(this)\n\t\t}\n\t}\n\n\tgetDiffSince(epoch: number): RESET_VALUE | Diff[] {\n\t\t// we can ignore any errors thrown during derive\n\t\tthis.__unsafe__getWithoutCapture(true)\n\t\t// and we still need to capture this signal as a parent\n\t\tmaybeCaptureParent(this)\n\n\t\tif (epoch >= this.lastChangedEpoch) {\n\t\t\treturn EMPTY_ARRAY\n\t\t}\n\n\t\treturn this.historyBuffer?.getChangesSince(epoch) ?? RESET_VALUE\n\t}\n}\n\nexport const _Computed = singleton('Computed', () => __UNSAFE__Computed)\nexport type _Computed = InstanceType<typeof __UNSAFE__Computed>\n\nfunction computedMethodAnnotation(\n\toptions: ComputedOptions<any, any> = {},\n\t_target: any,\n\tkey: string,\n\tdescriptor: PropertyDescriptor\n) {\n\tconst originalMethod = descriptor.value\n\tconst derivationKey = Symbol.for('__@tldraw/state__computed__' + key)\n\n\tdescriptor.value = function (this: any) {\n\t\tlet d = this[derivationKey] as Computed<any> | undefined\n\n\t\tif (!d) {\n\t\t\td = new _Computed(key, originalMethod!.bind(this) as any, options)\n\t\t\tObject.defineProperty(this, derivationKey, {\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: false,\n\t\t\t\twritable: false,\n\t\t\t\tvalue: d,\n\t\t\t})\n\t\t}\n\t\treturn d.get()\n\t}\n\tdescriptor.value[isComputedMethodKey] = true\n\n\treturn descriptor\n}\n\nfunction computedAnnotation(\n\toptions: ComputedOptions<any, any> = {},\n\t_target: any,\n\tkey: string,\n\tdescriptor: PropertyDescriptor\n) {\n\tif (descriptor.get) {\n\t\tlogComputedGetterWarning()\n\t\treturn computedGetterAnnotation(options, _target, key, descriptor)\n\t} else {\n\t\treturn computedMethodAnnotation(options, _target, key, descriptor)\n\t}\n}\n\nfunction computedGetterAnnotation(\n\toptions: ComputedOptions<any, any> = {},\n\t_target: any,\n\tkey: string,\n\tdescriptor: PropertyDescriptor\n) {\n\tconst originalMethod = descriptor.get\n\tconst derivationKey = Symbol.for('__@tldraw/state__computed__' + key)\n\n\tdescriptor.get = function (this: any) {\n\t\tlet d = this[derivationKey] as Computed<any> | undefined\n\n\t\tif (!d) {\n\t\t\td = new _Computed(key, originalMethod!.bind(this) as any, options)\n\t\t\tObject.defineProperty(this, derivationKey, {\n\t\t\t\tenumerable: false,\n\t\t\t\tconfigurable: false,\n\t\t\t\twritable: false,\n\t\t\t\tvalue: d,\n\t\t\t})\n\t\t}\n\t\treturn d.get()\n\t}\n\n\treturn descriptor\n}\n\nconst isComputedMethodKey = '@@__isComputedMethod__@@'\n\n/**\n * Retrieves the underlying computed instance for a given property created with the [[computed]]\n * decorator.\n *\n * @example\n * ```ts\n * class Counter {\n *   max = 100\n *   count = atom(0)\n *\n *   @computed getRemaining() {\n *     return this.max - this.count.get()\n *   }\n * }\n *\n * const c = new Counter()\n * const remaining = getComputedInstance(c, 'getRemaining')\n * remaining.get() === 100 // true\n * c.count.set(13)\n * remaining.get() === 87 // true\n * ```\n *\n * @param obj - The object\n * @param propertyName - The property name\n * @public\n */\nexport function getComputedInstance<Obj extends object, Prop extends keyof Obj>(\n\tobj: Obj,\n\tpropertyName: Prop\n): Computed<Obj[Prop]> {\n\tconst key = Symbol.for('__@tldraw/state__computed__' + propertyName.toString())\n\tlet inst = obj[key as keyof typeof obj] as Computed<Obj[Prop]> | undefined\n\tif (!inst) {\n\t\t// deref to make sure it exists first\n\t\tconst val = obj[propertyName]\n\t\tif (typeof val === 'function' && (val as any)[isComputedMethodKey]) {\n\t\t\tval.call(obj)\n\t\t}\n\n\t\tinst = obj[key as keyof typeof obj] as Computed<Obj[Prop]> | undefined\n\t}\n\treturn inst as any\n}\n\n/**\n * Creates a computed signal.\n *\n * @example\n * ```ts\n * const name = atom('name', 'John')\n * const greeting = computed('greeting', () => `Hello ${name.get()}!`)\n * console.log(greeting.get()) // 'Hello John!'\n * ```\n *\n * `computed` may also be used as a decorator for creating computed getter methods.\n *\n * @example\n * ```ts\n * class Counter {\n *   max = 100\n *   count = atom<number>(0)\n *\n *   @computed getRemaining() {\n *     return this.max - this.count.get()\n *   }\n * }\n * ```\n *\n * You may optionally pass in a [[ComputedOptions]] when used as a decorator:\n *\n * @example\n * ```ts\n * class Counter {\n *   max = 100\n *   count = atom<number>(0)\n *\n *   @computed({isEqual: (a, b) => a === b})\n *   getRemaining() {\n *     return this.max - this.count.get()\n *   }\n * }\n * ```\n *\n * @param name - The name of the signal.\n * @param compute - The function that computes the value of the signal.\n * @param options - Options for the signal.\n *\n * @public\n */\nexport function computed<Value, Diff = unknown>(\n\tname: string,\n\tcompute: (\n\t\tpreviousValue: Value | typeof UNINITIALIZED,\n\t\tlastComputedEpoch: number\n\t) => Value | WithDiff<Value, Diff>,\n\toptions?: ComputedOptions<Value, Diff>\n): Computed<Value, Diff>\n\n/** @public */\nexport function computed(\n\ttarget: any,\n\tkey: string,\n\tdescriptor: PropertyDescriptor\n): PropertyDescriptor\n/** @public */\nexport function computed<Value, Diff = unknown>(\n\toptions?: ComputedOptions<Value, Diff>\n): (target: any, key: string, descriptor: PropertyDescriptor) => PropertyDescriptor\n/** @public */\nexport function computed() {\n\tif (arguments.length === 1) {\n\t\tconst options = arguments[0]\n\t\treturn (target: any, key: string, descriptor: PropertyDescriptor) =>\n\t\t\tcomputedAnnotation(options, target, key, descriptor)\n\t} else if (typeof arguments[0] === 'string') {\n\t\treturn new _Computed(arguments[0], arguments[1], arguments[2])\n\t} else {\n\t\treturn computedAnnotation(undefined, arguments[0], arguments[1], arguments[2])\n\t}\n}\n\n/**\n * Returns true if the given value is a computed signal.\n *\n * @param value\n * @returns {value is Computed<any>}\n * @public\n */\nexport function isComputed(value: any): value is Computed<any> {\n\treturn value && value instanceof _Computed\n}\n", "import { singleton } from './helpers'\n\nexport { atom, isAtom } from './Atom'\nexport type { Atom, AtomOptions } from './Atom'\nexport { computed, getComputedInstance, isUninitialized, withDiff } from './Computed'\nexport type { Computed, ComputedOptions } from './Computed'\nexport { EffectScheduler, react, reactor } from './EffectScheduler'\nexport type { Reactor } from './EffectScheduler'\nexport { unsafe__withoutCapture, whyAmIRunning } from './capture'\nexport { EMPTY_ARRAY } from './helpers'\nexport { isSignal } from './isSignal'\nexport { transact, transaction } from './transactions'\nexport { RESET_VALUE } from './types'\nexport type { Signal } from './types'\n\n// This should be incremented any time an API change is made. i.e. for additions or removals.\n// Bugfixes need not increment this.\nconst currentApiVersion = 1\n\nconst actualApiVersion = singleton('apiVersion', () => currentApiVersion)\n\nif (actualApiVersion !== currentApiVersion) {\n\tthrow new Error(\n\t\t`You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.`\n\t)\n}\n", "import React, { forwardRef, FunctionComponent, memo } from 'react'\nimport { useStateTracking } from './useStateTracking'\n\nexport const ProxyHandlers = {\n\t/**\n\t * This is a function call trap for functional components. When this is called, we know it means\n\t * React did run 'Component()', that means we can use any hooks here to setup our effect and\n\t * store.\n\t *\n\t * With the native Proxy, all other calls such as access/setting to/of properties will be\n\t * forwarded to the target Component, so we don't need to copy the Component's own or inherited\n\t * properties.\n\t *\n\t * @see https://github.com/facebook/react/blob/2d80a0cd690bb5650b6c8a6c079a87b5dc42bd15/packages/react-reconciler/src/ReactFiberHooks.old.js#L460\n\t */\n\tapply(Component: FunctionComponent, thisArg: any, argumentsList: any) {\n\t\t// eslint-disable-next-line react-hooks/rules-of-hooks\n\t\treturn useStateTracking(Component.displayName ?? Component.name ?? 'tracked(???)', () =>\n\t\t\tComponent.apply(thisArg, argumentsList)\n\t\t)\n\t},\n}\n\nexport const ReactMemoSymbol = Symbol.for('react.memo')\nexport const ReactForwardRefSymbol = Symbol.for('react.forward_ref')\n\n/**\n * Returns a tracked version of the given component.\n * Any signals whose values are read while the component renders will be tracked.\n * If any of the tracked signals change later it will cause the component to re-render.\n *\n * This also wraps the component in a React.memo() call, so it will only re-render if the props change.\n *\n * @example\n * ```ts\n * const Counter = track(function Counter(props: CounterProps) {\n *   const count = useAtom('count', 0)\n *   const increment = useCallback(() => count.set(count.get() + 1), [count])\n *   return <button onClick={increment}>{count.get()}</button>\n * })\n * ```\n *\n * @param baseComponent - The base component to track.\n * @public\n */\nexport function track<T extends FunctionComponent<any>>(\n\tbaseComponent: T\n): T extends React.MemoExoticComponent<any> ? T : React.MemoExoticComponent<T> {\n\tlet compare = null\n\tconst $$typeof = baseComponent['$$typeof' as keyof typeof baseComponent]\n\tif ($$typeof === ReactMemoSymbol) {\n\t\tbaseComponent = (baseComponent as any).type\n\t\tcompare = (baseComponent as any).compare\n\t}\n\tif ($$typeof === ReactForwardRefSymbol) {\n\t\treturn memo(forwardRef(new Proxy((baseComponent as any).render, ProxyHandlers) as any)) as any\n\t}\n\n\treturn memo(new Proxy(baseComponent, ProxyHandlers) as any, compare) as any\n}\n", "import React from 'react'\nimport { EffectScheduler } from '../core'\n\n/** @internal */\nexport function useStateTracking<T>(name: string, render: () => T): T {\n\t// This hook creates an effect scheduler that will trigger re-renders when its reactive dependencies change, but it\n\t// defers the actual execution of the effect to the consumer of this hook.\n\n\t// We need the exec fn to always be up-to-date when calling scheduler.execute() but it'd be wasteful to\n\t// instantiate a new EffectScheduler on every render, so we use an immediately-updated ref\n\t// to wrap it\n\tconst renderRef = React.useRef(render)\n\trenderRef.current = render\n\n\tconst [scheduler, subscribe, getSnapshot] = React.useMemo(() => {\n\t\tlet scheduleUpdate = null as null | (() => void)\n\t\t// useSyncExternalStore requires a subscribe function that returns an unsubscribe function\n\t\tconst subscribe = (cb: () => void) => {\n\t\t\tscheduleUpdate = cb\n\t\t\treturn () => {\n\t\t\t\tscheduleUpdate = null\n\t\t\t}\n\t\t}\n\n\t\tconst scheduler = new EffectScheduler(\n\t\t\t`useStateTracking(${name})`,\n\t\t\t// this is what `scheduler.execute()` will call\n\t\t\t() => renderRef.current?.(),\n\t\t\t// this is what will be invoked when @tldraw/state detects a change in an upstream reactive value\n\t\t\t{\n\t\t\t\tscheduleEffect() {\n\t\t\t\t\tscheduleUpdate?.()\n\t\t\t\t},\n\t\t\t}\n\t\t)\n\n\t\t// we use an incrementing number based on when this\n\t\tconst getSnapshot = () => scheduler.scheduleCount\n\n\t\treturn [scheduler, subscribe, getSnapshot]\n\t}, [name])\n\n\tReact.useSyncExternalStore(subscribe, getSnapshot, getSnapshot)\n\n\t// reactive dependencies are captured when `scheduler.execute()` is called\n\t// and then to make it reactive we wait for a `useEffect` to 'attach'\n\t// this allows us to avoid rendering outside of React's render phase\n\t// and avoid 'zombie' components that try to render with bad/deleted data before\n\t// react has a chance to umount them.\n\tReact.useEffect(() => {\n\t\tscheduler.attach()\n\t\t// do not execute, we only do that in render\n\t\tscheduler.maybeScheduleEffect()\n\t\treturn () => {\n\t\t\tscheduler.detach()\n\t\t}\n\t}, [scheduler])\n\n\treturn scheduler.execute()\n}\n", "import { useState } from 'react'\nimport { Atom, AtomOptions, atom } from '../core'\n\n/**\n * Creates a new atom and returns it. The atom will be created only once.\n *\n * See [[atom]]\n *\n * @example\n * ```ts\n * const Counter = track(function Counter () {\n *   const count = useAtom('count', 0)\n *   const increment = useCallback(() => count.set(count.get() + 1), [count])\n *   return <button onClick={increment}>{count.get()}</button>\n * })\n * ```\n *\n * @public\n */\nexport function useAtom<Value, Diff = unknown>(\n\t/**\n\t * The name of the atom. This does not need to be globally unique. It is used for debugging and performance profiling.\n\t */\n\tname: string,\n\t/**\n\t * The initial value of the atom. If this is a function, it will be called to get the initial value.\n\t */\n\tvalueOrInitialiser: Value | (() => Value),\n\t/**\n\t * Options for the atom.\n\t */\n\toptions?: AtomOptions<Value, Diff>\n): Atom<Value, Diff> {\n\treturn useState(() => {\n\t\tconst initialValue =\n\t\t\ttypeof valueOrInitialiser === 'function' ? (valueOrInitialiser as any)() : valueOrInitialiser\n\n\t\treturn atom(`useAtom(${name})`, initialValue, options)\n\t})[0]\n}\n", "/* eslint-disable prefer-rest-params */\nimport { useMemo } from 'react'\nimport { Computed, ComputedOptions, computed } from '../core'\n\n/**\n * Creates a new computed signal and returns it. The computed signal will be created only once.\n *\n * See [[computed]]\n *\n * @example\n * ```ts\n * type GreeterProps = {\n *   firstName: Signal<string>\n *   lastName: Signal<string>\n * }\n *\n * const Greeter = track(function Greeter ({firstName, lastName}: GreeterProps) {\n *   const fullName = useComputed('fullName', () => `${firstName.get()} ${lastName.get()}`)\n *   return <div>Hello {fullName.get()}!</div>\n * })\n * ```\n *\n * @public\n */\nexport function useComputed<Value>(name: string, compute: () => Value, deps: any[]): Computed<Value>\n/** @public */\nexport function useComputed<Value, Diff = unknown>(\n\tname: string,\n\tcompute: () => Value,\n\topts: ComputedOptions<Value, Diff>,\n\tdeps: any[]\n): Computed<Value>\n/** @public */\nexport function useComputed() {\n\tconst name = arguments[0]\n\tconst compute = arguments[1]\n\tconst opts = arguments.length === 3 ? undefined : arguments[2]\n\tconst deps = arguments.length === 3 ? arguments[2] : arguments[3]\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\treturn useMemo(() => computed(`useComputed(${name})`, compute, opts), deps)\n}\n", "import { useEffect } from 'react'\nimport { EMPTY_ARRAY, EffectScheduler } from '../core'\n\n/** @public */\nexport function useQuickReactor(name: string, reactFn: () => void, deps: any[] = EMPTY_ARRAY) {\n\tuseEffect(() => {\n\t\tconst scheduler = new EffectScheduler(name, reactFn)\n\t\tscheduler.attach()\n\t\tscheduler.execute()\n\t\treturn () => {\n\t\t\tscheduler.detach()\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, deps)\n}\n", "import { useEffect, useMemo } from 'react'\nimport { EffectScheduler } from '../core'\n\n/** @public */\nexport function useReactor(name: string, reactFn: () => void, deps: undefined | any[] = []) {\n\tconst scheduler = useMemo(\n\t\t() => new EffectScheduler(name, reactFn, { scheduleEffect: (cb) => requestAnimationFrame(cb) }),\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\tdeps\n\t)\n\n\tuseEffect(() => {\n\t\tscheduler.attach()\n\t\tscheduler.execute()\n\t\treturn () => {\n\t\t\tscheduler.detach()\n\t\t}\n\t}, [scheduler])\n}\n", "/* eslint-disable prefer-rest-params */\nimport { useMemo, useRef, useSyncExternalStore } from 'react'\nimport { Signal, computed, react } from '../core'\n\n/**\n * Extracts the value from a signal and subscribes to it.\n *\n * Note that you do not need to use this hook if you are wrapping the component with [[track]]\n *\n * @example\n * ```ts\n * const Counter: React.FC = () => {\n *   const $count = useAtom('count', 0)\n *   const increment = useCallback(() => $count.set($count.get() + 1), [count])\n *   const currentCount = useValue($count)\n *   return <button onClick={increment}>{currentCount}</button>\n * }\n * ```\n *\n * You can also pass a function to compute the value and it will be memoized as in [[useComputed]]:\n *\n * @example\n * ```ts\n * type GreeterProps = {\n *   firstName: Signal<string>\n *   lastName: Signal<string>\n * }\n *\n * const Greeter = track(function Greeter({ firstName, lastName }: GreeterProps) {\n *   const fullName = useValue('fullName', () => `${firstName.get()} ${lastName.get()}`, [\n *     firstName,\n *     lastName,\n *   ])\n *   return <div>Hello {fullName}!</div>\n * })\n * ```\n *\n * @public\n */\nexport function useValue<Value>(value: Signal<Value>): Value\n/** @public */\nexport function useValue<Value>(name: string, fn: () => Value, deps: unknown[]): Value\n/** @public */\nexport function useValue() {\n\tconst args = arguments\n\t// deps will be either the computed or the deps array\n\tconst deps = args.length === 3 ? args[2] : [args[0]]\n\tconst name = args.length === 3 ? args[0] : `useValue(${args[0].name})`\n\n\tconst isInRender = useRef(true)\n\tisInRender.current = true\n\n\tconst $val = useMemo(() => {\n\t\tif (args.length === 1) {\n\t\t\treturn args[0]\n\t\t}\n\t\treturn computed(name, () => {\n\t\t\tif (isInRender.current) {\n\t\t\t\treturn args[1]()\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\treturn args[1]()\n\t\t\t\t} catch {\n\t\t\t\t\t// when getSnapshot is called outside of the render phase &\n\t\t\t\t\t// subsequently throws an error, it might be because we're\n\t\t\t\t\t// in a zombie-child state. in that case, we suppress the\n\t\t\t\t\t// error and instead return a new dummy value to trigger a\n\t\t\t\t\t// react re-render. if we were in a zombie child, react will\n\t\t\t\t\t// unmount us instead of re-rendering so the error is\n\t\t\t\t\t// irrelevant. if we're not in a zombie-child, react will\n\t\t\t\t\t// call `getSnapshot` again in the render phase, and the\n\t\t\t\t\t// error will be thrown as expected.\n\t\t\t\t\treturn {}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, deps)\n\n\ttry {\n\t\tconst { subscribe, getSnapshot } = useMemo(() => {\n\t\t\treturn {\n\t\t\t\tsubscribe: (listen: () => void) => {\n\t\t\t\t\treturn react(`useValue(${name})`, () => {\n\t\t\t\t\t\t$val.get()\n\t\t\t\t\t\tlisten()\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tgetSnapshot: () => $val.get(),\n\t\t\t}\n\t\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\t}, [$val])\n\n\t\treturn useSyncExternalStore(subscribe, getSnapshot, getSnapshot)\n\t} finally {\n\t\tisInRender.current = false\n\t}\n}\n", "import { CollectionDiff } from './Store'\n\n/**\n * A class that can be used to incrementally construct a set of records.\n *\n * @internal\n */\nexport class IncrementalSetConstructor<T> {\n\t/**\n\t * The next value of the set.\n\t *\n\t * @internal\n\t */\n\tprivate nextValue?: Set<T>\n\n\t/**\n\t * The diff of the set.\n\t *\n\t * @internal\n\t */\n\tprivate diff?: CollectionDiff<T>\n\n\tconstructor(\n\t\t/**\n\t\t * The previous value of the set.\n\t\t *\n\t\t * @internal\n\t\t * @readonly\n\t\t */\n\t\tprivate readonly previousValue: Set<T>\n\t) {}\n\n\t/**\n\t * Get the next value of the set.\n\t *\n\t * @public\n\t */\n\tpublic get() {\n\t\tconst numRemoved = this.diff?.removed?.size ?? 0\n\t\tconst numAdded = this.diff?.added?.size ?? 0\n\t\tif (numRemoved === 0 && numAdded === 0) {\n\t\t\treturn undefined\n\t\t}\n\t\treturn { value: this.nextValue!, diff: this.diff! }\n\t}\n\n\t/**\n\t * Add an item to the set.\n\t *\n\t * @param item - The item to add.\n\t * @param wasAlreadyPresent - Whether the item was already present in the set.\n\t * @internal\n\t */\n\tprivate _add(item: T, wasAlreadyPresent: boolean) {\n\t\tthis.nextValue ??= new Set(this.previousValue)\n\t\tthis.nextValue.add(item)\n\n\t\tthis.diff ??= {}\n\t\tif (wasAlreadyPresent) {\n\t\t\tthis.diff.removed?.delete(item)\n\t\t} else {\n\t\t\tthis.diff.added ??= new Set()\n\t\t\tthis.diff.added.add(item)\n\t\t}\n\t}\n\n\t/**\n\t * Add an item to the set.\n\t *\n\t * @param item - The item to add.\n\t * @public\n\t */\n\tadd(item: T) {\n\t\tconst wasAlreadyPresent = this.previousValue.has(item)\n\t\tif (wasAlreadyPresent) {\n\t\t\tconst wasRemoved = this.diff?.removed?.has(item)\n\t\t\t// if it wasn't removed during the lifetime of this set constructor, there's no need to add it again\n\t\t\tif (!wasRemoved) return\n\t\t\treturn this._add(item, wasAlreadyPresent)\n\t\t}\n\t\tconst isCurrentlyPresent = this.nextValue?.has(item)\n\t\t// if it's already there, no need to add it again\n\t\tif (isCurrentlyPresent) return\n\t\t// otherwise add it\n\t\tthis._add(item, wasAlreadyPresent)\n\t}\n\n\t/**\n\t * Remove an item from the set.\n\t *\n\t * @param item - The item to remove.\n\t * @param wasAlreadyPresent - Whether the item was already present in the set.\n\t * @internal\n\t */\n\tprivate _remove(item: T, wasAlreadyPresent: boolean) {\n\t\tthis.nextValue ??= new Set(this.previousValue)\n\t\tthis.nextValue.delete(item)\n\n\t\tthis.diff ??= {}\n\t\tif (wasAlreadyPresent) {\n\t\t\t// it was in the original set, so we need to add it to the removed diff\n\t\t\tthis.diff.removed ??= new Set()\n\t\t\tthis.diff.removed.add(item)\n\t\t} else {\n\t\t\t// if it was added during the lifetime of this set constructor, we need to remove it from the added diff\n\t\t\tthis.diff.added?.delete(item)\n\t\t}\n\t}\n\n\t/**\n\t * Remove an item from the set.\n\t *\n\t * @param item - The item to remove.\n\t * @public\n\t */\n\tremove(item: T) {\n\t\tconst wasAlreadyPresent = this.previousValue.has(item)\n\t\tif (!wasAlreadyPresent) {\n\t\t\tconst wasAdded = this.diff?.added?.has(item)\n\t\t\t// if it wasn't added during the lifetime of this set constructor, there's no need to remove it\n\t\t\tif (!wasAdded) return\n\t\t\treturn this._remove(item, wasAlreadyPresent)\n\t\t}\n\t\tconst hasAlreadyBeenRemoved = this.diff?.removed?.has(item)\n\t\t// if it's already removed, no need to remove it again\n\t\tif (hasAlreadyBeenRemoved) return\n\t\t// otherwise remove it\n\t\tthis._remove(item, wasAlreadyPresent)\n\t}\n}\n", "/**\n * Rotate the contents of an array.\n *\n * @public\n */\nexport function rotateArray<T>(arr: T[], offset: number): T[] {\n\treturn arr.map((_, i) => arr[(i + offset) % arr.length])\n}\n\n/**\n * Deduplicate the items in an array\n *\n * @public\n */\nexport function dedupe<T>(input: T[], equals?: (a: any, b: any) => boolean): T[] {\n\tconst result: T[] = []\n\tmainLoop: for (const item of input) {\n\t\tfor (const existing of result) {\n\t\t\tif (equals ? equals(item, existing) : item === existing) {\n\t\t\t\tcontinue mainLoop\n\t\t\t}\n\t\t}\n\t\tresult.push(item)\n\t}\n\treturn result\n}\n\n/** @internal */\nexport function compact<T>(arr: T[]): NonNullable<T>[] {\n\treturn arr.filter((i) => i !== undefined && i !== null) as any\n}\n\n/** @internal */\nexport function last<T>(arr: readonly T[]): T | undefined {\n\treturn arr[arr.length - 1]\n}\n\n/** @internal */\nexport function minBy<T>(arr: readonly T[], fn: (item: T) => number): T | undefined {\n\tlet min: T | undefined\n\tlet minVal = Infinity\n\tfor (const item of arr) {\n\t\tconst val = fn(item)\n\t\tif (val < minVal) {\n\t\t\tmin = item\n\t\t\tminVal = val\n\t\t}\n\t}\n\treturn min\n}\n\n/**\n * Partitions an array into two arrays, one with items that satisfy the predicate, and one with\n * items that do not.\n *\n * @param arr - The array to partition\n * @param predicate - The predicate to use to partition the array\n * @returns A tuple of two arrays, the first one with items that satisfy the predicate and the\n *   second one with the ones that dont\n * @internal\n */\nexport function partition<T>(arr: T[], predicate: (item: T) => boolean): [T[], T[]] {\n\tconst satisfies: T[] = []\n\tconst doesNotSatisfy: T[] = []\n\tfor (const item of arr) {\n\t\tif (predicate(item)) {\n\t\t\tsatisfies.push(item)\n\t\t} else {\n\t\t\tdoesNotSatisfy.push(item)\n\t\t}\n\t}\n\treturn [satisfies, doesNotSatisfy]\n}\n\n/** @internal */\nexport function areArraysShallowEqual<T>(arr1: readonly T[], arr2: readonly T[]): boolean {\n\tif (arr1 === arr2) return true\n\tif (arr1.length !== arr2.length) return false\n\tfor (let i = 0; i < arr1.length; i++) {\n\t\tif (!Object.is(arr1[i], arr2[i])) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n", "/**\n * Throttle a function.\n *\n * @example\n *\n * ```ts\n * const A = throttle(myFunction, 1000)\n * ```\n *\n * @public\n * @see source - https://github.com/bameyrick/throttle-typescript\n */\nexport function throttle<T extends (...args: any) => any>(\n\tfunc: T,\n\tlimit: number\n): (...args: Parameters<T>) => ReturnType<T> {\n\tlet inThrottle: boolean\n\tlet lastResult: ReturnType<T>\n\treturn function (this: any, ...args: any[]): ReturnType<T> {\n\t\tif (!inThrottle) {\n\t\t\tinThrottle = true\n\t\t\tsetTimeout(() => (inThrottle = false), limit)\n\t\t\tlastResult = func(...args)\n\t\t}\n\t\treturn lastResult\n\t}\n}\n\n/**\n * When a function is wrapped in `omitFromStackTrace`, if it throws an error the stack trace won't\n * include the function itself or any stack frames above it. Useful for assertion-style function\n * where the error will ideally originate from the call-site rather than within the implementation\n * of the assert fn.\n *\n * Only works in platforms that support `Error.captureStackTrace` (ie v8).\n *\n * @internal\n */\nexport function omitFromStackTrace<Args extends Array<unknown>, Return>(\n\tfn: (...args: Args) => Return\n): (...args: Args) => Return {\n\tconst wrappedFn = (...args: Args) => {\n\t\ttry {\n\t\t\treturn fn(...args)\n\t\t} catch (error) {\n\t\t\tif (error instanceof Error && Error.captureStackTrace) {\n\t\t\t\tError.captureStackTrace(error, wrappedFn)\n\t\t\t}\n\t\t\tthrow error\n\t\t}\n\t}\n\n\treturn wrappedFn\n}\n\n/**\n * Does nothing, but it's really really good at it.\n * @internal\n */\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nexport function noop(): void {}\n", "import { omitFromStackTrace } from './function'\n\n/** @public */\nexport type OkResult<T> = { readonly ok: true; readonly value: T }\n/** @public */\nexport type ErrorResult<E> = { readonly ok: false; readonly error: E }\n/** @public */\nexport type Result<T, E> = OkResult<T> | ErrorResult<E>\n\n/** @public */\nexport const Result = {\n\tok<T>(value: T): OkResult<T> {\n\t\treturn { ok: true, value }\n\t},\n\terr<E>(error: E): ErrorResult<E> {\n\t\treturn { ok: false, error }\n\t},\n}\n\n/** @internal */\nexport function exhaustiveSwitchError(value: never, property?: string): never {\n\tconst debugValue =\n\t\tproperty && value && typeof value === 'object' && property in value ? value[property] : value\n\tthrow new Error(`Unknown switch case ${debugValue}`)\n}\n\n/** @internal */\nexport const assert: (value: unknown, message?: string) => asserts value = omitFromStackTrace(\n\t(value, message) => {\n\t\tif (!value) {\n\t\t\tthrow new Error(message || 'Assertion Error')\n\t\t}\n\t}\n)\n\n/** @internal */\nexport const assertExists = omitFromStackTrace(<T>(value: T, message?: string): NonNullable<T> => {\n\t// note that value == null is equivilent to value === null || value === undefined\n\tif (value == null) {\n\t\tthrow new Error(message ?? 'value must be defined')\n\t}\n\treturn value as NonNullable<T>\n})\n\n/** @internal */\nexport function promiseWithResolve<T>(): Promise<T> & {\n\tresolve: (value: T) => void\n\treject: (reason?: any) => void\n} {\n\tlet resolve: (value: T) => void\n\tlet reject: (reason?: any) => void\n\tconst promise = new Promise<T>((res, rej) => {\n\t\tresolve = res\n\t\treject = rej\n\t})\n\treturn Object.assign(promise, {\n\t\tresolve: resolve!,\n\t\treject: reject!,\n\t})\n}\n", "/**\n * Debounce a function.\n *\n * @example\n *\n * ```ts\n * const A = debounce(myFunction, 1000)\n * ```\n *\n * @public\n * @see source - https://gist.github.com/ca0v/73a31f57b397606c9813472f7493a940\n */\nexport function debounce<T extends unknown[], U>(\n\tcallback: (...args: T) => PromiseLike<U> | U,\n\twait: number\n) {\n\tlet state:\n\t\t| undefined\n\t\t| {\n\t\t\t\ttimeout: ReturnType<typeof setTimeout>\n\t\t\t\tpromise: Promise<U>\n\t\t\t\tresolve: (value: U | PromiseLike<U>) => void\n\t\t\t\treject: (value: any) => void\n\t\t\t\tlatestArgs: T\n\t\t  } = undefined\n\n\tconst fn = (...args: T): Promise<U> => {\n\t\tif (!state) {\n\t\t\tstate = {} as any\n\t\t\tstate!.promise = new Promise((resolve, reject) => {\n\t\t\t\tstate!.resolve = resolve\n\t\t\t\tstate!.reject = reject\n\t\t\t})\n\t\t}\n\t\tclearTimeout(state!.timeout)\n\t\tstate!.latestArgs = args\n\t\tstate!.timeout = setTimeout(() => {\n\t\t\tconst s = state!\n\t\t\tstate = undefined\n\t\t\ttry {\n\t\t\t\ts.resolve(callback(...s.latestArgs))\n\t\t\t} catch (e) {\n\t\t\t\ts.reject(e)\n\t\t\t}\n\t\t}, wait)\n\n\t\treturn state!.promise\n\t}\n\tfn.cancel = () => {\n\t\tif (!state) return\n\t\tclearTimeout(state.timeout)\n\t}\n\treturn fn\n}\n", "type ErrorAnnotations = {\n\ttags: Record<string, number | string | boolean | bigint | symbol | null | undefined>\n\textras: Record<string, unknown>\n}\n\nconst annotationsByError = new WeakMap<object, ErrorAnnotations>()\n\n/**\n * Annotate an error with tags and additional data. Annotations won't overwrite existing ones.\n * Retrieve them with `getErrorAnnotations`.\n *\n * @internal\n */\nexport function annotateError(error: unknown, annotations: Partial<ErrorAnnotations>) {\n\tif (typeof error !== 'object' || error === null) return\n\n\tlet currentAnnotations = annotationsByError.get(error)\n\tif (!currentAnnotations) {\n\t\tcurrentAnnotations = { tags: {}, extras: {} }\n\t\tannotationsByError.set(error, currentAnnotations)\n\t}\n\n\tif (annotations.tags) {\n\t\tcurrentAnnotations.tags = {\n\t\t\t...currentAnnotations.tags,\n\t\t\t...annotations.tags,\n\t\t}\n\t}\n\tif (annotations.extras) {\n\t\tcurrentAnnotations.extras = {\n\t\t\t...currentAnnotations.extras,\n\t\t\t...annotations.extras,\n\t\t}\n\t}\n}\n\n/** @internal */\nexport function getErrorAnnotations(error: Error): ErrorAnnotations {\n\treturn annotationsByError.get(error) ?? { tags: {}, extras: {} }\n}\n", "/**\n * Helpers for files\n *\n * @public\n */\nexport class FileHelpers {\n\t/**\n\t * @param dataURL - The file as a string.\n\t *\n\t * from https://stackoverflow.com/a/53817185\n\t */\n\tstatic async dataUrlToArrayBuffer(dataURL: string) {\n\t\treturn fetch(dataURL).then(function (result) {\n\t\t\treturn result.arrayBuffer()\n\t\t})\n\t}\n\n\t/**\n\t * Convert a file to a base64 encoded data url.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const A = FileHelpers.toDataUrl(myImageFile)\n\t * ```\n\t *\n\t * @param value - The file as a blob.\n\t */\n\tstatic async blobToDataUrl(file: Blob): Promise<string> {\n\t\treturn await new Promise((resolve, reject) => {\n\t\t\tif (file) {\n\t\t\t\tconst reader = new FileReader()\n\t\t\t\treader.onload = () => resolve(reader.result as string)\n\t\t\t\treader.onerror = (error) => reject(error)\n\t\t\t\treader.onabort = (error) => reject(error)\n\t\t\t\treader.readAsDataURL(file)\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * Convert a file to a unicode text string.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const A = FileHelpers.fileToDataUrl(myTextFile)\n\t * ```\n\t *\n\t * @param value - The file as a blob.\n\t */\n\tstatic async blobToText(file: Blob): Promise<string> {\n\t\treturn await new Promise((resolve, reject) => {\n\t\t\tif (file) {\n\t\t\t\tconst reader = new FileReader()\n\t\t\t\treader.onload = () => resolve(reader.result as string)\n\t\t\t\treader.onerror = (error) => reject(error)\n\t\t\t\treader.onabort = (error) => reject(error)\n\t\t\t\treader.readAsText(file)\n\t\t\t}\n\t\t})\n\t}\n}\n", "/**\n * Hash a string using the FNV-1a algorithm.\n *\n * @public\n */\nexport function getHashForString(string: string) {\n\tlet hash = 0\n\tfor (let i = 0; i < string.length; i++) {\n\t\thash = (hash << 5) - hash + string.charCodeAt(i)\n\t\thash |= 0 // Convert to 32bit integer\n\t}\n\treturn hash + ''\n}\n\n/**\n * Hash a string using the FNV-1a algorithm.\n *\n * @public\n */\nexport function getHashForObject(obj: any) {\n\treturn getHashForString(JSON.stringify(obj))\n}\n\n/**\n * Hash an ArrayBuffer using the FNV-1a algorithm.\n *\n * @public\n */\nexport function getHashForBuffer(buffer: ArrayBuffer) {\n\tconst view = new DataView(buffer)\n\tlet hash = 0\n\tfor (let i = 0; i < view.byteLength; i++) {\n\t\thash = (hash << 5) - hash + view.getUint8(i)\n\t\thash |= 0 // Convert to 32bit integer\n\t}\n\treturn hash + ''\n}\n\n/** @public */\nexport function lns(str: string) {\n\tconst result = str.split('')\n\tresult.push(...result.splice(0, Math.round(result.length / 5)))\n\tresult.push(...result.splice(0, Math.round(result.length / 4)))\n\tresult.push(...result.splice(0, Math.round(result.length / 3)))\n\tresult.push(...result.splice(0, Math.round(result.length / 2)))\n\treturn result\n\t\t.reverse()\n\t\t.map((n) => (+n ? (+n < 5 ? 5 + +n : +n > 5 ? +n - 5 : n) : n))\n\t\t.join('')\n}\n", "/**\n * Get the first item from an iterable Set or Map.\n *\n * @example\n *\n * ```ts\n * const A = getFirstItem(new Set([1, 2, 3])) // 1\n * const B = getFirstItem(\n * \tnew Map([\n * \t\t['a', 1],\n * \t\t['b', 2],\n * \t])\n * ) // 1\n * ```\n *\n * @param value - The iterable Set or Map.\n * @public\n */\nexport function getFirstFromIterable<T = unknown>(set: Set<T> | Map<any, T>): T {\n\treturn set.values().next().value\n}\n", "type BufferInput = string | ArrayBuffer | Buffer\n\ninterface CRCCalculator<T = BufferInput | Uint8Array> {\n\t(value: T, previous?: number): number\n}\n\nlet TABLE: Array<number> | Int32Array = [\n\t0x00000000, 0x77073096, 0xee0e612c, 0x990951ba, 0x076dc419, 0x706af48f, 0xe963a535, 0x9e6495a3,\n\t0x0edb8832, 0x79dcb8a4, 0xe0d5e91e, 0x97d2d988, 0x09b64c2b, 0x7eb17cbd, 0xe7b82d07, 0x90bf1d91,\n\t0x1db71064, 0x6ab020f2, 0xf3b97148, 0x84be41de, 0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7,\n\t0x136c9856, 0x646ba8c0, 0xfd62f97a, 0x8a65c9ec, 0x14015c4f, 0x63066cd9, 0xfa0f3d63, 0x8d080df5,\n\t0x3b6e20c8, 0x4c69105e, 0xd56041e4, 0xa2677172, 0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b,\n\t0x35b5a8fa, 0x42b2986c, 0xdbbbc9d6, 0xacbcf940, 0x32d86ce3, 0x45df5c75, 0xdcd60dcf, 0xabd13d59,\n\t0x26d930ac, 0x51de003a, 0xc8d75180, 0xbfd06116, 0x21b4f4b5, 0x56b3c423, 0xcfba9599, 0xb8bda50f,\n\t0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924, 0x2f6f7c87, 0x58684c11, 0xc1611dab, 0xb6662d3d,\n\t0x76dc4190, 0x01db7106, 0x98d220bc, 0xefd5102a, 0x71b18589, 0x06b6b51f, 0x9fbfe4a5, 0xe8b8d433,\n\t0x7807c9a2, 0x0f00f934, 0x9609a88e, 0xe10e9818, 0x7f6a0dbb, 0x086d3d2d, 0x91646c97, 0xe6635c01,\n\t0x6b6b51f4, 0x1c6c6162, 0x856530d8, 0xf262004e, 0x6c0695ed, 0x1b01a57b, 0x8208f4c1, 0xf50fc457,\n\t0x65b0d9c6, 0x12b7e950, 0x8bbeb8ea, 0xfcb9887c, 0x62dd1ddf, 0x15da2d49, 0x8cd37cf3, 0xfbd44c65,\n\t0x4db26158, 0x3ab551ce, 0xa3bc0074, 0xd4bb30e2, 0x4adfa541, 0x3dd895d7, 0xa4d1c46d, 0xd3d6f4fb,\n\t0x4369e96a, 0x346ed9fc, 0xad678846, 0xda60b8d0, 0x44042d73, 0x33031de5, 0xaa0a4c5f, 0xdd0d7cc9,\n\t0x5005713c, 0x270241aa, 0xbe0b1010, 0xc90c2086, 0x5768b525, 0x206f85b3, 0xb966d409, 0xce61e49f,\n\t0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4, 0x59b33d17, 0x2eb40d81, 0xb7bd5c3b, 0xc0ba6cad,\n\t0xedb88320, 0x9abfb3b6, 0x03b6e20c, 0x74b1d29a, 0xead54739, 0x9dd277af, 0x04db2615, 0x73dc1683,\n\t0xe3630b12, 0x94643b84, 0x0d6d6a3e, 0x7a6a5aa8, 0xe40ecf0b, 0x9309ff9d, 0x0a00ae27, 0x7d079eb1,\n\t0xf00f9344, 0x8708a3d2, 0x1e01f268, 0x6906c2fe, 0xf762575d, 0x806567cb, 0x196c3671, 0x6e6b06e7,\n\t0xfed41b76, 0x89d32be0, 0x10da7a5a, 0x67dd4acc, 0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5,\n\t0xd6d6a3e8, 0xa1d1937e, 0x38d8c2c4, 0x4fdff252, 0xd1bb67f1, 0xa6bc5767, 0x3fb506dd, 0x48b2364b,\n\t0xd80d2bda, 0xaf0a1b4c, 0x36034af6, 0x41047a60, 0xdf60efc3, 0xa867df55, 0x316e8eef, 0x4669be79,\n\t0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236, 0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f,\n\t0xc5ba3bbe, 0xb2bd0b28, 0x2bb45a92, 0x5cb36a04, 0xc2d7ffa7, 0xb5d0cf31, 0x2cd99e8b, 0x5bdeae1d,\n\t0x9b64c2b0, 0xec63f226, 0x756aa39c, 0x026d930a, 0x9c0906a9, 0xeb0e363f, 0x72076785, 0x05005713,\n\t0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0x0cb61b38, 0x92d28e9b, 0xe5d5be0d, 0x7cdcefb7, 0x0bdbdf21,\n\t0x86d3d2d4, 0xf1d4e242, 0x68ddb3f8, 0x1fda836e, 0x81be16cd, 0xf6b9265b, 0x6fb077e1, 0x18b74777,\n\t0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c, 0x8f659eff, 0xf862ae69, 0x616bffd3, 0x166ccf45,\n\t0xa00ae278, 0xd70dd2ee, 0x4e048354, 0x3903b3c2, 0xa7672661, 0xd06016f7, 0x4969474d, 0x3e6e77db,\n\t0xaed16a4a, 0xd9d65adc, 0x40df0b66, 0x37d83bf0, 0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9,\n\t0xbdbdf21c, 0xcabac28a, 0x53b39330, 0x24b4a3a6, 0xbad03605, 0xcdd70693, 0x54de5729, 0x23d967bf,\n\t0xb3667a2e, 0xc4614ab8, 0x5d681b02, 0x2a6f2b94, 0xb40bbe37, 0xc30c8ea1, 0x5a05df1b, 0x2d02ef8d,\n]\n\nif (typeof Int32Array !== 'undefined') {\n\tTABLE = new Int32Array(TABLE)\n}\n\n// crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts\nconst crc: CRCCalculator<Uint8Array> = (current, previous) => {\n\tlet crc = previous === 0 ? 0 : ~~previous! ^ -1\n\n\tfor (let index = 0; index < current.length; index++) {\n\t\tcrc = TABLE[(crc ^ current[index]) & 0xff] ^ (crc >>> 8)\n\t}\n\n\treturn crc ^ -1\n}\n\nconst LEN_SIZE = 4\nconst CRC_SIZE = 4\n\n/** @public */\nexport class PngHelpers {\n\tstatic isPng(view: DataView, offset: number) {\n\t\tif (\n\t\t\tview.getUint8(offset + 0) === 0x89 &&\n\t\t\tview.getUint8(offset + 1) === 0x50 &&\n\t\t\tview.getUint8(offset + 2) === 0x4e &&\n\t\t\tview.getUint8(offset + 3) === 0x47 &&\n\t\t\tview.getUint8(offset + 4) === 0x0d &&\n\t\t\tview.getUint8(offset + 5) === 0x0a &&\n\t\t\tview.getUint8(offset + 6) === 0x1a &&\n\t\t\tview.getUint8(offset + 7) === 0x0a\n\t\t) {\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t}\n\n\tstatic getChunkType(view: DataView, offset: number) {\n\t\treturn [\n\t\t\tString.fromCharCode(view.getUint8(offset)),\n\t\t\tString.fromCharCode(view.getUint8(offset + 1)),\n\t\t\tString.fromCharCode(view.getUint8(offset + 2)),\n\t\t\tString.fromCharCode(view.getUint8(offset + 3)),\n\t\t].join('')\n\t}\n\n\tstatic readChunks(view: DataView, offset = 0) {\n\t\tconst chunks: Record<string, { dataOffset: number; size: number; start: number }> = {}\n\t\tif (!PngHelpers.isPng(view, offset)) {\n\t\t\tthrow new Error('Not a PNG')\n\t\t}\n\t\toffset += 8\n\n\t\twhile (offset <= view.buffer.byteLength) {\n\t\t\tconst start = offset\n\t\t\tconst len = view.getInt32(offset)\n\t\t\toffset += 4\n\t\t\tconst chunkType = PngHelpers.getChunkType(view, offset)\n\n\t\t\tif (chunkType === 'IDAT' && chunks[chunkType]) {\n\t\t\t\toffset += len + LEN_SIZE + CRC_SIZE\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (chunkType === 'IEND') {\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tchunks[chunkType] = {\n\t\t\t\tstart,\n\t\t\t\tdataOffset: offset + 4,\n\t\t\t\tsize: len,\n\t\t\t}\n\t\t\toffset += len + LEN_SIZE + CRC_SIZE\n\t\t}\n\n\t\treturn chunks\n\t}\n\n\tstatic parsePhys(view: DataView, offset: number) {\n\t\treturn {\n\t\t\tppux: view.getUint32(offset),\n\t\t\tppuy: view.getUint32(offset + 4),\n\t\t\tunit: view.getUint8(offset + 4),\n\t\t}\n\t}\n\n\tstatic findChunk(view: DataView, type: string) {\n\t\tconst chunks = PngHelpers.readChunks(view)\n\t\treturn chunks[type]\n\t}\n\n\tstatic setPhysChunk(view: DataView, dpr = 1, options?: BlobPropertyBag) {\n\t\tlet offset = 46\n\t\tlet size = 0\n\t\tconst res1 = PngHelpers.findChunk(view, 'pHYs')\n\t\tif (res1) {\n\t\t\toffset = res1.start\n\t\t\tsize = res1.size\n\t\t}\n\n\t\tconst res2 = PngHelpers.findChunk(view, 'IDAT')\n\t\tif (res2) {\n\t\t\toffset = res2.start\n\t\t\tsize = 0\n\t\t}\n\n\t\tconst pHYsData = new ArrayBuffer(21)\n\t\tconst pHYsDataView = new DataView(pHYsData)\n\n\t\tpHYsDataView.setUint32(0, 9)\n\n\t\tpHYsDataView.setUint8(4, 'p'.charCodeAt(0))\n\t\tpHYsDataView.setUint8(5, 'H'.charCodeAt(0))\n\t\tpHYsDataView.setUint8(6, 'Y'.charCodeAt(0))\n\t\tpHYsDataView.setUint8(7, 's'.charCodeAt(0))\n\n\t\tconst DPI_96 = 2835.5\n\n\t\tpHYsDataView.setInt32(8, DPI_96 * dpr)\n\t\tpHYsDataView.setInt32(12, DPI_96 * dpr)\n\t\tpHYsDataView.setInt8(16, 1)\n\n\t\tconst crcBit = new Uint8Array(pHYsData.slice(4, 17))\n\t\tpHYsDataView.setInt32(17, crc(crcBit))\n\n\t\tconst startBuf = view.buffer.slice(0, offset)\n\t\tconst endBuf = view.buffer.slice(offset + size)\n\n\t\treturn new Blob([startBuf, pHYsData, endBuf], options)\n\t}\n}\n", "import { PngHelpers } from './png'\n\n/**\n * Helpers for media\n *\n * @public\n */\nexport class MediaHelpers {\n\t/**\n\t * Load a video from a url.\n\t * @public\n\t */\n\tstatic loadVideo(src: string): Promise<HTMLVideoElement> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst video = document.createElement('video')\n\t\t\tvideo.onloadeddata = () => resolve(video)\n\t\t\tvideo.onerror = (e) => {\n\t\t\t\tconsole.error(e)\n\t\t\t\treject(new Error('Could not load video'))\n\t\t\t}\n\t\t\tvideo.crossOrigin = 'anonymous'\n\t\t\tvideo.src = src\n\t\t})\n\t}\n\n\t/**\n\t * Load an image from a url.\n\t * @public\n\t */\n\tstatic loadImage(src: string): Promise<HTMLImageElement> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst img = new Image()\n\t\t\timg.onload = () => resolve(img)\n\t\t\timg.onerror = (e) => {\n\t\t\t\tconsole.error(e)\n\t\t\t\treject(new Error('Could not load image'))\n\t\t\t}\n\t\t\timg.crossOrigin = 'anonymous'\n\t\t\timg.src = src\n\t\t})\n\t}\n\n\t/**\n\t * Get the size of a video blob\n\t *\n\t * @param src - A SharedBlob containing the video\n\t * @public\n\t */\n\tstatic async getVideoSize(blob: Blob): Promise<{ w: number; h: number }> {\n\t\treturn MediaHelpers.usingObjectURL(blob, async (url) => {\n\t\t\tconst video = await MediaHelpers.loadVideo(url)\n\t\t\treturn { w: video.videoWidth, h: video.videoHeight }\n\t\t})\n\t}\n\n\t/**\n\t * Get the size of an image blob\n\t *\n\t * @param dataURL - A Blob containing the image.\n\t * @public\n\t */\n\tstatic async getImageSize(blob: Blob): Promise<{ w: number; h: number }> {\n\t\tconst image = await MediaHelpers.usingObjectURL(blob, MediaHelpers.loadImage)\n\n\t\ttry {\n\t\t\tif (blob.type === 'image/png') {\n\t\t\t\tconst view = new DataView(await blob.arrayBuffer())\n\t\t\t\tif (PngHelpers.isPng(view, 0)) {\n\t\t\t\t\tconst physChunk = PngHelpers.findChunk(view, 'pHYs')\n\t\t\t\t\tif (physChunk) {\n\t\t\t\t\t\tconst physData = PngHelpers.parsePhys(view, physChunk.dataOffset)\n\t\t\t\t\t\tif (physData.unit === 0 && physData.ppux === physData.ppuy) {\n\t\t\t\t\t\t\tconst pixelRatio = Math.max(physData.ppux / 2834.5, 1)\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tw: Math.round(image.naturalWidth / pixelRatio),\n\t\t\t\t\t\t\t\th: Math.round(image.naturalHeight / pixelRatio),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error(err)\n\t\t\treturn { w: image.naturalWidth, h: image.naturalHeight }\n\t\t}\n\t\treturn { w: image.naturalWidth, h: image.naturalHeight }\n\t}\n\n\tstatic async usingObjectURL<T>(blob: Blob, fn: (url: string) => Promise<T>): Promise<T> {\n\t\tconst url = URL.createObjectURL(blob)\n\t\ttry {\n\t\t\treturn await fn(url)\n\t\t} finally {\n\t\t\tURL.revokeObjectURL(url)\n\t\t}\n\t}\n}\n", "/**\n * Linear interpolate between two values.\n *\n * @example\n *\n * ```ts\n * const A = lerp(0, 1, 0.5)\n * ```\n *\n * @public\n */\nexport function lerp(a: number, b: number, t: number) {\n\treturn a + (b - a) * t\n}\n\n/**\n * Inverse lerp between two values. Given a value `n` in the range [a, b], returns a number between\n * 0 and 1.\n *\n * @public\n */\nexport function invLerp(a: number, b: number, t: number) {\n\treturn (t - a) / (b - a)\n}\n\n/**\n * Seeded random number generator, using [xorshift](https://en.wikipedia.org/wiki/Xorshift). The\n * result will always be betweeen -1 and 1.\n *\n * Adapted from [seedrandom](https://github.com/davidbau/seedrandom).\n *\n * @public\n */\nexport function rng(seed = '') {\n\tlet x = 0\n\tlet y = 0\n\tlet z = 0\n\tlet w = 0\n\n\tfunction next() {\n\t\tconst t = x ^ (x << 11)\n\t\tx = y\n\t\ty = z\n\t\tz = w\n\t\tw ^= ((w >>> 19) ^ t ^ (t >>> 8)) >>> 0\n\t\treturn (w / 0x100000000) * 2\n\t}\n\n\tfor (let k = 0; k < seed.length + 64; k++) {\n\t\tx ^= seed.charCodeAt(k) | 0\n\t\tnext()\n\t}\n\n\treturn next\n}\n\n/**\n * Modulate a value between two ranges.\n *\n * @example\n *\n * ```ts\n * const A = modulate(0, [0, 1], [0, 100])\n * ```\n *\n * @param value - The interpolation value.\n * @param rangeA - From [low, high]\n * @param rangeB - To [low, high]\n * @param clamp - Whether to clamp the the result to [low, high]\n * @public\n */\nexport function modulate(value: number, rangeA: number[], rangeB: number[], clamp = false): number {\n\tconst [fromLow, fromHigh] = rangeA\n\tconst [v0, v1] = rangeB\n\tconst result = v0 + ((value - fromLow) / (fromHigh - fromLow)) * (v1 - v0)\n\n\treturn clamp\n\t\t? v0 < v1\n\t\t\t? Math.max(Math.min(result, v1), v0)\n\t\t\t: Math.max(Math.min(result, v0), v1)\n\t\t: result\n}\n", "/** @internal */\nexport function hasOwnProperty(obj: object, key: string): boolean {\n\treturn Object.prototype.hasOwnProperty.call(obj, key)\n}\n\n/** @internal */\nexport function getOwnProperty<K extends string, V>(\n\tobj: Partial<Record<K, V>>,\n\tkey: K\n): V | undefined\n/** @internal */\nexport function getOwnProperty(obj: object, key: string): unknown\n/** @internal */\nexport function getOwnProperty(obj: object, key: string): unknown {\n\tif (!hasOwnProperty(obj, key)) {\n\t\treturn undefined\n\t}\n\t// @ts-expect-error we know the property exists\n\treturn obj[key]\n}\n\n/**\n * An alias for `Object.keys` that treats the object as a map and so preserves the type of the keys.\n *\n * @internal\n */\nexport function objectMapKeys<Key extends string>(object: {\n\treadonly [K in Key]: unknown\n}): Array<Key> {\n\treturn Object.keys(object) as Key[]\n}\n\n/**\n * An alias for `Object.values` that treats the object as a map and so preserves the type of the\n * keys.\n *\n * @internal\n */\nexport function objectMapValues<Key extends string, Value>(object: {\n\t[K in Key]: Value\n}): Array<Value> {\n\treturn Object.values(object) as Value[]\n}\n\n/**\n * An alias for `Object.entries` that treats the object as a map and so preserves the type of the\n * keys.\n *\n * @internal\n */\nexport function objectMapEntries<Key extends string, Value>(object: {\n\t[K in Key]: Value\n}): Array<[Key, Value]> {\n\treturn Object.entries(object) as [Key, Value][]\n}\n\n/**\n * An alias for `Object.fromEntries` that treats the object as a map and so preserves the type of the\n * keys.\n *\n * @internal\n */\nexport function objectMapFromEntries<Key extends string, Value>(\n\tentries: ReadonlyArray<readonly [Key, Value]>\n): { [K in Key]: Value } {\n\treturn Object.fromEntries(entries) as { [K in Key]: Value }\n}\n\n/**\n * Filters an object using a predicate function.\n * @returns a new object with only the entries that pass the predicate\n * @internal\n */\nexport function filterEntries<Key extends string, Value>(\n\tobject: { [K in Key]: Value },\n\tpredicate: (key: Key, value: Value) => boolean\n): { [K in Key]: Value } {\n\tconst result: { [K in Key]?: Value } = {}\n\tlet didChange = false\n\tfor (const [key, value] of objectMapEntries(object)) {\n\t\tif (predicate(key, value)) {\n\t\t\tresult[key] = value\n\t\t} else {\n\t\t\tdidChange = true\n\t\t}\n\t}\n\treturn didChange ? (result as { [K in Key]: Value }) : object\n}\n\n/**\n * Maps the values of one object map to another.\n * @returns a new object with the entries mapped\n * @internal\n */\nexport function mapObjectMapValues<Key extends string, ValueBefore, ValueAfter>(\n\tobject: { readonly [K in Key]: ValueBefore },\n\tmapper: (key: Key, value: ValueBefore) => ValueAfter\n): { [K in Key]: ValueAfter } {\n\tconst result = {} as { [K in Key]: ValueAfter }\n\tfor (const [key, value] of objectMapEntries(object)) {\n\t\tconst newValue = mapper(key, value)\n\t\tresult[key] = newValue\n\t}\n\treturn result\n}\n\n/** @internal */\nexport function areObjectsShallowEqual<T extends Record<string, unknown>>(\n\tobj1: T,\n\tobj2: T\n): boolean {\n\tif (obj1 === obj2) return true\n\tconst keys1 = new Set(Object.keys(obj1))\n\tconst keys2 = new Set(Object.keys(obj2))\n\tif (keys1.size !== keys2.size) return false\n\tfor (const key of keys1) {\n\t\tif (!keys2.has(key)) return false\n\t\tif (!Object.is(obj1[key], obj2[key])) return false\n\t}\n\treturn true\n}\n", "/** @internal */\nexport function measureCbDuration(name: string, cb: () => any) {\n\tconst now = performance.now()\n\tconst result = cb()\n\t// eslint-disable-next-line no-console\n\tconsole.log(`${name} took`, performance.now() - now, 'ms')\n\treturn result\n}\n\n/** @internal */\nexport function measureDuration(_target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n\tconst originalMethod = descriptor.value\n\tdescriptor.value = function (...args: any[]) {\n\t\tconst start = performance.now()\n\t\tconst result = originalMethod.apply(this, args)\n\t\tconst end = performance.now()\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.log(`${propertyKey} took ${end - start}ms `)\n\t\treturn result\n\t}\n\treturn descriptor\n}\n\nconst averages = new Map<any, { total: number; count: number }>()\n\n/** @internal */\nexport function measureAverageDuration(\n\t_target: any,\n\tpropertyKey: string,\n\tdescriptor: PropertyDescriptor\n) {\n\tconst originalMethod = descriptor.value\n\tdescriptor.value = function (...args: any[]) {\n\t\tconst start = performance.now()\n\t\tconst result = originalMethod.apply(this, args)\n\t\tconst end = performance.now()\n\t\tconst length = end - start\n\t\tif (length !== 0) {\n\t\t\tconst value = averages.get(descriptor.value)!\n\t\t\tconst total = value.total + length\n\t\t\tconst count = value.count + 1\n\t\t\taverages.set(descriptor.value, { total, count })\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log(\n\t\t\t\t`${propertyKey} took ${(end - start).toFixed(2)}ms | average ${(total / count).toFixed(2)}ms`\n\t\t\t)\n\t\t}\n\t\treturn result\n\t}\n\taverages.set(descriptor.value, { total: 0, count: 0 })\n\treturn descriptor\n}\n", "// Adapted from https://observablehq.com/@dgreensp/implementing-fractional-indexing\n// by @dgreensp (twitter @DavidLG)\n\nimport { IndexKey } from '../IndexKey'\n\nconst DIGITS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'\nexport const INTEGER_ZERO = 'a0' as IndexKey\nconst SMALLEST_INTEGER = 'A00000000000000000000000000'\n\n/**\n * Get the length of an integer.\n *\n * @param head - The integer to use.\n */\nfunction getIntegerLength(head: string): number {\n\tif (head >= 'a' && head <= 'z') {\n\t\treturn head.charCodeAt(0) - 'a'.charCodeAt(0) + 2\n\t} else if (head >= 'A' && head <= 'Z') {\n\t\treturn 'Z'.charCodeAt(0) - head.charCodeAt(0) + 2\n\t} else {\n\t\tthrow new Error('Invalid index key head: ' + head)\n\t}\n}\n\n/**\n * Validate an integer.\n *\n * @param int - The integer to use.\n */\nfunction validateInteger(int: string): asserts int is string {\n\tif (int.length !== getIntegerLength(int.charAt(0))) {\n\t\tthrow new Error('invalid integer part of index key: ' + int)\n\t}\n}\n\nfunction isNotUndefined(n: string | undefined): asserts n is string {\n\tif (n === undefined) throw Error('n is undefined')\n}\n\n/**\n * Increment an integer.\n *\n * @param x - The integer to increment\n *\n * @internal\n */\nfunction incrementInteger(x: string): string | undefined {\n\tvalidateInteger(x)\n\tconst [head, ...digs] = x.split('')\n\tlet carry = true\n\tfor (let i = digs.length - 1; carry && i >= 0; i--) {\n\t\tconst d = DIGITS.indexOf(digs[i]) + 1\n\t\tif (d === DIGITS.length) {\n\t\t\tdigs[i] = '0'\n\t\t} else {\n\t\t\tdigs[i] = DIGITS.charAt(d)\n\t\t\tcarry = false\n\t\t}\n\t}\n\tif (carry) {\n\t\tif (head === 'Z') return 'a0'\n\t\tif (head === 'z') return undefined\n\t\tconst h = String.fromCharCode(head.charCodeAt(0) + 1)\n\t\tif (h > 'a') {\n\t\t\tdigs.push('0')\n\t\t} else {\n\t\t\tdigs.pop()\n\t\t}\n\t\treturn h + digs.join('')\n\t} else {\n\t\treturn head + digs.join('')\n\t}\n}\n\n/**\n * Decrement an integer.\n *\n * @param x - The integer to decrement\n *\n * @internal\n */\nfunction decrementInteger(x: string): string | undefined {\n\tvalidateInteger(x)\n\tconst [head, ...digs] = x.split('')\n\tlet borrow = true\n\tfor (let i = digs.length - 1; borrow && i >= 0; i--) {\n\t\tconst d = DIGITS.indexOf(digs[i]) - 1\n\t\tif (d === -1) {\n\t\t\tdigs[i] = DIGITS.slice(-1)\n\t\t} else {\n\t\t\tdigs[i] = DIGITS.charAt(d)\n\t\t\tborrow = false\n\t\t}\n\t}\n\tif (borrow) {\n\t\tif (head === 'a') return 'Z' + DIGITS.slice(-1)\n\t\tif (head === 'A') return undefined\n\t\tconst h = String.fromCharCode(head.charCodeAt(0) - 1)\n\t\tif (h < 'Z') {\n\t\t\tdigs.push(DIGITS.slice(-1))\n\t\t} else {\n\t\t\tdigs.pop()\n\t\t}\n\t\treturn h + digs.join('')\n\t} else {\n\t\treturn head + digs.join('')\n\t}\n}\n\n/**\n * Get the midpoint between two indexs.\n *\n * @param a - The start index.\n * @param b - The end index.\n *\n * @internal\n */\nfunction midpoint(a: string, b: string | undefined): string {\n\tif (b !== undefined && a >= b) {\n\t\tthrow new Error(a + ' >= ' + b)\n\t}\n\tif (a.slice(-1) === '0' || (b && b.slice(-1) === '0')) {\n\t\tthrow new Error('trailing zero')\n\t}\n\tif (b) {\n\t\tlet n = 0\n\t\twhile ((a.charAt(n) || '0') === b.charAt(n)) {\n\t\t\tn++\n\t\t}\n\t\tif (n > 0) {\n\t\t\treturn b.slice(0, n) + midpoint(a.slice(n), b.slice(n))\n\t\t}\n\t}\n\tconst digitA = a ? DIGITS.indexOf(a.charAt(0)) : 0\n\tconst digitB = b !== undefined ? DIGITS.indexOf(b.charAt(0)) : DIGITS.length\n\tif (digitB - digitA > 1) {\n\t\tconst midDigit = Math.round(0.5 * (digitA + digitB))\n\t\treturn DIGITS.charAt(midDigit)\n\t} else {\n\t\tif (b && b.length > 1) {\n\t\t\treturn b.slice(0, 1)\n\t\t} else {\n\t\t\treturn DIGITS.charAt(digitA) + midpoint(a.slice(1), undefined)\n\t\t}\n\t}\n}\n\n/**\n * Get the integer part of an index.\n *\n * @param index - The index to use.\n */\nfunction getIntegerPart(index: string): string {\n\tconst integerPartLength = getIntegerLength(index.charAt(0))\n\tif (integerPartLength > index.length) {\n\t\tthrow new Error('invalid index: ' + index)\n\t}\n\treturn index.slice(0, integerPartLength)\n}\n\n/**\n * Validate an index.\n *\n * @param x - The index to validate.\n */\nexport function validateOrder(index: string): asserts index is string {\n\tif (index === SMALLEST_INTEGER) {\n\t\tthrow new Error('invalid index: ' + index)\n\t}\n\t// getIntegerPart will throw if the first character is bad,\n\t// or the key is too short.  we'd call it to check these things\n\t// even if we didn't need the result\n\tconst i = getIntegerPart(index)\n\tconst f = index.slice(i.length)\n\tif (f.slice(-1) === '0') {\n\t\tthrow new Error('invalid index: ' + index)\n\t}\n}\n\n/**\n * Generate an index key at the midpoint between a start and end.\n *\n * @param a - The start index key string.\n * @param b - The end index key string, greater than A.\n */\nfunction generateKeyBetween(a: IndexKey | undefined, b: IndexKey | undefined): IndexKey {\n\tif (a !== undefined) validateOrder(a)\n\tif (b !== undefined) validateOrder(b)\n\tif (a !== undefined && b !== undefined && a >= b) {\n\t\tthrow new Error(a + ' >= ' + b)\n\t}\n\tif (a === undefined && b === undefined) {\n\t\treturn INTEGER_ZERO\n\t}\n\tif (a === undefined) {\n\t\tif (b === undefined) throw Error('b is undefined')\n\t\tconst ib = getIntegerPart(b)\n\t\tconst fb = b.slice(ib.length)\n\t\tif (ib === SMALLEST_INTEGER) {\n\t\t\treturn (ib + midpoint('', fb)) as IndexKey\n\t\t}\n\t\tif (ib < b) {\n\t\t\treturn ib as IndexKey\n\t\t}\n\t\tconst ibl = decrementInteger(ib)\n\t\tisNotUndefined(ibl)\n\t\treturn ibl as IndexKey\n\t}\n\tif (b === undefined) {\n\t\tconst ia = getIntegerPart(a)\n\t\tconst fa = a.slice(ia.length)\n\t\tconst i = incrementInteger(ia)\n\t\treturn (i === undefined ? ia + midpoint(fa, undefined) : i) as IndexKey\n\t}\n\tconst ia = getIntegerPart(a)\n\tconst fa = a.slice(ia.length)\n\tconst ib = getIntegerPart(b)\n\tconst fb = b.slice(ib.length)\n\tif (ia === ib) {\n\t\treturn (ia + midpoint(fa, fb)) as IndexKey\n\t}\n\tconst i = incrementInteger(ia)\n\tisNotUndefined(i)\n\treturn (i < b ? i : ia + midpoint(fa, undefined)) as IndexKey\n}\n\n/**\n * Generate N number of index keys between the start and end index.\n *\n * @param a - The start index key string.\n * @param b - The end index key, greater than A string.\n * @param n - The number of index keys to generate.\n */\nexport function generateNKeysBetween(\n\ta: IndexKey | undefined,\n\tb: IndexKey | undefined,\n\tn: number\n): IndexKey[] {\n\tif (n === 0) return []\n\tif (n === 1) return [generateKeyBetween(a, b)]\n\tif (b === undefined) {\n\t\tlet c = generateKeyBetween(a, b)\n\t\tconst result = [c]\n\t\tfor (let i = 0; i < n - 1; i++) {\n\t\t\tc = generateKeyBetween(c, b)\n\t\t\tresult.push(c)\n\t\t}\n\t\treturn result\n\t}\n\tif (a === undefined) {\n\t\tlet c = generateKeyBetween(a, b)\n\t\tconst result = [c]\n\t\tfor (let i = 0; i < n - 1; i++) {\n\t\t\tc = generateKeyBetween(a, c)\n\t\t\tresult.push(c)\n\t\t}\n\t\tresult.reverse()\n\t\treturn result\n\t}\n\tconst mid = Math.floor(n / 2)\n\tconst c = generateKeyBetween(a, b)\n\treturn [...generateNKeysBetween(a, c, mid), c, ...generateNKeysBetween(c, b, n - mid - 1)]\n}\n", "import { IndexKey } from './IndexKey'\nimport { INTEGER_ZERO, generateNKeysBetween, validateOrder } from './dgreensp/dgreensp'\n\n/**\n * The index key for the first index - 'a0'.\n * @public\n */\nexport const ZERO_INDEX_KEY = INTEGER_ZERO\n\n/** @internal */\nexport function validateIndexKey(key: string): asserts key is IndexKey {\n\tvalidateOrder(key)\n}\n\n/**\n * Get a number of indices between two indices.\n * @param below - The index below.\n * @param above - The index above.\n * @param n - The number of indices to get.\n * @public\n */\nexport function getIndicesBetween(\n\tbelow: IndexKey | undefined,\n\tabove: IndexKey | undefined,\n\tn: number\n) {\n\treturn generateNKeysBetween(below, above, n)\n}\n\n/**\n * Get a number of indices above an index.\n * @param below - The index below.\n * @param n - The number of indices to get.\n * @public\n */\nexport function getIndicesAbove(below: IndexKey, n: number) {\n\treturn generateNKeysBetween(below, undefined, n)\n}\n\n/**\n * Get a number of indices below an index.\n * @param above - The index above.\n * @param n - The number of indices to get.\n * @public\n */\nexport function getIndicesBelow(above: IndexKey, n: number) {\n\treturn generateNKeysBetween(undefined, above, n)\n}\n\n/**\n * Get the index between two indices.\n * @param below - The index below.\n * @param above - The index above.\n * @public\n */\nexport function getIndexBetween(below: IndexKey, above?: IndexKey) {\n\treturn generateNKeysBetween(below, above, 1)[0]\n}\n\n/**\n * Get the index above a given index.\n * @param below - The index below.\n * @public\n */\nexport function getIndexAbove(below: IndexKey) {\n\treturn generateNKeysBetween(below, undefined, 1)[0]\n}\n\n/**\n * Get the index below a given index.\n * @param above - The index above.\n *  @public\n */\nexport function getIndexBelow(above: IndexKey) {\n\treturn generateNKeysBetween(undefined, above, 1)[0]\n}\n\n/**\n * Get n number of indices, starting at an index.\n * @param n - The number of indices to get.\n * @param start -  The index to start at.\n * @public\n */\nexport function getIndices(n: number, start = 'a1' as IndexKey) {\n\treturn [start, ...generateNKeysBetween(start, undefined, n)]\n}\n\n/**\n * Sort by index.\n * @param a - An object with an index property.\n * @param b - An object with an index property.\n * @public */\nexport function sortByIndex<T extends { index: IndexKey }>(a: T, b: T) {\n\tif (a.index < b.index) {\n\t\treturn -1\n\t} else if (a.index > b.index) {\n\t\treturn 1\n\t}\n\treturn 0\n}\n", "/** @public */\nexport function sortById<T extends { id: any }>(a: T, b: T) {\n\treturn a.id > b.id ? 1 : -1\n}\n", "/* eslint-disable no-restricted-syntax */\n\n/**\n * Get a value from local storage.\n *\n * @param key - The key to get.\n *\n * @internal\n */\nexport function getFromLocalStorage(key: string) {\n\ttry {\n\t\treturn localStorage.getItem(key)\n\t} catch {\n\t\treturn null\n\t}\n}\n\n/**\n * Set a value in local storage. Will not throw an error if localStorage is not available.\n *\n * @param key - The key to set.\n * @param value - The value to set.\n *\n * @internal\n */\nexport function setInLocalStorage(key: string, value: string) {\n\ttry {\n\t\tlocalStorage.setItem(key, value)\n\t} catch {\n\t\t// noop\n\t}\n}\n\n/**\n * Remove a value from local storage. Will not throw an error if localStorage is not available.\n *\n * @param key - The key to set.\n *\n * @internal\n */\nexport function deleteFromLocalStorage(key: string) {\n\ttry {\n\t\tlocalStorage.removeItem(key)\n\t} catch {\n\t\t// noop\n\t}\n}\n\n/**\n * Clear all values from local storage. Will not throw an error if localStorage is not available.\n *\n * @internal\n */\nexport function clearLocalStorage() {\n\ttry {\n\t\tlocalStorage.clear()\n\t} catch {\n\t\t// noop\n\t}\n}\n\n/**\n * Get a value from session storage.\n *\n * @param key - The key to get.\n *\n * @internal\n */\nexport function getFromSessionStorage(key: string) {\n\ttry {\n\t\treturn sessionStorage.getItem(key)\n\t} catch {\n\t\treturn null\n\t}\n}\n\n/**\n * Set a value in session storage. Will not throw an error if sessionStorage is not available.\n *\n * @param key - The key to set.\n * @param value - The value to set.\n *\n * @internal\n */\nexport function setInSessionStorage(key: string, value: string) {\n\ttry {\n\t\tsessionStorage.setItem(key, value)\n\t} catch {\n\t\t// noop\n\t}\n}\n\n/**\n * Remove a value from session storage. Will not throw an error if sessionStorage is not available.\n *\n * @param key - The key to set.\n *\n * @internal\n */\nexport function deleteFromSessionStorage(key: string) {\n\ttry {\n\t\tsessionStorage.removeItem(key)\n\t} catch {\n\t\t// noop\n\t}\n}\n\n/**\n * Clear all values from session storage. Will not throw an error if sessionStorage is not available.\n *\n * @internal\n */\nexport function clearSessionStorage() {\n\ttry {\n\t\tsessionStorage.clear()\n\t} catch {\n\t\t// noop\n\t}\n}\n", "const isTest = () =>\n\ttypeof process !== 'undefined' &&\n\tprocess.env.NODE_ENV === 'test' &&\n\t// @ts-expect-error\n\t!globalThis.__FORCE_RAF_IN_TESTS__\n\nconst fpsQueue: Array<() => void> = []\nconst targetFps = 60\nconst targetTimePerFrame = Math.ceil(1000 / targetFps)\nlet frame: number | undefined\nlet time = 0\nlet last = 0\n\nconst flush = () => {\n\tconst queue = fpsQueue.splice(0, fpsQueue.length)\n\tfor (const fn of queue) {\n\t\tfn()\n\t}\n}\n\nfunction tick() {\n\tif (frame) {\n\t\treturn\n\t}\n\tconst now = Date.now()\n\tconst elapsed = now - last\n\n\tif (time + elapsed < targetTimePerFrame) {\n\t\tframe = requestAnimationFrame(() => {\n\t\t\tframe = undefined\n\t\t\ttick()\n\t\t})\n\t\treturn\n\t}\n\tframe = requestAnimationFrame(() => {\n\t\tframe = undefined\n\t\tlast = now\n\t\t// If we fall behind more than 10 frames, we'll just reset the time so we don't try to update a number of times\n\t\t// This can happen if we don't interact with the page for a while\n\t\ttime = Math.min(time + elapsed - targetTimePerFrame, targetTimePerFrame * 10)\n\t\tflush()\n\t})\n}\n\nlet started = false\n\n/**\n * Returns a throttled version of the function that will only be called max once per frame.\n * The target frame rate is 60fps.\n * @param fn - the fun to return a throttled version of\n * @returns\n * @internal\n */\nexport function fpsThrottle(fn: () => void) {\n\tif (isTest()) {\n\t\treturn fn\n\t}\n\n\treturn () => {\n\t\tif (fpsQueue.includes(fn)) {\n\t\t\treturn\n\t\t}\n\t\tfpsQueue.push(fn)\n\t\tif (!started) {\n\t\t\tstarted = true\n\t\t\t// We set last to Date.now() - targetTimePerFrame - 1 so that the first run will happen immediately\n\t\t\tlast = Date.now() - targetTimePerFrame - 1\n\t\t}\n\t\ttick()\n\t}\n}\n\n/**\n * Calls the function on the next frame. The target frame rate is 60fps.\n * If the same fn is passed again before the next frame, it will still be called only once.\n * @param fn - the fun to call on the next frame\n * @returns a function that will cancel the call if called before the next frame\n * @internal\n */\nexport function throttleToNextFrame(fn: () => void): () => void {\n\tif (isTest()) {\n\t\tfn()\n\t\treturn () => {\n\t\t\t// noop\n\t\t}\n\t}\n\n\tif (!fpsQueue.includes(fn)) {\n\t\tfpsQueue.push(fn)\n\t\tif (!started) {\n\t\t\tstarted = true\n\t\t\t// We set last to Date.now() - targetTimePerFrame - 1 so that the first run will happen immediately\n\t\t\tlast = Date.now() - targetTimePerFrame - 1\n\t\t}\n\t\ttick()\n\t}\n\n\treturn () => {\n\t\tconst index = fpsQueue.indexOf(fn)\n\t\tif (index > -1) {\n\t\t\tfpsQueue.splice(index, 1)\n\t\t}\n\t}\n}\n", "/**\n * Get whether a value is not undefined.\n *\n * @param value - The value to check.\n * @public\n */\nexport function isDefined<T>(value: T): value is typeof value extends undefined ? never : T {\n\treturn value !== undefined\n}\n\n/**\n * Get whether a value is null\n *\n * @param value - The value to check.\n * @public\n */\nexport function isNonNull<T>(value: T): value is typeof value extends null ? never : T {\n\treturn value !== null\n}\n\n/**\n * Get whether a value is nullish (null, undefined).\n *\n * @param value - The value to check.\n * @public\n */\nexport function isNonNullish<T>(\n\tvalue: T\n): value is typeof value extends undefined ? never : typeof value extends null ? never : T {\n\treturn value !== null && value !== undefined\n}\n\nfunction getStructuredClone(): [<T>(i: T) => T, boolean] {\n\tif (typeof globalThis !== 'undefined' && (globalThis as any).structuredClone) {\n\t\treturn [globalThis.structuredClone as <T>(i: T) => T, true]\n\t}\n\n\tif (typeof global !== 'undefined' && (global as any).structuredClone) {\n\t\treturn [global.structuredClone as <T>(i: T) => T, true]\n\t}\n\n\tif (typeof window !== 'undefined' && (window as any).structuredClone) {\n\t\treturn [window.structuredClone as <T>(i: T) => T, true]\n\t}\n\n\treturn [<T>(i: T): T => (i ? JSON.parse(JSON.stringify(i)) : i), false]\n}\n\nconst _structuredClone = getStructuredClone()\n\n/**\n * Create a deep copy of a value. Uses the structuredClone API if available, otherwise uses JSON.parse(JSON.stringify()).\n *\n * @param i - The value to clone.\n * @public */\nexport const structuredClone = _structuredClone[0]\n\n/**\n * @internal\n */\nexport const isNativeStructuredClone = _structuredClone[1]\n\n/**\n * When we patch structuredClone in jsdom for testing (see https://github.com/jsdom/jsdom/issues/3363),\n * the Object that is used as a prototype for the cloned object is not the same as the Object in\n * the code under test (that comes from jsdom's fake global context). This constant is used in\n * our code to work around this case.\n *\n * This is also the case for Array prototype, but that problem can be worked around with an\n * Array.isArray() check.\n * @internal\n */\nexport const STRUCTURED_CLONE_OBJECT_PROTOTYPE = Object.getPrototypeOf(structuredClone({}))\n", "const warnedNames = new Set<string>()\n\n/**\n * @internal\n */\nexport function warnDeprecatedGetter(name: string) {\n\tif (warnedNames.has(name)) return\n\n\twarnedNames.add(name)\n\tconsole.warn(\n\t\t`Using '${name}' is deprecated and will be removed in the near future. Please refactor to use 'get${name[0].toLocaleUpperCase()}${name.slice(\n\t\t\t1\n\t\t)}' instead.`\n\t)\n}\n", "export { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\nexport let nanoid = (size = 21) =>\n  crypto.getRandomValues(new Uint8Array(size)).reduce((id, byte) => {\n    byte &= 63\n    if (byte < 36) {\n      id += byte.toString(36)\n    } else if (byte < 62) {\n      id += (byte - 26).toString(36).toUpperCase()\n    } else if (byte > 62) {\n      id += '-'\n    } else {\n      id += '_'\n    }\n    return id\n  }, '')\n", "import { structuredClone } from '@tldraw/utils'\nimport { nanoid } from 'nanoid'\nimport { IdOf, OmitMeta, UnknownRecord } from './BaseRecord'\nimport { StoreValidator } from './Store'\n\nexport type RecordTypeRecord<R extends RecordType<any, any>> = ReturnType<R['create']>\n\n/**\n * Defines the scope of the record\n *\n * instance: The record belongs to a single instance of the store. It should not be synced, and any persistence logic should 'de-instance-ize' the record before persisting it, and apply the reverse when rehydrating.\n * document: The record is persisted and synced. It is available to all store instances.\n * presence: The record belongs to a single instance of the store. It may be synced to other instances, but other instances should not make changes to it. It should not be persisted.\n *\n * @public\n * */\nexport type RecordScope = 'session' | 'document' | 'presence'\n\n/**\n * A record type is a type that can be stored in a record store. It is created with\n * `createRecordType`.\n *\n * @public\n */\nexport class RecordType<\n\tR extends UnknownRecord,\n\tRequiredProperties extends keyof Omit<R, 'id' | 'typeName'>,\n> {\n\treadonly createDefaultProperties: () => Exclude<OmitMeta<R>, RequiredProperties>\n\treadonly validator: StoreValidator<R>\n\n\treadonly scope: RecordScope\n\n\tconstructor(\n\t\t/**\n\t\t * The unique type associated with this record.\n\t\t *\n\t\t * @public\n\t\t * @readonly\n\t\t */\n\t\tpublic readonly typeName: R['typeName'],\n\t\tconfig: {\n\t\t\treadonly createDefaultProperties: () => Exclude<OmitMeta<R>, RequiredProperties>\n\t\t\treadonly validator?: StoreValidator<R>\n\t\t\treadonly scope?: RecordScope\n\t\t}\n\t) {\n\t\tthis.createDefaultProperties = config.createDefaultProperties\n\t\tthis.validator = config.validator ?? { validate: (r: unknown) => r as R }\n\t\tthis.scope = config.scope ?? 'document'\n\t}\n\n\t/**\n\t * Create a new record of this type.\n\t *\n\t * @param properties - The properties of the record.\n\t * @returns The new record.\n\t */\n\tcreate(properties: Pick<R, RequiredProperties> & Omit<Partial<R>, RequiredProperties>): R {\n\t\tconst result = { ...this.createDefaultProperties(), id: this.createId() } as any\n\n\t\tfor (const [k, v] of Object.entries(properties)) {\n\t\t\tif (v !== undefined) {\n\t\t\t\tresult[k] = v\n\t\t\t}\n\t\t}\n\n\t\tresult.typeName = this.typeName\n\n\t\treturn result as R\n\t}\n\n\t/**\n\t * Clone a record of this type.\n\t *\n\t * @param record - The record to clone.\n\t * @returns The cloned record.\n\t * @public\n\t */\n\tclone(record: R): R {\n\t\treturn { ...structuredClone(record), id: this.createId() }\n\t}\n\n\t/**\n\t * Create a new ID for this record type.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const id = recordType.createId()\n\t * ```\n\t *\n\t * @returns The new ID.\n\t * @public\n\t */\n\tcreateId(customUniquePart?: string): IdOf<R> {\n\t\treturn (this.typeName + ':' + (customUniquePart ?? nanoid())) as IdOf<R>\n\t}\n\n\t/**\n\t * Create a new ID for this record type based on the given ID.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const id = recordType.createCustomId('myId')\n\t * ```\n\t *\n\t * @deprecated - Use `createId` instead.\n\t * @param id - The ID to base the new ID on.\n\t * @returns The new ID.\n\t */\n\tcreateCustomId(id: string): IdOf<R> {\n\t\treturn (this.typeName + ':' + id) as IdOf<R>\n\t}\n\n\t/**\n\t * Takes an id like `user:123` and returns the part after the colon `123`\n\t *\n\t * @param id - The id\n\t * @returns\n\t */\n\tparseId(id: IdOf<R>): string {\n\t\tif (!this.isId(id)) {\n\t\t\tthrow new Error(`ID \"${id}\" is not a valid ID for type \"${this.typeName}\"`)\n\t\t}\n\n\t\treturn id.slice(this.typeName.length + 1)\n\t}\n\n\t/**\n\t * Check whether a record is an instance of this record type.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const result = recordType.isInstance(someRecord)\n\t * ```\n\t *\n\t * @param record - The record to check.\n\t * @returns Whether the record is an instance of this record type.\n\t */\n\tisInstance = (record?: UnknownRecord): record is R => {\n\t\treturn record?.typeName === this.typeName\n\t}\n\n\t/**\n\t * Check whether an id is an id of this type.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const result = recordType.isIn('someId')\n\t * ```\n\t *\n\t * @param id - The id to check.\n\t * @returns Whether the id is an id of this type.\n\t */\n\tisId(id?: string): id is IdOf<R> {\n\t\tif (!id) return false\n\t\tfor (let i = 0; i < this.typeName.length; i++) {\n\t\t\tif (id[i] !== this.typeName[i]) return false\n\t\t}\n\n\t\treturn id[this.typeName.length] === ':'\n\t}\n\n\t/**\n\t * Create a new RecordType that has the same type name as this RecordType and includes the given\n\t * default properties.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const authorType = createRecordType('author', () => ({ living: true }))\n\t * const deadAuthorType = authorType.withDefaultProperties({ living: false })\n\t * ```\n\t *\n\t * @param fn - A function that returns the default properties of the new RecordType.\n\t * @returns The new RecordType.\n\t */\n\twithDefaultProperties<DefaultProps extends Omit<Partial<R>, 'typeName' | 'id'>>(\n\t\tcreateDefaultProperties: () => DefaultProps\n\t): RecordType<R, Exclude<RequiredProperties, keyof DefaultProps>> {\n\t\treturn new RecordType<R, Exclude<RequiredProperties, keyof DefaultProps>>(this.typeName, {\n\t\t\tcreateDefaultProperties: createDefaultProperties as any,\n\t\t\tvalidator: this.validator,\n\t\t\tscope: this.scope,\n\t\t})\n\t}\n\n\t/**\n\t * Check that the passed in record passes the validations for this type. Returns its input\n\t * correctly typed if it does, but throws an error otherwise.\n\t */\n\tvalidate(record: unknown, recordBefore?: R): R {\n\t\tif (recordBefore && this.validator.validateUsingKnownGoodVersion) {\n\t\t\treturn this.validator.validateUsingKnownGoodVersion(recordBefore, record)\n\t\t}\n\t\treturn this.validator.validate(record)\n\t}\n}\n\n/**\n * Create a record type.\n *\n * @example\n *\n * ```ts\n * const Book = createRecordType<Book>('book')\n * ```\n *\n * @param typeName - The name of the type to create.\n * @public\n */\nexport function createRecordType<R extends UnknownRecord>(\n\ttypeName: R['typeName'],\n\tconfig: {\n\t\tvalidator?: StoreValidator<R>\n\t\tscope: RecordScope\n\t}\n): RecordType<R, keyof Omit<R, 'id' | 'typeName'>> {\n\treturn new RecordType<R, keyof Omit<R, 'id' | 'typeName'>>(typeName, {\n\t\tcreateDefaultProperties: () => ({}) as any,\n\t\tvalidator: config.validator,\n\t\tscope: config.scope,\n\t})\n}\n\n/**\n * Assert whether an id correspond to a record type.\n *\n * @example\n *\n * ```ts\n * assertIdType(myId, \"shape\")\n * ```\n *\n * @param id - The id to check.\n * @param type - The type of the record.\n * @public\n */\nexport function assertIdType<R extends UnknownRecord>(\n\tid: string | undefined,\n\ttype: RecordType<R, any>\n): asserts id is IdOf<R> {\n\tif (!id || !type.isId(id)) {\n\t\tthrow new Error(`string ${JSON.stringify(id)} is not a valid ${type.typeName} id`)\n\t}\n}\n", "/** A micro cache used when storing records in memory (using a WeakMap). */\nexport class Cache<T extends object, K> {\n\t/** The map of items to their cached values. */\n\titems = new WeakMap<T, K>()\n\n\t/**\n\t * Get the cached value for a given record. If the record is not present in the map, the callback\n\t * will be used to create the value (with the result being stored in the cache for next time).\n\t *\n\t * @param item - The item to get.\n\t * @param cb - The callback to use to create the value when a cached value is not found.\n\t */\n\tget<P extends T>(item: P, cb: (item: P) => K) {\n\t\tif (!this.items.has(item)) {\n\t\t\tthis.items.set(item, cb(item))\n\t\t}\n\n\t\treturn this.items.get(item)!\n\t}\n}\n", "import {\n\tAtom,\n\tcomputed,\n\tComputed,\n\tEMPTY_ARRAY,\n\tisUninitialized,\n\tRESET_VALUE,\n\twithDiff,\n} from '@tldraw/state'\nimport { objectMapValues } from '@tldraw/utils'\nimport isEqual from 'lodash.isequal'\nimport { IdOf, UnknownRecord } from './BaseRecord'\nimport { executeQuery, objectMatchesQuery, QueryExpression } from './executeQuery'\nimport { IncrementalSetConstructor } from './IncrementalSetConstructor'\nimport { diffSets } from './setUtils'\nimport { CollectionDiff, RecordsDiff } from './Store'\n\nexport type RSIndexDiff<\n\tR extends UnknownRecord,\n\tProperty extends string & keyof R = string & keyof R,\n> = Map<R[Property], CollectionDiff<IdOf<R>>>\n\nexport type RSIndexMap<\n\tR extends UnknownRecord,\n\tProperty extends string & keyof R = string & keyof R,\n> = Map<R[Property], Set<IdOf<R>>>\n\nexport type RSIndex<\n\tR extends UnknownRecord,\n\tProperty extends string & keyof R = string & keyof R,\n> = Computed<Map<R[Property], Set<IdOf<R>>>, RSIndexDiff<R, Property>>\n\n/**\n * A class that provides a 'namespace' for the various kinds of indexes one may wish to derive from\n * the record store.\n */\nexport class StoreQueries<R extends UnknownRecord> {\n\tconstructor(\n\t\tprivate readonly atoms: Atom<Record<IdOf<R>, Atom<R>>>,\n\t\tprivate readonly history: Atom<number, RecordsDiff<R>>\n\t) {}\n\n\t/**\n\t * A cache of derivations (indexes).\n\t *\n\t * @internal\n\t */\n\tprivate indexCache = new Map<string, RSIndex<R>>()\n\n\t/**\n\t * A cache of derivations (filtered histories).\n\t *\n\t * @internal\n\t */\n\tprivate historyCache = new Map<string, Computed<number, RecordsDiff<R>>>()\n\n\t/**\n\t * Create a derivation that contains the history for a given type\n\t *\n\t * @param typeName - The name of the type to filter by.\n\t * @returns A derivation that returns the ids of all records of the given type.\n\t * @public\n\t */\n\tpublic filterHistory<TypeName extends R['typeName']>(\n\t\ttypeName: TypeName\n\t): Computed<number, RecordsDiff<Extract<R, { typeName: TypeName }>>> {\n\t\ttype S = Extract<R, { typeName: TypeName }>\n\n\t\tif (this.historyCache.has(typeName)) {\n\t\t\treturn this.historyCache.get(typeName) as any\n\t\t}\n\n\t\tconst filtered = computed<number, RecordsDiff<S>>(\n\t\t\t'filterHistory:' + typeName,\n\t\t\t(lastValue, lastComputedEpoch) => {\n\t\t\t\tif (isUninitialized(lastValue)) {\n\t\t\t\t\treturn this.history.get()\n\t\t\t\t}\n\n\t\t\t\tconst diff = this.history.getDiffSince(lastComputedEpoch)\n\t\t\t\tif (diff === RESET_VALUE) return this.history.get()\n\n\t\t\t\tconst res = { added: {}, removed: {}, updated: {} } as RecordsDiff<S>\n\t\t\t\tlet numAdded = 0\n\t\t\t\tlet numRemoved = 0\n\t\t\t\tlet numUpdated = 0\n\n\t\t\t\tfor (const changes of diff) {\n\t\t\t\t\tfor (const added of objectMapValues(changes.added)) {\n\t\t\t\t\t\tif (added.typeName === typeName) {\n\t\t\t\t\t\t\tif (res.removed[added.id as IdOf<S>]) {\n\t\t\t\t\t\t\t\tconst original = res.removed[added.id as IdOf<S>]\n\t\t\t\t\t\t\t\tdelete res.removed[added.id as IdOf<S>]\n\t\t\t\t\t\t\t\tnumRemoved--\n\t\t\t\t\t\t\t\tif (original !== added) {\n\t\t\t\t\t\t\t\t\tres.updated[added.id as IdOf<S>] = [original, added as S]\n\t\t\t\t\t\t\t\t\tnumUpdated++\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tres.added[added.id as IdOf<S>] = added as S\n\t\t\t\t\t\t\t\tnumAdded++\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const [from, to] of objectMapValues(changes.updated)) {\n\t\t\t\t\t\tif (to.typeName === typeName) {\n\t\t\t\t\t\t\tif (res.added[to.id as IdOf<S>]) {\n\t\t\t\t\t\t\t\tres.added[to.id as IdOf<S>] = to as S\n\t\t\t\t\t\t\t} else if (res.updated[to.id as IdOf<S>]) {\n\t\t\t\t\t\t\t\tres.updated[to.id as IdOf<S>] = [res.updated[to.id as IdOf<S>][0], to as S]\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tres.updated[to.id as IdOf<S>] = [from as S, to as S]\n\t\t\t\t\t\t\t\tnumUpdated++\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const removed of objectMapValues(changes.removed)) {\n\t\t\t\t\t\tif (removed.typeName === typeName) {\n\t\t\t\t\t\t\tif (res.added[removed.id as IdOf<S>]) {\n\t\t\t\t\t\t\t\t// was added during this diff sequence, so just undo the add\n\t\t\t\t\t\t\t\tdelete res.added[removed.id as IdOf<S>]\n\t\t\t\t\t\t\t\tnumAdded--\n\t\t\t\t\t\t\t} else if (res.updated[removed.id as IdOf<S>]) {\n\t\t\t\t\t\t\t\t// remove oldest version\n\t\t\t\t\t\t\t\tres.removed[removed.id as IdOf<S>] = res.updated[removed.id as IdOf<S>][0]\n\t\t\t\t\t\t\t\tdelete res.updated[removed.id as IdOf<S>]\n\t\t\t\t\t\t\t\tnumUpdated--\n\t\t\t\t\t\t\t\tnumRemoved++\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tres.removed[removed.id as IdOf<S>] = removed as S\n\t\t\t\t\t\t\t\tnumRemoved++\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (numAdded || numRemoved || numUpdated) {\n\t\t\t\t\treturn withDiff(this.history.get(), res)\n\t\t\t\t} else {\n\t\t\t\t\treturn lastValue\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ historyLength: 100 }\n\t\t)\n\n\t\tthis.historyCache.set(typeName, filtered)\n\n\t\treturn filtered\n\t}\n\n\t/**\n\t * Create a derivation that returns an index on a property for the given type.\n\t *\n\t * @param typeName - The name of the type.\n\t * @param property - The name of the property.\n\t * @public\n\t */\n\tpublic index<\n\t\tTypeName extends R['typeName'],\n\t\tProperty extends string & keyof Extract<R, { typeName: TypeName }>,\n\t>(typeName: TypeName, property: Property): RSIndex<Extract<R, { typeName: TypeName }>, Property> {\n\t\tconst cacheKey = typeName + ':' + property\n\n\t\tif (this.indexCache.has(cacheKey)) {\n\t\t\treturn this.indexCache.get(cacheKey) as any\n\t\t}\n\n\t\tconst index = this.__uncached_createIndex(typeName, property)\n\n\t\tthis.indexCache.set(cacheKey, index as any)\n\n\t\treturn index\n\t}\n\n\t/**\n\t * Create a derivation that returns an index on a property for the given type.\n\t *\n\t * @param typeName - The name of the type?.\n\t * @param property - The name of the property?.\n\t * @internal\n\t */\n\t__uncached_createIndex<\n\t\tTypeName extends R['typeName'],\n\t\tProperty extends string & keyof Extract<R, { typeName: TypeName }>,\n\t>(typeName: TypeName, property: Property): RSIndex<Extract<R, { typeName: TypeName }>, Property> {\n\t\ttype S = Extract<R, { typeName: TypeName }>\n\n\t\tconst typeHistory = this.filterHistory(typeName)\n\n\t\tconst fromScratch = () => {\n\t\t\t// deref typeHistory early so that the first time the incremental version runs\n\t\t\t// it gets a diff to work with instead of having to bail to this from-scratch version\n\t\t\ttypeHistory.get()\n\t\t\tconst res = new Map<S[Property], Set<IdOf<S>>>()\n\t\t\tfor (const atom of objectMapValues(this.atoms.get())) {\n\t\t\t\tconst record = atom.get()\n\t\t\t\tif (record.typeName === typeName) {\n\t\t\t\t\tconst value = (record as S)[property]\n\t\t\t\t\tif (!res.has(value)) {\n\t\t\t\t\t\tres.set(value, new Set())\n\t\t\t\t\t}\n\t\t\t\t\tres.get(value)!.add(record.id)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn res\n\t\t}\n\n\t\treturn computed<RSIndexMap<S, Property>, RSIndexDiff<S, Property>>(\n\t\t\t'index:' + typeName + ':' + property,\n\t\t\t(prevValue, lastComputedEpoch) => {\n\t\t\t\tif (isUninitialized(prevValue)) return fromScratch()\n\n\t\t\t\tconst history = typeHistory.getDiffSince(lastComputedEpoch)\n\t\t\t\tif (history === RESET_VALUE) {\n\t\t\t\t\treturn fromScratch()\n\t\t\t\t}\n\n\t\t\t\tconst setConstructors = new Map<any, IncrementalSetConstructor<IdOf<S>>>()\n\n\t\t\t\tconst add = (value: S[Property], id: IdOf<S>) => {\n\t\t\t\t\tlet setConstructor = setConstructors.get(value)\n\t\t\t\t\tif (!setConstructor)\n\t\t\t\t\t\tsetConstructor = new IncrementalSetConstructor<IdOf<S>>(\n\t\t\t\t\t\t\tprevValue.get(value) ?? new Set()\n\t\t\t\t\t\t)\n\t\t\t\t\tsetConstructor.add(id)\n\t\t\t\t\tsetConstructors.set(value, setConstructor)\n\t\t\t\t}\n\n\t\t\t\tconst remove = (value: S[Property], id: IdOf<S>) => {\n\t\t\t\t\tlet set = setConstructors.get(value)\n\t\t\t\t\tif (!set) set = new IncrementalSetConstructor<IdOf<S>>(prevValue.get(value) ?? new Set())\n\t\t\t\t\tset.remove(id)\n\t\t\t\t\tsetConstructors.set(value, set)\n\t\t\t\t}\n\n\t\t\t\tfor (const changes of history) {\n\t\t\t\t\tfor (const record of objectMapValues(changes.added)) {\n\t\t\t\t\t\tif (record.typeName === typeName) {\n\t\t\t\t\t\t\tconst value = (record as S)[property]\n\t\t\t\t\t\t\tadd(value, record.id)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const [from, to] of objectMapValues(changes.updated)) {\n\t\t\t\t\t\tif (to.typeName === typeName) {\n\t\t\t\t\t\t\tconst prev = (from as S)[property]\n\t\t\t\t\t\t\tconst next = (to as S)[property]\n\t\t\t\t\t\t\tif (prev !== next) {\n\t\t\t\t\t\t\t\tremove(prev, to.id)\n\t\t\t\t\t\t\t\tadd(next, to.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const record of objectMapValues(changes.removed)) {\n\t\t\t\t\t\tif (record.typeName === typeName) {\n\t\t\t\t\t\t\tconst value = (record as S)[property]\n\t\t\t\t\t\t\tremove(value, record.id)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet nextValue: undefined | RSIndexMap<S, Property> = undefined\n\t\t\t\tlet nextDiff: undefined | RSIndexDiff<S, Property> = undefined\n\n\t\t\t\tfor (const [value, setConstructor] of setConstructors) {\n\t\t\t\t\tconst result = setConstructor.get()\n\t\t\t\t\tif (!result) continue\n\t\t\t\t\tif (!nextValue) nextValue = new Map(prevValue)\n\t\t\t\t\tif (!nextDiff) nextDiff = new Map()\n\t\t\t\t\tif (result.value.size === 0) {\n\t\t\t\t\t\tnextValue.delete(value)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextValue.set(value, result.value)\n\t\t\t\t\t}\n\t\t\t\t\tnextDiff.set(value, result.diff)\n\t\t\t\t}\n\n\t\t\t\tif (nextValue && nextDiff) {\n\t\t\t\t\treturn withDiff(nextValue, nextDiff)\n\t\t\t\t}\n\n\t\t\t\treturn prevValue\n\t\t\t},\n\t\t\t{ historyLength: 100 }\n\t\t)\n\t}\n\n\t/**\n\t * Create a derivation that will return a signle record matching the given query.\n\t *\n\t * It will return undefined if there is no matching record\n\t *\n\t * @param typeName - The name of the type?\n\t * @param queryCreator - A function that returns the query expression.\n\t * @param name - (optinal) The name of the query.\n\t */\n\trecord<TypeName extends R['typeName']>(\n\t\ttypeName: TypeName,\n\t\tqueryCreator: () => QueryExpression<Extract<R, { typeName: TypeName }>> = () => ({}),\n\t\tname = 'record:' + typeName + (queryCreator ? ':' + queryCreator.toString() : '')\n\t): Computed<Extract<R, { typeName: TypeName }> | undefined> {\n\t\ttype S = Extract<R, { typeName: TypeName }>\n\t\tconst ids = this.ids(typeName, queryCreator, name)\n\n\t\treturn computed<S | undefined>(name, () => {\n\t\t\tfor (const id of ids.get()) {\n\t\t\t\treturn this.atoms.get()[id]?.get() as S\n\t\t\t}\n\t\t\treturn undefined\n\t\t})\n\t}\n\n\t/**\n\t * Create a derivation that will return an array of records matching the given query\n\t *\n\t * @param typeName - The name of the type?\n\t * @param queryCreator - A function that returns the query expression.\n\t * @param name - (optinal) The name of the query.\n\t */\n\trecords<TypeName extends R['typeName']>(\n\t\ttypeName: TypeName,\n\t\tqueryCreator: () => QueryExpression<Extract<R, { typeName: TypeName }>> = () => ({}),\n\t\tname = 'records:' + typeName + (queryCreator ? ':' + queryCreator.toString() : '')\n\t): Computed<Array<Extract<R, { typeName: TypeName }>>> {\n\t\ttype S = Extract<R, { typeName: TypeName }>\n\t\tconst ids = this.ids(typeName, queryCreator, 'ids:' + name)\n\n\t\treturn computed<S[]>(name, () => {\n\t\t\treturn [...ids.get()].map((id) => {\n\t\t\t\tconst atom = this.atoms.get()[id]\n\t\t\t\tif (!atom) {\n\t\t\t\t\tthrow new Error('no atom found for record id: ' + id)\n\t\t\t\t}\n\t\t\t\treturn atom.get() as S\n\t\t\t})\n\t\t})\n\t}\n\n\t/**\n\t * Create a derivation that will return the ids of all records of the given type.\n\t *\n\t * @param typeName - The name of the type.\n\t * @param queryCreator - A function that returns the query expression.\n\t * @param name - (optinal) The name of the query.\n\t */\n\tids<TypeName extends R['typeName']>(\n\t\ttypeName: TypeName,\n\t\tqueryCreator: () => QueryExpression<Extract<R, { typeName: TypeName }>> = () => ({}),\n\t\tname = 'ids:' + typeName + (queryCreator ? ':' + queryCreator.toString() : '')\n\t): Computed<\n\t\tSet<IdOf<Extract<R, { typeName: TypeName }>>>,\n\t\tCollectionDiff<IdOf<Extract<R, { typeName: TypeName }>>>\n\t> {\n\t\ttype S = Extract<R, { typeName: TypeName }>\n\n\t\tconst typeHistory = this.filterHistory(typeName)\n\n\t\tconst fromScratch = () => {\n\t\t\t// deref type history early to allow first incremental update to use diffs\n\t\t\ttypeHistory.get()\n\t\t\tconst query: QueryExpression<S> = queryCreator()\n\t\t\tif (Object.keys(query).length === 0) {\n\t\t\t\treturn new Set<IdOf<S>>(\n\t\t\t\t\tobjectMapValues(this.atoms.get()).flatMap((v) => {\n\t\t\t\t\t\tconst r = v.get()\n\t\t\t\t\t\tif (r.typeName === typeName) {\n\t\t\t\t\t\t\treturn r.id\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn []\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t}\n\n\t\t\treturn executeQuery(this, typeName, query)\n\t\t}\n\n\t\tconst fromScratchWithDiff = (prevValue: Set<IdOf<S>>) => {\n\t\t\tconst nextValue = fromScratch()\n\t\t\tconst diff = diffSets(prevValue, nextValue)\n\t\t\tif (diff) {\n\t\t\t\treturn withDiff(nextValue, diff)\n\t\t\t} else {\n\t\t\t\treturn prevValue\n\t\t\t}\n\t\t}\n\t\tconst cachedQuery = computed('ids_query:' + name, queryCreator, {\n\t\t\tisEqual,\n\t\t})\n\n\t\treturn computed(\n\t\t\t'query:' + name,\n\t\t\t(prevValue, lastComputedEpoch) => {\n\t\t\t\tconst query = cachedQuery.get()\n\t\t\t\tif (isUninitialized(prevValue)) {\n\t\t\t\t\treturn fromScratch()\n\t\t\t\t}\n\n\t\t\t\t// if the query changed since last time this ran then we need to start again\n\t\t\t\tif (lastComputedEpoch < cachedQuery.lastChangedEpoch) {\n\t\t\t\t\treturn fromScratchWithDiff(prevValue)\n\t\t\t\t}\n\n\t\t\t\t// otherwise iterate over the changes from the store and apply them to the previous value if needed\n\t\t\t\tconst history = typeHistory.getDiffSince(lastComputedEpoch)\n\t\t\t\tif (history === RESET_VALUE) {\n\t\t\t\t\treturn fromScratchWithDiff(prevValue)\n\t\t\t\t}\n\n\t\t\t\tconst setConstructor = new IncrementalSetConstructor<IdOf<S>>(\n\t\t\t\t\tprevValue\n\t\t\t\t) as IncrementalSetConstructor<IdOf<S>>\n\n\t\t\t\tfor (const changes of history) {\n\t\t\t\t\tfor (const added of objectMapValues(changes.added)) {\n\t\t\t\t\t\tif (added.typeName === typeName && objectMatchesQuery(query, added)) {\n\t\t\t\t\t\t\tsetConstructor.add(added.id)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const [_, updated] of objectMapValues(changes.updated)) {\n\t\t\t\t\t\tif (updated.typeName === typeName) {\n\t\t\t\t\t\t\tif (objectMatchesQuery(query, updated)) {\n\t\t\t\t\t\t\t\tsetConstructor.add(updated.id)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetConstructor.remove(updated.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const removed of objectMapValues(changes.removed)) {\n\t\t\t\t\t\tif (removed.typeName === typeName) {\n\t\t\t\t\t\t\tsetConstructor.remove(removed.id)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst result = setConstructor.get()\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn prevValue\n\t\t\t\t}\n\n\t\t\t\treturn withDiff(result.value, result.diff)\n\t\t\t},\n\t\t\t{ historyLength: 50 }\n\t\t)\n\t}\n\n\texec<TypeName extends R['typeName']>(\n\t\ttypeName: TypeName,\n\t\tquery: QueryExpression<Extract<R, { typeName: TypeName }>>\n\t): Array<Extract<R, { typeName: TypeName }>> {\n\t\tconst ids = executeQuery(this, typeName, query)\n\t\tif (ids.size === 0) {\n\t\t\treturn EMPTY_ARRAY\n\t\t}\n\t\tconst atoms = this.atoms.get()\n\t\treturn [...ids].map((id) => atoms[id].get() as Extract<R, { typeName: TypeName }>)\n\t}\n}\n", "import { CollectionDiff } from './Store'\n\n/**\n * Combine multiple sets into a single set containing only the common elements of all sets.\n *\n * @param sets - The sets to combine.\n */\nexport function intersectSets<T>(sets: Set<T>[]) {\n\tif (sets.length === 0) return new Set<T>()\n\tconst first = sets[0]\n\tconst rest = sets.slice(1)\n\tconst result = new Set<T>()\n\n\tfor (const val of first) {\n\t\tif (rest.every((set) => set.has(val))) {\n\t\t\tresult.add(val)\n\t\t}\n\t}\n\n\treturn result\n}\n\n/**\n * Calculates a diff between two sets.\n *\n * @param prev - The previous set\n * @param next - The next set\n */\nexport function diffSets<T>(prev: Set<T>, next: Set<T>): CollectionDiff<T> | undefined {\n\tconst result: CollectionDiff<T> = {}\n\n\tfor (const val of next) {\n\t\tif (!prev.has(val)) {\n\t\t\tresult.added ??= new Set()\n\t\t\tresult.added.add(val)\n\t\t}\n\t}\n\n\tfor (const val of prev) {\n\t\tif (!next.has(val)) {\n\t\t\tresult.removed ??= new Set()\n\t\t\tresult.removed.add(val)\n\t\t}\n\t}\n\n\treturn result.added || result.removed ? result : undefined\n}\n", "import { IdOf, UnknownRecord } from './BaseRecord'\nimport { intersectSets } from './setUtils'\nimport { StoreQueries } from './StoreQueries'\n\nexport type ValueMatcher<T> = { eq: T } | { neq: T } | { gt: number }\n\nexport type QueryExpression<R extends object> = {\n\t[k in keyof R & string]?: ValueMatcher<R[k]>\n\t// todo: handle nesting\n\t// | (R[k] extends object ? { match: QueryExpression<R[k]> } : never)\n}\n\nexport function objectMatchesQuery<T extends object>(query: QueryExpression<T>, object: T) {\n\tfor (const [key, _matcher] of Object.entries(query)) {\n\t\tconst matcher = _matcher as ValueMatcher<T>\n\t\tconst value = object[key as keyof T]\n\t\t// if you add matching logic here, make sure you also update executeQuery,\n\t\t// where initial data is pulled out of the indexes, since that requires different\n\t\t// matching logic\n\t\tif ('eq' in matcher && value !== matcher.eq) return false\n\t\tif ('neq' in matcher && value === matcher.neq) return false\n\t\tif ('gt' in matcher && (typeof value !== 'number' || value <= matcher.gt)) return false\n\t}\n\treturn true\n}\n\nexport function executeQuery<R extends UnknownRecord, TypeName extends R['typeName']>(\n\tstore: StoreQueries<R>,\n\ttypeName: TypeName,\n\tquery: QueryExpression<Extract<R, { typeName: TypeName }>>\n): Set<IdOf<Extract<R, { typeName: TypeName }>>> {\n\tconst matchIds = Object.fromEntries(Object.keys(query).map((key) => [key, new Set()]))\n\n\tfor (const [k, matcher] of Object.entries(query)) {\n\t\tif ('eq' in matcher) {\n\t\t\tconst index = store.index(typeName, k as any)\n\t\t\tconst ids = index.get().get(matcher.eq)\n\t\t\tif (ids) {\n\t\t\t\tfor (const id of ids) {\n\t\t\t\t\tmatchIds[k].add(id)\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ('neq' in matcher) {\n\t\t\tconst index = store.index(typeName, k as any)\n\t\t\tfor (const [value, ids] of index.get()) {\n\t\t\t\tif (value !== matcher.neq) {\n\t\t\t\t\tfor (const id of ids) {\n\t\t\t\t\t\tmatchIds[k].add(id)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ('gt' in matcher) {\n\t\t\tconst index = store.index(typeName, k as any)\n\t\t\tfor (const [value, ids] of index.get()) {\n\t\t\t\tif (value > matcher.gt) {\n\t\t\t\t\tfor (const id of ids) {\n\t\t\t\t\t\tmatchIds[k].add(id)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn intersectSets(Object.values(matchIds)) as Set<IdOf<Extract<R, { typeName: TypeName }>>>\n}\n", "import { STRUCTURED_CLONE_OBJECT_PROTOTYPE } from '@tldraw/utils'\n\n/**\n * Freeze an object when in development mode. Copied from\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze\n *\n * @example\n *\n * ```ts\n * const frozen = devFreeze({ a: 1 })\n * ```\n *\n * @param object - The object to freeze.\n * @returns The frozen object when in development mode, or else the object when in other modes.\n * @public\n */\nexport function devFreeze<T>(object: T): T {\n\tif (process.env.NODE_ENV === 'production') {\n\t\treturn object\n\t}\n\tconst proto = Object.getPrototypeOf(object)\n\tif (\n\t\tproto &&\n\t\t!(\n\t\t\tArray.isArray(object) ||\n\t\t\tproto === Object.prototype ||\n\t\t\tproto === null ||\n\t\t\tproto === STRUCTURED_CLONE_OBJECT_PROTOTYPE\n\t\t)\n\t) {\n\t\tconsole.error('cannot include non-js data in a record', object)\n\t\tthrow new Error('cannot include non-js data in a record')\n\t}\n\n\t// Retrieve the property names defined on object\n\tconst propNames = Object.getOwnPropertyNames(object)\n\n\t// Recursively freeze properties before freezing self\n\tfor (const name of propNames) {\n\t\tconst value = (object as any)[name]\n\n\t\tif (value && typeof value === 'object') {\n\t\t\tdevFreeze(value)\n\t\t}\n\t}\n\n\treturn Object.freeze(object)\n}\n", "import { Atom, Computed, Reactor, atom, computed, reactor, transact } from '@tldraw/state'\nimport {\n\tfilterEntries,\n\tobjectMapEntries,\n\tobjectMapFromEntries,\n\tobjectMapKeys,\n\tobjectMapValues,\n\tthrottleToNextFrame,\n} from '@tldraw/utils'\nimport { nanoid } from 'nanoid'\nimport { IdOf, RecordId, UnknownRecord } from './BaseRecord'\nimport { Cache } from './Cache'\nimport { RecordScope } from './RecordType'\nimport { StoreQueries } from './StoreQueries'\nimport { SerializedSchema, StoreSchema } from './StoreSchema'\nimport { devFreeze } from './devFreeze'\n\ntype RecFromId<K extends RecordId<UnknownRecord>> = K extends RecordId<infer R> ? R : never\n\n/**\n * A diff describing the changes to a record.\n *\n * @public\n */\nexport type RecordsDiff<R extends UnknownRecord> = {\n\tadded: Record<IdOf<R>, R>\n\tupdated: Record<IdOf<R>, [from: R, to: R]>\n\tremoved: Record<IdOf<R>, R>\n}\n\n/**\n * A diff describing the changes to a collection.\n *\n * @public\n */\nexport type CollectionDiff<T> = { added?: Set<T>; removed?: Set<T> }\n\nexport type ChangeSource = 'user' | 'remote'\n\nexport type StoreListenerFilters = {\n\tsource: ChangeSource | 'all'\n\tscope: RecordScope | 'all'\n}\n\n/**\n * An entry containing changes that originated either by user actions or remote changes.\n *\n * @public\n */\nexport type HistoryEntry<R extends UnknownRecord = UnknownRecord> = {\n\tchanges: RecordsDiff<R>\n\tsource: ChangeSource\n}\n\n/**\n * A function that will be called when the history changes.\n *\n * @public\n */\nexport type StoreListener<R extends UnknownRecord> = (entry: HistoryEntry<R>) => void\n\n/**\n * A record store is a collection of records of different types.\n *\n * @public\n */\nexport type ComputedCache<Data, R extends UnknownRecord> = {\n\tget(id: IdOf<R>): Data | undefined\n}\n\n/**\n * A serialized snapshot of the record store's values.\n *\n * @public\n */\nexport type SerializedStore<R extends UnknownRecord> = Record<IdOf<R>, R>\n\n/** @public */\nexport type StoreSnapshot<R extends UnknownRecord> = {\n\tstore: SerializedStore<R>\n\tschema: SerializedSchema\n}\n\n/** @public */\nexport type StoreValidator<R extends UnknownRecord> = {\n\tvalidate: (record: unknown) => R\n\tvalidateUsingKnownGoodVersion?: (knownGoodVersion: R, record: unknown) => R\n}\n\n/** @public */\nexport type StoreValidators<R extends UnknownRecord> = {\n\t[K in R['typeName']]: StoreValidator<Extract<R, { typeName: K }>>\n}\n\n/** @public */\nexport type StoreError = {\n\terror: Error\n\tphase: 'initialize' | 'createRecord' | 'updateRecord' | 'tests'\n\trecordBefore?: unknown\n\trecordAfter: unknown\n\tisExistingValidationIssue: boolean\n}\n\n/** @internal */\nexport type StoreRecord<S extends Store<any>> = S extends Store<infer R> ? R : never\n\n/**\n * A store of records.\n *\n * @public\n */\nexport class Store<R extends UnknownRecord = UnknownRecord, Props = unknown> {\n\t/**\n\t * The random id of the store.\n\t */\n\tpublic readonly id = nanoid()\n\t/**\n\t * An atom containing the store's atoms.\n\t *\n\t * @internal\n\t * @readonly\n\t */\n\tprivate readonly atoms = atom('store_atoms', {} as Record<IdOf<R>, Atom<R>>)\n\n\t/**\n\t * An atom containing the store's history.\n\t *\n\t * @public\n\t * @readonly\n\t */\n\treadonly history: Atom<number, RecordsDiff<R>> = atom('history', 0, {\n\t\thistoryLength: 1000,\n\t})\n\n\t/**\n\t * A StoreQueries instance for this store.\n\t *\n\t * @public\n\t * @readonly\n\t */\n\treadonly query = new StoreQueries<R>(this.atoms, this.history)\n\n\t/**\n\t * A set containing listeners that have been added to this store.\n\t *\n\t * @internal\n\t */\n\tprivate listeners = new Set<{ onHistory: StoreListener<R>; filters: StoreListenerFilters }>()\n\n\t/**\n\t * An array of history entries that have not yet been flushed.\n\t *\n\t * @internal\n\t */\n\tprivate historyAccumulator = new HistoryAccumulator<R>()\n\n\t/**\n\t * A reactor that responds to changes to the history by squashing the accumulated history and\n\t * notifying listeners of the changes.\n\t *\n\t * @internal\n\t */\n\tprivate historyReactor: Reactor\n\n\treadonly schema: StoreSchema<R, Props>\n\n\treadonly props: Props\n\n\tpublic readonly scopedTypes: { readonly [K in RecordScope]: ReadonlySet<R['typeName']> }\n\n\tconstructor(config: {\n\t\t/** The store's initial data. */\n\t\tinitialData?: SerializedStore<R>\n\t\t/**\n\t\t * A map of validators for each record type. A record's validator will be called when the record\n\t\t * is created or updated. It should throw an error if the record is invalid.\n\t\t */\n\t\tschema: StoreSchema<R, Props>\n\t\tprops: Props\n\t}) {\n\t\tconst { initialData, schema } = config\n\n\t\tthis.schema = schema\n\t\tthis.props = config.props\n\n\t\tif (initialData) {\n\t\t\tthis.atoms.set(\n\t\t\t\tobjectMapFromEntries(\n\t\t\t\t\tobjectMapEntries(initialData).map(([id, record]) => [\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tatom(\n\t\t\t\t\t\t\t'atom:' + id,\n\t\t\t\t\t\t\tdevFreeze(this.schema.validateRecord(this, record, 'initialize', null))\n\t\t\t\t\t\t),\n\t\t\t\t\t])\n\t\t\t\t)\n\t\t\t)\n\t\t}\n\n\t\tthis.historyReactor = reactor(\n\t\t\t'Store.historyReactor',\n\t\t\t() => {\n\t\t\t\t// deref to make sure we're subscribed regardless of whether we need to propagate\n\t\t\t\tthis.history.get()\n\t\t\t\t// If we have accumulated history, flush it and update listeners\n\t\t\t\tthis._flushHistory()\n\t\t\t},\n\t\t\t{ scheduleEffect: (cb) => throttleToNextFrame(cb) }\n\t\t)\n\t\tthis.scopedTypes = {\n\t\t\tdocument: new Set(\n\t\t\t\tobjectMapValues(this.schema.types)\n\t\t\t\t\t.filter((t) => t.scope === 'document')\n\t\t\t\t\t.map((t) => t.typeName)\n\t\t\t),\n\t\t\tsession: new Set(\n\t\t\t\tobjectMapValues(this.schema.types)\n\t\t\t\t\t.filter((t) => t.scope === 'session')\n\t\t\t\t\t.map((t) => t.typeName)\n\t\t\t),\n\t\t\tpresence: new Set(\n\t\t\t\tobjectMapValues(this.schema.types)\n\t\t\t\t\t.filter((t) => t.scope === 'presence')\n\t\t\t\t\t.map((t) => t.typeName)\n\t\t\t),\n\t\t}\n\t}\n\n\tpublic _flushHistory() {\n\t\t// If we have accumulated history, flush it and update listeners\n\t\tif (this.historyAccumulator.hasChanges()) {\n\t\t\tconst entries = this.historyAccumulator.flush()\n\t\t\tfor (const { changes, source } of entries) {\n\t\t\t\tlet instanceChanges = null as null | RecordsDiff<R>\n\t\t\t\tlet documentChanges = null as null | RecordsDiff<R>\n\t\t\t\tlet presenceChanges = null as null | RecordsDiff<R>\n\t\t\t\tfor (const { onHistory, filters } of this.listeners) {\n\t\t\t\t\tif (filters.source !== 'all' && filters.source !== source) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\tif (filters.scope !== 'all') {\n\t\t\t\t\t\tif (filters.scope === 'document') {\n\t\t\t\t\t\t\tdocumentChanges ??= this.filterChangesByScope(changes, 'document')\n\t\t\t\t\t\t\tif (!documentChanges) continue\n\t\t\t\t\t\t\tonHistory({ changes: documentChanges, source })\n\t\t\t\t\t\t} else if (filters.scope === 'session') {\n\t\t\t\t\t\t\tinstanceChanges ??= this.filterChangesByScope(changes, 'session')\n\t\t\t\t\t\t\tif (!instanceChanges) continue\n\t\t\t\t\t\t\tonHistory({ changes: instanceChanges, source })\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpresenceChanges ??= this.filterChangesByScope(changes, 'presence')\n\t\t\t\t\t\t\tif (!presenceChanges) continue\n\t\t\t\t\t\t\tonHistory({ changes: presenceChanges, source })\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tonHistory({ changes, source })\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Filters out non-document changes from a diff. Returns null if there are no changes left.\n\t * @param change - the records diff\n\t * @returns\n\t */\n\tfilterChangesByScope(change: RecordsDiff<R>, scope: RecordScope) {\n\t\tconst result = {\n\t\t\tadded: filterEntries(change.added, (_, r) => this.scopedTypes[scope].has(r.typeName)),\n\t\t\tupdated: filterEntries(change.updated, (_, r) => this.scopedTypes[scope].has(r[1].typeName)),\n\t\t\tremoved: filterEntries(change.removed, (_, r) => this.scopedTypes[scope].has(r.typeName)),\n\t\t}\n\t\tif (\n\t\t\tObject.keys(result.added).length === 0 &&\n\t\t\tObject.keys(result.updated).length === 0 &&\n\t\t\tObject.keys(result.removed).length === 0\n\t\t) {\n\t\t\treturn null\n\t\t}\n\t\treturn result\n\t}\n\n\t/**\n\t * Update the history with a diff of changes.\n\t *\n\t * @param changes - The changes to add to the history.\n\t */\n\tprivate updateHistory(changes: RecordsDiff<R>): void {\n\t\tthis.historyAccumulator.add({\n\t\t\tchanges,\n\t\t\tsource: this.isMergingRemoteChanges ? 'remote' : 'user',\n\t\t})\n\t\tif (this.listeners.size === 0) {\n\t\t\tthis.historyAccumulator.clear()\n\t\t}\n\t\tthis.history.set(this.history.get() + 1, changes)\n\t}\n\n\tvalidate(phase: 'initialize' | 'createRecord' | 'updateRecord' | 'tests') {\n\t\tthis.allRecords().forEach((record) => this.schema.validateRecord(this, record, phase, null))\n\t}\n\n\t/**\n\t * A callback fired after each record's change.\n\t *\n\t * @param prev - The previous value, if any.\n\t * @param next - The next value.\n\t */\n\tonBeforeCreate?: (next: R, source: 'remote' | 'user') => R\n\n\t/**\n\t * A callback fired after a record is created. Use this to perform related updates to other\n\t * records in the store.\n\t *\n\t * @param record - The record to be created\n\t */\n\tonAfterCreate?: (record: R, source: 'remote' | 'user') => void\n\n\t/**\n\t * A callback fired before each record's change.\n\t *\n\t * @param prev - The previous value, if any.\n\t * @param next - The next value.\n\t */\n\tonBeforeChange?: (prev: R, next: R, source: 'remote' | 'user') => R\n\n\t/**\n\t * A callback fired after each record's change.\n\t *\n\t * @param prev - The previous value, if any.\n\t * @param next - The next value.\n\t */\n\tonAfterChange?: (prev: R, next: R, source: 'remote' | 'user') => void\n\n\t/**\n\t * A callback fired before a record is deleted.\n\t *\n\t * @param prev - The record that will be deleted.\n\t */\n\tonBeforeDelete?: (prev: R, source: 'remote' | 'user') => false | void\n\n\t/**\n\t * A callback fired after a record is deleted.\n\t *\n\t * @param prev - The record that will be deleted.\n\t */\n\tonAfterDelete?: (prev: R, source: 'remote' | 'user') => void\n\n\t// used to avoid running callbacks when rolling back changes in sync client\n\tprivate _runCallbacks = true\n\n\t/**\n\t * Add some records to the store. It's an error if they already exist.\n\t *\n\t * @param records - The records to add.\n\t * @public\n\t */\n\tput = (records: R[], phaseOverride?: 'initialize'): void => {\n\t\ttransact(() => {\n\t\t\tconst updates: Record<IdOf<UnknownRecord>, [from: R, to: R]> = {}\n\t\t\tconst additions: Record<IdOf<UnknownRecord>, R> = {}\n\n\t\t\tconst currentMap = this.atoms.__unsafe__getWithoutCapture()\n\t\t\tlet map = null as null | Record<IdOf<UnknownRecord>, Atom<R>>\n\n\t\t\t// Iterate through all records, creating, updating or removing as needed\n\t\t\tlet record: R\n\n\t\t\t// There's a chance that, despite having records, all of the values are\n\t\t\t// identical to what they were before; and so we'd end up with an \"empty\"\n\t\t\t// history entry. Let's keep track of whether we've actually made any\n\t\t\t// changes (e.g. additions, deletions, or updates that produce a new value).\n\t\t\tlet didChange = false\n\n\t\t\tconst beforeCreate = this.onBeforeCreate && this._runCallbacks ? this.onBeforeCreate : null\n\t\t\tconst beforeUpdate = this.onBeforeChange && this._runCallbacks ? this.onBeforeChange : null\n\t\t\tconst source = this.isMergingRemoteChanges ? 'remote' : 'user'\n\n\t\t\tfor (let i = 0, n = records.length; i < n; i++) {\n\t\t\t\trecord = records[i]\n\n\t\t\t\tconst recordAtom = (map ?? currentMap)[record.id as IdOf<R>]\n\n\t\t\t\tif (recordAtom) {\n\t\t\t\t\t// If we already have an atom for this record, update its value.\n\t\t\t\t\tconst initialValue = recordAtom.__unsafe__getWithoutCapture()\n\n\t\t\t\t\t// If we have a beforeUpdate callback, run it against the initial and next records\n\t\t\t\t\tif (beforeUpdate) record = beforeUpdate(initialValue, record, source)\n\n\t\t\t\t\t// Validate the record\n\t\t\t\t\tconst validated = this.schema.validateRecord(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\trecord,\n\t\t\t\t\t\tphaseOverride ?? 'updateRecord',\n\t\t\t\t\t\tinitialValue\n\t\t\t\t\t)\n\n\t\t\t\t\tif (validated === initialValue) continue\n\n\t\t\t\t\trecordAtom.set(devFreeze(record))\n\n\t\t\t\t\tdidChange = true\n\t\t\t\t\tupdates[record.id] = [initialValue, recordAtom.__unsafe__getWithoutCapture()]\n\t\t\t\t} else {\n\t\t\t\t\tif (beforeCreate) record = beforeCreate(record, source)\n\n\t\t\t\t\tdidChange = true\n\n\t\t\t\t\t// If we don't have an atom, create one.\n\n\t\t\t\t\t// Validate the record\n\t\t\t\t\trecord = this.schema.validateRecord(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\trecord as R,\n\t\t\t\t\t\tphaseOverride ?? 'createRecord',\n\t\t\t\t\t\tnull\n\t\t\t\t\t)\n\n\t\t\t\t\t// Mark the change as a new addition.\n\t\t\t\t\tadditions[record.id] = record\n\n\t\t\t\t\t// Assign the atom to the map under the record's id.\n\t\t\t\t\tif (!map) {\n\t\t\t\t\t\tmap = { ...currentMap }\n\t\t\t\t\t}\n\t\t\t\t\tmap[record.id] = atom('atom:' + record.id, record)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set the map of atoms to the store.\n\t\t\tif (map) {\n\t\t\t\tthis.atoms.set(map)\n\t\t\t}\n\n\t\t\t// If we did change, update the history\n\t\t\tif (!didChange) return\n\t\t\tthis.updateHistory({\n\t\t\t\tadded: additions,\n\t\t\t\tupdated: updates,\n\t\t\t\tremoved: {} as Record<IdOf<R>, R>,\n\t\t\t})\n\n\t\t\tif (this._runCallbacks) {\n\t\t\t\tconst { onAfterCreate, onAfterChange } = this\n\n\t\t\t\tif (onAfterCreate) {\n\t\t\t\t\t// Run the onAfterChange callback for addition.\n\t\t\t\t\tObject.values(additions).forEach((record) => {\n\t\t\t\t\t\tonAfterCreate(record, source)\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tif (onAfterChange) {\n\t\t\t\t\t// Run the onAfterChange callback for update.\n\t\t\t\t\tObject.values(updates).forEach(([from, to]) => {\n\t\t\t\t\t\tonAfterChange(from, to, source)\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * Remove some records from the store via their ids.\n\t *\n\t * @param ids - The ids of the records to remove.\n\t * @public\n\t */\n\tremove = (ids: IdOf<R>[]): void => {\n\t\ttransact(() => {\n\t\t\tconst cancelled = [] as IdOf<R>[]\n\t\t\tconst source = this.isMergingRemoteChanges ? 'remote' : 'user'\n\n\t\t\tif (this.onBeforeDelete && this._runCallbacks) {\n\t\t\t\tfor (const id of ids) {\n\t\t\t\t\tconst atom = this.atoms.__unsafe__getWithoutCapture()[id]\n\t\t\t\t\tif (!atom) continue\n\n\t\t\t\t\tif (this.onBeforeDelete(atom.get(), source) === false) {\n\t\t\t\t\t\tcancelled.push(id)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet removed = undefined as undefined | RecordsDiff<R>['removed']\n\n\t\t\t// For each map in our atoms, remove the ids that we are removing.\n\t\t\tthis.atoms.update((atoms) => {\n\t\t\t\tlet result: typeof atoms | undefined = undefined\n\n\t\t\t\tfor (const id of ids) {\n\t\t\t\t\tif (cancelled.includes(id)) continue\n\t\t\t\t\tif (!(id in atoms)) continue\n\t\t\t\t\tif (!result) result = { ...atoms }\n\t\t\t\t\tif (!removed) removed = {} as Record<IdOf<R>, R>\n\t\t\t\t\tdelete result[id]\n\t\t\t\t\tremoved[id] = atoms[id].get()\n\t\t\t\t}\n\n\t\t\t\treturn result ?? atoms\n\t\t\t})\n\n\t\t\tif (!removed) return\n\t\t\t// Update the history with the removed records.\n\t\t\tthis.updateHistory({ added: {}, updated: {}, removed } as RecordsDiff<R>)\n\n\t\t\t// If we have an onAfterChange, run it for each removed record.\n\t\t\tif (this.onAfterDelete && this._runCallbacks) {\n\t\t\t\tlet record: R\n\t\t\t\tfor (let i = 0, n = ids.length; i < n; i++) {\n\t\t\t\t\trecord = removed[ids[i]]\n\t\t\t\t\tif (record) {\n\t\t\t\t\t\tthis.onAfterDelete(record, source)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * Get the value of a store record by its id.\n\t *\n\t * @param id - The id of the record to get.\n\t * @public\n\t */\n\tget = <K extends IdOf<R>>(id: K): RecFromId<K> | undefined => {\n\t\treturn this.atoms.get()[id]?.get() as any\n\t}\n\n\t/**\n\t * Get the value of a store record by its id without updating its epoch.\n\t *\n\t * @param id - The id of the record to get.\n\t * @public\n\t */\n\tunsafeGetWithoutCapture = <K extends IdOf<R>>(id: K): RecFromId<K> | undefined => {\n\t\treturn this.atoms.get()[id]?.__unsafe__getWithoutCapture() as any\n\t}\n\n\t/**\n\t * Creates a JSON payload from the record store.\n\t *\n\t * @param scope - The scope of records to serialize. Defaults to 'document'.\n\t * @returns The record store snapshot as a JSON payload.\n\t */\n\tserialize = (scope: RecordScope | 'all' = 'document'): SerializedStore<R> => {\n\t\tconst result = {} as SerializedStore<R>\n\t\tfor (const [id, atom] of objectMapEntries(this.atoms.get())) {\n\t\t\tconst record = atom.get()\n\t\t\tif (scope === 'all' || this.scopedTypes[scope].has(record.typeName)) {\n\t\t\t\tresult[id as IdOf<R>] = record\n\t\t\t}\n\t\t}\n\t\treturn result\n\t}\n\n\t/**\n\t * Get a serialized snapshot of the store and its schema.\n\t *\n\t * ```ts\n\t * const snapshot = store.getSnapshot()\n\t * store.loadSnapshot(snapshot)\n\t * ```\n\t *\n\t * @param scope - The scope of records to serialize. Defaults to 'document'.\n\t *\n\t * @public\n\t */\n\tgetSnapshot(scope: RecordScope | 'all' = 'document'): StoreSnapshot<R> {\n\t\treturn {\n\t\t\tstore: this.serialize(scope),\n\t\t\tschema: this.schema.serialize(),\n\t\t}\n\t}\n\n\t/**\n\t * Migrate a serialized snapshot of the store and its schema.\n\t *\n\t * ```ts\n\t * const snapshot = store.getSnapshot()\n\t * store.migrateSnapshot(snapshot)\n\t * ```\n\t *\n\t * @param snapshot - The snapshot to load.\n\t * @public\n\t */\n\tmigrateSnapshot(snapshot: StoreSnapshot<R>): StoreSnapshot<R> {\n\t\tconst migrationResult = this.schema.migrateStoreSnapshot(snapshot)\n\n\t\tif (migrationResult.type === 'error') {\n\t\t\tthrow new Error(`Failed to migrate snapshot: ${migrationResult.reason}`)\n\t\t}\n\n\t\treturn {\n\t\t\tstore: migrationResult.value,\n\t\t\tschema: this.schema.serialize(),\n\t\t}\n\t}\n\n\t/**\n\t * Load a serialized snapshot.\n\t *\n\t * ```ts\n\t * const snapshot = store.getSnapshot()\n\t * store.loadSnapshot(snapshot)\n\t * ```\n\t *\n\t * @param snapshot - The snapshot to load.\n\t * @public\n\t */\n\tloadSnapshot(snapshot: StoreSnapshot<R>): void {\n\t\tconst migrationResult = this.schema.migrateStoreSnapshot(snapshot)\n\n\t\tif (migrationResult.type === 'error') {\n\t\t\tthrow new Error(`Failed to migrate snapshot: ${migrationResult.reason}`)\n\t\t}\n\n\t\tconst prevRunCallbacks = this._runCallbacks\n\t\ttry {\n\t\t\tthis._runCallbacks = false\n\t\t\ttransact(() => {\n\t\t\t\tthis.clear()\n\t\t\t\tthis.put(Object.values(migrationResult.value))\n\t\t\t\tthis.ensureStoreIsUsable()\n\t\t\t})\n\t\t} finally {\n\t\t\tthis._runCallbacks = prevRunCallbacks\n\t\t}\n\t}\n\n\t/**\n\t * Get an array of all values in the store.\n\t *\n\t * @returns An array of all values in the store.\n\t * @public\n\t */\n\tallRecords = (): R[] => {\n\t\treturn objectMapValues(this.atoms.get()).map((atom) => atom.get())\n\t}\n\n\t/**\n\t * Removes all records from the store.\n\t *\n\t * @public\n\t */\n\tclear = (): void => {\n\t\tthis.remove(objectMapKeys(this.atoms.get()))\n\t}\n\n\t/**\n\t * Update a record. To update multiple records at once, use the `update` method of the\n\t * `TypedStore` class.\n\t *\n\t * @param id - The id of the record to update.\n\t * @param updater - A function that updates the record.\n\t */\n\tupdate = <K extends IdOf<R>>(id: K, updater: (record: RecFromId<K>) => RecFromId<K>) => {\n\t\tconst atom = this.atoms.get()[id]\n\t\tif (!atom) {\n\t\t\tconsole.error(`Record ${id} not found. This is probably an error`)\n\t\t\treturn\n\t\t}\n\n\t\tthis.put([updater(atom.__unsafe__getWithoutCapture() as any as RecFromId<K>) as any])\n\t}\n\n\t/**\n\t * Get whether the record store has a id.\n\t *\n\t * @param id - The id of the record to check.\n\t * @public\n\t */\n\thas = <K extends IdOf<R>>(id: K): boolean => {\n\t\treturn !!this.atoms.get()[id]\n\t}\n\n\t/**\n\t * Add a new listener to the store.\n\t *\n\t * @param onHistory - The listener to call when the store updates.\n\t * @param filters - Filters to apply to the listener.\n\t * @returns A function to remove the listener.\n\t */\n\tlisten = (onHistory: StoreListener<R>, filters?: Partial<StoreListenerFilters>) => {\n\t\t// flush history so that this listener's history starts from exactly now\n\t\tthis._flushHistory()\n\n\t\tconst listener = {\n\t\t\tonHistory,\n\t\t\tfilters: {\n\t\t\t\tsource: filters?.source ?? 'all',\n\t\t\t\tscope: filters?.scope ?? 'all',\n\t\t\t},\n\t\t}\n\n\t\tthis.listeners.add(listener)\n\n\t\tif (!this.historyReactor.scheduler.isActivelyListening) {\n\t\t\tthis.historyReactor.start()\n\t\t}\n\n\t\treturn () => {\n\t\t\tthis.listeners.delete(listener)\n\n\t\t\tif (this.listeners.size === 0) {\n\t\t\t\tthis.historyReactor.stop()\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate isMergingRemoteChanges = false\n\n\t/**\n\t * Merge changes from a remote source without triggering listeners.\n\t *\n\t * @param fn - A function that merges the external changes.\n\t * @public\n\t */\n\tmergeRemoteChanges = (fn: () => void) => {\n\t\tif (this.isMergingRemoteChanges) {\n\t\t\treturn fn()\n\t\t}\n\n\t\ttry {\n\t\t\tthis.isMergingRemoteChanges = true\n\t\t\ttransact(fn)\n\t\t} finally {\n\t\t\tthis.isMergingRemoteChanges = false\n\t\t}\n\t}\n\n\textractingChanges(fn: () => void): RecordsDiff<R> {\n\t\tconst changes: Array<RecordsDiff<R>> = []\n\t\tconst dispose = this.historyAccumulator.intercepting((entry) => changes.push(entry.changes))\n\t\ttry {\n\t\t\ttransact(fn)\n\t\t\treturn squashRecordDiffs(changes)\n\t\t} finally {\n\t\t\tdispose()\n\t\t}\n\t}\n\n\tapplyDiff(diff: RecordsDiff<R>, runCallbacks = true) {\n\t\tconst prevRunCallbacks = this._runCallbacks\n\t\ttry {\n\t\t\tthis._runCallbacks = runCallbacks\n\t\t\ttransact(() => {\n\t\t\t\tconst toPut = objectMapValues(diff.added).concat(\n\t\t\t\t\tobjectMapValues(diff.updated).map(([_from, to]) => to)\n\t\t\t\t)\n\t\t\t\tconst toRemove = objectMapKeys(diff.removed)\n\t\t\t\tif (toPut.length) {\n\t\t\t\t\tthis.put(toPut)\n\t\t\t\t}\n\t\t\t\tif (toRemove.length) {\n\t\t\t\t\tthis.remove(toRemove)\n\t\t\t\t}\n\t\t\t})\n\t\t} finally {\n\t\t\tthis._runCallbacks = prevRunCallbacks\n\t\t}\n\t}\n\n\t/**\n\t * Create a computed cache.\n\t *\n\t * @param name - The name of the derivation cache.\n\t * @param derive - A function used to derive the value of the cache.\n\t * @public\n\t */\n\tcreateComputedCache = <T, V extends R = R>(\n\t\tname: string,\n\t\tderive: (record: V) => T | undefined,\n\t\tisEqual?: (a: V, b: V) => boolean\n\t): ComputedCache<T, V> => {\n\t\tconst cache = new Cache<Atom<any>, Computed<T | undefined>>()\n\t\treturn {\n\t\t\tget: (id: IdOf<V>) => {\n\t\t\t\tconst atom = this.atoms.get()[id]\n\t\t\t\tif (!atom) {\n\t\t\t\t\treturn undefined\n\t\t\t\t}\n\t\t\t\treturn cache\n\t\t\t\t\t.get(atom, () => {\n\t\t\t\t\t\tconst recordSignal = isEqual\n\t\t\t\t\t\t\t? computed(atom.name + ':equals', () => atom.get(), { isEqual })\n\t\t\t\t\t\t\t: atom\n\t\t\t\t\t\treturn computed<T | undefined>(name + ':' + id, () => {\n\t\t\t\t\t\t\treturn derive(recordSignal.get() as V)\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.get()\n\t\t\t},\n\t\t}\n\t}\n\n\t/**\n\t * Create a computed cache from a selector\n\t *\n\t * @param name - The name of the derivation cache.\n\t * @param selector - A function that returns a subset of the original shape\n\t * @param derive - A function used to derive the value of the cache.\n\t * @public\n\t */\n\tcreateSelectedComputedCache = <T, J, V extends R = R>(\n\t\tname: string,\n\t\tselector: (record: V) => T | undefined,\n\t\tderive: (input: T) => J | undefined\n\t): ComputedCache<J, V> => {\n\t\tconst cache = new Cache<Atom<any>, Computed<J | undefined>>()\n\t\treturn {\n\t\t\tget: (id: IdOf<V>) => {\n\t\t\t\tconst atom = this.atoms.get()[id]\n\t\t\t\tif (!atom) {\n\t\t\t\t\treturn undefined\n\t\t\t\t}\n\n\t\t\t\tconst d = computed<T | undefined>(name + ':' + id + ':selector', () =>\n\t\t\t\t\tselector(atom.get() as V)\n\t\t\t\t)\n\t\t\t\treturn cache\n\t\t\t\t\t.get(atom, () => computed<J | undefined>(name + ':' + id, () => derive(d.get() as T)))\n\t\t\t\t\t.get()\n\t\t\t},\n\t\t}\n\t}\n\n\tgetRecordType = <T extends R>(record: R): T => {\n\t\tconst type = this.schema.types[record.typeName as R['typeName']]\n\t\tif (!type) {\n\t\t\tthrow new Error(`Record type ${record.typeName} not found`)\n\t\t}\n\t\treturn type as unknown as T\n\t}\n\n\tprivate _integrityChecker?: () => void | undefined\n\n\t/** @internal */\n\tensureStoreIsUsable() {\n\t\tthis._integrityChecker ??= this.schema.createIntegrityChecker(this)\n\t\tthis._integrityChecker?.()\n\t}\n\n\tprivate _isPossiblyCorrupted = false\n\t/** @internal */\n\tmarkAsPossiblyCorrupted() {\n\t\tthis._isPossiblyCorrupted = true\n\t}\n\t/** @internal */\n\tisPossiblyCorrupted() {\n\t\treturn this._isPossiblyCorrupted\n\t}\n}\n\n/**\n * Squash a collection of diffs into a single diff.\n *\n * @param diffs - An array of diffs to squash.\n * @returns A single diff that represents the squashed diffs.\n * @public\n */\nexport function squashRecordDiffs<T extends UnknownRecord>(\n\tdiffs: RecordsDiff<T>[]\n): RecordsDiff<T> {\n\tconst result = { added: {}, removed: {}, updated: {} } as RecordsDiff<T>\n\n\tfor (const diff of diffs) {\n\t\tfor (const [id, value] of objectMapEntries(diff.added)) {\n\t\t\tif (result.removed[id]) {\n\t\t\t\tconst original = result.removed[id]\n\t\t\t\tdelete result.removed[id]\n\t\t\t\tif (original !== value) {\n\t\t\t\t\tresult.updated[id] = [original, value]\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult.added[id] = value\n\t\t\t}\n\t\t}\n\n\t\tfor (const [id, [_from, to]] of objectMapEntries(diff.updated)) {\n\t\t\tif (result.added[id]) {\n\t\t\t\tresult.added[id] = to\n\t\t\t\tdelete result.updated[id]\n\t\t\t\tdelete result.removed[id]\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tif (result.updated[id]) {\n\t\t\t\tresult.updated[id] = [result.updated[id][0], to]\n\t\t\t\tdelete result.removed[id]\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tresult.updated[id] = diff.updated[id]\n\t\t\tdelete result.removed[id]\n\t\t}\n\n\t\tfor (const [id, value] of objectMapEntries(diff.removed)) {\n\t\t\t// the same record was added in this diff sequence, just drop it\n\t\t\tif (result.added[id]) {\n\t\t\t\tdelete result.added[id]\n\t\t\t} else if (result.updated[id]) {\n\t\t\t\tresult.removed[id] = result.updated[id][0]\n\t\t\t\tdelete result.updated[id]\n\t\t\t} else {\n\t\t\t\tresult.removed[id] = value\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result\n}\n\n/**\n * Collect all history entries by their adjacent sources.\n * For example, [user, user, remote, remote, user] would result in [user, remote, user],\n * with adjacent entries of the same source squashed into a single entry.\n *\n * @param entries - The array of history entries.\n * @returns A map of history entries by their sources.\n * @public\n */\nfunction squashHistoryEntries<T extends UnknownRecord>(\n\tentries: HistoryEntry<T>[]\n): HistoryEntry<T>[] {\n\tif (entries.length === 0) return []\n\n\tconst chunked: HistoryEntry<T>[][] = []\n\tlet chunk: HistoryEntry<T>[] = [entries[0]]\n\tlet entry: HistoryEntry<T>\n\n\tfor (let i = 1, n = entries.length; i < n; i++) {\n\t\tentry = entries[i]\n\t\tif (chunk[0].source !== entry.source) {\n\t\t\tchunked.push(chunk)\n\t\t\tchunk = []\n\t\t}\n\t\tchunk.push(entry)\n\t}\n\t// Push the last chunk\n\tchunked.push(chunk)\n\n\treturn devFreeze(\n\t\tchunked.map((chunk) => ({\n\t\t\tsource: chunk[0].source,\n\t\t\tchanges: squashRecordDiffs(chunk.map((e) => e.changes)),\n\t\t}))\n\t)\n}\n\n/** @public */\nexport function reverseRecordsDiff(diff: RecordsDiff<any>) {\n\tconst result: RecordsDiff<any> = { added: diff.removed, removed: diff.added, updated: {} }\n\tfor (const [from, to] of Object.values(diff.updated)) {\n\t\tresult.updated[from.id] = [to, from]\n\t}\n\treturn result\n}\n\nclass HistoryAccumulator<T extends UnknownRecord> {\n\tprivate _history: HistoryEntry<T>[] = []\n\n\tprivate _interceptors: Set<(entry: HistoryEntry<T>) => void> = new Set()\n\n\tintercepting(fn: (entry: HistoryEntry<T>) => void) {\n\t\tthis._interceptors.add(fn)\n\t\treturn () => {\n\t\t\tthis._interceptors.delete(fn)\n\t\t}\n\t}\n\n\tadd(entry: HistoryEntry<T>) {\n\t\tthis._history.push(entry)\n\t\tfor (const interceptor of this._interceptors) {\n\t\t\tinterceptor(entry)\n\t\t}\n\t}\n\n\tflush() {\n\t\tconst history = squashHistoryEntries(this._history)\n\t\tthis._history = []\n\t\treturn history\n\t}\n\n\tclear() {\n\t\tthis._history = []\n\t}\n\n\thasChanges() {\n\t\treturn this._history.length > 0\n\t}\n}\n", "import { assert, objectMapEntries } from '@tldraw/utils'\nimport { UnknownRecord } from './BaseRecord'\nimport { SerializedStore } from './Store'\n\nlet didWarn = false\n\n/**\n * @public\n * @deprecated use `createShapePropsMigrationSequence` instead. See [the docs](https://tldraw.dev/docs/persistence#Updating-legacy-shape-migrations-defineMigrations) for how to migrate.\n */\nexport function defineMigrations(opts: {\n\tfirstVersion?: number\n\tcurrentVersion?: number\n\tmigrators?: Record<number, LegacyMigration>\n\tsubTypeKey?: string\n\tsubTypeMigrations?: Record<string, LegacyBaseMigrationsInfo>\n}): LegacyMigrations {\n\tconst { currentVersion, firstVersion, migrators = {}, subTypeKey, subTypeMigrations } = opts\n\tif (!didWarn) {\n\t\tconsole.warn(\n\t\t\t`The 'defineMigrations' function is deprecated and will be removed in a future release. Use the new migrations API instead. See the migration guide for more info: https://tldraw.dev/docs/persistence#Updating-legacy-shape-migrations-defineMigrations`\n\t\t)\n\t\tdidWarn = true\n\t}\n\n\t// Some basic guards against impossible version combinations, some of which will be caught by TypeScript\n\tif (typeof currentVersion === 'number' && typeof firstVersion === 'number') {\n\t\tif ((currentVersion as number) === (firstVersion as number)) {\n\t\t\tthrow Error(`Current version is equal to initial version.`)\n\t\t} else if (currentVersion < firstVersion) {\n\t\t\tthrow Error(`Current version is lower than initial version.`)\n\t\t}\n\t}\n\n\treturn {\n\t\tfirstVersion: (firstVersion as number) ?? 0, // defaults\n\t\tcurrentVersion: (currentVersion as number) ?? 0, // defaults\n\t\tmigrators,\n\t\tsubTypeKey,\n\t\tsubTypeMigrations,\n\t}\n}\n\nfunction squashDependsOn(sequence: Array<Migration | StandaloneDependsOn>): Migration[] {\n\tconst result: Migration[] = []\n\tfor (let i = sequence.length - 1; i >= 0; i--) {\n\t\tconst elem = sequence[i]\n\t\tif (!('id' in elem)) {\n\t\t\tconst dependsOn = elem.dependsOn\n\t\t\tconst prev = result[0]\n\t\t\tif (prev) {\n\t\t\t\tresult[0] = {\n\t\t\t\t\t...prev,\n\t\t\t\t\tdependsOn: dependsOn.concat(prev.dependsOn ?? []),\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tresult.unshift(elem)\n\t\t}\n\t}\n\treturn result\n}\n\n/**\n * Creates a migration sequence.\n * See the [migration guide](https://tldraw.dev/docs/persistence#Migrations) for more info on how to use this API.\n * @public\n */\nexport function createMigrationSequence({\n\tsequence,\n\tsequenceId,\n\tretroactive = true,\n}: {\n\tsequenceId: string\n\tretroactive?: boolean\n\tsequence: Array<Migration | StandaloneDependsOn>\n}): MigrationSequence {\n\tconst migrations: MigrationSequence = {\n\t\tsequenceId,\n\t\tretroactive,\n\t\tsequence: squashDependsOn(sequence),\n\t}\n\tvalidateMigrations(migrations)\n\treturn migrations\n}\n\n/**\n * Creates a named set of migration ids given a named set of version numbers and a sequence id.\n *\n * See the [migration guide](https://tldraw.dev/docs/persistence#Migrations) for more info on how to use this API.\n * @public\n * @public\n */\nexport function createMigrationIds<ID extends string, Versions extends Record<string, number>>(\n\tsequenceId: ID,\n\tversions: Versions\n): { [K in keyof Versions]: `${ID}/${Versions[K]}` } {\n\treturn Object.fromEntries(\n\t\tobjectMapEntries(versions).map(([key, version]) => [key, `${sequenceId}/${version}`] as const)\n\t) as any\n}\n\n/** @internal */\nexport function createRecordMigrationSequence(opts: {\n\trecordType: string\n\tfilter?: (record: UnknownRecord) => boolean\n\tretroactive?: boolean\n\tsequenceId: string\n\tsequence: Omit<Extract<Migration, { scope: 'record' }>, 'scope'>[]\n}): MigrationSequence {\n\tconst sequenceId = opts.sequenceId\n\treturn createMigrationSequence({\n\t\tsequenceId,\n\t\tretroactive: opts.retroactive ?? true,\n\t\tsequence: opts.sequence.map((m) =>\n\t\t\t'id' in m\n\t\t\t\t? {\n\t\t\t\t\t\t...m,\n\t\t\t\t\t\tscope: 'record',\n\t\t\t\t\t\tfilter: (r: UnknownRecord) =>\n\t\t\t\t\t\t\tr.typeName === opts.recordType &&\n\t\t\t\t\t\t\t(m.filter?.(r) ?? true) &&\n\t\t\t\t\t\t\t(opts.filter?.(r) ?? true),\n\t\t\t\t\t}\n\t\t\t\t: m\n\t\t),\n\t})\n}\n\n/** @public */\nexport type LegacyMigration<Before = any, After = any> = {\n\tup: (oldState: Before) => After\n\tdown: (newState: After) => Before\n}\n\n/** @public */\nexport type MigrationId = `${string}/${number}`\n\nexport type StandaloneDependsOn = {\n\treadonly dependsOn: readonly MigrationId[]\n}\n\n/** @public */\nexport type Migration = {\n\treadonly id: MigrationId\n\treadonly dependsOn?: readonly MigrationId[] | undefined\n} & (\n\t| {\n\t\t\treadonly scope: 'record'\n\t\t\treadonly filter?: (record: UnknownRecord) => boolean\n\t\t\treadonly up: (oldState: UnknownRecord) => void | UnknownRecord\n\t\t\treadonly down?: (newState: UnknownRecord) => void | UnknownRecord\n\t  }\n\t| {\n\t\t\treadonly scope: 'store'\n\t\t\treadonly up: (\n\t\t\t\toldState: SerializedStore<UnknownRecord>\n\t\t\t) => void | SerializedStore<UnknownRecord>\n\t\t\treadonly down?: (\n\t\t\t\tnewState: SerializedStore<UnknownRecord>\n\t\t\t) => void | SerializedStore<UnknownRecord>\n\t  }\n)\n\ninterface LegacyBaseMigrationsInfo {\n\tfirstVersion: number\n\tcurrentVersion: number\n\tmigrators: { [version: number]: LegacyMigration }\n}\n\n/** @public */\nexport interface LegacyMigrations extends LegacyBaseMigrationsInfo {\n\tsubTypeKey?: string\n\tsubTypeMigrations?: Record<string, LegacyBaseMigrationsInfo>\n}\n\n/** @public */\nexport interface MigrationSequence {\n\tsequenceId: string\n\t/**\n\t * retroactive should be true if the migrations should be applied to snapshots that were created before\n\t * this migration sequence was added to the schema.\n\t *\n\t * In general:\n\t *\n\t * - retroactive should be true when app developers create their own new migration sequences.\n\t * - retroactive should be false when library developers ship a migration sequence. When you install a library for the first time, any migrations that were added in the library before that point should generally _not_ be applied to your existing data.\n\t */\n\tretroactive: boolean\n\tsequence: Migration[]\n}\n\nexport function sortMigrations(migrations: Migration[]): Migration[] {\n\t// we do a topological sort using dependsOn and implicit dependencies between migrations in the same sequence\n\tconst byId = new Map(migrations.map((m) => [m.id, m]))\n\tconst isProcessing = new Set<MigrationId>()\n\n\tconst result: Migration[] = []\n\n\tfunction process(m: Migration) {\n\t\tassert(!isProcessing.has(m.id), `Circular dependency in migrations: ${m.id}`)\n\t\tisProcessing.add(m.id)\n\n\t\tconst { version, sequenceId } = parseMigrationId(m.id)\n\t\tconst parent = byId.get(`${sequenceId}/${version - 1}`)\n\t\tif (parent) {\n\t\t\tprocess(parent)\n\t\t}\n\n\t\tif (m.dependsOn) {\n\t\t\tfor (const dep of m.dependsOn) {\n\t\t\t\tconst depMigration = byId.get(dep)\n\t\t\t\tif (depMigration) {\n\t\t\t\t\tprocess(depMigration)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tbyId.delete(m.id)\n\t\tresult.push(m)\n\t}\n\n\tfor (const m of byId.values()) {\n\t\tprocess(m)\n\t}\n\n\treturn result\n}\n\n/** @internal */\nexport function parseMigrationId(id: MigrationId): { sequenceId: string; version: number } {\n\tconst [sequenceId, version] = id.split('/')\n\treturn { sequenceId, version: parseInt(version) }\n}\n\nfunction validateMigrationId(id: string, expectedSequenceId?: string) {\n\tif (expectedSequenceId) {\n\t\tassert(\n\t\t\tid.startsWith(expectedSequenceId + '/'),\n\t\t\t`Every migration in sequence '${expectedSequenceId}' must have an id starting with '${expectedSequenceId}/'. Got invalid id: '${id}'`\n\t\t)\n\t}\n\n\tassert(id.match(/^(.*?)\\/(0|[1-9]\\d*)$/), `Invalid migration id: '${id}'`)\n}\n\nexport function validateMigrations(migrations: MigrationSequence) {\n\tassert(\n\t\t!migrations.sequenceId.includes('/'),\n\t\t`sequenceId cannot contain a '/', got ${migrations.sequenceId}`\n\t)\n\tassert(migrations.sequenceId.length, 'sequenceId must be a non-empty string')\n\n\tif (migrations.sequence.length === 0) {\n\t\treturn\n\t}\n\n\tvalidateMigrationId(migrations.sequence[0].id, migrations.sequenceId)\n\tlet n = parseMigrationId(migrations.sequence[0].id).version\n\tassert(\n\t\tn === 1,\n\t\t`Expected the first migrationId to be '${migrations.sequenceId}/1' but got '${migrations.sequence[0].id}'`\n\t)\n\tfor (let i = 1; i < migrations.sequence.length; i++) {\n\t\tconst id = migrations.sequence[i].id\n\t\tvalidateMigrationId(id, migrations.sequenceId)\n\t\tconst m = parseMigrationId(id).version\n\t\tassert(\n\t\t\tm === n + 1,\n\t\t\t`Migration id numbers must increase in increments of 1, expected ${migrations.sequenceId}/${n + 1} but got '${migrations.sequence[i].id}'`\n\t\t)\n\t\tn = m\n\t}\n}\n\n/** @public */\nexport type MigrationResult<T> =\n\t| { type: 'success'; value: T }\n\t| { type: 'error'; reason: MigrationFailureReason }\n\n/** @public */\nexport enum MigrationFailureReason {\n\tIncompatibleSubtype = 'incompatible-subtype',\n\tUnknownType = 'unknown-type',\n\tTargetVersionTooNew = 'target-version-too-new',\n\tTargetVersionTooOld = 'target-version-too-old',\n\tMigrationError = 'migration-error',\n\tUnrecognizedSubtype = 'unrecognized-subtype',\n}\n", "import {\n\tResult,\n\tassert,\n\texhaustiveSwitchError,\n\tgetOwnProperty,\n\tstructuredClone,\n} from '@tldraw/utils'\nimport { UnknownRecord } from './BaseRecord'\nimport { RecordType } from './RecordType'\nimport { SerializedStore, Store, StoreSnapshot } from './Store'\nimport {\n\tMigration,\n\tMigrationFailureReason,\n\tMigrationId,\n\tMigrationResult,\n\tMigrationSequence,\n\tparseMigrationId,\n\tsortMigrations,\n\tvalidateMigrations,\n} from './migrate'\n\n/** @public */\nexport interface SerializedSchemaV1 {\n\t/** Schema version is the version for this type you're looking at right now */\n\tschemaVersion: 1\n\t/**\n\t * Store version is the version for the structure of the store. e.g. higher level structure like\n\t * removing or renaming a record type.\n\t */\n\tstoreVersion: number\n\t/** Record versions are the versions for each record type. e.g. adding a new field to a record */\n\trecordVersions: Record<\n\t\tstring,\n\t\t| {\n\t\t\t\tversion: number\n\t\t  }\n\t\t| {\n\t\t\t\t// subtypes are used for migrating shape and asset props\n\t\t\t\tversion: number\n\t\t\t\tsubTypeVersions: Record<string, number>\n\t\t\t\tsubTypeKey: string\n\t\t  }\n\t>\n}\n\n/** @public */\nexport interface SerializedSchemaV2 {\n\tschemaVersion: 2\n\tsequences: {\n\t\t[sequenceId: string]: number\n\t}\n}\n\n/** @public */\nexport type SerializedSchema = SerializedSchemaV1 | SerializedSchemaV2\n\nexport function upgradeSchema(schema: SerializedSchema): Result<SerializedSchemaV2, string> {\n\tif (schema.schemaVersion > 2 || schema.schemaVersion < 1) return Result.err('Bad schema version')\n\tif (schema.schemaVersion === 2) return Result.ok(schema as SerializedSchemaV2)\n\tconst result: SerializedSchemaV2 = {\n\t\tschemaVersion: 2,\n\t\tsequences: {},\n\t}\n\n\tfor (const [typeName, recordVersion] of Object.entries(schema.recordVersions)) {\n\t\tresult.sequences[`com.tldraw.${typeName}`] = recordVersion.version\n\t\tif ('subTypeKey' in recordVersion) {\n\t\t\tfor (const [subType, version] of Object.entries(recordVersion.subTypeVersions)) {\n\t\t\t\tresult.sequences[`com.tldraw.${typeName}.${subType}`] = version\n\t\t\t}\n\t\t}\n\t}\n\treturn Result.ok(result)\n}\n\n/** @public */\nexport type StoreSchemaOptions<R extends UnknownRecord, P> = {\n\tmigrations?: MigrationSequence[]\n\t/** @public */\n\tonValidationFailure?: (data: {\n\t\terror: unknown\n\t\tstore: Store<R>\n\t\trecord: R\n\t\tphase: 'initialize' | 'createRecord' | 'updateRecord' | 'tests'\n\t\trecordBefore: R | null\n\t}) => R\n\t/** @internal */\n\tcreateIntegrityChecker?: (store: Store<R, P>) => void\n}\n\n/** @public */\nexport class StoreSchema<R extends UnknownRecord, P = unknown> {\n\tstatic create<R extends UnknownRecord, P = unknown>(\n\t\t// HACK: making this param work with RecordType is an enormous pain\n\t\t// let's just settle for making sure each typeName has a corresponding RecordType\n\t\t// and accept that this function won't be able to infer the record type from it's arguments\n\t\ttypes: { [TypeName in R['typeName']]: { createId: any } },\n\t\toptions?: StoreSchemaOptions<R, P>\n\t): StoreSchema<R, P> {\n\t\treturn new StoreSchema<R, P>(types as any, options ?? {})\n\t}\n\n\treadonly migrations: Record<string, MigrationSequence> = {}\n\treadonly sortedMigrations: readonly Migration[]\n\n\tprivate constructor(\n\t\tpublic readonly types: {\n\t\t\t[Record in R as Record['typeName']]: RecordType<R, any>\n\t\t},\n\t\tprivate readonly options: StoreSchemaOptions<R, P>\n\t) {\n\t\tfor (const m of options.migrations ?? []) {\n\t\t\tassert(!this.migrations[m.sequenceId], `Duplicate migration sequenceId ${m.sequenceId}`)\n\t\t\tvalidateMigrations(m)\n\t\t\tthis.migrations[m.sequenceId] = m\n\t\t}\n\t\tconst allMigrations = Object.values(this.migrations).flatMap((m) => m.sequence)\n\t\tthis.sortedMigrations = sortMigrations(allMigrations)\n\n\t\tfor (const migration of this.sortedMigrations) {\n\t\t\tif (!migration.dependsOn?.length) continue\n\t\t\tfor (const dep of migration.dependsOn) {\n\t\t\t\tconst depMigration = allMigrations.find((m) => m.id === dep)\n\t\t\t\tassert(depMigration, `Migration '${migration.id}' depends on missing migration '${dep}'`)\n\t\t\t}\n\t\t}\n\t}\n\n\tvalidateRecord(\n\t\tstore: Store<R>,\n\t\trecord: R,\n\t\tphase: 'initialize' | 'createRecord' | 'updateRecord' | 'tests',\n\t\trecordBefore: R | null\n\t): R {\n\t\ttry {\n\t\t\tconst recordType = getOwnProperty(this.types, record.typeName)\n\t\t\tif (!recordType) {\n\t\t\t\tthrow new Error(`Missing definition for record type ${record.typeName}`)\n\t\t\t}\n\t\t\treturn recordType.validate(record, recordBefore ?? undefined)\n\t\t} catch (error: unknown) {\n\t\t\tif (this.options.onValidationFailure) {\n\t\t\t\treturn this.options.onValidationFailure({\n\t\t\t\t\tstore,\n\t\t\t\t\trecord,\n\t\t\t\t\tphase,\n\t\t\t\t\trecordBefore,\n\t\t\t\t\terror,\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthrow error\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO: use a weakmap to store the result of this function\n\tpublic getMigrationsSince(persistedSchema: SerializedSchema): Result<Migration[], string> {\n\t\tconst upgradeResult = upgradeSchema(persistedSchema)\n\t\tif (!upgradeResult.ok) {\n\t\t\treturn upgradeResult\n\t\t}\n\t\tconst schema = upgradeResult.value\n\t\tconst sequenceIdsToInclude = new Set(\n\t\t\t// start with any shared sequences\n\t\t\tObject.keys(schema.sequences).filter((sequenceId) => this.migrations[sequenceId])\n\t\t)\n\n\t\t// also include any sequences that are not in the persisted schema but are marked as postHoc\n\t\tfor (const sequenceId in this.migrations) {\n\t\t\tif (schema.sequences[sequenceId] === undefined && this.migrations[sequenceId].retroactive) {\n\t\t\t\tsequenceIdsToInclude.add(sequenceId)\n\t\t\t}\n\t\t}\n\n\t\tif (sequenceIdsToInclude.size === 0) {\n\t\t\treturn Result.ok([])\n\t\t}\n\n\t\tconst allMigrationsToInclude = new Set<MigrationId>()\n\t\tfor (const sequenceId of sequenceIdsToInclude) {\n\t\t\tconst theirVersion = schema.sequences[sequenceId]\n\t\t\tif (\n\t\t\t\t(typeof theirVersion !== 'number' && this.migrations[sequenceId].retroactive) ||\n\t\t\t\ttheirVersion === 0\n\t\t\t) {\n\t\t\t\tfor (const migration of this.migrations[sequenceId].sequence) {\n\t\t\t\t\tallMigrationsToInclude.add(migration.id)\n\t\t\t\t}\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tconst theirVersionId = `${sequenceId}/${theirVersion}`\n\t\t\tconst idx = this.migrations[sequenceId].sequence.findIndex((m) => m.id === theirVersionId)\n\t\t\t// todo: better error handling\n\t\t\tif (idx === -1) {\n\t\t\t\treturn Result.err('Incompatible schema?')\n\t\t\t}\n\t\t\tfor (const migration of this.migrations[sequenceId].sequence.slice(idx + 1)) {\n\t\t\t\tallMigrationsToInclude.add(migration.id)\n\t\t\t}\n\t\t}\n\n\t\t// collect any migrations\n\t\treturn Result.ok(this.sortedMigrations.filter(({ id }) => allMigrationsToInclude.has(id)))\n\t}\n\n\tmigratePersistedRecord(\n\t\trecord: R,\n\t\tpersistedSchema: SerializedSchema,\n\t\tdirection: 'up' | 'down' = 'up'\n\t): MigrationResult<R> {\n\t\tconst migrations = this.getMigrationsSince(persistedSchema)\n\t\tif (!migrations.ok) {\n\t\t\t// TODO: better error\n\t\t\tconsole.error('Error migrating record', migrations.error)\n\t\t\treturn { type: 'error', reason: MigrationFailureReason.MigrationError }\n\t\t}\n\t\tlet migrationsToApply = migrations.value\n\t\tif (migrationsToApply.length === 0) {\n\t\t\treturn { type: 'success', value: record }\n\t\t}\n\n\t\tif (migrationsToApply.some((m) => m.scope === 'store')) {\n\t\t\treturn {\n\t\t\t\ttype: 'error',\n\t\t\t\treason:\n\t\t\t\t\tdirection === 'down'\n\t\t\t\t\t\t? MigrationFailureReason.TargetVersionTooOld\n\t\t\t\t\t\t: MigrationFailureReason.TargetVersionTooNew,\n\t\t\t}\n\t\t}\n\n\t\tif (direction === 'down') {\n\t\t\tif (!migrationsToApply.every((m) => m.down)) {\n\t\t\t\treturn {\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\treason: MigrationFailureReason.TargetVersionTooOld,\n\t\t\t\t}\n\t\t\t}\n\t\t\tmigrationsToApply = migrationsToApply.slice().reverse()\n\t\t}\n\n\t\trecord = structuredClone(record)\n\t\ttry {\n\t\t\tfor (const migration of migrationsToApply) {\n\t\t\t\tif (migration.scope === 'store') throw new Error(/* won't happen, just for TS */)\n\t\t\t\tconst shouldApply = migration.filter ? migration.filter(record) : true\n\t\t\t\tif (!shouldApply) continue\n\t\t\t\tconst result = migration[direction]!(record)\n\t\t\t\tif (result) {\n\t\t\t\t\trecord = structuredClone(result) as any\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Error migrating record', e)\n\t\t\treturn { type: 'error', reason: MigrationFailureReason.MigrationError }\n\t\t}\n\n\t\treturn { type: 'success', value: record }\n\t}\n\n\tmigrateStoreSnapshot(snapshot: StoreSnapshot<R>): MigrationResult<SerializedStore<R>> {\n\t\tlet { store } = snapshot\n\t\tconst migrations = this.getMigrationsSince(snapshot.schema)\n\t\tif (!migrations.ok) {\n\t\t\t// TODO: better error\n\t\t\tconsole.error('Error migrating store', migrations.error)\n\t\t\treturn { type: 'error', reason: MigrationFailureReason.MigrationError }\n\t\t}\n\t\tconst migrationsToApply = migrations.value\n\t\tif (migrationsToApply.length === 0) {\n\t\t\treturn { type: 'success', value: store }\n\t\t}\n\n\t\tstore = structuredClone(store)\n\n\t\ttry {\n\t\t\tfor (const migration of migrationsToApply) {\n\t\t\t\tif (migration.scope === 'record') {\n\t\t\t\t\tfor (const [id, record] of Object.entries(store)) {\n\t\t\t\t\t\tconst shouldApply = migration.filter ? migration.filter(record as UnknownRecord) : true\n\t\t\t\t\t\tif (!shouldApply) continue\n\t\t\t\t\t\tconst result = migration.up!(record as any)\n\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\tstore[id as keyof typeof store] = structuredClone(result) as any\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (migration.scope === 'store') {\n\t\t\t\t\tconst result = migration.up!(store)\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tstore = structuredClone(result) as any\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\texhaustiveSwitchError(migration)\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Error migrating store', e)\n\t\t\treturn { type: 'error', reason: MigrationFailureReason.MigrationError }\n\t\t}\n\n\t\treturn { type: 'success', value: store }\n\t}\n\n\t/** @internal */\n\tcreateIntegrityChecker(store: Store<R, P>): (() => void) | undefined {\n\t\treturn this.options.createIntegrityChecker?.(store) ?? undefined\n\t}\n\n\tserialize(): SerializedSchemaV2 {\n\t\treturn {\n\t\t\tschemaVersion: 2,\n\t\t\tsequences: Object.fromEntries(\n\t\t\t\tObject.values(this.migrations).map(({ sequenceId, sequence }) => [\n\t\t\t\t\tsequenceId,\n\t\t\t\t\tsequence.length ? parseMigrationId(sequence.at(-1)!.id).version : 0,\n\t\t\t\t])\n\t\t\t),\n\t\t}\n\t}\n\n\t/**\n\t * @deprecated This is only here for legacy reasons, don't use it unless you have david's blessing!\n\t */\n\tserializeEarliestVersion(): SerializedSchema {\n\t\treturn {\n\t\t\tschemaVersion: 2,\n\t\t\tsequences: Object.fromEntries(\n\t\t\t\tObject.values(this.migrations).map(({ sequenceId }) => [sequenceId, 0])\n\t\t\t),\n\t\t}\n\t}\n}\n", "import {\n\tIndexKey,\n\tJsonValue,\n\tSTRUCTURED_CLONE_OBJECT_PROTOTYPE,\n\texhaustiveSwitchError,\n\tgetOwnProperty,\n\thasOwnProperty,\n\tvalidateIndexKey,\n} from '@tldraw/utils'\n\n/** @public */\nexport type ValidatorFn<T> = (value: unknown) => T\n/** @public */\nexport type ValidatorUsingKnownGoodVersionFn<In, Out = In> = (\n\tknownGoodValue: In,\n\tvalue: unknown\n) => Out\n\n/** @public */\nexport type Validatable<T> = {\n\tvalidate: (value: unknown) => T\n\t/**\n\t * This is a performance optimizing version of validate that can use a previous\n\t * version of the value to avoid revalidating every part of the new value if\n\t * any part of it has not changed since the last validation.\n\t *\n\t * If the value has not changed but is not referentially equal, the function\n\t * should return the previous value.\n\t * @returns\n\t */\n\tvalidateUsingKnownGoodVersion?: (knownGoodValue: T, newValue: unknown) => T\n}\n\nfunction formatPath(path: ReadonlyArray<number | string>): string | null {\n\tif (!path.length) {\n\t\treturn null\n\t}\n\n\tlet formattedPath = ''\n\tfor (const item of path) {\n\t\tif (typeof item === 'number') {\n\t\t\tformattedPath += `.${item}`\n\t\t} else if (item.startsWith('(')) {\n\t\t\tif (formattedPath.endsWith(')')) {\n\t\t\t\tformattedPath = `${formattedPath.slice(0, -1)}, ${item.slice(1)}`\n\t\t\t} else {\n\t\t\t\tformattedPath += item\n\t\t\t}\n\t\t} else {\n\t\t\tformattedPath += `.${item}`\n\t\t}\n\t}\n\n\t// N.B. We don't want id's in the path because they make grouping in Sentry tough.\n\tformattedPath = formattedPath.replace(/id = [^,]+, /, '').replace(/id = [^)]+/, '')\n\n\tif (formattedPath.startsWith('.')) {\n\t\treturn formattedPath.slice(1)\n\t}\n\treturn formattedPath\n}\n\n/** @public */\nexport class ValidationError extends Error {\n\toverride name = 'ValidationError'\n\n\tconstructor(\n\t\tpublic readonly rawMessage: string,\n\t\tpublic readonly path: ReadonlyArray<number | string> = []\n\t) {\n\t\tconst formattedPath = formatPath(path)\n\t\tconst indentedMessage = rawMessage\n\t\t\t.split('\\n')\n\t\t\t.map((line, i) => (i === 0 ? line : `  ${line}`))\n\t\t\t.join('\\n')\n\t\tsuper(path ? `At ${formattedPath}: ${indentedMessage}` : indentedMessage)\n\t}\n}\n\nfunction prefixError<T>(path: string | number, fn: () => T): T {\n\ttry {\n\t\treturn fn()\n\t} catch (err) {\n\t\tif (err instanceof ValidationError) {\n\t\t\tthrow new ValidationError(err.rawMessage, [path, ...err.path])\n\t\t}\n\t\tthrow new ValidationError((err as Error).toString(), [path])\n\t}\n}\n\nfunction typeToString(value: unknown): string {\n\tif (value === null) return 'null'\n\tif (Array.isArray(value)) return 'an array'\n\tconst type = typeof value\n\tswitch (type) {\n\t\tcase 'bigint':\n\t\tcase 'boolean':\n\t\tcase 'function':\n\t\tcase 'number':\n\t\tcase 'string':\n\t\tcase 'symbol':\n\t\t\treturn `a ${type}`\n\t\tcase 'object':\n\t\t\treturn `an ${type}`\n\t\tcase 'undefined':\n\t\t\treturn 'undefined'\n\t\tdefault:\n\t\t\texhaustiveSwitchError(type)\n\t}\n}\n\n/** @public */\nexport type TypeOf<V extends Validatable<any>> = V extends Validatable<infer T> ? T : never\n\n/** @public */\nexport class Validator<T> implements Validatable<T> {\n\tconstructor(\n\t\treadonly validationFn: ValidatorFn<T>,\n\t\treadonly validateUsingKnownGoodVersionFn?: ValidatorUsingKnownGoodVersionFn<T>\n\t) {}\n\n\t/**\n\t * Asserts that the passed value is of the correct type and returns it. The returned value is\n\t * guaranteed to be referentially equal to the passed value.\n\t */\n\tvalidate(value: unknown): T {\n\t\tconst validated = this.validationFn(value)\n\t\tif (process.env.NODE_ENV !== 'production' && !Object.is(value, validated)) {\n\t\t\tthrow new ValidationError('Validator functions must return the same value they were passed')\n\t\t}\n\t\treturn validated\n\t}\n\n\tvalidateUsingKnownGoodVersion(knownGoodValue: T, newValue: unknown): T {\n\t\tif (Object.is(knownGoodValue, newValue)) {\n\t\t\treturn knownGoodValue as T\n\t\t}\n\n\t\tif (this.validateUsingKnownGoodVersionFn) {\n\t\t\treturn this.validateUsingKnownGoodVersionFn(knownGoodValue, newValue)\n\t\t}\n\n\t\treturn this.validate(newValue)\n\t}\n\n\t/** Checks that the passed value is of the correct type. */\n\tisValid(value: unknown): value is T {\n\t\ttry {\n\t\t\tthis.validate(value)\n\t\t\treturn true\n\t\t} catch {\n\t\t\treturn false\n\t\t}\n\t}\n\n\t/**\n\t * Returns a new validator that also accepts null or undefined. The resulting value will always be\n\t * null.\n\t */\n\tnullable(): Validator<T | null> {\n\t\treturn nullable(this)\n\t}\n\n\t/**\n\t * Returns a new validator that also accepts null or undefined. The resulting value will always be\n\t * null.\n\t */\n\toptional(): Validator<T | undefined> {\n\t\treturn optional(this)\n\t}\n\n\t/**\n\t * Refine this validation to a new type. The passed-in validation function should throw an error\n\t * if the value can't be converted to the new type, or return the new type otherwise.\n\t */\n\trefine<U>(otherValidationFn: (value: T) => U): Validator<U> {\n\t\treturn new Validator(\n\t\t\t(value) => {\n\t\t\t\treturn otherValidationFn(this.validate(value))\n\t\t\t},\n\n\t\t\t(knownGoodValue, newValue) => {\n\t\t\t\tconst validated = this.validateUsingKnownGoodVersion(knownGoodValue as any, newValue)\n\t\t\t\tif (Object.is(knownGoodValue, validated)) {\n\t\t\t\t\treturn knownGoodValue\n\t\t\t\t}\n\t\t\t\treturn otherValidationFn(validated)\n\t\t\t}\n\t\t)\n\t}\n\n\t/**\n\t * Refine this validation with an additional check that doesn't change the resulting value.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const numberLessThan10Validator = T.number.check((value) => {\n\t * \tif (value >= 10) {\n\t * \t\tthrow new ValidationError(`Expected number less than 10, got ${value}`)\n\t * \t}\n\t * })\n\t * ```\n\t */\n\tcheck(name: string, checkFn: (value: T) => void): Validator<T>\n\tcheck(checkFn: (value: T) => void): Validator<T>\n\tcheck(nameOrCheckFn: string | ((value: T) => void), checkFn?: (value: T) => void): Validator<T> {\n\t\tif (typeof nameOrCheckFn === 'string') {\n\t\t\treturn this.refine((value) => {\n\t\t\t\tprefixError(`(check ${nameOrCheckFn})`, () => checkFn!(value))\n\t\t\t\treturn value\n\t\t\t})\n\t\t} else {\n\t\t\treturn this.refine((value) => {\n\t\t\t\tnameOrCheckFn(value)\n\t\t\t\treturn value\n\t\t\t})\n\t\t}\n\t}\n}\n\n/** @public */\nexport class ArrayOfValidator<T> extends Validator<T[]> {\n\tconstructor(readonly itemValidator: Validatable<T>) {\n\t\tsuper(\n\t\t\t(value) => {\n\t\t\t\tconst arr = array.validate(value)\n\t\t\t\tfor (let i = 0; i < arr.length; i++) {\n\t\t\t\t\tprefixError(i, () => itemValidator.validate(arr[i]))\n\t\t\t\t}\n\t\t\t\treturn arr as T[]\n\t\t\t},\n\t\t\t(knownGoodValue, newValue) => {\n\t\t\t\tif (!itemValidator.validateUsingKnownGoodVersion) return this.validate(newValue)\n\t\t\t\tconst arr = array.validate(newValue)\n\t\t\t\tlet isDifferent = knownGoodValue.length !== arr.length\n\t\t\t\tfor (let i = 0; i < arr.length; i++) {\n\t\t\t\t\tconst item = arr[i]\n\t\t\t\t\tif (i >= knownGoodValue.length) {\n\t\t\t\t\t\tisDifferent = true\n\t\t\t\t\t\tprefixError(i, () => itemValidator.validate(item))\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\t// sneaky quick check here to avoid the prefix + validator overhead\n\t\t\t\t\tif (Object.is(knownGoodValue[i], item)) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\tconst checkedItem = prefixError(i, () =>\n\t\t\t\t\t\titemValidator.validateUsingKnownGoodVersion!(knownGoodValue[i], item)\n\t\t\t\t\t)\n\t\t\t\t\tif (!Object.is(checkedItem, knownGoodValue[i])) {\n\t\t\t\t\t\tisDifferent = true\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn isDifferent ? (newValue as T[]) : knownGoodValue\n\t\t\t}\n\t\t)\n\t}\n\n\tnonEmpty() {\n\t\treturn this.check((value) => {\n\t\t\tif (value.length === 0) {\n\t\t\t\tthrow new ValidationError('Expected a non-empty array')\n\t\t\t}\n\t\t})\n\t}\n\n\tlengthGreaterThan1() {\n\t\treturn this.check((value) => {\n\t\t\tif (value.length <= 1) {\n\t\t\t\tthrow new ValidationError('Expected an array with length greater than 1')\n\t\t\t}\n\t\t})\n\t}\n}\n\n/** @public */\nexport class ObjectValidator<Shape extends object> extends Validator<Shape> {\n\tconstructor(\n\t\tpublic readonly config: {\n\t\t\treadonly [K in keyof Shape]: Validatable<Shape[K]>\n\t\t},\n\t\tprivate readonly shouldAllowUnknownProperties = false\n\t) {\n\t\tsuper(\n\t\t\t(object) => {\n\t\t\t\tif (typeof object !== 'object' || object === null) {\n\t\t\t\t\tthrow new ValidationError(`Expected object, got ${typeToString(object)}`)\n\t\t\t\t}\n\n\t\t\t\tfor (const [key, validator] of Object.entries(config)) {\n\t\t\t\t\tprefixError(key, () => {\n\t\t\t\t\t\t;(validator as Validatable<unknown>).validate(getOwnProperty(object, key))\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tif (!shouldAllowUnknownProperties) {\n\t\t\t\t\tfor (const key of Object.keys(object)) {\n\t\t\t\t\t\tif (!hasOwnProperty(config, key)) {\n\t\t\t\t\t\t\tthrow new ValidationError(`Unexpected property`, [key])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn object as Shape\n\t\t\t},\n\t\t\t(knownGoodValue, newValue) => {\n\t\t\t\tif (typeof newValue !== 'object' || newValue === null) {\n\t\t\t\t\tthrow new ValidationError(`Expected object, got ${typeToString(newValue)}`)\n\t\t\t\t}\n\n\t\t\t\tlet isDifferent = false\n\n\t\t\t\tfor (const [key, validator] of Object.entries(config)) {\n\t\t\t\t\tconst prev = getOwnProperty(knownGoodValue, key)\n\t\t\t\t\tconst next = getOwnProperty(newValue, key)\n\t\t\t\t\t// sneaky quick check here to avoid the prefix + validator overhead\n\t\t\t\t\tif (Object.is(prev, next)) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\tconst checked = prefixError(key, () => {\n\t\t\t\t\t\tconst validatable = validator as Validatable<unknown>\n\t\t\t\t\t\tif (validatable.validateUsingKnownGoodVersion) {\n\t\t\t\t\t\t\treturn validatable.validateUsingKnownGoodVersion(prev, next)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn validatable.validate(next)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tif (!Object.is(checked, prev)) {\n\t\t\t\t\t\tisDifferent = true\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!shouldAllowUnknownProperties) {\n\t\t\t\t\tfor (const key of Object.keys(newValue)) {\n\t\t\t\t\t\tif (!hasOwnProperty(config, key)) {\n\t\t\t\t\t\t\tthrow new ValidationError(`Unexpected property`, [key])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (const key of Object.keys(knownGoodValue)) {\n\t\t\t\t\tif (!hasOwnProperty(newValue, key)) {\n\t\t\t\t\t\tisDifferent = true\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn isDifferent ? (newValue as Shape) : knownGoodValue\n\t\t\t}\n\t\t)\n\t}\n\n\tallowUnknownProperties() {\n\t\treturn new ObjectValidator(this.config, true)\n\t}\n\n\t/**\n\t * Extend an object validator by adding additional properties.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * const animalValidator = T.object({\n\t * \tname: T.string,\n\t * })\n\t * const catValidator = animalValidator.extend({\n\t * \tmeowVolume: T.number,\n\t * })\n\t * ```\n\t */\n\textend<Extension extends Record<string, unknown>>(extension: {\n\t\treadonly [K in keyof Extension]: Validatable<Extension[K]>\n\t}): ObjectValidator<Shape & Extension> {\n\t\treturn new ObjectValidator({ ...this.config, ...extension }) as any as ObjectValidator<\n\t\t\tShape & Extension\n\t\t>\n\t}\n}\n\n// pass this into itself e.g. Config extends UnionObjectSchemaConfig<Key, Config>\ntype UnionValidatorConfig<Key extends string, Config> = {\n\treadonly [Variant in keyof Config]: Validatable<any> & {\n\t\tvalidate: (input: any) => { readonly [K in Key]: Variant }\n\t}\n}\n/** @public */\nexport class UnionValidator<\n\tKey extends string,\n\tConfig extends UnionValidatorConfig<Key, Config>,\n\tUnknownValue = never,\n> extends Validator<TypeOf<Config[keyof Config]> | UnknownValue> {\n\tconstructor(\n\t\tprivate readonly key: Key,\n\t\tprivate readonly config: Config,\n\t\tprivate readonly unknownValueValidation: (value: object, variant: string) => UnknownValue,\n\t\tprivate readonly useNumberKeys: boolean\n\t) {\n\t\tsuper(\n\t\t\t(input) => {\n\t\t\t\tthis.expectObject(input)\n\n\t\t\t\tconst { matchingSchema, variant } = this.getMatchingSchemaAndVariant(input)\n\t\t\t\tif (matchingSchema === undefined) {\n\t\t\t\t\treturn this.unknownValueValidation(input, variant)\n\t\t\t\t}\n\n\t\t\t\treturn prefixError(`(${key} = ${variant})`, () => matchingSchema.validate(input))\n\t\t\t},\n\t\t\t(prevValue, newValue) => {\n\t\t\t\tthis.expectObject(newValue)\n\t\t\t\tthis.expectObject(prevValue)\n\n\t\t\t\tconst { matchingSchema, variant } = this.getMatchingSchemaAndVariant(newValue)\n\t\t\t\tif (matchingSchema === undefined) {\n\t\t\t\t\treturn this.unknownValueValidation(newValue, variant)\n\t\t\t\t}\n\n\t\t\t\tif (getOwnProperty(prevValue, key) !== getOwnProperty(newValue, key)) {\n\t\t\t\t\t// the type has changed so bail out and do a regular validation\n\t\t\t\t\treturn prefixError(`(${key} = ${variant})`, () => matchingSchema.validate(newValue))\n\t\t\t\t}\n\n\t\t\t\treturn prefixError(`(${key} = ${variant})`, () => {\n\t\t\t\t\tif (matchingSchema.validateUsingKnownGoodVersion) {\n\t\t\t\t\t\treturn matchingSchema.validateUsingKnownGoodVersion(prevValue, newValue)\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn matchingSchema.validate(newValue)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t)\n\t}\n\n\tprivate expectObject(value: unknown): asserts value is object {\n\t\tif (typeof value !== 'object' || value === null) {\n\t\t\tthrow new ValidationError(`Expected an object, got ${typeToString(value)}`, [])\n\t\t}\n\t}\n\n\tprivate getMatchingSchemaAndVariant(object: object): {\n\t\tmatchingSchema: Validatable<any> | undefined\n\t\tvariant: string\n\t} {\n\t\tconst variant = getOwnProperty(object, this.key) as string & keyof Config\n\t\tif (!this.useNumberKeys && typeof variant !== 'string') {\n\t\t\tthrow new ValidationError(\n\t\t\t\t`Expected a string for key \"${this.key}\", got ${typeToString(variant)}`\n\t\t\t)\n\t\t} else if (this.useNumberKeys && !Number.isFinite(Number(variant))) {\n\t\t\tthrow new ValidationError(`Expected a number for key \"${this.key}\", got \"${variant as any}\"`)\n\t\t}\n\n\t\tconst matchingSchema = hasOwnProperty(this.config, variant) ? this.config[variant] : undefined\n\t\treturn { matchingSchema, variant }\n\t}\n\n\tvalidateUnknownVariants<Unknown>(\n\t\tunknownValueValidation: (value: object, variant: string) => Unknown\n\t): UnionValidator<Key, Config, Unknown> {\n\t\treturn new UnionValidator(this.key, this.config, unknownValueValidation, this.useNumberKeys)\n\t}\n}\n\n/** @public */\nexport class DictValidator<Key extends string, Value> extends Validator<Record<Key, Value>> {\n\tconstructor(\n\t\tpublic readonly keyValidator: Validatable<Key>,\n\t\tpublic readonly valueValidator: Validatable<Value>\n\t) {\n\t\tsuper(\n\t\t\t(object) => {\n\t\t\t\tif (typeof object !== 'object' || object === null) {\n\t\t\t\t\tthrow new ValidationError(`Expected object, got ${typeToString(object)}`)\n\t\t\t\t}\n\n\t\t\t\tfor (const [key, value] of Object.entries(object)) {\n\t\t\t\t\tprefixError(key, () => {\n\t\t\t\t\t\tkeyValidator.validate(key)\n\t\t\t\t\t\tvalueValidator.validate(value)\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\treturn object as Record<Key, Value>\n\t\t\t},\n\t\t\t(knownGoodValue, newValue) => {\n\t\t\t\tif (typeof newValue !== 'object' || newValue === null) {\n\t\t\t\t\tthrow new ValidationError(`Expected object, got ${typeToString(newValue)}`)\n\t\t\t\t}\n\n\t\t\t\tlet isDifferent = false\n\n\t\t\t\tfor (const [key, value] of Object.entries(newValue)) {\n\t\t\t\t\tif (!hasOwnProperty(knownGoodValue, key)) {\n\t\t\t\t\t\tisDifferent = true\n\t\t\t\t\t\tprefixError(key, () => {\n\t\t\t\t\t\t\tkeyValidator.validate(key)\n\t\t\t\t\t\t\tvalueValidator.validate(value)\n\t\t\t\t\t\t})\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\tconst prev = getOwnProperty(knownGoodValue, key)\n\t\t\t\t\tconst next = value\n\t\t\t\t\t// sneaky quick check here to avoid the prefix + validator overhead\n\t\t\t\t\tif (Object.is(prev, next)) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\tconst checked = prefixError(key, () => {\n\t\t\t\t\t\tif (valueValidator.validateUsingKnownGoodVersion) {\n\t\t\t\t\t\t\treturn valueValidator.validateUsingKnownGoodVersion(prev as any, next)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn valueValidator.validate(next)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tif (!Object.is(checked, prev)) {\n\t\t\t\t\t\tisDifferent = true\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (const key of Object.keys(knownGoodValue)) {\n\t\t\t\t\tif (!hasOwnProperty(newValue, key)) {\n\t\t\t\t\t\tisDifferent = true\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn isDifferent ? (newValue as Record<Key, Value>) : knownGoodValue\n\t\t\t}\n\t\t)\n\t}\n}\n\nfunction typeofValidator<T>(type: string): Validator<T> {\n\treturn new Validator((value) => {\n\t\tif (typeof value !== type) {\n\t\t\tthrow new ValidationError(`Expected ${type}, got ${typeToString(value)}`)\n\t\t}\n\t\treturn value as T\n\t})\n}\n\n/**\n * Validation that accepts any value. Useful as a starting point for building your own custom\n * validations.\n *\n * @public\n */\nexport const unknown = new Validator((value) => value)\n/**\n * Validation that accepts any value. Generally this should be avoided, but you can use it as an\n * escape hatch if you want to work without validations for e.g. a prototype.\n *\n * @public\n */\nexport const any = new Validator((value): any => value)\n\n/**\n * Validates that a value is a string.\n *\n * @public\n */\nexport const string = typeofValidator<string>('string')\n\n/**\n * Validates that a value is a finite non-NaN number.\n *\n * @public\n */\nexport const number = typeofValidator<number>('number').check((number) => {\n\tif (Number.isNaN(number)) {\n\t\tthrow new ValidationError('Expected a number, got NaN')\n\t}\n\tif (!Number.isFinite(number)) {\n\t\tthrow new ValidationError(`Expected a finite number, got ${number}`)\n\t}\n})\n/**\n * Fails if value \\< 0\n *\n * @public\n */\nexport const positiveNumber = number.check((value) => {\n\tif (value < 0) throw new ValidationError(`Expected a positive number, got ${value}`)\n})\n/**\n * Fails if value \\<= 0\n *\n * @public\n */\nexport const nonZeroNumber = number.check((value) => {\n\tif (value <= 0) throw new ValidationError(`Expected a non-zero positive number, got ${value}`)\n})\n/**\n * Fails if number is not an integer\n *\n * @public\n */\nexport const integer = number.check((value) => {\n\tif (!Number.isInteger(value)) throw new ValidationError(`Expected an integer, got ${value}`)\n})\n/**\n * Fails if value \\< 0 and is not an integer\n *\n * @public\n */\nexport const positiveInteger = integer.check((value) => {\n\tif (value < 0) throw new ValidationError(`Expected a positive integer, got ${value}`)\n})\n/**\n * Fails if value \\<= 0 and is not an integer\n *\n * @public\n */\nexport const nonZeroInteger = integer.check((value) => {\n\tif (value <= 0) throw new ValidationError(`Expected a non-zero positive integer, got ${value}`)\n})\n\n/**\n * Validates that a value is boolean.\n *\n * @public\n */\nexport const boolean = typeofValidator<boolean>('boolean')\n/**\n * Validates that a value is a bigint.\n *\n * @public\n */\nexport const bigint = typeofValidator<bigint>('bigint')\n/**\n * Validates that a value matches another that was passed in.\n *\n * @example\n *\n * ```ts\n * const trueValidator = T.literal(true)\n * ```\n *\n * @public\n */\nexport function literal<T extends string | number | boolean>(expectedValue: T): Validator<T> {\n\treturn new Validator((actualValue) => {\n\t\tif (actualValue !== expectedValue) {\n\t\t\tthrow new ValidationError(`Expected ${expectedValue}, got ${JSON.stringify(actualValue)}`)\n\t\t}\n\t\treturn expectedValue\n\t})\n}\n\n/**\n * Validates that a value is an array. To check the contents of the array, use T.arrayOf.\n *\n * @public\n */\nexport const array = new Validator<unknown[]>((value) => {\n\tif (!Array.isArray(value)) {\n\t\tthrow new ValidationError(`Expected an array, got ${typeToString(value)}`)\n\t}\n\treturn value\n})\n\n/**\n * Validates that a value is an array whose contents matches the passed-in validator.\n *\n * @public\n */\nexport function arrayOf<T>(itemValidator: Validatable<T>): ArrayOfValidator<T> {\n\treturn new ArrayOfValidator(itemValidator)\n}\n\n/** @public */\nexport const unknownObject = new Validator<Record<string, unknown>>((value) => {\n\tif (typeof value !== 'object' || value === null) {\n\t\tthrow new ValidationError(`Expected object, got ${typeToString(value)}`)\n\t}\n\treturn value as Record<string, unknown>\n})\n\ntype ExtractRequiredKeys<T extends object> = {\n\t[K in keyof T]: undefined extends T[K] ? never : K\n}[keyof T]\n\ntype ExtractOptionalKeys<T extends object> = {\n\t[K in keyof T]: undefined extends T[K] ? K : never\n}[keyof T]\n\n/**\n * Validate an object has a particular shape.\n *\n * @public\n */\nexport function object<Shape extends object>(config: {\n\treadonly [K in keyof Shape]: Validatable<Shape[K]>\n}): ObjectValidator<\n\t{ [P in ExtractRequiredKeys<Shape>]: Shape[P] } & { [P in ExtractOptionalKeys<Shape>]?: Shape[P] }\n> {\n\treturn new ObjectValidator(config) as any\n}\n\nfunction isPlainObject(value: unknown): value is Record<string, unknown> {\n\treturn (\n\t\ttypeof value === 'object' &&\n\t\tvalue !== null &&\n\t\t(Object.getPrototypeOf(value) === Object.prototype ||\n\t\t\tObject.getPrototypeOf(value) === null ||\n\t\t\tObject.getPrototypeOf(value) === STRUCTURED_CLONE_OBJECT_PROTOTYPE)\n\t)\n}\n\nfunction isValidJson(value: any): value is JsonValue {\n\tif (\n\t\tvalue === null ||\n\t\ttypeof value === 'number' ||\n\t\ttypeof value === 'string' ||\n\t\ttypeof value === 'boolean'\n\t) {\n\t\treturn true\n\t}\n\n\tif (Array.isArray(value)) {\n\t\treturn value.every(isValidJson)\n\t}\n\n\tif (isPlainObject(value)) {\n\t\treturn Object.values(value).every(isValidJson)\n\t}\n\n\treturn false\n}\n\n/**\n * Validate that a value is valid JSON.\n *\n * @public\n */\nexport const jsonValue: Validator<JsonValue> = new Validator<JsonValue>(\n\t(value): JsonValue => {\n\t\tif (isValidJson(value)) {\n\t\t\treturn value as JsonValue\n\t\t}\n\n\t\tthrow new ValidationError(`Expected json serializable value, got ${typeof value}`)\n\t},\n\t(knownGoodValue, newValue) => {\n\t\tif (Array.isArray(knownGoodValue) && Array.isArray(newValue)) {\n\t\t\tlet isDifferent = knownGoodValue.length !== newValue.length\n\t\t\tfor (let i = 0; i < newValue.length; i++) {\n\t\t\t\tif (i >= knownGoodValue.length) {\n\t\t\t\t\tisDifferent = true\n\t\t\t\t\tjsonValue.validate(newValue[i])\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tconst prev = knownGoodValue[i]\n\t\t\t\tconst next = newValue[i]\n\t\t\t\tif (Object.is(prev, next)) {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tconst checked = jsonValue.validateUsingKnownGoodVersion!(prev, next)\n\t\t\t\tif (!Object.is(checked, prev)) {\n\t\t\t\t\tisDifferent = true\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn isDifferent ? (newValue as JsonValue) : knownGoodValue\n\t\t} else if (isPlainObject(knownGoodValue) && isPlainObject(newValue)) {\n\t\t\tlet isDifferent = false\n\t\t\tfor (const key of Object.keys(newValue)) {\n\t\t\t\tif (!hasOwnProperty(knownGoodValue, key)) {\n\t\t\t\t\tisDifferent = true\n\t\t\t\t\tjsonValue.validate(newValue[key])\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tconst prev = knownGoodValue[key]\n\t\t\t\tconst next = newValue[key]\n\t\t\t\tif (Object.is(prev, next)) {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tconst checked = jsonValue.validateUsingKnownGoodVersion!(prev!, next)\n\t\t\t\tif (!Object.is(checked, prev)) {\n\t\t\t\t\tisDifferent = true\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const key of Object.keys(knownGoodValue)) {\n\t\t\t\tif (!hasOwnProperty(newValue, key)) {\n\t\t\t\t\tisDifferent = true\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn isDifferent ? (newValue as JsonValue) : knownGoodValue\n\t\t} else {\n\t\t\treturn jsonValue.validate(newValue)\n\t\t}\n\t}\n)\n\n/**\n * Validate an object has a particular shape.\n *\n * @public\n */\nexport function jsonDict(): DictValidator<string, JsonValue> {\n\treturn dict(string, jsonValue)\n}\n\n/**\n * Validation that an option is a dict with particular keys and values.\n *\n * @public\n */\nexport function dict<Key extends string, Value>(\n\tkeyValidator: Validatable<Key>,\n\tvalueValidator: Validatable<Value>\n): DictValidator<Key, Value> {\n\treturn new DictValidator(keyValidator, valueValidator)\n}\n\n/**\n * Validate a union of several object types. Each object must have a property matching `key` which\n * should be a unique string.\n *\n * @example\n *\n * ```ts\n * const catValidator = T.object({ kind: T.value('cat'), meow: T.boolean })\n * const dogValidator = T.object({ kind: T.value('dog'), bark: T.boolean })\n * const animalValidator = T.union('kind', { cat: catValidator, dog: dogValidator })\n * ```\n *\n * @public\n */\nexport function union<Key extends string, Config extends UnionValidatorConfig<Key, Config>>(\n\tkey: Key,\n\tconfig: Config\n): UnionValidator<Key, Config> {\n\treturn new UnionValidator(\n\t\tkey,\n\t\tconfig,\n\t\t(unknownValue, unknownVariant) => {\n\t\t\tthrow new ValidationError(\n\t\t\t\t`Expected one of ${Object.keys(config)\n\t\t\t\t\t.map((key) => JSON.stringify(key))\n\t\t\t\t\t.join(' or ')}, got ${JSON.stringify(unknownVariant)}`,\n\t\t\t\t[key]\n\t\t\t)\n\t\t},\n\t\tfalse\n\t)\n}\n\n/**\n * @internal\n */\nexport function numberUnion<Key extends string, Config extends UnionValidatorConfig<Key, Config>>(\n\tkey: Key,\n\tconfig: Config\n): UnionValidator<Key, Config> {\n\treturn new UnionValidator(\n\t\tkey,\n\t\tconfig,\n\t\t(unknownValue, unknownVariant) => {\n\t\t\tthrow new ValidationError(\n\t\t\t\t`Expected one of ${Object.keys(config)\n\t\t\t\t\t.map((key) => JSON.stringify(key))\n\t\t\t\t\t.join(' or ')}, got ${JSON.stringify(unknownVariant)}`,\n\t\t\t\t[key]\n\t\t\t)\n\t\t},\n\t\ttrue\n\t)\n}\n\n/**\n * A named object with an ID. Errors will be reported as being part of the object with the given\n * name.\n *\n * @public\n */\nexport function model<T extends { readonly id: string }>(\n\tname: string,\n\tvalidator: Validatable<T>\n): Validator<T> {\n\treturn new Validator(\n\t\t(value) => {\n\t\t\treturn prefixError(name, () => validator.validate(value))\n\t\t},\n\t\t(prevValue, newValue) => {\n\t\t\treturn prefixError(name, () => {\n\t\t\t\tif (validator.validateUsingKnownGoodVersion) {\n\t\t\t\t\treturn validator.validateUsingKnownGoodVersion(prevValue, newValue)\n\t\t\t\t} else {\n\t\t\t\t\treturn validator.validate(newValue)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t)\n}\n\n/** @public */\nexport function setEnum<T>(values: ReadonlySet<T>): Validator<T> {\n\treturn new Validator((value) => {\n\t\tif (!values.has(value as T)) {\n\t\t\tconst valuesString = Array.from(values, (value) => JSON.stringify(value)).join(' or ')\n\t\t\tthrow new ValidationError(`Expected ${valuesString}, got ${value}`)\n\t\t}\n\t\treturn value as T\n\t})\n}\n\n/** @public */\nexport function optional<T>(validator: Validatable<T>): Validator<T | undefined> {\n\treturn new Validator(\n\t\t(value) => {\n\t\t\tif (value === undefined) return undefined\n\t\t\treturn validator.validate(value)\n\t\t},\n\t\t(knownGoodValue, newValue) => {\n\t\t\tif (knownGoodValue === undefined && newValue === undefined) return undefined\n\t\t\tif (newValue === undefined) return undefined\n\t\t\tif (validator.validateUsingKnownGoodVersion && knownGoodValue !== undefined) {\n\t\t\t\treturn validator.validateUsingKnownGoodVersion(knownGoodValue as T, newValue)\n\t\t\t}\n\t\t\treturn validator.validate(newValue)\n\t\t}\n\t)\n}\n\n/** @public */\nexport function nullable<T>(validator: Validatable<T>): Validator<T | null> {\n\treturn new Validator(\n\t\t(value) => {\n\t\t\tif (value === null) return null\n\t\t\treturn validator.validate(value)\n\t\t},\n\t\t(knownGoodValue, newValue) => {\n\t\t\tif (newValue === null) return null\n\t\t\tif (validator.validateUsingKnownGoodVersion && knownGoodValue !== null) {\n\t\t\t\treturn validator.validateUsingKnownGoodVersion(knownGoodValue as T, newValue)\n\t\t\t}\n\t\t\treturn validator.validate(newValue)\n\t\t}\n\t)\n}\n\n/** @public */\nexport function literalEnum<const Values extends readonly unknown[]>(\n\t...values: Values\n): Validator<Values[number]> {\n\treturn setEnum(new Set(values))\n}\n\nfunction parseUrl(str: string) {\n\ttry {\n\t\treturn new URL(str)\n\t} catch (error) {\n\t\tif (str.startsWith('/') || str.startsWith('./')) {\n\t\t\ttry {\n\t\t\t\treturn new URL(str, 'http://example.com')\n\t\t\t} catch (error) {\n\t\t\t\tthrow new ValidationError(`Expected a valid url, got ${JSON.stringify(str)}`)\n\t\t\t}\n\t\t}\n\t\tthrow new ValidationError(`Expected a valid url, got ${JSON.stringify(str)}`)\n\t}\n}\n\nconst validLinkProtocols = new Set(['http:', 'https:', 'mailto:'])\n\n/**\n * Validates that a value is a url safe to use as a link.\n *\n * @public\n */\nexport const linkUrl = string.check((value) => {\n\tif (value === '') return\n\tconst url = parseUrl(value)\n\n\tif (!validLinkProtocols.has(url.protocol.toLowerCase())) {\n\t\tthrow new ValidationError(\n\t\t\t`Expected a valid url, got ${JSON.stringify(value)} (invalid protocol)`\n\t\t)\n\t}\n})\n\nconst validSrcProtocols = new Set(['http:', 'https:', 'data:'])\n\n/**\n * Validates that a valid is a url safe to load as an asset.\n *\n * @public\n */\nexport const srcUrl = string.check((value) => {\n\tif (value === '') return\n\tconst url = parseUrl(value)\n\n\tif (!validSrcProtocols.has(url.protocol.toLowerCase())) {\n\t\tthrow new ValidationError(\n\t\t\t`Expected a valid url, got ${JSON.stringify(value)} (invalid protocol)`\n\t\t)\n\t}\n})\n\n/**\n * Validates that a value is an IndexKey.\n * @public\n */\nexport const indexKey = string.refine<IndexKey>((key) => {\n\ttry {\n\t\tvalidateIndexKey(key)\n\t\treturn key\n\t} catch {\n\t\tthrow new ValidationError(`Expected an index key, got ${JSON.stringify(key)}`)\n\t}\n})\n", "import type { RecordId, UnknownRecord } from '@tldraw/store'\nimport { T } from '@tldraw/validate'\n\n/** @public */\nexport function idValidator<Id extends RecordId<UnknownRecord>>(\n\tprefix: Id['__type__']['typeName']\n): T.Validator<Id> {\n\treturn T.string.refine((id) => {\n\t\tif (!id.startsWith(`${prefix}:`)) {\n\t\t\tthrow new Error(`${prefix} ID must start with \"${prefix}:\"`)\n\t\t}\n\t\treturn id as Id\n\t})\n}\n", "import { BaseRecord } from '@tldraw/store'\nimport { JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { idValidator } from '../misc/id-validator'\nimport { TLAssetId } from '../records/TLAsset'\n\n/** @public */\nexport interface TLBaseAsset<Type extends string, Props> extends BaseRecord<'asset', TLAssetId> {\n\ttype: Type\n\tprops: Props\n\tmeta: JsonObject\n}\n\n/**\n * A validator for asset record type Ids.\n *\n * @public */\nexport const assetIdValidator = idValidator<TLAssetId>('asset')\n\n/**\n * Create a validator for an asset record type.\n *\n * @param type - The type of the asset\n * @param props - The validator for the asset's props\n *\n * @public */\nexport function createAssetValidator<Type extends string, Props extends JsonObject>(\n\ttype: Type,\n\tprops: T.Validator<Props>\n) {\n\treturn T.object<{\n\t\tid: TLAssetId\n\t\ttypeName: 'asset'\n\t\ttype: Type\n\t\tprops: Props\n\t\tmeta: JsonObject\n\t}>({\n\t\tid: assetIdValidator,\n\t\ttypeName: T.literal('asset'),\n\t\ttype: T.literal(type),\n\t\tprops,\n\t\tmeta: T.jsonValue as T.ObjectValidator<JsonObject>,\n\t})\n}\n", "import {\n\tBaseRecord,\n\tcreateMigrationIds,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n\tRecordId,\n} from '@tldraw/store'\nimport { JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { idValidator } from '../misc/id-validator'\n\n/**\n * A camera record.\n *\n * @public\n */\nexport interface TLCamera extends BaseRecord<'camera', TLCameraId> {\n\tx: number\n\ty: number\n\tz: number\n\tmeta: JsonObject\n}\n\n/**\n * The id of a camera record.\n *\n * @public */\nexport type TLCameraId = RecordId<TLCamera>\n\n/** @public */\nexport const cameraValidator: T.Validator<TLCamera> = T.model(\n\t'camera',\n\tT.object({\n\t\ttypeName: T.literal('camera'),\n\t\tid: idValidator<TLCameraId>('camera'),\n\t\tx: T.number,\n\t\ty: T.number,\n\t\tz: T.number,\n\t\tmeta: T.jsonValue as T.ObjectValidator<JsonObject>,\n\t})\n)\n\n/** @public */\nexport const cameraVersions = createMigrationIds('com.tldraw.camera', {\n\tAddMeta: 1,\n})\n\n/** @public */\nexport const cameraMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.camera',\n\trecordType: 'camera',\n\tsequence: [\n\t\t{\n\t\t\tid: cameraVersions.AddMeta,\n\t\t\tup: (record) => {\n\t\t\t\t;(record as any).meta = {}\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport const CameraRecordType = createRecordType<TLCamera>('camera', {\n\tvalidator: cameraValidator,\n\tscope: 'session',\n}).withDefaultProperties(\n\t(): Omit<TLCamera, 'id' | 'typeName'> => ({\n\t\tx: 0,\n\t\ty: 0,\n\t\tz: 1,\n\t\tmeta: {},\n\t})\n)\n", "import { T } from '@tldraw/validate'\n\n/**\n * A serializable model for 2D boxes.\n *\n * @public */\nexport interface BoxModel {\n\tx: number\n\ty: number\n\tw: number\n\th: number\n}\n\n/**\n * A serializable model for 2D vectors.\n *\n * @public */\nexport interface VecModel {\n\tx: number\n\ty: number\n\tz?: number\n}\n\n/** @public */\nexport const vecModelValidator: T.Validator<VecModel> = T.object({\n\tx: T.number,\n\ty: T.number,\n\tz: T.number.optional(),\n})\n\n/** @public */\nexport const boxModelValidator: T.Validator<BoxModel> = T.object({\n\tx: T.number,\n\ty: T.number,\n\tw: T.number,\n\th: T.number,\n})\n", "import { T } from '@tldraw/validate'\nimport { SetValue } from '../util-types'\n\n/**\n * The cursor types used by tldraw's default shapes.\n *\n * @public */\nexport const TL_CURSOR_TYPES = new Set([\n\t'none',\n\t'default',\n\t'pointer',\n\t'cross',\n\t'grab',\n\t'rotate',\n\t'grabbing',\n\t'resize-edge',\n\t'resize-corner',\n\t'text',\n\t'move',\n\t'ew-resize',\n\t'ns-resize',\n\t'nesw-resize',\n\t'nwse-resize',\n\t'nesw-rotate',\n\t'nwse-rotate',\n\t'swne-rotate',\n\t'senw-rotate',\n\t'zoom-in',\n\t'zoom-out',\n])\n\n/**\n * A type for the cursor types used by tldraw's default shapes.\n *\n *  @public */\nexport type TLCursorType = SetValue<typeof TL_CURSOR_TYPES>\n\n/** @public */\nexport const cursorTypeValidator = T.setEnum(TL_CURSOR_TYPES)\n\n/**\n * A cursor used by tldraw.\n *\n *  @public */\nexport interface TLCursor {\n\ttype: TLCursorType\n\trotation: number\n}\n\n/** @public */\nexport const cursorValidator: T.Validator<TLCursor> = T.object<TLCursor>({\n\ttype: cursorTypeValidator,\n\trotation: T.number,\n})\n", "import { T } from '@tldraw/validate'\n\n/** @public */\nexport type TLOpacityType = number\n\n/** @public */\nexport const opacityValidator = T.number.check((n) => {\n\tif (n < 0 || n > 1) {\n\t\tthrow new T.ValidationError('Opacity must be between 0 and 1')\n\t}\n})\n", "import { T } from '@tldraw/validate'\nimport { SetValue } from '../util-types'\n\n/**\n * The colors used by tldraw's default shapes.\n *\n *  @public */\nexport const TL_CANVAS_UI_COLOR_TYPES = new Set([\n\t'accent',\n\t'white',\n\t'black',\n\t'selection-stroke',\n\t'selection-fill',\n\t'laser',\n\t'muted-1',\n] as const)\n\n/**\n * A type for the colors used by tldraw's default shapes.\n *\n *  @public */\nexport type TLCanvasUiColor = SetValue<typeof TL_CANVAS_UI_COLOR_TYPES>\n\n/**\n * A validator for the colors used by tldraw's default shapes.\n *\n * @public */\nexport const canvasUiColorTypeValidator = T.setEnum(TL_CANVAS_UI_COLOR_TYPES)\n", "import { T } from '@tldraw/validate'\nimport { SetValue } from '../util-types'\nimport { TLCanvasUiColor, canvasUiColorTypeValidator } from './TLColor'\nimport { VecModel, vecModelValidator } from './geometry-types'\n\n/**\n * The scribble states used by tldraw.\n *\n *  @public */\nexport const TL_SCRIBBLE_STATES = new Set(['starting', 'paused', 'active', 'stopping'] as const)\n\n/**\n * A type for the scribble used by tldraw.\n *\n * @public */\nexport type TLScribble = {\n\tid: string\n\tpoints: VecModel[]\n\tsize: number\n\tcolor: TLCanvasUiColor\n\topacity: number\n\tstate: SetValue<typeof TL_SCRIBBLE_STATES>\n\tdelay: number\n\tshrink: number\n\ttaper: boolean\n}\n\n/** @public */\nexport const scribbleValidator: T.Validator<TLScribble> = T.object({\n\tid: T.string,\n\tpoints: T.arrayOf(vecModelValidator),\n\tsize: T.positiveNumber,\n\tcolor: canvasUiColorTypeValidator,\n\topacity: T.number,\n\tstate: T.setEnum(TL_SCRIBBLE_STATES),\n\tdelay: T.number,\n\tshrink: T.number,\n\ttaper: T.boolean,\n})\n", "import {\n\tBaseRecord,\n\tcreateMigrationIds,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n\tRecordId,\n} from '@tldraw/store'\nimport { IndexKey, JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { idValidator } from '../misc/id-validator'\n\n/**\n * TLPage\n *\n * @public\n */\nexport interface TLPage extends BaseRecord<'page', TLPageId> {\n\tname: string\n\tindex: IndexKey\n\tmeta: JsonObject\n}\n\n/** @public */\nexport type TLPageId = RecordId<TLPage>\n\n/** @public */\nexport const pageIdValidator = idValidator<TLPageId>('page')\n\n/** @public */\nexport const pageValidator: T.Validator<TLPage> = T.model(\n\t'page',\n\tT.object({\n\t\ttypeName: T.literal('page'),\n\t\tid: pageIdValidator,\n\t\tname: T.string,\n\t\tindex: T.indexKey,\n\t\tmeta: T.jsonValue as T.ObjectValidator<JsonObject>,\n\t})\n)\n\n/** @public */\nexport const pageVersions = createMigrationIds('com.tldraw.page', {\n\tAddMeta: 1,\n})\n\n/** @public */\nexport const pageMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.page',\n\trecordType: 'page',\n\tsequence: [\n\t\t{\n\t\t\tid: pageVersions.AddMeta,\n\t\t\tup: (record: any) => {\n\t\t\t\trecord.meta = {}\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport const PageRecordType = createRecordType<TLPage>('page', {\n\tvalidator: pageValidator,\n\tscope: 'document',\n}).withDefaultProperties(() => ({\n\tmeta: {},\n}))\n\n/** @public */\nexport function isPageId(id: string): id is TLPageId {\n\treturn PageRecordType.isId(id)\n}\n", "import {\n\tBaseRecord,\n\tcreateMigrationIds,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n\tRecordId,\n} from '@tldraw/store'\nimport { JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { BoxModel, boxModelValidator } from '../misc/geometry-types'\nimport { idValidator } from '../misc/id-validator'\nimport { cursorValidator, TLCursor } from '../misc/TLCursor'\nimport { opacityValidator, TLOpacityType } from '../misc/TLOpacity'\nimport { scribbleValidator, TLScribble } from '../misc/TLScribble'\nimport { StyleProp } from '../styles/StyleProp'\nimport { pageIdValidator, TLPageId } from './TLPage'\nimport { TLShapeId } from './TLShape'\n\n/**\n * TLInstance\n *\n * State that is particular to a single browser tab\n *\n * @public\n */\nexport interface TLInstance extends BaseRecord<'instance', TLInstanceId> {\n\tcurrentPageId: TLPageId\n\topacityForNextShape: TLOpacityType\n\tstylesForNextShape: Record<string, unknown>\n\t// ephemeral\n\tfollowingUserId: string | null\n\thighlightedUserIds: string[]\n\tbrush: BoxModel | null\n\tcursor: TLCursor\n\tscribbles: TLScribble[]\n\tisFocusMode: boolean\n\tisDebugMode: boolean\n\tisToolLocked: boolean\n\texportBackground: boolean\n\tscreenBounds: BoxModel\n\tinsets: boolean[]\n\tzoomBrush: BoxModel | null\n\tchatMessage: string\n\tisChatting: boolean\n\tisPenMode: boolean\n\tisGridMode: boolean\n\tcanMoveCamera: boolean\n\tisFocused: boolean\n\tdevicePixelRatio: number\n\t/**\n\t * This is whether the primary input mechanism includes a pointing device of limited accuracy,\n\t * such as a finger on a touchscreen.\n\t * See: https://developer.mozilla.org/en-US/docs/Web/CSS/\\@media/pointer\n\t */\n\tisCoarsePointer: boolean\n\t/**\n\t * Will be null if the pointer doesn't support hovering (e.g. touch), but true or false\n\t * otherwise\n\t */\n\tisHoveringCanvas: boolean | null\n\topenMenus: string[]\n\tisChangingStyle: boolean\n\tisReadonly: boolean\n\tmeta: JsonObject\n\tduplicateProps: {\n\t\tshapeIds: TLShapeId[]\n\t\toffset: {\n\t\t\tx: number\n\t\t\ty: number\n\t\t}\n\t} | null\n}\n\n/** @public */\nexport type TLInstanceId = RecordId<TLInstance>\n\n/** @public */\nexport const instanceIdValidator = idValidator<TLInstanceId>('instance')\n\nexport function createInstanceRecordType(stylesById: Map<string, StyleProp<unknown>>) {\n\tconst stylesForNextShapeValidators = {} as Record<string, T.Validator<unknown>>\n\tfor (const [id, style] of stylesById) {\n\t\tstylesForNextShapeValidators[id] = T.optional(style)\n\t}\n\n\tconst instanceTypeValidator: T.Validator<TLInstance> = T.model(\n\t\t'instance',\n\t\tT.object({\n\t\t\ttypeName: T.literal('instance'),\n\t\t\tid: idValidator<TLInstanceId>('instance'),\n\t\t\tcurrentPageId: pageIdValidator,\n\t\t\tfollowingUserId: T.string.nullable(),\n\t\t\tbrush: boxModelValidator.nullable(),\n\t\t\topacityForNextShape: opacityValidator,\n\t\t\tstylesForNextShape: T.object(stylesForNextShapeValidators),\n\t\t\tcursor: cursorValidator,\n\t\t\tscribbles: T.arrayOf(scribbleValidator),\n\t\t\tisFocusMode: T.boolean,\n\t\t\tisDebugMode: T.boolean,\n\t\t\tisToolLocked: T.boolean,\n\t\t\texportBackground: T.boolean,\n\t\t\tscreenBounds: boxModelValidator,\n\t\t\tinsets: T.arrayOf(T.boolean),\n\t\t\tzoomBrush: boxModelValidator.nullable(),\n\t\t\tisPenMode: T.boolean,\n\t\t\tisGridMode: T.boolean,\n\t\t\tchatMessage: T.string,\n\t\t\tisChatting: T.boolean,\n\t\t\thighlightedUserIds: T.arrayOf(T.string),\n\t\t\tcanMoveCamera: T.boolean,\n\t\t\tisFocused: T.boolean,\n\t\t\tdevicePixelRatio: T.number,\n\t\t\tisCoarsePointer: T.boolean,\n\t\t\tisHoveringCanvas: T.boolean.nullable(),\n\t\t\topenMenus: T.arrayOf(T.string),\n\t\t\tisChangingStyle: T.boolean,\n\t\t\tisReadonly: T.boolean,\n\t\t\tmeta: T.jsonValue as T.ObjectValidator<JsonObject>,\n\t\t\tduplicateProps: T.object({\n\t\t\t\tshapeIds: T.arrayOf(idValidator<TLShapeId>('shape')),\n\t\t\t\toffset: T.object({\n\t\t\t\t\tx: T.number,\n\t\t\t\t\ty: T.number,\n\t\t\t\t}),\n\t\t\t}).nullable(),\n\t\t})\n\t)\n\n\treturn createRecordType<TLInstance>('instance', {\n\t\tvalidator: instanceTypeValidator,\n\t\tscope: 'session',\n\t}).withDefaultProperties(\n\t\t(): Omit<TLInstance, 'typeName' | 'id' | 'currentPageId'> => ({\n\t\t\tfollowingUserId: null,\n\t\t\topacityForNextShape: 1,\n\t\t\tstylesForNextShape: {},\n\t\t\tbrush: null,\n\t\t\tscribbles: [],\n\t\t\tcursor: {\n\t\t\t\ttype: 'default',\n\t\t\t\trotation: 0,\n\t\t\t},\n\t\t\tisFocusMode: false,\n\t\t\texportBackground: false,\n\t\t\tisDebugMode: process.env.NODE_ENV === 'development',\n\t\t\tisToolLocked: false,\n\t\t\tscreenBounds: { x: 0, y: 0, w: 1080, h: 720 },\n\t\t\tinsets: [false, false, false, false],\n\t\t\tzoomBrush: null,\n\t\t\tisGridMode: false,\n\t\t\tisPenMode: false,\n\t\t\tchatMessage: '',\n\t\t\tisChatting: false,\n\t\t\thighlightedUserIds: [],\n\t\t\tcanMoveCamera: true,\n\t\t\tisFocused: false,\n\t\t\tdevicePixelRatio: typeof window === 'undefined' ? 1 : window.devicePixelRatio,\n\t\t\tisCoarsePointer: false,\n\t\t\tisHoveringCanvas: null,\n\t\t\topenMenus: [] as string[],\n\t\t\tisChangingStyle: false,\n\t\t\tisReadonly: false,\n\t\t\tmeta: {},\n\t\t\tduplicateProps: null,\n\t\t})\n\t)\n}\n\n/** @public */\nexport const instanceVersions = createMigrationIds('com.tldraw.instance', {\n\tAddTransparentExportBgs: 1,\n\tRemoveDialog: 2,\n\tAddToolLockMode: 3,\n\tRemoveExtraPropsForNextShape: 4,\n\tAddLabelColor: 5,\n\tAddFollowingUserId: 6,\n\tRemoveAlignJustify: 7,\n\tAddZoom: 8,\n\tAddVerticalAlign: 9,\n\tAddScribbleDelay: 10,\n\tRemoveUserId: 11,\n\tAddIsPenModeAndIsGridMode: 12,\n\tHoistOpacity: 13,\n\tAddChat: 14,\n\tAddHighlightedUserIds: 15,\n\tReplacePropsForNextShapeWithStylesForNextShape: 16,\n\tAddMeta: 17,\n\tRemoveCursorColor: 18,\n\tAddLonelyProperties: 19,\n\tReadOnlyReadonly: 20,\n\tAddHoveringCanvas: 21,\n\tAddScribbles: 22,\n\tAddInset: 23,\n\tAddDuplicateProps: 24,\n} as const)\n\n// TODO: rewrite these to use mutation\n\n/** @public */\nexport const instanceMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.instance',\n\trecordType: 'instance',\n\tsequence: [\n\t\t{\n\t\t\tid: instanceVersions.AddTransparentExportBgs,\n\t\t\tup: (instance) => {\n\t\t\t\treturn { ...instance, exportBackground: true }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.RemoveDialog,\n\t\t\tup: ({ dialog: _, ...instance }: any) => {\n\t\t\t\treturn instance\n\t\t\t},\n\t\t},\n\n\t\t{\n\t\t\tid: instanceVersions.AddToolLockMode,\n\t\t\tup: (instance) => {\n\t\t\t\treturn { ...instance, isToolLocked: false }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.RemoveExtraPropsForNextShape,\n\t\t\tup: ({ propsForNextShape, ...instance }: any) => {\n\t\t\t\treturn {\n\t\t\t\t\t...instance,\n\t\t\t\t\tpropsForNextShape: Object.fromEntries(\n\t\t\t\t\t\tObject.entries(propsForNextShape).filter(([key]) =>\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t'color',\n\t\t\t\t\t\t\t\t'labelColor',\n\t\t\t\t\t\t\t\t'dash',\n\t\t\t\t\t\t\t\t'fill',\n\t\t\t\t\t\t\t\t'size',\n\t\t\t\t\t\t\t\t'font',\n\t\t\t\t\t\t\t\t'align',\n\t\t\t\t\t\t\t\t'verticalAlign',\n\t\t\t\t\t\t\t\t'icon',\n\t\t\t\t\t\t\t\t'geo',\n\t\t\t\t\t\t\t\t'arrowheadStart',\n\t\t\t\t\t\t\t\t'arrowheadEnd',\n\t\t\t\t\t\t\t\t'spline',\n\t\t\t\t\t\t\t].includes(key)\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddLabelColor,\n\t\t\tup: ({ propsForNextShape, ...instance }: any) => {\n\t\t\t\treturn {\n\t\t\t\t\t...instance,\n\t\t\t\t\tpropsForNextShape: {\n\t\t\t\t\t\t...propsForNextShape,\n\t\t\t\t\t\tlabelColor: 'black',\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddFollowingUserId,\n\t\t\tup: (instance) => {\n\t\t\t\treturn { ...instance, followingUserId: null }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.RemoveAlignJustify,\n\t\t\tup: (instance: any) => {\n\t\t\t\tlet newAlign = instance.propsForNextShape.align\n\t\t\t\tif (newAlign === 'justify') {\n\t\t\t\t\tnewAlign = 'start'\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...instance,\n\t\t\t\t\tpropsForNextShape: {\n\t\t\t\t\t\t...instance.propsForNextShape,\n\t\t\t\t\t\talign: newAlign,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddZoom,\n\t\t\tup: (instance) => {\n\t\t\t\treturn { ...instance, zoomBrush: null }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddVerticalAlign,\n\t\t\tup: (instance: any) => {\n\t\t\t\treturn {\n\t\t\t\t\t...instance,\n\t\t\t\t\tpropsForNextShape: {\n\t\t\t\t\t\t...instance.propsForNextShape,\n\t\t\t\t\t\tverticalAlign: 'middle',\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddScribbleDelay,\n\t\t\tup: (instance: any) => {\n\t\t\t\tif (instance.scribble !== null) {\n\t\t\t\t\treturn { ...instance, scribble: { ...instance.scribble, delay: 0 } }\n\t\t\t\t}\n\t\t\t\treturn { ...instance }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.RemoveUserId,\n\t\t\tup: ({ userId: _, ...instance }: any) => {\n\t\t\t\treturn instance\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddIsPenModeAndIsGridMode,\n\t\t\tup: (instance) => {\n\t\t\t\treturn { ...instance, isPenMode: false, isGridMode: false }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.HoistOpacity,\n\t\t\tup: ({ propsForNextShape: { opacity, ...propsForNextShape }, ...instance }: any) => {\n\t\t\t\treturn { ...instance, opacityForNextShape: Number(opacity ?? '1'), propsForNextShape }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddChat,\n\t\t\tup: (instance) => {\n\t\t\t\treturn { ...instance, chatMessage: '', isChatting: false }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddHighlightedUserIds,\n\t\t\tup: (instance) => {\n\t\t\t\treturn { ...instance, highlightedUserIds: [] }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.ReplacePropsForNextShapeWithStylesForNextShape,\n\t\t\tup: ({ propsForNextShape: _, ...instance }: any) => {\n\t\t\t\treturn { ...instance, stylesForNextShape: {} }\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddMeta,\n\t\t\tup: (record) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tmeta: {},\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.RemoveCursorColor,\n\t\t\tup: (record: any) => {\n\t\t\t\tconst { color: _, ...cursor } = record.cursor\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tcursor,\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddLonelyProperties,\n\t\t\tup: (record) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tcanMoveCamera: true,\n\t\t\t\t\tisFocused: false,\n\t\t\t\t\tdevicePixelRatio: 1,\n\t\t\t\t\tisCoarsePointer: false,\n\t\t\t\t\topenMenus: [],\n\t\t\t\t\tisChangingStyle: false,\n\t\t\t\t\tisReadOnly: false,\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.ReadOnlyReadonly,\n\t\t\tup: ({ isReadOnly: _isReadOnly, ...record }: any) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tisReadonly: _isReadOnly,\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddHoveringCanvas,\n\t\t\tup: (record) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tisHoveringCanvas: null,\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddScribbles,\n\t\t\tup: ({ scribble: _, ...record }: any) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tscribbles: [],\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddInset,\n\t\t\tup: (record) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tinsets: [false, false, false, false],\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: ({ insets: _, ...record }: any) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instanceVersions.AddDuplicateProps,\n\t\t\tup: (record) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tduplicateProps: null,\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: ({ duplicateProps: _, ...record }: any) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport const TLINSTANCE_ID = 'instance:instance' as TLInstanceId\n", "import { BaseRecord } from '@tldraw/store'\nimport { Expand, IndexKey, JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { TLOpacityType, opacityValidator } from '../misc/TLOpacity'\nimport { idValidator } from '../misc/id-validator'\nimport { TLParentId, TLShapeId } from '../records/TLShape'\n\n/** @public */\nexport interface TLBaseShape<Type extends string, Props extends object>\n\textends BaseRecord<'shape', TLShapeId> {\n\ttype: Type\n\tx: number\n\ty: number\n\trotation: number\n\tindex: IndexKey\n\tparentId: TLParentId\n\tisLocked: boolean\n\topacity: TLOpacityType\n\tprops: Props\n\tmeta: JsonObject\n}\n\n/** @public */\nexport const parentIdValidator = T.string.refine((id) => {\n\tif (!id.startsWith('page:') && !id.startsWith('shape:')) {\n\t\tthrow new Error('Parent ID must start with \"page:\" or \"shape:\"')\n\t}\n\treturn id as TLParentId\n})\n\n/** @public */\nexport const shapeIdValidator = idValidator<TLShapeId>('shape')\n\n/** @public */\nexport function createShapeValidator<\n\tType extends string,\n\tProps extends JsonObject,\n\tMeta extends JsonObject,\n>(\n\ttype: Type,\n\tprops?: { [K in keyof Props]: T.Validatable<Props[K]> },\n\tmeta?: { [K in keyof Meta]: T.Validatable<Meta[K]> }\n) {\n\treturn T.object<TLBaseShape<Type, Props>>({\n\t\tid: shapeIdValidator,\n\t\ttypeName: T.literal('shape'),\n\t\tx: T.number,\n\t\ty: T.number,\n\t\trotation: T.number,\n\t\tindex: T.indexKey,\n\t\tparentId: parentIdValidator,\n\t\ttype: T.literal(type),\n\t\tisLocked: T.boolean,\n\t\topacity: opacityValidator,\n\t\tprops: props ? T.object(props) : (T.jsonValue as any),\n\t\tmeta: meta ? T.object(meta) : (T.jsonValue as any),\n\t})\n}\n\n/** @public */\nexport type ShapeProps<Shape extends TLBaseShape<any, any>> = {\n\t[K in keyof Shape['props']]: T.Validatable<Shape['props'][K]>\n}\n\n/** @public */\nexport type ShapePropsType<Config extends Record<string, T.Validatable<any>>> = Expand<{\n\t[K in keyof Config]: T.TypeOf<Config[K]>\n}>\n", "import {\n\tBaseRecord,\n\tcreateMigrationIds,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n\tRecordId,\n} from '@tldraw/store'\nimport { JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { idValidator } from '../misc/id-validator'\nimport { shapeIdValidator } from '../shapes/TLBaseShape'\nimport { pageIdValidator, TLPage } from './TLPage'\nimport { TLShapeId } from './TLShape'\n\n/**\n * TLInstancePageState\n *\n * State that is unique to a particular page of the document in a particular browser tab\n *\n * @public\n */\nexport interface TLInstancePageState\n\textends BaseRecord<'instance_page_state', TLInstancePageStateId> {\n\tpageId: RecordId<TLPage>\n\tselectedShapeIds: TLShapeId[]\n\thintingShapeIds: TLShapeId[]\n\terasingShapeIds: TLShapeId[]\n\thoveredShapeId: TLShapeId | null\n\teditingShapeId: TLShapeId | null\n\tcroppingShapeId: TLShapeId | null\n\tfocusedGroupId: TLShapeId | null\n\tmeta: JsonObject\n}\n\n/** @public */\nexport const instancePageStateValidator: T.Validator<TLInstancePageState> = T.model(\n\t'instance_page_state',\n\tT.object({\n\t\ttypeName: T.literal('instance_page_state'),\n\t\tid: idValidator<TLInstancePageStateId>('instance_page_state'),\n\t\tpageId: pageIdValidator,\n\t\tselectedShapeIds: T.arrayOf(shapeIdValidator),\n\t\thintingShapeIds: T.arrayOf(shapeIdValidator),\n\t\terasingShapeIds: T.arrayOf(shapeIdValidator),\n\t\thoveredShapeId: shapeIdValidator.nullable(),\n\t\teditingShapeId: shapeIdValidator.nullable(),\n\t\tcroppingShapeId: shapeIdValidator.nullable(),\n\t\tfocusedGroupId: shapeIdValidator.nullable(),\n\t\tmeta: T.jsonValue as T.ObjectValidator<JsonObject>,\n\t})\n)\n\n/** @public */\nexport const instancePageStateVersions = createMigrationIds('com.tldraw.instance_page_state', {\n\tAddCroppingId: 1,\n\tRemoveInstanceIdAndCameraId: 2,\n\tAddMeta: 3,\n\tRenameProperties: 4,\n\tRenamePropertiesAgain: 5,\n} as const)\n\n/** @public */\nexport const instancePageStateMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.instance_page_state',\n\trecordType: 'instance_page_state',\n\tsequence: [\n\t\t{\n\t\t\tid: instancePageStateVersions.AddCroppingId,\n\t\t\tup(instance: any) {\n\t\t\t\tinstance.croppingShapeId = null\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instancePageStateVersions.RemoveInstanceIdAndCameraId,\n\t\t\tup(instance: any) {\n\t\t\t\tdelete instance.instanceId\n\t\t\t\tdelete instance.cameraId\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instancePageStateVersions.AddMeta,\n\t\t\tup: (record: any) => {\n\t\t\t\trecord.meta = {}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instancePageStateVersions.RenameProperties,\n\t\t\t// this migration is cursed: it was written wrong and doesn't do anything.\n\t\t\t// rather than replace it, I've added another migration below that fixes it.\n\t\t\tup: (_record) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t\tdown: (_record) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instancePageStateVersions.RenamePropertiesAgain,\n\t\t\tup: (record: any) => {\n\t\t\t\trecord.selectedShapeIds = record.selectedIds\n\t\t\t\tdelete record.selectedIds\n\t\t\t\trecord.hintingShapeIds = record.hintingIds\n\t\t\t\tdelete record.hintingIds\n\t\t\t\trecord.erasingShapeIds = record.erasingIds\n\t\t\t\tdelete record.erasingIds\n\t\t\t\trecord.hoveredShapeId = record.hoveredId\n\t\t\t\tdelete record.hoveredId\n\t\t\t\trecord.editingShapeId = record.editingId\n\t\t\t\tdelete record.editingId\n\t\t\t\trecord.croppingShapeId = record.croppingShapeId ?? record.croppingId ?? null\n\t\t\t\tdelete record.croppingId\n\t\t\t\trecord.focusedGroupId = record.focusLayerId\n\t\t\t\tdelete record.focusLayerId\n\t\t\t},\n\t\t\tdown: (record: any) => {\n\t\t\t\trecord.selectedIds = record.selectedShapeIds\n\t\t\t\tdelete record.selectedShapeIds\n\t\t\t\trecord.hintingIds = record.hintingShapeIds\n\t\t\t\tdelete record.hintingShapeIds\n\t\t\t\trecord.erasingIds = record.erasingShapeIds\n\t\t\t\tdelete record.erasingShapeIds\n\t\t\t\trecord.hoveredId = record.hoveredShapeId\n\t\t\t\tdelete record.hoveredShapeId\n\t\t\t\trecord.editingId = record.editingShapeId\n\t\t\t\tdelete record.editingShapeId\n\t\t\t\trecord.croppingId = record.croppingShapeId\n\t\t\t\tdelete record.croppingShapeId\n\t\t\t\trecord.focusLayerId = record.focusedGroupId\n\t\t\t\tdelete record.focusedGroupId\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport const InstancePageStateRecordType = createRecordType<TLInstancePageState>(\n\t'instance_page_state',\n\t{\n\t\tvalidator: instancePageStateValidator,\n\t\tscope: 'session',\n\t}\n).withDefaultProperties(\n\t(): Omit<TLInstancePageState, 'id' | 'typeName' | 'pageId'> => ({\n\t\teditingShapeId: null,\n\t\tcroppingShapeId: null,\n\t\tselectedShapeIds: [],\n\t\thoveredShapeId: null,\n\t\terasingShapeIds: [],\n\t\thintingShapeIds: [],\n\t\tfocusedGroupId: null,\n\t\tmeta: {},\n\t})\n)\n\n/** @public */\nexport type TLInstancePageStateId = RecordId<TLInstancePageState>\n", "import {\n\tBaseRecord,\n\tcreateMigrationIds,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n\tRecordId,\n} from '@tldraw/store'\nimport { JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { idValidator } from '../misc/id-validator'\n\n/**\n * TLPointer\n *\n * @public\n */\nexport interface TLPointer extends BaseRecord<'pointer', TLPointerId> {\n\tx: number\n\ty: number\n\tlastActivityTimestamp: number\n\tmeta: JsonObject\n}\n\n/** @public */\nexport type TLPointerId = RecordId<TLPointer>\n\n/** @public */\nexport const pointerValidator: T.Validator<TLPointer> = T.model(\n\t'pointer',\n\tT.object({\n\t\ttypeName: T.literal('pointer'),\n\t\tid: idValidator<TLPointerId>('pointer'),\n\t\tx: T.number,\n\t\ty: T.number,\n\t\tlastActivityTimestamp: T.number,\n\t\tmeta: T.jsonValue as T.ObjectValidator<JsonObject>,\n\t})\n)\n\n/** @public */\nexport const pointerVersions = createMigrationIds('com.tldraw.pointer', {\n\tAddMeta: 1,\n})\n\n/** @public */\nexport const pointerMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.pointer',\n\trecordType: 'pointer',\n\tsequence: [\n\t\t{\n\t\t\tid: pointerVersions.AddMeta,\n\t\t\tup: (record: any) => {\n\t\t\t\trecord.meta = {}\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport const PointerRecordType = createRecordType<TLPointer>('pointer', {\n\tvalidator: pointerValidator,\n\tscope: 'session',\n}).withDefaultProperties(\n\t(): Omit<TLPointer, 'id' | 'typeName'> => ({\n\t\tx: 0,\n\t\ty: 0,\n\t\tlastActivityTimestamp: 0,\n\t\tmeta: {},\n\t})\n)\n\n/** @public */\nexport const TLPOINTER_ID = PointerRecordType.createId('pointer')\n", "import {\n\tBaseRecord,\n\tcreateMigrationIds,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n\tRecordId,\n} from '@tldraw/store'\nimport { JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { BoxModel, boxModelValidator } from '../misc/geometry-types'\nimport { idValidator } from '../misc/id-validator'\nimport { cursorTypeValidator, TLCursor } from '../misc/TLCursor'\nimport { scribbleValidator, TLScribble } from '../misc/TLScribble'\nimport { TLPageId } from './TLPage'\nimport { TLShapeId } from './TLShape'\n\n/** @public */\nexport interface TLInstancePresence extends BaseRecord<'instance_presence', TLInstancePresenceID> {\n\tuserId: string\n\tuserName: string\n\tlastActivityTimestamp: number\n\tcolor: string // can be any hex color\n\tcamera: { x: number; y: number; z: number }\n\tselectedShapeIds: TLShapeId[]\n\tcurrentPageId: TLPageId\n\tbrush: BoxModel | null\n\tscribbles: TLScribble[]\n\tscreenBounds: BoxModel\n\tfollowingUserId: string | null\n\tcursor: {\n\t\tx: number\n\t\ty: number\n\t\ttype: TLCursor['type']\n\t\trotation: number\n\t}\n\tchatMessage: string\n\tmeta: JsonObject\n}\n\n/** @public */\nexport type TLInstancePresenceID = RecordId<TLInstancePresence>\n\n/** @public */\nexport const instancePresenceValidator: T.Validator<TLInstancePresence> = T.model(\n\t'instance_presence',\n\tT.object({\n\t\ttypeName: T.literal('instance_presence'),\n\t\tid: idValidator<TLInstancePresenceID>('instance_presence'),\n\t\tuserId: T.string,\n\t\tuserName: T.string,\n\t\tlastActivityTimestamp: T.number,\n\t\tfollowingUserId: T.string.nullable(),\n\t\tcursor: T.object({\n\t\t\tx: T.number,\n\t\t\ty: T.number,\n\t\t\ttype: cursorTypeValidator,\n\t\t\trotation: T.number,\n\t\t}),\n\t\tcolor: T.string,\n\t\tcamera: T.object({\n\t\t\tx: T.number,\n\t\t\ty: T.number,\n\t\t\tz: T.number,\n\t\t}),\n\t\tscreenBounds: boxModelValidator,\n\t\tselectedShapeIds: T.arrayOf(idValidator<TLShapeId>('shape')),\n\t\tcurrentPageId: idValidator<TLPageId>('page'),\n\t\tbrush: boxModelValidator.nullable(),\n\t\tscribbles: T.arrayOf(scribbleValidator),\n\t\tchatMessage: T.string,\n\t\tmeta: T.jsonValue as T.ObjectValidator<JsonObject>,\n\t})\n)\n\n/** @public */\nexport const instancePresenceVersions = createMigrationIds('com.tldraw.instance_presence', {\n\tAddScribbleDelay: 1,\n\tRemoveInstanceId: 2,\n\tAddChatMessage: 3,\n\tAddMeta: 4,\n\tRenameSelectedShapeIds: 5,\n} as const)\n\nexport const instancePresenceMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.instance_presence',\n\trecordType: 'instance_presence',\n\tsequence: [\n\t\t{\n\t\t\tid: instancePresenceVersions.AddScribbleDelay,\n\t\t\tup: (instance: any) => {\n\t\t\t\tif (instance.scribble !== null) {\n\t\t\t\t\tinstance.scribble.delay = 0\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instancePresenceVersions.RemoveInstanceId,\n\t\t\tup: (instance: any) => {\n\t\t\t\tdelete instance.instanceId\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instancePresenceVersions.AddChatMessage,\n\t\t\tup: (instance: any) => {\n\t\t\t\tinstance.chatMessage = ''\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instancePresenceVersions.AddMeta,\n\t\t\tup: (record: any) => {\n\t\t\t\trecord.meta = {}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: instancePresenceVersions.RenameSelectedShapeIds,\n\t\t\tup: (_record) => {\n\t\t\t\t// noop, whoopsie\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport const InstancePresenceRecordType = createRecordType<TLInstancePresence>(\n\t'instance_presence',\n\t{\n\t\tvalidator: instancePresenceValidator,\n\t\tscope: 'presence',\n\t}\n).withDefaultProperties(() => ({\n\tlastActivityTimestamp: 0,\n\tfollowingUserId: null,\n\tcolor: '#FF0000',\n\tcamera: {\n\t\tx: 0,\n\t\ty: 0,\n\t\tz: 1,\n\t},\n\tcursor: {\n\t\tx: 0,\n\t\ty: 0,\n\t\ttype: 'default',\n\t\trotation: 0,\n\t},\n\tscreenBounds: {\n\t\tx: 0,\n\t\ty: 0,\n\t\tw: 1,\n\t\th: 1,\n\t},\n\tselectedShapeIds: [],\n\tbrush: null,\n\tscribbles: [],\n\tchatMessage: '',\n\tmeta: {},\n}))\n", "import { Signal, computed } from '@tldraw/state'\nimport { TLStore } from './TLStore'\nimport { CameraRecordType } from './records/TLCamera'\nimport { TLINSTANCE_ID } from './records/TLInstance'\nimport { InstancePageStateRecordType } from './records/TLPageState'\nimport { TLPOINTER_ID } from './records/TLPointer'\nimport { InstancePresenceRecordType, TLInstancePresence } from './records/TLPresence'\n\n/**\n * Creates a derivation that represents the current presence state of the current user.\n * @public\n */\nexport const createPresenceStateDerivation =\n\t(\n\t\t$user: Signal<{ id: string; color: string; name: string }>,\n\t\tinstanceId?: TLInstancePresence['id']\n\t) =>\n\t(store: TLStore): Signal<TLInstancePresence | null> => {\n\t\treturn computed('instancePresence', () => {\n\t\t\tconst instance = store.get(TLINSTANCE_ID)\n\t\t\tconst pageState = store.get(InstancePageStateRecordType.createId(instance?.currentPageId))\n\t\t\tconst camera = store.get(CameraRecordType.createId(instance?.currentPageId))\n\t\t\tconst pointer = store.get(TLPOINTER_ID)\n\t\t\tconst user = $user.get()\n\t\t\tif (!pageState || !instance || !camera || !pointer || !user) {\n\t\t\t\treturn null\n\t\t\t}\n\n\t\t\treturn InstancePresenceRecordType.create({\n\t\t\t\tid: instanceId ?? InstancePresenceRecordType.createId(store.id),\n\t\t\t\tselectedShapeIds: pageState.selectedShapeIds,\n\t\t\t\tbrush: instance.brush,\n\t\t\t\tscribbles: instance.scribbles,\n\t\t\t\tuserId: user.id,\n\t\t\t\tuserName: user.name,\n\t\t\t\tfollowingUserId: instance.followingUserId,\n\t\t\t\tcamera: {\n\t\t\t\t\tx: camera.x,\n\t\t\t\t\ty: camera.y,\n\t\t\t\t\tz: camera.z,\n\t\t\t\t},\n\t\t\t\tcolor: user.color,\n\t\t\t\tcurrentPageId: instance.currentPageId,\n\t\t\t\tcursor: {\n\t\t\t\t\tx: pointer.x,\n\t\t\t\t\ty: pointer.y,\n\t\t\t\t\trotation: instance.cursor.rotation,\n\t\t\t\t\ttype: instance.cursor.type,\n\t\t\t\t},\n\t\t\t\tlastActivityTimestamp: pointer.lastActivityTimestamp,\n\t\t\t\tscreenBounds: instance.screenBounds,\n\t\t\t\tchatMessage: instance.chatMessage,\n\t\t\t\tmeta: {},\n\t\t\t})\n\t\t})\n\t}\n", "import {\n\tBaseRecord,\n\tcreateMigrationIds,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n\tRecordId,\n} from '@tldraw/store'\nimport { JsonObject } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\n\n/**\n * TLDocument\n *\n * @public\n */\nexport interface TLDocument extends BaseRecord<'document', RecordId<TLDocument>> {\n\tgridSize: number\n\tname: string\n\tmeta: JsonObject\n}\n\n/** @public */\nexport const documentValidator: T.Validator<TLDocument> = T.model(\n\t'document',\n\tT.object({\n\t\ttypeName: T.literal('document'),\n\t\tid: T.literal('document:document' as RecordId<TLDocument>),\n\t\tgridSize: T.number,\n\t\tname: T.string,\n\t\tmeta: T.jsonValue as T.ObjectValidator<JsonObject>,\n\t})\n)\n\n/** @public */\nexport const documentVersions = createMigrationIds('com.tldraw.document', {\n\tAddName: 1,\n\tAddMeta: 2,\n} as const)\n\n/** @public */\nexport const documentMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.document',\n\trecordType: 'document',\n\tsequence: [\n\t\t{\n\t\t\tid: documentVersions.AddName,\n\t\t\tup: (document) => {\n\t\t\t\t;(document as any).name = ''\n\t\t\t},\n\t\t\tdown: (document) => {\n\t\t\t\tdelete (document as any).name\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: documentVersions.AddMeta,\n\t\t\tup: (record) => {\n\t\t\t\t;(record as any).meta = {}\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport const DocumentRecordType = createRecordType<TLDocument>('document', {\n\tvalidator: documentValidator,\n\tscope: 'document',\n}).withDefaultProperties(\n\t(): Omit<TLDocument, 'id' | 'typeName'> => ({\n\t\tgridSize: 10,\n\t\tname: '',\n\t\tmeta: {},\n\t})\n)\n\n// all document records have the same ID: 'document:document'\n/** @public */\nexport const TLDOCUMENT_ID: RecordId<TLDocument> = DocumentRecordType.createId('document')\n", "import {\n\tSerializedStore,\n\tStore,\n\tStoreSchema,\n\tStoreSchemaOptions,\n\tStoreSnapshot,\n} from '@tldraw/store'\nimport { IndexKey, annotateError, structuredClone } from '@tldraw/utils'\nimport { CameraRecordType, TLCameraId } from './records/TLCamera'\nimport { DocumentRecordType, TLDOCUMENT_ID } from './records/TLDocument'\nimport { TLINSTANCE_ID } from './records/TLInstance'\nimport { PageRecordType, TLPageId } from './records/TLPage'\nimport { InstancePageStateRecordType, TLInstancePageStateId } from './records/TLPageState'\nimport { PointerRecordType, TLPOINTER_ID } from './records/TLPointer'\nimport { TLRecord } from './records/TLRecord'\n\nfunction sortByIndex<T extends { index: string }>(a: T, b: T) {\n\tif (a.index < b.index) {\n\t\treturn -1\n\t} else if (a.index > b.index) {\n\t\treturn 1\n\t}\n\treturn 0\n}\n\nfunction redactRecordForErrorReporting(record: any) {\n\tif (record.typeName === 'asset') {\n\t\tif ('src' in record) {\n\t\t\trecord.src = '<redacted>'\n\t\t}\n\n\t\tif ('src' in record.props) {\n\t\t\trecord.props.src = '<redacted>'\n\t\t}\n\t}\n}\n\n/** @public */\nexport type TLStoreSchema = StoreSchema<TLRecord, TLStoreProps>\n\n/** @public */\nexport type TLSerializedStore = SerializedStore<TLRecord>\n\n/** @public */\nexport type TLStoreSnapshot = StoreSnapshot<TLRecord>\n\n/** @public */\nexport type TLStoreProps = {\n\tdefaultName: string\n}\n\n/** @public */\nexport type TLStore = Store<TLRecord, TLStoreProps>\n\n/** @public */\nexport const onValidationFailure: StoreSchemaOptions<\n\tTLRecord,\n\tTLStoreProps\n>['onValidationFailure'] = ({ error, phase, record, recordBefore }): TLRecord => {\n\tconst isExistingValidationIssue =\n\t\t// if we're initializing the store for the first time, we should\n\t\t// allow invalid records so people can load old buggy data:\n\t\tphase === 'initialize'\n\n\tannotateError(error, {\n\t\ttags: {\n\t\t\torigin: 'store.validateRecord',\n\t\t\tstorePhase: phase,\n\t\t\tisExistingValidationIssue,\n\t\t},\n\t\textras: {\n\t\t\trecordBefore: recordBefore\n\t\t\t\t? redactRecordForErrorReporting(structuredClone(recordBefore))\n\t\t\t\t: undefined,\n\t\t\trecordAfter: redactRecordForErrorReporting(structuredClone(record)),\n\t\t},\n\t})\n\n\tthrow error\n}\n\nfunction getDefaultPages() {\n\treturn [\n\t\tPageRecordType.create({\n\t\t\tid: 'page:page' as TLPageId,\n\t\t\tname: 'Page 1',\n\t\t\tindex: 'a1' as IndexKey,\n\t\t\tmeta: {},\n\t\t}),\n\t]\n}\n\n/** @internal */\nexport function createIntegrityChecker(store: TLStore): () => void {\n\tconst $pageIds = store.query.ids('page')\n\n\tconst ensureStoreIsUsable = (): void => {\n\t\t// make sure we have exactly one document\n\t\tif (!store.has(TLDOCUMENT_ID)) {\n\t\t\tstore.put([DocumentRecordType.create({ id: TLDOCUMENT_ID, name: store.props.defaultName })])\n\t\t\treturn ensureStoreIsUsable()\n\t\t}\n\n\t\tif (!store.has(TLPOINTER_ID)) {\n\t\t\tstore.put([PointerRecordType.create({ id: TLPOINTER_ID })])\n\t\t\treturn ensureStoreIsUsable()\n\t\t}\n\n\t\t// make sure there is at least one page\n\t\tconst pageIds = $pageIds.get()\n\t\tif (pageIds.size === 0) {\n\t\t\tstore.put(getDefaultPages())\n\t\t\treturn ensureStoreIsUsable()\n\t\t}\n\n\t\tconst getFirstPageId = () => [...pageIds].map((id) => store.get(id)!).sort(sortByIndex)[0].id!\n\n\t\t// make sure we have state for the current user's current tab\n\t\tconst instanceState = store.get(TLINSTANCE_ID)\n\t\tif (!instanceState) {\n\t\t\tstore.put([\n\t\t\t\tstore.schema.types.instance.create({\n\t\t\t\t\tid: TLINSTANCE_ID,\n\t\t\t\t\tcurrentPageId: getFirstPageId(),\n\t\t\t\t\texportBackground: true,\n\t\t\t\t}),\n\t\t\t])\n\n\t\t\treturn ensureStoreIsUsable()\n\t\t} else if (!pageIds.has(instanceState.currentPageId)) {\n\t\t\tstore.put([{ ...instanceState, currentPageId: getFirstPageId() }])\n\t\t\treturn ensureStoreIsUsable()\n\t\t}\n\n\t\t// make sure we have page states and cameras for all the pages\n\t\tconst missingPageStateIds = new Set<TLInstancePageStateId>()\n\t\tconst missingCameraIds = new Set<TLCameraId>()\n\t\tfor (const id of pageIds) {\n\t\t\tconst pageStateId = InstancePageStateRecordType.createId(id)\n\t\t\tif (!store.has(pageStateId)) {\n\t\t\t\tmissingPageStateIds.add(pageStateId)\n\t\t\t}\n\t\t\tconst cameraId = CameraRecordType.createId(id)\n\t\t\tif (!store.has(cameraId)) {\n\t\t\t\tmissingCameraIds.add(cameraId)\n\t\t\t}\n\t\t}\n\n\t\tif (missingPageStateIds.size > 0) {\n\t\t\tstore.put(\n\t\t\t\t[...missingPageStateIds].map((id) =>\n\t\t\t\t\tInstancePageStateRecordType.create({\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tpageId: InstancePageStateRecordType.parseId(id) as TLPageId,\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t)\n\t\t}\n\t\tif (missingCameraIds.size > 0) {\n\t\t\tstore.put([...missingCameraIds].map((id) => CameraRecordType.create({ id })))\n\t\t}\n\t}\n\n\treturn ensureStoreIsUsable\n}\n", "import { createMigrationIds, createRecordMigrationSequence } from '@tldraw/store'\nimport { T } from '@tldraw/validate'\nimport { TLAsset } from '../records/TLAsset'\nimport { TLBaseAsset, createAssetValidator } from './TLBaseAsset'\n\n/**\n * An asset used for URL bookmarks, used by the TLBookmarkShape.\n *\n *  @public */\nexport type TLBookmarkAsset = TLBaseAsset<\n\t'bookmark',\n\t{\n\t\ttitle: string\n\t\tdescription: string\n\t\timage: string\n\t\tsrc: string | null\n\t}\n>\n\n/** @public */\nexport const bookmarkAssetValidator: T.Validator<TLBookmarkAsset> = createAssetValidator(\n\t'bookmark',\n\tT.object({\n\t\ttitle: T.string,\n\t\tdescription: T.string,\n\t\timage: T.string,\n\t\tsrc: T.srcUrl.nullable(),\n\t})\n)\n\nconst Versions = createMigrationIds('com.tldraw.asset.bookmark', {\n\tMakeUrlsValid: 1,\n} as const)\n\nexport { Versions as bookmarkAssetVersions }\n\n/** @public */\nexport const bookmarkAssetMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.asset.bookmark',\n\trecordType: 'asset',\n\tfilter: (asset) => (asset as TLAsset).type === 'bookmark',\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.MakeUrlsValid,\n\t\t\tup: (asset: any) => {\n\t\t\t\tif (!T.srcUrl.isValid(asset.props.src)) {\n\t\t\t\t\tasset.props.src = ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (_asset) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { createMigrationIds, createRecordMigrationSequence } from '@tldraw/store'\nimport { T } from '@tldraw/validate'\nimport { TLAsset } from '../records/TLAsset'\nimport { TLBaseAsset, createAssetValidator } from './TLBaseAsset'\n\n/**\n * An asset for images such as PNGs and JPEGs, used by the TLImageShape.\n *\n * @public */\nexport type TLImageAsset = TLBaseAsset<\n\t'image',\n\t{\n\t\tw: number\n\t\th: number\n\t\tname: string\n\t\tisAnimated: boolean\n\t\tmimeType: string | null\n\t\tsrc: string | null\n\t}\n>\n\n/** @public */\nexport const imageAssetValidator: T.Validator<TLImageAsset> = createAssetValidator(\n\t'image',\n\tT.object({\n\t\tw: T.number,\n\t\th: T.number,\n\t\tname: T.string,\n\t\tisAnimated: T.boolean,\n\t\tmimeType: T.string.nullable(),\n\t\tsrc: T.srcUrl.nullable(),\n\t})\n)\n\nconst Versions = createMigrationIds('com.tldraw.asset.image', {\n\tAddIsAnimated: 1,\n\tRenameWidthHeight: 2,\n\tMakeUrlsValid: 3,\n} as const)\n\nexport { Versions as imageAssetVersions }\n\n/** @public */\nexport const imageAssetMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.asset.image',\n\trecordType: 'asset',\n\tfilter: (asset) => (asset as TLAsset).type === 'image',\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.AddIsAnimated,\n\t\t\tup: (asset: any) => {\n\t\t\t\tasset.props.isAnimated = false\n\t\t\t},\n\t\t\tdown: (asset: any) => {\n\t\t\t\tdelete asset.props.isAnimated\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: Versions.RenameWidthHeight,\n\t\t\tup: (asset: any) => {\n\t\t\t\tasset.props.w = asset.props.width\n\t\t\t\tasset.props.h = asset.props.height\n\t\t\t\tdelete asset.props.width\n\t\t\t\tdelete asset.props.height\n\t\t\t},\n\t\t\tdown: (asset: any) => {\n\t\t\t\tasset.props.width = asset.props.w\n\t\t\t\tasset.props.height = asset.props.h\n\t\t\t\tdelete asset.props.w\n\t\t\t\tdelete asset.props.h\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: Versions.MakeUrlsValid,\n\t\t\tup: (asset: any) => {\n\t\t\t\tif (!T.srcUrl.isValid(asset.props.src)) {\n\t\t\t\t\tasset.props.src = ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (_asset) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { createMigrationIds, createRecordMigrationSequence } from '@tldraw/store'\nimport { T } from '@tldraw/validate'\nimport { TLAsset } from '../records/TLAsset'\nimport { TLBaseAsset, createAssetValidator } from './TLBaseAsset'\n\n/**\n * An asset used for videos, used by the TLVideoShape.\n *\n * @public */\nexport type TLVideoAsset = TLBaseAsset<\n\t'video',\n\t{\n\t\tw: number\n\t\th: number\n\t\tname: string\n\t\tisAnimated: boolean\n\t\tmimeType: string | null\n\t\tsrc: string | null\n\t}\n>\n\n/** @public */\nexport const videoAssetValidator: T.Validator<TLVideoAsset> = createAssetValidator(\n\t'video',\n\tT.object({\n\t\tw: T.number,\n\t\th: T.number,\n\t\tname: T.string,\n\t\tisAnimated: T.boolean,\n\t\tmimeType: T.string.nullable(),\n\t\tsrc: T.srcUrl.nullable(),\n\t})\n)\n\nconst Versions = createMigrationIds('com.tldraw.asset.video', {\n\tAddIsAnimated: 1,\n\tRenameWidthHeight: 2,\n\tMakeUrlsValid: 3,\n} as const)\n\nexport { Versions as videoAssetVersions }\n\n/** @public */\nexport const videoAssetMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.asset.video',\n\trecordType: 'asset',\n\tfilter: (asset) => (asset as TLAsset).type === 'video',\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.AddIsAnimated,\n\t\t\tup: (asset: any) => {\n\t\t\t\tasset.props.isAnimated = false\n\t\t\t},\n\t\t\tdown: (asset: any) => {\n\t\t\t\tdelete asset.props.isAnimated\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: Versions.RenameWidthHeight,\n\t\t\tup: (asset: any) => {\n\t\t\t\tasset.props.w = asset.props.width\n\t\t\t\tasset.props.h = asset.props.height\n\t\t\t\tdelete asset.props.width\n\t\t\t\tdelete asset.props.height\n\t\t\t},\n\t\t\tdown: (asset: any) => {\n\t\t\t\tasset.props.width = asset.props.w\n\t\t\t\tasset.props.height = asset.props.h\n\t\t\t\tdelete asset.props.w\n\t\t\t\tdelete asset.props.h\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: Versions.MakeUrlsValid,\n\t\t\tup: (asset: any) => {\n\t\t\t\tif (!T.srcUrl.isValid(asset.props.src)) {\n\t\t\t\t\tasset.props.src = ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (_asset) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t],\n})\n", "import {\n\tcreateMigrationIds,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n\tRecordId,\n} from '@tldraw/store'\nimport { T } from '@tldraw/validate'\nimport { TLBaseAsset } from '../assets/TLBaseAsset'\nimport { bookmarkAssetValidator, TLBookmarkAsset } from '../assets/TLBookmarkAsset'\nimport { imageAssetValidator, TLImageAsset } from '../assets/TLImageAsset'\nimport { TLVideoAsset, videoAssetValidator } from '../assets/TLVideoAsset'\nimport { TLShape } from './TLShape'\n\n/** @public */\nexport type TLAsset = TLImageAsset | TLVideoAsset | TLBookmarkAsset\n\n/** @public */\nexport const assetValidator: T.Validator<TLAsset> = T.model(\n\t'asset',\n\tT.union('type', {\n\t\timage: imageAssetValidator,\n\t\tvideo: videoAssetValidator,\n\t\tbookmark: bookmarkAssetValidator,\n\t})\n)\n\n/** @public */\nexport const assetVersions = createMigrationIds('com.tldraw.asset', {\n\tAddMeta: 1,\n} as const)\n\n/** @public */\nexport const assetMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.asset',\n\trecordType: 'asset',\n\tsequence: [\n\t\t{\n\t\t\tid: assetVersions.AddMeta,\n\t\t\tup: (record) => {\n\t\t\t\t;(record as any).meta = {}\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport type TLAssetPartial<T extends TLAsset = TLAsset> = T extends T\n\t? {\n\t\t\tid: TLAssetId\n\t\t\ttype: T['type']\n\t\t\tprops?: Partial<T['props']>\n\t\t\tmeta?: Partial<T['meta']>\n\t\t} & Partial<Omit<T, 'type' | 'id' | 'props' | 'meta'>>\n\t: never\n\n/** @public */\nexport const AssetRecordType = createRecordType<TLAsset>('asset', {\n\tvalidator: assetValidator,\n\tscope: 'document',\n}).withDefaultProperties(() => ({\n\tmeta: {},\n}))\n\n/** @public */\nexport type TLAssetId = RecordId<TLBaseAsset<any, any>>\n\n/** @public */\nexport type TLAssetShape = Extract<TLShape, { props: { assetId: TLAssetId } }>\n", "export { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\nexport let nanoid = (size = 21) =>\n  crypto.getRandomValues(new Uint8Array(size)).reduce((id, byte) => {\n    byte &= 63\n    if (byte < 36) {\n      id += byte.toString(36)\n    } else if (byte < 62) {\n      id += (byte - 26).toString(36).toUpperCase()\n    } else if (byte > 62) {\n      id += '-'\n    } else {\n      id += '_'\n    }\n    return id\n  }, '')\n", "import { T } from '@tldraw/validate'\n\n/**\n * A `StyleProp` is a property of a shape that follows some special rules.\n *\n * 1. The same value can be set on lots of shapes at the same time.\n *\n * 2. The last used value is automatically saved and applied to new shapes.\n *\n * For example, {@link DefaultColorStyle} is a style prop used by tldraw's default shapes to set\n * their color. If you try selecting several shapes on tldraw.com and changing their color, you'll\n * see that the color is applied to all of them. Then, if you draw a new shape, it'll have the same\n * color as the one you just set.\n *\n * You can use styles in your own shapes by either defining your own (see {@link StyleProp.define}\n * and {@link StyleProp.defineEnum}) or using tldraw's default ones, like {@link DefaultColorStyle}.\n * When you define a shape, pass a `props` object describing all of your shape's properties, using\n * `StyleProp`s for the ones you want to be styles. See the\n * {@link https://github.com/tldraw/tldraw/tree/main/apps/examples | custom styles example}\n * for more.\n *\n * @public\n */\nexport class StyleProp<Type> implements T.Validatable<Type> {\n\t/**\n\t * Define a new {@link StyleProp}.\n\t *\n\t * @param uniqueId - Each StyleProp must have a unique ID. We recommend you prefix this with\n\t * your app/library name.\n\t * @param options -\n\t * - `defaultValue`: The default value for this style prop.\n\t *\n\t * - `type`: Optionally, describe what type of data you expect for this style prop.\n\t *\n\t * @example\n\t * ```ts\n\t * import {T} from '@tldraw/validate'\n\t * import {StyleProp} from '@tldraw/tlschema'\n\t *\n\t * const MyLineWidthProp = StyleProp.define('myApp:lineWidth', {\n\t *   defaultValue: 1,\n\t *   type: T.number,\n\t * })\n\t * ```\n\t * @public\n\t */\n\tstatic define<Type>(\n\t\tuniqueId: string,\n\t\toptions: { defaultValue: Type; type?: T.Validatable<Type> }\n\t) {\n\t\tconst { defaultValue, type = T.any } = options\n\t\treturn new StyleProp<Type>(uniqueId, defaultValue, type)\n\t}\n\n\t/**\n\t * Define a new {@link StyleProp} as a list of possible values.\n\t *\n\t * @param uniqueId - Each StyleProp must have a unique ID. We recommend you prefix this with\n\t * your app/library name.\n\t * @param options -\n\t * - `defaultValue`: The default value for this style prop.\n\t *\n\t * - `values`: An array of possible values of this style prop.\n\t *\n\t * @example\n\t * ```ts\n\t * import {StyleProp} from '@tldraw/tlschema'\n\t *\n\t * const MySizeProp = StyleProp.defineEnum('myApp:size', {\n\t *   defaultValue: 'medium',\n\t *   values: ['small', 'medium', 'large'],\n\t * })\n\t * ```\n\t */\n\tstatic defineEnum<const Values extends readonly unknown[]>(\n\t\tuniqueId: string,\n\t\toptions: { defaultValue: Values[number]; values: Values }\n\t) {\n\t\tconst { defaultValue, values } = options\n\t\treturn new EnumStyleProp<Values[number]>(uniqueId, defaultValue, values)\n\t}\n\n\t/** @internal */\n\tprotected constructor(\n\t\treadonly id: string,\n\t\treadonly defaultValue: Type,\n\t\treadonly type: T.Validatable<Type>\n\t) {}\n\n\tvalidate(value: unknown) {\n\t\treturn this.type.validate(value)\n\t}\n\n\tvalidateUsingKnownGoodVersion(prevValue: Type, newValue: unknown) {\n\t\tif (this.type.validateUsingKnownGoodVersion) {\n\t\t\treturn this.type.validateUsingKnownGoodVersion(prevValue, newValue)\n\t\t} else {\n\t\t\treturn this.validate(newValue)\n\t\t}\n\t}\n}\n\n/**\n * See {@link StyleProp} & {@link StyleProp.defineEnum}\n *\n * @public\n */\nexport class EnumStyleProp<T> extends StyleProp<T> {\n\t/** @internal */\n\tconstructor(\n\t\tid: string,\n\t\tdefaultValue: T,\n\t\treadonly values: readonly T[]\n\t) {\n\t\tsuper(id, defaultValue, T.literalEnum(...values))\n\t}\n}\n\n/**\n * @public\n */\nexport type StylePropValue<T extends StyleProp<any>> = T extends StyleProp<infer U> ? U : never\n", "import {\n\tMigration,\n\tMigrationId,\n\tMigrationSequence,\n\tRecordId,\n\tUnknownRecord,\n\tcreateMigrationIds,\n\tcreateMigrationSequence,\n\tcreateRecordMigrationSequence,\n\tcreateRecordType,\n} from '@tldraw/store'\nimport { assert, mapObjectMapValues } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { nanoid } from 'nanoid'\nimport { SchemaShapeInfo } from '../createTLSchema'\nimport { TLArrowShape } from '../shapes/TLArrowShape'\nimport { TLBaseShape, createShapeValidator } from '../shapes/TLBaseShape'\nimport { TLBookmarkShape } from '../shapes/TLBookmarkShape'\nimport { TLDrawShape } from '../shapes/TLDrawShape'\nimport { TLEmbedShape } from '../shapes/TLEmbedShape'\nimport { TLFrameShape } from '../shapes/TLFrameShape'\nimport { TLGeoShape } from '../shapes/TLGeoShape'\nimport { TLGroupShape } from '../shapes/TLGroupShape'\nimport { TLHighlightShape } from '../shapes/TLHighlightShape'\nimport { TLImageShape } from '../shapes/TLImageShape'\nimport { TLLineShape } from '../shapes/TLLineShape'\nimport { TLNoteShape } from '../shapes/TLNoteShape'\nimport { TLTextShape } from '../shapes/TLTextShape'\nimport { TLVideoShape } from '../shapes/TLVideoShape'\nimport { StyleProp } from '../styles/StyleProp'\nimport { TLPageId } from './TLPage'\n\n/**\n * The default set of shapes that are available in the editor.\n *\n * @public */\nexport type TLDefaultShape =\n\t| TLArrowShape\n\t| TLBookmarkShape\n\t| TLDrawShape\n\t| TLEmbedShape\n\t| TLFrameShape\n\t| TLGeoShape\n\t| TLGroupShape\n\t| TLImageShape\n\t| TLLineShape\n\t| TLNoteShape\n\t| TLTextShape\n\t| TLVideoShape\n\t| TLHighlightShape\n\n/**\n * A type for a shape that is available in the editor but whose type is\n * unknown\u2014either one of the editor's default shapes or else a custom shape.\n *\n * @public */\nexport type TLUnknownShape = TLBaseShape<string, object>\n\n/**\n * The set of all shapes that are available in the editor, including unknown shapes.\n *\n * @public\n */\nexport type TLShape = TLDefaultShape | TLUnknownShape\n\n/** @public */\nexport type TLShapePartial<T extends TLShape = TLShape> = T extends T\n\t? {\n\t\t\tid: TLShapeId\n\t\t\ttype: T['type']\n\t\t\tprops?: Partial<T['props']>\n\t\t\tmeta?: Partial<T['meta']>\n\t\t} & Partial<Omit<T, 'type' | 'id' | 'props' | 'meta'>>\n\t: never\n\n/** @public */\nexport type TLShapeId = RecordId<TLUnknownShape>\n\n// evil type shit that will get deleted in the next PR\ntype UnionToIntersection<U> = (U extends any ? (k: U) => void : never) extends (k: infer I) => void\n\t? I\n\t: never\n\ntype Identity<T> = { [K in keyof T]: T[K] }\n\n/** @public */\nexport type TLShapeProps = Identity<UnionToIntersection<TLDefaultShape['props']>>\n\n/** @public */\nexport type TLShapeProp = keyof TLShapeProps\n\n/** @public */\nexport type TLParentId = TLPageId | TLShapeId\n\n/** @public */\nexport const rootShapeVersions = createMigrationIds('com.tldraw.shape', {\n\tAddIsLocked: 1,\n\tHoistOpacity: 2,\n\tAddMeta: 3,\n\tAddWhite: 4,\n} as const)\n\n/** @public */\nexport const rootShapeMigrations = createRecordMigrationSequence({\n\tsequenceId: 'com.tldraw.shape',\n\trecordType: 'shape',\n\tsequence: [\n\t\t{\n\t\t\tid: rootShapeVersions.AddIsLocked,\n\t\t\tup: (record: any) => {\n\t\t\t\trecord.isLocked = false\n\t\t\t},\n\t\t\tdown: (record: any) => {\n\t\t\t\tdelete record.isLocked\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: rootShapeVersions.HoistOpacity,\n\t\t\tup: (record: any) => {\n\t\t\t\trecord.opacity = Number(record.props.opacity ?? '1')\n\t\t\t\tdelete record.props.opacity\n\t\t\t},\n\t\t\tdown: (record: any) => {\n\t\t\t\tconst opacity = record.opacity\n\t\t\t\tdelete record.opacity\n\t\t\t\trecord.props.opacity =\n\t\t\t\t\topacity < 0.175\n\t\t\t\t\t\t? '0.1'\n\t\t\t\t\t\t: opacity < 0.375\n\t\t\t\t\t\t\t? '0.25'\n\t\t\t\t\t\t\t: opacity < 0.625\n\t\t\t\t\t\t\t\t? '0.5'\n\t\t\t\t\t\t\t\t: opacity < 0.875\n\t\t\t\t\t\t\t\t\t? '0.75'\n\t\t\t\t\t\t\t\t\t: '1'\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: rootShapeVersions.AddMeta,\n\t\t\tup: (record: any) => {\n\t\t\t\trecord.meta = {}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: rootShapeVersions.AddWhite,\n\t\t\tup: (_record) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t\tdown: (record: any) => {\n\t\t\t\tif (record.props.color === 'white') {\n\t\t\t\t\trecord.props.color = 'black'\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t],\n})\n\n/** @public */\nexport function isShape(record?: UnknownRecord): record is TLShape {\n\tif (!record) return false\n\treturn record.typeName === 'shape'\n}\n\n/** @public */\nexport function isShapeId(id?: string): id is TLShapeId {\n\tif (!id) return false\n\treturn id.startsWith('shape:')\n}\n\n/** @public */\nexport function createShapeId(id?: string): TLShapeId {\n\treturn `shape:${id ?? nanoid()}` as TLShapeId\n}\n\n/** @internal */\nexport function getShapePropKeysByStyle(props: Record<string, T.Validatable<any>>) {\n\tconst propKeysByStyle = new Map<StyleProp<unknown>, string>()\n\tfor (const [key, prop] of Object.entries(props)) {\n\t\tif (prop instanceof StyleProp) {\n\t\t\tif (propKeysByStyle.has(prop)) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`Duplicate style prop ${prop.id}. Each style prop can only be used once within a shape.`\n\t\t\t\t)\n\t\t\t}\n\t\t\tpropKeysByStyle.set(prop, key)\n\t\t}\n\t}\n\treturn propKeysByStyle\n}\n\nexport const NO_DOWN_MIGRATION = 'none' as const\n// If a down migration was deployed more than a couple of months ago it should be safe to retire it.\n// We only really need them to smooth over the transition between versions, and some folks do keep\n// browser tabs open for months without refreshing, but at a certain point that kind of behavior is\n// on them. Plus anyway recently chrome has started to actually kill tabs that are open for too long rather\n// than just suspending them, so if other browsers follow suit maybe it's less of a concern.\nexport const RETIRED_DOWN_MIGRATION = 'retired' as const\n\n/**\n * @public\n */\nexport type TLShapePropsMigrations = {\n\tsequence: Array<\n\t\t| { readonly dependsOn: readonly MigrationId[] }\n\t\t| {\n\t\t\t\treadonly id: MigrationId\n\t\t\t\treadonly dependsOn?: MigrationId[]\n\t\t\t\treadonly up: (props: any) => any\n\t\t\t\treadonly down?:\n\t\t\t\t\t| typeof NO_DOWN_MIGRATION\n\t\t\t\t\t| typeof RETIRED_DOWN_MIGRATION\n\t\t\t\t\t| ((props: any) => any)\n\t\t  }\n\t>\n}\n\n/**\n * @public\n */\nexport function createShapePropsMigrationSequence(\n\tmigrations: TLShapePropsMigrations\n): TLShapePropsMigrations {\n\treturn migrations\n}\n\n/**\n * @public\n */\nexport function createShapePropsMigrationIds<S extends string, T extends Record<string, number>>(\n\tshapeType: S,\n\tids: T\n): { [k in keyof T]: `com.tldraw.shape.${S}/${T[k]}` } {\n\treturn mapObjectMapValues(ids, (_k, v) => `com.tldraw.shape.${shapeType}/${v}`) as any\n}\n\nexport function processShapeMigrations(shapes: Record<string, SchemaShapeInfo>) {\n\tconst result: MigrationSequence[] = []\n\n\tfor (const [shapeType, { migrations }] of Object.entries(shapes)) {\n\t\tconst sequenceId = `com.tldraw.shape.${shapeType}`\n\t\tif (!migrations) {\n\t\t\t// provide empty migrations sequence to allow for future migrations\n\t\t\tresult.push(\n\t\t\t\tcreateMigrationSequence({\n\t\t\t\t\tsequenceId,\n\t\t\t\t\tretroactive: false,\n\t\t\t\t\tsequence: [],\n\t\t\t\t})\n\t\t\t)\n\t\t} else if ('sequenceId' in migrations) {\n\t\t\tassert(\n\t\t\t\tsequenceId === migrations.sequenceId,\n\t\t\t\t`sequenceId mismatch for ${shapeType} shape migrations. Expected '${sequenceId}', got '${migrations.sequenceId}'`\n\t\t\t)\n\t\t\tresult.push(migrations)\n\t\t} else if ('sequence' in migrations) {\n\t\t\tresult.push(\n\t\t\t\tcreateMigrationSequence({\n\t\t\t\t\tsequenceId,\n\t\t\t\t\tretroactive: false,\n\t\t\t\t\tsequence: migrations.sequence.map((m) =>\n\t\t\t\t\t\t'id' in m\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tid: m.id,\n\t\t\t\t\t\t\t\t\tscope: 'record',\n\t\t\t\t\t\t\t\t\tfilter: (r) => r.typeName === 'shape' && (r as TLShape).type === shapeType,\n\t\t\t\t\t\t\t\t\tdependsOn: m.dependsOn,\n\t\t\t\t\t\t\t\t\tup: (record: any) => {\n\t\t\t\t\t\t\t\t\t\tconst result = m.up(record.props)\n\t\t\t\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\t\t\t\trecord.props = result\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdown:\n\t\t\t\t\t\t\t\t\t\ttypeof m.down === 'function'\n\t\t\t\t\t\t\t\t\t\t\t? (record: any) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst result = (m.down as (props: any) => any)(record.props)\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trecord.props = result\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: m\n\t\t\t\t\t),\n\t\t\t\t})\n\t\t\t)\n\t\t} else {\n\t\t\t// legacy migrations, will be removed in the future\n\t\t\tresult.push(\n\t\t\t\tcreateMigrationSequence({\n\t\t\t\t\tsequenceId,\n\t\t\t\t\tretroactive: false,\n\t\t\t\t\tsequence: Object.keys(migrations.migrators)\n\t\t\t\t\t\t.map((k) => Number(k))\n\t\t\t\t\t\t.sort((a: number, b: number) => a - b)\n\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t(version): Migration => ({\n\t\t\t\t\t\t\t\tid: `${sequenceId}/${version}`,\n\t\t\t\t\t\t\t\tscope: 'record',\n\t\t\t\t\t\t\t\tfilter: (r) => r.typeName === 'shape' && (r as TLShape).type === shapeType,\n\t\t\t\t\t\t\t\tup: (record: any) => {\n\t\t\t\t\t\t\t\t\tconst result = migrations.migrators[version].up(record)\n\t\t\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\t\t\treturn result\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdown: (record: any) => {\n\t\t\t\t\t\t\t\t\tconst result = migrations.migrators[version].down(record)\n\t\t\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\t\t\treturn result\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t),\n\t\t\t\t})\n\t\t\t)\n\t\t}\n\t}\n\n\treturn result\n}\n\n/** @internal */\nexport function createShapeRecordType(shapes: Record<string, SchemaShapeInfo>) {\n\treturn createRecordType<TLShape>('shape', {\n\t\tscope: 'document',\n\t\tvalidator: T.model(\n\t\t\t'shape',\n\t\t\tT.union(\n\t\t\t\t'type',\n\t\t\t\tmapObjectMapValues(shapes, (type, { props, meta }) =>\n\t\t\t\t\tcreateShapeValidator(type, props, meta)\n\t\t\t\t)\n\t\t\t)\n\t\t),\n\t}).withDefaultProperties(() => ({\n\t\tx: 0,\n\t\ty: 0,\n\t\trotation: 0,\n\t\tisLocked: false,\n\t\topacity: 1,\n\t\tmeta: {},\n\t}))\n}\n", "import { Expand } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { StyleProp } from './StyleProp'\n\nconst colors = [\n\t'black',\n\t'grey',\n\t'light-violet',\n\t'violet',\n\t'blue',\n\t'light-blue',\n\t'yellow',\n\t'orange',\n\t'green',\n\t'light-green',\n\t'light-red',\n\t'red',\n\t'white',\n] as const\n\n/** @public */\nexport type TLDefaultColorThemeColor = {\n\tsolid: string\n\tsemi: string\n\tpattern: string\n\tnote: {\n\t\tfill: string\n\t\ttext: string\n\t}\n\thighlight: {\n\t\tsrgb: string\n\t\tp3: string\n\t}\n}\n\n/** @public */\nexport type TLDefaultColorTheme = Expand<\n\t{\n\t\tid: 'light' | 'dark'\n\t\ttext: string\n\t\tbackground: string\n\t\tsolid: string\n\t} & Record<(typeof colors)[number], TLDefaultColorThemeColor>\n>\n\n/** @public */\nexport const DefaultColorThemePalette: {\n\tlightMode: TLDefaultColorTheme\n\tdarkMode: TLDefaultColorTheme\n} = {\n\tlightMode: {\n\t\tid: 'light',\n\t\ttext: '#000000',\n\t\tbackground: 'rgb(249, 250, 251)',\n\t\tsolid: '#fcfffe',\n\t\tblack: {\n\t\t\tsolid: '#1d1d1d',\n\t\t\tnote: {\n\t\t\t\tfill: '#FCE19C',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#e8e8e8',\n\t\t\tpattern: '#494949',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#fddd00',\n\t\t\t\tp3: 'color(display-p3 0.972 0.8705 0.05)',\n\t\t\t},\n\t\t},\n\t\tblue: {\n\t\t\tsolid: '#4465e9',\n\t\t\tnote: {\n\t\t\t\tfill: '#8AA3FF',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#dce1f8',\n\t\t\tpattern: '#6681ee',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#10acff',\n\t\t\t\tp3: 'color(display-p3 0.308 0.6632 0.9996)',\n\t\t\t},\n\t\t},\n\t\tgreen: {\n\t\t\tsolid: '#099268',\n\t\t\tnote: {\n\t\t\t\tfill: '#6FC896',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#d3e9e3',\n\t\t\tpattern: '#39a785',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#00ffc8',\n\t\t\t\tp3: 'color(display-p3 0.2536 0.984 0.7981)',\n\t\t\t},\n\t\t},\n\t\tgrey: {\n\t\t\tsolid: '#9fa8b2',\n\t\t\tnote: {\n\t\t\t\tfill: '#C0CAD3',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#eceef0',\n\t\t\tpattern: '#bcc3c9',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#cbe7f1',\n\t\t\t\tp3: 'color(display-p3 0.8163 0.9023 0.9416)',\n\t\t\t},\n\t\t},\n\t\t'light-blue': {\n\t\t\tsolid: '#4ba1f1',\n\t\t\tnote: {\n\t\t\t\tfill: '#9BC4FD',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#ddedfa',\n\t\t\tpattern: '#6fbbf8',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#00f4ff',\n\t\t\t\tp3: 'color(display-p3 0.1512 0.9414 0.9996)',\n\t\t\t},\n\t\t},\n\t\t'light-green': {\n\t\t\tsolid: '#4cb05e',\n\t\t\tnote: {\n\t\t\t\tfill: '#98D08A',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#dbf0e0',\n\t\t\tpattern: '#65cb78',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#65f641',\n\t\t\t\tp3: 'color(display-p3 0.563 0.9495 0.3857)',\n\t\t\t},\n\t\t},\n\t\t'light-red': {\n\t\t\tsolid: '#f87777',\n\t\t\tnote: {\n\t\t\t\tfill: '#F7A5A1',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#f4dadb',\n\t\t\tpattern: '#fe9e9e',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#ff7fa3',\n\t\t\t\tp3: 'color(display-p3 0.9988 0.5301 0.6397)',\n\t\t\t},\n\t\t},\n\t\t'light-violet': {\n\t\t\tsolid: '#e085f4',\n\t\t\tnote: {\n\t\t\t\tfill: '#DFB0F9',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#f5eafa',\n\t\t\tpattern: '#e9acf8',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#ff88ff',\n\t\t\t\tp3: 'color(display-p3 0.9676 0.5652 0.9999)',\n\t\t\t},\n\t\t},\n\t\torange: {\n\t\t\tsolid: '#e16919',\n\t\t\tnote: {\n\t\t\t\tfill: '#FAA475',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#f8e2d4',\n\t\t\tpattern: '#f78438',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#ffa500',\n\t\t\t\tp3: 'color(display-p3 0.9988 0.6905 0.266)',\n\t\t\t},\n\t\t},\n\t\tred: {\n\t\t\tsolid: '#e03131',\n\t\t\tnote: {\n\t\t\t\tfill: '#FC8282',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#f4dadb',\n\t\t\tpattern: '#e55959',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#ff636e',\n\t\t\t\tp3: 'color(display-p3 0.9992 0.4376 0.45)',\n\t\t\t},\n\t\t},\n\t\tviolet: {\n\t\t\tsolid: '#ae3ec9',\n\t\t\tnote: {\n\t\t\t\tfill: '#DB91FD',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#ecdcf2',\n\t\t\tpattern: '#bd63d3',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#c77cff',\n\t\t\t\tp3: 'color(display-p3 0.7469 0.5089 0.9995)',\n\t\t\t},\n\t\t},\n\t\tyellow: {\n\t\t\tsolid: '#f1ac4b',\n\t\t\tnote: {\n\t\t\t\tfill: '#FED49A',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\tsemi: '#f9f0e6',\n\t\t\tpattern: '#fecb92',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#fddd00',\n\t\t\t\tp3: 'color(display-p3 0.972 0.8705 0.05)',\n\t\t\t},\n\t\t},\n\t\twhite: {\n\t\t\tsolid: '#FFFFFF',\n\t\t\tsemi: '#f5f5f5',\n\t\t\tpattern: '#f9f9f9',\n\t\t\tnote: {\n\t\t\t\tfill: '#FFFFFF',\n\t\t\t\ttext: '#000000',\n\t\t\t},\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#ffffff',\n\t\t\t\tp3: 'color(display-p3 1 1 1)',\n\t\t\t},\n\t\t},\n\t},\n\tdarkMode: {\n\t\tid: 'dark',\n\t\ttext: 'hsl(210, 17%, 98%)',\n\t\tbackground: 'hsl(240, 5%, 6.5%)',\n\t\tsolid: '#010403',\n\n\t\tblack: {\n\t\t\tsolid: '#f2f2f2',\n\t\t\tnote: {\n\t\t\t\tfill: '#2c2c2c',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#2c3036',\n\t\t\tpattern: '#989898',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#d2b700',\n\t\t\t\tp3: 'color(display-p3 0.8078 0.7225 0.0312)',\n\t\t\t},\n\t\t},\n\t\tblue: {\n\t\t\tsolid: '#4f72fc', // 3c60f0\n\t\t\tnote: {\n\t\t\t\tfill: '#2A3F98',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#262d40',\n\t\t\tpattern: '#3a4b9e',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#0079d2',\n\t\t\t\tp3: 'color(display-p3 0.0032 0.4655 0.7991)',\n\t\t\t},\n\t\t},\n\t\tgreen: {\n\t\t\tsolid: '#099268',\n\t\t\tnote: {\n\t\t\t\tfill: '#014429',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#253231',\n\t\t\tpattern: '#366a53',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#009774',\n\t\t\t\tp3: 'color(display-p3 0.0085 0.582 0.4604)',\n\t\t\t},\n\t\t},\n\t\tgrey: {\n\t\t\tsolid: '#9398b0',\n\t\t\tnote: {\n\t\t\t\tfill: '#56595F',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#33373c',\n\t\t\tpattern: '#7c8187',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#9cb4cb',\n\t\t\t\tp3: 'color(display-p3 0.6299 0.7012 0.7856)',\n\t\t\t},\n\t\t},\n\t\t'light-blue': {\n\t\t\tsolid: '#4dabf7',\n\t\t\tnote: {\n\t\t\t\tfill: '#1F5495',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#2a3642',\n\t\t\tpattern: '#4d7aa9',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#00bdc8',\n\t\t\t\tp3: 'color(display-p3 0.0023 0.7259 0.7735)',\n\t\t\t},\n\t\t},\n\t\t'light-green': {\n\t\t\tsolid: '#40c057',\n\t\t\tnote: {\n\t\t\t\tfill: '#21581D',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#2a3830',\n\t\t\tpattern: '#4e874e',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#00a000',\n\t\t\t\tp3: 'color(display-p3 0.2711 0.6172 0.0195)',\n\t\t\t},\n\t\t},\n\t\t'light-red': {\n\t\t\tsolid: '#ff8787',\n\t\t\tnote: {\n\t\t\t\tfill: '#923632',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#3b3235',\n\t\t\tpattern: '#a56767',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#db005b',\n\t\t\t\tp3: 'color(display-p3 0.7849 0.0585 0.3589)',\n\t\t\t},\n\t\t},\n\t\t'light-violet': {\n\t\t\tsolid: '#e599f7',\n\t\t\tnote: {\n\t\t\t\tfill: '#762F8E',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#383442',\n\t\t\tpattern: '#9770a9',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#c400c7',\n\t\t\t\tp3: 'color(display-p3 0.7024 0.0403 0.753)',\n\t\t\t},\n\t\t},\n\t\torange: {\n\t\t\tsolid: '#f76707',\n\t\t\tnote: {\n\t\t\t\tfill: '#843906',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#3a2e2a',\n\t\t\tpattern: '#9f552d',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#d07a00',\n\t\t\t\tp3: 'color(display-p3 0.7699 0.4937 0.0085)',\n\t\t\t},\n\t\t},\n\t\tred: {\n\t\t\tsolid: '#e03131',\n\t\t\tnote: {\n\t\t\t\tfill: '#89231A',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#36292b',\n\t\t\tpattern: '#8f3734',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#de002c',\n\t\t\t\tp3: 'color(display-p3 0.7978 0.0509 0.2035)',\n\t\t\t},\n\t\t},\n\t\tviolet: {\n\t\t\tsolid: '#ae3ec9',\n\t\t\tnote: {\n\t\t\t\tfill: '#681683',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#31293c',\n\t\t\tpattern: '#763a8b',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#9e00ee',\n\t\t\t\tp3: 'color(display-p3 0.5651 0.0079 0.8986)',\n\t\t\t},\n\t\t},\n\t\tyellow: {\n\t\t\tsolid: '#ffc034',\n\t\t\tnote: {\n\t\t\t\tfill: '#98571B',\n\t\t\t\ttext: '#f2f2f2',\n\t\t\t},\n\t\t\tsemi: '#3c3934',\n\t\t\tpattern: '#fecb92',\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#d2b700',\n\t\t\t\tp3: 'color(display-p3 0.8078 0.7225 0.0312)',\n\t\t\t},\n\t\t},\n\t\twhite: {\n\t\t\tsolid: '#f3f3f3',\n\t\t\tsemi: '#f5f5f5',\n\t\t\tpattern: '#f9f9f9',\n\t\t\tnote: {\n\t\t\t\tfill: '#eaeaea',\n\t\t\t\ttext: '#1d1d1d',\n\t\t\t},\n\t\t\thighlight: {\n\t\t\t\tsrgb: '#ffffff',\n\t\t\t\tp3: 'color(display-p3 1 1 1)',\n\t\t\t},\n\t\t},\n\t},\n}\n\n/** @public */\nexport function getDefaultColorTheme(opts: { isDarkMode: boolean }): TLDefaultColorTheme {\n\treturn opts.isDarkMode ? DefaultColorThemePalette.darkMode : DefaultColorThemePalette.lightMode\n}\n\n/** @public */\nexport const DefaultColorStyle = StyleProp.defineEnum('tldraw:color', {\n\tdefaultValue: 'black',\n\tvalues: colors,\n})\n\n/** @public */\nexport const DefaultLabelColorStyle = StyleProp.defineEnum('tldraw:labelColor', {\n\tdefaultValue: 'black',\n\tvalues: colors,\n})\n\n/** @public */\nexport type TLDefaultColorStyle = T.TypeOf<typeof DefaultColorStyle>\n", "import { T } from '@tldraw/validate'\nimport { StyleProp } from './StyleProp'\n\n/** @public */\nexport const DefaultDashStyle = StyleProp.defineEnum('tldraw:dash', {\n\tdefaultValue: 'draw',\n\tvalues: ['draw', 'solid', 'dashed', 'dotted'],\n})\n\n/** @public */\nexport type TLDefaultDashStyle = T.TypeOf<typeof DefaultDashStyle>\n", "import { T } from '@tldraw/validate'\nimport { StyleProp } from './StyleProp'\n\n/** @public */\nexport const DefaultFillStyle = StyleProp.defineEnum('tldraw:fill', {\n\tdefaultValue: 'none',\n\tvalues: ['none', 'semi', 'solid', 'pattern'],\n})\n\n/** @public */\nexport type TLDefaultFillStyle = T.TypeOf<typeof DefaultFillStyle>\n", "import { T } from '@tldraw/validate'\nimport { StyleProp } from './StyleProp'\n\n/** @public */\nexport const DefaultFontStyle = StyleProp.defineEnum('tldraw:font', {\n\tdefaultValue: 'draw',\n\tvalues: ['draw', 'sans', 'serif', 'mono'],\n})\n\n/** @public */\nexport type TLDefaultFontStyle = T.TypeOf<typeof DefaultFontStyle>\n\n/** @public */\nexport const DefaultFontFamilies = {\n\tdraw: \"'tldraw_draw', sans-serif\",\n\tsans: \"'tldraw_sans', sans-serif\",\n\tserif: \"'tldraw_serif', serif\",\n\tmono: \"'tldraw_mono', monospace\",\n}\n", "import { T } from '@tldraw/validate'\nimport { StyleProp } from './StyleProp'\n\n/** @public */\nexport const DefaultSizeStyle = StyleProp.defineEnum('tldraw:size', {\n\tdefaultValue: 'm',\n\tvalues: ['s', 'm', 'l', 'xl'],\n})\n\n/** @public */\nexport type TLDefaultSizeStyle = T.TypeOf<typeof DefaultSizeStyle>\n", "import { T } from '@tldraw/validate'\nimport { vecModelValidator } from '../misc/geometry-types'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { StyleProp } from '../styles/StyleProp'\nimport { DefaultColorStyle, DefaultLabelColorStyle } from '../styles/TLColorStyle'\nimport { DefaultDashStyle } from '../styles/TLDashStyle'\nimport { DefaultFillStyle } from '../styles/TLFillStyle'\nimport { DefaultFontStyle } from '../styles/TLFontStyle'\nimport { DefaultSizeStyle } from '../styles/TLSizeStyle'\nimport { ShapePropsType, TLBaseShape, shapeIdValidator } from './TLBaseShape'\n\nconst arrowheadTypes = [\n\t'arrow',\n\t'triangle',\n\t'square',\n\t'dot',\n\t'pipe',\n\t'diamond',\n\t'inverted',\n\t'bar',\n\t'none',\n] as const\n\n/** @public */\nexport const ArrowShapeArrowheadStartStyle = StyleProp.defineEnum('tldraw:arrowheadStart', {\n\tdefaultValue: 'none',\n\tvalues: arrowheadTypes,\n})\n\n/** @public */\nexport const ArrowShapeArrowheadEndStyle = StyleProp.defineEnum('tldraw:arrowheadEnd', {\n\tdefaultValue: 'arrow',\n\tvalues: arrowheadTypes,\n})\n\n/** @public */\nexport type TLArrowShapeArrowheadStyle = T.TypeOf<typeof ArrowShapeArrowheadStartStyle>\n\n/** @public */\nconst ArrowShapeTerminal = T.union('type', {\n\tbinding: T.object({\n\t\ttype: T.literal('binding'),\n\t\tboundShapeId: shapeIdValidator,\n\t\tnormalizedAnchor: vecModelValidator,\n\t\tisExact: T.boolean,\n\t\tisPrecise: T.boolean,\n\t}),\n\tpoint: T.object({\n\t\ttype: T.literal('point'),\n\t\tx: T.number,\n\t\ty: T.number,\n\t}),\n})\n\n/** @public */\nexport type TLArrowShapeTerminal = T.TypeOf<typeof ArrowShapeTerminal>\n\n/** @public */\nexport const arrowShapeProps = {\n\tlabelColor: DefaultLabelColorStyle,\n\tcolor: DefaultColorStyle,\n\tfill: DefaultFillStyle,\n\tdash: DefaultDashStyle,\n\tsize: DefaultSizeStyle,\n\tarrowheadStart: ArrowShapeArrowheadStartStyle,\n\tarrowheadEnd: ArrowShapeArrowheadEndStyle,\n\tfont: DefaultFontStyle,\n\tstart: ArrowShapeTerminal,\n\tend: ArrowShapeTerminal,\n\tbend: T.number,\n\ttext: T.string,\n\tlabelPosition: T.number,\n}\n\n/** @public */\nexport type TLArrowShapeProps = ShapePropsType<typeof arrowShapeProps>\n\n/** @public */\nexport type TLArrowShape = TLBaseShape<'arrow', TLArrowShapeProps>\n\nexport const arrowShapeVersions = createShapePropsMigrationIds('arrow', {\n\tAddLabelColor: 1,\n\tAddIsPrecise: 2,\n\tAddLabelPosition: 3,\n})\n\n/** @public */\nexport const arrowShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: arrowShapeVersions.AddLabelColor,\n\t\t\tup: (props) => {\n\t\t\t\tprops.labelColor = 'black'\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\n\t\t{\n\t\t\tid: arrowShapeVersions.AddIsPrecise,\n\t\t\tup: ({ start, end }) => {\n\t\t\t\tif (start.type === 'binding') {\n\t\t\t\t\tstart.isPrecise = !(start.normalizedAnchor.x === 0.5 && start.normalizedAnchor.y === 0.5)\n\t\t\t\t}\n\t\t\t\tif (end.type === 'binding') {\n\t\t\t\t\tend.isPrecise = !(end.normalizedAnchor.x === 0.5 && end.normalizedAnchor.y === 0.5)\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: ({ start, end }) => {\n\t\t\t\tif (start.type === 'binding') {\n\t\t\t\t\tif (!start.isPrecise) {\n\t\t\t\t\t\tstart.normalizedAnchor = { x: 0.5, y: 0.5 }\n\t\t\t\t\t}\n\t\t\t\t\tdelete start.isPrecise\n\t\t\t\t}\n\t\t\t\tif (end.type === 'binding') {\n\t\t\t\t\tif (!end.isPrecise) {\n\t\t\t\t\t\tend.normalizedAnchor = { x: 0.5, y: 0.5 }\n\t\t\t\t\t}\n\t\t\t\t\tdelete end.isPrecise\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\t\t{\n\t\t\tid: arrowShapeVersions.AddLabelPosition,\n\t\t\tup: (props) => {\n\t\t\t\tprops.labelPosition = 0.5\n\t\t\t},\n\t\t\tdown: (props) => {\n\t\t\t\tdelete props.labelPosition\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { T } from '@tldraw/validate'\nimport { assetIdValidator } from '../assets/TLBaseAsset'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport const bookmarkShapeProps = {\n\tw: T.nonZeroNumber,\n\th: T.nonZeroNumber,\n\tassetId: assetIdValidator.nullable(),\n\turl: T.linkUrl,\n}\n\n/** @public */\nexport type TLBookmarkShapeProps = ShapePropsType<typeof bookmarkShapeProps>\n\n/** @public */\nexport type TLBookmarkShape = TLBaseShape<'bookmark', TLBookmarkShapeProps>\n\nconst Versions = createShapePropsMigrationIds('bookmark', {\n\tNullAssetId: 1,\n\tMakeUrlsValid: 2,\n})\n\nexport { Versions as bookmarkShapeVersions }\n\n/** @public */\nexport const bookmarkShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.NullAssetId,\n\t\t\tup: (props) => {\n\t\t\t\tif (props.assetId === undefined) {\n\t\t\t\t\tprops.assetId = null\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.MakeUrlsValid,\n\t\t\tup: (props) => {\n\t\t\t\tif (!T.linkUrl.isValid(props.url)) {\n\t\t\t\t\tprops.url = ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (_props) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { T } from '@tldraw/validate'\nimport { vecModelValidator } from '../misc/geometry-types'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { DefaultColorStyle } from '../styles/TLColorStyle'\nimport { DefaultDashStyle } from '../styles/TLDashStyle'\nimport { DefaultFillStyle } from '../styles/TLFillStyle'\nimport { DefaultSizeStyle } from '../styles/TLSizeStyle'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\nexport const DrawShapeSegment = T.object({\n\ttype: T.literalEnum('free', 'straight'),\n\tpoints: T.arrayOf(vecModelValidator),\n})\n\n/** @public */\nexport type TLDrawShapeSegment = T.TypeOf<typeof DrawShapeSegment>\n\n/** @public */\nexport const drawShapeProps = {\n\tcolor: DefaultColorStyle,\n\tfill: DefaultFillStyle,\n\tdash: DefaultDashStyle,\n\tsize: DefaultSizeStyle,\n\tsegments: T.arrayOf(DrawShapeSegment),\n\tisComplete: T.boolean,\n\tisClosed: T.boolean,\n\tisPen: T.boolean,\n}\n\n/** @public */\nexport type TLDrawShapeProps = ShapePropsType<typeof drawShapeProps>\n\n/** @public */\nexport type TLDrawShape = TLBaseShape<'draw', TLDrawShapeProps>\n\nconst Versions = createShapePropsMigrationIds('draw', {\n\tAddInPen: 1,\n})\n\nexport { Versions as drawShapeVersions }\n\n/** @public */\nexport const drawShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.AddInPen,\n\t\t\tup: (props) => {\n\t\t\t\t// Rather than checking to see whether the shape is a pen at runtime,\n\t\t\t\t// from now on we're going to use the type of device reported to us\n\t\t\t\t// as well as the pressure data received; but for existing shapes we\n\t\t\t\t// need to check the pressure data to see if it's a pen or not.\n\n\t\t\t\tconst { points } = props.segments[0]\n\n\t\t\t\tif (points.length === 0) {\n\t\t\t\t\tprops.isPen = false\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tlet isPen = !(points[0].z === 0 || points[0].z === 0.5)\n\n\t\t\t\tif (points[1]) {\n\t\t\t\t\t// Double check if we have a second point (we probably should)\n\t\t\t\t\tisPen = isPen && !(points[1].z === 0 || points[1].z === 0.5)\n\t\t\t\t}\n\t\t\t\tprops.isPen = isPen\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t],\n})\n", "import { T } from '@tldraw/validate'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n// Only allow multiplayer embeds. If we add additional routes later for example '/help' this won't match\nconst TLDRAW_APP_RE = /(^\\/r\\/[^/]+\\/?$)/\n\nconst safeParseUrl = (url: string) => {\n\ttry {\n\t\treturn new URL(url)\n\t} catch (err) {\n\t\treturn\n\t}\n}\n\n/** @public */\nexport const EMBED_DEFINITIONS = [\n\t{\n\t\ttype: 'tldraw',\n\t\ttitle: 'tldraw',\n\t\thostnames: ['beta.tldraw.com', 'tldraw.com', 'localhost:3000'],\n\t\tminWidth: 300,\n\t\tminHeight: 300,\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\toverridePermissions: {\n\t\t\t'allow-top-navigation': true,\n\t\t},\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(TLDRAW_APP_RE)) {\n\t\t\t\treturn url\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(TLDRAW_APP_RE)) {\n\t\t\t\treturn url\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'figma',\n\t\ttitle: 'Figma',\n\t\thostnames: ['figma.com'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tif (\n\t\t\t\t!!url.match(\n\t\t\t\t\t// eslint-disable-next-line no-useless-escape\n\t\t\t\t\t/https:\\/\\/([\\w\\.-]+\\.)?figma.com\\/(file|proto)\\/([0-9a-zA-Z]{22,128})(?:\\/.*)?$/\n\t\t\t\t) &&\n\t\t\t\t!url.includes('figma.com/embed')\n\t\t\t) {\n\t\t\t\treturn `https://www.figma.com/embed?embed_host=share&url=${url}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/embed\\/?$/)) {\n\t\t\t\tconst outUrl = urlObj.searchParams.get('url')\n\t\t\t\tif (outUrl) {\n\t\t\t\t\treturn outUrl\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'google_maps',\n\t\ttitle: 'Google Maps',\n\t\thostnames: ['google.*'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tif (url.includes('/maps/')) {\n\t\t\t\tconst match = url.match(/@(.*),(.*),(.*)z/)\n\t\t\t\tlet result: string\n\t\t\t\tif (match) {\n\t\t\t\t\tconst [, lat, lng, z] = match\n\t\t\t\t\tconst host = new URL(url).host.replace('www.', '')\n\t\t\t\t\tresult = `https://${host}/maps/embed/v1/view?key=${process.env.NEXT_PUBLIC_GC_API_KEY}&center=${lat},${lng}&zoom=${z}`\n\t\t\t\t} else {\n\t\t\t\t\tresult = ''\n\t\t\t\t}\n\n\t\t\t\treturn result\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (!urlObj) return\n\n\t\t\tconst matches = urlObj.pathname.match(/^\\/maps\\/embed\\/v1\\/view\\/?$/)\n\t\t\tif (matches && urlObj.searchParams.has('center') && urlObj.searchParams.get('zoom')) {\n\t\t\t\tconst zoom = urlObj.searchParams.get('zoom')\n\t\t\t\tconst [lat, lon] = urlObj.searchParams.get('center')!.split(',')\n\t\t\t\treturn `https://www.google.com/maps/@${lat},${lon},${zoom}z`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'val_town',\n\t\ttitle: 'Val Town',\n\t\thostnames: ['val.town'],\n\t\tminWidth: 260,\n\t\tminHeight: 100,\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\t// e.g. extract \"steveruizok.mathFact\" from https://www.val.town/v/steveruizok.mathFact\n\t\t\tconst matches = urlObj && urlObj.pathname.match(/\\/v\\/([^/]+)\\/?/)\n\t\t\tif (matches) {\n\t\t\t\treturn `https://www.val.town/embed/${matches[1]}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\t// e.g. extract \"steveruizok.mathFact\" from https://www.val.town/v/steveruizok.mathFact\n\t\t\tconst matches = urlObj && urlObj.pathname.match(/\\/embed\\/([^/]+)\\/?/)\n\t\t\tif (matches) {\n\t\t\t\treturn `https://www.val.town/v/${matches[1]}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'codesandbox',\n\t\ttitle: 'CodeSandbox',\n\t\thostnames: ['codesandbox.io'],\n\t\tminWidth: 300,\n\t\tminHeight: 300,\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tconst matches = urlObj && urlObj.pathname.match(/\\/s\\/([^/]+)\\/?/)\n\t\t\tif (matches) {\n\t\t\t\treturn `https://codesandbox.io/embed/${matches[1]}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tconst matches = urlObj && urlObj.pathname.match(/\\/embed\\/([^/]+)\\/?/)\n\t\t\tif (matches) {\n\t\t\t\treturn `https://codesandbox.io/s/${matches[1]}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'codepen',\n\t\ttitle: 'Codepen',\n\t\thostnames: ['codepen.io'],\n\t\tminWidth: 300,\n\t\tminHeight: 300,\n\t\twidth: 520,\n\t\theight: 400,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst CODEPEN_URL_REGEXP = /https:\\/\\/codepen.io\\/([^/]+)\\/pen\\/([^/]+)/\n\t\t\tconst matches = url.match(CODEPEN_URL_REGEXP)\n\t\t\tif (matches) {\n\t\t\t\tconst [_, user, id] = matches\n\t\t\t\treturn `https://codepen.io/${user}/embed/${id}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst CODEPEN_EMBED_REGEXP = /https:\\/\\/codepen.io\\/([^/]+)\\/embed\\/([^/]+)/\n\t\t\tconst matches = url.match(CODEPEN_EMBED_REGEXP)\n\t\t\tif (matches) {\n\t\t\t\tconst [_, user, id] = matches\n\t\t\t\treturn `https://codepen.io/${user}/pen/${id}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'scratch',\n\t\ttitle: 'Scratch',\n\t\thostnames: ['scratch.mit.edu'],\n\t\twidth: 520,\n\t\theight: 400,\n\t\tdoesResize: false,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst SCRATCH_URL_REGEXP = /https?:\\/\\/scratch.mit.edu\\/projects\\/([^/]+)/\n\t\t\tconst matches = url.match(SCRATCH_URL_REGEXP)\n\t\t\tif (matches) {\n\t\t\t\tconst [_, id] = matches\n\t\t\t\treturn `https://scratch.mit.edu/projects/embed/${id}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst SCRATCH_EMBED_REGEXP = /https:\\/\\/scratch.mit.edu\\/projects\\/embed\\/([^/]+)/\n\t\t\tconst matches = url.match(SCRATCH_EMBED_REGEXP)\n\t\t\tif (matches) {\n\t\t\t\tconst [_, id] = matches\n\t\t\t\treturn `https://scratch.mit.edu/projects/${id}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'youtube',\n\t\ttitle: 'YouTube',\n\t\thostnames: ['*.youtube.com', 'youtube.com', 'youtu.be'],\n\t\twidth: 800,\n\t\theight: 450,\n\t\tdoesResize: true,\n\t\toverridePermissions: {\n\t\t\t'allow-presentation': true,\n\t\t},\n\t\tisAspectRatioLocked: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (!urlObj) return\n\n\t\t\tconst hostname = urlObj.hostname.replace(/^www./, '')\n\t\t\tif (hostname === 'youtu.be') {\n\t\t\t\tconst videoId = urlObj.pathname.split('/').filter(Boolean)[0]\n\t\t\t\treturn `https://www.youtube.com/embed/${videoId}`\n\t\t\t} else if (\n\t\t\t\t(hostname === 'youtube.com' || hostname === 'm.youtube.com') &&\n\t\t\t\turlObj.pathname.match(/^\\/watch/)\n\t\t\t) {\n\t\t\t\tconst videoId = urlObj.searchParams.get('v')\n\t\t\t\treturn `https://www.youtube.com/embed/${videoId}`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (!urlObj) return\n\n\t\t\tconst hostname = urlObj.hostname.replace(/^www./, '')\n\t\t\tif (hostname === 'youtube.com') {\n\t\t\t\tconst matches = urlObj.pathname.match(/^\\/embed\\/([^/]+)\\/?/)\n\t\t\t\tif (matches) {\n\t\t\t\t\treturn `https://www.youtube.com/watch?v=${matches[1]}`\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'google_calendar',\n\t\ttitle: 'Google Calendar',\n\t\thostnames: ['calendar.google.*'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tminWidth: 460,\n\t\tminHeight: 360,\n\t\tdoesResize: true,\n\t\tinstructionLink: 'https://support.google.com/calendar/answer/41207?hl=en',\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tconst cidQs = urlObj?.searchParams.get('cid')\n\n\t\t\tif (urlObj?.pathname.match(/\\/calendar\\/u\\/0/) && cidQs) {\n\t\t\t\turlObj.pathname = '/calendar/embed'\n\n\t\t\t\tconst keys = Array.from(urlObj.searchParams.keys())\n\t\t\t\tfor (const key of keys) {\n\t\t\t\t\turlObj.searchParams.delete(key)\n\t\t\t\t}\n\t\t\t\turlObj.searchParams.set('src', cidQs)\n\t\t\t\treturn urlObj.href\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tconst srcQs = urlObj?.searchParams.get('src')\n\n\t\t\tif (urlObj?.pathname.match(/\\/calendar\\/embed/) && srcQs) {\n\t\t\t\turlObj.pathname = '/calendar/u/0'\n\t\t\t\tconst keys = Array.from(urlObj.searchParams.keys())\n\t\t\t\tfor (const key of keys) {\n\t\t\t\t\turlObj.searchParams.delete(key)\n\t\t\t\t}\n\t\t\t\turlObj.searchParams.set('cid', srcQs)\n\t\t\t\treturn urlObj.href\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'google_slides',\n\t\ttitle: 'Google Slides',\n\t\thostnames: ['docs.google.*'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tminWidth: 460,\n\t\tminHeight: 360,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\n\t\t\tif (urlObj?.pathname.match(/^\\/presentation/) && urlObj?.pathname.match(/\\/pub\\/?$/)) {\n\t\t\t\turlObj.pathname = urlObj.pathname.replace(/\\/pub$/, '/embed')\n\t\t\t\tconst keys = Array.from(urlObj.searchParams.keys())\n\t\t\t\tfor (const key of keys) {\n\t\t\t\t\turlObj.searchParams.delete(key)\n\t\t\t\t}\n\t\t\t\treturn urlObj.href\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\n\t\t\tif (urlObj?.pathname.match(/^\\/presentation/) && urlObj?.pathname.match(/\\/embed\\/?$/)) {\n\t\t\t\turlObj.pathname = urlObj.pathname.replace(/\\/embed$/, '/pub')\n\t\t\t\tconst keys = Array.from(urlObj.searchParams.keys())\n\t\t\t\tfor (const key of keys) {\n\t\t\t\t\turlObj.searchParams.delete(key)\n\t\t\t\t}\n\t\t\t\treturn urlObj.href\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'github_gist',\n\t\ttitle: 'GitHub Gist',\n\t\thostnames: ['gist.github.com'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/\\/([^/]+)\\/([^/]+)/)) {\n\t\t\t\tif (!url.split('/').pop()) return\n\t\t\t\treturn url\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/\\/([^/]+)\\/([^/]+)/)) {\n\t\t\t\tif (!url.split('/').pop()) return\n\t\t\t\treturn url\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'replit',\n\t\ttitle: 'Replit',\n\t\thostnames: ['replit.com'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/\\/@([^/]+)\\/([^/]+)/)) {\n\t\t\t\treturn `${url}?embed=true`\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (\n\t\t\t\turlObj &&\n\t\t\t\turlObj.pathname.match(/\\/@([^/]+)\\/([^/]+)/) &&\n\t\t\t\turlObj.searchParams.has('embed')\n\t\t\t) {\n\t\t\t\turlObj.searchParams.delete('embed')\n\t\t\t\treturn urlObj.href\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'felt',\n\t\ttitle: 'Felt',\n\t\thostnames: ['felt.com'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/map\\//)) {\n\t\t\t\treturn urlObj.origin + '/embed' + urlObj.pathname\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/embed\\/map\\//)) {\n\t\t\t\turlObj.pathname = urlObj.pathname.replace(/^\\/embed/, '')\n\t\t\t\treturn urlObj.href\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'spotify',\n\t\ttitle: 'Spotify',\n\t\thostnames: ['open.spotify.com'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tminHeight: 500,\n\t\toverrideOutlineRadius: 12,\n\t\tdoesResize: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/(artist|album)\\//)) {\n\t\t\t\treturn urlObj.origin + '/embed' + urlObj.pathname\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/embed\\/(artist|album)\\//)) {\n\t\t\t\treturn urlObj.origin + urlObj.pathname.replace(/^\\/embed/, '')\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'vimeo',\n\t\ttitle: 'Vimeo',\n\t\thostnames: ['vimeo.com', 'player.vimeo.com'],\n\t\twidth: 640,\n\t\theight: 360,\n\t\tdoesResize: true,\n\t\tisAspectRatioLocked: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.hostname === 'vimeo.com') {\n\t\t\t\tif (urlObj.pathname.match(/^\\/[0-9]+/)) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t'https://player.vimeo.com/video/' + urlObj.pathname.split('/')[1] + '?title=0&byline=0'\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.hostname === 'player.vimeo.com') {\n\t\t\t\tconst matches = urlObj.pathname.match(/^\\/video\\/([^/]+)\\/?$/)\n\t\t\t\tif (matches) {\n\t\t\t\t\treturn 'https://vimeo.com/' + matches[1]\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'excalidraw',\n\t\ttitle: 'Excalidraw',\n\t\thostnames: ['excalidraw.com'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\tisAspectRatioLocked: true,\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.hash.match(/#room=/)) {\n\t\t\t\treturn url\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.hash.match(/#room=/)) {\n\t\t\t\treturn url\n\t\t\t}\n\t\t\treturn\n\t\t},\n\t},\n\t{\n\t\ttype: 'observable',\n\t\ttitle: 'Observable',\n\t\thostnames: ['observablehq.com'],\n\t\twidth: 720,\n\t\theight: 500,\n\t\tdoesResize: true,\n\t\tisAspectRatioLocked: false,\n\t\tbackgroundColor: '#fff',\n\t\ttoEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/@([^/]+)\\/([^/]+)\\/?$/)) {\n\t\t\t\treturn `${urlObj.origin}/embed${urlObj.pathname}?cell=*`\n\t\t\t}\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/d\\/([^/]+)\\/?$/)) {\n\t\t\t\tconst pathName = urlObj.pathname.replace(/^\\/d/, '')\n\t\t\t\treturn `${urlObj.origin}/embed${pathName}?cell=*`\n\t\t\t}\n\n\t\t\treturn\n\t\t},\n\t\tfromEmbedUrl: (url) => {\n\t\t\tconst urlObj = safeParseUrl(url)\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/embed\\/@([^/]+)\\/([^/]+)\\/?$/)) {\n\t\t\t\treturn `${urlObj.origin}${urlObj.pathname.replace('/embed', '')}#cell-*`\n\t\t\t}\n\t\t\tif (urlObj && urlObj.pathname.match(/^\\/embed\\/([^/]+)\\/?$/)) {\n\t\t\t\treturn `${urlObj.origin}${urlObj.pathname.replace('/embed', '/d')}#cell-*`\n\t\t\t}\n\n\t\t\treturn\n\t\t},\n\t},\n] as const satisfies readonly EmbedDefinition[]\n\n/**\n * Permissions with note inline from\n * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox\n *\n * @public\n */\nexport const embedShapePermissionDefaults = {\n\t// ========================================================================================\n\t// Disabled permissions\n\t// ========================================================================================\n\t// [MDN] Experimental: Allows for downloads to occur without a gesture from the user.\n\t// [REASON] Disabled because otherwise the <iframe/> trick the user on behalf of us to performing an action\n\t'allow-downloads-without-user-activation': false,\n\t// [MDN] Allows for downloads to occur with a gesture from the user.\n\t// [REASON] Disabled because otherwise the <iframe/> trick the user on behalf of us to performing an action\n\t'allow-downloads': false,\n\t// [MDN] Lets the resource open modal windows.\n\t// [REASON] The <iframe/> could 'window.prompt(\"Enter your tldraw password\")'\n\t'allow-modals': false,\n\t// [MDN] Lets the resource lock the screen orientation.\n\t// [REASON] Would interfer with tldraw interface\n\t'allow-orientation-lock': false,\n\t// [MDN] Lets the resource use the Pointer Lock API.\n\t// [REASON] Maybe we should allow this for games embeds (scratch/codepen/codesandbox)\n\t'allow-pointer-lock': false,\n\t// [MDN] Allows popups (such as window.open(), target=\"_blank\", or showModalDialog()). If this keyword is not used, the popup will silently fail to open.\n\t// [REASON] We shouldn't allow popups as a embed could pretend to be us by opening a mocked version of tldraw. This is very unobvious when it is performed as an action within out app\n\t'allow-popups': true,\n\t// [MDN] Lets the sandboxed document open new windows without those windows inheriting the sandboxing. For example, this can safely sandbox an advertisement without forcing the same restrictions upon the page the ad links to.\n\t// [REASON] We're alread disabling popups.\n\t'allow-popups-to-escape-sandbox': false,\n\t// [MDN] Lets the resource start a presentation session.\n\t// [REASON] Prevents embed from navigating away from tldraw and pretending to be us\n\t'allow-presentation': false,\n\t// [MDN] Experimental: Lets the resource request access to the parent's storage capabilities with the Storage Access API.\n\t// [REASON] We don't want anyone else to access our storage\n\t'allow-storage-access-by-user-activation': false,\n\t// [MDN] Lets the resource navigate the top-level browsing context (the one named _top).\n\t// [REASON] Prevents embed from navigating away from tldraw and pretending to be us\n\t'allow-top-navigation': false,\n\t// [MDN] Lets the resource navigate the top-level browsing context, but only if initiated by a user gesture.\n\t// [REASON] Prevents embed from navigating away from tldraw and pretending to be us\n\t'allow-top-navigation-by-user-activation': false,\n\t// ========================================================================================\n\t// Enabled permissions\n\t// ========================================================================================\n\t// [MDN] Lets the resource run scripts (but not create popup windows).\n\t'allow-scripts': true,\n\t// [MDN] If this token is not used, the resource is treated as being from a special origin that always fails the same-origin policy (potentially preventing access to data storage/cookies and some JavaScript APIs).\n\t'allow-same-origin': true,\n\t// [MDN] Allows the resource to submit forms. If this keyword is not used, form submission is blocked.\n\t'allow-forms': true,\n} as const\n\n/** @public */\nexport type TLEmbedShapePermissions = { [K in keyof typeof embedShapePermissionDefaults]?: boolean }\n\n/** @public */\nexport const embedShapeProps = {\n\tw: T.nonZeroNumber,\n\th: T.nonZeroNumber,\n\turl: T.string,\n}\n\n/** @public */\nexport type TLEmbedShapeProps = ShapePropsType<typeof embedShapeProps>\n\n/** @public */\nexport type TLEmbedShape = TLBaseShape<'embed', TLEmbedShapeProps>\n\n/** @public */\nexport type EmbedDefinition = {\n\treadonly type: string\n\treadonly title: string\n\treadonly hostnames: readonly string[]\n\treadonly minWidth?: number\n\treadonly minHeight?: number\n\treadonly width: number\n\treadonly height: number\n\treadonly doesResize: boolean\n\treadonly isAspectRatioLocked?: boolean\n\treadonly overridePermissions?: TLEmbedShapePermissions\n\treadonly instructionLink?: string\n\treadonly backgroundColor?: string\n\t// TODO: FIXME this is ugly be required because some embeds have their own border radius for example spotify embeds\n\treadonly overrideOutlineRadius?: number\n\treadonly toEmbedUrl: (url: string) => string | undefined\n\treadonly fromEmbedUrl: (url: string) => string | undefined\n}\n\nconst Versions = createShapePropsMigrationIds('embed', {\n\tGenOriginalUrlInEmbed: 1,\n\tRemoveDoesResize: 2,\n\tRemoveTmpOldUrl: 3,\n\tRemovePermissionOverrides: 4,\n})\n\nexport { Versions as embedShapeVersions }\n\n/** @public */\nexport const embedShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.GenOriginalUrlInEmbed,\n\t\t\t// add tmpOldUrl property\n\t\t\tup: (props) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst url = props.url\n\t\t\t\t\tconst host = new URL(url).host.replace('www.', '')\n\t\t\t\t\tlet originalUrl\n\t\t\t\t\tfor (const localEmbedDef of EMBED_DEFINITIONS) {\n\t\t\t\t\t\tif ((localEmbedDef as EmbedDefinition).hostnames.includes(host)) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\toriginalUrl = localEmbedDef.fromEmbedUrl(url)\n\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\tconsole.warn(err)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tprops.tmpOldUrl = props.url\n\t\t\t\t\tprops.url = originalUrl ?? ''\n\t\t\t\t} catch (e) {\n\t\t\t\t\tprops.url = ''\n\t\t\t\t\tprops.tmpOldUrl = props.url\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.RemoveDoesResize,\n\t\t\tup: (props) => {\n\t\t\t\tdelete props.doesResize\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.RemoveTmpOldUrl,\n\t\t\tup: (props) => {\n\t\t\t\tdelete props.tmpOldUrl\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.RemovePermissionOverrides,\n\t\t\tup: (props) => {\n\t\t\t\tdelete props.overridePermissions\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t],\n})\n", "import { T } from '@tldraw/validate'\nimport { createShapePropsMigrationSequence } from '../records/TLShape'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport const frameShapeProps = {\n\tw: T.nonZeroNumber,\n\th: T.nonZeroNumber,\n\tname: T.string,\n}\n\ntype TLFrameShapeProps = ShapePropsType<typeof frameShapeProps>\n\n/** @public */\nexport type TLFrameShape = TLBaseShape<'frame', TLFrameShapeProps>\n\n/** @public */\nexport const frameShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [],\n})\n", "import { T } from '@tldraw/validate'\nimport { StyleProp } from './StyleProp'\n\n/** @public */\nexport const DefaultHorizontalAlignStyle = StyleProp.defineEnum('tldraw:horizontalAlign', {\n\tdefaultValue: 'middle',\n\tvalues: ['start', 'middle', 'end', 'start-legacy', 'end-legacy', 'middle-legacy'],\n})\n\n/** @public */\nexport type TLDefaultHorizontalAlignStyle = T.TypeOf<typeof DefaultHorizontalAlignStyle>\n", "import { T } from '@tldraw/validate'\nimport { StyleProp } from './StyleProp'\n\n/** @public */\nexport const DefaultVerticalAlignStyle = StyleProp.defineEnum('tldraw:verticalAlign', {\n\tdefaultValue: 'middle',\n\tvalues: ['start', 'middle', 'end'],\n})\n\n/** @public */\nexport type TLDefaultVerticalAlignStyle = T.TypeOf<typeof DefaultVerticalAlignStyle>\n", "import { T } from '@tldraw/validate'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { StyleProp } from '../styles/StyleProp'\nimport { DefaultColorStyle, DefaultLabelColorStyle } from '../styles/TLColorStyle'\nimport { DefaultDashStyle } from '../styles/TLDashStyle'\nimport { DefaultFillStyle } from '../styles/TLFillStyle'\nimport { DefaultFontStyle } from '../styles/TLFontStyle'\nimport {\n\tDefaultHorizontalAlignStyle,\n\tTLDefaultHorizontalAlignStyle,\n} from '../styles/TLHorizontalAlignStyle'\nimport { DefaultSizeStyle } from '../styles/TLSizeStyle'\nimport { DefaultVerticalAlignStyle } from '../styles/TLVerticalAlignStyle'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport const GeoShapeGeoStyle = StyleProp.defineEnum('tldraw:geo', {\n\tdefaultValue: 'rectangle',\n\tvalues: [\n\t\t'cloud',\n\t\t'rectangle',\n\t\t'ellipse',\n\t\t'triangle',\n\t\t'diamond',\n\t\t'pentagon',\n\t\t'hexagon',\n\t\t'octagon',\n\t\t'star',\n\t\t'rhombus',\n\t\t'rhombus-2',\n\t\t'oval',\n\t\t'trapezoid',\n\t\t'arrow-right',\n\t\t'arrow-left',\n\t\t'arrow-up',\n\t\t'arrow-down',\n\t\t'x-box',\n\t\t'check-box',\n\t],\n})\n\n/** @public */\nexport type TLGeoShapeGeoStyle = T.TypeOf<typeof GeoShapeGeoStyle>\n\n/** @public */\nexport const geoShapeProps = {\n\tgeo: GeoShapeGeoStyle,\n\tlabelColor: DefaultLabelColorStyle,\n\tcolor: DefaultColorStyle,\n\tfill: DefaultFillStyle,\n\tdash: DefaultDashStyle,\n\tsize: DefaultSizeStyle,\n\tfont: DefaultFontStyle,\n\talign: DefaultHorizontalAlignStyle,\n\tverticalAlign: DefaultVerticalAlignStyle,\n\turl: T.linkUrl,\n\tw: T.nonZeroNumber,\n\th: T.nonZeroNumber,\n\tgrowY: T.positiveNumber,\n\ttext: T.string,\n}\n\n/** @public */\nexport type TLGeoShapeProps = ShapePropsType<typeof geoShapeProps>\n\n/** @public */\nexport type TLGeoShape = TLBaseShape<'geo', TLGeoShapeProps>\n\nconst geoShapeVersions = createShapePropsMigrationIds('geo', {\n\tAddUrlProp: 1,\n\tAddLabelColor: 2,\n\tRemoveJustify: 3,\n\tAddCheckBox: 4,\n\tAddVerticalAlign: 5,\n\tMigrateLegacyAlign: 6,\n\tAddCloud: 7,\n\tMakeUrlsValid: 8,\n})\n\nexport { geoShapeVersions as geoShapeVersions }\n\n/** @public */\nexport const geoShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: geoShapeVersions.AddUrlProp,\n\t\t\tup: (props) => {\n\t\t\t\tprops.url = ''\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: geoShapeVersions.AddLabelColor,\n\t\t\tup: (props) => {\n\t\t\t\tprops.labelColor = 'black'\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: geoShapeVersions.RemoveJustify,\n\t\t\tup: (props) => {\n\t\t\t\tif (props.align === 'justify') {\n\t\t\t\t\tprops.align = 'start'\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: geoShapeVersions.AddCheckBox,\n\t\t\tup: (_props) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: geoShapeVersions.AddVerticalAlign,\n\t\t\tup: (props) => {\n\t\t\t\tprops.verticalAlign = 'middle'\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: geoShapeVersions.MigrateLegacyAlign,\n\t\t\tup: (props) => {\n\t\t\t\tlet newAlign: TLDefaultHorizontalAlignStyle\n\t\t\t\tswitch (props.align) {\n\t\t\t\t\tcase 'start':\n\t\t\t\t\t\tnewAlign = 'start-legacy'\n\t\t\t\t\t\tbreak\n\t\t\t\t\tcase 'end':\n\t\t\t\t\t\tnewAlign = 'end-legacy'\n\t\t\t\t\t\tbreak\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tnewAlign = 'middle-legacy'\n\t\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tprops.align = newAlign\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: geoShapeVersions.AddCloud,\n\t\t\tup: (_props) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: geoShapeVersions.MakeUrlsValid,\n\t\t\tup: (props) => {\n\t\t\t\tif (!T.linkUrl.isValid(props.url)) {\n\t\t\t\t\tprops.url = ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (_props) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { createShapePropsMigrationSequence } from '../records/TLShape'\nimport { ShapeProps, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport type TLGroupShapeProps = { [key in never]: undefined }\n\n/** @public */\nexport type TLGroupShape = TLBaseShape<'group', TLGroupShapeProps>\n\n/** @public */\nexport const groupShapeProps: ShapeProps<TLGroupShape> = {}\n\n/** @public */\nexport const groupShapeMigrations = createShapePropsMigrationSequence({ sequence: [] })\n", "import { T } from '@tldraw/validate'\nimport { createShapePropsMigrationSequence } from '../records/TLShape'\nimport { DefaultColorStyle } from '../styles/TLColorStyle'\nimport { DefaultSizeStyle } from '../styles/TLSizeStyle'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\nimport { DrawShapeSegment } from './TLDrawShape'\n\n/** @public */\nexport const highlightShapeProps = {\n\tcolor: DefaultColorStyle,\n\tsize: DefaultSizeStyle,\n\tsegments: T.arrayOf(DrawShapeSegment),\n\tisComplete: T.boolean,\n\tisPen: T.boolean,\n}\n\n/** @public */\nexport type TLHighlightShapeProps = ShapePropsType<typeof highlightShapeProps>\n\n/** @public */\nexport type TLHighlightShape = TLBaseShape<'highlight', TLHighlightShapeProps>\n\n/** @public */\nexport const highlightShapeMigrations = createShapePropsMigrationSequence({ sequence: [] })\n", "import { T } from '@tldraw/validate'\nimport { assetIdValidator } from '../assets/TLBaseAsset'\nimport { vecModelValidator } from '../misc/geometry-types'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport const ImageShapeCrop = T.object({\n\ttopLeft: vecModelValidator,\n\tbottomRight: vecModelValidator,\n})\n/** @public */\nexport type TLImageShapeCrop = T.TypeOf<typeof ImageShapeCrop>\n\n/** @public */\nexport const imageShapeProps = {\n\tw: T.nonZeroNumber,\n\th: T.nonZeroNumber,\n\tplaying: T.boolean,\n\turl: T.linkUrl,\n\tassetId: assetIdValidator.nullable(),\n\tcrop: ImageShapeCrop.nullable(),\n}\n\n/** @public */\nexport type TLImageShapeProps = ShapePropsType<typeof imageShapeProps>\n\n/** @public */\nexport type TLImageShape = TLBaseShape<'image', TLImageShapeProps>\n\nconst Versions = createShapePropsMigrationIds('image', {\n\tAddUrlProp: 1,\n\tAddCropProp: 2,\n\tMakeUrlsValid: 3,\n})\n\nexport { Versions as imageShapeVersions }\n\n/** @public */\nexport const imageShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.AddUrlProp,\n\t\t\tup: (props) => {\n\t\t\t\tprops.url = ''\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.AddCropProp,\n\t\t\tup: (props) => {\n\t\t\t\tprops.crop = null\n\t\t\t},\n\t\t\tdown: (props) => {\n\t\t\t\tdelete props.crop\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: Versions.MakeUrlsValid,\n\t\t\tup: (props) => {\n\t\t\t\tif (!T.linkUrl.isValid(props.url)) {\n\t\t\t\t\tprops.url = ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (_props) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { IndexKey, getIndices, objectMapFromEntries, sortByIndex } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { StyleProp } from '../styles/StyleProp'\nimport { DefaultColorStyle } from '../styles/TLColorStyle'\nimport { DefaultDashStyle } from '../styles/TLDashStyle'\nimport { DefaultSizeStyle } from '../styles/TLSizeStyle'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport const LineShapeSplineStyle = StyleProp.defineEnum('tldraw:spline', {\n\tdefaultValue: 'line',\n\tvalues: ['cubic', 'line'],\n})\n\n/** @public */\nexport type TLLineShapeSplineStyle = T.TypeOf<typeof LineShapeSplineStyle>\n\nconst lineShapePointValidator = T.object({\n\tid: T.string,\n\tindex: T.indexKey,\n\tx: T.number,\n\ty: T.number,\n})\n\n/** @public */\nexport const lineShapeProps = {\n\tcolor: DefaultColorStyle,\n\tdash: DefaultDashStyle,\n\tsize: DefaultSizeStyle,\n\tspline: LineShapeSplineStyle,\n\tpoints: T.dict(T.string, lineShapePointValidator),\n}\n\n/** @public */\nexport type TLLineShapeProps = ShapePropsType<typeof lineShapeProps>\n\n/** @public */\nexport type TLLineShape = TLBaseShape<'line', TLLineShapeProps>\n\n/** @public */\nexport const lineShapeVersions = createShapePropsMigrationIds('line', {\n\tAddSnapHandles: 1,\n\tRemoveExtraHandleProps: 2,\n\tHandlesToPoints: 3,\n\tPointIndexIds: 4,\n})\n\n/** @public */\nexport const lineShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: lineShapeVersions.AddSnapHandles,\n\t\t\tup: (props) => {\n\t\t\t\tfor (const handle of Object.values(props.handles)) {\n\t\t\t\t\t;(handle as any).canSnap = true\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: lineShapeVersions.RemoveExtraHandleProps,\n\t\t\tup: (props) => {\n\t\t\t\tprops.handles = objectMapFromEntries(\n\t\t\t\t\tObject.values(props.handles).map((handle: any) => [\n\t\t\t\t\t\thandle.index,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx: handle.x,\n\t\t\t\t\t\t\ty: handle.y,\n\t\t\t\t\t\t},\n\t\t\t\t\t])\n\t\t\t\t)\n\t\t\t},\n\t\t\tdown: (props) => {\n\t\t\t\tconst handles = Object.entries(props.handles)\n\t\t\t\t\t.map(([index, handle]: any) => ({ index, ...handle }))\n\t\t\t\t\t.sort(sortByIndex)\n\t\t\t\tprops.handles = Object.fromEntries(\n\t\t\t\t\thandles.map((handle, i) => {\n\t\t\t\t\t\tconst id =\n\t\t\t\t\t\t\ti === 0 ? 'start' : i === handles.length - 1 ? 'end' : `handle:${handle.index}`\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\ttype: 'vertex',\n\t\t\t\t\t\t\t\tcanBind: false,\n\t\t\t\t\t\t\t\tcanSnap: true,\n\t\t\t\t\t\t\t\tindex: handle.index,\n\t\t\t\t\t\t\t\tx: handle.x,\n\t\t\t\t\t\t\t\ty: handle.y,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t]\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: lineShapeVersions.HandlesToPoints,\n\t\t\tup: (props) => {\n\t\t\t\tconst sortedHandles = (\n\t\t\t\t\tObject.entries(props.handles) as [IndexKey, { x: number; y: number }][]\n\t\t\t\t)\n\t\t\t\t\t.map(([index, { x, y }]) => ({ x, y, index }))\n\t\t\t\t\t.sort(sortByIndex)\n\n\t\t\t\tprops.points = sortedHandles.map(({ x, y }) => ({ x, y }))\n\t\t\t\tdelete props.handles\n\t\t\t},\n\t\t\tdown: (props) => {\n\t\t\t\tconst indices = getIndices(props.points.length)\n\n\t\t\t\tprops.handles = Object.fromEntries(\n\t\t\t\t\tprops.points.map((handle: { x: number; y: number }, i: number) => {\n\t\t\t\t\t\tconst index = indices[i]\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tx: handle.x,\n\t\t\t\t\t\t\t\ty: handle.y,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t]\n\t\t\t\t\t})\n\t\t\t\t)\n\n\t\t\t\tdelete props.points\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: lineShapeVersions.PointIndexIds,\n\t\t\tup: (props) => {\n\t\t\t\tconst indices = getIndices(props.points.length)\n\n\t\t\t\tprops.points = Object.fromEntries(\n\t\t\t\t\tprops.points.map((point: { x: number; y: number }, i: number) => {\n\t\t\t\t\t\tconst id = indices[i]\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\tindex: id,\n\t\t\t\t\t\t\t\tx: point.x,\n\t\t\t\t\t\t\t\ty: point.y,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t]\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t},\n\t\t\tdown: (props) => {\n\t\t\t\tconst sortedHandles = (\n\t\t\t\t\tObject.values(props.points) as { x: number; y: number; index: IndexKey }[]\n\t\t\t\t).sort(sortByIndex)\n\n\t\t\t\tprops.points = sortedHandles.map(({ x, y }) => ({ x, y }))\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { T } from '@tldraw/validate'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { DefaultColorStyle } from '../styles/TLColorStyle'\nimport { DefaultFontStyle } from '../styles/TLFontStyle'\nimport { DefaultHorizontalAlignStyle } from '../styles/TLHorizontalAlignStyle'\nimport { DefaultSizeStyle } from '../styles/TLSizeStyle'\nimport { DefaultVerticalAlignStyle } from '../styles/TLVerticalAlignStyle'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport const noteShapeProps = {\n\tcolor: DefaultColorStyle,\n\tsize: DefaultSizeStyle,\n\tfont: DefaultFontStyle,\n\tfontSizeAdjustment: T.positiveNumber,\n\talign: DefaultHorizontalAlignStyle,\n\tverticalAlign: DefaultVerticalAlignStyle,\n\tgrowY: T.positiveNumber,\n\turl: T.linkUrl,\n\ttext: T.string,\n}\n\n/** @public */\nexport type TLNoteShapeProps = ShapePropsType<typeof noteShapeProps>\n\n/** @public */\nexport type TLNoteShape = TLBaseShape<'note', TLNoteShapeProps>\n\nconst Versions = createShapePropsMigrationIds('note', {\n\tAddUrlProp: 1,\n\tRemoveJustify: 2,\n\tMigrateLegacyAlign: 3,\n\tAddVerticalAlign: 4,\n\tMakeUrlsValid: 5,\n\tAddFontSizeAdjustment: 6,\n})\n\nexport { Versions as noteShapeVersions }\n\n/** @public */\nexport const noteShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.AddUrlProp,\n\t\t\tup: (props) => {\n\t\t\t\tprops.url = ''\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.RemoveJustify,\n\t\t\tup: (props) => {\n\t\t\t\tif (props.align === 'justify') {\n\t\t\t\t\tprops.align = 'start'\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.MigrateLegacyAlign,\n\t\t\tup: (props) => {\n\t\t\t\tswitch (props.align) {\n\t\t\t\t\tcase 'start':\n\t\t\t\t\t\tprops.align = 'start-legacy'\n\t\t\t\t\t\treturn\n\t\t\t\t\tcase 'end':\n\t\t\t\t\t\tprops.align = 'end-legacy'\n\t\t\t\t\t\treturn\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tprops.align = 'middle-legacy'\n\t\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.AddVerticalAlign,\n\t\t\tup: (props) => {\n\t\t\t\tprops.verticalAlign = 'middle'\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.MakeUrlsValid,\n\t\t\tup: (props) => {\n\t\t\t\tif (!T.linkUrl.isValid(props.url)) {\n\t\t\t\t\tprops.url = ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (_props) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: Versions.AddFontSizeAdjustment,\n\t\t\tup: (props) => {\n\t\t\t\tprops.fontSizeAdjustment = 0\n\t\t\t},\n\t\t\tdown: (props) => {\n\t\t\t\tdelete props.fontSizeAdjustment\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { T } from '@tldraw/validate'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { DefaultColorStyle } from '../styles/TLColorStyle'\nimport { DefaultFontStyle } from '../styles/TLFontStyle'\nimport { DefaultHorizontalAlignStyle } from '../styles/TLHorizontalAlignStyle'\nimport { DefaultSizeStyle } from '../styles/TLSizeStyle'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport const textShapeProps = {\n\tcolor: DefaultColorStyle,\n\tsize: DefaultSizeStyle,\n\tfont: DefaultFontStyle,\n\talign: DefaultHorizontalAlignStyle,\n\tw: T.nonZeroNumber,\n\ttext: T.string,\n\tscale: T.nonZeroNumber,\n\tautoSize: T.boolean,\n}\n\n/** @public */\nexport type TLTextShapeProps = ShapePropsType<typeof textShapeProps>\n\n/** @public */\nexport type TLTextShape = TLBaseShape<'text', TLTextShapeProps>\n\nconst Versions = createShapePropsMigrationIds('text', {\n\tRemoveJustify: 1,\n})\n\nexport { Versions as textShapeVersions }\n\n/** @public */\nexport const textShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.RemoveJustify,\n\t\t\tup: (props) => {\n\t\t\t\tif (props.align === 'justify') {\n\t\t\t\t\tprops.align = 'start'\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t],\n})\n", "import { T } from '@tldraw/validate'\nimport { assetIdValidator } from '../assets/TLBaseAsset'\nimport {\n\tRETIRED_DOWN_MIGRATION,\n\tcreateShapePropsMigrationIds,\n\tcreateShapePropsMigrationSequence,\n} from '../records/TLShape'\nimport { ShapePropsType, TLBaseShape } from './TLBaseShape'\n\n/** @public */\nexport const videoShapeProps = {\n\tw: T.nonZeroNumber,\n\th: T.nonZeroNumber,\n\ttime: T.number,\n\tplaying: T.boolean,\n\turl: T.linkUrl,\n\tassetId: assetIdValidator.nullable(),\n}\n\n/** @public */\nexport type TLVideoShapeProps = ShapePropsType<typeof videoShapeProps>\n\n/** @public */\nexport type TLVideoShape = TLBaseShape<'video', TLVideoShapeProps>\n\nconst Versions = createShapePropsMigrationIds('video', {\n\tAddUrlProp: 1,\n\tMakeUrlsValid: 2,\n})\n\nexport { Versions as videoShapeVersions }\n\n/** @public */\nexport const videoShapeMigrations = createShapePropsMigrationSequence({\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.AddUrlProp,\n\t\t\tup: (props) => {\n\t\t\t\tprops.url = ''\n\t\t\t},\n\t\t\tdown: RETIRED_DOWN_MIGRATION,\n\t\t},\n\t\t{\n\t\t\tid: Versions.MakeUrlsValid,\n\t\t\tup: (props) => {\n\t\t\t\tif (!T.linkUrl.isValid(props.url)) {\n\t\t\t\t\tprops.url = ''\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (_props) => {\n\t\t\t\t// noop\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { createMigrationIds, createMigrationSequence } from '@tldraw/store'\nimport { objectMapEntries } from '@tldraw/utils'\nimport { TLShape } from './records/TLShape'\n\nconst Versions = createMigrationIds('com.tldraw.store', {\n\tRemoveCodeAndIconShapeTypes: 1,\n\tAddInstancePresenceType: 2,\n\tRemoveTLUserAndPresenceAndAddPointer: 3,\n\tRemoveUserDocument: 4,\n} as const)\n\nexport { Versions as storeVersions }\n\n/** @public */\nexport const storeMigrations = createMigrationSequence({\n\tsequenceId: 'com.tldraw.store',\n\tretroactive: false,\n\tsequence: [\n\t\t{\n\t\t\tid: Versions.RemoveCodeAndIconShapeTypes,\n\t\t\tscope: 'store',\n\t\t\tup: (store) => {\n\t\t\t\tfor (const [id, record] of objectMapEntries(store)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\trecord.typeName === 'shape' &&\n\t\t\t\t\t\t((record as TLShape).type === 'icon' || (record as TLShape).type === 'code')\n\t\t\t\t\t) {\n\t\t\t\t\t\tdelete store[id]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: Versions.AddInstancePresenceType,\n\t\t\tscope: 'store',\n\t\t\tup(_store) {\n\t\t\t\t// noop\n\t\t\t\t// there used to be a down migration for this but we made down migrations optional\n\t\t\t\t// and we don't use them on store-level migrations so we can just remove it\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\t// remove user and presence records and add pointer records\n\t\t\tid: Versions.RemoveTLUserAndPresenceAndAddPointer,\n\t\t\tscope: 'store',\n\t\t\tup: (store) => {\n\t\t\t\tfor (const [id, record] of objectMapEntries(store)) {\n\t\t\t\t\tif (record.typeName.match(/^(user|user_presence)$/)) {\n\t\t\t\t\t\tdelete store[id]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\t// remove user document records\n\t\t\tid: Versions.RemoveUserDocument,\n\t\t\tscope: 'store',\n\t\t\tup: (store) => {\n\t\t\t\tfor (const [id, record] of objectMapEntries(store)) {\n\t\t\t\t\tif (record.typeName.match('user_document')) {\n\t\t\t\t\t\tdelete store[id]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t],\n})\n", "import { LegacyMigrations, MigrationSequence, StoreSchema } from '@tldraw/store'\nimport { objectMapValues } from '@tldraw/utils'\nimport { TLStoreProps, createIntegrityChecker, onValidationFailure } from './TLStore'\nimport { bookmarkAssetMigrations } from './assets/TLBookmarkAsset'\nimport { imageAssetMigrations } from './assets/TLImageAsset'\nimport { videoAssetMigrations } from './assets/TLVideoAsset'\nimport { AssetRecordType, assetMigrations } from './records/TLAsset'\nimport { CameraRecordType, cameraMigrations } from './records/TLCamera'\nimport { DocumentRecordType, documentMigrations } from './records/TLDocument'\nimport { createInstanceRecordType, instanceMigrations } from './records/TLInstance'\nimport { PageRecordType, pageMigrations } from './records/TLPage'\nimport { InstancePageStateRecordType, instancePageStateMigrations } from './records/TLPageState'\nimport { PointerRecordType, pointerMigrations } from './records/TLPointer'\nimport { InstancePresenceRecordType, instancePresenceMigrations } from './records/TLPresence'\nimport { TLRecord } from './records/TLRecord'\nimport {\n\tTLDefaultShape,\n\tTLShapePropsMigrations,\n\tcreateShapeRecordType,\n\tgetShapePropKeysByStyle,\n\tprocessShapeMigrations,\n\trootShapeMigrations,\n} from './records/TLShape'\nimport { arrowShapeMigrations, arrowShapeProps } from './shapes/TLArrowShape'\nimport { bookmarkShapeMigrations, bookmarkShapeProps } from './shapes/TLBookmarkShape'\nimport { drawShapeMigrations, drawShapeProps } from './shapes/TLDrawShape'\nimport { embedShapeMigrations, embedShapeProps } from './shapes/TLEmbedShape'\nimport { frameShapeMigrations, frameShapeProps } from './shapes/TLFrameShape'\nimport { geoShapeMigrations, geoShapeProps } from './shapes/TLGeoShape'\nimport { groupShapeMigrations, groupShapeProps } from './shapes/TLGroupShape'\nimport { highlightShapeMigrations, highlightShapeProps } from './shapes/TLHighlightShape'\nimport { imageShapeMigrations, imageShapeProps } from './shapes/TLImageShape'\nimport { lineShapeMigrations, lineShapeProps } from './shapes/TLLineShape'\nimport { noteShapeMigrations, noteShapeProps } from './shapes/TLNoteShape'\nimport { textShapeMigrations, textShapeProps } from './shapes/TLTextShape'\nimport { videoShapeMigrations, videoShapeProps } from './shapes/TLVideoShape'\nimport { storeMigrations } from './store-migrations'\nimport { StyleProp } from './styles/StyleProp'\n\ntype AnyValidator = {\n\tvalidate: (prop: any) => any\n\tvalidateUsingKnownGoodVersion?: (prevVersion: any, newVersion: any) => any\n}\n\n/** @public */\nexport type SchemaShapeInfo = {\n\tmigrations?: LegacyMigrations | TLShapePropsMigrations | MigrationSequence\n\tprops?: Record<string, AnyValidator>\n\tmeta?: Record<string, AnyValidator>\n}\n\n/** @public */\nexport type TLSchema = StoreSchema<TLRecord, TLStoreProps>\n\n/** @public */\nexport const defaultShapeSchemas: { [T in TLDefaultShape['type']]: SchemaShapeInfo } = {\n\tarrow: { migrations: arrowShapeMigrations, props: arrowShapeProps },\n\tbookmark: { migrations: bookmarkShapeMigrations, props: bookmarkShapeProps },\n\tdraw: { migrations: drawShapeMigrations, props: drawShapeProps },\n\tembed: { migrations: embedShapeMigrations, props: embedShapeProps },\n\tframe: { migrations: frameShapeMigrations, props: frameShapeProps },\n\tgeo: { migrations: geoShapeMigrations, props: geoShapeProps },\n\tgroup: { migrations: groupShapeMigrations, props: groupShapeProps },\n\thighlight: { migrations: highlightShapeMigrations, props: highlightShapeProps },\n\timage: { migrations: imageShapeMigrations, props: imageShapeProps },\n\tline: { migrations: lineShapeMigrations, props: lineShapeProps },\n\tnote: { migrations: noteShapeMigrations, props: noteShapeProps },\n\ttext: { migrations: textShapeMigrations, props: textShapeProps },\n\tvideo: { migrations: videoShapeMigrations, props: videoShapeProps },\n}\n\n/**\n * Create a TLSchema with custom shapes. Custom shapes cannot override default shapes.\n *\n * @param opts - Options\n *\n * @public */\nexport function createTLSchema({\n\tshapes = defaultShapeSchemas,\n\tmigrations,\n}: {\n\tshapes?: Record<string, SchemaShapeInfo>\n\tmigrations?: readonly MigrationSequence[]\n} = {}): TLSchema {\n\tconst stylesById = new Map<string, StyleProp<unknown>>()\n\tfor (const shape of objectMapValues(shapes)) {\n\t\tfor (const style of getShapePropKeysByStyle(shape.props ?? {}).keys()) {\n\t\t\tif (stylesById.has(style.id) && stylesById.get(style.id) !== style) {\n\t\t\t\tthrow new Error(`Multiple StyleProp instances with the same id: ${style.id}`)\n\t\t\t}\n\t\t\tstylesById.set(style.id, style)\n\t\t}\n\t}\n\n\tconst ShapeRecordType = createShapeRecordType(shapes)\n\tconst InstanceRecordType = createInstanceRecordType(stylesById)\n\n\treturn StoreSchema.create(\n\t\t{\n\t\t\tasset: AssetRecordType,\n\t\t\tcamera: CameraRecordType,\n\t\t\tdocument: DocumentRecordType,\n\t\t\tinstance: InstanceRecordType,\n\t\t\tinstance_page_state: InstancePageStateRecordType,\n\t\t\tpage: PageRecordType,\n\t\t\tinstance_presence: InstancePresenceRecordType,\n\t\t\tpointer: PointerRecordType,\n\t\t\tshape: ShapeRecordType,\n\t\t},\n\t\t{\n\t\t\tmigrations: [\n\t\t\t\tstoreMigrations,\n\t\t\t\tassetMigrations,\n\t\t\t\tcameraMigrations,\n\t\t\t\tdocumentMigrations,\n\t\t\t\tinstanceMigrations,\n\t\t\t\tinstancePageStateMigrations,\n\t\t\t\tpageMigrations,\n\t\t\t\tinstancePresenceMigrations,\n\t\t\t\tpointerMigrations,\n\t\t\t\trootShapeMigrations,\n\n\t\t\t\tbookmarkAssetMigrations,\n\t\t\t\timageAssetMigrations,\n\t\t\t\tvideoAssetMigrations,\n\n\t\t\t\t...processShapeMigrations(shapes),\n\n\t\t\t\t...(migrations ?? []),\n\t\t\t],\n\t\t\tonValidationFailure,\n\t\t\tcreateIntegrityChecker,\n\t\t}\n\t)\n}\n", "// This file is automatically generated by scripts/refresh-assets.ts.\n// Do not edit manually. Or do, I'm a comment, not a cop.\n\n/** @public */\nexport const LANGUAGES = [\n\t{ locale: 'ca', label: 'Catal\u00E0' },\n\t{ locale: 'cs', label: '\u010Ce\u0161tina' },\n\t{ locale: 'da', label: 'Danish' },\n\t{ locale: 'de', label: 'Deutsch' },\n\t{ locale: 'en', label: 'English' },\n\t{ locale: 'es', label: 'Espa\u00F1ol' },\n\t{ locale: 'fr', label: 'Fran\u00E7ais' },\n\t{ locale: 'gl', label: 'Galego' },\n\t{ locale: 'hr', label: 'Hrvatski' },\n\t{ locale: 'it', label: 'Italiano' },\n\t{ locale: 'hu', label: 'Magyar' },\n\t{ locale: 'no', label: 'Norwegian' },\n\t{ locale: 'pl', label: 'Polski' },\n\t{ locale: 'pt-br', label: 'Portugu\u00EAs - Brasil' },\n\t{ locale: 'pt-pt', label: 'Portugu\u00EAs - Europeu' },\n\t{ locale: 'ro', label: 'Rom\u00E2n\u0103' },\n\t{ locale: 'ru', label: 'Russian' },\n\t{ locale: 'sl', label: 'Sloven\u0161\u010Dina' },\n\t{ locale: 'fi', label: 'Suomi' },\n\t{ locale: 'sv', label: 'Svenska' },\n\t{ locale: 'vi', label: 'Ti\u1EBFng Vi\u1EC7t' },\n\t{ locale: 'tr', label: 'T\u00FCrk\u00E7e' },\n\t{ locale: 'uk', label: 'Ukrainian' },\n\t{ locale: 'he', label: '\u05E2\u05D1\u05E8\u05D9\u05EA' },\n\t{ locale: 'ar', label: '\u0639\u0631\u0628\u064A' },\n\t{ locale: 'fa', label: '\u0641\u0627\u0631\u0633\u06CC' },\n\t{ locale: 'ku', label: '\u06A9\u0648\u0631\u062F\u06CC' },\n\t{ locale: 'ne', label: '\u0928\u0947\u092A\u093E\u0932\u0940' },\n\t{ locale: 'hi-in', label: '\u0939\u093F\u0928\u094D\u0926\u0940' },\n\t{ locale: 'te', label: '\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41' },\n\t{ locale: 'th', label: '\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22' },\n\t{ locale: 'my', label: '\u1019\u103C\u1014\u103A\u1019\u102C\u1005\u102C' },\n\t{ locale: 'ko-kr', label: '\uD55C\uAD6D\uC5B4' },\n\t{ locale: 'ja', label: '\u65E5\u672C\u8A9E' },\n\t{ locale: 'zh-cn', label: '\u7B80\u4F53\u4E2D\u6587' },\n\t{ locale: 'zh-tw', label: '\u7E41\u9AD4\u4E2D\u6587 (\u53F0\u7063)' },\n] as const\n", "import { LANGUAGES } from './languages'\n\n/** @public */\nexport { LANGUAGES }\n\n/** @public */\nexport type TLLanguage = (typeof LANGUAGES)[number]\n// {\n// \treadonly locale: string\n// \treadonly label: string\n// }\n\n/** @public */\nexport function getDefaultTranslationLocale(): TLLanguage['locale'] {\n\tconst locales = typeof window !== 'undefined' ? window.navigator.languages ?? ['en'] : ['en']\n\treturn _getDefaultTranslationLocale(locales)\n}\n\n/** @internal */\nexport function _getDefaultTranslationLocale(locales: readonly string[]): TLLanguage['locale'] {\n\tfor (const locale of locales) {\n\t\tconst supportedLocale = getSupportedLocale(locale)\n\t\tif (supportedLocale) {\n\t\t\treturn supportedLocale\n\t\t}\n\t}\n\treturn 'en'\n}\n\n/** @public */\nconst DEFAULT_LOCALE_REGIONS: { [locale: string]: TLLanguage['locale'] } = {\n\tzh: 'zh-cn',\n\tpt: 'pt-br',\n\tko: 'ko-kr',\n\thi: 'hi-in',\n}\n\n/** @public */\nfunction getSupportedLocale(locale: string): TLLanguage['locale'] | null {\n\t// If we have an exact match, return it!\n\t// (e.g. if the user has 'fr' and we have 'fr')\n\t// (or if the user has 'pt-BR' and we have 'pt-br')\n\tconst exactMatch = LANGUAGES.find((t) => t.locale === locale.toLowerCase())\n\tif (exactMatch) {\n\t\treturn exactMatch.locale\n\t}\n\n\t// Otherwise, we need to be more flexible...\n\tconst [language, region] = locale.split(/[-_]/).map((s) => s.toLowerCase())\n\n\t// If the user's language has a region...\n\t// let's try to find non-region-specific locale for them\n\t// (e.g. if they have 'fr-CA' but we only have 'fr')\n\tif (region) {\n\t\tconst languageMatch = LANGUAGES.find((t) => t.locale === language)\n\t\tif (languageMatch) {\n\t\t\treturn languageMatch.locale\n\t\t}\n\t}\n\n\t// If the user's language doesn't have a region...\n\t// let's try to find a region-specific locale for them\n\t// (e.g. if they have 'pt' but we only have 'pt-pt' or 'pt-br')\n\t//\n\t// In this case, we choose the hard-coded default region for that language\n\tif (language in DEFAULT_LOCALE_REGIONS) {\n\t\treturn DEFAULT_LOCALE_REGIONS[language]\n\t}\n\n\t// Oh no! We don't have a translation for this language!\n\t// Let's give up...\n\treturn null\n}\n", "import { MigrationSequence, SerializedStore, Store, StoreSnapshot } from '@tldraw/store'\nimport { TLRecord, TLStore } from '@tldraw/tlschema'\nimport { Expand, Required, annotateError } from '@tldraw/utils'\nimport React, {\n\tReactNode,\n\tmemo,\n\tuseCallback,\n\tuseLayoutEffect,\n\tuseMemo,\n\tuseState,\n\tuseSyncExternalStore,\n} from 'react'\n\nimport classNames from 'classnames'\nimport { OptionalErrorBoundary } from './components/ErrorBoundary'\nimport { DefaultErrorFallback } from './components/default-components/DefaultErrorFallback'\nimport { TLUser, createTLUser } from './config/createTLUser'\nimport { TLAnyShapeUtilConstructor } from './config/defaultShapes'\nimport { Editor } from './editor/Editor'\nimport { TLStateNodeConstructor } from './editor/tools/StateNode'\nimport { ContainerProvider, useContainer } from './hooks/useContainer'\nimport { useCursor } from './hooks/useCursor'\nimport { useDarkMode } from './hooks/useDarkMode'\nimport { EditorContext, useEditor } from './hooks/useEditor'\nimport {\n\tEditorComponentsProvider,\n\tTLEditorComponents,\n\tuseEditorComponents,\n} from './hooks/useEditorComponents'\nimport { useEvent } from './hooks/useEvent'\nimport { useFocusEvents } from './hooks/useFocusEvents'\nimport { useForceUpdate } from './hooks/useForceUpdate'\nimport { useLocalStore } from './hooks/useLocalStore'\nimport { useSafariFocusOutFix } from './hooks/useSafariFocusOutFix'\nimport { useZoomCss } from './hooks/useZoomCss'\nimport { stopEventPropagation } from './utils/dom'\nimport { TLStoreWithStatus } from './utils/sync/StoreWithStatus'\n\n/**\n * Props for the {@link tldraw#Tldraw} and {@link TldrawEditor} components.\n *\n * @public\n **/\nexport type TldrawEditorProps = Expand<\n\tTldrawEditorBaseProps &\n\t\t(\n\t\t\t| {\n\t\t\t\t\tstore: TLStore | TLStoreWithStatus\n\t\t\t  }\n\t\t\t| {\n\t\t\t\t\tstore?: undefined\n\t\t\t\t\tmigrations?: readonly MigrationSequence[]\n\t\t\t\t\tsnapshot?: StoreSnapshot<TLRecord>\n\t\t\t\t\tinitialData?: SerializedStore<TLRecord>\n\t\t\t\t\tpersistenceKey?: string\n\t\t\t\t\tsessionId?: string\n\t\t\t\t\tdefaultName?: string\n\t\t\t  }\n\t\t)\n>\n\n/**\n * Base props for the {@link tldraw#Tldraw} and {@link TldrawEditor} components.\n *\n * @public\n */\nexport interface TldrawEditorBaseProps {\n\t/**\n\t * The component's children.\n\t */\n\tchildren?: ReactNode\n\n\t/**\n\t * An array of shape utils to use in the editor.\n\t */\n\tshapeUtils?: readonly TLAnyShapeUtilConstructor[]\n\n\t/**\n\t * An array of tools to add to the editor's state chart.\n\t */\n\ttools?: readonly TLStateNodeConstructor[]\n\n\t/**\n\t * Whether to automatically focus the editor when it mounts.\n\t */\n\tautoFocus?: boolean\n\n\t/**\n\t * Overrides for the editor's components, such as handles, collaborator cursors, etc.\n\t */\n\tcomponents?: TLEditorComponents\n\n\t/**\n\t * Called when the editor has mounted.\n\t */\n\tonMount?: TLOnMountHandler\n\n\t/**\n\t * The editor's initial state (usually the id of the first active tool).\n\t */\n\tinitialState?: string\n\n\t/**\n\t * A classname to pass to the editor's container.\n\t */\n\tclassName?: string\n\n\t/**\n\t * The user interacting with the editor.\n\t */\n\tuser?: TLUser\n\n\t/**\n\t * Whether to infer dark mode from the user's OS. Defaults to false.\n\t */\n\tinferDarkMode?: boolean\n}\n\n/**\n * Called when the editor has mounted.\n * @example\n * ```ts\n * <Tldraw onMount={(editor) => editor.selectAll()} />\n * ```\n * @param editor - The editor instance.\n *\n * @public\n */\nexport type TLOnMountHandler = (editor: Editor) => (() => void | undefined) | undefined | void\n\ndeclare global {\n\tinterface Window {\n\t\ttldrawReady: boolean\n\t}\n}\n\nconst EMPTY_SHAPE_UTILS_ARRAY = [] as const\nconst EMPTY_TOOLS_ARRAY = [] as const\n\n/** @public */\nexport const TldrawEditor = memo(function TldrawEditor({\n\tstore,\n\tcomponents,\n\tclassName,\n\tuser: _user,\n\t...rest\n}: TldrawEditorProps) {\n\tconst [container, setContainer] = React.useState<HTMLDivElement | null>(null)\n\tconst user = useMemo(() => _user ?? createTLUser(), [_user])\n\n\tconst ErrorFallback =\n\t\tcomponents?.ErrorFallback === undefined ? DefaultErrorFallback : components?.ErrorFallback\n\n\t// apply defaults. if you're using the bare @tldraw/editor package, we\n\t// default these to the \"tldraw zero\" configuration. We have different\n\t// defaults applied in tldraw.\n\tconst withDefaults = {\n\t\t...rest,\n\t\tshapeUtils: rest.shapeUtils ?? EMPTY_SHAPE_UTILS_ARRAY,\n\t\ttools: rest.tools ?? EMPTY_TOOLS_ARRAY,\n\t\tcomponents,\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tref={setContainer}\n\t\t\tdraggable={false}\n\t\t\tclassName={classNames('tl-container tl-theme__light', className)}\n\t\t\tonPointerDown={stopEventPropagation}\n\t\t\ttabIndex={-1}\n\t\t>\n\t\t\t<OptionalErrorBoundary\n\t\t\t\tfallback={ErrorFallback}\n\t\t\t\tonError={(error) => annotateError(error, { tags: { origin: 'react.tldraw-before-app' } })}\n\t\t\t>\n\t\t\t\t{container && (\n\t\t\t\t\t<ContainerProvider container={container}>\n\t\t\t\t\t\t<EditorComponentsProvider overrides={components}>\n\t\t\t\t\t\t\t{store ? (\n\t\t\t\t\t\t\t\tstore instanceof Store ? (\n\t\t\t\t\t\t\t\t\t// Store is ready to go, whether externally synced or not\n\t\t\t\t\t\t\t\t\t<TldrawEditorWithReadyStore {...withDefaults} store={store} user={user} />\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t// Store is a synced store, so handle syncing stages internally\n\t\t\t\t\t\t\t\t\t<TldrawEditorWithLoadingStore {...withDefaults} store={store} user={user} />\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t// We have no store (it's undefined) so create one and possibly sync it\n\t\t\t\t\t\t\t\t<TldrawEditorWithOwnStore {...withDefaults} store={store} user={user} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</EditorComponentsProvider>\n\t\t\t\t\t</ContainerProvider>\n\t\t\t\t)}\n\t\t\t</OptionalErrorBoundary>\n\t\t</div>\n\t)\n})\n\nfunction TldrawEditorWithOwnStore(\n\tprops: Required<TldrawEditorProps & { store: undefined; user: TLUser }, 'shapeUtils' | 'tools'>\n) {\n\tconst { defaultName, snapshot, initialData, shapeUtils, persistenceKey, sessionId, user } = props\n\n\tconst syncedStore = useLocalStore({\n\t\tshapeUtils,\n\t\tinitialData,\n\t\tpersistenceKey,\n\t\tsessionId,\n\t\tdefaultName,\n\t\tsnapshot,\n\t})\n\n\treturn <TldrawEditorWithLoadingStore {...props} store={syncedStore} user={user} />\n}\n\nconst TldrawEditorWithLoadingStore = memo(function TldrawEditorBeforeLoading({\n\tstore,\n\tuser,\n\t...rest\n}: Required<\n\tTldrawEditorProps & { store: TLStoreWithStatus; user: TLUser },\n\t'shapeUtils' | 'tools'\n>) {\n\tconst container = useContainer()\n\n\tuseLayoutEffect(() => {\n\t\tif (user.userPreferences.get().isDarkMode) {\n\t\t\tcontainer.classList.remove('tl-theme__light')\n\t\t\tcontainer.classList.add('tl-theme__dark')\n\t\t}\n\t}, [container, user])\n\n\tconst { LoadingScreen } = useEditorComponents()\n\n\tswitch (store.status) {\n\t\tcase 'error': {\n\t\t\t// for error handling, we fall back to the default error boundary.\n\t\t\t// if users want to handle this error differently, they can render\n\t\t\t// their own error screen before the TldrawEditor component\n\t\t\tthrow store.error\n\t\t}\n\t\tcase 'loading': {\n\t\t\treturn LoadingScreen ? <LoadingScreen /> : null\n\t\t}\n\t\tcase 'not-synced': {\n\t\t\tbreak\n\t\t}\n\t\tcase 'synced-local': {\n\t\t\tbreak\n\t\t}\n\t\tcase 'synced-remote': {\n\t\t\tbreak\n\t\t}\n\t}\n\n\treturn <TldrawEditorWithReadyStore {...rest} store={store.store} user={user} />\n})\n\nfunction TldrawEditorWithReadyStore({\n\tonMount,\n\tchildren,\n\tstore,\n\ttools,\n\tshapeUtils,\n\tuser,\n\tinitialState,\n\tautoFocus = true,\n\tinferDarkMode,\n}: Required<\n\tTldrawEditorProps & {\n\t\tstore: TLStore\n\t\tuser: TLUser\n\t},\n\t'shapeUtils' | 'tools'\n>) {\n\tconst { ErrorFallback } = useEditorComponents()\n\tconst container = useContainer()\n\tconst [editor, setEditor] = useState<Editor | null>(null)\n\n\tuseLayoutEffect(() => {\n\t\tconst editor = new Editor({\n\t\t\tstore,\n\t\t\tshapeUtils,\n\t\t\ttools,\n\t\t\tgetContainer: () => container,\n\t\t\tuser,\n\t\t\tinitialState,\n\t\t\tinferDarkMode,\n\t\t})\n\t\tsetEditor(editor)\n\n\t\treturn () => {\n\t\t\teditor.dispose()\n\t\t}\n\t}, [container, shapeUtils, tools, store, user, initialState, inferDarkMode])\n\n\tconst crashingError = useSyncExternalStore(\n\t\tuseCallback(\n\t\t\t(onStoreChange) => {\n\t\t\t\tif (editor) {\n\t\t\t\t\teditor.on('crash', onStoreChange)\n\t\t\t\t\treturn () => editor.off('crash', onStoreChange)\n\t\t\t\t}\n\t\t\t\treturn () => {\n\t\t\t\t\t// noop\n\t\t\t\t}\n\t\t\t},\n\t\t\t[editor]\n\t\t),\n\t\t() => editor?.getCrashingError() ?? null\n\t)\n\n\tconst { Canvas } = useEditorComponents()\n\n\tif (!editor) {\n\t\treturn null\n\t}\n\n\treturn (\n\t\t// the top-level tldraw component also renders an error boundary almost\n\t\t// identical to this one. the reason we have two is because this one has\n\t\t// access to `App`, which means that here we can enrich errors with data\n\t\t// from app for reporting, and also still attempt to render the user's\n\t\t// document in the event of an error to reassure them that their work is\n\t\t// not lost.\n\t\t<OptionalErrorBoundary\n\t\t\tfallback={ErrorFallback as any}\n\t\t\tonError={(error) =>\n\t\t\t\teditor.annotateError(error, { origin: 'react.tldraw', willCrashApp: true })\n\t\t\t}\n\t\t>\n\t\t\t{crashingError ? (\n\t\t\t\t<Crash crashingError={crashingError} />\n\t\t\t) : (\n\t\t\t\t<EditorContext.Provider value={editor}>\n\t\t\t\t\t<Layout autoFocus={autoFocus} onMount={onMount}>\n\t\t\t\t\t\t{children ?? (Canvas ? <Canvas /> : null)}\n\t\t\t\t\t</Layout>\n\t\t\t\t</EditorContext.Provider>\n\t\t\t)}\n\t\t</OptionalErrorBoundary>\n\t)\n}\n\nfunction Layout({\n\tchildren,\n\tonMount,\n\tautoFocus,\n}: {\n\tchildren: ReactNode\n\tautoFocus: boolean\n\tonMount?: TLOnMountHandler\n}) {\n\tuseZoomCss()\n\tuseCursor()\n\tuseDarkMode()\n\tuseSafariFocusOutFix()\n\tuseForceUpdate()\n\tuseFocusEvents(autoFocus)\n\tuseOnMount(onMount)\n\n\treturn <>{children}</>\n}\n\nfunction Crash({ crashingError }: { crashingError: unknown }): null {\n\tthrow crashingError\n}\n\n/** @public */\nexport function LoadingScreen({ children }: { children: ReactNode }) {\n\treturn <div className=\"tl-loading\">{children}</div>\n}\n\n/** @public */\nexport function ErrorScreen({ children }: { children: ReactNode }) {\n\treturn <div className=\"tl-loading\">{children}</div>\n}\n\nfunction useOnMount(onMount?: TLOnMountHandler) {\n\tconst editor = useEditor()\n\n\tconst onMountEvent = useEvent((editor: Editor) => {\n\t\tconst teardown = onMount?.(editor)\n\t\teditor.emit('mount')\n\t\twindow.tldrawReady = true\n\t\treturn teardown\n\t})\n\n\tReact.useLayoutEffect(() => {\n\t\tif (editor) return onMountEvent?.(editor)\n\t}, [editor, onMountEvent])\n}\n", "import * as React from 'react'\nimport { TLErrorFallbackComponent } from './default-components/DefaultErrorFallback'\n\n/** @public */\nexport interface TLErrorBoundaryProps {\n\tchildren: React.ReactNode\n\tonError?: ((error: unknown) => void) | null\n\tfallback: TLErrorFallbackComponent\n}\n\ntype TLErrorBoundaryState = { error: Error | null }\n\nconst initialState: TLErrorBoundaryState = { error: null }\n\n/** @public */\nexport class ErrorBoundary extends React.Component<\n\tReact.PropsWithRef<React.PropsWithChildren<TLErrorBoundaryProps>>,\n\tTLErrorBoundaryState\n> {\n\tstatic getDerivedStateFromError(error: Error) {\n\t\treturn { error }\n\t}\n\n\toverride state = initialState\n\n\toverride componentDidCatch(error: unknown) {\n\t\tthis.props.onError?.(error)\n\t}\n\n\toverride render() {\n\t\tconst { error } = this.state\n\n\t\tif (error !== null) {\n\t\t\tconst { fallback: Fallback } = this.props\n\t\t\treturn <Fallback error={error} />\n\t\t}\n\n\t\treturn this.props.children\n\t}\n}\n\n/** @internal */\nexport function OptionalErrorBoundary({\n\tchildren,\n\tfallback,\n\t...props\n}: Omit<TLErrorBoundaryProps, 'fallback'> & {\n\tfallback: TLErrorFallbackComponent\n}) {\n\tif (fallback === null) {\n\t\treturn <>{children}</>\n\t}\n\n\treturn (\n\t\t<ErrorBoundary fallback={fallback as any} {...props}>\n\t\t\t{children}\n\t\t</ErrorBoundary>\n\t)\n}\n", "import { useValue } from '@tldraw/state'\nimport classNames from 'classnames'\nimport { ComponentType, useEffect, useLayoutEffect, useRef, useState } from 'react'\nimport { Editor } from '../../editor/Editor'\nimport { EditorContext } from '../../hooks/useEditor'\nimport { useEditorComponents } from '../../hooks/useEditorComponents'\nimport { hardResetEditor } from '../../utils/hardResetEditor'\nimport { refreshPage } from '../../utils/refreshPage'\nimport { ErrorBoundary } from '../ErrorBoundary'\n\nconst BASE_ERROR_URL = 'https://github.com/tldraw/tldraw/issues/new'\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nfunction noop() {}\n\n/** @public */\nexport type TLErrorFallbackComponent = ComponentType<{ error: unknown; editor?: Editor }>\n\n/** @public */\nexport const DefaultErrorFallback: TLErrorFallbackComponent = ({ error, editor }) => {\n\tconst containerRef = useRef<HTMLDivElement>(null)\n\tconst [shouldShowError, setShouldShowError] = useState(process.env.NODE_ENV === 'development')\n\tconst [didCopy, setDidCopy] = useState(false)\n\tconst [shouldShowResetConfirmation, setShouldShowResetConfirmation] = useState(false)\n\n\tconst { Canvas } = useEditorComponents()\n\n\tconst errorMessage = error instanceof Error ? error.message : String(error)\n\tconst errorStack = error instanceof Error ? error.stack : null\n\n\tconst isDarkModeFromApp = useValue(\n\t\t'isDarkMode',\n\t\t() => {\n\t\t\ttry {\n\t\t\t\tif (editor) {\n\t\t\t\t\treturn editor.user.getIsDarkMode()\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// we're in a funky error state so this might not work for spooky\n\t\t\t\t// reasons. if not, we'll have another attempt later:\n\t\t\t}\n\t\t\treturn null\n\t\t},\n\t\t[editor]\n\t)\n\tconst [isDarkMode, setIsDarkMode] = useState<null | boolean>(null)\n\tuseLayoutEffect(() => {\n\t\t// if we found a theme class from the app, we can just use that\n\t\tif (isDarkModeFromApp !== null) {\n\t\t\tsetIsDarkMode(isDarkModeFromApp)\n\t\t}\n\n\t\t// do any of our parents have a theme class? if yes then we can just\n\t\t// rely on that and don't need to set our own class\n\t\tlet parent = containerRef.current?.parentElement\n\t\tlet foundParentThemeClass = false\n\t\twhile (parent) {\n\t\t\tif (\n\t\t\t\tparent.classList.contains('tl-theme__dark') ||\n\t\t\t\tparent.classList.contains('tl-theme__light')\n\t\t\t) {\n\t\t\t\tfoundParentThemeClass = true\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tparent = parent.parentElement\n\t\t}\n\t\tif (foundParentThemeClass) {\n\t\t\tsetIsDarkMode(null)\n\t\t\treturn\n\t\t}\n\n\t\t// if we can't find a theme class from the app or from a parent, we have\n\t\t// to fall back on using a media query:\n\t\tsetIsDarkMode(window.matchMedia('(prefers-color-scheme: dark)').matches)\n\t}, [isDarkModeFromApp])\n\n\tuseEffect(() => {\n\t\tif (didCopy) {\n\t\t\tconst timeout = setTimeout(() => {\n\t\t\t\tsetDidCopy(false)\n\t\t\t}, 2000)\n\t\t\treturn () => clearTimeout(timeout)\n\t\t}\n\t}, [didCopy])\n\n\tconst copyError = () => {\n\t\tconst textarea = document.createElement('textarea')\n\t\ttextarea.value = errorStack ?? errorMessage\n\t\tdocument.body.appendChild(textarea)\n\t\ttextarea.select()\n\t\t// eslint-disable-next-line deprecation/deprecation\n\t\tdocument.execCommand('copy')\n\t\ttextarea.remove()\n\t\tsetDidCopy(true)\n\t}\n\n\tconst refresh = () => {\n\t\trefreshPage()\n\t}\n\n\tconst resetLocalState = async () => {\n\t\thardResetEditor()\n\t}\n\n\tconst url = new URL(BASE_ERROR_URL)\n\turl.searchParams.set('title', errorMessage)\n\turl.searchParams.set('labels', `bug`)\n\turl.searchParams.set(\n\t\t'body',\n\t\t`Hey, I ran into an error while using tldraw:\n\n\\`\\`\\`js\n${errorStack ?? errorMessage}\n\\`\\`\\`\n\nMy browser: ${navigator.userAgent}`\n\t)\n\n\treturn (\n\t\t<div\n\t\t\tref={containerRef}\n\t\t\tclassName={classNames(\n\t\t\t\t'tl-container tl-error-boundary',\n\t\t\t\t// error-boundary is sometimes used outside of the theme\n\t\t\t\t// container, so we need to provide it with a theme for our\n\t\t\t\t// styles to work correctly\n\t\t\t\tisDarkMode === null ? '' : isDarkMode ? 'tl-theme__dark' : 'tl-theme__light'\n\t\t\t)}\n\t\t>\n\t\t\t<div className=\"tl-error-boundary__overlay\" />\n\t\t\t{editor && (\n\t\t\t\t// opportunistically attempt to render the canvas to reassure\n\t\t\t\t// the user that their document is still there. there's a good\n\t\t\t\t// chance this won't work (ie the error that we're currently\n\t\t\t\t// notifying the user about originates in the canvas) so it's\n\t\t\t\t// not a big deal if it doesn't work - in that case we just have\n\t\t\t\t// a plain grey background.\n\t\t\t\t<ErrorBoundary onError={noop} fallback={() => null}>\n\t\t\t\t\t<EditorContext.Provider value={editor}>\n\t\t\t\t\t\t<div className=\"tl-overlay tl-error-boundary__canvas\">{Canvas ? <Canvas /> : null}</div>\n\t\t\t\t\t</EditorContext.Provider>\n\t\t\t\t</ErrorBoundary>\n\t\t\t)}\n\t\t\t<div\n\t\t\t\tclassName={classNames('tl-modal', 'tl-error-boundary__content', {\n\t\t\t\t\t'tl-error-boundary__content__expanded': shouldShowError && !shouldShowResetConfirmation,\n\t\t\t\t})}\n\t\t\t>\n\t\t\t\t{shouldShowResetConfirmation ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<h2>Are you sure?</h2>\n\t\t\t\t\t\t<p>Resetting your data will delete your drawing and cannot be undone.</p>\n\t\t\t\t\t\t<div className=\"tl-error-boundary__content__actions\">\n\t\t\t\t\t\t\t<button onClick={() => setShouldShowResetConfirmation(false)}>Cancel</button>\n\t\t\t\t\t\t\t<button className=\"tl-error-boundary__reset\" onClick={resetLocalState}>\n\t\t\t\t\t\t\t\tReset data\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<h2>Something&apos;s gone wrong.</h2>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tSorry, we encountered an error. Please refresh the page to continue. If you keep\n\t\t\t\t\t\t\tseeing this error, you can <a href={url.toString()}>create a GitHub issue</a> or{' '}\n\t\t\t\t\t\t\t<a href=\"https://discord.gg/Cq6cPsTfNy\">ask for help on Discord</a>.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t{shouldShowError && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\tMessage:\n\t\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t\t<code>{errorMessage}</code>\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\tStack trace:\n\t\t\t\t\t\t\t\t<div className=\"tl-error-boundary__content__error\">\n\t\t\t\t\t\t\t\t\t<pre>\n\t\t\t\t\t\t\t\t\t\t<code>{errorStack ?? errorMessage}</code>\n\t\t\t\t\t\t\t\t\t</pre>\n\t\t\t\t\t\t\t\t\t<button onClick={copyError}>{didCopy ? 'Copied!' : 'Copy'}</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<div className=\"tl-error-boundary__content__actions\">\n\t\t\t\t\t\t\t<button onClick={() => setShouldShowError(!shouldShowError)}>\n\t\t\t\t\t\t\t\t{shouldShowError ? 'Hide details' : 'Show details'}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<div className=\"tl-error-boundary__content__actions__group\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclassName=\"tl-error-boundary__reset\"\n\t\t\t\t\t\t\t\t\tonClick={() => setShouldShowResetConfirmation(true)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tReset data\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button className=\"tl-error-boundary__refresh\" onClick={refresh}>\n\t\t\t\t\t\t\t\t\tRefresh Page\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n", "import React from 'react'\nimport { Editor } from '../editor/Editor'\n\n/** @internal */\nexport const EditorContext = React.createContext({} as Editor)\n\n/** @public */\nexport function useEditor(): Editor {\n\treturn React.useContext(EditorContext)\n}\n", "import { ComponentType, ReactNode, createContext, useContext, useMemo } from 'react'\nimport { DefaultBackground } from '../components/default-components/DefaultBackground'\nimport { DefaultBrush, TLBrushProps } from '../components/default-components/DefaultBrush'\nimport {\n\tDefaultCanvas,\n\tTLCanvasComponentProps,\n} from '../components/default-components/DefaultCanvas'\nimport {\n\tDefaultCollaboratorHint,\n\tTLCollaboratorHintProps,\n} from '../components/default-components/DefaultCollaboratorHint'\nimport { DefaultCursor, TLCursorProps } from '../components/default-components/DefaultCursor'\nimport {\n\tDefaultErrorFallback,\n\tTLErrorFallbackComponent,\n} from '../components/default-components/DefaultErrorFallback'\nimport { DefaultGrid, TLGridProps } from '../components/default-components/DefaultGrid'\nimport { DefaultHandle, TLHandleProps } from '../components/default-components/DefaultHandle'\nimport { DefaultHandles, TLHandlesProps } from '../components/default-components/DefaultHandles'\nimport { DefaultScribble, TLScribbleProps } from '../components/default-components/DefaultScribble'\nimport {\n\tDefaultSelectionBackground,\n\tTLSelectionBackgroundProps,\n} from '../components/default-components/DefaultSelectionBackground'\nimport {\n\tDefaultSelectionForeground,\n\tTLSelectionForegroundProps,\n} from '../components/default-components/DefaultSelectionForeground'\nimport {\n\tDefaultShapeErrorFallback,\n\tTLShapeErrorFallbackComponent,\n} from '../components/default-components/DefaultShapeErrorFallback'\nimport {\n\tDefaultShapeIndicator,\n\tTLShapeIndicatorProps,\n} from '../components/default-components/DefaultShapeIndicator'\nimport {\n\tDefaultShapeIndicatorErrorFallback,\n\tTLShapeIndicatorErrorFallbackComponent,\n} from '../components/default-components/DefaultShapeIndicatorErrorFallback'\nimport {\n\tDefaultSnapIndicator,\n\tTLSnapIndicatorProps,\n} from '../components/default-components/DefaultSnapIndictor'\nimport { DefaultSpinner } from '../components/default-components/DefaultSpinner'\nimport { DefaultSvgDefs } from '../components/default-components/DefaultSvgDefs'\nimport { useShallowObjectIdentity } from './useIdentity'\n\nexport interface BaseEditorComponents {\n\tBackground: ComponentType\n\tSvgDefs: ComponentType\n\tBrush: ComponentType<TLBrushProps>\n\tZoomBrush: ComponentType<TLBrushProps>\n\tShapeIndicator: ComponentType<TLShapeIndicatorProps>\n\tCursor: ComponentType<TLCursorProps>\n\tCanvas: ComponentType<TLCanvasComponentProps>\n\tCollaboratorBrush: ComponentType<TLBrushProps>\n\tCollaboratorCursor: ComponentType<TLCursorProps>\n\tCollaboratorHint: ComponentType<TLCollaboratorHintProps>\n\tCollaboratorShapeIndicator: ComponentType<TLShapeIndicatorProps>\n\tGrid: ComponentType<TLGridProps>\n\tScribble: ComponentType<TLScribbleProps>\n\tCollaboratorScribble: ComponentType<TLScribbleProps>\n\tSnapIndicator: ComponentType<TLSnapIndicatorProps>\n\tHandles: ComponentType<TLHandlesProps>\n\tHandle: ComponentType<TLHandleProps>\n\tSpinner: ComponentType\n\tSelectionForeground: ComponentType<TLSelectionForegroundProps>\n\tSelectionBackground: ComponentType<TLSelectionBackgroundProps>\n\tOnTheCanvas: ComponentType\n\tInFrontOfTheCanvas: ComponentType\n\tLoadingScreen: ComponentType\n}\n\n// These will always have defaults\ntype ErrorComponents = {\n\tErrorFallback: TLErrorFallbackComponent\n\tShapeErrorFallback: TLShapeErrorFallbackComponent\n\tShapeIndicatorErrorFallback: TLShapeIndicatorErrorFallbackComponent\n}\n\n/** @public */\nexport type TLEditorComponents = Partial<\n\t{\n\t\t[K in keyof BaseEditorComponents]: BaseEditorComponents[K] | null\n\t} & ErrorComponents\n>\n\nconst EditorComponentsContext = createContext({} as TLEditorComponents & ErrorComponents)\n\ntype ComponentsContextProviderProps = {\n\toverrides?: TLEditorComponents\n\tchildren: ReactNode\n}\n\nexport function EditorComponentsProvider({\n\toverrides = {},\n\tchildren,\n}: ComponentsContextProviderProps) {\n\tconst _overrides = useShallowObjectIdentity(overrides)\n\treturn (\n\t\t<EditorComponentsContext.Provider\n\t\t\tvalue={useMemo(\n\t\t\t\t() => ({\n\t\t\t\t\tBackground: DefaultBackground,\n\t\t\t\t\tSvgDefs: DefaultSvgDefs,\n\t\t\t\t\tBrush: DefaultBrush,\n\t\t\t\t\tZoomBrush: DefaultBrush,\n\t\t\t\t\tScreenshotBrush: DefaultBrush,\n\t\t\t\t\tCollaboratorBrush: DefaultBrush,\n\t\t\t\t\tCursor: DefaultCursor,\n\t\t\t\t\tCollaboratorCursor: DefaultCursor,\n\t\t\t\t\tCollaboratorHint: DefaultCollaboratorHint,\n\t\t\t\t\tCollaboratorShapeIndicator: DefaultShapeIndicator,\n\t\t\t\t\tGrid: DefaultGrid,\n\t\t\t\t\tScribble: DefaultScribble,\n\t\t\t\t\tSnapIndicator: DefaultSnapIndicator,\n\t\t\t\t\tHandles: DefaultHandles,\n\t\t\t\t\tHandle: DefaultHandle,\n\t\t\t\t\tCollaboratorScribble: DefaultScribble,\n\t\t\t\t\tErrorFallback: DefaultErrorFallback,\n\t\t\t\t\tShapeErrorFallback: DefaultShapeErrorFallback,\n\t\t\t\t\tShapeIndicatorErrorFallback: DefaultShapeIndicatorErrorFallback,\n\t\t\t\t\tSpinner: DefaultSpinner,\n\t\t\t\t\tSelectionBackground: DefaultSelectionBackground,\n\t\t\t\t\tSelectionForeground: DefaultSelectionForeground,\n\t\t\t\t\tShapeIndicator: DefaultShapeIndicator,\n\t\t\t\t\tOnTheCanvas: null,\n\t\t\t\t\tInFrontOfTheCanvas: null,\n\t\t\t\t\tCanvas: DefaultCanvas,\n\t\t\t\t\t..._overrides,\n\t\t\t\t}),\n\t\t\t\t[_overrides]\n\t\t\t)}\n\t\t>\n\t\t\t{children}\n\t\t</EditorComponentsContext.Provider>\n\t)\n}\n\n/** @public */\nexport function useEditorComponents() {\n\treturn useContext(EditorComponentsContext)\n}\n", "/** @public */\nexport function DefaultBackground() {\n\treturn <div className=\"tl-background\" />\n}\n", "import { BoxModel } from '@tldraw/tlschema'\nimport { useRef } from 'react'\nimport { useTransform } from '../../hooks/useTransform'\nimport { toDomPrecision } from '../../primitives/utils'\n\n/** @public */\nexport type TLBrushProps = {\n\tbrush: BoxModel\n\tcolor?: string\n\topacity?: number\n\tclassName?: string\n}\n\n/** @public */\nexport const DefaultBrush = ({ brush, color, opacity, className }: TLBrushProps) => {\n\tconst rSvg = useRef<SVGSVGElement>(null)\n\tuseTransform(rSvg, brush.x, brush.y)\n\n\tconst w = toDomPrecision(Math.max(1, brush.w))\n\tconst h = toDomPrecision(Math.max(1, brush.h))\n\n\treturn (\n\t\t<svg className=\"tl-overlays__item\" ref={rSvg}>\n\t\t\t{color ? (\n\t\t\t\t<g className=\"tl-brush\" opacity={opacity}>\n\t\t\t\t\t<rect width={w} height={h} fill={color} opacity={0.75} />\n\t\t\t\t\t<rect width={w} height={h} fill=\"none\" stroke={color} opacity={0.1} />\n\t\t\t\t</g>\n\t\t\t) : (\n\t\t\t\t<rect className={`tl-brush tl-brush__default ${className}`} width={w} height={h} />\n\t\t\t)}\n\t\t</svg>\n\t)\n}\n", "import { useLayoutEffect } from 'react'\nimport { VecLike } from '../primitives/Vec'\n\n/** @public */\nexport function useTransform(\n\tref: React.RefObject<HTMLElement | SVGElement>,\n\tx?: number,\n\ty?: number,\n\tscale?: number,\n\trotate?: number,\n\tadditionalOffset?: VecLike\n) {\n\tuseLayoutEffect(() => {\n\t\tconst elm = ref.current\n\t\tif (!elm) return\n\t\tif (x === undefined) return\n\n\t\tlet trans = `translate(${x}px, ${y}px)`\n\t\tif (scale !== undefined) {\n\t\t\ttrans += ` scale(${scale})`\n\t\t}\n\t\tif (rotate !== undefined) {\n\t\t\ttrans += ` rotate(${rotate}rad)`\n\t\t}\n\t\tif (additionalOffset) {\n\t\t\ttrans += ` translate(${additionalOffset.x}px, ${additionalOffset.y}px)`\n\t\t}\n\t\telm.style.transform = trans\n\t})\n}\n", "/** @public */\nexport const EASINGS = {\n\tlinear: (t: number) => t,\n\teaseInQuad: (t: number) => t * t,\n\teaseOutQuad: (t: number) => t * (2 - t),\n\teaseInOutQuad: (t: number) => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t),\n\teaseInCubic: (t: number) => t * t * t,\n\teaseOutCubic: (t: number) => --t * t * t + 1,\n\teaseInOutCubic: (t: number) =>\n\t\tt < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,\n\teaseInQuart: (t: number) => t * t * t * t,\n\teaseOutQuart: (t: number) => 1 - --t * t * t * t,\n\teaseInOutQuart: (t: number) => (t < 0.5 ? 8 * t * t * t * t : 1 - 8 * --t * t * t * t),\n\teaseInQuint: (t: number) => t * t * t * t * t,\n\teaseOutQuint: (t: number) => 1 + --t * t * t * t * t,\n\teaseInOutQuint: (t: number) => (t < 0.5 ? 16 * t * t * t * t * t : 1 + 16 * --t * t * t * t * t),\n\teaseInSine: (t: number) => 1 - Math.cos((t * Math.PI) / 2),\n\teaseOutSine: (t: number) => Math.sin((t * Math.PI) / 2),\n\teaseInOutSine: (t: number) => -(Math.cos(Math.PI * t) - 1) / 2,\n\teaseInExpo: (t: number) => (t <= 0 ? 0 : Math.pow(2, 10 * t - 10)),\n\teaseOutExpo: (t: number) => (t >= 1 ? 1 : 1 - Math.pow(2, -10 * t)),\n\teaseInOutExpo: (t: number) =>\n\t\tt <= 0\n\t\t\t? 0\n\t\t\t: t >= 1\n\t\t\t\t? 1\n\t\t\t\t: t < 0.5\n\t\t\t\t\t? Math.pow(2, 20 * t - 10) / 2\n\t\t\t\t\t: (2 - Math.pow(2, -20 * t + 10)) / 2,\n} as const\n\n/** @public */\nexport type EasingType = keyof typeof EASINGS\n", "import { VecModel } from '@tldraw/tlschema'\nimport { EASINGS } from './easings'\n\n/** @public */\nexport type VecLike = Vec | VecModel\n\n/** @public */\nexport class Vec {\n\tconstructor(\n\t\tpublic x = 0,\n\t\tpublic y = 0,\n\t\tpublic z = 1\n\t) {}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget pressure() {\n\t\treturn this.z\n\t}\n\n\tset(x = this.x, y = this.y, z = this.z) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis.z = z\n\t\treturn this\n\t}\n\n\tsetTo({ x = 0, y = 0, z = 1 }: VecLike) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis.z = z\n\t\treturn this\n\t}\n\n\trot(r: number) {\n\t\tif (r === 0) return this\n\t\tconst { x, y } = this\n\t\tconst s = Math.sin(r)\n\t\tconst c = Math.cos(r)\n\t\tthis.x = x * c - y * s\n\t\tthis.y = x * s + y * c\n\t\treturn this\n\t}\n\n\trotWith(C: VecLike, r: number) {\n\t\tif (r === 0) return this\n\t\tconst x = this.x - C.x\n\t\tconst y = this.y - C.y\n\t\tconst s = Math.sin(r)\n\t\tconst c = Math.cos(r)\n\t\tthis.x = C.x + (x * c - y * s)\n\t\tthis.y = C.y + (x * s + y * c)\n\t\treturn this\n\t}\n\n\tclone(): Vec {\n\t\tconst { x, y, z } = this\n\t\treturn new Vec(x, y, z)\n\t}\n\n\tsub(V: VecLike) {\n\t\tthis.x -= V.x\n\t\tthis.y -= V.y\n\t\treturn this\n\t}\n\n\tsubXY(x: number, y: number) {\n\t\tthis.x -= x\n\t\tthis.y -= y\n\t\treturn this\n\t}\n\n\tsubScalar(n: number) {\n\t\tthis.x -= n\n\t\tthis.y -= n\n\t\t// this.z -= n\n\n\t\treturn this\n\t}\n\n\tadd(V: VecLike) {\n\t\tthis.x += V.x\n\t\tthis.y += V.y\n\t\treturn this\n\t}\n\n\taddXY(x: number, y: number) {\n\t\tthis.x += x\n\t\tthis.y += y\n\t\treturn this\n\t}\n\n\taddScalar(n: number) {\n\t\tthis.x += n\n\t\tthis.y += n\n\t\t// this.z += n\n\n\t\treturn this\n\t}\n\n\tclamp(min: number, max?: number) {\n\t\tthis.x = Math.max(this.x, min)\n\t\tthis.y = Math.max(this.y, min)\n\t\tif (max !== undefined) {\n\t\t\tthis.x = Math.min(this.x, max)\n\t\t\tthis.y = Math.min(this.y, max)\n\t\t}\n\t\treturn this\n\t}\n\n\tdiv(t: number) {\n\t\tthis.x /= t\n\t\tthis.y /= t\n\t\t// this.z /= t\n\t\treturn this\n\t}\n\n\tdivV(V: VecLike) {\n\t\tthis.x /= V.x\n\t\tthis.y /= V.y\n\t\t// this.z /= V.z\n\t\treturn this\n\t}\n\n\tmul(t: number) {\n\t\tthis.x *= t\n\t\tthis.y *= t\n\t\t// this.z *= t\n\t\treturn this\n\t}\n\n\tmulV(V: VecLike) {\n\t\tthis.x *= V.x\n\t\tthis.y *= V.y\n\t\t// this.z *= V.z\n\t\treturn this\n\t}\n\n\tabs() {\n\t\tthis.x = Math.abs(this.x)\n\t\tthis.y = Math.abs(this.y)\n\t\treturn this\n\t}\n\n\tnudge(B: VecLike, distance: number) {\n\t\tconst tan = Vec.Tan(B, this)\n\t\treturn this.add(tan.mul(distance))\n\t}\n\n\tneg() {\n\t\tthis.x *= -1\n\t\tthis.y *= -1\n\t\t// this.z *= -1\n\t\treturn this\n\t}\n\n\tcross(V: VecLike) {\n\t\tthis.x = this.y * V.z! - this.z * V.y\n\t\tthis.y = this.z * V.x - this.x * V.z!\n\t\t// this.z = this.x * V.y - this.y * V.x\n\t\treturn this\n\t}\n\n\tdpr(V: VecLike): number {\n\t\treturn Vec.Dpr(this, V)\n\t}\n\n\tcpr(V: VecLike) {\n\t\treturn Vec.Cpr(this, V)\n\t}\n\n\tlen2(): number {\n\t\treturn Vec.Len2(this)\n\t}\n\n\tlen(): number {\n\t\treturn Vec.Len(this)\n\t}\n\n\tpry(V: VecLike): number {\n\t\treturn Vec.Pry(this, V)\n\t}\n\n\tper() {\n\t\tconst { x, y } = this\n\t\tthis.x = y\n\t\tthis.y = -x\n\t\treturn this\n\t}\n\n\tuni() {\n\t\treturn Vec.Uni(this)\n\t}\n\n\ttan(V: VecLike): Vec {\n\t\treturn Vec.Tan(this, V)\n\t}\n\n\tdist(V: VecLike): number {\n\t\treturn Vec.Dist(this, V)\n\t}\n\n\tdistanceToLineSegment(A: VecLike, B: VecLike): number {\n\t\treturn Vec.DistanceToLineSegment(A, B, this)\n\t}\n\n\tslope(B: VecLike): number {\n\t\treturn Vec.Slope(this, B)\n\t}\n\n\tsnapToGrid(gridSize: number) {\n\t\tthis.x = Math.round(this.x / gridSize) * gridSize\n\t\tthis.y = Math.round(this.y / gridSize) * gridSize\n\t\treturn this\n\t}\n\n\tangle(B: VecLike): number {\n\t\treturn Vec.Angle(this, B)\n\t}\n\n\ttoAngle() {\n\t\treturn Vec.ToAngle(this)\n\t}\n\n\tlrp(B: VecLike, t: number): Vec {\n\t\tthis.x = this.x + (B.x - this.x) * t\n\t\tthis.y = this.y + (B.y - this.y) * t\n\t\treturn this\n\t}\n\n\tequals(B: VecLike) {\n\t\treturn Vec.Equals(this, B)\n\t}\n\n\tequalsXY(x: number, y: number) {\n\t\treturn Vec.EqualsXY(this, x, y)\n\t}\n\n\tnorm() {\n\t\tconst l = this.len()\n\t\tthis.x = l === 0 ? 0 : this.x / l\n\t\tthis.y = l === 0 ? 0 : this.y / l\n\t\treturn this\n\t}\n\n\ttoFixed() {\n\t\treturn Vec.ToFixed(this)\n\t}\n\n\ttoString() {\n\t\treturn Vec.ToString(Vec.ToFixed(this))\n\t}\n\n\ttoJson(): VecModel {\n\t\treturn Vec.ToJson(this)\n\t}\n\n\ttoArray(): number[] {\n\t\treturn Vec.ToArray(this)\n\t}\n\n\tstatic Add(A: VecLike, B: VecLike): Vec {\n\t\treturn new Vec(A.x + B.x, A.y + B.y)\n\t}\n\n\tstatic AddXY(A: VecLike, x: number, y: number): Vec {\n\t\treturn new Vec(A.x + x, A.y + y)\n\t}\n\n\tstatic Sub(A: VecLike, B: VecLike): Vec {\n\t\treturn new Vec(A.x - B.x, A.y - B.y)\n\t}\n\n\tstatic SubXY(A: VecLike, x: number, y: number): Vec {\n\t\treturn new Vec(A.x - x, A.y - y)\n\t}\n\n\tstatic AddScalar(A: VecLike, n: number): Vec {\n\t\treturn new Vec(A.x + n, A.y + n)\n\t}\n\n\tstatic SubScalar(A: VecLike, n: number): Vec {\n\t\treturn new Vec(A.x - n, A.y - n)\n\t}\n\n\tstatic Div(A: VecLike, t: number): Vec {\n\t\treturn new Vec(A.x / t, A.y / t)\n\t}\n\n\tstatic Mul(A: VecLike, t: number): Vec {\n\t\treturn new Vec(A.x * t, A.y * t)\n\t}\n\n\tstatic DivV(A: VecLike, B: VecLike): Vec {\n\t\treturn new Vec(A.x / B.x, A.y / B.y)\n\t}\n\n\tstatic MulV(A: VecLike, B: VecLike): Vec {\n\t\treturn new Vec(A.x * B.x, A.y * B.y)\n\t}\n\n\tstatic Neg(A: VecLike): Vec {\n\t\treturn new Vec(-A.x, -A.y)\n\t}\n\n\t/**\n\t * Get the perpendicular vector to A.\n\t */\n\tstatic Per(A: VecLike): Vec {\n\t\treturn new Vec(A.y, -A.x)\n\t}\n\n\tstatic Abs(A: VecLike): Vec {\n\t\treturn new Vec(Math.abs(A.x), Math.abs(A.y))\n\t}\n\n\t// Get the distance between two points.\n\tstatic Dist(A: VecLike, B: VecLike): number {\n\t\treturn ((A.y - B.y) ** 2 + (A.x - B.x) ** 2) ** 0.5\n\t}\n\n\t// Get whether a distance between two points is less than a number. This is faster to calulate than using `Vec.Dist(a, b) < n`.\n\tstatic DistMin(A: VecLike, B: VecLike, n: number): boolean {\n\t\treturn (A.x - B.x) * (A.x - B.x) + (A.y - B.y) * (A.y - B.y) < n ** 2\n\t}\n\n\t// Get the squared distance between two points. This is faster to calculate (no square root) so useful for \"minimum distance\" checks where the actual measurement does not matter.\n\tstatic Dist2(A: VecLike, B: VecLike): number {\n\t\treturn (A.x - B.x) * (A.x - B.x) + (A.y - B.y) * (A.y - B.y)\n\t}\n\n\t/**\n\t * Dot product of two vectors which is used to calculate the angle between them.\n\t */\n\tstatic Dpr(A: VecLike, B: VecLike): number {\n\t\treturn A.x * B.x + A.y * B.y\n\t}\n\n\tstatic Cross(A: VecLike, V: VecLike) {\n\t\treturn new Vec(\n\t\t\tA.y * V.z! - A.z! * V.y,\n\t\t\tA.z! * V.x - A.x * V.z!\n\t\t\t// A.z = A.x * V.y - A.y * V.x\n\t\t)\n\t}\n\n\t/**\n\t * Cross product of two vectors which is used to calculate the area of a parallelogram.\n\t */\n\tstatic Cpr(A: VecLike, B: VecLike) {\n\t\treturn A.x * B.y - B.x * A.y\n\t}\n\n\tstatic Len2(A: VecLike): number {\n\t\treturn A.x * A.x + A.y * A.y\n\t}\n\n\tstatic Len(A: VecLike): number {\n\t\treturn (A.x * A.x + A.y * A.y) ** 0.5\n\t}\n\n\t/**\n\t * Get the projection of A onto B.\n\t */\n\tstatic Pry(A: VecLike, B: VecLike): number {\n\t\treturn Vec.Dpr(A, B) / Vec.Len(B)\n\t}\n\n\t/**\n\t * Get the unit vector of A.\n\t */\n\tstatic Uni(A: VecLike) {\n\t\treturn Vec.Div(A, Vec.Len(A))\n\t}\n\n\tstatic Tan(A: VecLike, B: VecLike): Vec {\n\t\treturn Vec.Uni(Vec.Sub(A, B))\n\t}\n\n\tstatic Min(A: VecLike, B: VecLike): Vec {\n\t\treturn new Vec(Math.min(A.x, B.x), Math.min(A.y, B.y))\n\t}\n\n\tstatic Max(A: VecLike, B: VecLike): Vec {\n\t\treturn new Vec(Math.max(A.x, B.x), Math.max(A.y, B.y))\n\t}\n\n\tstatic From({ x, y, z = 1 }: VecModel) {\n\t\treturn new Vec(x, y, z)\n\t}\n\n\tstatic FromArray(v: number[]): Vec {\n\t\treturn new Vec(v[0], v[1])\n\t}\n\n\tstatic Rot(A: VecLike, r = 0): Vec {\n\t\tconst s = Math.sin(r)\n\t\tconst c = Math.cos(r)\n\t\treturn new Vec(A.x * c - A.y * s, A.x * s + A.y * c)\n\t}\n\n\tstatic RotWith(A: VecLike, C: VecLike, r: number): Vec {\n\t\tconst x = A.x - C.x\n\t\tconst y = A.y - C.y\n\t\tconst s = Math.sin(r)\n\t\tconst c = Math.cos(r)\n\t\treturn new Vec(C.x + (x * c - y * s), C.y + (x * s + y * c))\n\t}\n\n\t/**\n\t * Get the nearest point on a line with a known unit vector that passes through point A\n\t *\n\t * ```ts\n\t * Vec.nearestPointOnLineThroughPoint(A, u, Point)\n\t * ```\n\t *\n\t * @param A - Any point on the line\n\t * @param u - The unit vector for the line.\n\t * @param P - A point not on the line to test.\n\t */\n\tstatic NearestPointOnLineThroughPoint(A: VecLike, u: VecLike, P: VecLike): Vec {\n\t\treturn Vec.Mul(u, Vec.Sub(P, A).pry(u)).add(A)\n\t}\n\n\tstatic NearestPointOnLineSegment(A: VecLike, B: VecLike, P: VecLike, clamp = true): Vec {\n\t\tif (Vec.Equals(A, P)) return Vec.From(P)\n\t\tif (Vec.Equals(B, P)) return Vec.From(P)\n\n\t\tconst u = Vec.Tan(B, A)\n\t\tconst C = Vec.Add(A, Vec.Mul(u, Vec.Sub(P, A).pry(u)))\n\n\t\tif (clamp) {\n\t\t\tif (C.x < Math.min(A.x, B.x)) return Vec.Cast(A.x < B.x ? A : B)\n\t\t\tif (C.x > Math.max(A.x, B.x)) return Vec.Cast(A.x > B.x ? A : B)\n\t\t\tif (C.y < Math.min(A.y, B.y)) return Vec.Cast(A.y < B.y ? A : B)\n\t\t\tif (C.y > Math.max(A.y, B.y)) return Vec.Cast(A.y > B.y ? A : B)\n\t\t}\n\n\t\treturn C\n\t}\n\n\tstatic DistanceToLineThroughPoint(A: VecLike, u: VecLike, P: VecLike): number {\n\t\treturn Vec.Dist(P, Vec.NearestPointOnLineThroughPoint(A, u, P))\n\t}\n\n\tstatic DistanceToLineSegment(A: VecLike, B: VecLike, P: VecLike, clamp = true): number {\n\t\treturn Vec.Dist(P, Vec.NearestPointOnLineSegment(A, B, P, clamp))\n\t}\n\n\tstatic Snap(A: VecLike, step = 1) {\n\t\treturn new Vec(Math.round(A.x / step) * step, Math.round(A.y / step) * step)\n\t}\n\n\tstatic Cast(A: VecLike): Vec {\n\t\tif (A instanceof Vec) return A\n\t\treturn Vec.From(A)\n\t}\n\n\tstatic Slope(A: VecLike, B: VecLike): number {\n\t\tif (A.x === B.y) return NaN\n\t\treturn (A.y - B.y) / (A.x - B.x)\n\t}\n\n\tstatic IsNaN(A: VecLike): boolean {\n\t\treturn isNaN(A.x) || isNaN(A.y)\n\t}\n\n\tstatic Angle(A: VecLike, B: VecLike): number {\n\t\treturn Math.atan2(B.y - A.y, B.x - A.x)\n\t}\n\n\t/**\n\t * Linearly interpolate between two points.\n\t * @param A - The first point.\n\t * @param B - The second point.\n\t * @param t - The interpolation value between 0 and 1.\n\t * @returns The interpolated point.\n\t */\n\tstatic Lrp(A: VecLike, B: VecLike, t: number): Vec {\n\t\treturn Vec.Sub(B, A).mul(t).add(A)\n\t}\n\n\tstatic Med(A: VecLike, B: VecLike): Vec {\n\t\treturn new Vec((A.x + B.x) / 2, (A.y + B.y) / 2)\n\t}\n\n\tstatic Equals(A: VecLike, B: VecLike): boolean {\n\t\treturn Math.abs(A.x - B.x) < 0.0001 && Math.abs(A.y - B.y) < 0.0001\n\t}\n\n\tstatic EqualsXY(A: VecLike, x: number, y: number): boolean {\n\t\treturn A.x === x && A.y === y\n\t}\n\n\tstatic Clockwise(A: VecLike, B: VecLike, C: VecLike): boolean {\n\t\treturn (C.x - A.x) * (B.y - A.y) - (B.x - A.x) * (C.y - A.y) < 0\n\t}\n\n\tstatic Rescale(A: VecLike, n: number) {\n\t\tconst l = Vec.Len(A)\n\t\treturn new Vec((n * A.x) / l, (n * A.y) / l)\n\t}\n\n\tstatic ScaleWithOrigin(A: VecLike, scale: number, origin: VecLike) {\n\t\treturn Vec.Sub(A, origin).mul(scale).add(origin)\n\t}\n\n\tstatic ToFixed(A: VecLike, n = 2) {\n\t\treturn new Vec(+A.x.toFixed(n), +A.y.toFixed(n), +A.z!.toFixed(n))\n\t}\n\n\tstatic Nudge(A: VecLike, B: VecLike, distance: number) {\n\t\treturn Vec.Add(A, Vec.Tan(B, A).mul(distance))\n\t}\n\n\tstatic ToString(A: VecLike) {\n\t\treturn `${A.x}, ${A.y}`\n\t}\n\n\tstatic ToAngle(A: VecLike) {\n\t\tlet r = Math.atan2(A.y, A.x)\n\t\tif (r < 0) r += Math.PI * 2\n\n\t\treturn r\n\t}\n\n\tstatic FromAngle(r: number, length = 1) {\n\t\treturn new Vec(Math.cos(r) * length, Math.sin(r) * length)\n\t}\n\n\tstatic ToArray(A: VecLike) {\n\t\treturn [A.x, A.y, A.z!]\n\t}\n\n\tstatic ToJson(A: VecLike) {\n\t\tconst { x, y, z } = A\n\t\treturn { x, y, z }\n\t}\n\n\tstatic Average(arr: VecLike[]) {\n\t\tconst len = arr.length\n\t\tconst avg = new Vec(0, 0)\n\t\tif (len === 0) {\n\t\t\treturn avg\n\t\t}\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tavg.add(arr[i])\n\t\t}\n\t\treturn avg.div(len)\n\t}\n\n\tstatic Clamp(A: Vec, min: number, max?: number) {\n\t\tif (max === undefined) {\n\t\t\treturn new Vec(Math.min(Math.max(A.x, min)), Math.min(Math.max(A.y, min)))\n\t\t}\n\n\t\treturn new Vec(Math.min(Math.max(A.x, min), max), Math.min(Math.max(A.y, min), max))\n\t}\n\n\t/**\n\t * Get an array of points (with simulated pressure) between two points.\n\t *\n\t * @param A - The first point.\n\t * @param B - The second point.\n\t * @param steps - The number of points to return.\n\t */\n\tstatic PointsBetween(A: VecModel, B: VecModel, steps = 6): Vec[] {\n\t\tconst results: Vec[] = []\n\n\t\tfor (let i = 0; i < steps; i++) {\n\t\t\tconst t = EASINGS.easeInQuad(i / (steps - 1))\n\t\t\tconst point = Vec.Lrp(A, B, t)\n\t\t\tpoint.z = Math.min(1, 0.5 + Math.abs(0.5 - ease(t)) * 0.65)\n\t\t\tresults.push(point)\n\t\t}\n\n\t\treturn results\n\t}\n\n\tstatic SnapToGrid(A: VecLike, gridSize = 8) {\n\t\treturn new Vec(Math.round(A.x / gridSize) * gridSize, Math.round(A.y / gridSize) * gridSize)\n\t}\n}\n\nconst ease = (t: number) => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t)\n", "import { Vec, VecLike } from './Vec'\n\n/** @public */\nexport function precise(A: VecLike) {\n\treturn `${toDomPrecision(A.x)},${toDomPrecision(A.y)} `\n}\n\n/** @public */\nexport function average(A: VecLike, B: VecLike) {\n\treturn `${toDomPrecision((A.x + B.x) / 2)},${toDomPrecision((A.y + B.y) / 2)} `\n}\n\n/** @public */\nexport const PI = Math.PI\n/** @public */\nexport const HALF_PI = PI / 2\n/** @public */\nexport const PI2 = PI * 2\n/** @public */\nexport const SIN = Math.sin\n\n/**\n * Clamp a value into a range.\n *\n * @example\n *\n * ```ts\n * const A = clamp(0, 1) // 1\n * ```\n *\n * @param n - The number to clamp.\n * @param min - The minimum value.\n * @public\n */\nexport function clamp(n: number, min: number): number\n/**\n * Clamp a value into a range.\n *\n * @example\n *\n * ```ts\n * const A = clamp(0, 1, 10) // 1\n * const B = clamp(11, 1, 10) // 10\n * const C = clamp(5, 1, 10) // 5\n * ```\n *\n * @param n - The number to clamp.\n * @param min - The minimum value.\n * @param max - The maximum value.\n * @public\n */\nexport function clamp(n: number, min: number, max: number): number\nexport function clamp(n: number, min: number, max?: number): number {\n\treturn Math.max(min, typeof max !== 'undefined' ? Math.min(n, max) : n)\n}\n\n/**\n * Get a number to a precision.\n *\n * @param n - The number.\n * @param precision - The precision.\n * @public\n */\nexport function toPrecision(n: number, precision = 10000000000) {\n\tif (!n) return 0\n\treturn Math.round(n * precision) / precision\n}\n\n/**\n * Whether two numbers numbers a and b are approximately equal.\n *\n * @param a - The first point.\n * @param b - The second point.\n * @public\n */\nexport function approximately(a: number, b: number, precision = 0.000001) {\n\treturn Math.abs(a - b) <= precision\n}\n\n/**\n * Find the approximate perimeter of an ellipse.\n *\n * @param rx - The ellipse's x radius.\n * @param ry - The ellipse's y radius.\n * @public\n */\nexport function perimeterOfEllipse(rx: number, ry: number): number {\n\tconst h = Math.pow(rx - ry, 2) / Math.pow(rx + ry, 2)\n\tconst p = PI * (rx + ry) * (1 + (3 * h) / (10 + Math.sqrt(4 - 3 * h)))\n\treturn p\n}\n\n/**\n * @param a - Any angle in radians\n * @returns A number between 0 and 2 * PI\n * @public\n */\nexport function canonicalizeRotation(a: number) {\n\ta = a % PI2\n\tif (a < 0) {\n\t\ta = a + PI2\n\t} else if (a === 0) {\n\t\t// prevent negative zero\n\t\ta = 0\n\t}\n\treturn a\n}\n\n/**\n * Get the clockwise angle distance between two angles.\n *\n * @param a0 - The first angle.\n * @param a1 - The second angle.\n * @public\n */\nexport function clockwiseAngleDist(a0: number, a1: number): number {\n\ta0 = canonicalizeRotation(a0)\n\ta1 = canonicalizeRotation(a1)\n\tif (a0 > a1) {\n\t\ta1 += PI2\n\t}\n\treturn a1 - a0\n}\n\n/**\n * Get the counter-clockwise angle distance between two angles.\n *\n * @param a0 - The first angle.\n * @param a1 - The second angle.\n * @public\n */\nexport function counterClockwiseAngleDist(a0: number, a1: number): number {\n\treturn PI2 - clockwiseAngleDist(a0, a1)\n}\n\n/**\n * Get the short angle distance between two angles.\n *\n * @param a0 - The first angle.\n * @param a1 - The second angle.\n * @public\n */\nexport function shortAngleDist(a0: number, a1: number): number {\n\tconst da = (a1 - a0) % PI2\n\treturn ((2 * da) % PI2) - da\n}\n\n/**\n * Clamp radians within 0 and 2PI\n *\n * @param r - The radian value.\n * @public\n */\nexport function clampRadians(r: number): number {\n\treturn (PI2 + r) % PI2\n}\n\n/**\n * Clamp rotation to even segments.\n *\n * @param r - The rotation in radians.\n * @param segments - The number of segments.\n * @public\n */\nexport function snapAngle(r: number, segments: number): number {\n\tconst seg = PI2 / segments\n\tlet ang = (Math.floor((clampRadians(r) + seg / 2) / seg) * seg) % PI2\n\tif (ang < PI) ang += PI2\n\tif (ang > PI) ang -= PI2\n\treturn ang\n}\n\n/**\n * Checks whether two angles are approximately at right-angles or parallel to each other\n *\n * @param a - Angle a (radians)\n * @param b - Angle b (radians)\n * @returns True iff the angles are approximately at right-angles or parallel to each other\n * @public\n */\nexport function areAnglesCompatible(a: number, b: number) {\n\treturn a === b || approximately((a % (Math.PI / 2)) - (b % (Math.PI / 2)), 0)\n}\n\n/**\n * Convert degrees to radians.\n *\n * @param d - The degree in degrees.\n * @public\n */\nexport function degreesToRadians(d: number): number {\n\treturn (d * PI) / 180\n}\n\n/**\n * Convert radians to degrees.\n *\n * @param r - The degree in radians.\n * @public\n */\nexport function radiansToDegrees(r: number): number {\n\treturn (r * 180) / PI\n}\n\n/**\n * Get a point on the perimeter of a circle.\n *\n * @param center - The center of the circle.\n * @param r - The radius of the circle.\n * @param a - The angle in radians.\n * @public\n */\nexport function getPointOnCircle(center: VecLike, r: number, a: number) {\n\treturn new Vec(center.x, center.y).add(Vec.FromAngle(a, r))\n}\n\n/** @public */\nexport function getPolygonVertices(width: number, height: number, sides: number) {\n\tconst cx = width / 2\n\tconst cy = height / 2\n\tconst pointsOnPerimeter: Vec[] = []\n\n\tlet minX = Infinity\n\tlet maxX = -Infinity\n\tlet minY = Infinity\n\tlet maxY = -Infinity\n\tfor (let i = 0; i < sides; i++) {\n\t\tconst step = PI2 / sides\n\t\tconst t = -HALF_PI + i * step\n\t\tconst x = cx + cx * Math.cos(t)\n\t\tconst y = cy + cy * Math.sin(t)\n\t\tif (x < minX) minX = x\n\t\tif (y < minY) minY = y\n\t\tif (x > maxX) maxX = x\n\t\tif (y > maxY) maxY = y\n\t\tpointsOnPerimeter.push(new Vec(x, y))\n\t}\n\n\t// Bounds of calculated points\n\tconst w = maxX - minX\n\tconst h = maxY - minY\n\n\t// Difference between input bounds and calculated bounds\n\tconst dx = width - w\n\tconst dy = height - h\n\n\t// If there's a difference, scale the points to the input bounds\n\tif (dx !== 0 || dy !== 0) {\n\t\tfor (let i = 0; i < pointsOnPerimeter.length; i++) {\n\t\t\tconst pt = pointsOnPerimeter[i]\n\t\t\tpt.x = ((pt.x - minX) / w) * width\n\t\t\tpt.y = ((pt.y - minY) / h) * height\n\t\t}\n\t}\n\n\treturn pointsOnPerimeter\n}\n\n/**\n * @param a0 - The start point in the A range\n * @param a1 - The end point in the A range\n * @param b0 - The start point in the B range\n * @param b1 - The end point in the B range\n * @returns True if the ranges overlap\n * @public\n */\nexport function rangesOverlap(a0: number, a1: number, b0: number, b1: number): boolean {\n\treturn a0 < b1 && b0 < a1\n}\n\n/**\n * Finds the intersection of two ranges.\n *\n * @param a0 - The start point in the A range\n * @param a1 - The end point in the A range\n * @param b0 - The start point in the B range\n * @param b1 - The end point in the B range\n * @returns The intersection of the ranges, or null if no intersection\n * @public\n */\nexport function rangeIntersection(\n\ta0: number,\n\ta1: number,\n\tb0: number,\n\tb1: number\n): [number, number] | null {\n\tconst min = Math.max(a0, b0)\n\tconst max = Math.min(a1, b1)\n\tif (min <= max) {\n\t\treturn [min, max]\n\t}\n\treturn null\n}\n\n/** Helper for point in polygon */\nfunction cross(x: VecLike, y: VecLike, z: VecLike): number {\n\treturn (y.x - x.x) * (z.y - x.y) - (z.x - x.x) * (y.y - x.y)\n}\n\n/**\n * Get whether a point is inside of a polygon.\n *\n * ```ts\n * const result = pointInPolygon(myPoint, myPoints)\n * ```\n *\n * @public\n */\nexport function pointInPolygon(A: VecLike, points: VecLike[]): boolean {\n\tlet windingNumber = 0\n\tlet a: VecLike\n\tlet b: VecLike\n\n\tfor (let i = 0; i < points.length; i++) {\n\t\ta = points[i]\n\t\t// Point is the same as one of the corners of the polygon\n\t\tif (a.x === A.x && a.y === A.y) return true\n\n\t\tb = points[(i + 1) % points.length]\n\n\t\t// Point is on the polygon edge\n\t\tif (Vec.Dist(A, a) + Vec.Dist(A, b) === Vec.Dist(a, b)) return true\n\n\t\tif (a.y <= A.y) {\n\t\t\tif (b.y > A.y && cross(a, b, A) > 0) {\n\t\t\t\twindingNumber += 1\n\t\t\t}\n\t\t} else if (b.y <= A.y && cross(a, b, A) < 0) {\n\t\t\twindingNumber -= 1\n\t\t}\n\t}\n\n\treturn windingNumber !== 0\n}\n\n/**\n * The DOM likes values to be fixed to 3 decimal places\n *\n * @public\n */\nexport function toDomPrecision(v: number) {\n\treturn Math.round(v * 1e4) / 1e4\n}\n\n/**\n * @public\n */\nexport function toFixed(v: number) {\n\treturn Math.round(v * 1e2) / 1e2\n}\n\n/**\n * Check if a float is safe to use. ie: Not too big or small.\n * @public\n */\nexport const isSafeFloat = (n: number) => {\n\treturn Math.abs(n) < Number.MAX_SAFE_INTEGER\n}\n\n/**\n * Get the angle of a point on an arc.\n * @param fromAngle - The angle from center to arc's start point (A) on the circle\n * @param toAngle - The angle from center to arc's end point (B) on the circle\n * @param direction - The direction of the arc (1 = counter-clockwise, -1 = clockwise)\n * @returns The distance in radians between the two angles according to the direction\n * @public\n */\nexport function angleDistance(fromAngle: number, toAngle: number, direction: number) {\n\tconst dist =\n\t\tdirection < 0\n\t\t\t? clockwiseAngleDist(fromAngle, toAngle)\n\t\t\t: counterClockwiseAngleDist(fromAngle, toAngle)\n\treturn dist\n}\n\n/**\n * Returns the t value of the point on the arc.\n *\n * @param mAB - The measure of the arc from A to B, negative if counter-clockwise\n * @param A - The angle from center to arc's start point (A) on the circle\n * @param B - The angle from center to arc's end point (B) on the circle\n * @param P - The angle on the circle (P) to find the t value for\n *\n * @returns The t value of the point on the arc, with 0 being the start and 1 being the end\n *\n * @public\n */\nexport function getPointInArcT(mAB: number, A: number, B: number, P: number): number {\n\tlet mAP: number\n\tif (Math.abs(mAB) > PI) {\n\t\tmAP = shortAngleDist(A, P)\n\t\tconst mPB = shortAngleDist(P, B)\n\t\tif (Math.abs(mAP) < Math.abs(mPB)) {\n\t\t\treturn mAP / mAB\n\t\t} else {\n\t\t\treturn (mAB - mPB) / mAB\n\t\t}\n\t} else {\n\t\tmAP = shortAngleDist(A, P)\n\t\tconst t = mAP / mAB\n\n\t\t// If the arc is something like -2.8 to 2.2, then we'll get a weird bug\n\t\t// where the measurement to the center is negative but measure to points\n\t\t// near the end are positive\n\t\tif (Math.sign(mAP) !== Math.sign(mAB)) {\n\t\t\treturn Math.abs(t) > 0.5 ? 1 : 0\n\t\t}\n\n\t\treturn t\n\t}\n}\n\n/**\n * Get the measure of an arc.\n *\n * @param A - The angle from center to arc's start point (A) on the circle\n * @param B - The angle from center to arc's end point (B) on the circle\n * @param sweepFlag - 1 if the arc is clockwise, 0 if counter-clockwise\n * @param largeArcFlag - 1 if the arc is greater than 180 degrees, 0 if less than 180 degrees\n *\n * @returns The measure of the arc, negative if counter-clockwise\n *\n * @public\n */\nexport function getArcMeasure(A: number, B: number, sweepFlag: number, largeArcFlag: number) {\n\tconst m = ((2 * ((B - A) % PI2)) % PI2) - ((B - A) % PI2)\n\tif (!largeArcFlag) return m\n\treturn (PI2 - Math.abs(m)) * (sweepFlag ? 1 : -1)\n}\n", "import { react, useQuickReactor, useValue } from '@tldraw/state'\nimport { TLHandle, TLShapeId } from '@tldraw/tlschema'\nimport { dedupe, modulate, objectMapValues } from '@tldraw/utils'\nimport classNames from 'classnames'\nimport { Fragment, JSX, useEffect, useRef, useState } from 'react'\nimport { COARSE_HANDLE_RADIUS, HANDLE_RADIUS, TEXT_SHADOW_LOD } from '../../constants'\nimport { useCanvasEvents } from '../../hooks/useCanvasEvents'\nimport { useCoarsePointer } from '../../hooks/useCoarsePointer'\nimport { useContainer } from '../../hooks/useContainer'\nimport { useDocumentEvents } from '../../hooks/useDocumentEvents'\nimport { useEditor } from '../../hooks/useEditor'\nimport { useEditorComponents } from '../../hooks/useEditorComponents'\nimport { useFixSafariDoubleTapZoomPencilEvents } from '../../hooks/useFixSafariDoubleTapZoomPencilEvents'\nimport { useGestureEvents } from '../../hooks/useGestureEvents'\nimport { useHandleEvents } from '../../hooks/useHandleEvents'\nimport { useScreenBounds } from '../../hooks/useScreenBounds'\nimport { Box } from '../../primitives/Box'\nimport { Mat } from '../../primitives/Mat'\nimport { Vec } from '../../primitives/Vec'\nimport { toDomPrecision } from '../../primitives/utils'\nimport { debugFlags } from '../../utils/debug-flags'\nimport { setStyleProperty } from '../../utils/dom'\nimport { nearestMultiple } from '../../utils/nearestMultiple'\nimport { GeometryDebuggingView } from '../GeometryDebuggingView'\nimport { LiveCollaborators } from '../LiveCollaborators'\nimport { Shape } from '../Shape'\n\n/** @public */\nexport type TLCanvasComponentProps = { className?: string }\n\n/** @public */\nexport function DefaultCanvas({ className }: TLCanvasComponentProps) {\n\tconst editor = useEditor()\n\n\tconst { Background, SvgDefs } = useEditorComponents()\n\n\tconst rCanvas = useRef<HTMLDivElement>(null)\n\tconst rHtmlLayer = useRef<HTMLDivElement>(null)\n\tconst rHtmlLayer2 = useRef<HTMLDivElement>(null)\n\tconst container = useContainer()\n\n\tuseScreenBounds(rCanvas)\n\tuseDocumentEvents()\n\tuseCoarsePointer()\n\n\tuseGestureEvents(rCanvas)\n\tuseFixSafariDoubleTapZoomPencilEvents(rCanvas)\n\n\tconst rMemoizedStuff = useRef({ lodDisableTextOutline: false, allowTextOutline: true })\n\n\tuseQuickReactor(\n\t\t'position layers',\n\t\tfunction positionLayersWhenCameraMoves() {\n\t\t\tconst { x, y, z } = editor.getCamera()\n\n\t\t\t// This should only run once on first load\n\t\t\tif (rMemoizedStuff.current.allowTextOutline && editor.environment.isSafari) {\n\t\t\t\tcontainer.style.setProperty('--tl-text-outline', 'none')\n\t\t\t\trMemoizedStuff.current.allowTextOutline = false\n\t\t\t}\n\n\t\t\t// And this should only run if we're not in Safari;\n\t\t\t// If we're below the lod distance for text shadows, turn them off\n\t\t\tif (\n\t\t\t\trMemoizedStuff.current.allowTextOutline &&\n\t\t\t\tz < TEXT_SHADOW_LOD !== rMemoizedStuff.current.lodDisableTextOutline\n\t\t\t) {\n\t\t\t\tconst lodDisableTextOutline = z < TEXT_SHADOW_LOD\n\t\t\t\tcontainer.style.setProperty(\n\t\t\t\t\t'--tl-text-outline',\n\t\t\t\t\tlodDisableTextOutline\n\t\t\t\t\t\t? 'none'\n\t\t\t\t\t\t: `0 var(--b) 0 var(--color-background), 0 var(--a) 0 var(--color-background),\n\t\t\t\tvar(--b) var(--b) 0 var(--color-background), var(--a) var(--b) 0 var(--color-background),\n\t\t\t\tvar(--a) var(--a) 0 var(--color-background), var(--b) var(--a) 0 var(--color-background)`\n\t\t\t\t)\n\t\t\t\trMemoizedStuff.current.lodDisableTextOutline = lodDisableTextOutline\n\t\t\t}\n\n\t\t\t// Because the html container has a width/height of 1px, we\n\t\t\t// need to create a small offset when zoomed to ensure that\n\t\t\t// the html container and svg container are lined up exactly.\n\t\t\tconst offset =\n\t\t\t\tz >= 1 ? modulate(z, [1, 8], [0.125, 0.5], true) : modulate(z, [0.1, 1], [-2, 0.125], true)\n\n\t\t\tconst transform = `scale(${toDomPrecision(z)}) translate(${toDomPrecision(\n\t\t\t\tx + offset\n\t\t\t)}px,${toDomPrecision(y + offset)}px)`\n\t\t\tsetStyleProperty(rHtmlLayer.current, 'transform', transform)\n\t\t\tsetStyleProperty(rHtmlLayer2.current, 'transform', transform)\n\t\t},\n\t\t[editor, container]\n\t)\n\n\tconst events = useCanvasEvents()\n\n\tconst shapeSvgDefs = useValue(\n\t\t'shapeSvgDefs',\n\t\t() => {\n\t\t\tconst shapeSvgDefsByKey = new Map<string, JSX.Element>()\n\t\t\tfor (const util of objectMapValues(editor.shapeUtils)) {\n\t\t\t\tif (!util) return\n\t\t\t\tconst defs = util.getCanvasSvgDefs()\n\t\t\t\tfor (const { key, component: Component } of defs) {\n\t\t\t\t\tif (shapeSvgDefsByKey.has(key)) continue\n\t\t\t\t\tshapeSvgDefsByKey.set(key, <Component key={key} />)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn [...shapeSvgDefsByKey.values()]\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst hideShapes = useValue('debug_shapes', () => debugFlags.hideShapes.get(), [debugFlags])\n\tconst debugSvg = useValue('debug_svg', () => debugFlags.debugSvg.get(), [debugFlags])\n\tconst debugGeometry = useValue('debug_geometry', () => debugFlags.debugGeometry.get(), [\n\t\tdebugFlags,\n\t])\n\tconst isEditingAnything = useValue(\n\t\t'isEditingAnything',\n\t\t() => editor.getEditingShapeId() !== null,\n\t\t[editor]\n\t)\n\tconst isSelectingAnything = useValue(\n\t\t'isSelectingAnything',\n\t\t() => !!editor.getSelectedShapeIds().length,\n\t\t[editor]\n\t)\n\n\treturn (\n\t\t<div\n\t\t\tref={rCanvas}\n\t\t\tdraggable={false}\n\t\t\tdata-iseditinganything={isEditingAnything}\n\t\t\tdata-isselectinganything={isSelectingAnything}\n\t\t\tclassName={classNames('tl-canvas', className)}\n\t\t\tdata-testid=\"canvas\"\n\t\t\t{...events}\n\t\t>\n\t\t\t<svg className=\"tl-svg-context\">\n\t\t\t\t<defs>\n\t\t\t\t\t{shapeSvgDefs}\n\t\t\t\t\t<CursorDef />\n\t\t\t\t\t<CollaboratorHintDef />\n\t\t\t\t\t{SvgDefs && <SvgDefs />}\n\t\t\t\t</defs>\n\t\t\t</svg>\n\t\t\t{Background && (\n\t\t\t\t<div className=\"tl-background__wrapper\">\n\t\t\t\t\t<Background />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t\t<GridWrapper />\n\t\t\t<div ref={rHtmlLayer} className=\"tl-html-layer tl-shapes\" draggable={false}>\n\t\t\t\t<OnTheCanvasWrapper />\n\t\t\t\t<SelectionBackgroundWrapper />\n\t\t\t\t{hideShapes ? null : debugSvg ? <ShapesWithSVGs /> : <ShapesToDisplay />}\n\t\t\t</div>\n\t\t\t<div className=\"tl-overlays\">\n\t\t\t\t<div ref={rHtmlLayer2} className=\"tl-html-layer\">\n\t\t\t\t\t{debugGeometry ? <GeometryDebuggingView /> : null}\n\t\t\t\t\t<HandlesWrapper />\n\t\t\t\t\t<BrushWrapper />\n\t\t\t\t\t<ScribbleWrapper />\n\t\t\t\t\t<ZoomBrushWrapper />\n\t\t\t\t\t<ShapeIndicators />\n\t\t\t\t\t<HintedShapeIndicator />\n\t\t\t\t\t<SnapIndicatorWrapper />\n\t\t\t\t\t<SelectionForegroundWrapper />\n\t\t\t\t\t<LiveCollaborators />\n\t\t\t\t</div>\n\t\t\t\t<InFrontOfTheCanvasWrapper />\n\t\t\t</div>\n\t\t\t<MovingCameraHitTestBlocker />\n\t\t</div>\n\t)\n}\n\nfunction GridWrapper() {\n\tconst editor = useEditor()\n\tconst gridSize = useValue('gridSize', () => editor.getDocumentSettings().gridSize, [editor])\n\tconst { x, y, z } = useValue('camera', () => editor.getCamera(), [editor])\n\tconst isGridMode = useValue('isGridMode', () => editor.getInstanceState().isGridMode, [editor])\n\tconst { Grid } = useEditorComponents()\n\n\tif (!(Grid && isGridMode)) return null\n\n\treturn <Grid x={x} y={y} z={z} size={gridSize} />\n}\n\nfunction ScribbleWrapper() {\n\tconst editor = useEditor()\n\tconst scribbles = useValue('scribbles', () => editor.getInstanceState().scribbles, [editor])\n\tconst zoomLevel = useValue('zoomLevel', () => editor.getZoomLevel(), [editor])\n\tconst { Scribble } = useEditorComponents()\n\n\tif (!(Scribble && scribbles.length)) return null\n\n\treturn (\n\t\t<>\n\t\t\t{scribbles.map((scribble) => (\n\t\t\t\t<Scribble\n\t\t\t\t\tkey={scribble.id}\n\t\t\t\t\tclassName=\"tl-user-scribble\"\n\t\t\t\t\tscribble={scribble}\n\t\t\t\t\tzoom={zoomLevel}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</>\n\t)\n}\n\nfunction BrushWrapper() {\n\tconst editor = useEditor()\n\tconst brush = useValue('brush', () => editor.getInstanceState().brush, [editor])\n\tconst { Brush } = useEditorComponents()\n\n\tif (!(Brush && brush)) return null\n\n\treturn <Brush className=\"tl-user-brush\" brush={brush} />\n}\n\nfunction ZoomBrushWrapper() {\n\tconst editor = useEditor()\n\tconst zoomBrush = useValue('zoomBrush', () => editor.getInstanceState().zoomBrush, [editor])\n\tconst { ZoomBrush } = useEditorComponents()\n\n\tif (!(ZoomBrush && zoomBrush)) return null\n\n\treturn <ZoomBrush className=\"tl-user-brush tl-zoom-brush\" brush={zoomBrush} />\n}\n\nfunction SnapIndicatorWrapper() {\n\tconst editor = useEditor()\n\tconst lines = useValue('snapLines', () => editor.snaps.getIndicators(), [editor])\n\tconst zoomLevel = useValue('zoomLevel', () => editor.getZoomLevel(), [editor])\n\tconst { SnapIndicator } = useEditorComponents()\n\n\tif (!(SnapIndicator && lines.length > 0)) return null\n\n\treturn (\n\t\t<>\n\t\t\t{lines.map((line) => (\n\t\t\t\t<SnapIndicator key={line.id} className=\"tl-user-snapline\" line={line} zoom={zoomLevel} />\n\t\t\t))}\n\t\t</>\n\t)\n}\n\nfunction HandlesWrapper() {\n\tconst editor = useEditor()\n\n\t// We don't want this to update every time the shape changes\n\tconst shapeIdWithHandles = useValue(\n\t\t'handles shapeIdWithHandles',\n\t\t() => {\n\t\t\tconst { isReadonly, isChangingStyle } = editor.getInstanceState()\n\t\t\tif (isReadonly || isChangingStyle) return false\n\n\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\t\tif (!onlySelectedShape) return false\n\n\t\t\t// slightly redundant but saves us from updating the handles every time the shape changes\n\t\t\tconst handles = editor.getShapeHandles(onlySelectedShape)\n\t\t\tif (!handles) return false\n\n\t\t\treturn onlySelectedShape.id\n\t\t},\n\t\t[editor]\n\t)\n\n\tif (!shapeIdWithHandles) return null\n\n\treturn <HandlesWrapperInner shapeId={shapeIdWithHandles} />\n}\n\nfunction HandlesWrapperInner({ shapeId }: { shapeId: TLShapeId }) {\n\tconst editor = useEditor()\n\tconst { Handles } = useEditorComponents()\n\n\tconst zoomLevel = useValue('zoomLevel', () => editor.getZoomLevel(), [editor])\n\n\tconst isCoarse = useValue('coarse pointer', () => editor.getInstanceState().isCoarsePointer, [\n\t\teditor,\n\t])\n\n\tconst transform = useValue('handles transform', () => editor.getShapePageTransform(shapeId), [\n\t\teditor,\n\t\tshapeId,\n\t])\n\n\tconst handles = useValue(\n\t\t'handles',\n\t\t() => {\n\t\t\tconst handles = editor.getShapeHandles(shapeId)\n\t\t\tif (!handles) return null\n\n\t\t\tconst minDistBetweenVirtualHandlesAndRegularHandles =\n\t\t\t\t((isCoarse ? COARSE_HANDLE_RADIUS : HANDLE_RADIUS) / zoomLevel) * 2\n\n\t\t\treturn (\n\t\t\t\thandles\n\t\t\t\t\t.filter(\n\t\t\t\t\t\t(handle) =>\n\t\t\t\t\t\t\t// if the handle isn't a virtual handle, we'll display it\n\t\t\t\t\t\t\thandle.type !== 'virtual' ||\n\t\t\t\t\t\t\t// but for virtual handles, we'll only display them if they're far enough away from vertex handles\n\t\t\t\t\t\t\t!handles.some(\n\t\t\t\t\t\t\t\t(h) =>\n\t\t\t\t\t\t\t\t\t// skip the handle we're checking against\n\t\t\t\t\t\t\t\t\th !== handle &&\n\t\t\t\t\t\t\t\t\t// only check against vertex handles\n\t\t\t\t\t\t\t\t\th.type === 'vertex' &&\n\t\t\t\t\t\t\t\t\t// and check that their distance isn't below the minimum distance\n\t\t\t\t\t\t\t\t\tVec.Dist(handle, h) < minDistBetweenVirtualHandlesAndRegularHandles\n\t\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t// We want vertex handles in front of all other handles\n\t\t\t\t\t.sort((a) => (a.type === 'vertex' ? 1 : -1))\n\t\t\t)\n\t\t},\n\t\t[editor, zoomLevel, isCoarse, shapeId]\n\t)\n\n\tif (!Handles || !handles || !transform) {\n\t\treturn null\n\t}\n\n\treturn (\n\t\t<Handles>\n\t\t\t<g transform={Mat.toCssString(transform)}>\n\t\t\t\t{handles.map((handle) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<HandleWrapper\n\t\t\t\t\t\t\tkey={handle.id}\n\t\t\t\t\t\t\tshapeId={shapeId}\n\t\t\t\t\t\t\thandle={handle}\n\t\t\t\t\t\t\tzoom={zoomLevel}\n\t\t\t\t\t\t\tisCoarse={isCoarse}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)\n\t\t\t\t})}\n\t\t\t</g>\n\t\t</Handles>\n\t)\n}\n\nfunction HandleWrapper({\n\tshapeId,\n\thandle,\n\tzoom,\n\tisCoarse,\n}: {\n\tshapeId: TLShapeId\n\thandle: TLHandle\n\tzoom: number\n\tisCoarse: boolean\n}) {\n\tconst events = useHandleEvents(shapeId, handle.id)\n\tconst { Handle } = useEditorComponents()\n\n\tif (!Handle) return null\n\n\treturn (\n\t\t<g aria-label=\"handle\" transform={`translate(${handle.x}, ${handle.y})`} {...events}>\n\t\t\t<Handle shapeId={shapeId} handle={handle} zoom={zoom} isCoarse={isCoarse} />\n\t\t</g>\n\t)\n}\n\nfunction ShapesWithSVGs() {\n\tconst editor = useEditor()\n\n\tconst renderingShapes = useValue('rendering shapes', () => editor.getRenderingShapes(), [editor])\n\n\tconst dprMultiple = useValue(\n\t\t'dpr multiple',\n\t\t() =>\n\t\t\t// dprMultiple is the smallest number we can multiply dpr by to get an integer\n\t\t\t// it's usually 1, 2, or 4 (for e.g. dpr of 2, 2.5 and 2.25 respectively)\n\t\t\tnearestMultiple(Math.floor(editor.getInstanceState().devicePixelRatio * 100) / 100),\n\t\t[editor]\n\t)\n\n\treturn (\n\t\t<>\n\t\t\t{renderingShapes.map((result) => (\n\t\t\t\t<Fragment key={result.id + '_fragment'}>\n\t\t\t\t\t<Shape {...result} dprMultiple={dprMultiple} />\n\t\t\t\t\t<DebugSvgCopy id={result.id} />\n\t\t\t\t</Fragment>\n\t\t\t))}\n\t\t</>\n\t)\n}\nfunction ReflowIfNeeded() {\n\tconst editor = useEditor()\n\tconst culledShapesRef = useRef<Set<TLShapeId>>(new Set())\n\tuseQuickReactor(\n\t\t'reflow for culled shapes',\n\t\t() => {\n\t\t\tconst culledShapes = editor.getCulledShapes()\n\t\t\tif (\n\t\t\t\tculledShapesRef.current.size === culledShapes.size &&\n\t\t\t\t[...culledShapes].every((id) => culledShapesRef.current.has(id))\n\t\t\t)\n\t\t\t\treturn\n\n\t\t\tculledShapesRef.current = culledShapes\n\t\t\tconst canvas = document.getElementsByClassName('tl-canvas')\n\t\t\tif (canvas.length === 0) return\n\t\t\t// This causes a reflow\n\t\t\t// https://gist.github.com/paulirish/5d52fb081b3570c81e3a\n\t\t\tconst _height = (canvas[0] as HTMLDivElement).offsetHeight\n\t\t},\n\t\t[editor]\n\t)\n\treturn null\n}\n\nfunction ShapesToDisplay() {\n\tconst editor = useEditor()\n\n\tconst renderingShapes = useValue('rendering shapes', () => editor.getRenderingShapes(), [editor])\n\n\tconst dprMultiple = useValue(\n\t\t'dpr multiple',\n\t\t() =>\n\t\t\t// dprMultiple is the smallest number we can multiply dpr by to get an integer\n\t\t\t// it's usually 1, 2, or 4 (for e.g. dpr of 2, 2.5 and 2.25 respectively)\n\t\t\tnearestMultiple(Math.floor(editor.getInstanceState().devicePixelRatio * 100) / 100),\n\t\t[editor]\n\t)\n\n\treturn (\n\t\t<>\n\t\t\t{renderingShapes.map((result) => (\n\t\t\t\t<Shape key={result.id + '_shape'} {...result} dprMultiple={dprMultiple} />\n\t\t\t))}\n\t\t\t{editor.environment.isSafari && <ReflowIfNeeded />}\n\t\t</>\n\t)\n}\n\nfunction ShapeIndicators() {\n\tconst editor = useEditor()\n\tconst renderingShapes = useValue('rendering shapes', () => editor.getRenderingShapes(), [editor])\n\tconst rPreviousSelectedShapeIds = useRef<Set<TLShapeId>>(new Set())\n\tconst idsToDisplay = useValue(\n\t\t'should display selected ids',\n\t\t() => {\n\t\t\t// todo: move to tldraw selected ids wrappe\n\t\t\tconst prev = rPreviousSelectedShapeIds.current\n\t\t\tconst next = new Set<TLShapeId>()\n\t\t\tif (\n\t\t\t\teditor.isInAny(\n\t\t\t\t\t'select.idle',\n\t\t\t\t\t'select.brushing',\n\t\t\t\t\t'select.scribble_brushing',\n\t\t\t\t\t'select.editing_shape',\n\t\t\t\t\t'select.pointing_shape',\n\t\t\t\t\t'select.pointing_selection',\n\t\t\t\t\t'select.pointing_handle'\n\t\t\t\t) &&\n\t\t\t\t!editor.getInstanceState().isChangingStyle\n\t\t\t) {\n\t\t\t\tconst selected = editor.getSelectedShapeIds()\n\t\t\t\tfor (const id of selected) {\n\t\t\t\t\tnext.add(id)\n\t\t\t\t}\n\t\t\t\tif (editor.isInAny('select.idle', 'select.editing_shape')) {\n\t\t\t\t\tconst instanceState = editor.getInstanceState()\n\t\t\t\t\tif (instanceState.isHoveringCanvas && !instanceState.isCoarsePointer) {\n\t\t\t\t\t\tconst hovered = editor.getHoveredShapeId()\n\t\t\t\t\t\tif (hovered) next.add(hovered)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (prev.size !== next.size) {\n\t\t\t\trPreviousSelectedShapeIds.current = next\n\t\t\t\treturn next\n\t\t\t}\n\n\t\t\tfor (const id of next) {\n\t\t\t\tif (!prev.has(id)) {\n\t\t\t\t\trPreviousSelectedShapeIds.current = next\n\t\t\t\t\treturn next\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn prev\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst { ShapeIndicator } = useEditorComponents()\n\tif (!ShapeIndicator) return null\n\n\treturn (\n\t\t<>\n\t\t\t{renderingShapes.map(({ id }) => (\n\t\t\t\t<ShapeIndicator key={id + '_indicator'} shapeId={id} hidden={!idsToDisplay.has(id)} />\n\t\t\t))}\n\t\t</>\n\t)\n}\n\nfunction HintedShapeIndicator() {\n\tconst editor = useEditor()\n\tconst { ShapeIndicator } = useEditorComponents()\n\n\tconst ids = useValue('hinting shape ids', () => dedupe(editor.getHintingShapeIds()), [editor])\n\n\tif (!ids.length) return null\n\tif (!ShapeIndicator) return null\n\n\treturn (\n\t\t<>\n\t\t\t{ids.map((id) => (\n\t\t\t\t<ShapeIndicator className=\"tl-user-indicator__hint\" shapeId={id} key={id + '_hinting'} />\n\t\t\t))}\n\t\t</>\n\t)\n}\n\nfunction CursorDef() {\n\treturn (\n\t\t<g id=\"cursor\">\n\t\t\t<g fill=\"rgba(0,0,0,.2)\" transform=\"translate(-11,-11)\">\n\t\t\t\t<path d=\"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z\" />\n\t\t\t\t<path d=\"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z\" />\n\t\t\t</g>\n\t\t\t<g fill=\"white\" transform=\"translate(-12,-12)\">\n\t\t\t\t<path d=\"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z\" />\n\t\t\t\t<path d=\"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z\" />\n\t\t\t</g>\n\t\t\t<g fill=\"currentColor\" transform=\"translate(-12,-12)\">\n\t\t\t\t<path d=\"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z\" />\n\t\t\t\t<path d=\"m13 10.814v11.188l2.969-2.866.428-.139h4.768z\" />\n\t\t\t</g>\n\t\t</g>\n\t)\n}\n\nfunction CollaboratorHintDef() {\n\treturn <path id=\"cursor_hint\" fill=\"currentColor\" d=\"M -2,-5 2,0 -2,5 Z\" />\n}\n\nfunction DebugSvgCopy({ id }: { id: TLShapeId }) {\n\tconst editor = useEditor()\n\n\tconst [image, setImage] = useState<{ src: string; bounds: Box } | null>(null)\n\n\tconst isInRoot = useValue(\n\t\t'is in root',\n\t\t() => {\n\t\t\tconst shape = editor.getShape(id)\n\t\t\treturn shape?.parentId === editor.getCurrentPageId()\n\t\t},\n\t\t[editor, id]\n\t)\n\n\tuseEffect(() => {\n\t\tif (!isInRoot) return\n\n\t\tlet latest = null\n\t\tconst unsubscribe = react('shape to svg', async () => {\n\t\t\tconst renderId = Math.random()\n\t\t\tlatest = renderId\n\n\t\t\tconst isSingleFrame = editor.isShapeOfType(id, 'frame')\n\t\t\tconst padding = isSingleFrame ? 0 : 10\n\t\t\tlet bounds = editor.getShapePageBounds(id)\n\t\t\tif (!bounds) return\n\t\t\tbounds = bounds.clone().expandBy(padding)\n\n\t\t\tconst result = await editor.getSvgString([id], {\n\t\t\t\tpadding,\n\t\t\t\tbackground: editor.getInstanceState().exportBackground,\n\t\t\t})\n\n\t\t\tif (latest !== renderId || !result) return\n\n\t\t\tconst svgDataUrl = `data:image/svg+xml;utf8,${encodeURIComponent(result.svg)}`\n\t\t\tsetImage({ src: svgDataUrl, bounds })\n\t\t})\n\n\t\treturn () => {\n\t\t\tlatest = null\n\t\t\tunsubscribe()\n\t\t}\n\t}, [editor, id, isInRoot])\n\n\tif (!isInRoot || !image) return null\n\n\treturn (\n\t\t<img\n\t\t\tsrc={image.src}\n\t\t\twidth={image.bounds.width}\n\t\t\theight={image.bounds.height}\n\t\t\tstyle={{\n\t\t\t\tposition: 'absolute',\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0,\n\t\t\t\ttransform: `translate(${image.bounds.x}px, ${image.bounds.maxY + 12}px)`,\n\t\t\t\toutline: '1px solid black',\n\t\t\t\tmaxWidth: 'none',\n\t\t\t}}\n\t\t/>\n\t)\n}\n\nfunction SelectionForegroundWrapper() {\n\tconst editor = useEditor()\n\tconst selectionRotation = useValue('selection rotation', () => editor.getSelectionRotation(), [\n\t\teditor,\n\t])\n\tconst selectionBounds = useValue(\n\t\t'selection bounds',\n\t\t() => editor.getSelectionRotatedPageBounds(),\n\t\t[editor]\n\t)\n\tconst { SelectionForeground } = useEditorComponents()\n\tif (!selectionBounds || !SelectionForeground) return null\n\treturn <SelectionForeground bounds={selectionBounds} rotation={selectionRotation} />\n}\n\nfunction SelectionBackgroundWrapper() {\n\tconst editor = useEditor()\n\tconst selectionRotation = useValue('selection rotation', () => editor.getSelectionRotation(), [\n\t\teditor,\n\t])\n\tconst selectionBounds = useValue(\n\t\t'selection bounds',\n\t\t() => editor.getSelectionRotatedPageBounds(),\n\t\t[editor]\n\t)\n\tconst { SelectionBackground } = useEditorComponents()\n\tif (!selectionBounds || !SelectionBackground) return null\n\treturn <SelectionBackground bounds={selectionBounds} rotation={selectionRotation} />\n}\n\nfunction OnTheCanvasWrapper() {\n\tconst { OnTheCanvas } = useEditorComponents()\n\tif (!OnTheCanvas) return null\n\treturn <OnTheCanvas />\n}\n\nfunction InFrontOfTheCanvasWrapper() {\n\tconst { InFrontOfTheCanvas } = useEditorComponents()\n\tif (!InFrontOfTheCanvas) return null\n\treturn <InFrontOfTheCanvas />\n}\n\nfunction MovingCameraHitTestBlocker() {\n\tconst editor = useEditor()\n\tconst cameraState = useValue('camera state', () => editor.getCameraState(), [editor])\n\n\treturn (\n\t\t<div\n\t\t\tclassName={classNames('tl-hit-test-blocker', {\n\t\t\t\t'tl-hit-test-blocker__hidden': cameraState === 'idle',\n\t\t\t})}\n\t\t/>\n\t)\n}\n", "import { EASINGS } from './primitives/easings'\n\n/** @internal */\nexport const MAX_SHAPES_PER_PAGE = 2000\n/** @internal */\nexport const MAX_PAGES = 40\n\n/** @internal */\nexport const ANIMATION_SHORT_MS = 80\n/** @internal */\nexport const ANIMATION_MEDIUM_MS = 320\n\n/** @internal */\nexport const ZOOMS = [0.1, 0.25, 0.5, 1, 2, 4, 8]\n/** @internal */\nexport const MIN_ZOOM = 0.1\n/** @internal */\nexport const MAX_ZOOM = 8\n\n/** @internal */\nexport const FOLLOW_CHASE_PROPORTION = 0.5\n/** @internal */\nexport const FOLLOW_CHASE_PAN_SNAP = 0.1\n/** @internal */\nexport const FOLLOW_CHASE_PAN_UNSNAP = 0.2\n/** @internal */\nexport const FOLLOW_CHASE_ZOOM_SNAP = 0.005\n/** @internal */\nexport const FOLLOW_CHASE_ZOOM_UNSNAP = 0.05\n\n/** @internal */\nexport const DOUBLE_CLICK_DURATION = 450\n/** @internal */\nexport const MULTI_CLICK_DURATION = 200\n\n/** @internal */\nexport const COARSE_DRAG_DISTANCE = 36 // 6 squared\n\n/** @internal */\nexport const DRAG_DISTANCE = 16 // 4 squared\n\n/** @internal */\nexport const SVG_PADDING = 32\n\n/** @internal */\nexport const HASH_PATTERN_ZOOM_NAMES: Record<string, string> = {}\n\nfor (let zoom = 1; zoom <= Math.ceil(MAX_ZOOM); zoom++) {\n\tHASH_PATTERN_ZOOM_NAMES[zoom + '_dark'] = `hash_pattern_zoom_${zoom}_dark`\n\tHASH_PATTERN_ZOOM_NAMES[zoom + '_light'] = `hash_pattern_zoom_${zoom}_light`\n}\n\n/** @internal */\nexport const DEFAULT_ANIMATION_OPTIONS = {\n\tduration: 0,\n\teasing: EASINGS.easeInOutCubic,\n}\n\n/** @internal */\nexport const CAMERA_SLIDE_FRICTION = 0.09\n\n/** @public */\nexport const GRID_STEPS = [\n\t{ min: -1, mid: 0.15, step: 64 },\n\t{ min: 0.05, mid: 0.375, step: 16 },\n\t{ min: 0.15, mid: 1, step: 4 },\n\t{ min: 0.7, mid: 2.5, step: 1 },\n]\n\n/** @internal */\nexport const COLLABORATOR_INACTIVE_TIMEOUT = 60000\n\n/** @internal */\nexport const COLLABORATOR_IDLE_TIMEOUT = 3000\n\n/** @internal */\nexport const COLLABORATOR_CHECK_INTERVAL = 1200\n\n/**\n * Negative pointer ids are reserved for internal use.\n *\n * @internal */\nexport const INTERNAL_POINTER_IDS = {\n\tCAMERA_MOVE: -10,\n} as const\n\n/** @internal */\nexport const CAMERA_MOVING_TIMEOUT = 64\n\n/** @public */\nexport const HIT_TEST_MARGIN = 8\n\n/** @internal */\nexport const EDGE_SCROLL_SPEED = 20\n\n/** @internal */\nexport const EDGE_SCROLL_DISTANCE = 8\n\n/** @internal */\nexport const COARSE_POINTER_WIDTH = 12\n\n/** @internal */\nexport const COARSE_HANDLE_RADIUS = 20\n\n/** @internal */\nexport const HANDLE_RADIUS = 12\n\n/** @public */\nexport const SIDES = ['top', 'right', 'bottom', 'left'] as const\n\n/** @internal */\nexport const LONG_PRESS_DURATION = 500\n\n/** @internal */\nexport const TEXT_SHADOW_LOD = 0.35\n", "import React, { useMemo } from 'react'\nimport {\n\tpreventDefault,\n\treleasePointerCapture,\n\tsetPointerCapture,\n\tstopEventPropagation,\n} from '../utils/dom'\nimport { getPointerInfo } from '../utils/getPointerInfo'\nimport { useEditor } from './useEditor'\n\nexport function useCanvasEvents() {\n\tconst editor = useEditor()\n\n\tconst events = useMemo(\n\t\tfunction canvasEvents() {\n\t\t\t// Track the last screen point\n\t\t\tlet lastX: number, lastY: number\n\n\t\t\tfunction onPointerDown(e: React.PointerEvent) {\n\t\t\t\tif ((e as any).isKilled) return\n\n\t\t\t\tif (e.button === 2) {\n\t\t\t\t\teditor.dispatch({\n\t\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\t\ttarget: 'canvas',\n\t\t\t\t\t\tname: 'right_click',\n\t\t\t\t\t\t...getPointerInfo(e),\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (e.button !== 0 && e.button !== 1 && e.button !== 5) return\n\n\t\t\t\tsetPointerCapture(e.currentTarget, e)\n\n\t\t\t\teditor.dispatch({\n\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\ttarget: 'canvas',\n\t\t\t\t\tname: 'pointer_down',\n\t\t\t\t\t...getPointerInfo(e),\n\t\t\t\t})\n\n\t\t\t\tif (editor.getOpenMenus().length > 0) {\n\t\t\t\t\teditor.updateInstanceState({\n\t\t\t\t\t\topenMenus: [],\n\t\t\t\t\t})\n\n\t\t\t\t\tdocument.body.click()\n\t\t\t\t\teditor.getContainer().focus()\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onPointerMove(e: React.PointerEvent) {\n\t\t\t\tif ((e as any).isKilled) return\n\n\t\t\t\tif (e.clientX === lastX && e.clientY === lastY) return\n\t\t\t\tlastX = e.clientX\n\t\t\t\tlastY = e.clientY\n\n\t\t\t\teditor.dispatch({\n\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\ttarget: 'canvas',\n\t\t\t\t\tname: 'pointer_move',\n\t\t\t\t\t...getPointerInfo(e),\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tfunction onPointerUp(e: React.PointerEvent) {\n\t\t\t\tif ((e as any).isKilled) return\n\t\t\t\tif (e.button !== 0 && e.button !== 1 && e.button !== 2 && e.button !== 5) return\n\t\t\t\tlastX = e.clientX\n\t\t\t\tlastY = e.clientY\n\n\t\t\t\treleasePointerCapture(e.currentTarget, e)\n\n\t\t\t\teditor.dispatch({\n\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\ttarget: 'canvas',\n\t\t\t\t\tname: 'pointer_up',\n\t\t\t\t\t...getPointerInfo(e),\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tfunction onPointerEnter(e: React.PointerEvent) {\n\t\t\t\tif ((e as any).isKilled) return\n\t\t\t\tif (editor.getInstanceState().isPenMode && e.pointerType !== 'pen') return\n\t\t\t\tconst canHover = e.pointerType === 'mouse' || e.pointerType === 'pen'\n\t\t\t\teditor.updateInstanceState({ isHoveringCanvas: canHover ? true : null })\n\t\t\t}\n\n\t\t\tfunction onPointerLeave(e: React.PointerEvent) {\n\t\t\t\tif ((e as any).isKilled) return\n\t\t\t\tif (editor.getInstanceState().isPenMode && e.pointerType !== 'pen') return\n\t\t\t\tconst canHover = e.pointerType === 'mouse' || e.pointerType === 'pen'\n\t\t\t\teditor.updateInstanceState({ isHoveringCanvas: canHover ? false : null })\n\t\t\t}\n\n\t\t\tfunction onTouchStart(e: React.TouchEvent) {\n\t\t\t\t;(e as any).isKilled = true\n\t\t\t\t// todo: investigate whether this effects keyboard shortcuts\n\t\t\t\t// god damn it, but necessary for long presses to open the context menu\n\t\t\t\tdocument.body.click()\n\t\t\t\tpreventDefault(e)\n\t\t\t}\n\n\t\t\tfunction onTouchEnd(e: React.TouchEvent) {\n\t\t\t\t;(e as any).isKilled = true\n\t\t\t\tif (\n\t\t\t\t\t(e.target as HTMLElement).tagName !== 'A' &&\n\t\t\t\t\t(e.target as HTMLElement).tagName !== 'TEXTAREA' &&\n\t\t\t\t\t// When in EditingShape state, we are actually clicking on a 'DIV'\n\t\t\t\t\t// not A/TEXTAREA element yet. So, to preserve cursor position\n\t\t\t\t\t// for edit mode on mobile we need to not preventDefault.\n\t\t\t\t\t// TODO: Find out if we still need this preventDefault in general though.\n\t\t\t\t\t!(\n\t\t\t\t\t\teditor.getEditingShape() &&\n\t\t\t\t\t\t(e.target as HTMLElement).className.includes('tl-text-content')\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tpreventDefault(e)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDragOver(e: React.DragEvent<Element>) {\n\t\t\t\tpreventDefault(e)\n\t\t\t}\n\n\t\t\tasync function onDrop(e: React.DragEvent<Element>) {\n\t\t\t\tpreventDefault(e)\n\t\t\t\tif (!e.dataTransfer?.files?.length) return\n\n\t\t\t\tconst files = Array.from(e.dataTransfer.files)\n\n\t\t\t\tawait editor.putExternalContent({\n\t\t\t\t\ttype: 'files',\n\t\t\t\t\tfiles,\n\t\t\t\t\tpoint: editor.screenToPage({ x: e.clientX, y: e.clientY }),\n\t\t\t\t\tignoreParent: false,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tfunction onClick(e: React.MouseEvent) {\n\t\t\t\tstopEventPropagation(e)\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tonPointerDown,\n\t\t\t\tonPointerMove,\n\t\t\t\tonPointerUp,\n\t\t\t\tonPointerEnter,\n\t\t\t\tonPointerLeave,\n\t\t\t\tonDragOver,\n\t\t\t\tonDrop,\n\t\t\t\tonTouchStart,\n\t\t\t\tonTouchEnd,\n\t\t\t\tonClick,\n\t\t\t}\n\t\t},\n\t\t[editor]\n\t)\n\n\treturn events\n}\n", "import { Atom, atom, react } from '@tldraw/state'\nimport { deleteFromSessionStorage, getFromSessionStorage, setInSessionStorage } from '@tldraw/utils'\n\n// --- 1. DEFINE ---\n//\n// Define your debug values and feature flags here. Use `createDebugValue` to\n// create an arbitrary value with defaults for production, staging, and\n// development. Use `createFeatureFlag` to create a boolean flag which will be\n// `true` by default in development and staging, and `false` in production.\n/** @internal */\nexport const featureFlags: Record<string, DebugFlag<boolean>> = {\n\t// canMoveArrowLabel: createFeatureFlag('canMoveArrowLabel'),\n}\n\n/** @internal */\nexport const pointerCaptureTrackingObject = createDebugValue(\n\t'pointerCaptureTrackingObject',\n\t// ideally we wouldn't store this mutable value in an atom but it's not\n\t// a big deal for debug values\n\t{\n\t\tdefaults: { all: new Map<Element, number>() },\n\t\tshouldStoreForSession: false,\n\t}\n)\n\n/** @internal */\nexport const debugFlags = {\n\t// --- DEBUG VALUES ---\n\tlogPreventDefaults: createDebugValue('logPreventDefaults', {\n\t\tdefaults: { all: false },\n\t}),\n\tlogPointerCaptures: createDebugValue('logPointerCaptures', {\n\t\tdefaults: { all: false },\n\t}),\n\tlogElementRemoves: createDebugValue('logElementRemoves', {\n\t\tdefaults: { all: false },\n\t}),\n\tdebugSvg: createDebugValue('debugSvg', {\n\t\tdefaults: { all: false },\n\t}),\n\tshowFps: createDebugValue('showFps', {\n\t\tdefaults: { all: false },\n\t}),\n\tthrowToBlob: createDebugValue('throwToBlob', {\n\t\tdefaults: { all: false },\n\t}),\n\treconnectOnPing: createDebugValue('reconnectOnPing', {\n\t\tdefaults: { all: false },\n\t}),\n\tdebugCursors: createDebugValue('debugCursors', {\n\t\tdefaults: { all: false },\n\t}),\n\tforceSrgb: createDebugValue('forceSrgbColors', { defaults: { all: false } }),\n\tdebugGeometry: createDebugValue('debugGeometry', { defaults: { all: false } }),\n\thideShapes: createDebugValue('hideShapes', { defaults: { all: false } }),\n\teditOnType: createDebugValue('editOnType', { defaults: { all: false } }),\n} as const\n\ndeclare global {\n\tinterface Window {\n\t\ttldrawLog: (message: any) => void\n\t}\n}\n\n// --- 2. USE ---\n// In normal code, read from debug flags directly by calling .value on them:\n//    if (debugFlags.preventDefaultLogging.value) { ... }\n//\n// In react, wrap your reads in `useValue` (or your component in `track`)\n// so they react to changes:\n//    const shouldLog = useValue(debugFlags.preventDefaultLogging)\n\n// --- 3. GET FUNKY ---\n// If you need to do fun stuff like monkey-patching in response to flag changes,\n// add that here. Make sure you wrap your code in `react` so it runs\n// automatically when values change!\n\nif (typeof Element !== 'undefined') {\n\tconst nativeElementRemoveChild = Element.prototype.removeChild\n\treact('element removal logging', () => {\n\t\tif (debugFlags.logElementRemoves.get()) {\n\t\t\tElement.prototype.removeChild = function <T extends Node>(this: any, child: Node): T {\n\t\t\t\tconsole.warn('[tldraw] removing child:', child)\n\t\t\t\treturn nativeElementRemoveChild.call(this, child) as T\n\t\t\t}\n\t\t} else {\n\t\t\tElement.prototype.removeChild = nativeElementRemoveChild\n\t\t}\n\t})\n}\n\n// --- IMPLEMENTATION ---\n// you probably don't need to read this if you're just using the debug values system\nfunction createDebugValue<T>(\n\tname: string,\n\t{\n\t\tdefaults,\n\t\tshouldStoreForSession = true,\n\t}: { defaults: Defaults<T>; shouldStoreForSession?: boolean }\n) {\n\treturn createDebugValueBase({\n\t\tname,\n\t\tdefaults,\n\t\tshouldStoreForSession,\n\t})\n}\n\n// function createFeatureFlag(\n// \tname: string,\n// \tdefaults: Defaults<boolean> = { all: true, production: false }\n// ) {\n// \treturn createDebugValueBase({\n// \t\tname,\n// \t\tdefaults,\n// \t\tshouldStoreForSession: true,\n// \t})\n// }\n\nfunction createDebugValueBase<T>(def: DebugFlagDef<T>): DebugFlag<T> {\n\tconst defaultValue = getDefaultValue(def)\n\tconst storedValue = def.shouldStoreForSession\n\t\t? (getStoredInitialValue(def.name) as T | null)\n\t\t: null\n\tconst valueAtom = atom(`debug:${def.name}`, storedValue ?? defaultValue)\n\n\tif (typeof window !== 'undefined') {\n\t\tif (def.shouldStoreForSession) {\n\t\t\treact(`debug:${def.name}`, () => {\n\t\t\t\tconst currentValue = valueAtom.get()\n\t\t\t\tif (currentValue === defaultValue) {\n\t\t\t\t\tdeleteFromSessionStorage(`tldraw_debug:${def.name}`)\n\t\t\t\t} else {\n\t\t\t\t\tsetInSessionStorage(`tldraw_debug:${def.name}`, JSON.stringify(currentValue))\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tObject.defineProperty(window, `tldraw${def.name.replace(/^[a-z]/, (l) => l.toUpperCase())}`, {\n\t\t\tget() {\n\t\t\t\treturn valueAtom.get()\n\t\t\t},\n\t\t\tset(newValue) {\n\t\t\t\tvalueAtom.set(newValue)\n\t\t\t},\n\t\t\tconfigurable: true,\n\t\t})\n\t}\n\n\treturn Object.assign(valueAtom, def)\n}\n\nfunction getStoredInitialValue(name: string) {\n\ttry {\n\t\treturn JSON.parse(getFromSessionStorage(`tldraw_debug:${name}`) ?? 'null')\n\t} catch (err) {\n\t\treturn null\n\t}\n}\n\n// process.env might not be defined, but we can't access it using optional\n// chaining because some bundlers search for `process.env.SOMETHING` as a string\n// and replace it with its value.\nfunction readEnv(fn: () => string | undefined) {\n\ttry {\n\t\treturn fn()\n\t} catch {\n\t\treturn null\n\t}\n}\n\nfunction getDefaultValue<T>(def: DebugFlagDef<T>): T {\n\tconst env =\n\t\treadEnv(() => process.env.TLDRAW_ENV) ??\n\t\treadEnv(() => process.env.VERCEL_PUBLIC_TLDRAW_ENV) ??\n\t\treadEnv(() => process.env.NEXT_PUBLIC_TLDRAW_ENV) ??\n\t\t// default to production because if we don't have one of these, this is probably a library use\n\t\t'production'\n\n\tswitch (env) {\n\t\tcase 'production':\n\t\t\treturn def.defaults.production ?? def.defaults.all\n\t\tcase 'preview':\n\t\tcase 'staging':\n\t\t\treturn def.defaults.staging ?? def.defaults.all\n\t\tdefault:\n\t\t\treturn def.defaults.development ?? def.defaults.all\n\t}\n}\n\ninterface Defaults<T> {\n\tdevelopment?: T\n\tstaging?: T\n\tproduction?: T\n\tall: T\n}\n\ninterface DebugFlagDef<T> {\n\tname: string\n\tdefaults: Defaults<T>\n\tshouldStoreForSession: boolean\n}\n\n/** @internal */\nexport type DebugFlag<T> = DebugFlagDef<T> & Atom<T>\n", "/*\nThis is used to facilitate double clicking and pointer capture on elements.\n\nThe events in this file are possibly set on individual SVG elements, \nsuch as handles or corner handles, rather than on HTML elements or \nSVGSVGElements. Raw SVG elemnets do not support pointerCapture in \nmost cases, meaning that in order for pointer capture to work, we \nneed to crawl up the DOM tree to find the nearest HTML element. Then,\nin order for that element to also call the `onPointerUp` event from\nthis file, we need to manually set that event on that element and\nlater remove it when the pointerup occurs. This is a potential leak\nif the user clicks on a handle but the pointerup does not fire for\nwhatever reason.\n*/\n\nimport React from 'react'\nimport { debugFlags, pointerCaptureTrackingObject } from './debug-flags'\n\n/** @public */\nexport function loopToHtmlElement(elm: Element): HTMLElement {\n\tif (elm instanceof HTMLElement) return elm\n\tif (elm.parentElement) return loopToHtmlElement(elm.parentElement)\n\telse throw Error('Could not find a parent element of an HTML type!')\n}\n\n/**\n * This function calls `event.preventDefault()` for you. Why is that useful?\n *\n * Beacuase if you enable `window.preventDefaultLogging = true` it'll log out a message when it\n * happens. Because we use console.warn rather than (log) you'll get a stack trace in the inspector\n * telling you exactly where it happened. This is important because `e.preventDefault()` is the\n * source of many bugs, but unfortuantly it can't be avoided because it also stops a lot of default\n * behaviour which doesn't make sense in our UI\n *\n * @param event - To prevent default on\n * @public\n */\nexport function preventDefault(event: React.BaseSyntheticEvent | Event) {\n\tevent.preventDefault()\n\tif (debugFlags.logPreventDefaults.get()) {\n\t\tconsole.warn('preventDefault called on event:', event)\n\t}\n}\n\n/** @public */\nexport function setPointerCapture(\n\telement: Element,\n\tevent: React.PointerEvent<Element> | PointerEvent\n) {\n\telement.setPointerCapture(event.pointerId)\n\tif (debugFlags.logPointerCaptures.get()) {\n\t\tconst trackingObj = pointerCaptureTrackingObject.get()\n\t\ttrackingObj.set(element, (trackingObj.get(element) ?? 0) + 1)\n\t\tconsole.warn('setPointerCapture called on element:', element, event)\n\t}\n}\n\n/** @public */\nexport function releasePointerCapture(\n\telement: Element,\n\tevent: React.PointerEvent<Element> | PointerEvent\n) {\n\tif (!element.hasPointerCapture(event.pointerId)) {\n\t\treturn\n\t}\n\n\telement.releasePointerCapture(event.pointerId)\n\tif (debugFlags.logPointerCaptures.get()) {\n\t\tconst trackingObj = pointerCaptureTrackingObject.get()\n\t\tif (trackingObj.get(element) === 1) {\n\t\t\ttrackingObj.delete(element)\n\t\t} else if (trackingObj.has(element)) {\n\t\t\ttrackingObj.set(element, trackingObj.get(element)! - 1)\n\t\t} else {\n\t\t\tconsole.warn('Release without capture')\n\t\t}\n\t\tconsole.warn('releasePointerCapture called on element:', element, event)\n\t}\n}\n\n/** @public */\nexport const stopEventPropagation = (e: any) => e.stopPropagation()\n\n/** @internal */\nexport const setStyleProperty = (\n\telm: HTMLElement | null,\n\tproperty: string,\n\tvalue: string | number\n) => {\n\tif (!elm) return\n\telm.style.setProperty(property, value as string)\n}\n", "/** @public */\nexport function getPointerInfo(e: React.PointerEvent | PointerEvent) {\n\t;(e as any).isKilled = true\n\n\treturn {\n\t\tpoint: {\n\t\t\tx: e.clientX,\n\t\t\ty: e.clientY,\n\t\t\tz: e.pressure,\n\t\t},\n\t\tshiftKey: e.shiftKey,\n\t\taltKey: e.altKey,\n\t\tctrlKey: e.metaKey || e.ctrlKey,\n\t\tpointerId: e.pointerId,\n\t\tbutton: e.button,\n\t\tisPen: e.pointerType === 'pen',\n\t}\n}\n", "import { useEffect } from 'react'\nimport { useEditor } from './useEditor'\n\n/** @internal */\nexport function useCoarsePointer() {\n\tconst editor = useEditor()\n\tuseEffect(() => {\n\t\t// This is a workaround for a Firefox bug where we don't correctly\n\t\t// detect coarse VS fine pointer. For now, let's assume that you have a fine\n\t\t// pointer if you're on Firefox on desktop.\n\t\tif (\n\t\t\teditor.environment.isFirefox &&\n\t\t\t!editor.environment.isAndroid &&\n\t\t\t!editor.environment.isIos\n\t\t) {\n\t\t\teditor.updateInstanceState({ isCoarsePointer: false })\n\t\t\treturn\n\t\t}\n\t\tif (window.matchMedia) {\n\t\t\tconst mql = window.matchMedia('(pointer: coarse)')\n\t\t\tconst handler = () => {\n\t\t\t\teditor.updateInstanceState({ isCoarsePointer: !!mql.matches })\n\t\t\t}\n\t\t\thandler()\n\t\t\tif (mql) {\n\t\t\t\tmql.addEventListener('change', handler)\n\t\t\t\treturn () => mql.removeEventListener('change', handler)\n\t\t\t}\n\t\t}\n\t}, [editor])\n}\n", "import { assertExists } from '@tldraw/utils'\nimport { createContext, useContext } from 'react'\n\nconst ContainerContext = createContext<HTMLDivElement | null>(null)\n\n/** @internal */\nexport function ContainerProvider({\n\tcontainer,\n\tchildren,\n}: {\n\tcontainer: HTMLDivElement\n\tchildren: React.ReactNode\n}) {\n\treturn <ContainerContext.Provider value={container}>{children}</ContainerContext.Provider>\n}\n\n/** @public */\nexport function useContainer(): HTMLDivElement {\n\treturn assertExists(useContext(ContainerContext), 'useContainer used outside of <Tldraw />')\n}\n", "import { useValue } from '@tldraw/state'\nimport { useEffect } from 'react'\nimport { TLKeyboardEventInfo } from '../editor/types/event-types'\nimport { preventDefault } from '../utils/dom'\nimport { useContainer } from './useContainer'\nimport { useEditor } from './useEditor'\n\nexport function useDocumentEvents() {\n\tconst editor = useEditor()\n\tconst container = useContainer()\n\n\tconst isAppFocused = useValue('isFocused', () => editor.getInstanceState().isFocused, [editor])\n\n\tuseEffect(() => {\n\t\tif (typeof matchMedia === undefined) return\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio#monitoring_screen_resolution_or_zoom_level_changes\n\t\tlet remove: (() => void) | null = null\n\t\tconst updatePixelRatio = () => {\n\t\t\tif (remove != null) {\n\t\t\t\tremove()\n\t\t\t}\n\t\t\tconst mqString = `(resolution: ${window.devicePixelRatio}dppx)`\n\t\t\tconst media = matchMedia(mqString)\n\t\t\t// Safari only started supporting `addEventListener('change',...) in version 14\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/change_event\n\t\t\tconst safariCb = (ev: any) => {\n\t\t\t\tif (ev.type === 'change') {\n\t\t\t\t\tupdatePixelRatio()\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (media.addEventListener) {\n\t\t\t\tmedia.addEventListener('change', updatePixelRatio)\n\t\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\t} else if (media.addListener) {\n\t\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\t\tmedia.addListener(safariCb)\n\t\t\t}\n\t\t\tremove = () => {\n\t\t\t\tif (media.removeEventListener) {\n\t\t\t\t\tmedia.removeEventListener('change', updatePixelRatio)\n\t\t\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\t\t} else if (media.removeListener) {\n\t\t\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\t\t\tmedia.removeListener(safariCb)\n\t\t\t\t}\n\t\t\t}\n\t\t\teditor.updateInstanceState({ devicePixelRatio: window.devicePixelRatio })\n\t\t}\n\t\tupdatePixelRatio()\n\t\treturn () => {\n\t\t\tremove?.()\n\t\t}\n\t}, [editor])\n\n\tuseEffect(() => {\n\t\tif (!isAppFocused) return\n\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tif (\n\t\t\t\te.altKey &&\n\t\t\t\t// todo: When should we allow the alt key to be used? Perhaps states should declare which keys matter to them?\n\t\t\t\t(editor.isIn('zoom') || !editor.getPath().endsWith('.idle')) &&\n\t\t\t\t!isFocusingInput()\n\t\t\t) {\n\t\t\t\t// On windows the alt key opens the menu bar.\n\t\t\t\t// We want to prevent that if the user is doing something else,\n\t\t\t\t// e.g. resizing a shape\n\t\t\t\tpreventDefault(e)\n\t\t\t}\n\n\t\t\tif ((e as any).isKilled) return\n\t\t\t;(e as any).isKilled = true\n\n\t\t\tswitch (e.key) {\n\t\t\t\tcase '=':\n\t\t\t\tcase '-':\n\t\t\t\tcase '0': {\n\t\t\t\t\t// These keys are used for zooming. Technically we only use\n\t\t\t\t\t// the + - and 0 keys, however it's common for them to be\n\t\t\t\t\t// paired with modifier keys (command / control) so we need\n\t\t\t\t\t// to prevent the browser's regular actions (i.e. zooming\n\t\t\t\t\t// the page). A user can zoom by unfocusing the editor.\n\t\t\t\t\tif (e.metaKey || e.ctrlKey) {\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'Tab': {\n\t\t\t\t\tif (isFocusingInput() || editor.getIsMenuOpen()) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase ',': {\n\t\t\t\t\t// this was moved to useKeyBoardShortcuts; it's possible\n\t\t\t\t\t// that the comma key is pressed when the container is not\n\t\t\t\t\t// focused, for example when the user has just interacted\n\t\t\t\t\t// with the toolbar. We need to handle it on the window\n\t\t\t\t\t// (ofc ensuring it's a correct time for a shortcut)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tcase 'Escape': {\n\t\t\t\t\t// In certain browsers, pressing escape while in full screen mode\n\t\t\t\t\t// will exit full screen mode. We want to allow that, but not when\n\t\t\t\t\t// escape is being handled by the editor. When a user has an editing\n\t\t\t\t\t// shape, escape stops editing. When a user is using a tool, escape\n\t\t\t\t\t// returns to the select tool. When the user has selected shapes,\n\t\t\t\t\t// escape de-selects them. Only when the user's selection is empty\n\t\t\t\t\t// should we allow escape to do its normal thing.\n\n\t\t\t\t\tif (editor.getEditingShape() || editor.getSelectedShapeIds().length > 0) {\n\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t}\n\n\t\t\t\t\t// Don't do anything if we open menus open\n\t\t\t\t\tif (editor.getOpenMenus().length > 0) return\n\n\t\t\t\t\tif (!editor.inputs.keys.has('Escape')) {\n\t\t\t\t\t\teditor.inputs.keys.add('Escape')\n\n\t\t\t\t\t\teditor.cancel()\n\t\t\t\t\t\t// Pressing escape will focus the document.body,\n\t\t\t\t\t\t// which will cause the app to lose focus, which\n\t\t\t\t\t\t// will break additional shortcuts. We need to\n\t\t\t\t\t\t// refocus the container in order to keep these\n\t\t\t\t\t\t// shortcuts working.\n\t\t\t\t\t\tcontainer.focus()\n\t\t\t\t\t}\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\tif (isFocusingInput() || editor.getIsMenuOpen()) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst info: TLKeyboardEventInfo = {\n\t\t\t\ttype: 'keyboard',\n\t\t\t\tname: e.repeat ? 'key_repeat' : 'key_down',\n\t\t\t\tkey: e.key,\n\t\t\t\tcode: e.code,\n\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tctrlKey: e.metaKey || e.ctrlKey,\n\t\t\t}\n\n\t\t\teditor.dispatch(info)\n\t\t}\n\n\t\tconst handleKeyUp = (e: KeyboardEvent) => {\n\t\t\tif ((e as any).isKilled) return\n\t\t\t;(e as any).isKilled = true\n\n\t\t\tif (isFocusingInput() || editor.getIsMenuOpen()) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (e.key === ',') {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst info: TLKeyboardEventInfo = {\n\t\t\t\ttype: 'keyboard',\n\t\t\t\tname: 'key_up',\n\t\t\t\tkey: e.key,\n\t\t\t\tcode: e.code,\n\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tctrlKey: e.metaKey || e.ctrlKey,\n\t\t\t}\n\n\t\t\teditor.dispatch(info)\n\t\t}\n\n\t\tfunction handleTouchStart(e: TouchEvent) {\n\t\t\tif (container.contains(e.target as Node)) {\n\t\t\t\t// Center point of the touch area\n\t\t\t\tconst touchXPosition = e.touches[0].pageX\n\t\t\t\t// Size of the touch area\n\t\t\t\tconst touchXRadius = e.touches[0].radiusX || 0\n\n\t\t\t\t// We set a threshold (10px) on both sizes of the screen,\n\t\t\t\t// if the touch area overlaps with the screen edges\n\t\t\t\t// it's likely to trigger the navigation. We prevent the\n\t\t\t\t// touchstart event in that case.\n\t\t\t\t// todo: make this relative to the actual window, not the editor's screen bounds\n\t\t\t\tif (\n\t\t\t\t\ttouchXPosition - touchXRadius < 10 ||\n\t\t\t\t\ttouchXPosition + touchXRadius > editor.getViewportScreenBounds().width - 10\n\t\t\t\t) {\n\t\t\t\t\tif ((e.target as HTMLElement)?.tagName === 'BUTTON') {\n\t\t\t\t\t\t// Force a click before bailing\n\t\t\t\t\t\t;(e.target as HTMLButtonElement)?.click()\n\t\t\t\t\t}\n\n\t\t\t\t\tpreventDefault(e)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Prevent wheel events that occur inside of the container\n\t\tconst handleWheel = (e: WheelEvent) => {\n\t\t\tif (container.contains(e.target as Node) && (e.ctrlKey || e.metaKey)) {\n\t\t\t\tpreventDefault(e)\n\t\t\t}\n\t\t}\n\n\t\tcontainer.addEventListener('touchstart', handleTouchStart, { passive: false })\n\n\t\tcontainer.addEventListener('wheel', handleWheel, { passive: false })\n\n\t\tdocument.addEventListener('gesturestart', preventDefault)\n\t\tdocument.addEventListener('gesturechange', preventDefault)\n\t\tdocument.addEventListener('gestureend', preventDefault)\n\n\t\tcontainer.addEventListener('keydown', handleKeyDown)\n\t\tcontainer.addEventListener('keyup', handleKeyUp)\n\n\t\treturn () => {\n\t\t\tcontainer.removeEventListener('touchstart', handleTouchStart)\n\n\t\t\tcontainer.removeEventListener('wheel', handleWheel)\n\n\t\t\tdocument.removeEventListener('gesturestart', preventDefault)\n\t\t\tdocument.removeEventListener('gesturechange', preventDefault)\n\t\t\tdocument.removeEventListener('gestureend', preventDefault)\n\n\t\t\tcontainer.removeEventListener('keydown', handleKeyDown)\n\t\t\tcontainer.removeEventListener('keyup', handleKeyUp)\n\t\t}\n\t}, [editor, container, isAppFocused])\n}\n\nconst INPUTS = ['input', 'select', 'button', 'textarea']\n\nfunction isFocusingInput() {\n\tconst { activeElement } = document\n\n\tif (\n\t\tactiveElement &&\n\t\t(activeElement.getAttribute('contenteditable') ||\n\t\t\tINPUTS.indexOf(activeElement.tagName.toLowerCase()) > -1)\n\t) {\n\t\treturn true\n\t}\n\n\treturn false\n}\n", "import { useEffect } from 'react'\nimport { preventDefault } from '../utils/dom'\nimport { useEditor } from './useEditor'\n\nconst IGNORED_TAGS = ['textarea', 'input']\n\n/**\n * When double tapping with the pencil in iOS, it enables a little zoom window in the UI. We don't\n * want this for drawing operations and can disable it by setting 'disableDoubleTapZoom' in the main\n * editor.\n */\nexport function useFixSafariDoubleTapZoomPencilEvents(ref: React.RefObject<HTMLElement>) {\n\tconst editor = useEditor()\n\n\tuseEffect(() => {\n\t\tconst elm = ref.current\n\n\t\tif (!elm) return\n\n\t\tconst handleEvent = (e: PointerEvent | TouchEvent) => {\n\t\t\tif (e instanceof PointerEvent && e.pointerType === 'pen') {\n\t\t\t\t;(e as any).isKilled = true\n\t\t\t\tconst { target } = e\n\n\t\t\t\t// Allow events to propagate if the app is editing a shape, or if the event is occurring in a text area or input\n\t\t\t\tif (\n\t\t\t\t\tIGNORED_TAGS.includes((target as Element).tagName?.toLocaleLowerCase()) ||\n\t\t\t\t\teditor.isIn('select.editing_shape')\n\t\t\t\t) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tpreventDefault(e)\n\t\t\t}\n\t\t}\n\n\t\telm.addEventListener('touchstart', handleEvent)\n\t\telm.addEventListener('touchend', handleEvent)\n\t\treturn () => {\n\t\t\telm.removeEventListener('touchstart', handleEvent)\n\t\t\telm.removeEventListener('touchend', handleEvent)\n\t\t}\n\t}, [editor, ref])\n}\n", "function clamp(v, min, max) {\n  return Math.max(min, Math.min(v, max));\n}\nconst V = {\n  toVector(v, fallback) {\n    if (v === undefined) v = fallback;\n    return Array.isArray(v) ? v : [v, v];\n  },\n  add(v1, v2) {\n    return [v1[0] + v2[0], v1[1] + v2[1]];\n  },\n  sub(v1, v2) {\n    return [v1[0] - v2[0], v1[1] - v2[1]];\n  },\n  addTo(v1, v2) {\n    v1[0] += v2[0];\n    v1[1] += v2[1];\n  },\n  subTo(v1, v2) {\n    v1[0] -= v2[0];\n    v1[1] -= v2[1];\n  }\n};\nfunction rubberband(distance, dimension, constant) {\n  if (dimension === 0 || Math.abs(dimension) === Infinity) return Math.pow(distance, constant * 5);\n  return distance * dimension * constant / (dimension + constant * distance);\n}\nfunction rubberbandIfOutOfBounds(position, min, max, constant = 0.15) {\n  if (constant === 0) return clamp(position, min, max);\n  if (position < min) return -rubberband(min - position, max - min, constant) + min;\n  if (position > max) return +rubberband(position - max, max - min, constant) + max;\n  return position;\n}\nfunction computeRubberband(bounds, [Vx, Vy], [Rx, Ry]) {\n  const [[X0, X1], [Y0, Y1]] = bounds;\n  return [rubberbandIfOutOfBounds(Vx, X0, X1, Rx), rubberbandIfOutOfBounds(Vy, Y0, Y1, Ry)];\n}\n\nexport { V, computeRubberband as c, rubberbandIfOutOfBounds as r };\n", "import { V, c as computeRubberband } from './maths-0ab39ae9.esm.js';\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      _defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}\n\nconst EVENT_TYPE_MAP = {\n  pointer: {\n    start: 'down',\n    change: 'move',\n    end: 'up'\n  },\n  mouse: {\n    start: 'down',\n    change: 'move',\n    end: 'up'\n  },\n  touch: {\n    start: 'start',\n    change: 'move',\n    end: 'end'\n  },\n  gesture: {\n    start: 'start',\n    change: 'change',\n    end: 'end'\n  }\n};\nfunction capitalize(string) {\n  if (!string) return '';\n  return string[0].toUpperCase() + string.slice(1);\n}\nconst actionsWithoutCaptureSupported = ['enter', 'leave'];\nfunction hasCapture(capture = false, actionKey) {\n  return capture && !actionsWithoutCaptureSupported.includes(actionKey);\n}\nfunction toHandlerProp(device, action = '', capture = false) {\n  const deviceProps = EVENT_TYPE_MAP[device];\n  const actionKey = deviceProps ? deviceProps[action] || action : action;\n  return 'on' + capitalize(device) + capitalize(actionKey) + (hasCapture(capture, actionKey) ? 'Capture' : '');\n}\nconst pointerCaptureEvents = ['gotpointercapture', 'lostpointercapture'];\nfunction parseProp(prop) {\n  let eventKey = prop.substring(2).toLowerCase();\n  const passive = !!~eventKey.indexOf('passive');\n  if (passive) eventKey = eventKey.replace('passive', '');\n  const captureKey = pointerCaptureEvents.includes(eventKey) ? 'capturecapture' : 'capture';\n  const capture = !!~eventKey.indexOf(captureKey);\n  if (capture) eventKey = eventKey.replace('capture', '');\n  return {\n    device: eventKey,\n    capture,\n    passive\n  };\n}\nfunction toDomEventType(device, action = '') {\n  const deviceProps = EVENT_TYPE_MAP[device];\n  const actionKey = deviceProps ? deviceProps[action] || action : action;\n  return device + actionKey;\n}\nfunction isTouch(event) {\n  return 'touches' in event;\n}\nfunction getPointerType(event) {\n  if (isTouch(event)) return 'touch';\n  if ('pointerType' in event) return event.pointerType;\n  return 'mouse';\n}\nfunction getCurrentTargetTouchList(event) {\n  return Array.from(event.touches).filter(e => {\n    var _event$currentTarget, _event$currentTarget$;\n    return e.target === event.currentTarget || ((_event$currentTarget = event.currentTarget) === null || _event$currentTarget === void 0 || (_event$currentTarget$ = _event$currentTarget.contains) === null || _event$currentTarget$ === void 0 ? void 0 : _event$currentTarget$.call(_event$currentTarget, e.target));\n  });\n}\nfunction getTouchList(event) {\n  return event.type === 'touchend' || event.type === 'touchcancel' ? event.changedTouches : event.targetTouches;\n}\nfunction getValueEvent(event) {\n  return isTouch(event) ? getTouchList(event)[0] : event;\n}\nfunction distanceAngle(P1, P2) {\n  try {\n    const dx = P2.clientX - P1.clientX;\n    const dy = P2.clientY - P1.clientY;\n    const cx = (P2.clientX + P1.clientX) / 2;\n    const cy = (P2.clientY + P1.clientY) / 2;\n    const distance = Math.hypot(dx, dy);\n    const angle = -(Math.atan2(dx, dy) * 180) / Math.PI;\n    const origin = [cx, cy];\n    return {\n      angle,\n      distance,\n      origin\n    };\n  } catch (_unused) {}\n  return null;\n}\nfunction touchIds(event) {\n  return getCurrentTargetTouchList(event).map(touch => touch.identifier);\n}\nfunction touchDistanceAngle(event, ids) {\n  const [P1, P2] = Array.from(event.touches).filter(touch => ids.includes(touch.identifier));\n  return distanceAngle(P1, P2);\n}\nfunction pointerId(event) {\n  const valueEvent = getValueEvent(event);\n  return isTouch(event) ? valueEvent.identifier : valueEvent.pointerId;\n}\nfunction pointerValues(event) {\n  const valueEvent = getValueEvent(event);\n  return [valueEvent.clientX, valueEvent.clientY];\n}\nconst LINE_HEIGHT = 40;\nconst PAGE_HEIGHT = 800;\nfunction wheelValues(event) {\n  let {\n    deltaX,\n    deltaY,\n    deltaMode\n  } = event;\n  if (deltaMode === 1) {\n    deltaX *= LINE_HEIGHT;\n    deltaY *= LINE_HEIGHT;\n  } else if (deltaMode === 2) {\n    deltaX *= PAGE_HEIGHT;\n    deltaY *= PAGE_HEIGHT;\n  }\n  return [deltaX, deltaY];\n}\nfunction scrollValues(event) {\n  var _ref, _ref2;\n  const {\n    scrollX,\n    scrollY,\n    scrollLeft,\n    scrollTop\n  } = event.currentTarget;\n  return [(_ref = scrollX !== null && scrollX !== void 0 ? scrollX : scrollLeft) !== null && _ref !== void 0 ? _ref : 0, (_ref2 = scrollY !== null && scrollY !== void 0 ? scrollY : scrollTop) !== null && _ref2 !== void 0 ? _ref2 : 0];\n}\nfunction getEventDetails(event) {\n  const payload = {};\n  if ('buttons' in event) payload.buttons = event.buttons;\n  if ('shiftKey' in event) {\n    const {\n      shiftKey,\n      altKey,\n      metaKey,\n      ctrlKey\n    } = event;\n    Object.assign(payload, {\n      shiftKey,\n      altKey,\n      metaKey,\n      ctrlKey\n    });\n  }\n  return payload;\n}\n\nfunction call(v, ...args) {\n  if (typeof v === 'function') {\n    return v(...args);\n  } else {\n    return v;\n  }\n}\nfunction noop() {}\nfunction chain(...fns) {\n  if (fns.length === 0) return noop;\n  if (fns.length === 1) return fns[0];\n  return function () {\n    let result;\n    for (const fn of fns) {\n      result = fn.apply(this, arguments) || result;\n    }\n    return result;\n  };\n}\nfunction assignDefault(value, fallback) {\n  return Object.assign({}, fallback, value || {});\n}\n\nconst BEFORE_LAST_KINEMATICS_DELAY = 32;\nclass Engine {\n  constructor(ctrl, args, key) {\n    this.ctrl = ctrl;\n    this.args = args;\n    this.key = key;\n    if (!this.state) {\n      this.state = {};\n      this.computeValues([0, 0]);\n      this.computeInitial();\n      if (this.init) this.init();\n      this.reset();\n    }\n  }\n  get state() {\n    return this.ctrl.state[this.key];\n  }\n  set state(state) {\n    this.ctrl.state[this.key] = state;\n  }\n  get shared() {\n    return this.ctrl.state.shared;\n  }\n  get eventStore() {\n    return this.ctrl.gestureEventStores[this.key];\n  }\n  get timeoutStore() {\n    return this.ctrl.gestureTimeoutStores[this.key];\n  }\n  get config() {\n    return this.ctrl.config[this.key];\n  }\n  get sharedConfig() {\n    return this.ctrl.config.shared;\n  }\n  get handler() {\n    return this.ctrl.handlers[this.key];\n  }\n  reset() {\n    const {\n      state,\n      shared,\n      ingKey,\n      args\n    } = this;\n    shared[ingKey] = state._active = state.active = state._blocked = state._force = false;\n    state._step = [false, false];\n    state.intentional = false;\n    state._movement = [0, 0];\n    state._distance = [0, 0];\n    state._direction = [0, 0];\n    state._delta = [0, 0];\n    state._bounds = [[-Infinity, Infinity], [-Infinity, Infinity]];\n    state.args = args;\n    state.axis = undefined;\n    state.memo = undefined;\n    state.elapsedTime = state.timeDelta = 0;\n    state.direction = [0, 0];\n    state.distance = [0, 0];\n    state.overflow = [0, 0];\n    state._movementBound = [false, false];\n    state.velocity = [0, 0];\n    state.movement = [0, 0];\n    state.delta = [0, 0];\n    state.timeStamp = 0;\n  }\n  start(event) {\n    const state = this.state;\n    const config = this.config;\n    if (!state._active) {\n      this.reset();\n      this.computeInitial();\n      state._active = true;\n      state.target = event.target;\n      state.currentTarget = event.currentTarget;\n      state.lastOffset = config.from ? call(config.from, state) : state.offset;\n      state.offset = state.lastOffset;\n      state.startTime = state.timeStamp = event.timeStamp;\n    }\n  }\n  computeValues(values) {\n    const state = this.state;\n    state._values = values;\n    state.values = this.config.transform(values);\n  }\n  computeInitial() {\n    const state = this.state;\n    state._initial = state._values;\n    state.initial = state.values;\n  }\n  compute(event) {\n    const {\n      state,\n      config,\n      shared\n    } = this;\n    state.args = this.args;\n    let dt = 0;\n    if (event) {\n      state.event = event;\n      if (config.preventDefault && event.cancelable) state.event.preventDefault();\n      state.type = event.type;\n      shared.touches = this.ctrl.pointerIds.size || this.ctrl.touchIds.size;\n      shared.locked = !!document.pointerLockElement;\n      Object.assign(shared, getEventDetails(event));\n      shared.down = shared.pressed = shared.buttons % 2 === 1 || shared.touches > 0;\n      dt = event.timeStamp - state.timeStamp;\n      state.timeStamp = event.timeStamp;\n      state.elapsedTime = state.timeStamp - state.startTime;\n    }\n    if (state._active) {\n      const _absoluteDelta = state._delta.map(Math.abs);\n      V.addTo(state._distance, _absoluteDelta);\n    }\n    if (this.axisIntent) this.axisIntent(event);\n    const [_m0, _m1] = state._movement;\n    const [t0, t1] = config.threshold;\n    const {\n      _step,\n      values\n    } = state;\n    if (config.hasCustomTransform) {\n      if (_step[0] === false) _step[0] = Math.abs(_m0) >= t0 && values[0];\n      if (_step[1] === false) _step[1] = Math.abs(_m1) >= t1 && values[1];\n    } else {\n      if (_step[0] === false) _step[0] = Math.abs(_m0) >= t0 && Math.sign(_m0) * t0;\n      if (_step[1] === false) _step[1] = Math.abs(_m1) >= t1 && Math.sign(_m1) * t1;\n    }\n    state.intentional = _step[0] !== false || _step[1] !== false;\n    if (!state.intentional) return;\n    const movement = [0, 0];\n    if (config.hasCustomTransform) {\n      const [v0, v1] = values;\n      movement[0] = _step[0] !== false ? v0 - _step[0] : 0;\n      movement[1] = _step[1] !== false ? v1 - _step[1] : 0;\n    } else {\n      movement[0] = _step[0] !== false ? _m0 - _step[0] : 0;\n      movement[1] = _step[1] !== false ? _m1 - _step[1] : 0;\n    }\n    if (this.restrictToAxis && !state._blocked) this.restrictToAxis(movement);\n    const previousOffset = state.offset;\n    const gestureIsActive = state._active && !state._blocked || state.active;\n    if (gestureIsActive) {\n      state.first = state._active && !state.active;\n      state.last = !state._active && state.active;\n      state.active = shared[this.ingKey] = state._active;\n      if (event) {\n        if (state.first) {\n          if ('bounds' in config) state._bounds = call(config.bounds, state);\n          if (this.setup) this.setup();\n        }\n        state.movement = movement;\n        this.computeOffset();\n      }\n    }\n    const [ox, oy] = state.offset;\n    const [[x0, x1], [y0, y1]] = state._bounds;\n    state.overflow = [ox < x0 ? -1 : ox > x1 ? 1 : 0, oy < y0 ? -1 : oy > y1 ? 1 : 0];\n    state._movementBound[0] = state.overflow[0] ? state._movementBound[0] === false ? state._movement[0] : state._movementBound[0] : false;\n    state._movementBound[1] = state.overflow[1] ? state._movementBound[1] === false ? state._movement[1] : state._movementBound[1] : false;\n    const rubberband = state._active ? config.rubberband || [0, 0] : [0, 0];\n    state.offset = computeRubberband(state._bounds, state.offset, rubberband);\n    state.delta = V.sub(state.offset, previousOffset);\n    this.computeMovement();\n    if (gestureIsActive && (!state.last || dt > BEFORE_LAST_KINEMATICS_DELAY)) {\n      state.delta = V.sub(state.offset, previousOffset);\n      const absoluteDelta = state.delta.map(Math.abs);\n      V.addTo(state.distance, absoluteDelta);\n      state.direction = state.delta.map(Math.sign);\n      state._direction = state._delta.map(Math.sign);\n      if (!state.first && dt > 0) {\n        state.velocity = [absoluteDelta[0] / dt, absoluteDelta[1] / dt];\n        state.timeDelta = dt;\n      }\n    }\n  }\n  emit() {\n    const state = this.state;\n    const shared = this.shared;\n    const config = this.config;\n    if (!state._active) this.clean();\n    if ((state._blocked || !state.intentional) && !state._force && !config.triggerAllEvents) return;\n    const memo = this.handler(_objectSpread2(_objectSpread2(_objectSpread2({}, shared), state), {}, {\n      [this.aliasKey]: state.values\n    }));\n    if (memo !== undefined) state.memo = memo;\n  }\n  clean() {\n    this.eventStore.clean();\n    this.timeoutStore.clean();\n  }\n}\n\nfunction selectAxis([dx, dy], threshold) {\n  const absDx = Math.abs(dx);\n  const absDy = Math.abs(dy);\n  if (absDx > absDy && absDx > threshold) {\n    return 'x';\n  }\n  if (absDy > absDx && absDy > threshold) {\n    return 'y';\n  }\n  return undefined;\n}\nclass CoordinatesEngine extends Engine {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"aliasKey\", 'xy');\n  }\n  reset() {\n    super.reset();\n    this.state.axis = undefined;\n  }\n  init() {\n    this.state.offset = [0, 0];\n    this.state.lastOffset = [0, 0];\n  }\n  computeOffset() {\n    this.state.offset = V.add(this.state.lastOffset, this.state.movement);\n  }\n  computeMovement() {\n    this.state.movement = V.sub(this.state.offset, this.state.lastOffset);\n  }\n  axisIntent(event) {\n    const state = this.state;\n    const config = this.config;\n    if (!state.axis && event) {\n      const threshold = typeof config.axisThreshold === 'object' ? config.axisThreshold[getPointerType(event)] : config.axisThreshold;\n      state.axis = selectAxis(state._movement, threshold);\n    }\n    state._blocked = (config.lockDirection || !!config.axis) && !state.axis || !!config.axis && config.axis !== state.axis;\n  }\n  restrictToAxis(v) {\n    if (this.config.axis || this.config.lockDirection) {\n      switch (this.state.axis) {\n        case 'x':\n          v[1] = 0;\n          break;\n        case 'y':\n          v[0] = 0;\n          break;\n      }\n    }\n  }\n}\n\nconst identity = v => v;\nconst DEFAULT_RUBBERBAND = 0.15;\nconst commonConfigResolver = {\n  enabled(value = true) {\n    return value;\n  },\n  eventOptions(value, _k, config) {\n    return _objectSpread2(_objectSpread2({}, config.shared.eventOptions), value);\n  },\n  preventDefault(value = false) {\n    return value;\n  },\n  triggerAllEvents(value = false) {\n    return value;\n  },\n  rubberband(value = 0) {\n    switch (value) {\n      case true:\n        return [DEFAULT_RUBBERBAND, DEFAULT_RUBBERBAND];\n      case false:\n        return [0, 0];\n      default:\n        return V.toVector(value);\n    }\n  },\n  from(value) {\n    if (typeof value === 'function') return value;\n    if (value != null) return V.toVector(value);\n  },\n  transform(value, _k, config) {\n    const transform = value || config.shared.transform;\n    this.hasCustomTransform = !!transform;\n    if (process.env.NODE_ENV === 'development') {\n      const originalTransform = transform || identity;\n      return v => {\n        const r = originalTransform(v);\n        if (!isFinite(r[0]) || !isFinite(r[1])) {\n          console.warn(`[@use-gesture]: config.transform() must produce a valid result, but it was: [${r[0]},${[1]}]`);\n        }\n        return r;\n      };\n    }\n    return transform || identity;\n  },\n  threshold(value) {\n    return V.toVector(value, 0);\n  }\n};\nif (process.env.NODE_ENV === 'development') {\n  Object.assign(commonConfigResolver, {\n    domTarget(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`domTarget\\` option has been renamed to \\`target\\`.`);\n      }\n      return NaN;\n    },\n    lockDirection(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`lockDirection\\` option has been merged with \\`axis\\`. Use it as in \\`{ axis: 'lock' }\\``);\n      }\n      return NaN;\n    },\n    initial(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`initial\\` option has been renamed to \\`from\\`.`);\n      }\n      return NaN;\n    }\n  });\n}\n\nconst DEFAULT_AXIS_THRESHOLD = 0;\nconst coordinatesConfigResolver = _objectSpread2(_objectSpread2({}, commonConfigResolver), {}, {\n  axis(_v, _k, {\n    axis\n  }) {\n    this.lockDirection = axis === 'lock';\n    if (!this.lockDirection) return axis;\n  },\n  axisThreshold(value = DEFAULT_AXIS_THRESHOLD) {\n    return value;\n  },\n  bounds(value = {}) {\n    if (typeof value === 'function') {\n      return state => coordinatesConfigResolver.bounds(value(state));\n    }\n    if ('current' in value) {\n      return () => value.current;\n    }\n    if (typeof HTMLElement === 'function' && value instanceof HTMLElement) {\n      return value;\n    }\n    const {\n      left = -Infinity,\n      right = Infinity,\n      top = -Infinity,\n      bottom = Infinity\n    } = value;\n    return [[left, right], [top, bottom]];\n  }\n});\n\nconst KEYS_DELTA_MAP = {\n  ArrowRight: (displacement, factor = 1) => [displacement * factor, 0],\n  ArrowLeft: (displacement, factor = 1) => [-1 * displacement * factor, 0],\n  ArrowUp: (displacement, factor = 1) => [0, -1 * displacement * factor],\n  ArrowDown: (displacement, factor = 1) => [0, displacement * factor]\n};\nclass DragEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"ingKey\", 'dragging');\n  }\n  reset() {\n    super.reset();\n    const state = this.state;\n    state._pointerId = undefined;\n    state._pointerActive = false;\n    state._keyboardActive = false;\n    state._preventScroll = false;\n    state._delayed = false;\n    state.swipe = [0, 0];\n    state.tap = false;\n    state.canceled = false;\n    state.cancel = this.cancel.bind(this);\n  }\n  setup() {\n    const state = this.state;\n    if (state._bounds instanceof HTMLElement) {\n      const boundRect = state._bounds.getBoundingClientRect();\n      const targetRect = state.currentTarget.getBoundingClientRect();\n      const _bounds = {\n        left: boundRect.left - targetRect.left + state.offset[0],\n        right: boundRect.right - targetRect.right + state.offset[0],\n        top: boundRect.top - targetRect.top + state.offset[1],\n        bottom: boundRect.bottom - targetRect.bottom + state.offset[1]\n      };\n      state._bounds = coordinatesConfigResolver.bounds(_bounds);\n    }\n  }\n  cancel() {\n    const state = this.state;\n    if (state.canceled) return;\n    state.canceled = true;\n    state._active = false;\n    setTimeout(() => {\n      this.compute();\n      this.emit();\n    }, 0);\n  }\n  setActive() {\n    this.state._active = this.state._pointerActive || this.state._keyboardActive;\n  }\n  clean() {\n    this.pointerClean();\n    this.state._pointerActive = false;\n    this.state._keyboardActive = false;\n    super.clean();\n  }\n  pointerDown(event) {\n    const config = this.config;\n    const state = this.state;\n    if (event.buttons != null && (Array.isArray(config.pointerButtons) ? !config.pointerButtons.includes(event.buttons) : config.pointerButtons !== -1 && config.pointerButtons !== event.buttons)) return;\n    const ctrlIds = this.ctrl.setEventIds(event);\n    if (config.pointerCapture) {\n      event.target.setPointerCapture(event.pointerId);\n    }\n    if (ctrlIds && ctrlIds.size > 1 && state._pointerActive) return;\n    this.start(event);\n    this.setupPointer(event);\n    state._pointerId = pointerId(event);\n    state._pointerActive = true;\n    this.computeValues(pointerValues(event));\n    this.computeInitial();\n    if (config.preventScrollAxis && getPointerType(event) !== 'mouse') {\n      state._active = false;\n      this.setupScrollPrevention(event);\n    } else if (config.delay > 0) {\n      this.setupDelayTrigger(event);\n      if (config.triggerAllEvents) {\n        this.compute(event);\n        this.emit();\n      }\n    } else {\n      this.startPointerDrag(event);\n    }\n  }\n  startPointerDrag(event) {\n    const state = this.state;\n    state._active = true;\n    state._preventScroll = true;\n    state._delayed = false;\n    this.compute(event);\n    this.emit();\n  }\n  pointerMove(event) {\n    const state = this.state;\n    const config = this.config;\n    if (!state._pointerActive) return;\n    const id = pointerId(event);\n    if (state._pointerId !== undefined && id !== state._pointerId) return;\n    const _values = pointerValues(event);\n    if (document.pointerLockElement === event.target) {\n      state._delta = [event.movementX, event.movementY];\n    } else {\n      state._delta = V.sub(_values, state._values);\n      this.computeValues(_values);\n    }\n    V.addTo(state._movement, state._delta);\n    this.compute(event);\n    if (state._delayed && state.intentional) {\n      this.timeoutStore.remove('dragDelay');\n      state.active = false;\n      this.startPointerDrag(event);\n      return;\n    }\n    if (config.preventScrollAxis && !state._preventScroll) {\n      if (state.axis) {\n        if (state.axis === config.preventScrollAxis || config.preventScrollAxis === 'xy') {\n          state._active = false;\n          this.clean();\n          return;\n        } else {\n          this.timeoutStore.remove('startPointerDrag');\n          this.startPointerDrag(event);\n          return;\n        }\n      } else {\n        return;\n      }\n    }\n    this.emit();\n  }\n  pointerUp(event) {\n    this.ctrl.setEventIds(event);\n    try {\n      if (this.config.pointerCapture && event.target.hasPointerCapture(event.pointerId)) {\n        ;\n        event.target.releasePointerCapture(event.pointerId);\n      }\n    } catch (_unused) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(`[@use-gesture]: If you see this message, it's likely that you're using an outdated version of \\`@react-three/fiber\\`. \\n\\nPlease upgrade to the latest version.`);\n      }\n    }\n    const state = this.state;\n    const config = this.config;\n    if (!state._active || !state._pointerActive) return;\n    const id = pointerId(event);\n    if (state._pointerId !== undefined && id !== state._pointerId) return;\n    this.state._pointerActive = false;\n    this.setActive();\n    this.compute(event);\n    const [dx, dy] = state._distance;\n    state.tap = dx <= config.tapsThreshold && dy <= config.tapsThreshold;\n    if (state.tap && config.filterTaps) {\n      state._force = true;\n    } else {\n      const [_dx, _dy] = state._delta;\n      const [_mx, _my] = state._movement;\n      const [svx, svy] = config.swipe.velocity;\n      const [sx, sy] = config.swipe.distance;\n      const sdt = config.swipe.duration;\n      if (state.elapsedTime < sdt) {\n        const _vx = Math.abs(_dx / state.timeDelta);\n        const _vy = Math.abs(_dy / state.timeDelta);\n        if (_vx > svx && Math.abs(_mx) > sx) state.swipe[0] = Math.sign(_dx);\n        if (_vy > svy && Math.abs(_my) > sy) state.swipe[1] = Math.sign(_dy);\n      }\n    }\n    this.emit();\n  }\n  pointerClick(event) {\n    if (!this.state.tap && event.detail > 0) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n  setupPointer(event) {\n    const config = this.config;\n    const device = config.device;\n    if (process.env.NODE_ENV === 'development') {\n      try {\n        if (device === 'pointer' && config.preventScrollDelay === undefined) {\n          const currentTarget = 'uv' in event ? event.sourceEvent.currentTarget : event.currentTarget;\n          const style = window.getComputedStyle(currentTarget);\n          if (style.touchAction === 'auto') {\n            console.warn(`[@use-gesture]: The drag target has its \\`touch-action\\` style property set to \\`auto\\`. It is recommended to add \\`touch-action: 'none'\\` so that the drag gesture behaves correctly on touch-enabled devices. For more information read this: https://use-gesture.netlify.app/docs/extras/#touch-action.\\n\\nThis message will only show in development mode. It won't appear in production. If this is intended, you can ignore it.`, currentTarget);\n          }\n        }\n      } catch (_unused2) {}\n    }\n    if (config.pointerLock) {\n      event.currentTarget.requestPointerLock();\n    }\n    if (!config.pointerCapture) {\n      this.eventStore.add(this.sharedConfig.window, device, 'change', this.pointerMove.bind(this));\n      this.eventStore.add(this.sharedConfig.window, device, 'end', this.pointerUp.bind(this));\n      this.eventStore.add(this.sharedConfig.window, device, 'cancel', this.pointerUp.bind(this));\n    }\n  }\n  pointerClean() {\n    if (this.config.pointerLock && document.pointerLockElement === this.state.currentTarget) {\n      document.exitPointerLock();\n    }\n  }\n  preventScroll(event) {\n    if (this.state._preventScroll && event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  setupScrollPrevention(event) {\n    this.state._preventScroll = false;\n    persistEvent(event);\n    const remove = this.eventStore.add(this.sharedConfig.window, 'touch', 'change', this.preventScroll.bind(this), {\n      passive: false\n    });\n    this.eventStore.add(this.sharedConfig.window, 'touch', 'end', remove);\n    this.eventStore.add(this.sharedConfig.window, 'touch', 'cancel', remove);\n    this.timeoutStore.add('startPointerDrag', this.startPointerDrag.bind(this), this.config.preventScrollDelay, event);\n  }\n  setupDelayTrigger(event) {\n    this.state._delayed = true;\n    this.timeoutStore.add('dragDelay', () => {\n      this.state._step = [0, 0];\n      this.startPointerDrag(event);\n    }, this.config.delay);\n  }\n  keyDown(event) {\n    const deltaFn = KEYS_DELTA_MAP[event.key];\n    if (deltaFn) {\n      const state = this.state;\n      const factor = event.shiftKey ? 10 : event.altKey ? 0.1 : 1;\n      this.start(event);\n      state._delta = deltaFn(this.config.keyboardDisplacement, factor);\n      state._keyboardActive = true;\n      V.addTo(state._movement, state._delta);\n      this.compute(event);\n      this.emit();\n    }\n  }\n  keyUp(event) {\n    if (!(event.key in KEYS_DELTA_MAP)) return;\n    this.state._keyboardActive = false;\n    this.setActive();\n    this.compute(event);\n    this.emit();\n  }\n  bind(bindFunction) {\n    const device = this.config.device;\n    bindFunction(device, 'start', this.pointerDown.bind(this));\n    if (this.config.pointerCapture) {\n      bindFunction(device, 'change', this.pointerMove.bind(this));\n      bindFunction(device, 'end', this.pointerUp.bind(this));\n      bindFunction(device, 'cancel', this.pointerUp.bind(this));\n      bindFunction('lostPointerCapture', '', this.pointerUp.bind(this));\n    }\n    if (this.config.keys) {\n      bindFunction('key', 'down', this.keyDown.bind(this));\n      bindFunction('key', 'up', this.keyUp.bind(this));\n    }\n    if (this.config.filterTaps) {\n      bindFunction('click', '', this.pointerClick.bind(this), {\n        capture: true,\n        passive: false\n      });\n    }\n  }\n}\nfunction persistEvent(event) {\n  'persist' in event && typeof event.persist === 'function' && event.persist();\n}\n\nconst isBrowser = typeof window !== 'undefined' && window.document && window.document.createElement;\nfunction supportsTouchEvents() {\n  return isBrowser && 'ontouchstart' in window;\n}\nfunction isTouchScreen() {\n  return supportsTouchEvents() || isBrowser && window.navigator.maxTouchPoints > 1;\n}\nfunction supportsPointerEvents() {\n  return isBrowser && 'onpointerdown' in window;\n}\nfunction supportsPointerLock() {\n  return isBrowser && 'exitPointerLock' in window.document;\n}\nfunction supportsGestureEvents() {\n  try {\n    return 'constructor' in GestureEvent;\n  } catch (e) {\n    return false;\n  }\n}\nconst SUPPORT = {\n  isBrowser,\n  gesture: supportsGestureEvents(),\n  touch: supportsTouchEvents(),\n  touchscreen: isTouchScreen(),\n  pointer: supportsPointerEvents(),\n  pointerLock: supportsPointerLock()\n};\n\nconst DEFAULT_PREVENT_SCROLL_DELAY = 250;\nconst DEFAULT_DRAG_DELAY = 180;\nconst DEFAULT_SWIPE_VELOCITY = 0.5;\nconst DEFAULT_SWIPE_DISTANCE = 50;\nconst DEFAULT_SWIPE_DURATION = 250;\nconst DEFAULT_KEYBOARD_DISPLACEMENT = 10;\nconst DEFAULT_DRAG_AXIS_THRESHOLD = {\n  mouse: 0,\n  touch: 0,\n  pen: 8\n};\nconst dragConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  device(_v, _k, {\n    pointer: {\n      touch = false,\n      lock = false,\n      mouse = false\n    } = {}\n  }) {\n    this.pointerLock = lock && SUPPORT.pointerLock;\n    if (SUPPORT.touch && touch) return 'touch';\n    if (this.pointerLock) return 'mouse';\n    if (SUPPORT.pointer && !mouse) return 'pointer';\n    if (SUPPORT.touch) return 'touch';\n    return 'mouse';\n  },\n  preventScrollAxis(value, _k, {\n    preventScroll\n  }) {\n    this.preventScrollDelay = typeof preventScroll === 'number' ? preventScroll : preventScroll || preventScroll === undefined && value ? DEFAULT_PREVENT_SCROLL_DELAY : undefined;\n    if (!SUPPORT.touchscreen || preventScroll === false) return undefined;\n    return value ? value : preventScroll !== undefined ? 'y' : undefined;\n  },\n  pointerCapture(_v, _k, {\n    pointer: {\n      capture = true,\n      buttons = 1,\n      keys = true\n    } = {}\n  }) {\n    this.pointerButtons = buttons;\n    this.keys = keys;\n    return !this.pointerLock && this.device === 'pointer' && capture;\n  },\n  threshold(value, _k, {\n    filterTaps = false,\n    tapsThreshold = 3,\n    axis = undefined\n  }) {\n    const threshold = V.toVector(value, filterTaps ? tapsThreshold : axis ? 1 : 0);\n    this.filterTaps = filterTaps;\n    this.tapsThreshold = tapsThreshold;\n    return threshold;\n  },\n  swipe({\n    velocity = DEFAULT_SWIPE_VELOCITY,\n    distance = DEFAULT_SWIPE_DISTANCE,\n    duration = DEFAULT_SWIPE_DURATION\n  } = {}) {\n    return {\n      velocity: this.transform(V.toVector(velocity)),\n      distance: this.transform(V.toVector(distance)),\n      duration\n    };\n  },\n  delay(value = 0) {\n    switch (value) {\n      case true:\n        return DEFAULT_DRAG_DELAY;\n      case false:\n        return 0;\n      default:\n        return value;\n    }\n  },\n  axisThreshold(value) {\n    if (!value) return DEFAULT_DRAG_AXIS_THRESHOLD;\n    return _objectSpread2(_objectSpread2({}, DEFAULT_DRAG_AXIS_THRESHOLD), value);\n  },\n  keyboardDisplacement(value = DEFAULT_KEYBOARD_DISPLACEMENT) {\n    return value;\n  }\n});\nif (process.env.NODE_ENV === 'development') {\n  Object.assign(dragConfigResolver, {\n    useTouch(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`useTouch\\` option has been renamed to \\`pointer.touch\\`. Use it as in \\`{ pointer: { touch: true } }\\`.`);\n      }\n      return NaN;\n    },\n    experimental_preventWindowScrollY(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`experimental_preventWindowScrollY\\` option has been renamed to \\`preventScroll\\`.`);\n      }\n      return NaN;\n    },\n    swipeVelocity(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeVelocity\\` option has been renamed to \\`swipe.velocity\\`. Use it as in \\`{ swipe: { velocity: 0.5 } }\\`.`);\n      }\n      return NaN;\n    },\n    swipeDistance(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeDistance\\` option has been renamed to \\`swipe.distance\\`. Use it as in \\`{ swipe: { distance: 50 } }\\`.`);\n      }\n      return NaN;\n    },\n    swipeDuration(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeDuration\\` option has been renamed to \\`swipe.duration\\`. Use it as in \\`{ swipe: { duration: 250 } }\\`.`);\n      }\n      return NaN;\n    }\n  });\n}\n\nfunction clampStateInternalMovementToBounds(state) {\n  const [ox, oy] = state.overflow;\n  const [dx, dy] = state._delta;\n  const [dirx, diry] = state._direction;\n  if (ox < 0 && dx > 0 && dirx < 0 || ox > 0 && dx < 0 && dirx > 0) {\n    state._movement[0] = state._movementBound[0];\n  }\n  if (oy < 0 && dy > 0 && diry < 0 || oy > 0 && dy < 0 && diry > 0) {\n    state._movement[1] = state._movementBound[1];\n  }\n}\n\nconst SCALE_ANGLE_RATIO_INTENT_DEG = 30;\nconst PINCH_WHEEL_RATIO = 100;\nclass PinchEngine extends Engine {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"ingKey\", 'pinching');\n    _defineProperty(this, \"aliasKey\", 'da');\n  }\n  init() {\n    this.state.offset = [1, 0];\n    this.state.lastOffset = [1, 0];\n    this.state._pointerEvents = new Map();\n  }\n  reset() {\n    super.reset();\n    const state = this.state;\n    state._touchIds = [];\n    state.canceled = false;\n    state.cancel = this.cancel.bind(this);\n    state.turns = 0;\n  }\n  computeOffset() {\n    const {\n      type,\n      movement,\n      lastOffset\n    } = this.state;\n    if (type === 'wheel') {\n      this.state.offset = V.add(movement, lastOffset);\n    } else {\n      this.state.offset = [(1 + movement[0]) * lastOffset[0], movement[1] + lastOffset[1]];\n    }\n  }\n  computeMovement() {\n    const {\n      offset,\n      lastOffset\n    } = this.state;\n    this.state.movement = [offset[0] / lastOffset[0], offset[1] - lastOffset[1]];\n  }\n  axisIntent() {\n    const state = this.state;\n    const [_m0, _m1] = state._movement;\n    if (!state.axis) {\n      const axisMovementDifference = Math.abs(_m0) * SCALE_ANGLE_RATIO_INTENT_DEG - Math.abs(_m1);\n      if (axisMovementDifference < 0) state.axis = 'angle';else if (axisMovementDifference > 0) state.axis = 'scale';\n    }\n  }\n  restrictToAxis(v) {\n    if (this.config.lockDirection) {\n      if (this.state.axis === 'scale') v[1] = 0;else if (this.state.axis === 'angle') v[0] = 0;\n    }\n  }\n  cancel() {\n    const state = this.state;\n    if (state.canceled) return;\n    setTimeout(() => {\n      state.canceled = true;\n      state._active = false;\n      this.compute();\n      this.emit();\n    }, 0);\n  }\n  touchStart(event) {\n    this.ctrl.setEventIds(event);\n    const state = this.state;\n    const ctrlTouchIds = this.ctrl.touchIds;\n    if (state._active) {\n      if (state._touchIds.every(id => ctrlTouchIds.has(id))) return;\n    }\n    if (ctrlTouchIds.size < 2) return;\n    this.start(event);\n    state._touchIds = Array.from(ctrlTouchIds).slice(0, 2);\n    const payload = touchDistanceAngle(event, state._touchIds);\n    if (!payload) return;\n    this.pinchStart(event, payload);\n  }\n  pointerStart(event) {\n    if (event.buttons != null && event.buttons % 2 !== 1) return;\n    this.ctrl.setEventIds(event);\n    event.target.setPointerCapture(event.pointerId);\n    const state = this.state;\n    const _pointerEvents = state._pointerEvents;\n    const ctrlPointerIds = this.ctrl.pointerIds;\n    if (state._active) {\n      if (Array.from(_pointerEvents.keys()).every(id => ctrlPointerIds.has(id))) return;\n    }\n    if (_pointerEvents.size < 2) {\n      _pointerEvents.set(event.pointerId, event);\n    }\n    if (state._pointerEvents.size < 2) return;\n    this.start(event);\n    const payload = distanceAngle(...Array.from(_pointerEvents.values()));\n    if (!payload) return;\n    this.pinchStart(event, payload);\n  }\n  pinchStart(event, payload) {\n    const state = this.state;\n    state.origin = payload.origin;\n    this.computeValues([payload.distance, payload.angle]);\n    this.computeInitial();\n    this.compute(event);\n    this.emit();\n  }\n  touchMove(event) {\n    if (!this.state._active) return;\n    const payload = touchDistanceAngle(event, this.state._touchIds);\n    if (!payload) return;\n    this.pinchMove(event, payload);\n  }\n  pointerMove(event) {\n    const _pointerEvents = this.state._pointerEvents;\n    if (_pointerEvents.has(event.pointerId)) {\n      _pointerEvents.set(event.pointerId, event);\n    }\n    if (!this.state._active) return;\n    const payload = distanceAngle(...Array.from(_pointerEvents.values()));\n    if (!payload) return;\n    this.pinchMove(event, payload);\n  }\n  pinchMove(event, payload) {\n    const state = this.state;\n    const prev_a = state._values[1];\n    const delta_a = payload.angle - prev_a;\n    let delta_turns = 0;\n    if (Math.abs(delta_a) > 270) delta_turns += Math.sign(delta_a);\n    this.computeValues([payload.distance, payload.angle - 360 * delta_turns]);\n    state.origin = payload.origin;\n    state.turns = delta_turns;\n    state._movement = [state._values[0] / state._initial[0] - 1, state._values[1] - state._initial[1]];\n    this.compute(event);\n    this.emit();\n  }\n  touchEnd(event) {\n    this.ctrl.setEventIds(event);\n    if (!this.state._active) return;\n    if (this.state._touchIds.some(id => !this.ctrl.touchIds.has(id))) {\n      this.state._active = false;\n      this.compute(event);\n      this.emit();\n    }\n  }\n  pointerEnd(event) {\n    const state = this.state;\n    this.ctrl.setEventIds(event);\n    try {\n      event.target.releasePointerCapture(event.pointerId);\n    } catch (_unused) {}\n    if (state._pointerEvents.has(event.pointerId)) {\n      state._pointerEvents.delete(event.pointerId);\n    }\n    if (!state._active) return;\n    if (state._pointerEvents.size < 2) {\n      state._active = false;\n      this.compute(event);\n      this.emit();\n    }\n  }\n  gestureStart(event) {\n    if (event.cancelable) event.preventDefault();\n    const state = this.state;\n    if (state._active) return;\n    this.start(event);\n    this.computeValues([event.scale, event.rotation]);\n    state.origin = [event.clientX, event.clientY];\n    this.compute(event);\n    this.emit();\n  }\n  gestureMove(event) {\n    if (event.cancelable) event.preventDefault();\n    if (!this.state._active) return;\n    const state = this.state;\n    this.computeValues([event.scale, event.rotation]);\n    state.origin = [event.clientX, event.clientY];\n    const _previousMovement = state._movement;\n    state._movement = [event.scale - 1, event.rotation];\n    state._delta = V.sub(state._movement, _previousMovement);\n    this.compute(event);\n    this.emit();\n  }\n  gestureEnd(event) {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute(event);\n    this.emit();\n  }\n  wheel(event) {\n    const modifierKey = this.config.modifierKey;\n    if (modifierKey && (Array.isArray(modifierKey) ? !modifierKey.find(k => event[k]) : !event[modifierKey])) return;\n    if (!this.state._active) this.wheelStart(event);else this.wheelChange(event);\n    this.timeoutStore.add('wheelEnd', this.wheelEnd.bind(this));\n  }\n  wheelStart(event) {\n    this.start(event);\n    this.wheelChange(event);\n  }\n  wheelChange(event) {\n    const isR3f = ('uv' in event);\n    if (!isR3f) {\n      if (event.cancelable) {\n        event.preventDefault();\n      }\n      if (process.env.NODE_ENV === 'development' && !event.defaultPrevented) {\n        console.warn(`[@use-gesture]: To properly support zoom on trackpads, try using the \\`target\\` option.\\n\\nThis message will only appear in development mode.`);\n      }\n    }\n    const state = this.state;\n    state._delta = [-wheelValues(event)[1] / PINCH_WHEEL_RATIO * state.offset[0], 0];\n    V.addTo(state._movement, state._delta);\n    clampStateInternalMovementToBounds(state);\n    this.state.origin = [event.clientX, event.clientY];\n    this.compute(event);\n    this.emit();\n  }\n  wheelEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n  bind(bindFunction) {\n    const device = this.config.device;\n    if (!!device) {\n      bindFunction(device, 'start', this[device + 'Start'].bind(this));\n      bindFunction(device, 'change', this[device + 'Move'].bind(this));\n      bindFunction(device, 'end', this[device + 'End'].bind(this));\n      bindFunction(device, 'cancel', this[device + 'End'].bind(this));\n      bindFunction('lostPointerCapture', '', this[device + 'End'].bind(this));\n    }\n    if (this.config.pinchOnWheel) {\n      bindFunction('wheel', '', this.wheel.bind(this), {\n        passive: false\n      });\n    }\n  }\n}\n\nconst pinchConfigResolver = _objectSpread2(_objectSpread2({}, commonConfigResolver), {}, {\n  device(_v, _k, {\n    shared,\n    pointer: {\n      touch = false\n    } = {}\n  }) {\n    const sharedConfig = shared;\n    if (sharedConfig.target && !SUPPORT.touch && SUPPORT.gesture) return 'gesture';\n    if (SUPPORT.touch && touch) return 'touch';\n    if (SUPPORT.touchscreen) {\n      if (SUPPORT.pointer) return 'pointer';\n      if (SUPPORT.touch) return 'touch';\n    }\n  },\n  bounds(_v, _k, {\n    scaleBounds = {},\n    angleBounds = {}\n  }) {\n    const _scaleBounds = state => {\n      const D = assignDefault(call(scaleBounds, state), {\n        min: -Infinity,\n        max: Infinity\n      });\n      return [D.min, D.max];\n    };\n    const _angleBounds = state => {\n      const A = assignDefault(call(angleBounds, state), {\n        min: -Infinity,\n        max: Infinity\n      });\n      return [A.min, A.max];\n    };\n    if (typeof scaleBounds !== 'function' && typeof angleBounds !== 'function') return [_scaleBounds(), _angleBounds()];\n    return state => [_scaleBounds(state), _angleBounds(state)];\n  },\n  threshold(value, _k, config) {\n    this.lockDirection = config.axis === 'lock';\n    const threshold = V.toVector(value, this.lockDirection ? [0.1, 3] : 0);\n    return threshold;\n  },\n  modifierKey(value) {\n    if (value === undefined) return 'ctrlKey';\n    return value;\n  },\n  pinchOnWheel(value = true) {\n    return value;\n  }\n});\n\nclass MoveEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"ingKey\", 'moving');\n  }\n  move(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    if (!this.state._active) this.moveStart(event);else this.moveChange(event);\n    this.timeoutStore.add('moveEnd', this.moveEnd.bind(this));\n  }\n  moveStart(event) {\n    this.start(event);\n    this.computeValues(pointerValues(event));\n    this.compute(event);\n    this.computeInitial();\n    this.emit();\n  }\n  moveChange(event) {\n    if (!this.state._active) return;\n    const values = pointerValues(event);\n    const state = this.state;\n    state._delta = V.sub(values, state._values);\n    V.addTo(state._movement, state._delta);\n    this.computeValues(values);\n    this.compute(event);\n    this.emit();\n  }\n  moveEnd(event) {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute(event);\n    this.emit();\n  }\n  bind(bindFunction) {\n    bindFunction('pointer', 'change', this.move.bind(this));\n    bindFunction('pointer', 'leave', this.moveEnd.bind(this));\n  }\n}\n\nconst moveConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  mouseOnly: (value = true) => value\n});\n\nclass ScrollEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"ingKey\", 'scrolling');\n  }\n  scroll(event) {\n    if (!this.state._active) this.start(event);\n    this.scrollChange(event);\n    this.timeoutStore.add('scrollEnd', this.scrollEnd.bind(this));\n  }\n  scrollChange(event) {\n    if (event.cancelable) event.preventDefault();\n    const state = this.state;\n    const values = scrollValues(event);\n    state._delta = V.sub(values, state._values);\n    V.addTo(state._movement, state._delta);\n    this.computeValues(values);\n    this.compute(event);\n    this.emit();\n  }\n  scrollEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n  bind(bindFunction) {\n    bindFunction('scroll', '', this.scroll.bind(this));\n  }\n}\n\nconst scrollConfigResolver = coordinatesConfigResolver;\n\nclass WheelEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"ingKey\", 'wheeling');\n  }\n  wheel(event) {\n    if (!this.state._active) this.start(event);\n    this.wheelChange(event);\n    this.timeoutStore.add('wheelEnd', this.wheelEnd.bind(this));\n  }\n  wheelChange(event) {\n    const state = this.state;\n    state._delta = wheelValues(event);\n    V.addTo(state._movement, state._delta);\n    clampStateInternalMovementToBounds(state);\n    this.compute(event);\n    this.emit();\n  }\n  wheelEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n  bind(bindFunction) {\n    bindFunction('wheel', '', this.wheel.bind(this));\n  }\n}\n\nconst wheelConfigResolver = coordinatesConfigResolver;\n\nclass HoverEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n    _defineProperty(this, \"ingKey\", 'hovering');\n  }\n  enter(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    this.start(event);\n    this.computeValues(pointerValues(event));\n    this.compute(event);\n    this.emit();\n  }\n  leave(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    const state = this.state;\n    if (!state._active) return;\n    state._active = false;\n    const values = pointerValues(event);\n    state._movement = state._delta = V.sub(values, state._values);\n    this.computeValues(values);\n    this.compute(event);\n    state.delta = state.movement;\n    this.emit();\n  }\n  bind(bindFunction) {\n    bindFunction('pointer', 'enter', this.enter.bind(this));\n    bindFunction('pointer', 'leave', this.leave.bind(this));\n  }\n}\n\nconst hoverConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  mouseOnly: (value = true) => value\n});\n\nconst EngineMap = new Map();\nconst ConfigResolverMap = new Map();\nfunction registerAction(action) {\n  EngineMap.set(action.key, action.engine);\n  ConfigResolverMap.set(action.key, action.resolver);\n}\nconst dragAction = {\n  key: 'drag',\n  engine: DragEngine,\n  resolver: dragConfigResolver\n};\nconst hoverAction = {\n  key: 'hover',\n  engine: HoverEngine,\n  resolver: hoverConfigResolver\n};\nconst moveAction = {\n  key: 'move',\n  engine: MoveEngine,\n  resolver: moveConfigResolver\n};\nconst pinchAction = {\n  key: 'pinch',\n  engine: PinchEngine,\n  resolver: pinchConfigResolver\n};\nconst scrollAction = {\n  key: 'scroll',\n  engine: ScrollEngine,\n  resolver: scrollConfigResolver\n};\nconst wheelAction = {\n  key: 'wheel',\n  engine: WheelEngine,\n  resolver: wheelConfigResolver\n};\n\nexport { ConfigResolverMap as C, EngineMap as E, SUPPORT as S, _objectSpread2 as _, _defineProperty as a, touchIds as b, chain as c, toHandlerProp as d, dragAction as e, pinchAction as f, hoverAction as h, isTouch as i, moveAction as m, parseProp as p, registerAction as r, scrollAction as s, toDomEventType as t, wheelAction as w };\n", "import { registerAction, dragAction, pinchAction, wheelAction, scrollAction, moveAction, hoverAction } from '@use-gesture/core/actions';\nexport * from '@use-gesture/core/actions';\nimport React from 'react';\nimport { Controller, parseMergedHandlers } from '@use-gesture/core';\nexport * from '@use-gesture/core/utils';\nexport * from '@use-gesture/core/types';\n\nfunction useRecognizers(handlers, config = {}, gestureKey, nativeHandlers) {\n  const ctrl = React.useMemo(() => new Controller(handlers), []);\n  ctrl.applyHandlers(handlers, nativeHandlers);\n  ctrl.applyConfig(config, gestureKey);\n  React.useEffect(ctrl.effect.bind(ctrl));\n  React.useEffect(() => {\n    return ctrl.clean.bind(ctrl);\n  }, []);\n  if (config.target === undefined) {\n    return ctrl.bind.bind(ctrl);\n  }\n  return undefined;\n}\n\nfunction useDrag(handler, config) {\n  registerAction(dragAction);\n  return useRecognizers({\n    drag: handler\n  }, config || {}, 'drag');\n}\n\nfunction usePinch(handler, config) {\n  registerAction(pinchAction);\n  return useRecognizers({\n    pinch: handler\n  }, config || {}, 'pinch');\n}\n\nfunction useWheel(handler, config) {\n  registerAction(wheelAction);\n  return useRecognizers({\n    wheel: handler\n  }, config || {}, 'wheel');\n}\n\nfunction useScroll(handler, config) {\n  registerAction(scrollAction);\n  return useRecognizers({\n    scroll: handler\n  }, config || {}, 'scroll');\n}\n\nfunction useMove(handler, config) {\n  registerAction(moveAction);\n  return useRecognizers({\n    move: handler\n  }, config || {}, 'move');\n}\n\nfunction useHover(handler, config) {\n  registerAction(hoverAction);\n  return useRecognizers({\n    hover: handler\n  }, config || {}, 'hover');\n}\n\nfunction createUseGesture(actions) {\n  actions.forEach(registerAction);\n  return function useGesture(_handlers, _config) {\n    const {\n      handlers,\n      nativeHandlers,\n      config\n    } = parseMergedHandlers(_handlers, _config || {});\n    return useRecognizers(handlers, config, undefined, nativeHandlers);\n  };\n}\n\nfunction useGesture(handlers, config) {\n  const hook = createUseGesture([dragAction, pinchAction, scrollAction, wheelAction, moveAction, hoverAction]);\n  return hook(handlers, config || {});\n}\n\nexport { createUseGesture, useDrag, useGesture, useHover, useMove, usePinch, useScroll, useWheel };\n", "import { S as SUPPORT, C as ConfigResolverMap, _ as _objectSpread2, a as _defineProperty, t as toDomEventType, i as isTouch, b as touchIds, E as EngineMap, c as chain, p as parseProp, d as toHandlerProp } from './actions-fe213e88.esm.js';\nimport './maths-0ab39ae9.esm.js';\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}\n\nconst sharedConfigResolver = {\n  target(value) {\n    if (value) {\n      return () => 'current' in value ? value.current : value;\n    }\n    return undefined;\n  },\n  enabled(value = true) {\n    return value;\n  },\n  window(value = SUPPORT.isBrowser ? window : undefined) {\n    return value;\n  },\n  eventOptions({\n    passive = true,\n    capture = false\n  } = {}) {\n    return {\n      passive,\n      capture\n    };\n  },\n  transform(value) {\n    return value;\n  }\n};\n\nconst _excluded = [\"target\", \"eventOptions\", \"window\", \"enabled\", \"transform\"];\nfunction resolveWith(config = {}, resolvers) {\n  const result = {};\n  for (const [key, resolver] of Object.entries(resolvers)) {\n    switch (typeof resolver) {\n      case 'function':\n        if (process.env.NODE_ENV === 'development') {\n          const r = resolver.call(result, config[key], key, config);\n          if (!Number.isNaN(r)) result[key] = r;\n        } else {\n          result[key] = resolver.call(result, config[key], key, config);\n        }\n        break;\n      case 'object':\n        result[key] = resolveWith(config[key], resolver);\n        break;\n      case 'boolean':\n        if (resolver) result[key] = config[key];\n        break;\n    }\n  }\n  return result;\n}\nfunction parse(newConfig, gestureKey, _config = {}) {\n  const _ref = newConfig,\n    {\n      target,\n      eventOptions,\n      window,\n      enabled,\n      transform\n    } = _ref,\n    rest = _objectWithoutProperties(_ref, _excluded);\n  _config.shared = resolveWith({\n    target,\n    eventOptions,\n    window,\n    enabled,\n    transform\n  }, sharedConfigResolver);\n  if (gestureKey) {\n    const resolver = ConfigResolverMap.get(gestureKey);\n    _config[gestureKey] = resolveWith(_objectSpread2({\n      shared: _config.shared\n    }, rest), resolver);\n  } else {\n    for (const key in rest) {\n      const resolver = ConfigResolverMap.get(key);\n      if (resolver) {\n        _config[key] = resolveWith(_objectSpread2({\n          shared: _config.shared\n        }, rest[key]), resolver);\n      } else if (process.env.NODE_ENV === 'development') {\n        if (!['drag', 'pinch', 'scroll', 'wheel', 'move', 'hover'].includes(key)) {\n          if (key === 'domTarget') {\n            throw Error(`[@use-gesture]: \\`domTarget\\` option has been renamed to \\`target\\`.`);\n          }\n          console.warn(`[@use-gesture]: Unknown config key \\`${key}\\` was used. Please read the documentation for further information.`);\n        }\n      }\n    }\n  }\n  return _config;\n}\n\nclass EventStore {\n  constructor(ctrl, gestureKey) {\n    _defineProperty(this, \"_listeners\", new Set());\n    this._ctrl = ctrl;\n    this._gestureKey = gestureKey;\n  }\n  add(element, device, action, handler, options) {\n    const listeners = this._listeners;\n    const type = toDomEventType(device, action);\n    const _options = this._gestureKey ? this._ctrl.config[this._gestureKey].eventOptions : {};\n    const eventOptions = _objectSpread2(_objectSpread2({}, _options), options);\n    element.addEventListener(type, handler, eventOptions);\n    const remove = () => {\n      element.removeEventListener(type, handler, eventOptions);\n      listeners.delete(remove);\n    };\n    listeners.add(remove);\n    return remove;\n  }\n  clean() {\n    this._listeners.forEach(remove => remove());\n    this._listeners.clear();\n  }\n}\n\nclass TimeoutStore {\n  constructor() {\n    _defineProperty(this, \"_timeouts\", new Map());\n  }\n  add(key, callback, ms = 140, ...args) {\n    this.remove(key);\n    this._timeouts.set(key, window.setTimeout(callback, ms, ...args));\n  }\n  remove(key) {\n    const timeout = this._timeouts.get(key);\n    if (timeout) window.clearTimeout(timeout);\n  }\n  clean() {\n    this._timeouts.forEach(timeout => void window.clearTimeout(timeout));\n    this._timeouts.clear();\n  }\n}\n\nclass Controller {\n  constructor(handlers) {\n    _defineProperty(this, \"gestures\", new Set());\n    _defineProperty(this, \"_targetEventStore\", new EventStore(this));\n    _defineProperty(this, \"gestureEventStores\", {});\n    _defineProperty(this, \"gestureTimeoutStores\", {});\n    _defineProperty(this, \"handlers\", {});\n    _defineProperty(this, \"config\", {});\n    _defineProperty(this, \"pointerIds\", new Set());\n    _defineProperty(this, \"touchIds\", new Set());\n    _defineProperty(this, \"state\", {\n      shared: {\n        shiftKey: false,\n        metaKey: false,\n        ctrlKey: false,\n        altKey: false\n      }\n    });\n    resolveGestures(this, handlers);\n  }\n  setEventIds(event) {\n    if (isTouch(event)) {\n      this.touchIds = new Set(touchIds(event));\n      return this.touchIds;\n    } else if ('pointerId' in event) {\n      if (event.type === 'pointerup' || event.type === 'pointercancel') this.pointerIds.delete(event.pointerId);else if (event.type === 'pointerdown') this.pointerIds.add(event.pointerId);\n      return this.pointerIds;\n    }\n  }\n  applyHandlers(handlers, nativeHandlers) {\n    this.handlers = handlers;\n    this.nativeHandlers = nativeHandlers;\n  }\n  applyConfig(config, gestureKey) {\n    this.config = parse(config, gestureKey, this.config);\n  }\n  clean() {\n    this._targetEventStore.clean();\n    for (const key of this.gestures) {\n      this.gestureEventStores[key].clean();\n      this.gestureTimeoutStores[key].clean();\n    }\n  }\n  effect() {\n    if (this.config.shared.target) this.bind();\n    return () => this._targetEventStore.clean();\n  }\n  bind(...args) {\n    const sharedConfig = this.config.shared;\n    const props = {};\n    let target;\n    if (sharedConfig.target) {\n      target = sharedConfig.target();\n      if (!target) return;\n    }\n    if (sharedConfig.enabled) {\n      for (const gestureKey of this.gestures) {\n        const gestureConfig = this.config[gestureKey];\n        const bindFunction = bindToProps(props, gestureConfig.eventOptions, !!target);\n        if (gestureConfig.enabled) {\n          const Engine = EngineMap.get(gestureKey);\n          new Engine(this, args, gestureKey).bind(bindFunction);\n        }\n      }\n      const nativeBindFunction = bindToProps(props, sharedConfig.eventOptions, !!target);\n      for (const eventKey in this.nativeHandlers) {\n        nativeBindFunction(eventKey, '', event => this.nativeHandlers[eventKey](_objectSpread2(_objectSpread2({}, this.state.shared), {}, {\n          event,\n          args\n        })), undefined, true);\n      }\n    }\n    for (const handlerProp in props) {\n      props[handlerProp] = chain(...props[handlerProp]);\n    }\n    if (!target) return props;\n    for (const handlerProp in props) {\n      const {\n        device,\n        capture,\n        passive\n      } = parseProp(handlerProp);\n      this._targetEventStore.add(target, device, '', props[handlerProp], {\n        capture,\n        passive\n      });\n    }\n  }\n}\nfunction setupGesture(ctrl, gestureKey) {\n  ctrl.gestures.add(gestureKey);\n  ctrl.gestureEventStores[gestureKey] = new EventStore(ctrl, gestureKey);\n  ctrl.gestureTimeoutStores[gestureKey] = new TimeoutStore();\n}\nfunction resolveGestures(ctrl, internalHandlers) {\n  if (internalHandlers.drag) setupGesture(ctrl, 'drag');\n  if (internalHandlers.wheel) setupGesture(ctrl, 'wheel');\n  if (internalHandlers.scroll) setupGesture(ctrl, 'scroll');\n  if (internalHandlers.move) setupGesture(ctrl, 'move');\n  if (internalHandlers.pinch) setupGesture(ctrl, 'pinch');\n  if (internalHandlers.hover) setupGesture(ctrl, 'hover');\n}\nconst bindToProps = (props, eventOptions, withPassiveOption) => (device, action, handler, options = {}, isNative = false) => {\n  var _options$capture, _options$passive;\n  const capture = (_options$capture = options.capture) !== null && _options$capture !== void 0 ? _options$capture : eventOptions.capture;\n  const passive = (_options$passive = options.passive) !== null && _options$passive !== void 0 ? _options$passive : eventOptions.passive;\n  let handlerProp = isNative ? device : toHandlerProp(device, action, capture);\n  if (withPassiveOption && passive) handlerProp += 'Passive';\n  props[handlerProp] = props[handlerProp] || [];\n  props[handlerProp].push(handler);\n};\n\nconst RE_NOT_NATIVE = /^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;\nfunction sortHandlers(_handlers) {\n  const native = {};\n  const handlers = {};\n  const actions = new Set();\n  for (let key in _handlers) {\n    if (RE_NOT_NATIVE.test(key)) {\n      actions.add(RegExp.lastMatch);\n      handlers[key] = _handlers[key];\n    } else {\n      native[key] = _handlers[key];\n    }\n  }\n  return [handlers, native, actions];\n}\nfunction registerGesture(actions, handlers, handlerKey, key, internalHandlers, config) {\n  if (!actions.has(handlerKey)) return;\n  if (!EngineMap.has(key)) {\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(`[@use-gesture]: You've created a custom handler that that uses the \\`${key}\\` gesture but isn't properly configured.\\n\\nPlease add \\`${key}Action\\` when creating your handler.`);\n    }\n    return;\n  }\n  const startKey = handlerKey + 'Start';\n  const endKey = handlerKey + 'End';\n  const fn = state => {\n    let memo = undefined;\n    if (state.first && startKey in handlers) handlers[startKey](state);\n    if (handlerKey in handlers) memo = handlers[handlerKey](state);\n    if (state.last && endKey in handlers) handlers[endKey](state);\n    return memo;\n  };\n  internalHandlers[key] = fn;\n  config[key] = config[key] || {};\n}\nfunction parseMergedHandlers(mergedHandlers, mergedConfig) {\n  const [handlers, nativeHandlers, actions] = sortHandlers(mergedHandlers);\n  const internalHandlers = {};\n  registerGesture(actions, handlers, 'onDrag', 'drag', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onWheel', 'wheel', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onScroll', 'scroll', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onPinch', 'pinch', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onMove', 'move', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onHover', 'hover', internalHandlers, mergedConfig);\n  return {\n    handlers: internalHandlers,\n    config: mergedConfig,\n    nativeHandlers\n  };\n}\n\nexport { Controller, parseMergedHandlers };\n", "import type { AnyHandlerEventTypes, EventTypes, GestureKey, Handler } from '@use-gesture/core/types'\nimport { createUseGesture, pinchAction, wheelAction } from '@use-gesture/react'\nimport * as React from 'react'\nimport { TLWheelEventInfo } from '../editor/types/event-types'\nimport { Vec } from '../primitives/Vec'\nimport { preventDefault, stopEventPropagation } from '../utils/dom'\nimport { normalizeWheel } from '../utils/normalizeWheel'\nimport { useEditor } from './useEditor'\n\n/*\n\n# How does pinching work?\n\nThe pinching handler is fired under two circumstances: \n- when a user is on a MacBook trackpad and is ZOOMING with a two-finger pinch\n- when a user is on a touch device and is ZOOMING with a two-finger pinch\n- when a user is on a touch device and is PANNING with two fingers\n\nZooming is much more expensive than panning (because it causes shapes to render), \nso we want to be sure that we don't zoom while two-finger panning. \n\nIn order to do this, we keep track of a \"pinchState\", which is either:\n- \"zooming\"\n- \"panning\"\n- \"not sure\"\n\nIf a user is on a trackpad, the pinchState will be set to \"zooming\". \n\nIf the user is on a touch screen, then we start in the \"not sure\" state and switch back and forth\nbetween \"zooming\", \"panning\", and \"not sure\" based on what the user is doing with their fingers.\n\nIn the \"not sure\" state, we examine whether the user has moved the center of the gesture far enough\nto suggest that they're panning; or else that they've moved their fingers further apart or closer\ntogether enough to suggest that they're zooming. \n\nIn the \"panning\" state, we check whether the user's fingers have moved far enough apart to suggest\nthat they're zooming. If they have, we switch to the \"zooming\" state.\n\nIn the \"zooming\" state, we just stay zooming\u2014it's not YET possible to switch back to panning.\n\ntodo: compare velocities of change in order to determine whether the user has switched back to panning\n*/\n\ntype check<T extends AnyHandlerEventTypes, Key extends GestureKey> = undefined extends T[Key]\n\t? EventTypes[Key]\n\t: T[Key]\ntype PinchHandler = Handler<'pinch', check<EventTypes, 'pinch'>>\n\nconst useGesture = createUseGesture([wheelAction, pinchAction])\n\n/**\n * GOTCHA\n *\n * UseGesture fires a wheel event 140ms after the gesture actually ends, with a momentum-adjusted\n * delta. This creates a messed up interaction where after you stop scrolling suddenly the dang page\n * jumps a tick. why do they do this? you are asking the wrong person. it seems intentional though.\n * anyway we want to ignore that last event, but there's no way to directly detect it so we need to\n * keep track of timestamps. Yes this is awful, I am sorry.\n */\nlet lastWheelTime = undefined as undefined | number\n\nconst isWheelEndEvent = (time: number) => {\n\tif (lastWheelTime === undefined) {\n\t\tlastWheelTime = time\n\t\treturn false\n\t}\n\n\tif (time - lastWheelTime > 120 && time - lastWheelTime < 160) {\n\t\tlastWheelTime = time\n\t\treturn true\n\t}\n\n\tlastWheelTime = time\n\treturn false\n}\n\nexport function useGestureEvents(ref: React.RefObject<HTMLDivElement>) {\n\tconst editor = useEditor()\n\n\tconst events = React.useMemo(() => {\n\t\tlet pinchState = 'not sure' as 'not sure' | 'zooming' | 'panning'\n\n\t\tconst onWheel: Handler<'wheel', WheelEvent> = ({ event }) => {\n\t\t\tif (!editor.getInstanceState().isFocused) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tpinchState = 'not sure'\n\n\t\t\tif (isWheelEndEvent(Date.now())) {\n\t\t\t\t// ignore wheelEnd events\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Awful tht we need to put this logic here, but basically\n\t\t\t// we don't want to handle the the wheel event (or call prevent\n\t\t\t// default on the evnet) if the user is wheeling over an a shape\n\t\t\t// that is scrollable which they're currently editing.\n\n\t\t\tconst editingShapeId = editor.getEditingShapeId()\n\t\t\tif (editingShapeId) {\n\t\t\t\tconst shape = editor.getShape(editingShapeId)\n\t\t\t\tif (shape) {\n\t\t\t\t\tconst util = editor.getShapeUtil(shape)\n\t\t\t\t\tif (util.canScroll(shape)) {\n\t\t\t\t\t\tconst bounds = editor.getShapePageBounds(editingShapeId)\n\t\t\t\t\t\tif (bounds?.containsPoint(editor.inputs.currentPagePoint)) {\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpreventDefault(event)\n\t\t\tstopEventPropagation(event)\n\t\t\tconst delta = normalizeWheel(event)\n\n\t\t\tif (delta.x === 0 && delta.y === 0) return\n\n\t\t\tconst info: TLWheelEventInfo = {\n\t\t\t\ttype: 'wheel',\n\t\t\t\tname: 'wheel',\n\t\t\t\tdelta,\n\t\t\t\tpoint: new Vec(event.clientX, event.clientY),\n\t\t\t\tshiftKey: event.shiftKey,\n\t\t\t\taltKey: event.altKey,\n\t\t\t\tctrlKey: event.metaKey || event.ctrlKey,\n\t\t\t}\n\n\t\t\teditor.dispatch(info)\n\t\t}\n\n\t\tlet initDistanceBetweenFingers = 1 // the distance between the two fingers when the pinch starts\n\t\tlet initZoom = 1 // the browser's zoom level when the pinch starts\n\t\tlet currZoom = 1 // the current zoom level according to the pinch gesture recognizer\n\t\tlet currDistanceBetweenFingers = 0\n\t\tconst initPointBetweenFingers = new Vec()\n\t\tconst prevPointBetweenFingers = new Vec()\n\n\t\tconst onPinchStart: PinchHandler = (gesture) => {\n\t\t\tconst elm = ref.current\n\t\t\tpinchState = 'not sure'\n\n\t\t\tconst { event, origin, da } = gesture\n\n\t\t\tif (event instanceof WheelEvent) return\n\t\t\tif (!(event.target === elm || elm?.contains(event.target as Node))) return\n\n\t\t\tprevPointBetweenFingers.x = origin[0]\n\t\t\tprevPointBetweenFingers.y = origin[1]\n\t\t\tinitPointBetweenFingers.x = origin[0]\n\t\t\tinitPointBetweenFingers.y = origin[1]\n\t\t\tinitDistanceBetweenFingers = da[0]\n\t\t\tinitZoom = editor.getZoomLevel()\n\n\t\t\teditor.dispatch({\n\t\t\t\ttype: 'pinch',\n\t\t\t\tname: 'pinch_start',\n\t\t\t\tpoint: { x: origin[0], y: origin[1], z: editor.getZoomLevel() },\n\t\t\t\tdelta: { x: 0, y: 0 },\n\t\t\t\tshiftKey: event.shiftKey,\n\t\t\t\taltKey: event.altKey,\n\t\t\t\tctrlKey: event.metaKey || event.ctrlKey,\n\t\t\t})\n\t\t}\n\n\t\t// let timeout: any\n\t\tconst updatePinchState = (isSafariTrackpadPinch: boolean) => {\n\t\t\tif (isSafariTrackpadPinch) {\n\t\t\t\tpinchState = 'zooming'\n\t\t\t}\n\n\t\t\tif (pinchState === 'zooming') {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Initial: [touch]-------origin-------[touch]\n\t\t\t// Current: [touch]-----------origin----------[touch]\n\t\t\t//                          |----|     |------------|\n\t\t\t//             originDistance ^           ^ touchDistance\n\n\t\t\t// How far have the two touch points moved towards or away from eachother?\n\t\t\tconst touchDistance = Math.abs(currDistanceBetweenFingers - initDistanceBetweenFingers)\n\t\t\t// How far has the point between the touches moved?\n\t\t\tconst originDistance = Vec.Dist(initPointBetweenFingers, prevPointBetweenFingers)\n\n\t\t\tswitch (pinchState) {\n\t\t\t\tcase 'not sure': {\n\t\t\t\t\tif (touchDistance > 24) {\n\t\t\t\t\t\tpinchState = 'zooming'\n\t\t\t\t\t} else if (originDistance > 16) {\n\t\t\t\t\t\tpinchState = 'panning'\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'panning': {\n\t\t\t\t\t// Slightly more touch distance needed to go from panning to zooming\n\t\t\t\t\tif (touchDistance > 64) {\n\t\t\t\t\t\tpinchState = 'zooming'\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst onPinch: PinchHandler = (gesture) => {\n\t\t\tconst elm = ref.current\n\t\t\tconst { event, origin, offset, da } = gesture\n\n\t\t\tif (event instanceof WheelEvent) return\n\t\t\tif (!(event.target === elm || elm?.contains(event.target as Node))) return\n\n\t\t\t// In (desktop) Safari, a two finger trackpad pinch will be a \"gesturechange\" event\n\t\t\t// and will have 0 touches; on iOS, a two-finger pinch will be a \"pointermove\" event\n\t\t\t// with two touches.\n\t\t\tconst isSafariTrackpadPinch =\n\t\t\t\tgesture.type === 'gesturechange' || gesture.type === 'gestureend'\n\n\t\t\t// The distance between the two touch points\n\t\t\tcurrDistanceBetweenFingers = da[0]\n\n\t\t\t// Only update the zoom if the pointers are far enough apart;\n\t\t\t// a very small touchDistance means that the user has probably\n\t\t\t// pinched out and their fingers are touching; this produces\n\t\t\t// very unstable zooming behavior.\n\n\t\t\tconst dx = origin[0] - prevPointBetweenFingers.x\n\t\t\tconst dy = origin[1] - prevPointBetweenFingers.y\n\n\t\t\tprevPointBetweenFingers.x = origin[0]\n\t\t\tprevPointBetweenFingers.y = origin[1]\n\n\t\t\tupdatePinchState(isSafariTrackpadPinch)\n\n\t\t\tswitch (pinchState) {\n\t\t\t\tcase 'zooming': {\n\t\t\t\t\tcurrZoom = offset[0]\n\n\t\t\t\t\teditor.dispatch({\n\t\t\t\t\t\ttype: 'pinch',\n\t\t\t\t\t\tname: 'pinch',\n\t\t\t\t\t\tpoint: { x: origin[0], y: origin[1], z: currZoom },\n\t\t\t\t\t\tdelta: { x: dx, y: dy },\n\t\t\t\t\t\tshiftKey: event.shiftKey,\n\t\t\t\t\t\taltKey: event.altKey,\n\t\t\t\t\t\tctrlKey: event.metaKey || event.ctrlKey,\n\t\t\t\t\t})\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'panning': {\n\t\t\t\t\teditor.dispatch({\n\t\t\t\t\t\ttype: 'pinch',\n\t\t\t\t\t\tname: 'pinch',\n\t\t\t\t\t\tpoint: { x: origin[0], y: origin[1], z: initZoom },\n\t\t\t\t\t\tdelta: { x: dx, y: dy },\n\t\t\t\t\t\tshiftKey: event.shiftKey,\n\t\t\t\t\t\taltKey: event.altKey,\n\t\t\t\t\t\tctrlKey: event.metaKey || event.ctrlKey,\n\t\t\t\t\t})\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst onPinchEnd: PinchHandler = (gesture) => {\n\t\t\tconst elm = ref.current\n\t\t\tconst { event, origin, offset } = gesture\n\n\t\t\tif (event instanceof WheelEvent) return\n\t\t\tif (!(event.target === elm || elm?.contains(event.target as Node))) return\n\n\t\t\tconst scale = offset[0]\n\n\t\t\tpinchState = 'not sure'\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\teditor.dispatch({\n\t\t\t\t\ttype: 'pinch',\n\t\t\t\t\tname: 'pinch_end',\n\t\t\t\t\tpoint: { x: origin[0], y: origin[1], z: scale },\n\t\t\t\t\tdelta: { x: origin[0], y: origin[1] },\n\t\t\t\t\tshiftKey: event.shiftKey,\n\t\t\t\t\taltKey: event.altKey,\n\t\t\t\t\tctrlKey: event.metaKey || event.ctrlKey,\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t\treturn {\n\t\t\tonWheel,\n\t\t\tonPinchStart,\n\t\t\tonPinchEnd,\n\t\t\tonPinch,\n\t\t}\n\t}, [editor, ref])\n\n\tuseGesture(events, {\n\t\ttarget: ref,\n\t\teventOptions: { passive: false },\n\t\tpinch: {\n\t\t\tfrom: () => [editor.getZoomLevel(), 0], // Return the camera z to use when pinch starts\n\t\t\tscaleBounds: () => {\n\t\t\t\treturn { from: editor.getZoomLevel(), max: 8, min: 0.05 }\n\t\t\t},\n\t\t},\n\t})\n}\n", "// Reasonable defaults\nconst MAX_ZOOM_STEP = 10\nconst IS_DARWIN = /Mac|iPod|iPhone|iPad/.test(\n\t// eslint-disable-next-line deprecation/deprecation\n\ttypeof window === 'undefined' ? 'node' : window.navigator.platform\n)\n\n// Adapted from https://stackoverflow.com/a/13650579\n/** @internal */\nexport function normalizeWheel(event: WheelEvent | React.WheelEvent<HTMLElement>) {\n\tlet { deltaY, deltaX } = event\n\tlet deltaZ = 0\n\n\tif (event.ctrlKey || event.altKey || event.metaKey) {\n\t\tconst signY = Math.sign(event.deltaY)\n\t\tconst absDeltaY = Math.abs(event.deltaY)\n\n\t\tlet dy = deltaY\n\n\t\tif (absDeltaY > MAX_ZOOM_STEP) {\n\t\t\tdy = MAX_ZOOM_STEP * signY\n\t\t}\n\n\t\tdeltaZ = dy / 100\n\t} else {\n\t\tif (event.shiftKey && !IS_DARWIN) {\n\t\t\tdeltaX = deltaY\n\t\t\tdeltaY = 0\n\t\t}\n\t}\n\n\treturn { x: -deltaX, y: -deltaY, z: -deltaZ }\n}\n", "import { TLArrowShape, TLLineShape, TLShapeId } from '@tldraw/tlschema'\nimport * as React from 'react'\nimport { Editor } from '../editor/Editor'\nimport { loopToHtmlElement, releasePointerCapture, setPointerCapture } from '../utils/dom'\nimport { getPointerInfo } from '../utils/getPointerInfo'\nimport { useEditor } from './useEditor'\n\nfunction getHandle(editor: Editor, id: TLShapeId, handleId: string) {\n\tconst shape = editor.getShape<TLArrowShape | TLLineShape>(id)!\n\tconst handles = editor.getShapeHandles(shape)!\n\treturn { shape, handle: handles.find((h) => h.id === handleId) }\n}\n\nexport function useHandleEvents(id: TLShapeId, handleId: string) {\n\tconst editor = useEditor()\n\n\treturn React.useMemo(() => {\n\t\tconst onPointerDown = (e: React.PointerEvent) => {\n\t\t\tif ((e as any).isKilled) return\n\n\t\t\t// Must set pointer capture on an HTML element!\n\t\t\tconst target = loopToHtmlElement(e.currentTarget)\n\t\t\tsetPointerCapture(target, e)\n\n\t\t\tconst { shape, handle } = getHandle(editor, id, handleId)\n\n\t\t\tif (!handle) return\n\n\t\t\teditor.dispatch({\n\t\t\t\ttype: 'pointer',\n\t\t\t\ttarget: 'handle',\n\t\t\t\thandle,\n\t\t\t\tshape,\n\t\t\t\tname: 'pointer_down',\n\t\t\t\t...getPointerInfo(e),\n\t\t\t})\n\t\t}\n\n\t\t// Track the last screen point\n\t\tlet lastX: number, lastY: number\n\n\t\tconst onPointerMove = (e: React.PointerEvent) => {\n\t\t\tif ((e as any).isKilled) return\n\t\t\tif (e.clientX === lastX && e.clientY === lastY) return\n\t\t\tlastX = e.clientX\n\t\t\tlastY = e.clientY\n\n\t\t\tconst { shape, handle } = getHandle(editor, id, handleId)\n\n\t\t\tif (!handle) return\n\n\t\t\teditor.dispatch({\n\t\t\t\ttype: 'pointer',\n\t\t\t\ttarget: 'handle',\n\t\t\t\thandle,\n\t\t\t\tshape,\n\t\t\t\tname: 'pointer_move',\n\t\t\t\t...getPointerInfo(e),\n\t\t\t})\n\t\t}\n\n\t\tconst onPointerUp = (e: React.PointerEvent) => {\n\t\t\tif ((e as any).isKilled) return\n\n\t\t\tconst target = loopToHtmlElement(e.currentTarget)\n\t\t\treleasePointerCapture(target, e)\n\n\t\t\tconst { shape, handle } = getHandle(editor, id, handleId)\n\n\t\t\tif (!handle) return\n\n\t\t\teditor.dispatch({\n\t\t\t\ttype: 'pointer',\n\t\t\t\ttarget: 'handle',\n\t\t\t\thandle,\n\t\t\t\tshape,\n\t\t\t\tname: 'pointer_up',\n\t\t\t\t...getPointerInfo(e),\n\t\t\t})\n\t\t}\n\n\t\treturn {\n\t\t\tonPointerDown,\n\t\t\tonPointerMove,\n\t\t\tonPointerUp,\n\t\t}\n\t}, [editor, id, handleId])\n}\n", "import throttle from 'lodash.throttle'\nimport { useLayoutEffect } from 'react'\nimport { Box } from '../primitives/Box'\nimport { useEditor } from './useEditor'\n\nexport function useScreenBounds(ref: React.RefObject<HTMLElement>) {\n\tconst editor = useEditor()\n\n\tuseLayoutEffect(() => {\n\t\tlet prevBounds = new Box()\n\n\t\tfunction updateScreenBounds() {\n\t\t\tconst container = ref.current\n\t\t\tif (!container) return null\n\n\t\t\tconst rect = container.getBoundingClientRect()\n\n\t\t\tconst next = new Box(\n\t\t\t\trect.left || rect.x,\n\t\t\t\trect.top || rect.y,\n\t\t\t\tMath.max(rect.width, 1),\n\t\t\t\tMath.max(rect.height, 1)\n\t\t\t)\n\n\t\t\tif (prevBounds.equals(next)) return\n\t\t\teditor.updateViewportScreenBounds(next)\n\t\t\tprevBounds = next\n\t\t}\n\n\t\t// Set the initial bounds\n\t\tupdateScreenBounds()\n\n\t\t// Everything else uses a debounced update...\n\t\tconst updateBounds = throttle(updateScreenBounds, 200, {\n\t\t\ttrailing: true,\n\t\t})\n\n\t\t// Rather than running getClientRects on every frame, we'll\n\t\t// run it once a second or when the window resizes.\n\t\tconst interval = setInterval(updateBounds, 1000)\n\t\twindow.addEventListener('resize', updateBounds)\n\n\t\tconst resizeObserver = new ResizeObserver((entries) => {\n\t\t\tif (!entries[0].contentRect) return\n\t\t\tupdateBounds()\n\t\t})\n\n\t\tconst container = ref.current\n\t\tlet scrollingParent: HTMLElement | Document | null = null\n\n\t\tif (container) {\n\t\t\t// When the container's size changes, update the bounds\n\t\t\tresizeObserver.observe(container)\n\n\t\t\t// When the container's nearest scrollable parent scrolls, update the bounds\n\t\t\tscrollingParent = getNearestScrollableContainer(container)\n\t\t\tscrollingParent.addEventListener('scroll', updateBounds)\n\t\t}\n\n\t\treturn () => {\n\t\t\tclearInterval(interval)\n\t\t\twindow.removeEventListener('resize', updateBounds)\n\t\t\tresizeObserver.disconnect()\n\t\t\tscrollingParent?.removeEventListener('scroll', updateBounds)\n\t\t}\n\t}, [editor, ref])\n}\n\n/*!\n * Author: excalidraw\n * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE\n * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600\n */\nconst getNearestScrollableContainer = (element: HTMLElement): HTMLElement | Document => {\n\tlet parent = element.parentElement\n\twhile (parent) {\n\t\tif (parent === document.body) {\n\t\t\treturn document\n\t\t}\n\t\tconst { overflowY } = window.getComputedStyle(parent)\n\t\tconst hasScrollableContent = parent.scrollHeight > parent.clientHeight\n\t\tif (\n\t\t\thasScrollableContent &&\n\t\t\t(overflowY === 'auto' || overflowY === 'scroll' || overflowY === 'overlay')\n\t\t) {\n\t\t\treturn parent\n\t\t}\n\t\tparent = parent.parentElement\n\t}\n\treturn document\n}\n", "import { BoxModel } from '@tldraw/tlschema'\nimport { Vec, VecLike } from './Vec'\nimport { PI, PI2, toPrecision } from './utils'\n\n/** @public */\nexport type BoxLike = BoxModel | Box\n\n/** @public */\nexport type SelectionEdge = 'top' | 'right' | 'bottom' | 'left'\n\n/** @public */\nexport type SelectionCorner = 'top_left' | 'top_right' | 'bottom_right' | 'bottom_left'\n\n/** @public */\nexport type SelectionHandle = SelectionEdge | SelectionCorner\n\n/** @public */\nexport type RotateCorner =\n\t| 'top_left_rotate'\n\t| 'top_right_rotate'\n\t| 'bottom_right_rotate'\n\t| 'bottom_left_rotate'\n\t| 'mobile_rotate'\n\n/** @public */\nexport class Box {\n\tconstructor(x = 0, y = 0, w = 0, h = 0) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis.w = w\n\t\tthis.h = h\n\t}\n\n\tx = 0\n\ty = 0\n\tw = 0\n\th = 0\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget point() {\n\t\treturn new Vec(this.x, this.y)\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tset point(val: Vec) {\n\t\tthis.x = val.x\n\t\tthis.y = val.y\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget minX() {\n\t\treturn this.x\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tset minX(n: number) {\n\t\tthis.x = n\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget midX() {\n\t\treturn this.x + this.w / 2\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget maxX() {\n\t\treturn this.x + this.w\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget minY() {\n\t\treturn this.y\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tset minY(n: number) {\n\t\tthis.y = n\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget midY() {\n\t\treturn this.y + this.h / 2\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget maxY() {\n\t\treturn this.y + this.h\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget width() {\n\t\treturn this.w\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tset width(n: number) {\n\t\tthis.w = n\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget height() {\n\t\treturn this.h\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tset height(n: number) {\n\t\tthis.h = n\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget aspectRatio() {\n\t\treturn this.width / this.height\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget center() {\n\t\treturn new Vec(this.midX, this.midY)\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tset center(v: Vec) {\n\t\tthis.minX = v.x - this.width / 2\n\t\tthis.minY = v.y - this.height / 2\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget corners() {\n\t\treturn [\n\t\t\tnew Vec(this.minX, this.minY),\n\t\t\tnew Vec(this.maxX, this.minY),\n\t\t\tnew Vec(this.maxX, this.maxY),\n\t\t\tnew Vec(this.minX, this.maxY),\n\t\t]\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget cornersAndCenter() {\n\t\treturn [\n\t\t\tnew Vec(this.minX, this.minY),\n\t\t\tnew Vec(this.maxX, this.minY),\n\t\t\tnew Vec(this.maxX, this.maxY),\n\t\t\tnew Vec(this.minX, this.maxY),\n\t\t\tthis.center,\n\t\t]\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget sides(): Array<[Vec, Vec]> {\n\t\tconst { corners } = this\n\t\treturn [\n\t\t\t[corners[0], corners[1]],\n\t\t\t[corners[1], corners[2]],\n\t\t\t[corners[2], corners[3]],\n\t\t\t[corners[3], corners[0]],\n\t\t]\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget size(): Vec {\n\t\treturn new Vec(this.w, this.h)\n\t}\n\n\ttoFixed() {\n\t\tthis.x = toPrecision(this.x)\n\t\tthis.y = toPrecision(this.y)\n\t\tthis.w = toPrecision(this.w)\n\t\tthis.h = toPrecision(this.h)\n\t\treturn this\n\t}\n\n\tsetTo(B: Box) {\n\t\tthis.x = B.x\n\t\tthis.y = B.y\n\t\tthis.w = B.w\n\t\tthis.h = B.h\n\t\treturn this\n\t}\n\n\tset(x = 0, y = 0, w = 0, h = 0) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis.w = w\n\t\tthis.h = h\n\t\treturn this\n\t}\n\n\texpand(A: Box) {\n\t\tconst minX = Math.min(this.minX, A.minX)\n\t\tconst minY = Math.min(this.minY, A.minY)\n\t\tconst maxX = Math.max(this.maxX, A.maxX)\n\t\tconst maxY = Math.max(this.maxY, A.maxY)\n\n\t\tthis.x = minX\n\t\tthis.y = minY\n\t\tthis.w = maxX - minX\n\t\tthis.h = maxY - minY\n\t\treturn this\n\t}\n\n\texpandBy(n: number) {\n\t\tthis.x -= n\n\t\tthis.y -= n\n\t\tthis.w += n * 2\n\t\tthis.h += n * 2\n\t\treturn this\n\t}\n\n\tscale(n: number) {\n\t\tthis.x /= n\n\t\tthis.y /= n\n\t\tthis.w /= n\n\t\tthis.h /= n\n\t\treturn this\n\t}\n\n\tclone() {\n\t\tconst { x, y, w, h } = this\n\t\treturn new Box(x, y, w, h)\n\t}\n\n\ttranslate(delta: VecLike) {\n\t\tthis.x += delta.x\n\t\tthis.y += delta.y\n\t\treturn this\n\t}\n\n\tsnapToGrid(size: number) {\n\t\tconst minX = Math.round(this.minX / size) * size\n\t\tconst minY = Math.round(this.minY / size) * size\n\t\tconst maxX = Math.round(this.maxX / size) * size\n\t\tconst maxY = Math.round(this.maxY / size) * size\n\t\tthis.minX = minX\n\t\tthis.minY = minY\n\t\tthis.width = Math.max(1, maxX - minX)\n\t\tthis.height = Math.max(1, maxY - minY)\n\t}\n\n\tcollides(B: Box) {\n\t\treturn Box.Collides(this, B)\n\t}\n\n\tcontains(B: Box) {\n\t\treturn Box.Contains(this, B)\n\t}\n\n\tincludes(B: Box) {\n\t\treturn Box.Includes(this, B)\n\t}\n\n\tcontainsPoint(V: VecLike, margin = 0) {\n\t\treturn Box.ContainsPoint(this, V, margin)\n\t}\n\n\tgetHandlePoint(handle: SelectionCorner | SelectionEdge) {\n\t\tswitch (handle) {\n\t\t\tcase 'top_left':\n\t\t\t\treturn new Vec(this.minX, this.minY)\n\t\t\tcase 'top_right':\n\t\t\t\treturn new Vec(this.maxX, this.minY)\n\t\t\tcase 'bottom_left':\n\t\t\t\treturn new Vec(this.minX, this.maxY)\n\t\t\tcase 'bottom_right':\n\t\t\t\treturn new Vec(this.maxX, this.maxY)\n\t\t\tcase 'top':\n\t\t\t\treturn new Vec(this.midX, this.minY)\n\t\t\tcase 'right':\n\t\t\t\treturn new Vec(this.maxX, this.midY)\n\t\t\tcase 'bottom':\n\t\t\t\treturn new Vec(this.midX, this.maxY)\n\t\t\tcase 'left':\n\t\t\t\treturn new Vec(this.minX, this.midY)\n\t\t}\n\t}\n\n\ttoJson(): BoxModel {\n\t\treturn { x: this.minX, y: this.minY, w: this.w, h: this.h }\n\t}\n\n\tresize(handle: SelectionCorner | SelectionEdge | string, dx: number, dy: number) {\n\t\tconst { minX: a0x, minY: a0y, maxX: a1x, maxY: a1y } = this\n\t\tlet { minX: b0x, minY: b0y, maxX: b1x, maxY: b1y } = this\n\n\t\t// Use the delta to adjust the new box by changing its corners.\n\t\t// The dragging handle (corner or edge) will determine which\n\t\t// corners should change.\n\t\tswitch (handle) {\n\t\t\tcase 'left':\n\t\t\tcase 'top_left':\n\t\t\tcase 'bottom_left': {\n\t\t\t\tb0x += dx\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'right':\n\t\t\tcase 'top_right':\n\t\t\tcase 'bottom_right': {\n\t\t\t\tb1x += dx\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tswitch (handle) {\n\t\t\tcase 'top':\n\t\t\tcase 'top_left':\n\t\t\tcase 'top_right': {\n\t\t\t\tb0y += dy\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'bottom':\n\t\t\tcase 'bottom_left':\n\t\t\tcase 'bottom_right': {\n\t\t\t\tb1y += dy\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tconst scaleX = (b1x - b0x) / (a1x - a0x)\n\t\tconst scaleY = (b1y - b0y) / (a1y - a0y)\n\n\t\tconst flipX = scaleX < 0\n\t\tconst flipY = scaleY < 0\n\n\t\tif (flipX) {\n\t\t\tconst t = b1x\n\t\t\tb1x = b0x\n\t\t\tb0x = t\n\t\t}\n\n\t\tif (flipY) {\n\t\t\tconst t = b1y\n\t\t\tb1y = b0y\n\t\t\tb0y = t\n\t\t}\n\n\t\tthis.minX = b0x\n\t\tthis.minY = b0y\n\t\tthis.width = Math.abs(b1x - b0x)\n\t\tthis.height = Math.abs(b1y - b0y)\n\t}\n\n\tunion(box: BoxModel) {\n\t\tconst minX = Math.min(this.minX, box.x)\n\t\tconst minY = Math.min(this.minY, box.y)\n\t\tconst maxX = Math.max(this.maxX, box.w + box.x)\n\t\tconst maxY = Math.max(this.maxY, box.h + box.y)\n\n\t\tthis.x = minX\n\t\tthis.y = minY\n\t\tthis.width = maxX - minX\n\t\tthis.height = maxY - minY\n\n\t\treturn this\n\t}\n\n\tstatic From(box: BoxModel) {\n\t\treturn new Box(box.x, box.y, box.w, box.h)\n\t}\n\n\tstatic FromCenter(center: VecLike, size: VecLike) {\n\t\treturn new Box(center.x - size.x / 2, center.y - size.y / 2, size.x, size.y)\n\t}\n\n\tstatic FromPoints(points: VecLike[]) {\n\t\tif (points.length === 0) return new Box()\n\t\tlet minX = Infinity\n\t\tlet minY = Infinity\n\t\tlet maxX = -Infinity\n\t\tlet maxY = -Infinity\n\t\tlet point: VecLike\n\t\tfor (let i = 0, n = points.length; i < n; i++) {\n\t\t\tpoint = points[i]\n\t\t\tminX = Math.min(point.x, minX)\n\t\t\tminY = Math.min(point.y, minY)\n\t\t\tmaxX = Math.max(point.x, maxX)\n\t\t\tmaxY = Math.max(point.y, maxY)\n\t\t}\n\n\t\treturn new Box(minX, minY, maxX - minX, maxY - minY)\n\t}\n\n\tstatic Expand(A: Box, B: Box) {\n\t\tconst minX = Math.min(B.minX, A.minX)\n\t\tconst minY = Math.min(B.minY, A.minY)\n\t\tconst maxX = Math.max(B.maxX, A.maxX)\n\t\tconst maxY = Math.max(B.maxY, A.maxY)\n\n\t\treturn new Box(minX, minY, maxX - minX, maxY - minY)\n\t}\n\n\tstatic ExpandBy(A: Box, n: number) {\n\t\treturn new Box(A.minX - n, A.minY - n, A.width + n * 2, A.height + n * 2)\n\t}\n\n\tstatic Collides = (A: Box, B: Box) => {\n\t\treturn !(A.maxX < B.minX || A.minX > B.maxX || A.maxY < B.minY || A.minY > B.maxY)\n\t}\n\n\tstatic Contains = (A: Box, B: Box) => {\n\t\treturn A.minX < B.minX && A.minY < B.minY && A.maxY > B.maxY && A.maxX > B.maxX\n\t}\n\n\tstatic Includes = (A: Box, B: Box) => {\n\t\treturn Box.Collides(A, B) || Box.Contains(A, B)\n\t}\n\n\tstatic ContainsPoint = (A: Box, B: VecLike, margin = 0) => {\n\t\treturn !(\n\t\t\tB.x < A.minX - margin ||\n\t\t\tB.y < A.minY - margin ||\n\t\t\tB.x > A.maxX + margin ||\n\t\t\tB.y > A.maxY + margin\n\t\t)\n\t}\n\n\tstatic Common = (boxes: Box[]): Box => {\n\t\tlet minX = Infinity\n\t\tlet minY = Infinity\n\t\tlet maxX = -Infinity\n\t\tlet maxY = -Infinity\n\n\t\tfor (let i = 0; i < boxes.length; i++) {\n\t\t\tconst B = boxes[i]\n\t\t\tminX = Math.min(minX, B.minX)\n\t\t\tminY = Math.min(minY, B.minY)\n\t\t\tmaxX = Math.max(maxX, B.maxX)\n\t\t\tmaxY = Math.max(maxY, B.maxY)\n\t\t}\n\n\t\treturn new Box(minX, minY, maxX - minX, maxY - minY)\n\t}\n\n\tstatic Sides = (A: Box, inset = 0) => {\n\t\tconst { corners } = A\n\t\tif (inset) {\n\t\t\t// TODO: Inset the corners by the inset amount.\n\t\t}\n\n\t\treturn [\n\t\t\t[corners[0], corners[1]],\n\t\t\t[corners[1], corners[2]],\n\t\t\t[corners[2], corners[3]],\n\t\t\t[corners[3], corners[0]],\n\t\t]\n\t}\n\n\tstatic Resize(\n\t\tbox: Box,\n\t\thandle: SelectionCorner | SelectionEdge | string,\n\t\tdx: number,\n\t\tdy: number,\n\t\tisAspectRatioLocked = false\n\t) {\n\t\tconst { minX: a0x, minY: a0y, maxX: a1x, maxY: a1y } = box\n\t\tlet { minX: b0x, minY: b0y, maxX: b1x, maxY: b1y } = box\n\n\t\t// Use the delta to adjust the new box by changing its corners.\n\t\t// The dragging handle (corner or edge) will determine which\n\t\t// corners should change.\n\t\tswitch (handle) {\n\t\t\tcase 'left':\n\t\t\tcase 'top_left':\n\t\t\tcase 'bottom_left': {\n\t\t\t\tb0x += dx\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'right':\n\t\t\tcase 'top_right':\n\t\t\tcase 'bottom_right': {\n\t\t\t\tb1x += dx\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tswitch (handle) {\n\t\t\tcase 'top':\n\t\t\tcase 'top_left':\n\t\t\tcase 'top_right': {\n\t\t\t\tb0y += dy\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'bottom':\n\t\t\tcase 'bottom_left':\n\t\t\tcase 'bottom_right': {\n\t\t\t\tb1y += dy\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tconst scaleX = (b1x - b0x) / (a1x - a0x)\n\t\tconst scaleY = (b1y - b0y) / (a1y - a0y)\n\n\t\tconst flipX = scaleX < 0\n\t\tconst flipY = scaleY < 0\n\n\t\t/*\n    2. Aspect ratio\n    If the aspect ratio is locked, adjust the corners so that the\n    new box's aspect ratio matches the original aspect ratio.\n    */\n\t\tif (isAspectRatioLocked) {\n\t\t\tconst aspectRatio = (a1x - a0x) / (a1y - a0y)\n\t\t\tconst bw = Math.abs(b1x - b0x)\n\t\t\tconst bh = Math.abs(b1y - b0y)\n\t\t\tconst tw = bw * (scaleY < 0 ? 1 : -1) * (1 / aspectRatio)\n\t\t\tconst th = bh * (scaleX < 0 ? 1 : -1) * aspectRatio\n\t\t\tconst isTall = aspectRatio < bw / bh\n\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left': {\n\t\t\t\t\tif (isTall) b0y = b1y + tw\n\t\t\t\t\telse b0x = b1x + th\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'top_right': {\n\t\t\t\t\tif (isTall) b0y = b1y + tw\n\t\t\t\t\telse b1x = b0x - th\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'bottom_right': {\n\t\t\t\t\tif (isTall) b1y = b0y - tw\n\t\t\t\t\telse b1x = b0x - th\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'bottom_left': {\n\t\t\t\t\tif (isTall) b1y = b0y - tw\n\t\t\t\t\telse b0x = b1x + th\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'bottom':\n\t\t\t\tcase 'top': {\n\t\t\t\t\tconst m = (b0x + b1x) / 2\n\t\t\t\t\tconst w = bh * aspectRatio\n\t\t\t\t\tb0x = m - w / 2\n\t\t\t\t\tb1x = m + w / 2\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'left':\n\t\t\t\tcase 'right': {\n\t\t\t\t\tconst m = (b0y + b1y) / 2\n\t\t\t\t\tconst h = bw / aspectRatio\n\t\t\t\t\tb0y = m - h / 2\n\t\t\t\t\tb1y = m + h / 2\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (flipX) {\n\t\t\tconst t = b1x\n\t\t\tb1x = b0x\n\t\t\tb0x = t\n\t\t}\n\n\t\tif (flipY) {\n\t\t\tconst t = b1y\n\t\t\tb1y = b0y\n\t\t\tb0y = t\n\t\t}\n\n\t\tconst final = new Box(b0x, b0y, Math.abs(b1x - b0x), Math.abs(b1y - b0y))\n\n\t\treturn {\n\t\t\tbox: final,\n\t\t\tscaleX: +((final.width / box.width) * (scaleX > 0 ? 1 : -1)).toFixed(5),\n\t\t\tscaleY: +((final.height / box.height) * (scaleY > 0 ? 1 : -1)).toFixed(5),\n\t\t}\n\t}\n\n\tequals(other: Box | BoxModel) {\n\t\treturn Box.Equals(this, other)\n\t}\n\n\tstatic Equals(a: Box | BoxModel, b: Box | BoxModel) {\n\t\treturn b.x === a.x && b.y === a.y && b.w === a.w && b.h === a.h\n\t}\n\n\tzeroFix() {\n\t\tthis.w = Math.max(1, this.w)\n\t\tthis.h = Math.max(1, this.h)\n\t\treturn this\n\t}\n\n\tstatic ZeroFix(other: Box | BoxModel) {\n\t\treturn new Box(other.x, other.y, Math.max(1, other.w), Math.max(1, other.h))\n\t}\n}\n\n/** @public */\nexport function flipSelectionHandleY(handle: SelectionHandle) {\n\tswitch (handle) {\n\t\tcase 'top':\n\t\t\treturn 'bottom'\n\t\tcase 'bottom':\n\t\t\treturn 'top'\n\t\tcase 'top_left':\n\t\t\treturn 'bottom_left'\n\t\tcase 'top_right':\n\t\t\treturn 'bottom_right'\n\t\tcase 'bottom_left':\n\t\t\treturn 'top_left'\n\t\tcase 'bottom_right':\n\t\t\treturn 'top_right'\n\t\tdefault:\n\t\t\treturn handle\n\t}\n}\n\n/** @public */\nexport function flipSelectionHandleX(handle: SelectionHandle) {\n\tswitch (handle) {\n\t\tcase 'left':\n\t\t\treturn 'right'\n\t\tcase 'right':\n\t\t\treturn 'left'\n\t\tcase 'top_left':\n\t\t\treturn 'top_right'\n\t\tcase 'top_right':\n\t\t\treturn 'top_left'\n\t\tcase 'bottom_left':\n\t\t\treturn 'bottom_right'\n\t\tcase 'bottom_right':\n\t\t\treturn 'bottom_left'\n\t\tdefault:\n\t\t\treturn handle\n\t}\n}\n\nconst ORDERED_SELECTION_HANDLES = [\n\t'top',\n\t'top_right',\n\t'right',\n\t'bottom_right',\n\t'bottom',\n\t'bottom_left',\n\t'left',\n\t'top_left',\n] as const\n\n/** @public */\nexport function rotateSelectionHandle(handle: SelectionHandle, rotation: number): SelectionHandle {\n\t// first find out how many tau we need to rotate by\n\trotation = rotation % PI2\n\tconst numSteps = Math.round(rotation / (PI / 4))\n\n\tconst currentIndex = ORDERED_SELECTION_HANDLES.indexOf(handle)\n\treturn ORDERED_SELECTION_HANDLES[(currentIndex + numSteps) % ORDERED_SELECTION_HANDLES.length]\n}\n\n/** @public */\nexport function isSelectionCorner(selection: string): selection is SelectionCorner {\n\treturn (\n\t\tselection === 'top_left' ||\n\t\tselection === 'top_right' ||\n\t\tselection === 'bottom_right' ||\n\t\tselection === 'bottom_left'\n\t)\n}\n\n/** @public */\nexport const ROTATE_CORNER_TO_SELECTION_CORNER = {\n\ttop_left_rotate: 'top_left',\n\ttop_right_rotate: 'top_right',\n\tbottom_right_rotate: 'bottom_right',\n\tbottom_left_rotate: 'bottom_left',\n\tmobile_rotate: 'top_left',\n} as const\n", "import { Box } from './Box'\nimport { clampRadians, HALF_PI, toDomPrecision } from './utils'\nimport { Vec, VecLike } from './Vec'\n\n/** @public */\nexport type MatLike = MatModel | Mat\n\n/** @public */\nexport interface MatModel {\n\ta: number\n\tb: number\n\tc: number\n\td: number\n\te: number\n\tf: number\n}\n\n// function getIdentity() {\n//   return new Mat(1.0, 0.0, 0.0, 1.0, 0.0, 0.0)\n// }\n\n/** @public */\nexport class Mat {\n\tconstructor(a: number, b: number, c: number, d: number, e: number, f: number) {\n\t\tthis.a = a\n\t\tthis.b = b\n\t\tthis.c = c\n\t\tthis.d = d\n\t\tthis.e = e\n\t\tthis.f = f\n\t}\n\n\ta = 1.0\n\tb = 0.0\n\tc = 0.0\n\td = 1.0\n\te = 0.0\n\tf = 0.0\n\n\tequals(m: Mat | MatModel) {\n\t\treturn (\n\t\t\tthis === m ||\n\t\t\t(this.a === m.a &&\n\t\t\t\tthis.b === m.b &&\n\t\t\t\tthis.c === m.c &&\n\t\t\t\tthis.d === m.d &&\n\t\t\t\tthis.e === m.e &&\n\t\t\t\tthis.f === m.f)\n\t\t)\n\t}\n\n\tidentity() {\n\t\tthis.a = 1.0\n\t\tthis.b = 0.0\n\t\tthis.c = 0.0\n\t\tthis.d = 1.0\n\t\tthis.e = 0.0\n\t\tthis.f = 0.0\n\t\treturn this\n\t}\n\n\tmultiply(m: Mat | MatModel) {\n\t\tconst m2: MatModel = m\n\t\tconst { a, b, c, d, e, f } = this\n\t\tthis.a = a * m2.a + c * m2.b\n\t\tthis.c = a * m2.c + c * m2.d\n\t\tthis.e = a * m2.e + c * m2.f + e\n\t\tthis.b = b * m2.a + d * m2.b\n\t\tthis.d = b * m2.c + d * m2.d\n\t\tthis.f = b * m2.e + d * m2.f + f\n\t\treturn this\n\t}\n\n\trotate(r: number, cx?: number, cy?: number) {\n\t\tif (r === 0) return this\n\t\tif (cx === undefined) return this.multiply(Mat.Rotate(r))\n\t\treturn this.translate(cx, cy!).multiply(Mat.Rotate(r)).translate(-cx, -cy!)\n\t}\n\n\ttranslate(x: number, y: number): Mat {\n\t\treturn this.multiply(Mat.Translate(x, y!))\n\t}\n\n\tscale(x: number, y: number) {\n\t\treturn this.multiply(Mat.Scale(x, y))\n\t}\n\n\tinvert() {\n\t\tconst { a, b, c, d, e, f } = this\n\t\tconst denom = a * d - b * c\n\t\tthis.a = d / denom\n\t\tthis.b = b / -denom\n\t\tthis.c = c / -denom\n\t\tthis.d = a / denom\n\t\tthis.e = (d * e - c * f) / -denom\n\t\tthis.f = (b * e - a * f) / denom\n\t\treturn this\n\t}\n\n\tapplyToPoint(point: VecLike) {\n\t\treturn Mat.applyToPoint(this, point)\n\t}\n\n\tapplyToPoints(points: VecLike[]) {\n\t\treturn Mat.applyToPoints(this, points)\n\t}\n\n\trotation() {\n\t\treturn Mat.Rotation(this)\n\t}\n\n\tpoint() {\n\t\treturn Mat.Point(this)\n\t}\n\n\tdecomposed() {\n\t\treturn Mat.Decompose(this)\n\t}\n\n\ttoCssString() {\n\t\treturn Mat.toCssString(this)\n\t}\n\n\tsetTo(model: MatModel) {\n\t\tObject.assign(this, model)\n\t\treturn this\n\t}\n\n\tdecompose() {\n\t\treturn Mat.Decompose(this)\n\t}\n\n\tclone() {\n\t\treturn new Mat(this.a, this.b, this.c, this.d, this.e, this.f)\n\t}\n\n\t/* --------------------- Static --------------------- */\n\n\tstatic Identity() {\n\t\treturn new Mat(1.0, 0.0, 0.0, 1.0, 0.0, 0.0)\n\t}\n\n\tstatic Translate(x: number, y: number) {\n\t\treturn new Mat(1.0, 0.0, 0.0, 1.0, x, y)\n\t}\n\n\tstatic Rotate(r: number, cx?: number, cy?: number) {\n\t\tif (r === 0) return Mat.Identity()\n\n\t\tconst cosAngle = Math.cos(r)\n\t\tconst sinAngle = Math.sin(r)\n\n\t\tconst rotationMatrix = new Mat(cosAngle, sinAngle, -sinAngle, cosAngle, 0.0, 0.0)\n\n\t\tif (cx === undefined) return rotationMatrix\n\n\t\treturn Mat.Compose(Mat.Translate(cx, cy!), rotationMatrix, Mat.Translate(-cx, -cy!))\n\t}\n\n\tstatic Scale: {\n\t\t(x: number, y: number): MatModel\n\t\t(x: number, y: number, cx: number, cy: number): MatModel\n\t} = (x: number, y: number, cx?: number, cy?: number) => {\n\t\tconst scaleMatrix = new Mat(x, 0, 0, y, 0, 0)\n\n\t\tif (cx === undefined) return scaleMatrix\n\n\t\treturn Mat.Compose(Mat.Translate(cx, cy!), scaleMatrix, Mat.Translate(-cx, -cy!))\n\t}\n\n\tstatic Multiply(m1: MatModel, m2: MatModel): MatModel {\n\t\treturn {\n\t\t\ta: m1.a * m2.a + m1.c * m2.b,\n\t\t\tc: m1.a * m2.c + m1.c * m2.d,\n\t\t\te: m1.a * m2.e + m1.c * m2.f + m1.e,\n\t\t\tb: m1.b * m2.a + m1.d * m2.b,\n\t\t\td: m1.b * m2.c + m1.d * m2.d,\n\t\t\tf: m1.b * m2.e + m1.d * m2.f + m1.f,\n\t\t}\n\t}\n\n\tstatic Inverse(m: MatModel): MatModel {\n\t\tconst denom = m.a * m.d - m.b * m.c\n\t\treturn {\n\t\t\ta: m.d / denom,\n\t\t\tb: m.b / -denom,\n\t\t\tc: m.c / -denom,\n\t\t\td: m.a / denom,\n\t\t\te: (m.d * m.e - m.c * m.f) / -denom,\n\t\t\tf: (m.b * m.e - m.a * m.f) / denom,\n\t\t}\n\t}\n\n\tstatic Absolute(m: MatLike): MatModel {\n\t\tconst denom = m.a * m.d - m.b * m.c\n\t\treturn {\n\t\t\ta: m.d / denom,\n\t\t\tb: m.b / -denom,\n\t\t\tc: m.c / -denom,\n\t\t\td: m.a / denom,\n\t\t\te: (m.d * m.e - m.c * m.f) / denom,\n\t\t\tf: (m.b * m.e - m.a * m.f) / -denom,\n\t\t}\n\t}\n\n\tstatic Compose(...matrices: MatLike[]) {\n\t\tconst matrix = Mat.Identity()\n\t\tfor (let i = 0, n = matrices.length; i < n; i++) {\n\t\t\tmatrix.multiply(matrices[i])\n\t\t}\n\t\treturn matrix\n\t}\n\n\tstatic Point(m: MatLike) {\n\t\treturn new Vec(m.e, m.f)\n\t}\n\n\tstatic Rotation(m: MatLike): number {\n\t\tlet rotation\n\n\t\tif (m.a !== 0 || m.c !== 0) {\n\t\t\tconst hypotAc = (m.a * m.a + m.c * m.c) ** 0.5\n\t\t\trotation = Math.acos(m.a / hypotAc) * (m.c > 0 ? -1 : 1)\n\t\t} else if (m.b !== 0 || m.d !== 0) {\n\t\t\tconst hypotBd = (m.b * m.b + m.d * m.d) ** 0.5\n\t\t\trotation = HALF_PI + Math.acos(m.b / hypotBd) * (m.d > 0 ? -1 : 1)\n\t\t} else {\n\t\t\trotation = 0\n\t\t}\n\n\t\treturn clampRadians(rotation)\n\t}\n\n\tstatic Decompose(m: MatLike) {\n\t\tlet scaleX, scaleY, rotation\n\n\t\tif (m.a !== 0 || m.c !== 0) {\n\t\t\tconst hypotAc = (m.a * m.a + m.c * m.c) ** 0.5\n\t\t\tscaleX = hypotAc\n\t\t\tscaleY = (m.a * m.d - m.b * m.c) / hypotAc\n\t\t\trotation = Math.acos(m.a / hypotAc) * (m.c > 0 ? -1 : 1)\n\t\t} else if (m.b !== 0 || m.d !== 0) {\n\t\t\tconst hypotBd = (m.b * m.b + m.d * m.d) ** 0.5\n\t\t\tscaleX = (m.a * m.d - m.b * m.c) / hypotBd\n\t\t\tscaleY = hypotBd\n\t\t\trotation = HALF_PI + Math.acos(m.b / hypotBd) * (m.d > 0 ? -1 : 1)\n\t\t} else {\n\t\t\tscaleX = 0\n\t\t\tscaleY = 0\n\t\t\trotation = 0\n\t\t}\n\n\t\treturn {\n\t\t\tx: m.e,\n\t\t\ty: m.f,\n\t\t\tscaleX,\n\t\t\tscaleY,\n\t\t\trotation: clampRadians(rotation),\n\t\t}\n\t}\n\n\tstatic Smooth(m: MatLike, precision = 10000000000) {\n\t\tm.a = Math.round(m.a * precision) / precision\n\t\tm.b = Math.round(m.b * precision) / precision\n\t\tm.c = Math.round(m.c * precision) / precision\n\t\tm.d = Math.round(m.d * precision) / precision\n\t\tm.e = Math.round(m.e * precision) / precision\n\t\tm.f = Math.round(m.f * precision) / precision\n\t\treturn m\n\t}\n\n\tstatic toCssString(m: MatLike) {\n\t\treturn `matrix(${toDomPrecision(m.a)}, ${toDomPrecision(m.b)}, ${toDomPrecision(\n\t\t\tm.c\n\t\t)}, ${toDomPrecision(m.d)}, ${toDomPrecision(m.e)}, ${toDomPrecision(m.f)})`\n\t}\n\n\tstatic applyToPoint(m: MatLike, point: VecLike) {\n\t\treturn new Vec(\n\t\t\tm.a * point.x + m.c * point.y + m.e,\n\t\t\tm.b * point.x + m.d * point.y + m.f,\n\t\t\tpoint.z\n\t\t)\n\t}\n\n\tstatic applyToXY(m: MatLike, x: number, y: number) {\n\t\treturn [m.a * x + m.c * y + m.e, m.b * x + m.d * y + m.f]\n\t}\n\n\tstatic applyToPoints(m: MatLike, points: VecLike[]): Vec[] {\n\t\treturn points.map(\n\t\t\t(point) =>\n\t\t\t\tnew Vec(m.a * point.x + m.c * point.y + m.e, m.b * point.x + m.d * point.y + m.f, point.z)\n\t\t)\n\t}\n\n\tstatic applyToBounds(m: MatLike, box: Box) {\n\t\treturn new Box(m.e + box.minX, m.f + box.minY, box.width, box.height)\n\t}\n\n\tstatic From(m: MatLike) {\n\t\treturn new Mat(m.a, m.b, m.c, m.d, m.e, m.f)\n\t}\n\n\tstatic Cast(m: MatLike) {\n\t\treturn m instanceof Mat ? m : Mat.From(m)\n\t}\n}\n\n/** @public */\nexport function decomposeMatrix(m: MatLike) {\n\treturn {\n\t\tx: m.e,\n\t\ty: m.f,\n\t\tscaleX: Math.sqrt(m.a * m.a + m.b * m.b),\n\t\tscaleY: Math.sqrt(m.c * m.c + m.d * m.d),\n\t\trotation: Math.atan2(m.b, m.a),\n\t}\n}\n", "// Euclidean algorithm to find the GCD\nfunction gcd(a: number, b: number): number {\n\treturn b === 0 ? a : gcd(b, a % b)\n}\n\n// Returns the lowest value that the given number can be multiplied by to reach an integer\nexport function nearestMultiple(float: number) {\n\tconst decimal = float.toString().split('.')[1]\n\tif (!decimal) return 1\n\tconst denominator = Math.pow(10, decimal.length)\n\tconst numerator = parseInt(decimal, 10)\n\treturn denominator / gcd(numerator, denominator)\n}\n", "import { track } from '@tldraw/state'\nimport { modulate } from '@tldraw/utils'\nimport { useEffect, useState } from 'react'\nimport { useEditor } from '../hooks/useEditor'\nimport { Geometry2d } from '../primitives/geometry/Geometry2d'\nimport { Group2d } from '../primitives/geometry/Group2d'\n\nfunction useTick(isEnabled = true) {\n\tconst [_, setTick] = useState(0)\n\tconst editor = useEditor()\n\tuseEffect(() => {\n\t\tif (!isEnabled) return\n\t\tconst update = () => setTick((tick) => tick + 1)\n\t\teditor.on('tick', update)\n\t\treturn () => {\n\t\t\teditor.off('tick', update)\n\t\t}\n\t}, [editor, isEnabled])\n}\n\nexport const GeometryDebuggingView = track(function GeometryDebuggingView({\n\tshowStroke = true,\n\tshowVertices = true,\n\tshowClosestPointOnOutline = true,\n}: {\n\tshowStroke?: boolean\n\tshowVertices?: boolean\n\tshowClosestPointOnOutline?: boolean\n}) {\n\tconst editor = useEditor()\n\n\tuseTick(showClosestPointOnOutline)\n\n\tconst zoomLevel = editor.getZoomLevel()\n\tconst renderingShapes = editor.getRenderingShapes()\n\tconst {\n\t\tinputs: { currentPagePoint },\n\t} = editor\n\n\treturn (\n\t\t<svg\n\t\t\tstyle={{\n\t\t\t\tposition: 'absolute',\n\t\t\t\tpointerEvents: 'none',\n\t\t\t\tzIndex: 999999999,\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0,\n\t\t\t\toverflow: 'visible',\n\t\t\t}}\n\t\t>\n\t\t\t{renderingShapes.map((result) => {\n\t\t\t\tconst shape = editor.getShape(result.id)!\n\n\t\t\t\tif (shape.type === 'group') return null\n\n\t\t\t\tconst geometry = editor.getShapeGeometry(shape)\n\t\t\t\tconst pageTransform = editor.getShapePageTransform(shape)!\n\n\t\t\t\tconst pointInShapeSpace = editor.getPointInShapeSpace(shape, currentPagePoint)\n\t\t\t\tconst nearestPointOnShape = geometry.nearestPoint(pointInShapeSpace)\n\t\t\t\tconst distanceToPoint = geometry.distanceToPoint(pointInShapeSpace, true)\n\t\t\t\tconst dist = Math.abs(distanceToPoint) * zoomLevel\n\t\t\t\tconst hitInside = distanceToPoint < 0\n\n\t\t\t\tconst { vertices } = geometry\n\n\t\t\t\treturn (\n\t\t\t\t\t<g\n\t\t\t\t\t\tkey={result.id + '_outline'}\n\t\t\t\t\t\ttransform={pageTransform.toCssString()}\n\t\t\t\t\t\tstrokeLinecap=\"round\"\n\t\t\t\t\t\tstrokeLinejoin=\"round\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{showStroke && <GeometryStroke geometry={geometry} />}\n\t\t\t\t\t\t{showVertices &&\n\t\t\t\t\t\t\tvertices.map((v, i) => (\n\t\t\t\t\t\t\t\t<circle\n\t\t\t\t\t\t\t\t\tkey={`v${i}`}\n\t\t\t\t\t\t\t\t\tcx={v.x}\n\t\t\t\t\t\t\t\t\tcy={v.y}\n\t\t\t\t\t\t\t\t\tr=\"2\"\n\t\t\t\t\t\t\t\t\tfill={`hsl(${modulate(i, [0, vertices.length - 1], [120, 200])}, 100%, 50%)`}\n\t\t\t\t\t\t\t\t\tstroke=\"black\"\n\t\t\t\t\t\t\t\t\tstrokeWidth=\"1\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t{showClosestPointOnOutline && dist < 150 && (\n\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\tx1={nearestPointOnShape.x}\n\t\t\t\t\t\t\t\ty1={nearestPointOnShape.y}\n\t\t\t\t\t\t\t\tx2={pointInShapeSpace.x}\n\t\t\t\t\t\t\t\ty2={pointInShapeSpace.y}\n\t\t\t\t\t\t\t\topacity={1 - dist / 150}\n\t\t\t\t\t\t\t\tstroke={hitInside ? 'goldenrod' : 'dodgerblue'}\n\t\t\t\t\t\t\t\tstrokeWidth=\"2\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</g>\n\t\t\t\t)\n\t\t\t})}\n\t\t</svg>\n\t)\n})\n\nfunction GeometryStroke({ geometry }: { geometry: Geometry2d }) {\n\tif (geometry instanceof Group2d) {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{[...geometry.children, ...geometry.ignoredChildren].map((child, i) => (\n\t\t\t\t\t<GeometryStroke geometry={child} key={i} />\n\t\t\t\t))}\n\t\t\t</>\n\t\t)\n\t}\n\n\treturn (\n\t\t<path\n\t\t\tstroke={geometry.debugColor ?? 'red'}\n\t\t\tstrokeWidth=\"2\"\n\t\t\tfill=\"none\"\n\t\t\topacity=\"1\"\n\t\t\td={geometry.toSimpleSvgPath()}\n\t\t/>\n\t)\n}\n", "import { Box } from '../Box'\nimport { Vec } from '../Vec'\nimport { pointInPolygon } from '../utils'\n\nexport interface Geometry2dOptions {\n\tisFilled: boolean\n\tisClosed: boolean\n\tisLabel?: boolean\n\tdebugColor?: string\n\tignore?: boolean\n}\n\n/** @public */\nexport abstract class Geometry2d {\n\tisFilled = false\n\tisClosed = true\n\tisLabel = false\n\tdebugColor?: string\n\tignore?: boolean\n\n\tconstructor(opts: Geometry2dOptions) {\n\t\tthis.isFilled = opts.isFilled\n\t\tthis.isClosed = opts.isClosed\n\t\tthis.isLabel = opts.isLabel ?? false\n\t\tthis.debugColor = opts.debugColor\n\t\tthis.ignore = opts.ignore\n\t}\n\n\tabstract getVertices(): Vec[]\n\n\tabstract nearestPoint(point: Vec): Vec\n\n\t// hitTestPoint(point: Vec, margin = 0, hitInside = false) {\n\t// \t// We've removed the broad phase here; that should be done outside of the call\n\t// \treturn this.distanceToPoint(point, hitInside) <= margin\n\t// }\n\n\thitTestPoint(point: Vec, margin = 0, hitInside = false) {\n\t\t// First check whether the point is inside\n\t\tif (this.isClosed && (this.isFilled || hitInside) && pointInPolygon(point, this.vertices)) {\n\t\t\treturn true\n\t\t}\n\t\t// Then check whether the distance is within the margin\n\t\treturn Vec.Dist2(point, this.nearestPoint(point)) <= margin * margin\n\t}\n\n\tdistanceToPoint(point: Vec, hitInside = false) {\n\t\treturn (\n\t\t\tpoint.dist(this.nearestPoint(point)) *\n\t\t\t(this.isClosed && (this.isFilled || hitInside) && pointInPolygon(point, this.vertices)\n\t\t\t\t? -1\n\t\t\t\t: 1)\n\t\t)\n\t}\n\n\tdistanceToLineSegment(A: Vec, B: Vec) {\n\t\tif (A.equals(B)) return this.distanceToPoint(A)\n\t\tconst { vertices } = this\n\t\tlet nearest: Vec | undefined\n\t\tlet dist = Infinity\n\t\tlet d: number, p: Vec, q: Vec\n\t\tfor (let i = 0; i < vertices.length; i++) {\n\t\t\tp = vertices[i]\n\t\t\tq = Vec.NearestPointOnLineSegment(A, B, p, true)\n\t\t\td = Vec.Dist2(p, q)\n\t\t\tif (d < dist) {\n\t\t\t\tdist = d\n\t\t\t\tnearest = q\n\t\t\t}\n\t\t}\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn this.isClosed && this.isFilled && pointInPolygon(nearest, this.vertices) ? -dist : dist\n\t}\n\n\thitTestLineSegment(A: Vec, B: Vec, distance = 0): boolean {\n\t\treturn this.distanceToLineSegment(A, B) <= distance\n\t}\n\n\tnearestPointOnLineSegment(A: Vec, B: Vec): Vec {\n\t\tconst { vertices } = this\n\t\tlet nearest: Vec | undefined\n\t\tlet dist = Infinity\n\t\tlet d: number, p: Vec, q: Vec\n\t\tfor (let i = 0; i < vertices.length; i++) {\n\t\t\tp = vertices[i]\n\t\t\tq = Vec.NearestPointOnLineSegment(A, B, p, true)\n\t\t\td = Vec.Dist2(p, q)\n\t\t\tif (d < dist) {\n\t\t\t\tdist = d\n\t\t\t\tnearest = q\n\t\t\t}\n\t\t}\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn nearest\n\t}\n\n\tisPointInBounds(point: Vec, margin = 0) {\n\t\tconst { bounds } = this\n\t\treturn !(\n\t\t\tpoint.x < bounds.minX - margin ||\n\t\t\tpoint.y < bounds.minY - margin ||\n\t\t\tpoint.x > bounds.maxX + margin ||\n\t\t\tpoint.y > bounds.maxY + margin\n\t\t)\n\t}\n\n\tprivate _vertices: Vec[] | undefined\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget vertices(): Vec[] {\n\t\tif (!this._vertices) {\n\t\t\tthis._vertices = this.getVertices()\n\t\t}\n\n\t\treturn this._vertices\n\t}\n\n\tgetBounds() {\n\t\treturn Box.FromPoints(this.vertices)\n\t}\n\n\tprivate _bounds: Box | undefined\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget bounds(): Box {\n\t\tif (!this._bounds) {\n\t\t\tthis._bounds = this.getBounds()\n\t\t}\n\t\treturn this._bounds\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget center() {\n\t\treturn this.bounds.center\n\t}\n\n\tprivate _area: number | undefined\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget area() {\n\t\tif (!this._area) {\n\t\t\tthis._area = this.getArea()\n\t\t}\n\t\treturn this._area\n\t}\n\n\tgetArea() {\n\t\tif (!this.isClosed) {\n\t\t\treturn 0\n\t\t}\n\t\tconst { vertices } = this\n\t\tlet area = 0\n\t\tfor (let i = 0, n = vertices.length; i < n; i++) {\n\t\t\tconst curr = vertices[i]\n\t\t\tconst next = vertices[(i + 1) % n]\n\t\t\tarea += curr.x * next.y - next.x * curr.y\n\t\t}\n\t\treturn area / 2\n\t}\n\n\ttoSimpleSvgPath() {\n\t\tlet path = ''\n\n\t\tconst { vertices } = this\n\t\tconst n = vertices.length\n\n\t\tif (n === 0) return path\n\n\t\tpath += `M${vertices[0].x},${vertices[0].y}`\n\n\t\tfor (let i = 1; i < n; i++) {\n\t\t\tpath += `L${vertices[i].x},${vertices[i].y}`\n\t\t}\n\n\t\tif (this.isClosed) {\n\t\t\tpath += 'Z'\n\t\t}\n\n\t\treturn path\n\t}\n}\n", "import { Box } from '../Box'\nimport { Vec } from '../Vec'\nimport { Geometry2d, Geometry2dOptions } from './Geometry2d'\n\n/** @public */\nexport class Group2d extends Geometry2d {\n\tchildren: Geometry2d[] = []\n\tignoredChildren: Geometry2d[] = []\n\n\tconstructor(\n\t\tconfig: Omit<Geometry2dOptions, 'isClosed' | 'isFilled'> & {\n\t\t\tchildren: Geometry2d[]\n\t\t}\n\t) {\n\t\tsuper({ ...config, isClosed: true, isFilled: false })\n\n\t\tfor (const child of config.children) {\n\t\t\tif (child.ignore) {\n\t\t\t\tthis.ignoredChildren.push(child)\n\t\t\t} else {\n\t\t\t\tthis.children.push(child)\n\t\t\t}\n\t\t}\n\n\t\tif (this.children.length === 0) throw Error('Group2d must have at least one child')\n\t}\n\n\toverride getVertices(): Vec[] {\n\t\treturn this.children.filter((c) => !c.isLabel).flatMap((c) => c.vertices)\n\t}\n\n\toverride nearestPoint(point: Vec): Vec {\n\t\tlet dist = Infinity\n\t\tlet nearest: Vec | undefined\n\n\t\tconst { children } = this\n\n\t\tif (children.length === 0) {\n\t\t\tthrow Error('no children')\n\t\t}\n\n\t\tlet p: Vec\n\t\tlet d: number\n\t\tfor (const child of children) {\n\t\t\tp = child.nearestPoint(point)\n\t\t\td = Vec.Dist2(p, point)\n\t\t\tif (d < dist) {\n\t\t\t\tdist = d\n\t\t\t\tnearest = p\n\t\t\t}\n\t\t}\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn nearest\n\t}\n\n\toverride distanceToPoint(point: Vec, hitInside = false) {\n\t\treturn Math.min(...this.children.map((c, i) => c.distanceToPoint(point, hitInside || i > 0)))\n\t}\n\n\toverride hitTestPoint(point: Vec, margin: number, hitInside: boolean): boolean {\n\t\treturn !!this.children\n\t\t\t.filter((c) => !c.isLabel)\n\t\t\t.find((c) => c.hitTestPoint(point, margin, hitInside))\n\t}\n\n\toverride hitTestLineSegment(A: Vec, B: Vec, zoom: number): boolean {\n\t\treturn !!this.children.filter((c) => !c.isLabel).find((c) => c.hitTestLineSegment(A, B, zoom))\n\t}\n\n\tgetArea() {\n\t\t// todo: this is a temporary solution, assuming that the first child defines the group size; we would want to flatten the group and then find the area of the hull polygon\n\t\treturn this.children[0].area\n\t}\n\n\ttoSimpleSvgPath() {\n\t\tlet path = ''\n\t\tfor (const child of this.children) {\n\t\t\tpath += child.toSimpleSvgPath()\n\t\t}\n\n\t\tconst corners = Box.FromPoints(this.vertices).corners\n\t\t// draw just a few pixels around each corner, e.g. an L shape for the bottom left\n\n\t\tfor (let i = 0, n = corners.length; i < n; i++) {\n\t\t\tconst corner = corners[i]\n\t\t\tconst prevCorner = corners[(i - 1 + n) % n]\n\t\t\tconst prevDist = corner.dist(prevCorner)\n\t\t\tconst nextCorner = corners[(i + 1) % n]\n\t\t\tconst nextDist = corner.dist(nextCorner)\n\n\t\t\tconst A = corner.clone().lrp(prevCorner, 4 / prevDist)\n\t\t\tconst B = corner\n\t\t\tconst C = corner.clone().lrp(nextCorner, 4 / nextDist)\n\n\t\t\tpath += `M${A.x},${A.y} L${B.x},${B.y} L${C.x},${C.y} `\n\t\t}\n\t\treturn path\n\t}\n}\n", "import { track } from '@tldraw/state'\nimport { TLInstancePresence } from '@tldraw/tlschema'\nimport { useEffect, useRef, useState } from 'react'\nimport {\n\tCOLLABORATOR_CHECK_INTERVAL,\n\tCOLLABORATOR_IDLE_TIMEOUT,\n\tCOLLABORATOR_INACTIVE_TIMEOUT,\n} from '../constants'\nimport { useEditor } from '../hooks/useEditor'\nimport { useEditorComponents } from '../hooks/useEditorComponents'\nimport { usePeerIds } from '../hooks/usePeerIds'\nimport { usePresence } from '../hooks/usePresence'\n\nexport const LiveCollaborators = track(function Collaborators() {\n\tconst peerIds = usePeerIds()\n\treturn (\n\t\t<>\n\t\t\t{peerIds.map((id) => (\n\t\t\t\t<CollaboratorGuard key={id} collaboratorId={id} />\n\t\t\t))}\n\t\t</>\n\t)\n})\n\nconst CollaboratorGuard = track(function CollaboratorGuard({\n\tcollaboratorId,\n}: {\n\tcollaboratorId: string\n}) {\n\tconst editor = useEditor()\n\tconst presence = usePresence(collaboratorId)\n\tconst collaboratorState = useCollaboratorState(presence)\n\n\tif (!(presence && presence.currentPageId === editor.getCurrentPageId())) {\n\t\t// No need to render if we don't have a presence or if they're on a different page\n\t\treturn null\n\t}\n\n\tswitch (collaboratorState) {\n\t\tcase 'inactive': {\n\t\t\tconst { followingUserId, highlightedUserIds } = editor.getInstanceState()\n\t\t\t// If they're inactive and unless we're following them or they're highlighted, hide them\n\t\t\tif (!(followingUserId === presence.userId || highlightedUserIds.includes(presence.userId))) {\n\t\t\t\treturn null\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t\tcase 'idle': {\n\t\t\tconst { highlightedUserIds } = editor.getInstanceState()\n\t\t\t// If they're idle and following us and unless they have a chat message or are highlighted, hide them\n\t\t\tif (\n\t\t\t\tpresence.followingUserId === editor.user.getId() &&\n\t\t\t\t!(presence.chatMessage || highlightedUserIds.includes(presence.userId))\n\t\t\t) {\n\t\t\t\treturn null\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t\tcase 'active': {\n\t\t\t// If they're active, show them\n\t\t\tbreak\n\t\t}\n\t}\n\n\treturn <Collaborator latestPresence={presence} />\n})\n\nconst Collaborator = track(function Collaborator({\n\tlatestPresence,\n}: {\n\tlatestPresence: TLInstancePresence\n}) {\n\tconst editor = useEditor()\n\n\tconst {\n\t\tCollaboratorBrush,\n\t\tCollaboratorScribble,\n\t\tCollaboratorCursor,\n\t\tCollaboratorHint,\n\t\tCollaboratorShapeIndicator,\n\t} = useEditorComponents()\n\n\tconst zoomLevel = editor.getZoomLevel()\n\tconst viewportPageBounds = editor.getViewportPageBounds()\n\tconst { userId, chatMessage, brush, scribbles, selectedShapeIds, userName, cursor, color } =\n\t\tlatestPresence\n\n\t// Add a little padding to the top-left of the viewport\n\t// so that the cursor doesn't get cut off\n\tconst isCursorInViewport = !(\n\t\tcursor.x < viewportPageBounds.minX - 12 / zoomLevel ||\n\t\tcursor.y < viewportPageBounds.minY - 16 / zoomLevel ||\n\t\tcursor.x > viewportPageBounds.maxX - 12 / zoomLevel ||\n\t\tcursor.y > viewportPageBounds.maxY - 16 / zoomLevel\n\t)\n\n\treturn (\n\t\t<>\n\t\t\t{brush && CollaboratorBrush ? (\n\t\t\t\t<CollaboratorBrush\n\t\t\t\t\tclassName=\"tl-collaborator__brush\"\n\t\t\t\t\tkey={userId + '_brush'}\n\t\t\t\t\tbrush={brush}\n\t\t\t\t\tcolor={color}\n\t\t\t\t\topacity={0.1}\n\t\t\t\t/>\n\t\t\t) : null}\n\t\t\t{isCursorInViewport && CollaboratorCursor ? (\n\t\t\t\t<CollaboratorCursor\n\t\t\t\t\tclassName=\"tl-collaborator__cursor\"\n\t\t\t\t\tkey={userId + '_cursor'}\n\t\t\t\t\tpoint={cursor}\n\t\t\t\t\tcolor={color}\n\t\t\t\t\tzoom={zoomLevel}\n\t\t\t\t\tname={userName !== 'New User' ? userName : null}\n\t\t\t\t\tchatMessage={chatMessage}\n\t\t\t\t/>\n\t\t\t) : CollaboratorHint ? (\n\t\t\t\t<CollaboratorHint\n\t\t\t\t\tclassName=\"tl-collaborator__cursor-hint\"\n\t\t\t\t\tkey={userId + '_cursor_hint'}\n\t\t\t\t\tpoint={cursor}\n\t\t\t\t\tcolor={color}\n\t\t\t\t\tzoom={zoomLevel}\n\t\t\t\t\tviewport={viewportPageBounds}\n\t\t\t\t/>\n\t\t\t) : null}\n\t\t\t{CollaboratorScribble && scribbles.length ? (\n\t\t\t\t<>\n\t\t\t\t\t{scribbles.map((scribble) => (\n\t\t\t\t\t\t<CollaboratorScribble\n\t\t\t\t\t\t\tkey={userId + '_scribble_' + scribble.id}\n\t\t\t\t\t\t\tclassName=\"tl-collaborator__scribble\"\n\t\t\t\t\t\t\tscribble={scribble}\n\t\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\t\tzoom={zoomLevel}\n\t\t\t\t\t\t\topacity={scribble.color === 'laser' ? 0.5 : 0.1}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</>\n\t\t\t) : null}\n\t\t\t{CollaboratorShapeIndicator &&\n\t\t\t\tselectedShapeIds.map((shapeId) => (\n\t\t\t\t\t<CollaboratorShapeIndicator\n\t\t\t\t\t\tclassName=\"tl-collaborator__shape-indicator\"\n\t\t\t\t\t\tkey={userId + '_' + shapeId}\n\t\t\t\t\t\tshapeId={shapeId}\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\topacity={0.5}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t</>\n\t)\n})\n\nfunction getStateFromElapsedTime(elapsed: number) {\n\treturn elapsed > COLLABORATOR_INACTIVE_TIMEOUT\n\t\t? 'inactive'\n\t\t: elapsed > COLLABORATOR_IDLE_TIMEOUT\n\t\t\t? 'idle'\n\t\t\t: 'active'\n}\n\nfunction useCollaboratorState(latestPresence: TLInstancePresence | null) {\n\tconst rLastActivityTimestamp = useRef(latestPresence?.lastActivityTimestamp ?? -1)\n\n\tconst [state, setState] = useState<'active' | 'idle' | 'inactive'>(() =>\n\t\tgetStateFromElapsedTime(Date.now() - rLastActivityTimestamp.current)\n\t)\n\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\tsetState(getStateFromElapsedTime(Date.now() - rLastActivityTimestamp.current))\n\t\t}, COLLABORATOR_CHECK_INTERVAL)\n\n\t\treturn () => clearInterval(interval)\n\t}, [])\n\n\tif (latestPresence) {\n\t\t// We can do this on every render, it's free and cheaper than an effect\n\t\t// remember, there can be lots and lots of cursors moving around all the time\n\t\trLastActivityTimestamp.current = latestPresence.lastActivityTimestamp\n\t}\n\n\treturn state\n}\n", "import _uniq from 'lodash.uniq'\n\n/** @public */\nexport function uniq<T>(\n\tarray:\n\t\t| {\n\t\t\t\treadonly length: number\n\t\t\t\treadonly [n: number]: T\n\t\t  }\n\t\t| null\n\t\t| undefined\n): T[] {\n\treturn _uniq(array)\n}\n", "import { useComputed, useValue } from '@tldraw/state'\nimport { uniq } from '../utils/uniq'\nimport { useEditor } from './useEditor'\n\n// TODO: maybe move this to a computed property on the App class?\n/**\n * @returns The list of peer UserIDs\n * @internal\n */\nexport function usePeerIds() {\n\tconst editor = useEditor()\n\n\tconst $userIds = useComputed(\n\t\t'userIds',\n\t\t() => uniq(editor.getCollaborators().map((p) => p.userId)).sort(),\n\t\t{ isEqual: (a, b) => a.join(',') === b.join?.(',') },\n\t\t[editor]\n\t)\n\n\treturn useValue($userIds)\n}\n", "import { useValue } from '@tldraw/state'\nimport { TLInstancePresence } from '@tldraw/tlschema'\nimport { useEditor } from './useEditor'\n\n// TODO: maybe move this to a computed property on the App class?\n/**\n * @returns The list of peer UserIDs\n * @internal\n */\nexport function usePresence(userId: string): TLInstancePresence | null {\n\tconst editor = useEditor()\n\n\tconst latestPresence = useValue(\n\t\t`latestPresence:${userId}`,\n\t\t() => {\n\t\t\treturn editor.getCollaborators().find((c) => c.userId === userId)\n\t\t},\n\t\t[editor]\n\t)\n\n\treturn latestPresence ?? null\n}\n", "import { useQuickReactor, useStateTracking } from '@tldraw/state'\nimport { TLShape, TLShapeId } from '@tldraw/tlschema'\nimport { memo, useCallback, useRef } from 'react'\nimport { ShapeUtil } from '../editor/shapes/ShapeUtil'\nimport { useEditor } from '../hooks/useEditor'\nimport { useEditorComponents } from '../hooks/useEditorComponents'\nimport { Mat } from '../primitives/Mat'\nimport { setStyleProperty } from '../utils/dom'\nimport { OptionalErrorBoundary } from './ErrorBoundary'\n\n/*\nThis component renders shapes on the canvas. There are two stages: positioning\nand styling the shape's container using CSS, and then rendering the shape's \nJSX using its shape util's render method. Rendering the \"inside\" of a shape is\nmore expensive than positioning it or changing its color, so we use memo\nto wrap the inner shape and only re-render it when the shape's props change. \n\nThe shape also receives props for its index and opacity. The index is used to\ndetermine the z-index of the shape, and the opacity is used to set the shape's\nopacity based on its own opacity and that of its parent's.\n*/\nexport const Shape = memo(function Shape({\n\tid,\n\tshape,\n\tutil,\n\tindex,\n\tbackgroundIndex,\n\topacity,\n\tdprMultiple,\n}: {\n\tid: TLShapeId\n\tshape: TLShape\n\tutil: ShapeUtil\n\tindex: number\n\tbackgroundIndex: number\n\topacity: number\n\tdprMultiple: number\n}) {\n\tconst editor = useEditor()\n\n\tconst { ShapeErrorFallback } = useEditorComponents()\n\n\tconst containerRef = useRef<HTMLDivElement>(null)\n\tconst bgContainerRef = useRef<HTMLDivElement>(null)\n\n\tconst memoizedStuffRef = useRef({\n\t\ttransform: '',\n\t\tclipPath: 'none',\n\t\twidth: 0,\n\t\theight: 0,\n\t\tx: 0,\n\t\ty: 0,\n\t\tisCulled: false,\n\t})\n\n\tuseQuickReactor(\n\t\t'set shape stuff',\n\t\t() => {\n\t\t\tconst shape = editor.getShape(id)\n\t\t\tif (!shape) return // probably the shape was just deleted\n\n\t\t\tconst prev = memoizedStuffRef.current\n\n\t\t\t// Clip path\n\t\t\tconst clipPath = editor.getShapeClipPath(id) ?? 'none'\n\t\t\tif (clipPath !== prev.clipPath) {\n\t\t\t\tsetStyleProperty(containerRef.current, 'clip-path', clipPath)\n\t\t\t\tsetStyleProperty(bgContainerRef.current, 'clip-path', clipPath)\n\t\t\t\tprev.clipPath = clipPath\n\t\t\t}\n\n\t\t\t// Page transform\n\t\t\tconst pageTransform = editor.getShapePageTransform(id)\n\t\t\tconst transform = Mat.toCssString(pageTransform)\n\t\t\tconst bounds = editor.getShapeGeometry(shape).bounds\n\n\t\t\t// Update if the tranform has changed\n\t\t\tif (transform !== prev.transform) {\n\t\t\t\tsetStyleProperty(containerRef.current, 'transform', transform)\n\t\t\t\tsetStyleProperty(bgContainerRef.current, 'transform', transform)\n\t\t\t\tprev.transform = transform\n\t\t\t}\n\n\t\t\t// Width / Height\n\t\t\t// We round the shape width and height up to the nearest multiple of dprMultiple\n\t\t\t// to avoid the browser making miscalculations when applying the transform.\n\t\t\tconst widthRemainder = bounds.w % dprMultiple\n\t\t\tconst heightRemainder = bounds.h % dprMultiple\n\t\t\tconst width = widthRemainder === 0 ? bounds.w : bounds.w + (dprMultiple - widthRemainder)\n\t\t\tconst height = heightRemainder === 0 ? bounds.h : bounds.h + (dprMultiple - heightRemainder)\n\n\t\t\tif (width !== prev.width || height !== prev.height) {\n\t\t\t\tsetStyleProperty(containerRef.current, 'width', Math.max(width, dprMultiple) + 'px')\n\t\t\t\tsetStyleProperty(containerRef.current, 'height', Math.max(height, dprMultiple) + 'px')\n\t\t\t\tsetStyleProperty(bgContainerRef.current, 'width', Math.max(width, dprMultiple) + 'px')\n\t\t\t\tsetStyleProperty(bgContainerRef.current, 'height', Math.max(height, dprMultiple) + 'px')\n\t\t\t\tprev.width = width\n\t\t\t\tprev.height = height\n\t\t\t}\n\t\t},\n\t\t[editor]\n\t)\n\n\t// This stuff changes pretty infrequently, so we can change them together\n\tuseQuickReactor(\n\t\t'set opacity and z-index',\n\t\t() => {\n\t\t\tconst container = containerRef.current\n\t\t\tconst bgContainer = bgContainerRef.current\n\n\t\t\t// Opacity\n\t\t\tsetStyleProperty(container, 'opacity', opacity)\n\t\t\tsetStyleProperty(bgContainer, 'opacity', opacity)\n\n\t\t\t// Z-Index\n\t\t\tsetStyleProperty(container, 'z-index', index)\n\t\t\tsetStyleProperty(bgContainer, 'z-index', backgroundIndex)\n\t\t},\n\t\t[opacity, index, backgroundIndex]\n\t)\n\n\tuseQuickReactor(\n\t\t'set display',\n\t\t() => {\n\t\t\tconst shape = editor.getShape(id)\n\t\t\tif (!shape) return // probably the shape was just deleted\n\n\t\t\tconst culledShapes = editor.getCulledShapes()\n\t\t\tconst isCulled = culledShapes.has(id)\n\t\t\tif (isCulled !== memoizedStuffRef.current.isCulled) {\n\t\t\t\tsetStyleProperty(containerRef.current, 'display', isCulled ? 'none' : 'block')\n\t\t\t\tsetStyleProperty(bgContainerRef.current, 'display', isCulled ? 'none' : 'block')\n\t\t\t\tmemoizedStuffRef.current.isCulled = isCulled\n\t\t\t}\n\t\t},\n\t\t[editor]\n\t)\n\tconst annotateError = useCallback(\n\t\t(error: any) => editor.annotateError(error, { origin: 'shape', willCrashApp: false }),\n\t\t[editor]\n\t)\n\n\tif (!shape) return null\n\n\tconst isFilledShape = 'fill' in shape.props && shape.props.fill !== 'none'\n\n\treturn (\n\t\t<>\n\t\t\t{util.backgroundComponent && (\n\t\t\t\t<div\n\t\t\t\t\tref={bgContainerRef}\n\t\t\t\t\tclassName=\"tl-shape tl-shape-background\"\n\t\t\t\t\tdata-shape-type={shape.type}\n\t\t\t\t\tdraggable={false}\n\t\t\t\t>\n\t\t\t\t\t<OptionalErrorBoundary fallback={ShapeErrorFallback} onError={annotateError}>\n\t\t\t\t\t\t<InnerShapeBackground shape={shape} util={util} />\n\t\t\t\t\t</OptionalErrorBoundary>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t\t<div\n\t\t\t\tref={containerRef}\n\t\t\t\tclassName=\"tl-shape\"\n\t\t\t\tdata-shape-type={shape.type}\n\t\t\t\tdata-shape-is-filled={isFilledShape}\n\t\t\t\tdraggable={false}\n\t\t\t>\n\t\t\t\t<OptionalErrorBoundary fallback={ShapeErrorFallback as any} onError={annotateError}>\n\t\t\t\t\t<InnerShape shape={shape} util={util} />\n\t\t\t\t</OptionalErrorBoundary>\n\t\t\t</div>\n\t\t</>\n\t)\n})\n\nconst InnerShape = memo(\n\tfunction InnerShape<T extends TLShape>({ shape, util }: { shape: T; util: ShapeUtil<T> }) {\n\t\treturn useStateTracking('InnerShape:' + shape.type, () => util.component(shape))\n\t},\n\t(prev, next) => prev.shape.props === next.shape.props && prev.shape.meta === next.shape.meta\n)\n\nconst InnerShapeBackground = memo(\n\tfunction InnerShapeBackground<T extends TLShape>({\n\t\tshape,\n\t\tutil,\n\t}: {\n\t\tshape: T\n\t\tutil: ShapeUtil<T>\n\t}) {\n\t\treturn useStateTracking('InnerShape:' + shape.type, () => util.backgroundComponent?.(shape))\n\t},\n\t(prev, next) => prev.shape.props === next.shape.props && prev.shape.meta === next.shape.meta\n)\n", "import { VecModel } from '@tldraw/tlschema'\nimport classNames from 'classnames'\nimport { useRef } from 'react'\nimport { useTransform } from '../../hooks/useTransform'\nimport { Box } from '../../primitives/Box'\nimport { Vec } from '../../primitives/Vec'\nimport { clamp } from '../../primitives/utils'\n\n/** @public */\nexport type TLCollaboratorHintProps = {\n\tclassName?: string\n\tpoint: VecModel\n\tviewport: Box\n\tzoom: number\n\topacity?: number\n\tcolor: string\n}\n\n/** @public */\nexport function DefaultCollaboratorHint({\n\tclassName,\n\tzoom,\n\tpoint,\n\tcolor,\n\tviewport,\n\topacity = 1,\n}: TLCollaboratorHintProps) {\n\tconst rSvg = useRef<SVGSVGElement>(null)\n\n\tuseTransform(\n\t\trSvg,\n\t\tclamp(point.x, viewport.minX + 5 / zoom, viewport.maxX - 5 / zoom),\n\t\tclamp(point.y, viewport.minY + 5 / zoom, viewport.maxY - 5 / zoom),\n\t\t1 / zoom,\n\t\tVec.Angle(viewport.center, point)\n\t)\n\n\treturn (\n\t\t<svg ref={rSvg} className={classNames('tl-overlays__item', className)}>\n\t\t\t<use href=\"#cursor_hint\" color={color} strokeWidth={3} stroke=\"var(--color-background)\" />\n\t\t\t<use href=\"#cursor_hint\" color={color} opacity={opacity} />\n\t\t</svg>\n\t)\n}\n", "import { VecModel } from '@tldraw/tlschema'\nimport classNames from 'classnames'\nimport { memo, useRef } from 'react'\nimport { useTransform } from '../../hooks/useTransform'\n\n/** @public */\nexport type TLCursorProps = {\n\tclassName?: string\n\tpoint: VecModel | null\n\tzoom: number\n\tcolor?: string\n\tname: string | null\n\tchatMessage: string\n}\n\n/** @public */\nexport const DefaultCursor = memo(function DefaultCursor({\n\tclassName,\n\tzoom,\n\tpoint,\n\tcolor,\n\tname,\n\tchatMessage,\n}: TLCursorProps) {\n\tconst rCursor = useRef<HTMLDivElement>(null)\n\tuseTransform(rCursor, point?.x, point?.y, 1 / zoom)\n\n\tif (!point) return null\n\n\treturn (\n\t\t<div ref={rCursor} className={classNames('tl-overlays__item', className)}>\n\t\t\t<svg className=\"tl-cursor\">\n\t\t\t\t<use href=\"#cursor\" color={color} />\n\t\t\t</svg>\n\t\t\t{chatMessage ? (\n\t\t\t\t<>\n\t\t\t\t\t{name && (\n\t\t\t\t\t\t<div className=\"tl-nametag-title\" style={{ color }}>\n\t\t\t\t\t\t\t{name}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"tl-nametag-chat\" style={{ backgroundColor: color }}>\n\t\t\t\t\t\t{chatMessage}\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t) : (\n\t\t\t\tname && (\n\t\t\t\t\t<div className=\"tl-nametag\" style={{ backgroundColor: color }}>\n\t\t\t\t\t\t{name}\n\t\t\t\t\t</div>\n\t\t\t\t)\n\t\t\t)}\n\t\t</div>\n\t)\n})\n", "import { modulate } from '@tldraw/utils'\nimport { GRID_STEPS } from '../../constants'\n\n/** @public */\nexport type TLGridProps = {\n\tx: number\n\ty: number\n\tz: number\n\tsize: number\n}\n\n/** @public */\nexport function DefaultGrid({ x, y, z, size }: TLGridProps) {\n\treturn (\n\t\t<svg className=\"tl-grid\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t<defs>\n\t\t\t\t{GRID_STEPS.map(({ min, mid, step }, i) => {\n\t\t\t\t\tconst s = step * size * z\n\t\t\t\t\tconst xo = 0.5 + x * z\n\t\t\t\t\tconst yo = 0.5 + y * z\n\t\t\t\t\tconst gxo = xo > 0 ? xo % s : s + (xo % s)\n\t\t\t\t\tconst gyo = yo > 0 ? yo % s : s + (yo % s)\n\t\t\t\t\tconst opacity = z < mid ? modulate(z, [min, mid], [0, 1]) : 1\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<pattern\n\t\t\t\t\t\t\tkey={`grid-pattern-${i}`}\n\t\t\t\t\t\t\tid={`grid-${step}`}\n\t\t\t\t\t\t\twidth={s}\n\t\t\t\t\t\t\theight={s}\n\t\t\t\t\t\t\tpatternUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<circle className=\"tl-grid-dot\" cx={gxo} cy={gyo} r={1} opacity={opacity} />\n\t\t\t\t\t\t</pattern>\n\t\t\t\t\t)\n\t\t\t\t})}\n\t\t\t</defs>\n\t\t\t{GRID_STEPS.map(({ step }, i) => (\n\t\t\t\t<rect key={`grid-rect-${i}`} width=\"100%\" height=\"100%\" fill={`url(#grid-${step})`} />\n\t\t\t))}\n\t\t</svg>\n\t)\n}\n", "import { TLHandle, TLShapeId } from '@tldraw/tlschema'\nimport classNames from 'classnames'\nimport { COARSE_HANDLE_RADIUS, HANDLE_RADIUS, SIDES } from '../../constants'\n\n/** @public */\nexport type TLHandleProps = {\n\tshapeId: TLShapeId\n\thandle: TLHandle\n\tzoom: number\n\tisCoarse: boolean\n\tclassName?: string\n}\n\n/** @public */\nexport function DefaultHandle({ handle, isCoarse, className, zoom }: TLHandleProps) {\n\tconst br = (isCoarse ? COARSE_HANDLE_RADIUS : HANDLE_RADIUS) / zoom\n\n\tif (handle.type === 'clone') {\n\t\t// bouba\n\t\tconst fr = 3 / Math.max(zoom, 0.35)\n\t\tconst path = `M0,${-fr} A${fr},${fr} 0 0,1 0,${fr}`\n\t\t// kiki\n\t\t// const fr = 4 / Math.max(zoom, 0.35)\n\t\t// const path = `M0,${-fr} L${fr},0 L0,${fr} Z`\n\n\t\tconst index = SIDES.indexOf(handle.id as (typeof SIDES)[number])\n\t\treturn (\n\t\t\t<g className={classNames(`tl-handle tl-handle__${handle.type}`, className)}>\n\t\t\t\t<circle className=\"tl-handle__bg\" r={br} />\n\t\t\t\t{/* Half circle */}\n\t\t\t\t<path className=\"tl-handle__fg\" d={path} transform={`rotate(${-90 + 90 * index})`} />\n\t\t\t</g>\n\t\t)\n\t}\n\n\tconst fr = (handle.type === 'create' && isCoarse ? 3 : 4) / Math.max(zoom, 0.35)\n\treturn (\n\t\t<g className={classNames(`tl-handle tl-handle__${handle.type}`, className)}>\n\t\t\t<circle className=\"tl-handle__bg\" r={br} />\n\t\t\t<circle className=\"tl-handle__fg\" r={fr} />\n\t\t</g>\n\t)\n}\n", "import { ReactNode } from 'react'\n\n/** @public */\nexport type TLHandlesProps = {\n\tchildren: ReactNode\n}\n\n/** @public */\nexport const DefaultHandles = ({ children }: TLHandlesProps) => {\n\treturn <svg className=\"tl-user-handles tl-overlays__item\">{children}</svg>\n}\n", "import { TLScribble } from '@tldraw/tlschema'\nimport classNames from 'classnames'\nimport { getSvgPathFromPoints } from '../../utils/getSvgPathFromPoints'\n\n/** @public */\nexport type TLScribbleProps = {\n\tscribble: TLScribble\n\tzoom: number\n\tcolor?: string\n\topacity?: number\n\tclassName?: string\n}\n\n/** @public */\nexport function DefaultScribble({ scribble, zoom, color, opacity, className }: TLScribbleProps) {\n\tif (!scribble.points.length) return null\n\n\treturn (\n\t\t<svg className={className ? classNames('tl-overlays__item', className) : className}>\n\t\t\t<path\n\t\t\t\tclassName=\"tl-scribble\"\n\t\t\t\td={getSvgPathFromPoints(scribble.points, false)}\n\t\t\t\tstroke={color ?? `var(--color-${scribble.color})`}\n\t\t\t\tfill=\"none\"\n\t\t\t\tstrokeWidth={8 / zoom}\n\t\t\t\topacity={opacity ?? scribble.opacity}\n\t\t\t/>\n\t\t</svg>\n\t)\n}\n", "import { VecLike } from '../primitives/Vec'\nimport { average, precise } from '../primitives/utils'\n\n/**\n * Turn an array of points into a path of quadradic curves.\n *\n * @param points - The points returned from perfect-freehand\n * @param closed - Whether the stroke is closed\n *\n * @public\n */\nexport function getSvgPathFromPoints(points: VecLike[], closed = true): string {\n\tconst len = points.length\n\n\tif (len < 2) {\n\t\treturn ''\n\t}\n\n\tlet a = points[0]\n\tlet b = points[1]\n\n\tif (len === 2) {\n\t\t// If only two points, just draw a line\n\t\treturn `M${precise(a)}L${precise(b)}`\n\t}\n\n\tlet result = ''\n\n\tfor (let i = 2, max = len - 1; i < max; i++) {\n\t\ta = points[i]\n\t\tb = points[i + 1]\n\t\tresult += average(a, b)\n\t}\n\n\tif (closed) {\n\t\t// If closed, draw a curve from the last point to the first\n\t\treturn `M${average(points[0], points[1])}Q${precise(points[1])}${average(\n\t\t\tpoints[1],\n\t\t\tpoints[2]\n\t\t)}T${result}${average(points[len - 1], points[0])}${average(points[0], points[1])}Z`\n\t} else {\n\t\t// If not closed, draw a curve starting at the first point and\n\t\t// ending at the midpoint of the last and second-last point, then\n\t\t// complete the curve with a line segment to the last point.\n\t\treturn `M${precise(points[0])}Q${precise(points[1])}${average(points[1], points[2])}${\n\t\t\tpoints.length > 3 ? 'T' : ''\n\t\t}${result}L${precise(points[len - 1])}`\n\t}\n}\n", "import * as React from 'react'\nimport { useTransform } from '../../hooks/useTransform'\nimport { Box } from '../../primitives/Box'\nimport { toDomPrecision } from '../../primitives/utils'\n\n/** @public */\nexport type TLSelectionBackgroundProps = {\n\tbounds: Box\n\trotation: number\n}\n\n/** @public */\nexport function DefaultSelectionBackground({ bounds, rotation }: TLSelectionBackgroundProps) {\n\tconst rDiv = React.useRef<HTMLDivElement>(null)\n\tuseTransform(rDiv, bounds.x, bounds.y, 1, rotation)\n\n\tReact.useLayoutEffect(() => {\n\t\tconst div = rDiv.current\n\t\tif (!div) return\n\t\tdiv.style.width = toDomPrecision(Math.max(1, bounds.width)) + 'px'\n\t\tdiv.style.height = toDomPrecision(Math.max(1, bounds.height)) + 'px'\n\t}, [bounds.width, bounds.height])\n\n\treturn <div ref={rDiv} className=\"tl-selection__bg\" draggable={false} />\n}\n", "import { useValue } from '@tldraw/state'\nimport classNames from 'classnames'\nimport { useRef } from 'react'\nimport { useEditor } from '../../hooks/useEditor'\nimport { useTransform } from '../../hooks/useTransform'\nimport { Box } from '../../primitives/Box'\nimport { toDomPrecision } from '../../primitives/utils'\n\n/** @public */\nexport type TLSelectionForegroundProps = {\n\tbounds: Box\n\trotation: number\n}\n\n/** @public */\nexport function DefaultSelectionForeground({ bounds, rotation }: TLSelectionForegroundProps) {\n\tconst editor = useEditor()\n\tconst rSvg = useRef<SVGSVGElement>(null)\n\n\tconst onlyShape = useValue('only selected shape', () => editor.getOnlySelectedShape(), [editor])\n\n\t// if all shapes have an expandBy for the selection outline, we can expand by the l\n\tconst expandOutlineBy = onlyShape\n\t\t? editor.getShapeUtil(onlyShape).expandSelectionOutlinePx(onlyShape)\n\t\t: 0\n\n\tuseTransform(rSvg, bounds?.x, bounds?.y, 1, rotation, {\n\t\tx: -expandOutlineBy,\n\t\ty: -expandOutlineBy,\n\t})\n\n\tbounds = bounds.clone().expandBy(expandOutlineBy).zeroFix()\n\n\treturn (\n\t\t<svg\n\t\t\tref={rSvg}\n\t\t\tclassName=\"tl-overlays__item tl-selection__fg\"\n\t\t\tdata-testid=\"selection-foreground\"\n\t\t>\n\t\t\t<rect\n\t\t\t\tclassName={classNames('tl-selection__fg__outline')}\n\t\t\t\twidth={toDomPrecision(bounds.width)}\n\t\t\t\theight={toDomPrecision(bounds.height)}\n\t\t\t/>\n\t\t</svg>\n\t)\n}\n", "import { ComponentType } from 'react'\n\n/** @public */\nexport type TLShapeErrorFallbackComponent = ComponentType<{ error: any }>\n\n/** @internal */\nexport const DefaultShapeErrorFallback: TLShapeErrorFallbackComponent = () => {\n\treturn <div className=\"tl-shape-error-boundary\" />\n}\n", "import { useQuickReactor, useStateTracking, useValue } from '@tldraw/state'\nimport { TLShape, TLShapeId } from '@tldraw/tlschema'\nimport classNames from 'classnames'\nimport { memo, useLayoutEffect, useRef } from 'react'\nimport type { Editor } from '../../editor/Editor'\nimport { ShapeUtil } from '../../editor/shapes/ShapeUtil'\nimport { useEditor } from '../../hooks/useEditor'\nimport { useEditorComponents } from '../../hooks/useEditorComponents'\nimport { OptionalErrorBoundary } from '../ErrorBoundary'\n\n// need an extra layer of indirection here to allow hooks to be used inside the indicator render\nconst EvenInnererIndicator = ({ shape, util }: { shape: TLShape; util: ShapeUtil<any> }) => {\n\treturn useStateTracking('Indicator: ' + shape.type, () => util.indicator(shape))\n}\n\nconst InnerIndicator = ({ editor, id }: { editor: Editor; id: TLShapeId }) => {\n\tconst shape = useValue('shape for indicator', () => editor.store.get(id), [editor, id])\n\n\tconst { ShapeIndicatorErrorFallback } = useEditorComponents()\n\n\tif (!shape || shape.isLocked) return null\n\n\treturn (\n\t\t<OptionalErrorBoundary\n\t\t\tfallback={ShapeIndicatorErrorFallback}\n\t\t\tonError={(error) =>\n\t\t\t\teditor.annotateError(error, { origin: 'react.shapeIndicator', willCrashApp: false })\n\t\t\t}\n\t\t>\n\t\t\t<EvenInnererIndicator key={shape.id} shape={shape} util={editor.getShapeUtil(shape)} />\n\t\t</OptionalErrorBoundary>\n\t)\n}\n\n/** @public */\nexport type TLShapeIndicatorProps = {\n\tshapeId: TLShapeId\n\tcolor?: string | undefined\n\topacity?: number\n\tclassName?: string\n\thidden?: boolean\n}\n\n/** @public */\nexport const DefaultShapeIndicator = memo(function DefaultShapeIndicator({\n\tshapeId,\n\tclassName,\n\tcolor,\n\thidden,\n\topacity,\n}: TLShapeIndicatorProps) {\n\tconst editor = useEditor()\n\n\tconst rIndicator = useRef<SVGSVGElement>(null)\n\n\tuseQuickReactor(\n\t\t'indicator transform',\n\t\t() => {\n\t\t\tconst elm = rIndicator.current\n\t\t\tif (!elm) return\n\t\t\tconst pageTransform = editor.getShapePageTransform(shapeId)\n\t\t\tif (!pageTransform) return\n\t\t\telm.style.setProperty('transform', pageTransform.toCssString())\n\t\t},\n\t\t[editor, shapeId]\n\t)\n\n\tuseLayoutEffect(() => {\n\t\tconst elm = rIndicator.current\n\t\tif (!elm) return\n\t\telm.style.setProperty('display', hidden ? 'none' : 'block')\n\t}, [hidden])\n\n\treturn (\n\t\t<svg ref={rIndicator} className={classNames('tl-overlays__item', className)}>\n\t\t\t<g className=\"tl-shape-indicator\" stroke={color ?? 'var(--color-selected)'} opacity={opacity}>\n\t\t\t\t<InnerIndicator editor={editor} id={shapeId} />\n\t\t\t</g>\n\t\t</svg>\n\t)\n})\n", "import { ComponentType } from 'react'\n\n/** @public */\nexport type TLShapeIndicatorErrorFallbackComponent = ComponentType<{ error: unknown }>\n\n/** @internal */\nexport const DefaultShapeIndicatorErrorFallback: TLShapeIndicatorErrorFallbackComponent = () => {\n\treturn <circle cx={4} cy={4} r={8} strokeWidth=\"1\" stroke=\"red\" />\n}\n", "import classNames from 'classnames'\nimport * as React from 'react'\nimport {\n\ttype GapsSnapIndicator,\n\ttype PointsSnapIndicator,\n\ttype SnapIndicator,\n} from '../../editor/managers/SnapManager/SnapManager'\nimport { rangeIntersection } from '../../primitives/utils'\n\nfunction PointsSnapIndicator({ points, zoom }: { zoom: number } & PointsSnapIndicator) {\n\tconst l = 2.5 / zoom\n\n\tconst minX = points.reduce((acc, p) => Math.min(acc, p.x), Infinity)\n\tconst maxX = points.reduce((acc, p) => Math.max(acc, p.x), -Infinity)\n\tconst minY = points.reduce((acc, p) => Math.min(acc, p.y), Infinity)\n\tconst maxY = points.reduce((acc, p) => Math.max(acc, p.y), -Infinity)\n\n\tconst useNWtoSEdireciton = points.some((p) => p.x === minX && p.y === minY)\n\tlet firstX: number, firstY: number, secondX: number, secondY: number\n\tif (useNWtoSEdireciton) {\n\t\tfirstX = minX\n\t\tfirstY = minY\n\t\tsecondX = maxX\n\t\tsecondY = maxY\n\t} else {\n\t\tfirstX = minX\n\t\tfirstY = maxY\n\t\tsecondX = maxX\n\t\tsecondY = minY\n\t}\n\n\treturn (\n\t\t<g className=\"tl-snap-indicator\" stroke=\"lime\">\n\t\t\t<line x1={firstX} y1={firstY} x2={secondX} y2={secondY} />\n\t\t\t{points.map((p, i) => (\n\t\t\t\t<g transform={`translate(${p.x},${p.y})`} key={i}>\n\t\t\t\t\t<path\n\t\t\t\t\t\tclassName=\"tl-snap-point\"\n\t\t\t\t\t\td={`M ${-l},${-l} L ${l},${l} M ${-l},${l} L ${l},${-l}`}\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t))}\n\t\t</g>\n\t)\n}\n\nfunction GapsSnapIndicator({ gaps, direction, zoom }: { zoom: number } & GapsSnapIndicator) {\n\tconst l = 3.5 / zoom\n\n\tlet edgeIntersection: number[] | null = [-Infinity, +Infinity]\n\tlet nextEdgeIntersection: number[] | null = null\n\n\tconst horizontal = direction === 'horizontal'\n\n\t// find intersection of all gaps so we can render a straight line through it;\n\t// some range intersections may return null, in which case we skip that gap.\n\tfor (const gap of gaps) {\n\t\tnextEdgeIntersection = rangeIntersection(\n\t\t\tedgeIntersection[0],\n\t\t\tedgeIntersection[1],\n\t\t\thorizontal ? gap.startEdge[0].y : gap.startEdge[0].x,\n\t\t\thorizontal ? gap.startEdge[1].y : gap.startEdge[1].x\n\t\t)\n\n\t\tif (nextEdgeIntersection) {\n\t\t\tedgeIntersection = nextEdgeIntersection\n\t\t} else {\n\t\t\tcontinue\n\t\t}\n\n\t\tnextEdgeIntersection = rangeIntersection(\n\t\t\tedgeIntersection[0],\n\t\t\tedgeIntersection[1],\n\t\t\thorizontal ? gap.endEdge[0].y : gap.endEdge[0].x,\n\t\t\thorizontal ? gap.endEdge[1].y : gap.endEdge[1].x\n\t\t)\n\n\t\tif (nextEdgeIntersection) {\n\t\t\tedgeIntersection = nextEdgeIntersection\n\t\t} else {\n\t\t\tcontinue\n\t\t}\n\t}\n\n\tif (edgeIntersection === null) {\n\t\treturn null\n\t}\n\n\tconst midPoint = (edgeIntersection[0] + edgeIntersection[1]) / 2\n\n\treturn (\n\t\t<g className=\"tl-snap-indicator\" stroke=\"cyan\">\n\t\t\t{gaps.map(({ startEdge, endEdge }, i) => (\n\t\t\t\t<React.Fragment key={i}>\n\t\t\t\t\t{horizontal ? (\n\t\t\t\t\t\t// horizontal gap\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* start edge */}\n\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\tx1={startEdge[0].x}\n\t\t\t\t\t\t\t\ty1={midPoint - 2 * l}\n\t\t\t\t\t\t\t\tx2={startEdge[1].x}\n\t\t\t\t\t\t\t\ty2={midPoint + 2 * l}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/* end edge */}\n\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\tx1={endEdge[0].x}\n\t\t\t\t\t\t\t\ty1={midPoint - 2 * l}\n\t\t\t\t\t\t\t\tx2={endEdge[1].x}\n\t\t\t\t\t\t\t\ty2={midPoint + 2 * l}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/* joining line */}\n\t\t\t\t\t\t\t<line x1={startEdge[0].x} y1={midPoint} x2={endEdge[0].x} y2={midPoint} />\n\t\t\t\t\t\t\t{/* center point marker */}\n\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\tx1={(startEdge[0].x + endEdge[0].x) / 2}\n\t\t\t\t\t\t\t\ty1={midPoint - l}\n\t\t\t\t\t\t\t\tx2={(startEdge[0].x + endEdge[0].x) / 2}\n\t\t\t\t\t\t\t\ty2={midPoint + l}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t// vertical gap\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* start edge */}\n\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\tx1={midPoint - 2 * l}\n\t\t\t\t\t\t\t\ty1={startEdge[0].y}\n\t\t\t\t\t\t\t\tx2={midPoint + 2 * l}\n\t\t\t\t\t\t\t\ty2={startEdge[1].y}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/* end edge */}\n\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\tx1={midPoint - 2 * l}\n\t\t\t\t\t\t\t\ty1={endEdge[0].y}\n\t\t\t\t\t\t\t\tx2={midPoint + 2 * l}\n\t\t\t\t\t\t\t\ty2={endEdge[1].y}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/* joining line */}\n\t\t\t\t\t\t\t<line x1={midPoint} y1={startEdge[0].y} x2={midPoint} y2={endEdge[0].y} />\n\t\t\t\t\t\t\t{/* center point marker */}\n\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\tx1={midPoint - l}\n\t\t\t\t\t\t\t\ty1={(startEdge[0].y + endEdge[0].y) / 2}\n\t\t\t\t\t\t\t\tx2={midPoint + l}\n\t\t\t\t\t\t\t\ty2={(startEdge[0].y + endEdge[0].y) / 2}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</React.Fragment>\n\t\t\t))}\n\t\t</g>\n\t)\n}\n\n/** @public */\nexport type TLSnapIndicatorProps = {\n\tclassName?: string\n\tline: SnapIndicator\n\tzoom: number\n}\n\n/** @public */\nexport function DefaultSnapIndicator({ className, line, zoom }: TLSnapIndicatorProps) {\n\treturn (\n\t\t<svg className={classNames('tl-overlays__item', className)}>\n\t\t\t{line.type === 'points' ? (\n\t\t\t\t<PointsSnapIndicator {...line} zoom={zoom} />\n\t\t\t) : line.type === 'gaps' ? (\n\t\t\t\t<GapsSnapIndicator {...line} zoom={zoom} />\n\t\t\t) : null}\n\t\t</svg>\n\t)\n}\n", "/** @public */\nexport function DefaultSpinner() {\n\treturn (\n\t\t<svg width={16} height={16} viewBox=\"0 0 16 16\">\n\t\t\t<g strokeWidth={2} fill=\"none\" fillRule=\"evenodd\">\n\t\t\t\t<circle strokeOpacity={0.25} cx={8} cy={8} r={7} stroke=\"var(--color-text-1)\" />\n\t\t\t\t<path strokeLinecap=\"round\" d=\"M15 8c0-4.5-4.5-7-7-7\" stroke=\"var(--color-text-1)\">\n\t\t\t\t\t<animateTransform\n\t\t\t\t\t\tattributeName=\"transform\"\n\t\t\t\t\t\ttype=\"rotate\"\n\t\t\t\t\t\tfrom=\"0 8 8\"\n\t\t\t\t\t\tto=\"360 8 8\"\n\t\t\t\t\t\tdur=\"1s\"\n\t\t\t\t\t\trepeatCount=\"indefinite\"\n\t\t\t\t\t/>\n\t\t\t\t</path>\n\t\t\t</g>\n\t\t</svg>\n\t)\n}\n", "/** @public */\nexport const DefaultSvgDefs = () => {\n\treturn null\n}\n", "import { areArraysShallowEqual, areObjectsShallowEqual } from '@tldraw/utils'\nimport { useRef } from 'react'\n\nfunction useIdentity<T>(value: T, isEqual: (a: T, b: T) => boolean): T {\n\tconst ref = useRef(value)\n\tif (isEqual(value, ref.current)) {\n\t\treturn ref.current\n\t}\n\tref.current = value\n\treturn value\n}\n\n/** @internal */\nexport function useShallowArrayIdentity<T>(arr: readonly T[]): readonly T[] {\n\treturn useIdentity(arr, areArraysShallowEqual)\n}\n\n/** @internal */\nexport function useShallowObjectIdentity<T extends Record<string, unknown>>(arr: T): T {\n\treturn useIdentity(arr, areObjectsShallowEqual)\n}\n", "/** @public */\nexport const runtime: {\n\topenWindow: (url: string, target: string) => void\n\trefreshPage: () => void\n\thardReset: () => void\n} = {\n\topenWindow: (url, target) => window.open(url, target, 'noopener noreferrer'),\n\trefreshPage: () => window.location.reload(),\n\thardReset: async () => await (window as any).__tldraw__hardReset?.(),\n}\n\n/** @public */\nexport function setRuntimeOverrides(input: Partial<typeof runtime>) {\n\tObject.assign(runtime, input)\n}\n", "import { runtime } from './runtime'\n\n/** @public */\nexport function hardResetEditor() {\n\truntime.hardReset()\n}\n", "import { runtime } from './runtime'\n\n/** @public */\nexport function refreshPage() {\n\truntime.refreshPage()\n}\n", "export { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\nexport let nanoid = (size = 21) =>\n  crypto.getRandomValues(new Uint8Array(size)).reduce((id, byte) => {\n    byte &= 63\n    if (byte < 36) {\n      id += byte.toString(36)\n    } else if (byte < 62) {\n      id += (byte - 26).toString(36).toUpperCase()\n    } else if (byte > 62) {\n      id += '-'\n    } else {\n      id += '_'\n    }\n    return id\n  }, '')\n", "import { nanoid } from 'nanoid'\n\n/**\n * Generate a unique id.\n *\n * @example\n *\n * ```ts\n * const id = uniqueId()\n * ```\n *\n * @public\n */\nexport function uniqueId() {\n\treturn nanoid()\n}\n", "import { atom } from '@tldraw/state'\nimport { getDefaultTranslationLocale } from '@tldraw/tlschema'\nimport { getFromLocalStorage, setInLocalStorage, structuredClone } from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { uniqueId } from '../utils/uniqueId'\n\nconst USER_DATA_KEY = 'TLDRAW_USER_DATA_v3'\n\n/**\n * A user of tldraw\n *\n * @public\n */\nexport interface TLUserPreferences {\n\tid: string\n\tname?: string | null\n\tlocale?: string | null\n\tcolor?: string | null\n\tanimationSpeed?: number | null\n\tedgeScrollSpeed?: number | null\n\tisDarkMode?: boolean | null\n\tisSnapMode?: boolean | null\n\tisWrapMode?: boolean | null\n}\n\ninterface UserDataSnapshot {\n\tversion: number\n\tuser: TLUserPreferences\n}\n\ninterface UserChangeBroadcastMessage {\n\ttype: typeof broadcastEventKey\n\torigin: string\n\tdata: UserDataSnapshot\n}\n\nconst userTypeValidator: T.Validator<TLUserPreferences> = T.object<TLUserPreferences>({\n\tid: T.string,\n\tname: T.string.nullable().optional(),\n\tlocale: T.string.nullable().optional(),\n\tcolor: T.string.nullable().optional(),\n\tisDarkMode: T.boolean.nullable().optional(),\n\tanimationSpeed: T.number.nullable().optional(),\n\tedgeScrollSpeed: T.number.nullable().optional(),\n\tisSnapMode: T.boolean.nullable().optional(),\n\tisWrapMode: T.boolean.nullable().optional(),\n})\n\nconst Versions = {\n\tAddAnimationSpeed: 1,\n\tAddIsSnapMode: 2,\n\tMakeFieldsNullable: 3,\n\tAddEdgeScrollSpeed: 4,\n\tAddExcalidrawSelectMode: 5,\n} as const\n\nconst CURRENT_VERSION = Math.max(...Object.values(Versions))\n\nfunction migrateSnapshot(data: { version: number; user: any }) {\n\tif (data.version < Versions.AddAnimationSpeed) {\n\t\tdata.user.animationSpeed = 1\n\t}\n\tif (data.version < Versions.AddIsSnapMode) {\n\t\tdata.user.isSnapMode = false\n\t}\n\tif (data.version < Versions.MakeFieldsNullable) {\n\t\t// noop\n\t}\n\tif (data.version < Versions.AddEdgeScrollSpeed) {\n\t\tdata.user.edgeScrollSpeed = 1\n\t}\n\tif (data.version < Versions.AddExcalidrawSelectMode) {\n\t\tdata.user.isWrapMode = false\n\t}\n\n\t// finally\n\tdata.version = CURRENT_VERSION\n}\n\n/** @internal */\nexport const USER_COLORS = [\n\t'#FF802B',\n\t'#EC5E41',\n\t'#F2555A',\n\t'#F04F88',\n\t'#E34BA9',\n\t'#BD54C6',\n\t'#9D5BD2',\n\t'#7B66DC',\n\t'#02B1CC',\n\t'#11B3A3',\n\t'#39B178',\n\t'#55B467',\n] as const\n\nfunction getRandomColor() {\n\treturn USER_COLORS[Math.floor(Math.random() * USER_COLORS.length)]\n}\n\n/** @internal */\nexport function userPrefersDarkUI() {\n\tif (typeof window === 'undefined') {\n\t\treturn false\n\t}\n\treturn window.matchMedia?.('(prefers-color-scheme: dark)')?.matches ?? false\n}\n\n/** @internal */\nexport function userPrefersReducedMotion() {\n\tif (typeof window === 'undefined') {\n\t\treturn false\n\t}\n\treturn window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches ?? false\n}\n\n/** @public */\nexport const defaultUserPreferences = Object.freeze({\n\tname: 'New User',\n\tlocale: getDefaultTranslationLocale(),\n\tcolor: getRandomColor(),\n\tisDarkMode: false,\n\tedgeScrollSpeed: 1,\n\tanimationSpeed: userPrefersReducedMotion() ? 0 : 1,\n\tisSnapMode: false,\n\tisWrapMode: false,\n}) satisfies Readonly<Omit<TLUserPreferences, 'id'>>\n\n/** @public */\nexport function getFreshUserPreferences(): TLUserPreferences {\n\treturn {\n\t\tid: uniqueId(),\n\t}\n}\n\nfunction migrateUserPreferences(userData: unknown): TLUserPreferences {\n\tif (userData === null || typeof userData !== 'object') {\n\t\treturn getFreshUserPreferences()\n\t}\n\n\tif (!('version' in userData) || !('user' in userData) || typeof userData.version !== 'number') {\n\t\treturn getFreshUserPreferences()\n\t}\n\n\tconst snapshot = structuredClone(userData) as any\n\n\tmigrateSnapshot(snapshot)\n\n\ttry {\n\t\treturn userTypeValidator.validate(snapshot.user)\n\t} catch (e) {\n\t\treturn getFreshUserPreferences()\n\t}\n}\n\nfunction loadUserPreferences(): TLUserPreferences {\n\tconst userData = (JSON.parse(getFromLocalStorage(USER_DATA_KEY) || 'null') ??\n\t\tnull) as null | UserDataSnapshot\n\n\treturn migrateUserPreferences(userData)\n}\n\nconst globalUserPreferences = atom<TLUserPreferences | null>('globalUserData', null)\n\nfunction storeUserPreferences() {\n\tsetInLocalStorage(\n\t\tUSER_DATA_KEY,\n\t\tJSON.stringify({\n\t\t\tversion: CURRENT_VERSION,\n\t\t\tuser: globalUserPreferences.get(),\n\t\t})\n\t)\n}\n\n/** @public */\nexport function setUserPreferences(user: TLUserPreferences) {\n\tuserTypeValidator.validate(user)\n\tglobalUserPreferences.set(user)\n\tstoreUserPreferences()\n\tbroadcastUserPreferencesChange()\n}\n\nconst isTest = typeof process !== 'undefined' && process.env.NODE_ENV === 'test'\n\nconst channel =\n\ttypeof BroadcastChannel !== 'undefined' && !isTest\n\t\t? new BroadcastChannel('tldraw-user-sync')\n\t\t: null\n\nchannel?.addEventListener('message', (e) => {\n\tconst data = e.data as undefined | UserChangeBroadcastMessage\n\tif (data?.type === broadcastEventKey && data?.origin !== getBroadcastOrigin()) {\n\t\tglobalUserPreferences.set(migrateUserPreferences(data.data))\n\t}\n})\n\nlet _broadcastOrigin = null as null | string\nfunction getBroadcastOrigin() {\n\tif (_broadcastOrigin === null) {\n\t\t_broadcastOrigin = uniqueId()\n\t}\n\treturn _broadcastOrigin\n}\nconst broadcastEventKey = 'tldraw-user-preferences-change' as const\n\nfunction broadcastUserPreferencesChange() {\n\tchannel?.postMessage({\n\t\ttype: broadcastEventKey,\n\t\torigin: getBroadcastOrigin(),\n\t\tdata: {\n\t\t\tuser: getUserPreferences(),\n\t\t\tversion: CURRENT_VERSION,\n\t\t},\n\t} satisfies UserChangeBroadcastMessage)\n}\n\n/** @public */\nexport function getUserPreferences(): TLUserPreferences {\n\tlet prefs = globalUserPreferences.get()\n\tif (!prefs) {\n\t\tprefs = loadUserPreferences()\n\t\tglobalUserPreferences.set(prefs)\n\t}\n\treturn prefs\n}\n", "import { Signal, computed } from '@tldraw/state'\nimport { TLInstancePresence, TLStore } from '@tldraw/tlschema'\nimport { TLUserPreferences, getUserPreferences, setUserPreferences } from './TLUserPreferences'\n\n/** @public */\nexport interface TLUser {\n\treadonly derivePresenceState: (store: TLStore) => Signal<TLInstancePresence | null>\n\treadonly userPreferences: Signal<TLUserPreferences>\n\treadonly setUserPreferences: (userPreferences: TLUserPreferences) => void\n}\n\n/** @public */\nexport function createTLUser(\n\topts = {} as {\n\t\t/** @internal */\n\t\tderivePresenceState?: (store: TLStore) => Signal<TLInstancePresence | null>\n\t\tuserPreferences?: Signal<TLUserPreferences>\n\t\tsetUserPreferences?: (userPreferences: TLUserPreferences) => void\n\t}\n): TLUser {\n\treturn {\n\t\tderivePresenceState: opts.derivePresenceState ?? (() => computed('presence', () => null)),\n\t\tuserPreferences:\n\t\t\topts.userPreferences ?? computed('userPreferences', () => getUserPreferences()),\n\t\tsetUserPreferences: opts.setUserPreferences ?? setUserPreferences,\n\t}\n}\n", "import { EMPTY_ARRAY, atom, computed, transact } from '@tldraw/state'\nimport { ComputedCache, RecordType, StoreSnapshot } from '@tldraw/store'\nimport {\n\tCameraRecordType,\n\tInstancePageStateRecordType,\n\tPageRecordType,\n\tStyleProp,\n\tStylePropValue,\n\tTLArrowShape,\n\tTLAsset,\n\tTLAssetId,\n\tTLAssetPartial,\n\tTLCursor,\n\tTLCursorType,\n\tTLDOCUMENT_ID,\n\tTLDocument,\n\tTLFrameShape,\n\tTLGeoShape,\n\tTLGroupShape,\n\tTLHandle,\n\tTLINSTANCE_ID,\n\tTLImageAsset,\n\tTLInstance,\n\tTLInstancePageState,\n\tTLPOINTER_ID,\n\tTLPage,\n\tTLPageId,\n\tTLParentId,\n\tTLRecord,\n\tTLShape,\n\tTLShapeId,\n\tTLShapePartial,\n\tTLStore,\n\tTLUnknownShape,\n\tTLVideoAsset,\n\tcreateShapeId,\n\tgetShapePropKeysByStyle,\n\tisPageId,\n\tisShapeId,\n} from '@tldraw/tlschema'\nimport {\n\tIndexKey,\n\tJsonObject,\n\tannotateError,\n\tassert,\n\tcompact,\n\tdedupe,\n\tgetIndexAbove,\n\tgetIndexBetween,\n\tgetIndices,\n\tgetIndicesAbove,\n\tgetIndicesBetween,\n\tgetOwnProperty,\n\thasOwnProperty,\n\tobjectMapValues,\n\tsortById,\n\tsortByIndex,\n\tstructuredClone,\n} from '@tldraw/utils'\nimport { EventEmitter } from 'eventemitter3'\nimport { flushSync } from 'react-dom'\nimport { createRoot } from 'react-dom/client'\nimport { TLUser, createTLUser } from '../config/createTLUser'\nimport { checkShapesAndAddCore } from '../config/defaultShapes'\nimport {\n\tANIMATION_MEDIUM_MS,\n\tCAMERA_MOVING_TIMEOUT,\n\tCAMERA_SLIDE_FRICTION,\n\tCOARSE_DRAG_DISTANCE,\n\tCOLLABORATOR_IDLE_TIMEOUT,\n\tDEFAULT_ANIMATION_OPTIONS,\n\tDRAG_DISTANCE,\n\tFOLLOW_CHASE_PAN_SNAP,\n\tFOLLOW_CHASE_PAN_UNSNAP,\n\tFOLLOW_CHASE_PROPORTION,\n\tFOLLOW_CHASE_ZOOM_SNAP,\n\tFOLLOW_CHASE_ZOOM_UNSNAP,\n\tHIT_TEST_MARGIN,\n\tINTERNAL_POINTER_IDS,\n\tLONG_PRESS_DURATION,\n\tMAX_PAGES,\n\tMAX_SHAPES_PER_PAGE,\n\tMAX_ZOOM,\n\tMIN_ZOOM,\n\tZOOMS,\n} from '../constants'\nimport { Box } from '../primitives/Box'\nimport { Mat, MatLike, MatModel } from '../primitives/Mat'\nimport { Vec, VecLike } from '../primitives/Vec'\nimport { EASINGS } from '../primitives/easings'\nimport { Geometry2d } from '../primitives/geometry/Geometry2d'\nimport { Group2d } from '../primitives/geometry/Group2d'\nimport { intersectPolygonPolygon } from '../primitives/intersect'\nimport { PI2, approximately, areAnglesCompatible, clamp, pointInPolygon } from '../primitives/utils'\nimport { ReadonlySharedStyleMap, SharedStyle, SharedStyleMap } from '../utils/SharedStylesMap'\nimport { WeakMapCache } from '../utils/WeakMapCache'\nimport { dataUrlToFile } from '../utils/assets'\nimport { getIncrementedName } from '../utils/getIncrementedName'\nimport { getReorderingShapesChanges } from '../utils/reorderShapes'\nimport { applyRotationToSnapshotShapes, getRotationSnapshot } from '../utils/rotation'\nimport { uniqueId } from '../utils/uniqueId'\nimport { arrowBindingsIndex } from './derivations/arrowBindingsIndex'\nimport { notVisibleShapes } from './derivations/notVisibleShapes'\nimport { parentsToChildren } from './derivations/parentsToChildren'\nimport { deriveShapeIdsInCurrentPage } from './derivations/shapeIdsInCurrentPage'\nimport { getSvgJsx } from './getSvgJsx'\nimport { ClickManager } from './managers/ClickManager'\nimport { EnvironmentManager } from './managers/EnvironmentManager'\nimport { HistoryManager } from './managers/HistoryManager'\nimport { ScribbleManager } from './managers/ScribbleManager'\nimport { SideEffectManager } from './managers/SideEffectManager'\nimport { SnapManager } from './managers/SnapManager/SnapManager'\nimport { TextManager } from './managers/TextManager'\nimport { TickManager } from './managers/TickManager'\nimport { UserPreferencesManager } from './managers/UserPreferencesManager'\nimport { ShapeUtil, TLResizeMode, TLShapeUtilConstructor } from './shapes/ShapeUtil'\nimport { TLArrowInfo } from './shapes/shared/arrow/arrow-types'\nimport { getCurvedArrowInfo } from './shapes/shared/arrow/curved-arrow'\nimport { getArrowTerminalsInArrowSpace, getIsArrowStraight } from './shapes/shared/arrow/shared'\nimport { getStraightArrowInfo } from './shapes/shared/arrow/straight-arrow'\nimport { RootState } from './tools/RootState'\nimport { StateNode, TLStateNodeConstructor } from './tools/StateNode'\nimport { TLContent } from './types/clipboard-types'\nimport { TLEventMap } from './types/emit-types'\nimport {\n\tTLEventInfo,\n\tTLPinchEventInfo,\n\tTLPointerEventInfo,\n\tTLWheelEventInfo,\n} from './types/event-types'\nimport { TLExternalAssetContent, TLExternalContent } from './types/external-content'\nimport { TLCommandHistoryOptions } from './types/history-types'\nimport { OptionalKeys, RequiredKeys, TLSvgOptions } from './types/misc-types'\nimport { TLResizeHandle } from './types/selection-types'\n\n/** @public */\nexport type TLAnimationOptions = Partial<{\n\tduration: number\n\teasing: (t: number) => number\n}>\n\n/** @public */\nexport type TLResizeShapeOptions = Partial<{\n\tinitialBounds: Box\n\tscaleOrigin: VecLike\n\tscaleAxisRotation: number\n\tinitialShape: TLShape\n\tinitialPageTransform: MatLike\n\tdragHandle: TLResizeHandle\n\tmode: TLResizeMode\n}>\n\n/** @public */\nexport interface TLEditorOptions {\n\t/**\n\t * The Store instance to use for keeping the app's data. This may be prepopulated, e.g. by loading\n\t * from a server or database.\n\t */\n\tstore: TLStore\n\t/**\n\t * An array of shapes to use in the editor. These will be used to create and manage shapes in the editor.\n\t */\n\tshapeUtils: readonly TLShapeUtilConstructor<TLUnknownShape>[]\n\t/**\n\t * An array of tools to use in the editor. These will be used to handle events and manage user interactions in the editor.\n\t */\n\ttools: readonly TLStateNodeConstructor[]\n\t/**\n\t * Should return a containing html element which has all the styles applied to the editor. If not\n\t * given, the body element will be used.\n\t */\n\tgetContainer: () => HTMLElement\n\t/**\n\t * A user defined externally to replace the default user.\n\t */\n\tuser?: TLUser\n\t/**\n\t * The editor's initial active tool (or other state node id).\n\t */\n\tinitialState?: string\n\t/**\n\t * Whether to infer dark mode from the user's system preferences. Defaults to false.\n\t */\n\tinferDarkMode?: boolean\n}\n\n/** @public */\nexport class Editor extends EventEmitter<TLEventMap> {\n\tconstructor({\n\t\tstore,\n\t\tuser,\n\t\tshapeUtils,\n\t\ttools,\n\t\tgetContainer,\n\t\tinitialState,\n\t\tinferDarkMode,\n\t}: TLEditorOptions) {\n\t\tsuper()\n\n\t\tthis.store = store\n\n\t\tthis.snaps = new SnapManager(this)\n\n\t\tthis.user = new UserPreferencesManager(user ?? createTLUser(), inferDarkMode ?? false)\n\n\t\tthis.getContainer = getContainer ?? (() => document.body)\n\n\t\tthis.textMeasure = new TextManager(this)\n\t\tthis._tickManager = new TickManager(this)\n\n\t\tclass NewRoot extends RootState {\n\t\t\tstatic override initial = initialState ?? ''\n\t\t}\n\n\t\tthis.root = new NewRoot(this)\n\t\tthis.root.children = {}\n\n\t\tconst allShapeUtils = checkShapesAndAddCore(shapeUtils)\n\n\t\tconst _shapeUtils = {} as Record<string, ShapeUtil<any>>\n\t\tconst _styleProps = {} as Record<string, Map<StyleProp<unknown>, string>>\n\t\tconst allStylesById = new Map<string, StyleProp<unknown>>()\n\n\t\tfor (const Util of allShapeUtils) {\n\t\t\tconst util = new Util(this)\n\t\t\t_shapeUtils[Util.type] = util\n\n\t\t\tconst propKeysByStyle = getShapePropKeysByStyle(Util.props ?? {})\n\t\t\t_styleProps[Util.type] = propKeysByStyle\n\n\t\t\tfor (const style of propKeysByStyle.keys()) {\n\t\t\t\tif (!allStylesById.has(style.id)) {\n\t\t\t\t\tallStylesById.set(style.id, style)\n\t\t\t\t} else if (allStylesById.get(style.id) !== style) {\n\t\t\t\t\tthrow Error(\n\t\t\t\t\t\t`Multiple style props with id \"${style.id}\" in use. Style prop IDs must be unique.`\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.shapeUtils = _shapeUtils\n\t\tthis.styleProps = _styleProps\n\n\t\t// Tools.\n\t\t// Accept tools from constructor parameters which may not conflict with the root note's default or\n\t\t// \"baked in\" tools, select and zoom.\n\t\tfor (const Tool of [...tools]) {\n\t\t\tif (hasOwnProperty(this.root.children!, Tool.id)) {\n\t\t\t\tthrow Error(`Can't override tool with id \"${Tool.id}\"`)\n\t\t\t}\n\t\t\tthis.root.children![Tool.id] = new Tool(this, this.root)\n\t\t}\n\n\t\tthis.environment = new EnvironmentManager(this)\n\t\tthis.scribbles = new ScribbleManager(this)\n\n\t\t// Cleanup\n\n\t\tconst invalidParents = new Set<TLShapeId>()\n\n\t\tconst reparentArrow = (arrowId: TLArrowShape['id']) => {\n\t\t\tconst arrow = this.getShape<TLArrowShape>(arrowId)\n\t\t\tif (!arrow) return\n\t\t\tconst { start, end } = arrow.props\n\t\t\tconst startShape = start.type === 'binding' ? this.getShape(start.boundShapeId) : undefined\n\t\t\tconst endShape = end.type === 'binding' ? this.getShape(end.boundShapeId) : undefined\n\n\t\t\tconst parentPageId = this.getAncestorPageId(arrow)\n\t\t\tif (!parentPageId) return\n\n\t\t\tlet nextParentId: TLParentId\n\t\t\tif (startShape && endShape) {\n\t\t\t\t// if arrow has two bindings, always parent arrow to closest common ancestor of the bindings\n\t\t\t\tnextParentId = this.findCommonAncestor([startShape, endShape]) ?? parentPageId\n\t\t\t} else if (startShape || endShape) {\n\t\t\t\tconst bindingParentId = (startShape || endShape)?.parentId\n\t\t\t\t// If the arrow and the shape that it is bound to have the same parent, then keep that parent\n\t\t\t\tif (bindingParentId && bindingParentId === arrow.parentId) {\n\t\t\t\t\tnextParentId = arrow.parentId\n\t\t\t\t} else {\n\t\t\t\t\t// if arrow has one binding, keep arrow on its own page\n\t\t\t\t\tnextParentId = parentPageId\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (nextParentId && nextParentId !== arrow.parentId) {\n\t\t\t\tthis.reparentShapes([arrowId], nextParentId)\n\t\t\t}\n\n\t\t\tconst reparentedArrow = this.getShape<TLArrowShape>(arrowId)\n\t\t\tif (!reparentedArrow) throw Error('no reparented arrow')\n\n\t\t\tconst startSibling = this.getShapeNearestSibling(reparentedArrow, startShape)\n\t\t\tconst endSibling = this.getShapeNearestSibling(reparentedArrow, endShape)\n\n\t\t\tlet highestSibling: TLShape | undefined\n\n\t\t\tif (startSibling && endSibling) {\n\t\t\t\thighestSibling = startSibling.index > endSibling.index ? startSibling : endSibling\n\t\t\t} else if (startSibling && !endSibling) {\n\t\t\t\thighestSibling = startSibling\n\t\t\t} else if (endSibling && !startSibling) {\n\t\t\t\thighestSibling = endSibling\n\t\t\t} else {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tlet finalIndex: IndexKey\n\n\t\t\tconst higherSiblings = this.getSortedChildIdsForParent(highestSibling.parentId)\n\t\t\t\t.map((id) => this.getShape(id)!)\n\t\t\t\t.filter((sibling) => sibling.index > highestSibling!.index)\n\n\t\t\tif (higherSiblings.length) {\n\t\t\t\t// there are siblings above the highest bound sibling, we need to\n\t\t\t\t// insert between them.\n\n\t\t\t\t// if the next sibling is also a bound arrow though, we can end up\n\t\t\t\t// all fighting for the same indexes. so lets find the next\n\t\t\t\t// non-arrow sibling...\n\t\t\t\tconst nextHighestNonArrowSibling = higherSiblings.find(\n\t\t\t\t\t(sibling) => sibling.type !== 'arrow'\n\t\t\t\t)\n\n\t\t\t\tif (\n\t\t\t\t\t// ...then, if we're above the last shape we want to be above...\n\t\t\t\t\treparentedArrow.index > highestSibling.index &&\n\t\t\t\t\t// ...but below the next non-arrow sibling...\n\t\t\t\t\t(!nextHighestNonArrowSibling || reparentedArrow.index < nextHighestNonArrowSibling.index)\n\t\t\t\t) {\n\t\t\t\t\t// ...then we're already in the right place. no need to update!\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// otherwise, we need to find the index between the highest sibling\n\t\t\t\t// we want to be above, and the next highest sibling we want to be\n\t\t\t\t// below:\n\t\t\t\tfinalIndex = getIndexBetween(highestSibling.index, higherSiblings[0].index)\n\t\t\t} else {\n\t\t\t\t// if there are no siblings above us, we can just get the next index:\n\t\t\t\tfinalIndex = getIndexAbove(highestSibling.index)\n\t\t\t}\n\n\t\t\tif (finalIndex !== reparentedArrow.index) {\n\t\t\t\tthis.updateShapes<TLArrowShape>([{ id: arrowId, type: 'arrow', index: finalIndex }])\n\t\t\t}\n\t\t}\n\n\t\tconst unbindArrowTerminal = (arrow: TLArrowShape, handleId: 'start' | 'end') => {\n\t\t\tconst { x, y } = getArrowTerminalsInArrowSpace(this, arrow)[handleId]\n\t\t\tthis.store.put([{ ...arrow, props: { ...arrow.props, [handleId]: { type: 'point', x, y } } }])\n\t\t}\n\n\t\tconst arrowDidUpdate = (arrow: TLArrowShape) => {\n\t\t\t// if the shape is an arrow and its bound shape is on another page\n\t\t\t// or was deleted, unbind it\n\t\t\tfor (const handle of ['start', 'end'] as const) {\n\t\t\t\tconst terminal = arrow.props[handle]\n\t\t\t\tif (terminal.type !== 'binding') continue\n\t\t\t\tconst boundShape = this.getShape(terminal.boundShapeId)\n\t\t\t\tconst isShapeInSamePageAsArrow =\n\t\t\t\t\tthis.getAncestorPageId(arrow) === this.getAncestorPageId(boundShape)\n\t\t\t\tif (!boundShape || !isShapeInSamePageAsArrow) {\n\t\t\t\t\tunbindArrowTerminal(arrow, handle)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// always check the arrow parents\n\t\t\treparentArrow(arrow.id)\n\t\t}\n\n\t\tconst cleanupInstancePageState = (\n\t\t\tprevPageState: TLInstancePageState,\n\t\t\tshapesNoLongerInPage: Set<TLShapeId>\n\t\t) => {\n\t\t\tlet nextPageState = null as null | TLInstancePageState\n\n\t\t\tconst selectedShapeIds = prevPageState.selectedShapeIds.filter(\n\t\t\t\t(id) => !shapesNoLongerInPage.has(id)\n\t\t\t)\n\t\t\tif (selectedShapeIds.length !== prevPageState.selectedShapeIds.length) {\n\t\t\t\tif (!nextPageState) nextPageState = { ...prevPageState }\n\t\t\t\tnextPageState.selectedShapeIds = selectedShapeIds\n\t\t\t}\n\n\t\t\tconst erasingShapeIds = prevPageState.erasingShapeIds.filter(\n\t\t\t\t(id) => !shapesNoLongerInPage.has(id)\n\t\t\t)\n\t\t\tif (erasingShapeIds.length !== prevPageState.erasingShapeIds.length) {\n\t\t\t\tif (!nextPageState) nextPageState = { ...prevPageState }\n\t\t\t\tnextPageState.erasingShapeIds = erasingShapeIds\n\t\t\t}\n\n\t\t\tif (prevPageState.hoveredShapeId && shapesNoLongerInPage.has(prevPageState.hoveredShapeId)) {\n\t\t\t\tif (!nextPageState) nextPageState = { ...prevPageState }\n\t\t\t\tnextPageState.hoveredShapeId = null\n\t\t\t}\n\n\t\t\tif (prevPageState.editingShapeId && shapesNoLongerInPage.has(prevPageState.editingShapeId)) {\n\t\t\t\tif (!nextPageState) nextPageState = { ...prevPageState }\n\t\t\t\tnextPageState.editingShapeId = null\n\t\t\t}\n\n\t\t\tconst hintingShapeIds = prevPageState.hintingShapeIds.filter(\n\t\t\t\t(id) => !shapesNoLongerInPage.has(id)\n\t\t\t)\n\t\t\tif (hintingShapeIds.length !== prevPageState.hintingShapeIds.length) {\n\t\t\t\tif (!nextPageState) nextPageState = { ...prevPageState }\n\t\t\t\tnextPageState.hintingShapeIds = hintingShapeIds\n\t\t\t}\n\n\t\t\tif (prevPageState.focusedGroupId && shapesNoLongerInPage.has(prevPageState.focusedGroupId)) {\n\t\t\t\tif (!nextPageState) nextPageState = { ...prevPageState }\n\t\t\t\tnextPageState.focusedGroupId = null\n\t\t\t}\n\t\t\treturn nextPageState\n\t\t}\n\n\t\tthis.sideEffects = new SideEffectManager(this)\n\n\t\tthis.sideEffects.registerBatchCompleteHandler(() => {\n\t\t\tfor (const parentId of invalidParents) {\n\t\t\t\tinvalidParents.delete(parentId)\n\t\t\t\tconst parent = this.getShape(parentId)\n\t\t\t\tif (!parent) continue\n\n\t\t\t\tconst util = this.getShapeUtil(parent)\n\t\t\t\tconst changes = util.onChildrenChange?.(parent)\n\n\t\t\t\tif (changes?.length) {\n\t\t\t\t\tthis.updateShapes(changes, { squashing: true })\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.emit('update')\n\t\t})\n\n\t\tthis.sideEffects.registerBeforeDeleteHandler('shape', (record) => {\n\t\t\t// if the deleted shape has a parent shape make sure we call it's onChildrenChange callback\n\t\t\tif (record.parentId && isShapeId(record.parentId)) {\n\t\t\t\tinvalidParents.add(record.parentId)\n\t\t\t}\n\t\t\t// clean up any arrows bound to this shape\n\t\t\tconst bindings = this._getArrowBindingsIndex().get()[record.id]\n\t\t\tif (bindings?.length) {\n\t\t\t\tfor (const { arrowId, handleId } of bindings) {\n\t\t\t\t\tconst arrow = this.getShape<TLArrowShape>(arrowId)\n\t\t\t\t\tif (!arrow) continue\n\t\t\t\t\tunbindArrowTerminal(arrow, handleId)\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst deletedIds = new Set([record.id])\n\t\t\tconst updates = compact(\n\t\t\t\tthis.getPageStates().map((pageState) => {\n\t\t\t\t\treturn cleanupInstancePageState(pageState, deletedIds)\n\t\t\t\t})\n\t\t\t)\n\n\t\t\tif (updates.length) {\n\t\t\t\tthis.store.put(updates)\n\t\t\t}\n\t\t})\n\n\t\tthis.sideEffects.registerBeforeDeleteHandler('page', (record) => {\n\t\t\t// page was deleted, need to check whether it's the current page and select another one if so\n\t\t\tif (this.getInstanceState().currentPageId !== record.id) return\n\n\t\t\tconst backupPageId = this.getPages().find((p) => p.id !== record.id)?.id\n\t\t\tif (!backupPageId) return\n\t\t\tthis.store.put([{ ...this.getInstanceState(), currentPageId: backupPageId }])\n\n\t\t\t// delete the camera and state for the page if necessary\n\t\t\tconst cameraId = CameraRecordType.createId(record.id)\n\t\t\tconst instance_PageStateId = InstancePageStateRecordType.createId(record.id)\n\t\t\tthis.store.remove([cameraId, instance_PageStateId])\n\t\t})\n\n\t\tthis.sideEffects.registerAfterChangeHandler('shape', (prev, next) => {\n\t\t\tif (this.isShapeOfType<TLArrowShape>(next, 'arrow')) {\n\t\t\t\tarrowDidUpdate(next)\n\t\t\t}\n\n\t\t\t// if the shape's parent changed and it is bound to an arrow, update the arrow's parent\n\t\t\tif (prev.parentId !== next.parentId) {\n\t\t\t\tconst reparentBoundArrows = (id: TLShapeId) => {\n\t\t\t\t\tconst boundArrows = this._getArrowBindingsIndex().get()[id]\n\t\t\t\t\tif (boundArrows?.length) {\n\t\t\t\t\t\tfor (const arrow of boundArrows) {\n\t\t\t\t\t\t\treparentArrow(arrow.arrowId)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treparentBoundArrows(next.id)\n\t\t\t\tthis.visitDescendants(next.id, reparentBoundArrows)\n\t\t\t}\n\n\t\t\t// if this shape moved to a new page, clean up any previous page's instance state\n\t\t\tif (prev.parentId !== next.parentId && isPageId(next.parentId)) {\n\t\t\t\tconst allMovingIds = new Set([prev.id])\n\t\t\t\tthis.visitDescendants(prev.id, (id) => {\n\t\t\t\t\tallMovingIds.add(id)\n\t\t\t\t})\n\n\t\t\t\tfor (const instancePageState of this.getPageStates()) {\n\t\t\t\t\tif (instancePageState.pageId === next.parentId) continue\n\t\t\t\t\tconst nextPageState = cleanupInstancePageState(instancePageState, allMovingIds)\n\n\t\t\t\t\tif (nextPageState) {\n\t\t\t\t\t\tthis.store.put([nextPageState])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (prev.parentId && isShapeId(prev.parentId)) {\n\t\t\t\tinvalidParents.add(prev.parentId)\n\t\t\t}\n\n\t\t\tif (next.parentId !== prev.parentId && isShapeId(next.parentId)) {\n\t\t\t\tinvalidParents.add(next.parentId)\n\t\t\t}\n\t\t})\n\n\t\tthis.sideEffects.registerAfterChangeHandler('instance_page_state', (prev, next) => {\n\t\t\tif (prev?.selectedShapeIds !== next?.selectedShapeIds) {\n\t\t\t\t// ensure that descendants and ancestors are not selected at the same time\n\t\t\t\tconst filtered = next.selectedShapeIds.filter((id) => {\n\t\t\t\t\tlet parentId = this.getShape(id)?.parentId\n\t\t\t\t\twhile (isShapeId(parentId)) {\n\t\t\t\t\t\tif (next.selectedShapeIds.includes(parentId)) {\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparentId = this.getShape(parentId)?.parentId\n\t\t\t\t\t}\n\t\t\t\t\treturn true\n\t\t\t\t})\n\n\t\t\t\tlet nextFocusedGroupId: null | TLShapeId = null\n\n\t\t\t\tif (filtered.length > 0) {\n\t\t\t\t\tconst commonGroupAncestor = this.findCommonAncestor(\n\t\t\t\t\t\tcompact(filtered.map((id) => this.getShape(id))),\n\t\t\t\t\t\t(shape) => this.isShapeOfType<TLGroupShape>(shape, 'group')\n\t\t\t\t\t)\n\n\t\t\t\t\tif (commonGroupAncestor) {\n\t\t\t\t\t\tnextFocusedGroupId = commonGroupAncestor\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (next?.focusedGroupId) {\n\t\t\t\t\t\tnextFocusedGroupId = next.focusedGroupId\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tfiltered.length !== next.selectedShapeIds.length ||\n\t\t\t\t\tnextFocusedGroupId !== next.focusedGroupId\n\t\t\t\t) {\n\t\t\t\t\tthis.store.put([\n\t\t\t\t\t\t{ ...next, selectedShapeIds: filtered, focusedGroupId: nextFocusedGroupId ?? null },\n\t\t\t\t\t])\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tthis.sideEffects.registerAfterCreateHandler('shape', (record) => {\n\t\t\tif (this.isShapeOfType<TLArrowShape>(record, 'arrow')) {\n\t\t\t\tarrowDidUpdate(record)\n\t\t\t}\n\t\t})\n\n\t\tthis.sideEffects.registerAfterCreateHandler('page', (record) => {\n\t\t\tconst cameraId = CameraRecordType.createId(record.id)\n\t\t\tconst _pageStateId = InstancePageStateRecordType.createId(record.id)\n\t\t\tif (!this.store.has(cameraId)) {\n\t\t\t\tthis.store.put([CameraRecordType.create({ id: cameraId })])\n\t\t\t}\n\t\t\tif (!this.store.has(_pageStateId)) {\n\t\t\t\tthis.store.put([\n\t\t\t\t\tInstancePageStateRecordType.create({ id: _pageStateId, pageId: record.id }),\n\t\t\t\t])\n\t\t\t}\n\t\t})\n\n\t\tthis._currentPageShapeIds = deriveShapeIdsInCurrentPage(this.store, () =>\n\t\t\tthis.getCurrentPageId()\n\t\t)\n\t\tthis._parentIdsToChildIds = parentsToChildren(this.store)\n\n\t\tthis.disposables.add(\n\t\t\tthis.store.listen((changes) => {\n\t\t\t\tthis.emit('change', changes)\n\t\t\t})\n\t\t)\n\n\t\tthis.store.ensureStoreIsUsable()\n\n\t\t// clear ephemeral state\n\t\tthis._setInstancePageState(\n\t\t\t{\n\t\t\t\teditingShapeId: null,\n\t\t\t\thoveredShapeId: null,\n\t\t\t\terasingShapeIds: [],\n\t\t\t},\n\t\t\t{ ephemeral: true }\n\t\t)\n\n\t\tif (initialState && this.root.children[initialState] === undefined) {\n\t\t\tthrow Error(`No state found for initialState \"${initialState}\".`)\n\t\t}\n\n\t\tthis.root.enter(undefined, 'initial')\n\n\t\tif (this.getInstanceState().followingUserId) {\n\t\t\tthis.stopFollowingUser()\n\t\t}\n\n\t\tthis.updateRenderingBounds()\n\n\t\tthis.on('tick', this._flushEventsForTick)\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis._tickManager.start()\n\t\t})\n\t}\n\n\t/**\n\t * The editor's store\n\t *\n\t * @public\n\t */\n\treadonly store: TLStore\n\n\t/**\n\t * The root state of the statechart.\n\t *\n\t * @public\n\t */\n\treadonly root: RootState\n\n\t/**\n\t * A set of functions to call when the app is disposed.\n\t *\n\t * @public\n\t */\n\treadonly disposables = new Set<() => void>()\n\n\t/** @internal */\n\tprivate readonly _tickManager\n\n\t/**\n\t * A manager for the app's snapping feature.\n\t *\n\t * @public\n\t */\n\treadonly snaps: SnapManager\n\n\t/**\n\t * A manager for the user and their preferences.\n\t *\n\t * @public\n\t */\n\treadonly user: UserPreferencesManager\n\n\t/**\n\t * A helper for measuring text.\n\t *\n\t * @public\n\t */\n\treadonly textMeasure: TextManager\n\n\t/**\n\t * A manager for the editor's environment.\n\t *\n\t * @public\n\t */\n\treadonly environment: EnvironmentManager\n\n\t/**\n\t * A manager for the editor's scribbles.\n\t *\n\t * @public\n\t */\n\treadonly scribbles: ScribbleManager\n\n\t/**\n\t * The current HTML element containing the editor.\n\t *\n\t * @example\n\t * ```ts\n\t * const container = editor.getContainer()\n\t * ```\n\t *\n\t * @public\n\t */\n\tgetContainer: () => HTMLElement\n\n\t/**\n\t * A manager for side effects and correct state enforcement. See {@link SideEffectManager} for details.\n\t *\n\t * @public\n\t */\n\treadonly sideEffects: SideEffectManager<this>\n\n\t/**\n\t * Dispose the editor.\n\t *\n\t * @public\n\t */\n\tdispose() {\n\t\tthis.disposables.forEach((dispose) => dispose())\n\t\tthis.disposables.clear()\n\t}\n\n\t/* ------------------- Shape Utils ------------------ */\n\n\t/**\n\t * A map of shape utility classes (TLShapeUtils) by shape type.\n\t *\n\t * @public\n\t */\n\tshapeUtils: { readonly [K in string]?: ShapeUtil<TLUnknownShape> }\n\n\tstyleProps: { [key: string]: Map<StyleProp<any>, string> }\n\n\t/**\n\t * Get a shape util from a shape itself.\n\t *\n\t * @example\n\t * ```ts\n\t * const util = editor.getShapeUtil(myArrowShape)\n\t * const util = editor.getShapeUtil('arrow')\n\t * const util = editor.getShapeUtil<TLArrowShape>(myArrowShape)\n\t * const util = editor.getShapeUtil(TLArrowShape)('arrow')\n\t * ```\n\t *\n\t * @param shape - A shape, shape partial, or shape type.\n\t *\n\t * @public\n\t */\n\tgetShapeUtil<S extends TLUnknownShape>(shape: S | TLShapePartial<S>): ShapeUtil<S>\n\tgetShapeUtil<S extends TLUnknownShape>(type: S['type']): ShapeUtil<S>\n\tgetShapeUtil<T extends ShapeUtil>(type: T extends ShapeUtil<infer R> ? R['type'] : string): T\n\tgetShapeUtil(arg: string | { type: string }) {\n\t\tconst type = typeof arg === 'string' ? arg : arg.type\n\t\tconst shapeUtil = getOwnProperty(this.shapeUtils, type)\n\t\tassert(shapeUtil, `No shape util found for type \"${type}\"`)\n\t\treturn shapeUtil\n\t}\n\n\t/* --------------------- History -------------------- */\n\n\t/**\n\t * A manager for the app's history.\n\t *\n\t * @readonly\n\t */\n\treadonly history = new HistoryManager(\n\t\tthis,\n\t\t// () => this._complete(),\n\t\t(error) => {\n\t\t\tthis.annotateError(error, { origin: 'history.batch', willCrashApp: true })\n\t\t\tthis.crash(error)\n\t\t}\n\t)\n\n\t/**\n\t * Undo to the last mark.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.undo()\n\t * ```\n\t *\n\t * @public\n\t */\n\tundo(): this {\n\t\tthis._flushEventsForTick(0)\n\t\tthis.history.undo()\n\t\treturn this\n\t}\n\n\t/**\n\t * Whether the app can undo.\n\t *\n\t * @public\n\t */\n\t@computed getCanUndo(): boolean {\n\t\treturn this.history.getNumUndos() > 0\n\t}\n\n\t/**\n\t * Redo to the next mark.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.redo()\n\t * ```\n\t *\n\t * @public\n\t */\n\tredo(): this {\n\t\tthis._flushEventsForTick(0)\n\t\tthis.history.redo()\n\t\treturn this\n\t}\n\n\t/**\n\t * Whether the app can redo.\n\t *\n\t * @public\n\t */\n\t@computed getCanRedo(): boolean {\n\t\treturn this.history.getNumRedos() > 0\n\t}\n\n\t/**\n\t * Create a new \"mark\", or stopping point, in the undo redo history. Creating a mark will clear\n\t * any redos.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.mark()\n\t * editor.mark('flip shapes')\n\t * ```\n\t *\n\t * @param markId - The mark's id, usually the reason for adding the mark.\n\t * @param onUndo - Whether to stop at the mark when undoing.\n\t * @param onRedo - Whether to stop at the mark when redoing.\n\t *\n\t * @public\n\t */\n\tmark(markId?: string, onUndo?: boolean, onRedo?: boolean): this {\n\t\tthis.history.mark(markId, onUndo, onRedo)\n\t\treturn this\n\t}\n\n\t/**\n\t * Clear all marks in the undo stack back to the next mark.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.bail()\n\t * ```\n\t *\n\t * @public\n\t */\n\tbail() {\n\t\tthis.history.bail()\n\t\treturn this\n\t}\n\n\t/**\n\t * Clear all marks in the undo stack back to the mark with the provided mark id.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.bailToMark('dragging')\n\t * ```\n\t *\n\t * @public\n\t */\n\tbailToMark(id: string): this {\n\t\tthis.history.bailToMark(id)\n\t\treturn this\n\t}\n\n\t/**\n\t * Run a function in a batch.\n\t *\n\t * @public\n\t */\n\tbatch(fn: () => void): this {\n\t\tthis.history.batch(fn)\n\t\treturn this\n\t}\n\n\t/* --------------------- Arrows --------------------- */\n\t// todo: move these to tldraw or replace with a bindings API\n\n\t/** @internal */\n\t@computed\n\tprivate _getArrowBindingsIndex() {\n\t\treturn arrowBindingsIndex(this)\n\t}\n\n\t/**\n\t * Get all arrows bound to a shape.\n\t *\n\t * @param shapeId - The id of the shape.\n\t *\n\t * @public\n\t */\n\tgetArrowsBoundTo(shapeId: TLShapeId) {\n\t\treturn this._getArrowBindingsIndex().get()[shapeId] || EMPTY_ARRAY\n\t}\n\n\t@computed\n\tprivate getArrowInfoCache() {\n\t\treturn this.store.createComputedCache<TLArrowInfo, TLArrowShape>('arrow infoCache', (shape) => {\n\t\t\treturn getIsArrowStraight(shape)\n\t\t\t\t? getStraightArrowInfo(this, shape)\n\t\t\t\t: getCurvedArrowInfo(this, shape)\n\t\t})\n\t}\n\n\t/**\n\t * Get cached info about an arrow.\n\t *\n\t * @example\n\t * ```ts\n\t * const arrowInfo = editor.getArrowInfo(myArrow)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) of the arrow to get the info for.\n\t *\n\t * @public\n\t */\n\tgetArrowInfo(shape: TLArrowShape | TLShapeId): TLArrowInfo | undefined {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\treturn this.getArrowInfoCache().get(id)\n\t}\n\n\t/* --------------------- Errors --------------------- */\n\n\t/** @internal */\n\tannotateError(\n\t\terror: unknown,\n\t\t{\n\t\t\torigin,\n\t\t\twillCrashApp,\n\t\t\ttags,\n\t\t\textras,\n\t\t}: {\n\t\t\torigin: string\n\t\t\twillCrashApp: boolean\n\t\t\ttags?: Record<string, string | boolean | number>\n\t\t\textras?: Record<string, unknown>\n\t\t}\n\t): this {\n\t\tconst defaultAnnotations = this.createErrorAnnotations(origin, willCrashApp)\n\t\tannotateError(error, {\n\t\t\ttags: { ...defaultAnnotations.tags, ...tags },\n\t\t\textras: { ...defaultAnnotations.extras, ...extras },\n\t\t})\n\t\tif (willCrashApp) {\n\t\t\tthis.store.markAsPossiblyCorrupted()\n\t\t}\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tcreateErrorAnnotations(\n\t\torigin: string,\n\t\twillCrashApp: boolean | 'unknown'\n\t): {\n\t\ttags: { origin: string; willCrashApp: boolean | 'unknown' }\n\t\textras: {\n\t\t\tactiveStateNode?: string\n\t\t\tselectedShapes?: TLUnknownShape[]\n\t\t\teditingShape?: TLUnknownShape\n\t\t\tinputs?: Record<string, unknown>\n\t\t}\n\t} {\n\t\ttry {\n\t\t\tconst editingShapeId = this.getEditingShapeId()\n\t\t\treturn {\n\t\t\t\ttags: {\n\t\t\t\t\torigin: origin,\n\t\t\t\t\twillCrashApp,\n\t\t\t\t},\n\t\t\t\textras: {\n\t\t\t\t\tactiveStateNode: this.root.getPath(),\n\t\t\t\t\tselectedShapes: this.getSelectedShapes(),\n\t\t\t\t\teditingShape: editingShapeId ? this.getShape(editingShapeId) : undefined,\n\t\t\t\t\tinputs: this.inputs,\n\t\t\t\t},\n\t\t\t}\n\t\t} catch {\n\t\t\treturn {\n\t\t\t\ttags: {\n\t\t\t\t\torigin: origin,\n\t\t\t\t\twillCrashApp,\n\t\t\t\t},\n\t\t\t\textras: {},\n\t\t\t}\n\t\t}\n\t}\n\n\t/** @internal */\n\tprivate _crashingError: unknown | null = null\n\n\t/**\n\t * We can't use an `atom` here because there's a chance that when `crashAndReportError` is called,\n\t * we're in a transaction that's about to be rolled back due to the same error we're currently\n\t * reporting.\n\t *\n\t * Instead, to listen to changes to this value, you need to listen to app's `crash` event.\n\t *\n\t * @internal\n\t */\n\tgetCrashingError() {\n\t\treturn this._crashingError\n\t}\n\n\t/** @internal */\n\tcrash(error: unknown): this {\n\t\tthis._crashingError = error\n\t\tthis.store.markAsPossiblyCorrupted()\n\t\tthis.emit('crash', { error })\n\t\treturn this\n\t}\n\n\t/* ------------------- Statechart ------------------- */\n\n\t/**\n\t * The editor's current path of active states.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getPath() // \"select.idle\"\n\t * ```\n\t *\n\t * @public\n\t */\n\t@computed getPath() {\n\t\treturn this.root.getPath().split('root.')[1]\n\t}\n\n\t/**\n\t * Get whether a certain tool (or other state node) is currently active.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.isIn('select')\n\t * editor.isIn('select.brushing')\n\t * ```\n\t *\n\t * @param path - The path of active states, separated by periods.\n\t *\n\t * @public\n\t */\n\tisIn(path: string): boolean {\n\t\tconst ids = path.split('.').reverse()\n\t\tlet state = this.root as StateNode\n\t\twhile (ids.length > 0) {\n\t\t\tconst id = ids.pop()\n\t\t\tif (!id) return true\n\t\t\tconst current = state.getCurrent()\n\t\t\tif (current?.id === id) {\n\t\t\t\tif (ids.length === 0) return true\n\t\t\t\tstate = current\n\t\t\t\tcontinue\n\t\t\t} else return false\n\t\t}\n\t\treturn false\n\t}\n\n\t/**\n\t * Get whether the state node is in any of the given active paths.\n\t *\n\t * @example\n\t * ```ts\n\t * state.isInAny('select', 'erase')\n\t * state.isInAny('select.brushing', 'erase.idle')\n\t * ```\n\t *\n\t * @public\n\t */\n\tisInAny(...paths: string[]): boolean {\n\t\treturn paths.some((path) => this.isIn(path))\n\t}\n\n\t/**\n\t * Set the selected tool.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setCurrentTool('hand')\n\t * editor.setCurrentTool('hand', { date: Date.now() })\n\t * ```\n\t *\n\t * @param id - The id of the tool to select.\n\t * @param info - Arbitrary data to pass along into the transition.\n\t *\n\t * @public\n\t */\n\tsetCurrentTool(id: string, info = {}): this {\n\t\tthis.root.transition(id, info)\n\t\treturn this\n\t}\n\n\t/**\n\t * The current selected tool.\n\t *\n\t * @public\n\t */\n\t@computed getCurrentTool(): StateNode {\n\t\treturn this.root.getCurrent()!\n\t}\n\n\t/**\n\t * The id of the current selected tool.\n\t *\n\t * @public\n\t */\n\t@computed getCurrentToolId(): string {\n\t\tconst currentTool = this.getCurrentTool()\n\t\tif (!currentTool) return ''\n\t\treturn currentTool.getCurrentToolIdMask() ?? currentTool.id\n\t}\n\n\t/**\n\t * Get a descendant by its path.\n\t *\n\t * @example\n\t * ```ts\n\t * state.getStateDescendant('select')\n\t * state.getStateDescendant('select.brushing')\n\t * ```\n\t *\n\t * @param path - The descendant's path of state ids, separated by periods.\n\t *\n\t * @public\n\t */\n\tgetStateDescendant<T extends StateNode>(path: string): T | undefined {\n\t\tconst ids = path.split('.').reverse()\n\t\tlet state = this.root as StateNode\n\t\twhile (ids.length > 0) {\n\t\t\tconst id = ids.pop()\n\t\t\tif (!id) return state as T\n\t\t\tconst childState = state.children?.[id]\n\t\t\tif (!childState) return undefined\n\t\t\tstate = childState\n\t\t}\n\t\treturn state as T\n\t}\n\n\t/* ---------------- Document Settings --------------- */\n\n\t/**\n\t * The global document settings that apply to all users.\n\t *\n\t * @public\n\t **/\n\t@computed getDocumentSettings() {\n\t\treturn this.store.get(TLDOCUMENT_ID)!\n\t}\n\n\t/**\n\t * Update the global document settings that apply to all users.\n\t *\n\t * @public\n\t **/\n\tupdateDocumentSettings(settings: Partial<TLDocument>): this {\n\t\tthis.store.put([{ ...this.getDocumentSettings(), ...settings }])\n\t\treturn this\n\t}\n\n\t/* ----------------- Instance State ----------------- */\n\n\t/**\n\t * The current instance's state.\n\t *\n\t * @public\n\t */\n\t@computed getInstanceState(): TLInstance {\n\t\treturn this.store.get(TLINSTANCE_ID)!\n\t}\n\n\t/**\n\t * Update the instance's state.\n\t *\n\t * @param partial - A partial object to update the instance state with.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tupdateInstanceState(\n\t\tpartial: Partial<Omit<TLInstance, 'currentPageId'>>,\n\t\thistoryOptions?: TLCommandHistoryOptions\n\t): this {\n\t\tthis._updateInstanceState(partial, { ephemeral: true, squashing: true, ...historyOptions })\n\n\t\tif (partial.isChangingStyle !== undefined) {\n\t\t\tclearTimeout(this._isChangingStyleTimeout)\n\t\t\tif (partial.isChangingStyle === true) {\n\t\t\t\t// If we've set to true, set a new reset timeout to change the value back to false after 2 seconds\n\t\t\t\tthis._isChangingStyleTimeout = setTimeout(() => {\n\t\t\t\t\tthis.updateInstanceState({ isChangingStyle: false }, { ephemeral: true })\n\t\t\t\t}, 2000)\n\t\t\t}\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _updateInstanceState = this.history.createCommand(\n\t\t'updateInstanceState',\n\t\t(\n\t\t\tpartial: Partial<Omit<TLInstance, 'currentPageId'>>,\n\t\t\thistoryOptions?: TLCommandHistoryOptions\n\t\t) => {\n\t\t\tconst prev = this.store.get(this.getInstanceState().id)!\n\t\t\tconst next = { ...prev, ...partial }\n\n\t\t\treturn {\n\t\t\t\tdata: { prev, next },\n\t\t\t\tephemeral: false,\n\t\t\t\tsquashing: false,\n\t\t\t\t...historyOptions,\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tdo: ({ next }) => {\n\t\t\t\tthis.store.put([next])\n\t\t\t},\n\t\t\tundo: ({ prev }) => {\n\t\t\t\tthis.store.put([prev])\n\t\t\t},\n\t\t\tsquash({ prev }, { next }) {\n\t\t\t\treturn { prev, next }\n\t\t\t},\n\t\t}\n\t)\n\n\t/** @internal */\n\tprivate _isChangingStyleTimeout = -1 as any\n\n\t// Menus\n\n\t/**\n\t * A set of strings representing any open menus. When menus are open,\n\t * certain interactions will behave differently; for example, when a\n\t * draw tool is selected and a menu is open, a pointer-down will not\n\t * create a dot (because the user is probably trying to close the menu)\n\t * however a pointer-down event followed by a drag will begin drawing\n\t * a line (because the user is BOTH trying to close the menu AND start\n\t * drawing a line).\n\t *\n\t * @public\n\t */\n\t@computed getOpenMenus(): string[] {\n\t\treturn this.getInstanceState().openMenus\n\t}\n\n\t/**\n\t * Add an open menu.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.addOpenMenu('menu-id')\n\t * ```\n\t *\n\t * @public\n\t */\n\taddOpenMenu(id: string): this {\n\t\tconst menus = new Set(this.getOpenMenus())\n\t\tif (!menus.has(id)) {\n\t\t\tmenus.add(id)\n\t\t\tthis.updateInstanceState({ openMenus: [...menus] })\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Delete an open menu.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.deleteOpenMenu('menu-id')\n\t * ```\n\t *\n\t * @public\n\t */\n\tdeleteOpenMenu(id: string): this {\n\t\tconst menus = new Set(this.getOpenMenus())\n\t\tif (menus.has(id)) {\n\t\t\tmenus.delete(id)\n\t\t\tthis.updateInstanceState({ openMenus: [...menus] })\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Clear all open menus.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.clearOpenMenus()\n\t * ```\n\t *\n\t * @public\n\t */\n\tclearOpenMenus(): this {\n\t\tif (this.getOpenMenus().length) {\n\t\t\tthis.updateInstanceState({ openMenus: [] })\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Get whether any menus are open.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getIsMenuOpen()\n\t * ```\n\t *\n\t * @public\n\t */\n\t@computed getIsMenuOpen(): boolean {\n\t\treturn this.getOpenMenus().length > 0\n\t}\n\n\t/* --------------------- Cursor --------------------- */\n\n\t/**\n\t * Set the cursor.\n\t *\n\t * @param type - The cursor type.\n\t * @param rotation - The cursor rotation.\n\t *\n\t * @public\n\t */\n\tsetCursor = (cursor: Partial<TLCursor>): this => {\n\t\tthis.updateInstanceState(\n\t\t\t{ cursor: { ...this.getInstanceState().cursor, ...cursor } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t\treturn this\n\t}\n\n\t/* ------------------- Page State ------------------- */\n\n\t/**\n\t * Page states.\n\t *\n\t * @public\n\t */\n\t@computed getPageStates(): TLInstancePageState[] {\n\t\treturn this._getPageStatesQuery().get()\n\t}\n\n\t/** @internal */\n\t@computed private _getPageStatesQuery() {\n\t\treturn this.store.query.records('instance_page_state')\n\t}\n\n\t/**\n\t * The current page state.\n\t *\n\t * @public\n\t */\n\t@computed getCurrentPageState(): TLInstancePageState {\n\t\treturn this.store.get(this._getCurrentPageStateId())!\n\t}\n\n\t/** @internal */\n\t@computed private _getCurrentPageStateId() {\n\t\treturn InstancePageStateRecordType.createId(this.getCurrentPageId())\n\t}\n\n\t/**\n\t * Update this instance's page state.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.updateCurrentPageState({ id: 'page1', editingShapeId: 'shape:123' })\n\t * editor.updateCurrentPageState({ id: 'page1', editingShapeId: 'shape:123' }, { ephemeral: true })\n\t * ```\n\t *\n\t * @param partial - The partial of the page state object containing the changes.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tupdateCurrentPageState(\n\t\tpartial: Partial<\n\t\t\tOmit<TLInstancePageState, 'selectedShapeIds' | 'editingShapeId' | 'pageId' | 'focusedGroupId'>\n\t\t>,\n\t\thistoryOptions?: TLCommandHistoryOptions\n\t): this {\n\t\tthis._setInstancePageState(partial, historyOptions)\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _setInstancePageState = this.history.createCommand(\n\t\t'setInstancePageState',\n\t\t(\n\t\t\tpartial: Partial<Omit<TLInstancePageState, 'selectedShapeIds'>>,\n\t\t\thistoryOptions?: TLCommandHistoryOptions\n\t\t) => {\n\t\t\tconst prev = this.store.get(partial.id ?? this.getCurrentPageState().id)!\n\t\t\treturn { data: { prev, partial }, ...historyOptions }\n\t\t},\n\t\t{\n\t\t\tdo: ({ prev, partial }) => {\n\t\t\t\tthis.store.update(prev.id, (state) => ({ ...state, ...partial }))\n\t\t\t},\n\t\t\tundo: ({ prev }) => {\n\t\t\t\tthis.store.update(prev.id, () => prev)\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * The current selected ids.\n\t *\n\t * @public\n\t */\n\t@computed getSelectedShapeIds() {\n\t\treturn this.getCurrentPageState().selectedShapeIds\n\t}\n\n\t/**\n\t * An array containing all of the currently selected shapes.\n\t *\n\t * @public\n\t * @readonly\n\t */\n\t@computed getSelectedShapes(): TLShape[] {\n\t\tconst { selectedShapeIds } = this.getCurrentPageState()\n\t\treturn compact(selectedShapeIds.map((id) => this.store.get(id)))\n\t}\n\n\t/**\n\t * Select one or more shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setSelectedShapes(['id1'])\n\t * editor.setSelectedShapes(['id1', 'id2'])\n\t * ```\n\t *\n\t * @param ids - The ids to select.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tsetSelectedShapes(\n\t\tshapes: TLShapeId[] | TLShape[],\n\t\thistoryOptions?: TLCommandHistoryOptions\n\t): this {\n\t\tconst ids = shapes.map((shape) => (typeof shape === 'string' ? shape : shape.id))\n\t\tthis._setSelectedShapes(ids, historyOptions)\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _setSelectedShapes = this.history.createCommand(\n\t\t'setSelectedShapes',\n\t\t(ids: TLShapeId[], historyOptions?: TLCommandHistoryOptions) => {\n\t\t\tconst { selectedShapeIds: prevSelectedShapeIds } = this.getCurrentPageState()\n\t\t\tconst prevSet = new Set(prevSelectedShapeIds)\n\n\t\t\tif (ids.length === prevSet.size && ids.every((id) => prevSet.has(id))) return null\n\n\t\t\treturn {\n\t\t\t\tdata: { selectedShapeIds: ids, prevSelectedShapeIds },\n\t\t\t\tpreservesRedoStack: true,\n\t\t\t\t...historyOptions,\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tdo: ({ selectedShapeIds }) => {\n\t\t\t\tthis.store.put([{ ...this.getCurrentPageState(), selectedShapeIds }])\n\t\t\t},\n\t\t\tundo: ({ prevSelectedShapeIds }) => {\n\t\t\t\tthis.store.put([\n\t\t\t\t\t{\n\t\t\t\t\t\t...this.getCurrentPageState(),\n\t\t\t\t\t\tselectedShapeIds: prevSelectedShapeIds,\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t},\n\t\t\tsquash({ prevSelectedShapeIds }, { selectedShapeIds }) {\n\t\t\t\treturn {\n\t\t\t\t\tselectedShapeIds,\n\t\t\t\t\tprevSelectedShapeIds,\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Select one or more shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.select('id1')\n\t * editor.select('id1', 'id2')\n\t * ```\n\t *\n\t * @param ids - The ids to select.\n\t *\n\t * @public\n\t */\n\tselect(...shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((shape) => shape.id)\n\t\tthis.setSelectedShapes(ids)\n\t\treturn this\n\t}\n\n\t/**\n\t * Remove a shape from the existing set of selected shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.deselect(shape.id)\n\t * ```\n\t *\n\t * @public\n\t */\n\tdeselect(...shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((shape) => shape.id)\n\t\tconst selectedShapeIds = this.getSelectedShapeIds()\n\t\tif (selectedShapeIds.length > 0 && ids.length > 0) {\n\t\t\tthis.setSelectedShapes(selectedShapeIds.filter((id) => !ids.includes(id)))\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Select all direct children of the current page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.selectAll()\n\t * ```\n\t *\n\t * @public\n\t */\n\tselectAll(): this {\n\t\tconst ids = this.getSortedChildIdsForParent(this.getCurrentPageId())\n\t\t// page might have no shapes\n\t\tif (ids.length <= 0) return this\n\t\tthis.setSelectedShapes(this._getUnlockedShapeIds(ids))\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Clear the selection.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.selectNone()\n\t * ```\n\t *\n\t * @public\n\t */\n\tselectNone(): this {\n\t\tif (this.getSelectedShapeIds().length > 0) {\n\t\t\tthis.setSelectedShapes([])\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * The id of the app's only selected shape.\n\t *\n\t * @returns Null if there is no shape or more than one selected shape, otherwise the selected shape's id.\n\t *\n\t * @public\n\t * @readonly\n\t */\n\t@computed getOnlySelectedShapeId(): TLShapeId | null {\n\t\treturn this.getOnlySelectedShape()?.id ?? null\n\t}\n\n\t/**\n\t * The app's only selected shape.\n\t *\n\t * @returns Null if there is no shape or more than one selected shape, otherwise the selected shape.\n\t *\n\t * @public\n\t * @readonly\n\t */\n\t@computed getOnlySelectedShape(): TLShape | null {\n\t\tconst selectedShapes = this.getSelectedShapes()\n\t\treturn selectedShapes.length === 1 ? selectedShapes[0] : null\n\t}\n\n\t/**\n\t * The current page bounds of all the selected shapes. If the\n\t * selection is rotated, then these bounds are the axis-aligned\n\t * box that the rotated bounds would fit inside of.\n\t *\n\t * @readonly\n\t *\n\t * @public\n\t */\n\t@computed getSelectionPageBounds(): Box | null {\n\t\tconst selectedShapeIds = this.getCurrentPageState().selectedShapeIds\n\t\tif (selectedShapeIds.length === 0) return null\n\n\t\treturn Box.Common(compact(selectedShapeIds.map((id) => this.getShapePageBounds(id))))\n\t}\n\n\t/**\n\t * The rotation of the selection bounding box in the current page space.\n\t *\n\t * @readonly\n\t * @public\n\t */\n\t@computed getSelectionRotation(): number {\n\t\tconst selectedShapeIds = this.getSelectedShapeIds()\n\t\tlet foundFirst = false // annoying but we can't use an i===0 check because we need to skip over undefineds\n\t\tlet rotation = 0\n\t\tfor (let i = 0, n = selectedShapeIds.length; i < n; i++) {\n\t\t\tconst pageTransform = this.getShapePageTransform(selectedShapeIds[i])\n\t\t\tif (!pageTransform) continue\n\t\t\tif (foundFirst) {\n\t\t\t\tif (pageTransform.rotation() !== rotation) {\n\t\t\t\t\t// There are at least 2 different rotations, so the common rotation is zero\n\t\t\t\t\treturn 0\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// First rotation found\n\t\t\t\tfoundFirst = true\n\t\t\t\trotation = pageTransform.rotation()\n\t\t\t}\n\t\t}\n\n\t\treturn rotation\n\t}\n\n\t/**\n\t * The bounds of the selection bounding box in the current page space.\n\t *\n\t * @readonly\n\t * @public\n\t */\n\t@computed getSelectionRotatedPageBounds(): Box | undefined {\n\t\tconst selectedShapeIds = this.getSelectedShapeIds()\n\n\t\tif (selectedShapeIds.length === 0) {\n\t\t\treturn undefined\n\t\t}\n\n\t\tconst selectionRotation = this.getSelectionRotation()\n\t\tif (selectionRotation === 0) {\n\t\t\treturn this.getSelectionPageBounds()!\n\t\t}\n\n\t\tif (selectedShapeIds.length === 1) {\n\t\t\tconst bounds = this.getShapeGeometry(selectedShapeIds[0]).bounds.clone()\n\t\t\tconst pageTransform = this.getShapePageTransform(selectedShapeIds[0])!\n\t\t\tbounds.point = pageTransform.applyToPoint(bounds.point)\n\t\t\treturn bounds\n\t\t}\n\n\t\t// need to 'un-rotate' all the outlines of the existing nodes so we can fit them inside a box\n\t\tconst boxFromRotatedVertices = Box.FromPoints(\n\t\t\tthis.getSelectedShapeIds()\n\t\t\t\t.flatMap((id) => {\n\t\t\t\t\tconst pageTransform = this.getShapePageTransform(id)\n\t\t\t\t\tif (!pageTransform) return []\n\t\t\t\t\treturn pageTransform.applyToPoints(this.getShapeGeometry(id).bounds.corners)\n\t\t\t\t})\n\t\t\t\t.map((p) => p.rot(-selectionRotation))\n\t\t)\n\t\t// now position box so that it's top-left corner is in the right place\n\t\tboxFromRotatedVertices.point = boxFromRotatedVertices.point.rot(selectionRotation)\n\t\treturn boxFromRotatedVertices\n\t}\n\n\t/**\n\t * The bounds of the selection bounding box in the current page space.\n\t *\n\t * @readonly\n\t * @public\n\t */\n\t@computed getSelectionRotatedScreenBounds(): Box | undefined {\n\t\tconst bounds = this.getSelectionRotatedPageBounds()\n\t\tif (!bounds) return undefined\n\t\tconst { x, y } = this.pageToScreen(bounds.point)\n\t\tconst zoom = this.getZoomLevel()\n\t\treturn new Box(x, y, bounds.width * zoom, bounds.height * zoom)\n\t}\n\n\t// Focus Group\n\n\t/**\n\t * The current focused group id.\n\t *\n\t * @public\n\t */\n\t@computed getFocusedGroupId(): TLShapeId | TLPageId {\n\t\treturn this.getCurrentPageState().focusedGroupId ?? this.getCurrentPageId()\n\t}\n\n\t/**\n\t * The current focused group.\n\t *\n\t * @public\n\t */\n\t@computed getFocusedGroup(): TLShape | undefined {\n\t\tconst focusedGroupId = this.getFocusedGroupId()\n\t\treturn focusedGroupId ? this.getShape(focusedGroupId) : undefined\n\t}\n\n\t/**\n\t * Set the current focused group shape.\n\t *\n\t * @param shape - The group shape id (or group shape's id) to set as the focused group shape.\n\t *\n\t * @public\n\t */\n\tsetFocusedGroup(shape: TLShapeId | TLGroupShape | null): this {\n\t\tconst id = typeof shape === 'string' ? shape : shape?.id ?? null\n\n\t\tif (id !== null) {\n\t\t\tconst shape = this.getShape(id)\n\t\t\tif (!shape) {\n\t\t\t\tthrow Error(`Editor.setFocusedGroup: Shape with id ${id} does not exist`)\n\t\t\t}\n\n\t\t\tif (!this.isShapeOfType<TLGroupShape>(shape, 'group')) {\n\t\t\t\tthrow Error(\n\t\t\t\t\t`Editor.setFocusedGroup: Cannot set focused group to shape of type ${shape.type}`\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\tif (id === this.getFocusedGroupId()) return this\n\t\tthis._setFocusedGroupId(id)\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _setFocusedGroupId = this.history.createCommand(\n\t\t'setFocusedGroupId',\n\t\t(next: TLShapeId | null) => {\n\t\t\tconst prev = this.getCurrentPageState().focusedGroupId\n\t\t\tif (prev === next) return\n\t\t\treturn {\n\t\t\t\tdata: {\n\t\t\t\t\tprev,\n\t\t\t\t\tnext,\n\t\t\t\t},\n\t\t\t\tpreservesRedoStack: true,\n\t\t\t\tsquashing: true,\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tdo: ({ next }) => {\n\t\t\t\tthis.store.update(this.getCurrentPageState().id, (s) => ({ ...s, focusedGroupId: next }))\n\t\t\t},\n\t\t\tundo: ({ prev }) => {\n\t\t\t\tthis.store.update(this.getCurrentPageState().id, (s) => ({ ...s, focusedGroupId: prev }))\n\t\t\t},\n\t\t\tsquash({ prev }, { next }) {\n\t\t\t\treturn { prev, next }\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Exit the current focused group, moving up to the next parent group if there is one.\n\t *\n\t * @public\n\t */\n\tpopFocusedGroupId(): this {\n\t\tconst focusedGroup = this.getFocusedGroup()\n\n\t\tif (focusedGroup) {\n\t\t\t// If we have a focused layer, look for an ancestor of the focused shape that is a group\n\t\t\tconst match = this.findShapeAncestor(focusedGroup, (shape) =>\n\t\t\t\tthis.isShapeOfType<TLGroupShape>(shape, 'group')\n\t\t\t)\n\t\t\t// If we have an ancestor that can become a focused layer, set it as the focused layer\n\t\t\tthis.setFocusedGroup(match?.id ?? null)\n\t\t\tthis.select(focusedGroup.id)\n\t\t} else {\n\t\t\t// If there's no parent focused group, then clear the focus layer and clear selection\n\t\t\tthis.setFocusedGroup(null)\n\t\t\tthis.selectNone()\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * The current editing shape's id.\n\t *\n\t * @public\n\t */\n\t@computed getEditingShapeId(): TLShapeId | null {\n\t\treturn this.getCurrentPageState().editingShapeId\n\t}\n\n\t/**\n\t * The current editing shape.\n\t *\n\t * @public\n\t */\n\t@computed getEditingShape(): TLShape | undefined {\n\t\tconst editingShapeId = this.getEditingShapeId()\n\t\treturn editingShapeId ? this.getShape(editingShapeId) : undefined\n\t}\n\n\t/**\n\t * Set the current editing shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setEditingShape(myShape)\n\t * editor.setEditingShape(myShape.id)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) to set as editing.\n\t *\n\t * @public\n\t */\n\tsetEditingShape(shape: TLShapeId | TLShape | null): this {\n\t\tconst id = typeof shape === 'string' ? shape : shape?.id ?? null\n\t\tif (id !== this.getEditingShapeId()) {\n\t\t\tif (id) {\n\t\t\t\tconst shape = this.getShape(id)\n\t\t\t\tif (shape && this.getShapeUtil(shape).canEdit(shape)) {\n\t\t\t\t\tthis._setInstancePageState({ editingShapeId: id })\n\t\t\t\t\treturn this\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Either we just set the editing id to null, or the shape was missing or not editable\n\t\t\tthis._setInstancePageState({ editingShapeId: null })\n\t\t}\n\t\treturn this\n\t}\n\n\t// Hovered\n\n\t/**\n\t * The current hovered shape id.\n\t *\n\t * @readonly\n\t * @public\n\t */\n\t@computed getHoveredShapeId(): TLShapeId | null {\n\t\treturn this.getCurrentPageState().hoveredShapeId\n\t}\n\n\t/**\n\t * The current hovered shape.\n\t *\n\t * @public\n\t */\n\t@computed getHoveredShape(): TLShape | undefined {\n\t\tconst hoveredShapeId = this.getHoveredShapeId()\n\t\treturn hoveredShapeId ? this.getShape(hoveredShapeId) : undefined\n\t}\n\t/**\n\t * Set the editor's current hovered shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setHoveredShape(myShape)\n\t * editor.setHoveredShape(myShape.id)\n\t * ```\n\t *\n\t * @param shapes - The shape (or shape id) to set as hovered.\n\t *\n\t * @public\n\t */\n\tsetHoveredShape(shape: TLShapeId | TLShape | null): this {\n\t\tconst id = typeof shape === 'string' ? shape : shape?.id ?? null\n\t\tif (id === this.getHoveredShapeId()) return this\n\t\tthis.updateCurrentPageState({ hoveredShapeId: id }, { ephemeral: true })\n\t\treturn this\n\t}\n\n\t// Hinting\n\n\t/**\n\t * The editor's current hinting shape ids.\n\t *\n\t * @public\n\t */\n\t@computed getHintingShapeIds() {\n\t\treturn this.getCurrentPageState().hintingShapeIds\n\t}\n\t/**\n\t * The editor's current hinting shapes.\n\t *\n\t * @public\n\t */\n\t@computed getHintingShape() {\n\t\tconst hintingShapeIds = this.getHintingShapeIds()\n\t\treturn compact(hintingShapeIds.map((id) => this.getShape(id)))\n\t}\n\n\t/**\n\t * Set the editor's current hinting shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setHintingShapes([myShape])\n\t * editor.setHintingShapes([myShape.id])\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to set as hinting.\n\t *\n\t * @public\n\t */\n\tsetHintingShapes(shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((shape) => shape.id)\n\t\t// always ephemeral\n\t\tthis.updateCurrentPageState({ hintingShapeIds: dedupe(ids) }, { ephemeral: true })\n\t\treturn this\n\t}\n\n\t// Erasing\n\n\t/**\n\t * The editor's current erasing ids.\n\t *\n\t * @public\n\t */\n\t@computed getErasingShapeIds() {\n\t\treturn this.getCurrentPageState().erasingShapeIds\n\t}\n\n\t/**\n\t * The editor's current erasing shapes.\n\t *\n\t * @public\n\t */\n\t@computed getErasingShapes() {\n\t\tconst erasingShapeIds = this.getErasingShapeIds()\n\t\treturn compact(erasingShapeIds.map((id) => this.getShape(id)))\n\t}\n\n\t/**\n\t * Set the editor's current erasing shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setErasingShapes([myShape])\n\t * editor.setErasingShapes([myShape.id])\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to set as hinting.\n\t *\n\t * @public\n\t */\n\tsetErasingShapes(shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((shape) => shape.id)\n\t\tids.sort() // sort the incoming ids\n\t\tconst erasingShapeIds = this.getErasingShapeIds()\n\t\tif (ids.length === erasingShapeIds.length) {\n\t\t\t// if the new ids are the same length as the current ids, they might be the same.\n\t\t\t// presuming the current ids are also sorted, check each item to see if it's the same;\n\t\t\t// if we find any unequal, then we know the new ids are different.\n\t\t\tfor (let i = 0; i < ids.length; i++) {\n\t\t\t\tif (ids[i] !== erasingShapeIds[i]) {\n\t\t\t\t\tthis._setInstancePageState({ erasingShapeIds: ids }, { ephemeral: true })\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// if the ids are a different length, then we know they're different.\n\t\t\tthis._setInstancePageState({ erasingShapeIds: ids }, { ephemeral: true })\n\t\t}\n\n\t\treturn this\n\t}\n\n\t// Cropping\n\n\t/**\n\t * The current cropping shape's id.\n\t *\n\t * @public\n\t */\n\tgetCroppingShapeId() {\n\t\treturn this.getCurrentPageState().croppingShapeId\n\t}\n\n\t/**\n\t * Set the current cropping shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setCroppingShape(myShape)\n\t * editor.setCroppingShape(myShape.id)\n\t * ```\n\t *\n\t *\n\t * @param shape - The shape (or shape id) to set as cropping.\n\t *\n\t * @public\n\t */\n\tsetCroppingShape(shape: TLShapeId | TLShape | null): this {\n\t\tconst id = typeof shape === 'string' ? shape : shape?.id ?? null\n\t\tif (id !== this.getCroppingShapeId()) {\n\t\t\tif (!id) {\n\t\t\t\tthis.updateCurrentPageState({ croppingShapeId: null })\n\t\t\t} else {\n\t\t\t\tconst shape = this.getShape(id)!\n\t\t\t\tconst util = this.getShapeUtil(shape)\n\t\t\t\tif (shape && util.canCrop(shape)) {\n\t\t\t\t\tthis.updateCurrentPageState({ croppingShapeId: id })\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this\n\t}\n\n\t/* --------------------- Camera --------------------- */\n\n\t/** @internal */\n\t@computed\n\tprivate getCameraId() {\n\t\treturn CameraRecordType.createId(this.getCurrentPageId())\n\t}\n\n\t/**\n\t * The current camera.\n\t *\n\t * @public\n\t */\n\t@computed getCamera() {\n\t\treturn this.store.get(this.getCameraId())!\n\t}\n\n\t/**\n\t * The current camera zoom level.\n\t *\n\t * @public\n\t */\n\t@computed getZoomLevel() {\n\t\treturn this.getCamera().z\n\t}\n\n\t/** @internal */\n\tprivate _setCamera(point: VecLike, immediate = false): this {\n\t\tconst currentCamera = this.getCamera()\n\n\t\tif (currentCamera.x === point.x && currentCamera.y === point.y && currentCamera.z === point.z) {\n\t\t\treturn this\n\t\t}\n\n\t\tthis.batch(() => {\n\t\t\tconst camera = { ...currentCamera, ...point }\n\t\t\tthis.store.put([camera]) // include id and meta here\n\n\t\t\t// Dispatch a new pointer move because the pointer's page will have changed\n\t\t\t// (its screen position will compute to a new page position given the new camera position)\n\t\t\tconst { currentScreenPoint, currentPagePoint } = this.inputs\n\t\t\tconst { screenBounds } = this.store.unsafeGetWithoutCapture(TLINSTANCE_ID)!\n\n\t\t\t// compare the next page point (derived from the curent camera) to the current page point\n\t\t\tif (\n\t\t\t\tcurrentScreenPoint.x / camera.z - camera.x !== currentPagePoint.x ||\n\t\t\t\tcurrentScreenPoint.y / camera.z - camera.y !== currentPagePoint.y\n\t\t\t) {\n\t\t\t\t// If it's changed, dispatch a pointer event\n\t\t\t\tconst event: TLPointerEventInfo = {\n\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\ttarget: 'canvas',\n\t\t\t\t\tname: 'pointer_move',\n\t\t\t\t\t// weird but true: we need to put the screen point back into client space\n\t\t\t\t\tpoint: Vec.AddXY(currentScreenPoint, screenBounds.x, screenBounds.y),\n\t\t\t\t\tpointerId: INTERNAL_POINTER_IDS.CAMERA_MOVE,\n\t\t\t\t\tctrlKey: this.inputs.ctrlKey,\n\t\t\t\t\taltKey: this.inputs.altKey,\n\t\t\t\t\tshiftKey: this.inputs.shiftKey,\n\t\t\t\t\tbutton: 0,\n\t\t\t\t\tisPen: this.getInstanceState().isPenMode ?? false,\n\t\t\t\t}\n\t\t\t\tif (immediate) {\n\t\t\t\t\tthis._flushEventForTick(event)\n\t\t\t\t} else {\n\t\t\t\t\tthis.dispatch(event)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._tickCameraState()\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the current camera.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setCamera({ x: 0, y: 0})\n\t * editor.setCamera({ x: 0, y: 0, z: 1.5})\n\t * editor.setCamera({ x: 0, y: 0, z: 1.5}, { duration: 1000, easing: (t) => t * t })\n\t * ```\n\t *\n\t * @param point - The new camera position.\n\t * @param animation - Options for an animation.\n\t *\n\t * @public\n\t */\n\tsetCamera(point: VecLike, animation?: TLAnimationOptions): this {\n\t\tconst x = Number.isFinite(point.x) ? point.x : 0\n\t\tconst y = Number.isFinite(point.y) ? point.y : 0\n\t\tconst z = Number.isFinite(point.z) ? point.z! : this.getZoomLevel()\n\n\t\t// Stop any camera animations\n\t\tthis.stopCameraAnimation()\n\n\t\t// Stop following any user\n\t\tif (this.getInstanceState().followingUserId) {\n\t\t\tthis.stopFollowingUser()\n\t\t}\n\n\t\tif (animation) {\n\t\t\tconst { width, height } = this.getViewportScreenBounds()\n\t\t\treturn this._animateToViewport(new Box(-x, -y, width / z, height / z), animation)\n\t\t} else {\n\t\t\tthis._setCamera({ x, y, z })\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Center the camera on a point (in the current page space).\n\t *\n\t * @example\n\t * ```ts\n\t * editor.centerOnPoint({ x: 100, y: 100 })\n\t * editor.centerOnPoint({ x: 100, y: 100 }, { duration: 200 })\n\t * ```\n\t *\n\t * @param point - The point in the current page space to center on.\n\t * @param animation - The options for an animation.\n\t *\n\t * @public\n\t */\n\tcenterOnPoint(point: VecLike, animation?: TLAnimationOptions): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tconst { width: pw, height: ph } = this.getViewportPageBounds()\n\n\t\tthis.setCamera(\n\t\t\t{ x: -(point.x - pw / 2), y: -(point.y - ph / 2), z: this.getCamera().z },\n\t\t\tanimation\n\t\t)\n\t\treturn this\n\t}\n\n\t/**\n\t * Move the camera to the nearest content.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.zoomToContent()\n\t * editor.zoomToContent({ duration: 200 })\n\t * ```\n\t *\n\t * @param opts - The options for an animation.\n\t *\n\t * @public\n\t */\n\tzoomToContent(opts: TLAnimationOptions = { duration: 220 }): this {\n\t\tconst bounds = this.getSelectionPageBounds() ?? this.getCurrentPageBounds()\n\n\t\tif (bounds) {\n\t\t\tthis.zoomToBounds(bounds, { targetZoom: Math.min(1, this.getZoomLevel()), ...opts })\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Zoom the camera to fit the current page's content in the viewport.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.zoomToFit()\n\t * editor.zoomToFit({ duration: 200 })\n\t * ```\n\t *\n\t * @param animation - The options for an animation.\n\t *\n\t * @public\n\t */\n\tzoomToFit(animation?: TLAnimationOptions): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tconst ids = [...this.getCurrentPageShapeIds()]\n\t\tif (ids.length <= 0) return this\n\n\t\tconst pageBounds = Box.Common(compact(ids.map((id) => this.getShapePageBounds(id))))\n\t\tthis.zoomToBounds(pageBounds, animation)\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the zoom back to 100%.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.resetZoom()\n\t * editor.resetZoom(editor.getViewportScreenCenter(), { duration: 200 })\n\t * editor.resetZoom(editor.getViewportScreenCenter(), { duration: 200 })\n\t * ```\n\t *\n\t * @param point - The screen point to zoom out on. Defaults to the viewport screen center.\n\t * @param animation - The options for an animation.\n\t *\n\t * @public\n\t */\n\tresetZoom(point = this.getViewportScreenCenter(), animation?: TLAnimationOptions): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\t\tconst { x, y } = point\n\t\tthis.setCamera(\n\t\t\t{ x: cx + (x / 1 - x) - (x / cz - x), y: cy + (y / 1 - y) - (y / cz - y), z: 1 },\n\t\t\tanimation\n\t\t)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Zoom the camera in.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.zoomIn()\n\t * editor.zoomIn(editor.getViewportScreenCenter(), { duration: 120 })\n\t * editor.zoomIn(editor.inputs.currentScreenPoint, { duration: 120 })\n\t * ```\n\t *\n\t * @param animation - The options for an animation.\n\t *\n\t * @public\n\t */\n\tzoomIn(point = this.getViewportScreenCenter(), animation?: TLAnimationOptions): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\n\t\tlet zoom = MAX_ZOOM\n\n\t\tfor (let i = 1; i < ZOOMS.length; i++) {\n\t\t\tconst z1 = ZOOMS[i - 1]\n\t\t\tconst z2 = ZOOMS[i]\n\t\t\tif (z2 - cz <= (z2 - z1) / 2) continue\n\t\t\tzoom = z2\n\t\t\tbreak\n\t\t}\n\n\t\tconst { x, y } = point\n\t\tthis.setCamera(\n\t\t\t{ x: cx + (x / zoom - x) - (x / cz - x), y: cy + (y / zoom - y) - (y / cz - y), z: zoom },\n\t\t\tanimation\n\t\t)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Zoom the camera out.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.zoomOut()\n\t * editor.zoomOut(editor.getViewportScreenCenter(), { duration: 120 })\n\t * editor.zoomOut(editor.inputs.currentScreenPoint, { duration: 120 })\n\t * ```\n\t *\n\t * @param animation - The options for an animation.\n\t *\n\t * @public\n\t */\n\tzoomOut(point = this.getViewportScreenCenter(), animation?: TLAnimationOptions): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\n\t\tlet zoom = MIN_ZOOM\n\n\t\tfor (let i = ZOOMS.length - 1; i > 0; i--) {\n\t\t\tconst z1 = ZOOMS[i - 1]\n\t\t\tconst z2 = ZOOMS[i]\n\t\t\tif (z2 - cz >= (z2 - z1) / 2) continue\n\t\t\tzoom = z1\n\t\t\tbreak\n\t\t}\n\n\t\tconst { x, y } = point\n\n\t\tthis.setCamera(\n\t\t\t{\n\t\t\t\tx: cx + (x / zoom - x) - (x / cz - x),\n\t\t\t\ty: cy + (y / zoom - y) - (y / cz - y),\n\t\t\t\tz: zoom,\n\t\t\t},\n\t\t\tanimation\n\t\t)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Zoom the camera to fit the current selection in the viewport.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.zoomToSelection()\n\t * ```\n\t *\n\t * @param animation - The options for an animation.\n\t *\n\t * @public\n\t */\n\tzoomToSelection(animation?: TLAnimationOptions): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tconst selectionPageBounds = this.getSelectionPageBounds()\n\t\tif (!selectionPageBounds) return this\n\n\t\tthis.zoomToBounds(selectionPageBounds, {\n\t\t\ttargetZoom: Math.max(1, this.getZoomLevel()),\n\t\t\t...animation,\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Pan or pan/zoom the selected ids into view. This method tries to not change the zoom if possible.\n\t *\n\t * @param ids - The ids of the shapes to pan and zoom into view.\n\t * @param animation - The options for an animation.\n\t *\n\t * @public\n\t */\n\tpanZoomIntoView(ids: TLShapeId[], animation?: TLAnimationOptions): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tif (ids.length <= 0) return this\n\t\tconst selectionBounds = Box.Common(compact(ids.map((id) => this.getShapePageBounds(id))))\n\n\t\tconst viewportPageBounds = this.getViewportPageBounds()\n\n\t\tif (viewportPageBounds.h < selectionBounds.h || viewportPageBounds.w < selectionBounds.w) {\n\t\t\tthis.zoomToBounds(selectionBounds, { targetZoom: this.getCamera().z, ...animation })\n\n\t\t\treturn this\n\t\t} else {\n\t\t\tconst insetViewport = this.getViewportPageBounds()\n\t\t\t\t.clone()\n\t\t\t\t.expandBy(-32 / this.getZoomLevel())\n\n\t\t\tlet offsetX = 0\n\t\t\tlet offsetY = 0\n\t\t\tif (insetViewport.maxY < selectionBounds.maxY) {\n\t\t\t\t// off bottom\n\t\t\t\toffsetY = insetViewport.maxY - selectionBounds.maxY\n\t\t\t} else if (insetViewport.minY > selectionBounds.minY) {\n\t\t\t\t// off top\n\t\t\t\toffsetY = insetViewport.minY - selectionBounds.minY\n\t\t\t} else {\n\t\t\t\t// inside y-bounds\n\t\t\t}\n\n\t\t\tif (insetViewport.maxX < selectionBounds.maxX) {\n\t\t\t\t// off right\n\t\t\t\toffsetX = insetViewport.maxX - selectionBounds.maxX\n\t\t\t} else if (insetViewport.minX > selectionBounds.minX) {\n\t\t\t\t// off left\n\t\t\t\toffsetX = insetViewport.minX - selectionBounds.minX\n\t\t\t} else {\n\t\t\t\t// inside x-bounds\n\t\t\t}\n\n\t\t\tconst camera = this.getCamera()\n\t\t\tthis.setCamera({ x: camera.x + offsetX, y: camera.y + offsetY, z: camera.z }, animation)\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Zoom the camera to fit a bounding box (in the current page space).\n\t *\n\t * @example\n\t * ```ts\n\t * editor.zoomToBounds(myBounds)\n\t * editor.zoomToBounds(myBounds)\n\t * editor.zoomToBounds(myBounds, { duration: 100 })\n\t * editor.zoomToBounds(myBounds, { inset: 0, targetZoom: 1 })\n\t * ```\n\t *\n\t * @param bounds - The bounding box.\n\t * @param options - The options for an animation, target zoom, or custom inset amount.\n\t *\n\t * @public\n\t */\n\tzoomToBounds(\n\t\tbounds: Box,\n\t\topts?: { targetZoom?: number; inset?: number } & TLAnimationOptions\n\t): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tconst viewportScreenBounds = this.getViewportScreenBounds()\n\n\t\tconst inset = opts?.inset ?? Math.min(256, viewportScreenBounds.width * 0.28)\n\n\t\tlet zoom = clamp(\n\t\t\tMath.min(\n\t\t\t\t(viewportScreenBounds.width - inset) / bounds.width,\n\t\t\t\t(viewportScreenBounds.height - inset) / bounds.height\n\t\t\t),\n\t\t\tMIN_ZOOM,\n\t\t\tMAX_ZOOM\n\t\t)\n\n\t\tif (opts?.targetZoom !== undefined) {\n\t\t\tzoom = Math.min(opts.targetZoom, zoom)\n\t\t}\n\n\t\tthis.setCamera(\n\t\t\t{\n\t\t\t\tx: -bounds.minX + (viewportScreenBounds.width - bounds.width * zoom) / 2 / zoom,\n\t\t\t\ty: -bounds.minY + (viewportScreenBounds.height - bounds.height * zoom) / 2 / zoom,\n\t\t\t\tz: zoom,\n\t\t\t},\n\t\t\topts\n\t\t)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Pan the camera.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.pan({ x: 100, y: 100 })\n\t * editor.pan({ x: 100, y: 100 }, { duration: 1000 })\n\t * ```\n\t *\n\t * @param offset - The offset in the current page space.\n\t * @param animation - The animation options.\n\t */\n\tpan(offset: VecLike, animation?: TLAnimationOptions): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\t\tthis.setCamera({ x: cx + offset.x / cz, y: cy + offset.y / cz, z: cz }, animation)\n\t\tthis._flushEventsForTick(0)\n\t\treturn this\n\t}\n\n\t/**\n\t * Stop the current camera animation, if any.\n\t *\n\t * @public\n\t */\n\tstopCameraAnimation(): this {\n\t\tthis.emit('stop-camera-animation')\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _viewportAnimation = null as null | {\n\t\telapsed: number\n\t\tduration: number\n\t\teasing: (t: number) => number\n\t\tstart: Box\n\t\tend: Box\n\t}\n\n\t/** @internal */\n\tprivate _animateViewport(ms: number) {\n\t\tif (!this._viewportAnimation) return\n\n\t\tconst cancel = () => {\n\t\t\tthis.removeListener('tick', this._animateViewport)\n\t\t\tthis.removeListener('stop-camera-animation', cancel)\n\t\t\tthis._viewportAnimation = null\n\t\t}\n\n\t\tthis.once('stop-camera-animation', cancel)\n\n\t\tthis._viewportAnimation.elapsed += ms\n\n\t\tconst { elapsed, easing, duration, start, end } = this._viewportAnimation\n\n\t\tif (elapsed > duration) {\n\t\t\tthis._setCamera({ x: -end.x, y: -end.y, z: this.getViewportScreenBounds().width / end.width })\n\t\t\tcancel()\n\t\t\treturn\n\t\t}\n\n\t\tconst remaining = duration - elapsed\n\t\tconst t = easing(1 - remaining / duration)\n\n\t\tconst left = start.minX + (end.minX - start.minX) * t\n\t\tconst top = start.minY + (end.minY - start.minY) * t\n\t\tconst right = start.maxX + (end.maxX - start.maxX) * t\n\n\t\tthis._setCamera({ x: -left, y: -top, z: this.getViewportScreenBounds().width / (right - left) })\n\t}\n\n\t/** @internal */\n\tprivate _animateToViewport(targetViewportPage: Box, opts = {} as TLAnimationOptions) {\n\t\tconst { duration = 0, easing = EASINGS.easeInOutCubic } = opts\n\t\tconst animationSpeed = this.user.getAnimationSpeed()\n\t\tconst viewportPageBounds = this.getViewportPageBounds()\n\n\t\t// If we have an existing animation, then stop it\n\t\tthis.stopCameraAnimation()\n\n\t\t// also stop following any user\n\t\tif (this.getInstanceState().followingUserId) {\n\t\t\tthis.stopFollowingUser()\n\t\t}\n\n\t\tif (duration === 0 || animationSpeed === 0) {\n\t\t\t// If we have no animation, then skip the animation and just set the camera\n\t\t\treturn this._setCamera({\n\t\t\t\tx: -targetViewportPage.x,\n\t\t\t\ty: -targetViewportPage.y,\n\t\t\t\tz: this.getViewportScreenBounds().width / targetViewportPage.width,\n\t\t\t})\n\t\t}\n\n\t\t// Set our viewport animation\n\t\tthis._viewportAnimation = {\n\t\t\telapsed: 0,\n\t\t\tduration: duration / animationSpeed,\n\t\t\teasing,\n\t\t\tstart: viewportPageBounds.clone(),\n\t\t\tend: targetViewportPage.clone(),\n\t\t}\n\n\t\t// On each tick, animate the viewport\n\t\tthis.addListener('tick', this._animateViewport)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Slide the camera in a certain direction.\n\t *\n\t * @param opts - Options for the slide\n\t * @public\n\t */\n\tslideCamera(\n\t\topts = {} as {\n\t\t\tspeed: number\n\t\t\tdirection: VecLike\n\t\t\tfriction: number\n\t\t\tspeedThreshold?: number\n\t\t}\n\t): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tthis.stopCameraAnimation()\n\n\t\tconst animationSpeed = this.user.getAnimationSpeed()\n\n\t\tif (animationSpeed === 0) return this\n\n\t\tconst { speed, friction, direction, speedThreshold = 0.01 } = opts\n\t\tlet currentSpeed = Math.min(speed, 1)\n\n\t\tconst cancel = () => {\n\t\t\tthis.removeListener('tick', moveCamera)\n\t\t\tthis.removeListener('stop-camera-animation', cancel)\n\t\t}\n\n\t\tthis.once('stop-camera-animation', cancel)\n\n\t\tconst moveCamera = (elapsed: number) => {\n\t\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\t\t\tconst movementVec = Vec.Mul(direction, (currentSpeed * elapsed) / cz)\n\n\t\t\t// Apply friction\n\t\t\tcurrentSpeed *= 1 - friction\n\t\t\tif (currentSpeed < speedThreshold) {\n\t\t\t\tcancel()\n\t\t\t} else {\n\t\t\t\tthis._setCamera({ x: cx + movementVec.x, y: cy + movementVec.y, z: cz })\n\t\t\t}\n\t\t}\n\n\t\tthis.addListener('tick', moveCamera)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Animate the camera to a user's cursor position.\n\t * This also briefly show the user's cursor if it's not currently visible.\n\t *\n\t * @param userId - The id of the user to aniamte to.\n\t * @public\n\t */\n\tanimateToUser(userId: string): this {\n\t\tconst presence = this.getCollaborators().find((c) => c.userId === userId)\n\n\t\tif (!presence) return this\n\n\t\tthis.batch(() => {\n\t\t\t// If we're following someone, stop following them\n\t\t\tif (this.getInstanceState().followingUserId !== null) {\n\t\t\t\tthis.stopFollowingUser()\n\t\t\t}\n\n\t\t\t// If we're not on the same page, move to the page they're on\n\t\t\tconst isOnSamePage = presence.currentPageId === this.getCurrentPageId()\n\t\t\tif (!isOnSamePage) {\n\t\t\t\tthis.setCurrentPage(presence.currentPageId)\n\t\t\t}\n\n\t\t\t// Only animate the camera if the user is on the same page as us\n\t\t\tconst options = isOnSamePage ? { duration: 500 } : undefined\n\n\t\t\tthis.centerOnPoint(presence.cursor, options)\n\n\t\t\t// Highlight the user's cursor\n\t\t\tconst { highlightedUserIds } = this.getInstanceState()\n\t\t\tthis.updateInstanceState({ highlightedUserIds: [...highlightedUserIds, userId] })\n\n\t\t\t// Unhighlight the user's cursor after a few seconds\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst highlightedUserIds = [...this.getInstanceState().highlightedUserIds]\n\t\t\t\tconst index = highlightedUserIds.indexOf(userId)\n\t\t\t\tif (index < 0) return\n\t\t\t\thighlightedUserIds.splice(index, 1)\n\t\t\t\tthis.updateInstanceState({ highlightedUserIds })\n\t\t\t}, COLLABORATOR_IDLE_TIMEOUT)\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Animate the camera to a shape.\n\t *\n\t * @public\n\t */\n\tanimateToShape(shapeId: TLShapeId, opts: TLAnimationOptions = DEFAULT_ANIMATION_OPTIONS): this {\n\t\tif (!this.getInstanceState().canMoveCamera) return this\n\n\t\tconst activeArea = this.getViewportScreenBounds().clone().expandBy(-32)\n\t\tconst viewportAspectRatio = activeArea.width / activeArea.height\n\n\t\tconst shapePageBounds = this.getShapePageBounds(shapeId)\n\n\t\tif (!shapePageBounds) return this\n\n\t\tconst shapeAspectRatio = shapePageBounds.width / shapePageBounds.height\n\n\t\tconst targetViewportPage = shapePageBounds.clone()\n\n\t\tconst z = shapePageBounds.width / activeArea.width\n\t\ttargetViewportPage.width += (activeArea.minX + activeArea.maxX) * z\n\t\ttargetViewportPage.height += (activeArea.minY + activeArea.maxY) * z\n\t\ttargetViewportPage.x -= activeArea.minX * z\n\t\ttargetViewportPage.y -= activeArea.minY * z\n\n\t\tif (shapeAspectRatio > viewportAspectRatio) {\n\t\t\ttargetViewportPage.height = shapePageBounds.width / viewportAspectRatio\n\t\t\ttargetViewportPage.y -= (targetViewportPage.height - shapePageBounds.height) / 2\n\t\t} else {\n\t\t\ttargetViewportPage.width = shapePageBounds.height * viewportAspectRatio\n\t\t\ttargetViewportPage.x -= (targetViewportPage.width - shapePageBounds.width) / 2\n\t\t}\n\n\t\treturn this._animateToViewport(targetViewportPage, opts)\n\t}\n\n\t// Viewport\n\n\t/** @internal */\n\tprivate _willSetInitialBounds = true\n\tprivate _wasInset = false\n\n\t/**\n\t * Update the viewport. The viewport will measure the size and screen position of its container\n\t * element. This should be done whenever the container's position on the screen changes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.updateViewportScreenBounds()\n\t * editor.updateViewportScreenBounds(true)\n\t * ```\n\t *\n\t * @param center - Whether to preserve the viewport page center as the viewport changes.\n\t *\n\t * @public\n\t */\n\tupdateViewportScreenBounds(screenBounds: Box, center = false): this {\n\t\tscreenBounds.width = Math.max(screenBounds.width, 1)\n\t\tscreenBounds.height = Math.max(screenBounds.height, 1)\n\n\t\tconst insets = [\n\t\t\t// top\n\t\t\tscreenBounds.minY !== 0,\n\t\t\t// right\n\t\t\tdocument.body.scrollWidth !== screenBounds.maxX,\n\t\t\t// bottom\n\t\t\tdocument.body.scrollHeight !== screenBounds.maxY,\n\t\t\t// left\n\t\t\tscreenBounds.minX !== 0,\n\t\t]\n\n\t\tconst boundsAreEqual = screenBounds.equals(this.getViewportScreenBounds())\n\n\t\tconst { _willSetInitialBounds } = this\n\n\t\tif (boundsAreEqual) {\n\t\t\tthis._willSetInitialBounds = false\n\t\t} else {\n\t\t\tif (_willSetInitialBounds) {\n\t\t\t\t// If we have just received the initial bounds, don't center the camera.\n\t\t\t\tthis._willSetInitialBounds = false\n\t\t\t\tthis.updateInstanceState(\n\t\t\t\t\t{ screenBounds: screenBounds.toJson(), insets },\n\t\t\t\t\t{ squashing: true, ephemeral: true }\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tif (center && !this.getInstanceState().followingUserId) {\n\t\t\t\t\t// Get the page center before the change, make the change, and restore it\n\t\t\t\t\tconst before = this.getViewportPageCenter()\n\t\t\t\t\tthis.updateInstanceState(\n\t\t\t\t\t\t{ screenBounds: screenBounds.toJson(), insets },\n\t\t\t\t\t\t{ squashing: true, ephemeral: true }\n\t\t\t\t\t)\n\t\t\t\t\tthis.centerOnPoint(before)\n\t\t\t\t} else {\n\t\t\t\t\t// Otherwise,\n\t\t\t\t\tthis.updateInstanceState(\n\t\t\t\t\t\t{ screenBounds: screenBounds.toJson(), insets },\n\t\t\t\t\t\t{ squashing: true, ephemeral: true }\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._tickCameraState()\n\t\tthis.updateRenderingBounds()\n\n\t\treturn this\n\t}\n\n\t/**\n\t * The bounds of the editor's viewport in screen space.\n\t *\n\t * @public\n\t */\n\t@computed getViewportScreenBounds() {\n\t\tconst { x, y, w, h } = this.getInstanceState().screenBounds\n\t\treturn new Box(x, y, w, h)\n\t}\n\n\t/**\n\t * The center of the editor's viewport in screen space.\n\t *\n\t * @public\n\t */\n\t@computed getViewportScreenCenter() {\n\t\tconst viewportScreenBounds = this.getViewportScreenBounds()\n\t\treturn new Vec(\n\t\t\tviewportScreenBounds.midX - viewportScreenBounds.minX,\n\t\t\tviewportScreenBounds.midY - viewportScreenBounds.minY\n\t\t)\n\t}\n\n\t/**\n\t * The current viewport in the current page space.\n\t *\n\t * @public\n\t */\n\t@computed getViewportPageBounds() {\n\t\tconst { w, h } = this.getViewportScreenBounds()\n\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\t\treturn new Box(-cx, -cy, w / cz, h / cz)\n\t}\n\n\t/**\n\t * The center of the viewport in the current page space.\n\t *\n\t * @public\n\t */\n\t@computed getViewportPageCenter() {\n\t\treturn this.getViewportPageBounds().center\n\t}\n\t/**\n\t * Convert a point in screen space to a point in the current page space.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.screenToPage({ x: 100, y: 100 })\n\t * ```\n\t *\n\t * @param point - The point in screen space.\n\t *\n\t * @public\n\t */\n\tscreenToPage(point: VecLike) {\n\t\tconst { screenBounds } = this.store.unsafeGetWithoutCapture(TLINSTANCE_ID)!\n\t\tconst { x: cx, y: cy, z: cz = 1 } = this.getCamera()\n\t\treturn {\n\t\t\tx: (point.x - screenBounds.x) / cz - cx,\n\t\t\ty: (point.y - screenBounds.y) / cz - cy,\n\t\t\tz: point.z ?? 0.5,\n\t\t}\n\t}\n\n\t/**\n\t * Convert a point in the current page space to a point in current screen space.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.pageToScreen({ x: 100, y: 100 })\n\t * ```\n\t *\n\t * @param point - The point in page space.\n\t *\n\t * @public\n\t */\n\tpageToScreen(point: VecLike) {\n\t\tconst screenBounds = this.getViewportScreenBounds()\n\t\tconst { x: cx, y: cy, z: cz = 1 } = this.getCamera()\n\n\t\treturn {\n\t\t\tx: (point.x + cx) * cz + screenBounds.x,\n\t\t\ty: (point.y + cy) * cz + screenBounds.y,\n\t\t\tz: point.z ?? 0.5,\n\t\t}\n\t}\n\n\t/**\n\t * Convert a point in the current page space to a point in current viewport space.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.pageToViewport({ x: 100, y: 100 })\n\t * ```\n\t *\n\t * @param point - The point in page space.\n\t *\n\t * @public\n\t */\n\tpageToViewport(point: VecLike) {\n\t\tconst { x: cx, y: cy, z: cz = 1 } = this.getCamera()\n\n\t\treturn {\n\t\t\tx: (point.x + cx) * cz,\n\t\t\ty: (point.y + cy) * cz,\n\t\t\tz: point.z ?? 0.5,\n\t\t}\n\t}\n\t// Collaborators\n\n\t@computed\n\tprivate _getCollaboratorsQuery() {\n\t\treturn this.store.query.records('instance_presence', () => ({\n\t\t\tuserId: { neq: this.user.getId() },\n\t\t}))\n\t}\n\n\t/**\n\t * Returns a list of presence records for all peer collaborators.\n\t * This will return the latest presence record for each connected user.\n\t *\n\t * @public\n\t */\n\t@computed\n\tgetCollaborators() {\n\t\tconst allPresenceRecords = this._getCollaboratorsQuery().get()\n\t\tif (!allPresenceRecords.length) return EMPTY_ARRAY\n\t\tconst userIds = [...new Set(allPresenceRecords.map((c) => c.userId))].sort()\n\t\treturn userIds.map((id) => {\n\t\t\tconst latestPresence = allPresenceRecords\n\t\t\t\t.filter((c) => c.userId === id)\n\t\t\t\t.sort((a, b) => b.lastActivityTimestamp - a.lastActivityTimestamp)[0]\n\t\t\treturn latestPresence\n\t\t})\n\t}\n\n\t/**\n\t * Returns a list of presence records for all peer collaborators on the current page.\n\t * This will return the latest presence record for each connected user.\n\t *\n\t * @public\n\t */\n\t@computed\n\tgetCollaboratorsOnCurrentPage() {\n\t\tconst currentPageId = this.getCurrentPageId()\n\t\treturn this.getCollaborators().filter((c) => c.currentPageId === currentPageId)\n\t}\n\n\t// Following\n\n\t/**\n\t * Start viewport-following a user.\n\t *\n\t * @param userId - The id of the user to follow.\n\t *\n\t * @public\n\t */\n\tstartFollowingUser(userId: string): this {\n\t\tconst leaderPresences = this._getCollaboratorsQuery()\n\t\t\t.get()\n\t\t\t.filter((p) => p.userId === userId)\n\n\t\tconst thisUserId = this.user.getId()\n\n\t\tif (!thisUserId) {\n\t\t\tconsole.warn('You should set the userId for the current instance before following a user')\n\t\t}\n\n\t\t// If the leader is following us, then we can't follow them\n\t\tif (leaderPresences.some((p) => p.followingUserId === thisUserId)) {\n\t\t\treturn this\n\t\t}\n\n\t\ttransact(() => {\n\t\t\tthis.stopFollowingUser()\n\n\t\t\tthis.updateInstanceState({ followingUserId: userId }, { ephemeral: true })\n\t\t})\n\n\t\tconst cancel = () => {\n\t\t\tthis.removeListener('frame', moveTowardsUser)\n\t\t\tthis.removeListener('stop-following', cancel)\n\t\t}\n\n\t\tlet isCaughtUp = false\n\n\t\tconst moveTowardsUser = () => {\n\t\t\t// Stop following if we can't find the user\n\t\t\tconst leaderPresence = [...leaderPresences]\n\t\t\t\t.sort((a, b) => {\n\t\t\t\t\treturn a.lastActivityTimestamp - b.lastActivityTimestamp\n\t\t\t\t})\n\t\t\t\t.pop()\n\t\t\tif (!leaderPresence) {\n\t\t\t\tthis.stopFollowingUser()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Change page if leader is on a different page\n\t\t\tconst isOnSamePage = leaderPresence.currentPageId === this.getCurrentPageId()\n\t\t\tconst chaseProportion = isOnSamePage ? FOLLOW_CHASE_PROPORTION : 1\n\t\t\tif (!isOnSamePage) {\n\t\t\t\tthis.stopFollowingUser()\n\t\t\t\tthis.setCurrentPage(leaderPresence.currentPageId)\n\t\t\t\tthis.startFollowingUser(userId)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Get the bounds of the follower (me) and the leader (them)\n\t\t\tconst { center, width, height } = this.getViewportPageBounds()\n\t\t\tconst leaderScreen = Box.From(leaderPresence.screenBounds)\n\t\t\tconst leaderWidth = leaderScreen.width / leaderPresence.camera.z\n\t\t\tconst leaderHeight = leaderScreen.height / leaderPresence.camera.z\n\t\t\tconst leaderCenter = new Vec(\n\t\t\t\tleaderWidth / 2 - leaderPresence.camera.x,\n\t\t\t\tleaderHeight / 2 - leaderPresence.camera.y\n\t\t\t)\n\n\t\t\t// At this point, let's check if we're following someone who's following us.\n\t\t\t// If so, we can't try to contain their entire viewport\n\t\t\t// because that would become a feedback loop where we zoom, they zoom, etc.\n\t\t\tconst isFollowingFollower = leaderPresence.followingUserId === thisUserId\n\n\t\t\t// Figure out how much to zoom\n\t\t\tconst desiredWidth = width + (leaderWidth - width) * chaseProportion\n\t\t\tconst desiredHeight = height + (leaderHeight - height) * chaseProportion\n\t\t\tconst ratio = !isFollowingFollower\n\t\t\t\t? Math.min(width / desiredWidth, height / desiredHeight)\n\t\t\t\t: height / desiredHeight\n\n\t\t\tconst targetZoom = clamp(this.getCamera().z * ratio, MIN_ZOOM, MAX_ZOOM)\n\t\t\tconst targetWidth = this.getViewportScreenBounds().w / targetZoom\n\t\t\tconst targetHeight = this.getViewportScreenBounds().h / targetZoom\n\n\t\t\t// Figure out where to move the camera\n\t\t\tconst displacement = leaderCenter.sub(center)\n\t\t\tconst targetCenter = Vec.Add(center, Vec.Mul(displacement, chaseProportion))\n\n\t\t\t// Now let's assess whether we've caught up to the leader or not\n\t\t\tconst distance = Vec.Sub(targetCenter, center).len()\n\t\t\tconst zoomChange = Math.abs(targetZoom - this.getCamera().z)\n\n\t\t\t// If we're chasing the leader...\n\t\t\t// Stop chasing if we're close enough\n\t\t\tif (distance < FOLLOW_CHASE_PAN_SNAP && zoomChange < FOLLOW_CHASE_ZOOM_SNAP) {\n\t\t\t\tisCaughtUp = true\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// If we're already caught up with the leader...\n\t\t\t// Only start moving again if we're far enough away\n\t\t\tif (\n\t\t\t\tisCaughtUp &&\n\t\t\t\tdistance < FOLLOW_CHASE_PAN_UNSNAP &&\n\t\t\t\tzoomChange < FOLLOW_CHASE_ZOOM_UNSNAP\n\t\t\t) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Update the camera!\n\t\t\tisCaughtUp = false\n\t\t\tthis.stopCameraAnimation()\n\t\t\tthis._setCamera({\n\t\t\t\tx: -(targetCenter.x - targetWidth / 2),\n\t\t\t\ty: -(targetCenter.y - targetHeight / 2),\n\t\t\t\tz: targetZoom,\n\t\t\t})\n\t\t}\n\n\t\tthis.once('stop-following', cancel)\n\t\tthis.addListener('frame', moveTowardsUser)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Stop viewport-following a user.\n\t *\n\t * @public\n\t */\n\tstopFollowingUser(): this {\n\t\tthis.updateInstanceState({ followingUserId: null }, { ephemeral: true })\n\t\tthis.emit('stop-following')\n\t\treturn this\n\t}\n\n\t// Camera state\n\n\tprivate _cameraState = atom('camera state', 'idle' as 'idle' | 'moving')\n\n\t/**\n\t * Whether the camera is moving or idle.\n\t *\n\t * @public\n\t */\n\tgetCameraState() {\n\t\treturn this._cameraState.get()\n\t}\n\n\t// Camera state does two things: first, it allows us to subscribe to whether\n\t// the camera is moving or not; and second, it allows us to update the rendering\n\t// shapes on the canvas. Changing the rendering shapes may cause shapes to\n\t// unmount / remount in the DOM, which is expensive; and computing visibility is\n\t// also expensive in large projects. For this reason, we use a second bounding\n\t// box just for rendering, and we only update after the camera stops moving.\n\n\tprivate _cameraStateTimeoutRemaining = 0\n\tprivate _lastUpdateRenderingBoundsTimestamp = Date.now()\n\n\tprivate _decayCameraStateTimeout = (elapsed: number) => {\n\t\tthis._cameraStateTimeoutRemaining -= elapsed\n\n\t\tif (this._cameraStateTimeoutRemaining <= 0) {\n\t\t\tthis.off('tick', this._decayCameraStateTimeout)\n\t\t\tthis._cameraState.set('idle')\n\t\t\tthis.updateRenderingBounds()\n\t\t}\n\t}\n\n\tprivate _tickCameraState = () => {\n\t\t// always reset the timeout\n\t\tthis._cameraStateTimeoutRemaining = CAMERA_MOVING_TIMEOUT\n\n\t\tconst now = Date.now()\n\n\t\t// If the state is idle, then start the tick\n\t\tif (this._cameraState.__unsafe__getWithoutCapture() === 'idle') {\n\t\t\tthis._lastUpdateRenderingBoundsTimestamp = now // don't render right away\n\t\t\tthis._cameraState.set('moving')\n\t\t\tthis.on('tick', this._decayCameraStateTimeout)\n\t\t}\n\t}\n\n\t/** @internal */\n\tgetUnorderedRenderingShapes(\n\t\t// The rendering state. We use this method both for rendering, which\n\t\t// is based on other state, and for computing order for SVG export,\n\t\t// which should work even when things are for example off-screen.\n\t\tuseEditorState: boolean\n\t) {\n\t\t// Here we get the shape as well as any of its children, as well as their\n\t\t// opacities. If the shape is being erased, and none of its ancestors are\n\t\t// being erased, then we reduce the opacity of the shape and all of its\n\t\t// ancestors; but we don't apply this effect more than once among a set\n\t\t// of descendants so that it does not compound.\n\n\t\t// This is designed to keep all the shapes in a single list which\n\t\t// allows the DOM nodes to be reused even when they become children\n\t\t// of other nodes.\n\n\t\tconst renderingShapes: {\n\t\t\tid: TLShapeId\n\t\t\tshape: TLShape\n\t\t\tutil: ShapeUtil\n\t\t\tindex: number\n\t\t\tbackgroundIndex: number\n\t\t\topacity: number\n\t\t}[] = []\n\n\t\tlet nextIndex = MAX_SHAPES_PER_PAGE * 2\n\t\tlet nextBackgroundIndex = MAX_SHAPES_PER_PAGE\n\n\t\tconst erasingShapeIds = this.getErasingShapeIds()\n\n\t\tconst addShapeById = (id: TLShapeId, opacity: number, isAncestorErasing: boolean) => {\n\t\t\tconst shape = this.getShape(id)\n\t\t\tif (!shape) return\n\n\t\t\topacity *= shape.opacity\n\t\t\tlet isShapeErasing = false\n\t\t\tconst util = this.getShapeUtil(shape)\n\n\t\t\tif (useEditorState) {\n\t\t\t\tisShapeErasing = !isAncestorErasing && erasingShapeIds.includes(id)\n\t\t\t\tif (isShapeErasing) {\n\t\t\t\t\topacity *= 0.32\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trenderingShapes.push({\n\t\t\t\tid,\n\t\t\t\tshape,\n\t\t\t\tutil,\n\t\t\t\tindex: nextIndex,\n\t\t\t\tbackgroundIndex: nextBackgroundIndex,\n\t\t\t\topacity,\n\t\t\t})\n\n\t\t\tnextIndex += 1\n\t\t\tnextBackgroundIndex += 1\n\n\t\t\tconst childIds = this.getSortedChildIdsForParent(id)\n\t\t\tif (!childIds.length) return\n\n\t\t\tlet backgroundIndexToRestore = null\n\t\t\tif (util.providesBackgroundForChildren(shape)) {\n\t\t\t\tbackgroundIndexToRestore = nextBackgroundIndex\n\t\t\t\tnextBackgroundIndex = nextIndex\n\t\t\t\tnextIndex += MAX_SHAPES_PER_PAGE\n\t\t\t}\n\n\t\t\tfor (const childId of childIds) {\n\t\t\t\taddShapeById(childId, opacity, isAncestorErasing || isShapeErasing)\n\t\t\t}\n\n\t\t\tif (backgroundIndexToRestore !== null) {\n\t\t\t\tnextBackgroundIndex = backgroundIndexToRestore\n\t\t\t}\n\t\t}\n\n\t\t// If we're using editor state, then we're only interested in on-screen shapes.\n\t\t// If we're not using the editor state, then we're interested in ALL shapes, even those from other pages.\n\t\tconst pages = useEditorState ? [this.getCurrentPage()] : this.getPages()\n\t\tfor (const page of pages) {\n\t\t\tfor (const childId of this.getSortedChildIdsForParent(page.id)) {\n\t\t\t\taddShapeById(childId, 1, false)\n\t\t\t}\n\t\t}\n\n\t\treturn renderingShapes\n\t}\n\n\t/**\n\t * Get the shapes that should be displayed in the current viewport.\n\t *\n\t * @public\n\t */\n\t@computed getRenderingShapes() {\n\t\tconst renderingShapes = this.getUnorderedRenderingShapes(true)\n\n\t\t// Its IMPORTANT that the result be sorted by id AND include the index\n\t\t// that the shape should be displayed at. Steve, this is the past you\n\t\t// telling the present you not to change this.\n\n\t\t// We want to sort by id because moving elements about in the DOM will\n\t\t// cause the element to get removed by react as it moves the DOM node. This\n\t\t// causes <iframes/> to re-render which is hella annoying and a perf\n\t\t// drain. By always sorting by 'id' we keep the shapes always in the\n\t\t// same order; but we later use index to set the element's 'z-index'\n\t\t// to change the \"rendered\" position in z-space.\n\t\treturn renderingShapes.sort(sortById)\n\t}\n\n\t/**\n\t * The current rendering bounds in the current page space, used for checking which shapes are \"on screen\".\n\t *\n\t * @public\n\t */\n\tgetRenderingBounds() {\n\t\treturn this._renderingBounds.get()\n\t}\n\n\t/** @internal */\n\tprivate readonly _renderingBounds = atom('rendering viewport', new Box())\n\n\t/**\n\t * Update the rendering bounds. This should be called when the viewport has stopped changing, such\n\t * as at the end of a pan, zoom, or animation.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.updateRenderingBounds()\n\t * ```\n\t *\n\t *\n\t * @internal\n\t */\n\tupdateRenderingBounds(): this {\n\t\tconst viewportPageBounds = this.getViewportPageBounds()\n\t\tif (viewportPageBounds.equals(this._renderingBounds.__unsafe__getWithoutCapture())) return this\n\t\tthis._renderingBounds.set(viewportPageBounds.clone())\n\n\t\treturn this\n\t}\n\n\t/**\n\t * The distance to expand the viewport when measuring culling. A larger distance will\n\t * mean that shapes near to the viewport (but still outside of it) will not be culled.\n\t *\n\t * @public\n\t */\n\trenderingBoundsMargin = 100\n\n\t/* --------------------- Pages ---------------------- */\n\n\t@computed private _getAllPagesQuery() {\n\t\treturn this.store.query.records('page')\n\t}\n\n\t/**\n\t * Info about the project's current pages.\n\t *\n\t * @public\n\t */\n\t@computed getPages(): TLPage[] {\n\t\treturn this._getAllPagesQuery().get().sort(sortByIndex)\n\t}\n\n\t/**\n\t * The current page.\n\t *\n\t * @public\n\t */\n\tgetCurrentPage(): TLPage {\n\t\treturn this.getPage(this.getCurrentPageId())!\n\t}\n\n\t/**\n\t * The current page id.\n\t *\n\t * @public\n\t */\n\t@computed getCurrentPageId(): TLPageId {\n\t\treturn this.getInstanceState().currentPageId\n\t}\n\n\t/**\n\t * Get a page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getPage(myPage.id)\n\t * editor.getPage(myPage)\n\t * ```\n\t *\n\t * @param page - The page (or page id) to get.\n\t *\n\t * @public\n\t */\n\tgetPage(page: TLPageId | TLPage): TLPage | undefined {\n\t\treturn this.store.get(typeof page === 'string' ? page : page.id)\n\t}\n\n\t/* @internal */\n\tprivate readonly _currentPageShapeIds: ReturnType<typeof deriveShapeIdsInCurrentPage>\n\n\t/**\n\t * An array of all of the shapes on the current page.\n\t *\n\t * @public\n\t */\n\tgetCurrentPageShapeIds() {\n\t\treturn this._currentPageShapeIds.get()\n\t}\n\n\t/**\n\t * @internal\n\t */\n\t@computed\n\tgetCurrentPageShapeIdsSorted() {\n\t\treturn Array.from(this.getCurrentPageShapeIds()).sort()\n\t}\n\n\t/**\n\t * Get the ids of shapes on a page.\n\t *\n\t * @example\n\t * ```ts\n\t * const idsOnPage1 = editor.getPageShapeIds('page1')\n\t * const idsOnPage2 = editor.getPageShapeIds(myPage2)\n\t * ```\n\t *\n\t * @param page - The page (or page id) to get.\n\t *\n\t * @public\n\t **/\n\tgetPageShapeIds(page: TLPageId | TLPage): Set<TLShapeId> {\n\t\tconst pageId = typeof page === 'string' ? page : page.id\n\t\tconst result = this.store.query.exec('shape', { parentId: { eq: pageId } })\n\t\treturn this.getShapeAndDescendantIds(result.map((s) => s.id))\n\t}\n\n\t/**\n\t * Set the current page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setCurrentPage('page1')\n\t * editor.setCurrentPage(myPage1)\n\t * ```\n\t *\n\t * @param page - The page (or page id) to set as the current page.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tsetCurrentPage(page: TLPageId | TLPage, historyOptions?: TLCommandHistoryOptions): this {\n\t\tconst pageId = typeof page === 'string' ? page : page.id\n\t\tthis._setCurrentPageId(pageId, historyOptions)\n\t\treturn this\n\t}\n\t/** @internal */\n\tprivate _setCurrentPageId = this.history.createCommand(\n\t\t'setCurrentPage',\n\t\t(pageId: TLPageId, historyOptions?: TLCommandHistoryOptions) => {\n\t\t\tif (!this.store.has(pageId)) {\n\t\t\t\tconsole.error(\"Tried to set the current page id to a page that doesn't exist.\")\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tthis.stopFollowingUser()\n\n\t\t\treturn {\n\t\t\t\tdata: { toId: pageId, fromId: this.getCurrentPageId() },\n\t\t\t\tsquashing: true,\n\t\t\t\tpreservesRedoStack: true,\n\t\t\t\t...historyOptions,\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tdo: ({ toId }) => {\n\t\t\t\tif (!this.store.has(toId)) {\n\t\t\t\t\t// in multiplayer contexts this page might have been deleted\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (!this.getPageStates().find((p) => p.pageId === toId)) {\n\t\t\t\t\tconst camera = CameraRecordType.create({\n\t\t\t\t\t\tid: CameraRecordType.createId(toId),\n\t\t\t\t\t})\n\t\t\t\t\tthis.store.put([\n\t\t\t\t\t\tcamera,\n\t\t\t\t\t\tInstancePageStateRecordType.create({\n\t\t\t\t\t\t\tid: InstancePageStateRecordType.createId(toId),\n\t\t\t\t\t\t\tpageId: toId,\n\t\t\t\t\t\t}),\n\t\t\t\t\t])\n\t\t\t\t}\n\n\t\t\t\tthis.store.put([{ ...this.getInstanceState(), currentPageId: toId }])\n\n\t\t\t\tthis.updateRenderingBounds()\n\t\t\t},\n\t\t\tundo: ({ fromId }) => {\n\t\t\t\tif (!this.store.has(fromId)) {\n\t\t\t\t\t// in multiplayer contexts this page might have been deleted\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.store.put([{ ...this.getInstanceState(), currentPageId: fromId }])\n\n\t\t\t\tthis.updateRenderingBounds()\n\t\t\t},\n\t\t\tsquash: ({ fromId }, { toId }) => {\n\t\t\t\treturn { toId, fromId }\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Update a page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.updatePage({ id: 'page2', name: 'Page 2' })\n\t * editor.updatePage({ id: 'page2', name: 'Page 2' }, { squashing: true })\n\t * ```\n\t *\n\t * @param partial - The partial of the shape to update.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tupdatePage(partial: RequiredKeys<TLPage, 'id'>, historyOptions?: TLCommandHistoryOptions): this {\n\t\tthis._updatePage(partial, historyOptions)\n\t\treturn this\n\t}\n\t/** @internal */\n\tprivate _updatePage = this.history.createCommand(\n\t\t'updatePage',\n\t\t(partial: RequiredKeys<TLPage, 'id'>, historyOptions?: TLCommandHistoryOptions) => {\n\t\t\tif (this.getInstanceState().isReadonly) return null\n\n\t\t\tconst prev = this.getPage(partial.id)\n\n\t\t\tif (!prev) return null\n\n\t\t\treturn { data: { prev, partial }, ...historyOptions }\n\t\t},\n\t\t{\n\t\t\tdo: ({ partial }) => {\n\t\t\t\tthis.store.update(partial.id, (page) => ({ ...page, ...partial }))\n\t\t\t},\n\t\t\tundo: ({ prev, partial }) => {\n\t\t\t\tthis.store.update(partial.id, () => prev)\n\t\t\t},\n\t\t\tsquash(prevData, nextData) {\n\t\t\t\treturn {\n\t\t\t\t\tprev: { ...prevData.prev, ...nextData.prev },\n\t\t\t\t\tpartial: nextData.partial,\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Create a page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.createPage(myPage)\n\t * editor.createPage({ name: 'Page 2' })\n\t * ```\n\t *\n\t * @param page - The page (or page partial) to create.\n\t *\n\t * @public\n\t */\n\tcreatePage(page: Partial<TLPage>): this {\n\t\tthis._createPage(page)\n\t\treturn this\n\t}\n\t/** @internal */\n\tprivate _createPage = this.history.createCommand(\n\t\t'createPage',\n\t\t(page: Partial<TLPage>) => {\n\t\t\tif (this.getInstanceState().isReadonly) return null\n\t\t\tif (this.getPages().length >= MAX_PAGES) return null\n\t\t\tconst pages = this.getPages()\n\n\t\t\tconst name = getIncrementedName(\n\t\t\t\tpage.name ?? 'Page 1',\n\t\t\t\tpages.map((p) => p.name)\n\t\t\t)\n\n\t\t\tlet index = page.index\n\n\t\t\tif (!index || pages.some((p) => p.index === index)) {\n\t\t\t\tindex = getIndexAbove(pages[pages.length - 1].index)\n\t\t\t}\n\n\t\t\tconst newPage = PageRecordType.create({\n\t\t\t\tmeta: {},\n\t\t\t\t...page,\n\t\t\t\tname,\n\t\t\t\tindex,\n\t\t\t})\n\n\t\t\tconst newCamera = CameraRecordType.create({\n\t\t\t\tid: CameraRecordType.createId(newPage.id),\n\t\t\t})\n\n\t\t\tconst newTabPageState = InstancePageStateRecordType.create({\n\t\t\t\tid: InstancePageStateRecordType.createId(newPage.id),\n\t\t\t\tpageId: newPage.id,\n\t\t\t})\n\n\t\t\treturn {\n\t\t\t\tdata: {\n\t\t\t\t\tnewPage,\n\t\t\t\t\tnewTabPageState,\n\t\t\t\t\tnewCamera,\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tdo: ({ newPage, newTabPageState, newCamera }) => {\n\t\t\t\tthis.store.put([newPage, newCamera, newTabPageState])\n\t\t\t},\n\t\t\tundo: ({ newPage, newTabPageState, newCamera }) => {\n\t\t\t\tif (this.getPages().length === 1) return\n\t\t\t\tthis.store.remove([newTabPageState.id, newPage.id, newCamera.id])\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Delete a page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.deletePage('page1')\n\t * ```\n\t *\n\t * @param id - The id of the page to delete.\n\t *\n\t * @public\n\t */\n\tdeletePage(page: TLPageId | TLPage): this {\n\t\tconst id = typeof page === 'string' ? page : page.id\n\t\tthis._deletePage(id)\n\t\treturn this\n\t}\n\t/** @internal */\n\tprivate _deletePage = this.history.createCommand(\n\t\t'delete_page',\n\t\t(id: TLPageId) => {\n\t\t\tif (this.getInstanceState().isReadonly) return null\n\t\t\tconst pages = this.getPages()\n\t\t\tif (pages.length === 1) return null\n\n\t\t\tconst deletedPage = this.getPage(id)\n\t\t\tconst deletedPageStates = this.getPageStates().filter((s) => s.pageId === id)\n\n\t\t\tif (!deletedPage) return null\n\n\t\t\tif (id === this.getCurrentPageId()) {\n\t\t\t\tconst index = pages.findIndex((page) => page.id === id)\n\t\t\t\tconst next = pages[index - 1] ?? pages[index + 1]\n\t\t\t\tthis.setCurrentPage(next.id)\n\t\t\t}\n\n\t\t\treturn { data: { id, deletedPage, deletedPageStates } }\n\t\t},\n\t\t{\n\t\t\tdo: ({ deletedPage, deletedPageStates }) => {\n\t\t\t\tconst pages = this.getPages()\n\t\t\t\tif (pages.length === 1) return\n\n\t\t\t\tif (deletedPage.id === this.getCurrentPageId()) {\n\t\t\t\t\tconst index = pages.findIndex((page) => page.id === deletedPage.id)\n\t\t\t\t\tconst next = pages[index - 1] ?? pages[index + 1]\n\t\t\t\t\tthis.setCurrentPage(next.id)\n\t\t\t\t}\n\n\t\t\t\tthis.store.remove(deletedPageStates.map((s) => s.id)) // remove the page state\n\t\t\t\tthis.store.remove([deletedPage.id]) // remove the page\n\t\t\t\tthis.updateRenderingBounds()\n\t\t\t},\n\t\t\tundo: ({ deletedPage, deletedPageStates }) => {\n\t\t\t\tthis.store.put([deletedPage])\n\t\t\t\tthis.store.put(deletedPageStates)\n\t\t\t\tthis.updateRenderingBounds()\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Duplicate a page.\n\t *\n\t * @param id - The id of the page to duplicate. Defaults to the current page.\n\t * @param createId - The id of the new page. Defaults to a new id.\n\t *\n\t * @public\n\t */\n\tduplicatePage(page: TLPageId | TLPage, createId: TLPageId = PageRecordType.createId()): this {\n\t\tif (this.getPages().length >= MAX_PAGES) return this\n\t\tconst id = typeof page === 'string' ? page : page.id\n\t\tconst freshPage = this.getPage(id) // get the most recent version of the page anyway\n\t\tif (!freshPage) return this\n\n\t\tconst prevCamera = { ...this.getCamera() }\n\t\tconst content = this.getContentFromCurrentPage(this.getSortedChildIdsForParent(freshPage.id))\n\n\t\tthis.batch(() => {\n\t\t\tconst pages = this.getPages()\n\t\t\tconst index = getIndexBetween(freshPage.index, pages[pages.indexOf(freshPage) + 1]?.index)\n\n\t\t\t// create the page (also creates the pagestate and camera for the new page)\n\t\t\tthis.createPage({ name: freshPage.name + ' Copy', id: createId, index })\n\t\t\t// set the new page as the current page\n\t\t\tthis.setCurrentPage(createId)\n\t\t\t// update the new page's camera to the previous page's camera\n\t\t\tthis.setCamera(prevCamera)\n\n\t\t\tif (content) {\n\t\t\t\t// If we had content on the previous page, put it on the new page\n\t\t\t\treturn this.putContentOntoCurrentPage(content)\n\t\t\t}\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Rename a page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.renamePage('page1', 'My Page')\n\t * ```\n\t *\n\t * @param id - The id of the page to rename.\n\t * @param name - The new name.\n\t *\n\t * @public\n\t */\n\trenamePage(page: TLPageId | TLPage, name: string, historyOptions?: TLCommandHistoryOptions) {\n\t\tconst id = typeof page === 'string' ? page : page.id\n\t\tif (this.getInstanceState().isReadonly) return this\n\t\tthis.updatePage({ id, name }, historyOptions)\n\t\treturn this\n\t}\n\n\t/* --------------------- Assets --------------------- */\n\n\t/** @internal */\n\t@computed private _getAllAssetsQuery() {\n\t\treturn this.store.query.records('asset')\n\t}\n\n\t/**\n\t * Get all assets in the editor.\n\t *\n\t * @public\n\t */\n\tgetAssets() {\n\t\treturn this._getAllAssetsQuery().get()\n\t}\n\n\t/**\n\t * Create one or more assets.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.createAssets([...myAssets])\n\t * ```\n\t *\n\t * @param assets - The assets to create.\n\t *\n\t * @public\n\t */\n\tcreateAssets(assets: TLAsset[]): this {\n\t\tthis._createAssets(assets)\n\t\treturn this\n\t}\n\t/** @internal */\n\tprivate _createAssets = this.history.createCommand(\n\t\t'createAssets',\n\t\t(assets: TLAsset[]) => {\n\t\t\tif (this.getInstanceState().isReadonly) return null\n\t\t\tif (assets.length <= 0) return null\n\n\t\t\treturn { data: { assets } }\n\t\t},\n\t\t{\n\t\t\tdo: ({ assets }) => {\n\t\t\t\tthis.store.put(assets)\n\t\t\t},\n\t\t\tundo: ({ assets }) => {\n\t\t\t\t// todo: should we actually remove assets here? or on cleanup elsewhere?\n\t\t\t\tthis.store.remove(assets.map((a) => a.id))\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Update one or more assets.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.updateAssets([{ id: 'asset1', name: 'New name' }])\n\t * ```\n\t *\n\t * @param assets - The assets to update.\n\t *\n\t * @public\n\t */\n\tupdateAssets(assets: TLAssetPartial[]): this {\n\t\tthis._updateAssets(assets)\n\t\treturn this\n\t}\n\t/** @internal */\n\tprivate _updateAssets = this.history.createCommand(\n\t\t'updateAssets',\n\t\t(assets: TLAssetPartial[]) => {\n\t\t\tif (this.getInstanceState().isReadonly) return\n\t\t\tif (assets.length <= 0) return\n\n\t\t\tconst snapshots: Record<string, TLAsset> = {}\n\n\t\t\treturn { data: { snapshots, assets } }\n\t\t},\n\t\t{\n\t\t\tdo: ({ assets, snapshots }) => {\n\t\t\t\tthis.store.put(\n\t\t\t\t\tassets.map((a) => {\n\t\t\t\t\t\tconst asset = this.store.get(a.id)!\n\t\t\t\t\t\tsnapshots[a.id] = asset\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...asset,\n\t\t\t\t\t\t\t...a,\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t},\n\t\t\tundo: ({ snapshots }) => {\n\t\t\t\tthis.store.put(Object.values(snapshots))\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Delete one or more assets.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.deleteAssets(['asset1', 'asset2'])\n\t * ```\n\t *\n\t * @param ids - The assets to delete.\n\t *\n\t * @public\n\t */\n\tdeleteAssets(assets: TLAssetId[] | TLAsset[]): this {\n\t\tconst ids =\n\t\t\ttypeof assets[0] === 'string'\n\t\t\t\t? (assets as TLAssetId[])\n\t\t\t\t: (assets as TLAsset[]).map((a) => a.id)\n\t\tthis._deleteAssets(ids)\n\t\treturn this\n\t}\n\t/** @internal */\n\tprivate _deleteAssets = this.history.createCommand(\n\t\t'deleteAssets',\n\t\t(ids: TLAssetId[]) => {\n\t\t\tif (this.getInstanceState().isReadonly) return\n\t\t\tif (ids.length <= 0) return\n\n\t\t\tconst prev = compact(ids.map((id) => this.store.get(id)))\n\n\t\t\treturn { data: { ids, prev } }\n\t\t},\n\t\t{\n\t\t\tdo: ({ ids }) => {\n\t\t\t\tthis.store.remove(ids)\n\t\t\t},\n\t\t\tundo: ({ prev }) => {\n\t\t\t\tthis.store.put(prev)\n\t\t\t},\n\t\t}\n\t)\n\n\t/**\n\t * Get an asset by its id.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getAsset('asset1')\n\t * ```\n\t *\n\t * @param asset - The asset (or asset id) to get.\n\t *\n\t * @public\n\t */\n\tgetAsset(asset: TLAssetId | TLAsset): TLAsset | undefined {\n\t\treturn this.store.get(typeof asset === 'string' ? asset : asset.id) as TLAsset | undefined\n\t}\n\n\t/* --------------------- Shapes --------------------- */\n\n\t@computed\n\tprivate _getShapeGeometryCache(): ComputedCache<Geometry2d, TLShape> {\n\t\treturn this.store.createComputedCache(\n\t\t\t'bounds',\n\t\t\t(shape) => this.getShapeUtil(shape).getGeometry(shape),\n\t\t\t(a, b) => a.props === b.props\n\t\t)\n\t}\n\n\t/**\n\t * Get the geometry of a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapeGeometry(myShape)\n\t * editor.getShapeGeometry(myShapeId)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) to get the geometry for.\n\t *\n\t * @public\n\t */\n\tgetShapeGeometry<T extends Geometry2d>(shape: TLShape | TLShapeId): T {\n\t\treturn this._getShapeGeometryCache().get(typeof shape === 'string' ? shape : shape.id)! as T\n\t}\n\n\t/** @internal */\n\t@computed private _getShapeHandlesCache(): ComputedCache<TLHandle[] | undefined, TLShape> {\n\t\treturn this.store.createComputedCache('handles', (shape) => {\n\t\t\treturn this.getShapeUtil(shape).getHandles?.(shape)\n\t\t})\n\t}\n\n\t/**\n\t * Get the handles (if any) for a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapeHandles(myShape)\n\t * editor.getShapeHandles(myShapeId)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) to get the handles for.\n\t * @public\n\t */\n\tgetShapeHandles<T extends TLShape>(shape: T | T['id']): TLHandle[] | undefined {\n\t\treturn this._getShapeHandlesCache().get(typeof shape === 'string' ? shape : shape.id)\n\t}\n\n\t/**\n\t * Get the local transform for a shape as a matrix model. This transform reflects both its\n\t * translation (x, y) from from either its parent's top left corner, if the shape's parent is\n\t * another shape, or else from the 0,0 of the page, if the shape's parent is the page; and the\n\t * shape's rotation.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapeLocalTransform(myShape)\n\t * ```\n\t *\n\t * @param shape - The shape to get the local transform for.\n\t *\n\t * @public\n\t */\n\tgetShapeLocalTransform(shape: TLShape | TLShapeId): Mat {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tconst freshShape = this.getShape(id)\n\t\tif (!freshShape) throw Error('Editor.getTransform: shape not found')\n\t\treturn Mat.Identity().translate(freshShape.x, freshShape.y).rotate(freshShape.rotation)\n\t}\n\n\t/**\n\t * A cache of page transforms.\n\t *\n\t * @internal\n\t */\n\t@computed private _getShapePageTransformCache(): ComputedCache<Mat, TLShape> {\n\t\treturn this.store.createComputedCache<Mat, TLShape>('pageTransformCache', (shape) => {\n\t\t\tif (isPageId(shape.parentId)) {\n\t\t\t\treturn this.getShapeLocalTransform(shape)\n\t\t\t}\n\n\t\t\t// If the shape's parent doesn't exist yet (e.g. when merging in changes from remote in the wrong order)\n\t\t\t// then we can't compute the transform yet, so just return the identity matrix.\n\t\t\t// In the future we should look at creating a store update mechanism that understands and preserves\n\t\t\t// ordering.\n\t\t\tconst parentTransform =\n\t\t\t\tthis._getShapePageTransformCache().get(shape.parentId) ?? Mat.Identity()\n\t\t\treturn Mat.Compose(parentTransform, this.getShapeLocalTransform(shape)!)\n\t\t})\n\t}\n\n\t/**\n\t * Get the local transform of a shape's parent as a matrix model.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapeParentTransform(myShape)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) to get the parent transform for.\n\t *\n\t * @public\n\t */\n\tgetShapeParentTransform(shape: TLShape | TLShapeId): Mat {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tconst freshShape = this.getShape(id)\n\t\tif (!freshShape || isPageId(freshShape.parentId)) return Mat.Identity()\n\t\treturn this._getShapePageTransformCache().get(freshShape.parentId) ?? Mat.Identity()\n\t}\n\n\t/**\n\t * Get the transform of a shape in the current page space.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapePageTransform(myShape)\n\t * editor.getShapePageTransform(myShapeId)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) to get the page transform for.\n\t *\n\t * @public\n\t */\n\tgetShapePageTransform(shape: TLShape | TLShapeId): Mat {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\treturn this._getShapePageTransformCache().get(id) ?? Mat.Identity()\n\t}\n\n\t/** @internal */\n\t@computed private _getShapePageBoundsCache(): ComputedCache<Box, TLShape> {\n\t\treturn this.store.createComputedCache<Box, TLShape>('pageBoundsCache', (shape) => {\n\t\t\tconst pageTransform = this._getShapePageTransformCache().get(shape.id)\n\n\t\t\tif (!pageTransform) return new Box()\n\n\t\t\tconst result = Box.FromPoints(\n\t\t\t\tMat.applyToPoints(pageTransform, this.getShapeGeometry(shape).vertices)\n\t\t\t)\n\n\t\t\treturn result\n\t\t})\n\t}\n\n\t/**\n\t * Get the bounds of a shape in the current page space.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapePageBounds(myShape)\n\t * editor.getShapePageBounds(myShapeId)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) to get the bounds for.\n\t *\n\t * @public\n\t */\n\tgetShapePageBounds(shape: TLShape | TLShapeId): Box | undefined {\n\t\treturn this._getShapePageBoundsCache().get(typeof shape === 'string' ? shape : shape.id)\n\t}\n\n\t/**\n\t * A cache of clip paths used for clipping.\n\t *\n\t * @internal\n\t */\n\t@computed private _getShapeClipPathCache(): ComputedCache<string, TLShape> {\n\t\treturn this.store.createComputedCache<string, TLShape>('clipPathCache', (shape) => {\n\t\t\tconst pageMask = this._getShapeMaskCache().get(shape.id)\n\t\t\tif (!pageMask) return undefined\n\t\t\tif (pageMask.length === 0) {\n\t\t\t\treturn `polygon(0px 0px, 0px 0px, 0px 0px)`\n\t\t\t}\n\n\t\t\tconst pageTransform = this._getShapePageTransformCache().get(shape.id)\n\t\t\tif (!pageTransform) return undefined\n\n\t\t\tconst localMask = Mat.applyToPoints(Mat.Inverse(pageTransform), pageMask)\n\n\t\t\treturn `polygon(${localMask.map((p) => `${p.x}px ${p.y}px`).join(',')})`\n\t\t})\n\t}\n\n\t/**\n\t * Get the clip path for a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * const clipPath = editor.getShapeClipPath(shape)\n\t * const clipPath = editor.getShapeClipPath(shape.id)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) to get the clip path for.\n\t *\n\t * @returns The clip path or undefined.\n\t *\n\t * @public\n\t */\n\tgetShapeClipPath(shape: TLShape | TLShapeId): string | undefined {\n\t\treturn this._getShapeClipPathCache().get(typeof shape === 'string' ? shape : shape.id)\n\t}\n\n\t/** @internal */\n\t@computed private _getShapeMaskCache(): ComputedCache<Vec[], TLShape> {\n\t\treturn this.store.createComputedCache('pageMaskCache', (shape) => {\n\t\t\tif (isPageId(shape.parentId)) return undefined\n\n\t\t\tconst frameAncestors = this.getShapeAncestors(shape.id).filter((shape) =>\n\t\t\t\tthis.isShapeOfType<TLFrameShape>(shape, 'frame')\n\t\t\t)\n\n\t\t\tif (frameAncestors.length === 0) return undefined\n\n\t\t\tconst pageMask = frameAncestors\n\t\t\t\t.map<Vec[] | undefined>((s) =>\n\t\t\t\t\t// Apply the frame transform to the frame outline to get the frame outline in the current page space\n\t\t\t\t\tthis._getShapePageTransformCache()\n\t\t\t\t\t\t.get(s.id)!\n\t\t\t\t\t\t.applyToPoints(this.getShapeGeometry(s).vertices)\n\t\t\t\t)\n\t\t\t\t.reduce((acc, b) => {\n\t\t\t\t\tif (!(b && acc)) return undefined\n\t\t\t\t\tconst intersection = intersectPolygonPolygon(acc, b)\n\t\t\t\t\tif (intersection) {\n\t\t\t\t\t\treturn intersection.map(Vec.Cast)\n\t\t\t\t\t}\n\t\t\t\t\treturn []\n\t\t\t\t})\n\n\t\t\treturn pageMask\n\t\t})\n\t}\n\n\t/**\n\t * Get the mask (in the current page space) for a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * const pageMask = editor.getShapeMask(shape.id)\n\t * ```\n\t *\n\t * @param id - The id of the shape to get the mask for.\n\t *\n\t * @returns The mask for the shape.\n\t *\n\t * @public\n\t */\n\tgetShapeMask(shape: TLShapeId | TLShape): VecLike[] | undefined {\n\t\treturn this._getShapeMaskCache().get(typeof shape === 'string' ? shape : shape.id)\n\t}\n\n\t/**\n\t * Get the bounds of a shape in the current page space, incorporating any masks. For example, if the\n\t * shape were the child of a frame and was half way out of the frame, the bounds would be the half\n\t * of the shape that was in the frame.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapeMaskedPageBounds(myShape)\n\t * editor.getShapeMaskedPageBounds(myShapeId)\n\t * ```\n\t *\n\t * @param shape - The shape to get the masked bounds for.\n\t *\n\t * @public\n\t */\n\tgetShapeMaskedPageBounds(shape: TLShapeId | TLShape): Box | undefined {\n\t\tif (typeof shape !== 'string') shape = shape.id\n\t\treturn this._getShapeMaskedPageBoundsCache().get(shape)\n\t}\n\n\t/** @internal */\n\t@computed private _getShapeMaskedPageBoundsCache(): ComputedCache<Box, TLShape> {\n\t\treturn this.store.createComputedCache('shapeMaskedPageBoundsCache', (shape) => {\n\t\t\tconst pageBounds = this._getShapePageBoundsCache().get(shape.id)\n\t\t\tif (!pageBounds) return\n\t\t\tconst pageMask = this._getShapeMaskCache().get(shape.id)\n\t\t\tif (pageMask) {\n\t\t\t\tif (pageMask.length === 0) return undefined\n\t\t\t\tconst { corners } = pageBounds\n\t\t\t\tif (corners.every((p, i) => p && Vec.Equals(p, pageMask[i]))) return pageBounds.clone()\n\t\t\t\tconst intersection = intersectPolygonPolygon(pageMask, corners)\n\t\t\t\tif (!intersection) return\n\t\t\t\treturn Box.FromPoints(intersection)\n\t\t\t}\n\t\t\treturn pageBounds\n\t\t})\n\t}\n\n\t/**\n\t * Get the ancestors of a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * const ancestors = editor.getShapeAncestors(myShape)\n\t * const ancestors = editor.getShapeAncestors(myShapeId)\n\t * ```\n\t *\n\t * @param shape - The shape (or shape id) to get the ancestors for.\n\t *\n\t * @public\n\t */\n\tgetShapeAncestors(shape: TLShapeId | TLShape, acc: TLShape[] = []): TLShape[] {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tconst freshShape = this.getShape(id)\n\t\tif (!freshShape) return acc\n\t\tconst parentId = freshShape.parentId\n\t\tif (isPageId(parentId)) {\n\t\t\tacc.reverse()\n\t\t\treturn acc\n\t\t}\n\n\t\tconst parent = this.store.get(parentId)\n\t\tif (!parent) return acc\n\t\tacc.push(parent)\n\t\treturn this.getShapeAncestors(parent, acc)\n\t}\n\n\t/**\n\t * Find the first ancestor matching the given predicate\n\t *\n\t * @example\n\t * ```ts\n\t * const ancestor = editor.findShapeAncestor(myShape)\n\t * const ancestor = editor.findShapeAncestor(myShape.id)\n\t * const ancestor = editor.findShapeAncestor(myShape.id, (shape) => shape.type === 'frame')\n\t * ```\n\t *\n\t * @param shape - The shape to check the ancestors for.\n\t *\n\t * @public\n\t */\n\tfindShapeAncestor(\n\t\tshape: TLShape | TLShapeId,\n\t\tpredicate: (parent: TLShape) => boolean\n\t): TLShape | undefined {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tconst freshShape = this.getShape(id)\n\t\tif (!freshShape) return\n\n\t\tconst parentId = freshShape.parentId\n\t\tif (isPageId(parentId)) return\n\n\t\tconst parent = this.getShape(parentId)\n\t\tif (!parent) return\n\t\treturn predicate(parent) ? parent : this.findShapeAncestor(parent, predicate)\n\t}\n\n\t/**\n\t * Returns true if the the given shape has the given ancestor.\n\t *\n\t * @param shape - The shape.\n\t * @param ancestorId - The id of the ancestor.\n\t *\n\t * @public\n\t */\n\thasAncestor(shape: TLShape | TLShapeId | undefined, ancestorId: TLShapeId): boolean {\n\t\tconst id = typeof shape === 'string' ? shape : shape?.id\n\t\tconst freshShape = id && this.getShape(id)\n\t\tif (!freshShape) return false\n\t\tif (freshShape.parentId === ancestorId) return true\n\t\treturn this.hasAncestor(this.getShapeParent(freshShape), ancestorId)\n\t}\n\n\t/**\n\t * Get the common ancestor of two or more shapes that matches a predicate.\n\t *\n\t * @param shapes - The shapes (or shape ids) to check.\n\t * @param predicate - The predicate to match.\n\t */\n\tfindCommonAncestor(\n\t\tshapes: TLShape[] | TLShapeId[],\n\t\tpredicate?: (shape: TLShape) => boolean\n\t): TLShapeId | undefined {\n\t\tif (shapes.length === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\t\tconst freshShapes = compact(ids.map((id) => this.getShape(id)))\n\n\t\tif (freshShapes.length === 1) {\n\t\t\tconst parentId = freshShapes[0].parentId\n\t\t\tif (isPageId(parentId)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn predicate ? this.findShapeAncestor(freshShapes[0], predicate)?.id : parentId\n\t\t}\n\n\t\tconst [nodeA, ...others] = freshShapes\n\t\tlet ancestor = this.getShapeParent(nodeA)\n\t\twhile (ancestor) {\n\t\t\t// TODO: this is not ideal, optimize\n\t\t\tif (predicate && !predicate(ancestor)) {\n\t\t\t\tancestor = this.getShapeParent(ancestor)\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tif (others.every((shape) => this.hasAncestor(shape, ancestor!.id))) {\n\t\t\t\treturn ancestor!.id\n\t\t\t}\n\t\t\tancestor = this.getShapeParent(ancestor)\n\t\t}\n\t\treturn undefined\n\t}\n\n\t/**\n\t * Check whether a shape or its parent is locked.\n\t *\n\t * @param shape - The shape (or shape id) to check.\n\t *\n\t * @public\n\t */\n\tisShapeOrAncestorLocked(shape?: TLShape): boolean\n\tisShapeOrAncestorLocked(id?: TLShapeId): boolean\n\tisShapeOrAncestorLocked(arg?: TLShape | TLShapeId): boolean {\n\t\tconst shape = typeof arg === 'string' ? this.getShape(arg) : arg\n\t\tif (shape === undefined) return false\n\t\tif (shape.isLocked) return true\n\t\treturn this.isShapeOrAncestorLocked(this.getShapeParent(shape))\n\t}\n\n\t@computed\n\tprivate _notVisibleShapes() {\n\t\treturn notVisibleShapes(this)\n\t}\n\n\t/**\n\t * Get culled shapes.\n\t *\n\t * @public\n\t */\n\t@computed\n\tgetCulledShapes() {\n\t\tconst notVisibleShapes = this._notVisibleShapes().get()\n\t\tconst selectedShapeIds = this.getSelectedShapeIds()\n\t\tconst editingId = this.getEditingShapeId()\n\t\tconst culledShapes = new Set<TLShapeId>(notVisibleShapes)\n\t\t// we don't cull the shape we are editing\n\t\tif (editingId) {\n\t\t\tculledShapes.delete(editingId)\n\t\t}\n\t\t// we also don't cull selected shapes\n\t\tselectedShapeIds.forEach((id) => {\n\t\t\tculledShapes.delete(id)\n\t\t})\n\t\treturn culledShapes\n\t}\n\n\t/**\n\t * The bounds of the current page (the common bounds of all of the shapes on the page).\n\t *\n\t * @public\n\t */\n\t@computed getCurrentPageBounds(): Box | undefined {\n\t\tlet commonBounds: Box | undefined\n\n\t\tthis.getCurrentPageShapeIdsSorted().forEach((shapeId) => {\n\t\t\tconst bounds = this.getShapeMaskedPageBounds(shapeId)\n\t\t\tif (!bounds) return\n\t\t\tif (!commonBounds) {\n\t\t\t\tcommonBounds = bounds.clone()\n\t\t\t} else {\n\t\t\t\tcommonBounds = commonBounds.expand(bounds)\n\t\t\t}\n\t\t})\n\n\t\treturn commonBounds\n\t}\n\n\t/**\n\t * Get the top-most selected shape at the given point, ignoring groups.\n\t *\n\t * @param point - The point to check.\n\t *\n\t * @returns The top-most selected shape at the given point, or undefined if there is no shape at the point.\n\t */\n\tgetSelectedShapeAtPoint(point: VecLike): TLShape | undefined {\n\t\tconst selectedShapeIds = this.getSelectedShapeIds()\n\t\treturn this.getCurrentPageShapesSorted()\n\t\t\t.filter((shape) => shape.type !== 'group' && selectedShapeIds.includes(shape.id))\n\t\t\t.reverse() // findlast\n\t\t\t.find((shape) => this.isPointInShape(shape, point, { hitInside: true, margin: 0 }))\n\t}\n\n\t/**\n\t * Get the shape at the current point.\n\t *\n\t * @param point - The point to check.\n\t * @param opts - Options for the check: `hitInside` to check if the point is inside the shape, `margin` to check if the point is within a margin of the shape, `hitFrameInside` to check if the point is inside the frame, and `filter` to filter the shapes to check.\n\t *\n\t * @returns The shape at the given point, or undefined if there is no shape at the point.\n\t */\n\tgetShapeAtPoint(\n\t\tpoint: VecLike,\n\t\topts = {} as {\n\t\t\trenderingOnly?: boolean\n\t\t\tmargin?: number\n\t\t\thitInside?: boolean\n\t\t\t// TODO: we probably need to rename this, we don't quite _always_\n\t\t\t// respect this esp. in the part below that does \"Check labels first\"\n\t\t\thitLabels?: boolean\n\t\t\thitFrameInside?: boolean\n\t\t\tfilter?: (shape: TLShape) => boolean\n\t\t}\n\t): TLShape | undefined {\n\t\tconst zoomLevel = this.getZoomLevel()\n\t\tconst viewportPageBounds = this.getViewportPageBounds()\n\t\tconst {\n\t\t\tfilter,\n\t\t\tmargin = 0,\n\t\t\thitLabels = false,\n\t\t\thitInside = false,\n\t\t\thitFrameInside = false,\n\t\t} = opts\n\n\t\tlet inHollowSmallestArea = Infinity\n\t\tlet inHollowSmallestAreaHit: TLShape | null = null\n\n\t\tlet inMarginClosestToEdgeDistance = Infinity\n\t\tlet inMarginClosestToEdgeHit: TLShape | null = null\n\n\t\tconst shapesToCheck = (\n\t\t\topts.renderingOnly\n\t\t\t\t? this.getCurrentPageRenderingShapesSorted()\n\t\t\t\t: this.getCurrentPageShapesSorted()\n\t\t).filter((shape) => {\n\t\t\tif (this.isShapeOfType(shape, 'group')) return false\n\t\t\tconst pageMask = this.getShapeMask(shape)\n\t\t\tif (pageMask && !pointInPolygon(point, pageMask)) return false\n\t\t\tif (filter) return filter(shape)\n\t\t\treturn true\n\t\t})\n\t\tfor (let i = shapesToCheck.length - 1; i >= 0; i--) {\n\t\t\tconst shape = shapesToCheck[i]\n\t\t\tconst geometry = this.getShapeGeometry(shape)\n\t\t\tconst isGroup = geometry instanceof Group2d\n\n\t\t\tconst pointInShapeSpace = this.getPointInShapeSpace(shape, point)\n\n\t\t\t// Check labels first\n\t\t\tif (\n\t\t\t\tthis.isShapeOfType<TLArrowShape>(shape, 'arrow') ||\n\t\t\t\t(this.isShapeOfType<TLGeoShape>(shape, 'geo') && shape.props.fill === 'none')\n\t\t\t) {\n\t\t\t\tif (shape.props.text.trim()) {\n\t\t\t\t\t// let's check whether the shape has a label and check that\n\t\t\t\t\tfor (const childGeometry of (geometry as Group2d).children) {\n\t\t\t\t\t\tif (childGeometry.isLabel && childGeometry.isPointInBounds(pointInShapeSpace)) {\n\t\t\t\t\t\t\treturn shape\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.isShapeOfType(shape, 'frame')) {\n\t\t\t\t// On the rare case that we've hit a frame, test again hitInside to be forced true;\n\t\t\t\t// this prevents clicks from passing through the body of a frame to shapes behhind it.\n\n\t\t\t\t// If the hit is within the frame's outer margin, then select the frame\n\t\t\t\tconst distance = geometry.distanceToPoint(pointInShapeSpace, hitInside)\n\t\t\t\tif (Math.abs(distance) <= margin) {\n\t\t\t\t\treturn inMarginClosestToEdgeHit || shape\n\t\t\t\t}\n\n\t\t\t\tif (geometry.hitTestPoint(pointInShapeSpace, 0, true)) {\n\t\t\t\t\t// Once we've hit a frame, we want to end the search. If we have hit a shape\n\t\t\t\t\t// already, then this would either be above the frame or a child of the frame,\n\t\t\t\t\t// so we want to return that. Otherwise, the point is in the empty space of the\n\t\t\t\t\t// frame. If `hitFrameInside` is true (e.g. used drawing an arrow into the\n\t\t\t\t\t// frame) we the frame itself; other wise, (e.g. when hovering or pointing)\n\t\t\t\t\t// we would want to return null.\n\t\t\t\t\treturn (\n\t\t\t\t\t\tinMarginClosestToEdgeHit ||\n\t\t\t\t\t\tinHollowSmallestAreaHit ||\n\t\t\t\t\t\t(hitFrameInside ? shape : undefined)\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tlet distance: number\n\n\t\t\tif (isGroup) {\n\t\t\t\tlet minDistance = Infinity\n\t\t\t\tfor (const childGeometry of geometry.children) {\n\t\t\t\t\tif (childGeometry.isLabel && !hitLabels) continue\n\n\t\t\t\t\t// hit test the all of the child geometries that aren't labels\n\t\t\t\t\tconst tDistance = childGeometry.distanceToPoint(pointInShapeSpace, hitInside)\n\t\t\t\t\tif (tDistance < minDistance) {\n\t\t\t\t\t\tminDistance = tDistance\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdistance = minDistance\n\t\t\t} else {\n\t\t\t\t// If the margin is zero and the geometry has a very small width or height,\n\t\t\t\t// then check the actual distance. This is to prevent a bug where straight\n\t\t\t\t// lines would never pass the broad phase (point-in-bounds) check.\n\t\t\t\tif (margin === 0 && (geometry.bounds.w < 1 || geometry.bounds.h < 1)) {\n\t\t\t\t\tdistance = geometry.distanceToPoint(pointInShapeSpace, hitInside)\n\t\t\t\t} else {\n\t\t\t\t\t// Broad phase\n\t\t\t\t\tif (geometry.bounds.containsPoint(pointInShapeSpace, margin)) {\n\t\t\t\t\t\t// Narrow phase (actual distance)\n\t\t\t\t\t\tdistance = geometry.distanceToPoint(pointInShapeSpace, hitInside)\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Failed the broad phase, geddafugaotta'ere!\n\t\t\t\t\t\tdistance = Infinity\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (geometry.isClosed) {\n\t\t\t\t// For closed shapes, the distance will be positive if outside of\n\t\t\t\t// the shape or negative if inside of the shape. If the distance\n\t\t\t\t// is greater than the margin, then it's a miss. Otherwise...\n\n\t\t\t\tif (distance <= margin) {\n\t\t\t\t\tif (geometry.isFilled || (isGroup && geometry.children[0].isFilled)) {\n\t\t\t\t\t\t// If the shape is filled, then it's a hit. Remember, we're\n\t\t\t\t\t\t// starting from the TOP-MOST shape in z-index order, so any\n\t\t\t\t\t\t// other hits would be occluded by the shape.\n\t\t\t\t\t\treturn inMarginClosestToEdgeHit || shape\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If the shape is bigger than the viewport, then skip it.\n\t\t\t\t\t\tif (this.getShapePageBounds(shape)!.contains(viewportPageBounds)) continue\n\n\t\t\t\t\t\t// For hollow shapes...\n\t\t\t\t\t\tif (Math.abs(distance) < margin) {\n\t\t\t\t\t\t\t// We want to preference shapes where we're inside of the\n\t\t\t\t\t\t\t// shape margin; and we would want to hit the shape with the\n\t\t\t\t\t\t\t// edge closest to the point.\n\t\t\t\t\t\t\tif (Math.abs(distance) < inMarginClosestToEdgeDistance) {\n\t\t\t\t\t\t\t\tinMarginClosestToEdgeDistance = Math.abs(distance)\n\t\t\t\t\t\t\t\tinMarginClosestToEdgeHit = shape\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (!inMarginClosestToEdgeHit) {\n\t\t\t\t\t\t\t// If we're not within margin distnce to any edge, and if the\n\t\t\t\t\t\t\t// shape is hollow, then we want to hit the shape with the\n\t\t\t\t\t\t\t// smallest area. (There's a bug here with self-intersecting\n\t\t\t\t\t\t\t// shapes, like a closed drawing of an \"8\", but that's a bigger\n\t\t\t\t\t\t\t// problem to solve.)\n\t\t\t\t\t\t\tconst { area } = geometry\n\t\t\t\t\t\t\tif (area < inHollowSmallestArea) {\n\t\t\t\t\t\t\t\tinHollowSmallestArea = area\n\t\t\t\t\t\t\t\tinHollowSmallestAreaHit = shape\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// For open shapes (e.g. lines or draw shapes) always use the margin.\n\t\t\t\t// If the distance is less than the margin, return the shape as the hit.\n\t\t\t\tif (distance < HIT_TEST_MARGIN / zoomLevel) {\n\t\t\t\t\treturn shape\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If we haven't hit any filled shapes or frames, then return either\n\t\t// the shape who we hit within the margin (and of those, the one that\n\t\t// had the shortest distance between the point and the shape edge),\n\t\t// or else the hollow shape with the smallest area\u2014or if we didn't hit\n\t\t// any margins or any hollow shapes, then null.\n\t\treturn inMarginClosestToEdgeHit || inHollowSmallestAreaHit || undefined\n\t}\n\n\t/**\n\t * Get the shapes, if any, at a given page point.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapesAtPoint({ x: 100, y: 100 })\n\t * editor.getShapesAtPoint({ x: 100, y: 100 }, { hitInside: true, exact: true })\n\t * ```\n\t *\n\t * @param point - The page point to test.\n\t *\n\t * @public\n\t */\n\tgetShapesAtPoint(\n\t\tpoint: VecLike,\n\t\topts = {} as { margin?: number; hitInside?: boolean }\n\t): TLShape[] {\n\t\treturn this.getCurrentPageShapes().filter((shape) => this.isPointInShape(shape, point, opts))\n\t}\n\n\t/**\n\t * Test whether a point (in the current page space) will will a shape. This method takes into account masks,\n\t * such as when a shape is the child of a frame and is partially clipped by the frame.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.isPointInShape({ x: 100, y: 100 }, myShape)\n\t * ```\n\t *\n\t * @param shape - The shape to test against.\n\t * @param point - The page point to test (in the current page space).\n\t * @param hitInside - Whether to count as a hit if the point is inside of a closed shape.\n\t *\n\t * @public\n\t */\n\tisPointInShape(\n\t\tshape: TLShape | TLShapeId,\n\t\tpoint: VecLike,\n\t\topts = {} as {\n\t\t\tmargin?: number\n\t\t\thitInside?: boolean\n\t\t}\n\t): boolean {\n\t\tconst { hitInside = false, margin = 0 } = opts\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\t// If the shape is masked, and if the point falls outside of that\n\t\t// mask, then it's defintely a miss\u2014we don't need to test further.\n\t\tconst pageMask = this.getShapeMask(id)\n\t\tif (pageMask && !pointInPolygon(point, pageMask)) return false\n\n\t\treturn this.getShapeGeometry(id).hitTestPoint(\n\t\t\tthis.getPointInShapeSpace(shape, point),\n\t\t\tmargin,\n\t\t\thitInside\n\t\t)\n\t}\n\n\t/**\n\t * Convert a point in the current page space to a point in the local space of a shape. For example, if a\n\t * shape's page point were `{ x: 100, y: 100 }`, a page point at `{ x: 110, y: 110 }` would be at\n\t * `{ x: 10, y: 10 }` in the shape's local space.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getPointInShapeSpace(myShape, { x: 100, y: 100 })\n\t * ```\n\t *\n\t * @param shape - The shape to get the point in the local space of.\n\t * @param point - The page point to get in the local space of the shape.\n\t *\n\t * @public\n\t */\n\tgetPointInShapeSpace(shape: TLShape | TLShapeId, point: VecLike): Vec {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\treturn this._getShapePageTransformCache().get(id)!.clone().invert().applyToPoint(point)\n\t}\n\n\t/**\n\t * Convert a delta in the current page space to a point in the local space of a shape's parent.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getPointInParentSpace(myShape.id, { x: 100, y: 100 })\n\t * ```\n\t *\n\t * @param shape - The shape to get the point in the local space of.\n\t * @param point - The page point to get in the local space of the shape.\n\t *\n\t * @public\n\t */\n\tgetPointInParentSpace(shape: TLShapeId | TLShape, point: VecLike): Vec {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tconst freshShape = this.getShape(id)\n\t\tif (!freshShape) return new Vec(0, 0)\n\t\tif (isPageId(freshShape.parentId)) return Vec.From(point)\n\n\t\tconst parentTransform = this.getShapePageTransform(freshShape.parentId)\n\t\tif (!parentTransform) return Vec.From(point)\n\t\treturn parentTransform.clone().invert().applyToPoint(point)\n\t}\n\n\t/**\n\t * An array containing all of the shapes in the current page.\n\t *\n\t * @public\n\t */\n\t@computed getCurrentPageShapes(): TLShape[] {\n\t\treturn Array.from(this.getCurrentPageShapeIds(), (id) => this.store.get(id)! as TLShape)\n\t}\n\n\t/**\n\t * An array containing all of the shapes in the current page, sorted in z-index order (accounting\n\t * for nested shapes): e.g. A, B, BA, BB, C.\n\t *\n\t * @public\n\t */\n\t@computed getCurrentPageShapesSorted(): TLShape[] {\n\t\tconst result: TLShape[] = []\n\t\tconst topLevelShapes = this.getSortedChildIdsForParent(this.getCurrentPageId())\n\n\t\tfor (let i = 0, n = topLevelShapes.length; i < n; i++) {\n\t\t\tpushShapeWithDescendants(this, topLevelShapes[i], result)\n\t\t}\n\n\t\treturn result\n\t}\n\n\t/**\n\t * An array containing all of the rendering shapes in the current page, sorted in z-index order (accounting\n\t * for nested shapes): e.g. A, B, BA, BB, C.\n\t *\n\t * @public\n\t */\n\t@computed getCurrentPageRenderingShapesSorted(): TLShape[] {\n\t\tconst culledShapes = this.getCulledShapes()\n\t\treturn this.getCurrentPageShapesSorted().filter(({ id }) => !culledShapes.has(id))\n\t}\n\n\t/**\n\t * Get whether a shape matches the type of a TLShapeUtil.\n\t *\n\t * @example\n\t * ```ts\n\t * const isArrowShape = isShapeOfType<TLArrowShape>(someShape, 'arrow')\n\t * ```\n\t *\n\t * @param util - the TLShapeUtil constructor to test against\n\t * @param shape - the shape to test\n\t *\n\t * @public\n\t */\n\tisShapeOfType<T extends TLUnknownShape>(shape: TLUnknownShape, type: T['type']): shape is T\n\tisShapeOfType<T extends TLUnknownShape>(\n\t\tshapeId: TLUnknownShape['id'],\n\t\ttype: T['type']\n\t): shapeId is T['id']\n\tisShapeOfType<T extends TLUnknownShape>(\n\t\targ: TLUnknownShape | TLUnknownShape['id'],\n\t\ttype: T['type']\n\t) {\n\t\tconst shape = typeof arg === 'string' ? this.getShape(arg) : arg\n\t\tif (!shape) return false\n\t\treturn shape.type === type\n\t}\n\n\t/**\n\t * Get a shape by its id.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShape('box1')\n\t * ```\n\t *\n\t * @param id - The id of the shape to get.\n\t *\n\t * @public\n\t */\n\tgetShape<T extends TLShape = TLShape>(shape: TLShape | TLParentId): T | undefined {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tif (!isShapeId(id)) return undefined\n\t\treturn this.store.get(id) as T\n\t}\n\n\t/**\n\t * Get the parent shape for a given shape. Returns undefined if the shape is the direct child of\n\t * the page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getShapeParent(myShape)\n\t * ```\n\t *\n\t * @public\n\t */\n\tgetShapeParent(shape?: TLShape | TLShapeId): TLShape | undefined {\n\t\tconst id = typeof shape === 'string' ? shape : shape?.id\n\t\tif (!id) return undefined\n\t\tconst freshShape = this.getShape(id)\n\t\tif (freshShape === undefined || !isShapeId(freshShape.parentId)) return undefined\n\t\treturn this.store.get(freshShape.parentId)\n\t}\n\n\t/**\n\t * If siblingShape and targetShape are siblings, this returns targetShape. If targetShape has an\n\t * ancestor who is a sibling of siblingShape, this returns that ancestor. Otherwise, this returns\n\t * undefined.\n\t *\n\t * @internal\n\t */\n\tprivate getShapeNearestSibling(\n\t\tsiblingShape: TLShape,\n\t\ttargetShape: TLShape | undefined\n\t): TLShape | undefined {\n\t\tif (!targetShape) {\n\t\t\treturn undefined\n\t\t}\n\t\tif (targetShape.parentId === siblingShape.parentId) {\n\t\t\treturn targetShape\n\t\t}\n\n\t\tconst ancestor = this.findShapeAncestor(\n\t\t\ttargetShape,\n\t\t\t(ancestor) => ancestor.parentId === siblingShape.parentId\n\t\t)\n\n\t\treturn ancestor\n\t}\n\n\t/**\n\t * Get whether the given shape is the descendant of the given page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.isShapeInPage(myShape)\n\t * editor.isShapeInPage(myShape, 'page1')\n\t * ```\n\t *\n\t * @param shape - The shape to check.\n\t * @param pageId - The id of the page to check against. Defaults to the current page.\n\t *\n\t * @public\n\t */\n\tisShapeInPage(shape: TLShape | TLShapeId, pageId = this.getCurrentPageId()): boolean {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tconst shapeToCheck = this.getShape(id)\n\t\tif (!shapeToCheck) return false\n\n\t\tlet shapeIsInPage = false\n\n\t\tif (shapeToCheck.parentId === pageId) {\n\t\t\tshapeIsInPage = true\n\t\t} else {\n\t\t\tlet parent = this.getShape(shapeToCheck.parentId)\n\t\t\tisInPageSearch: while (parent) {\n\t\t\t\tif (parent.parentId === pageId) {\n\t\t\t\t\tshapeIsInPage = true\n\t\t\t\t\tbreak isInPageSearch\n\t\t\t\t}\n\t\t\t\tparent = this.getShape(parent.parentId)\n\t\t\t}\n\t\t}\n\n\t\treturn shapeIsInPage\n\t}\n\n\t/**\n\t * Get the id of the containing page for a given shape.\n\t *\n\t * @param shape - The shape to get the page id for.\n\t *\n\t * @returns The id of the page that contains the shape, or undefined if the shape is undefined.\n\t *\n\t * @public\n\t */\n\tgetAncestorPageId(shape?: TLShape | TLShapeId): TLPageId | undefined {\n\t\tconst id = typeof shape === 'string' ? shape : shape?.id\n\t\tconst _shape = id && this.getShape(id)\n\t\tif (!_shape) return undefined\n\t\tif (isPageId(_shape.parentId)) {\n\t\t\treturn _shape.parentId\n\t\t} else {\n\t\t\treturn this.getAncestorPageId(this.getShape(_shape.parentId))\n\t\t}\n\t}\n\n\t// Parents and children\n\n\t/**\n\t * A cache of parents to children.\n\t *\n\t * @internal\n\t */\n\tprivate readonly _parentIdsToChildIds: ReturnType<typeof parentsToChildren>\n\n\t/**\n\t * Reparent shapes to a new parent. This operation preserves the shape's current page positions /\n\t * rotations.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.reparentShapes([box1, box2], 'frame1')\n\t * editor.reparentShapes([box1.id, box2.id], 'frame1')\n\t * editor.reparentShapes([box1.id, box2.id], 'frame1', 4)\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) of the shapes to reparent.\n\t * @param parentId - The id of the new parent shape.\n\t * @param insertIndex - The index to insert the children.\n\t *\n\t * @public\n\t */\n\treparentShapes(shapes: TLShapeId[] | TLShape[], parentId: TLParentId, insertIndex?: IndexKey) {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string' ? (shapes as TLShapeId[]) : shapes.map((s) => (s as TLShape).id)\n\t\tif (ids.length === 0) return this\n\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tconst parentTransform = isPageId(parentId)\n\t\t\t? Mat.Identity()\n\t\t\t: this.getShapePageTransform(parentId)!\n\n\t\tconst parentPageRotation = parentTransform.rotation()\n\n\t\tlet indices: IndexKey[] = []\n\n\t\tconst sibs = compact(this.getSortedChildIdsForParent(parentId).map((id) => this.getShape(id)))\n\n\t\tif (insertIndex) {\n\t\t\tconst sibWithInsertIndex = sibs.find((s) => s.index === insertIndex)\n\t\t\tif (sibWithInsertIndex) {\n\t\t\t\t// If there's a sibling with the same index as the insert index...\n\t\t\t\tconst sibAbove = sibs[sibs.indexOf(sibWithInsertIndex) + 1]\n\t\t\t\tif (sibAbove) {\n\t\t\t\t\t// If the sibling has a sibling above it, insert the shapes\n\t\t\t\t\t// between the sibling and its sibling above it.\n\t\t\t\t\tindices = getIndicesBetween(insertIndex, sibAbove.index, ids.length)\n\t\t\t\t} else {\n\t\t\t\t\t// Or if the sibling is the top sibling, insert the shapes\n\t\t\t\t\t// above the sibling\n\t\t\t\t\tindices = getIndicesAbove(insertIndex, ids.length)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If there's no collision, then we can start at the insert index\n\t\t\t\tconst sibAbove = sibs.sort(sortByIndex).find((s) => s.index > insertIndex)\n\n\t\t\t\tif (sibAbove) {\n\t\t\t\t\t// If the siblings include a sibling with a higher index, insert the shapes\n\t\t\t\t\t// between the insert index and the sibling with the higher index.\n\t\t\t\t\tindices = getIndicesBetween(insertIndex, sibAbove.index, ids.length)\n\t\t\t\t} else {\n\t\t\t\t\t// Otherwise, we're at the top of the order, so insert the shapes above\n\t\t\t\t\t// the insert index.\n\t\t\t\t\tindices = getIndicesAbove(insertIndex, ids.length)\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// If insert index is not specified, start the index at the top.\n\t\t\tconst sib = sibs.length && sibs[sibs.length - 1]\n\t\t\tindices = sib ? getIndicesAbove(sib.index, ids.length) : getIndices(ids.length)\n\t\t}\n\n\t\tconst invertedParentTransform = parentTransform.clone().invert()\n\n\t\tconst shapesToReparent = compact(ids.map((id) => this.getShape(id)))\n\n\t\t// The user is allowed to re-parent locked shapes. Unintutive? Yeah! But there are plenty of\n\t\t// times when a locked shape's parent is deleted... and we need to put that shape somewhere!\n\t\tconst lockedShapes = shapesToReparent.filter((shape) => shape.isLocked)\n\n\t\tif (lockedShapes.length) {\n\t\t\t// If we have locked shapes, unlock them before we update them\n\t\t\tthis.updateShapes(lockedShapes.map(({ id, type }) => ({ id, type, isLocked: false })))\n\t\t}\n\n\t\tfor (let i = 0; i < shapesToReparent.length; i++) {\n\t\t\tconst shape = shapesToReparent[i]\n\n\t\t\tconst pageTransform = this.getShapePageTransform(shape)!\n\t\t\tif (!pageTransform) continue\n\n\t\t\tconst pagePoint = pageTransform.point()\n\t\t\tif (!pagePoint) continue\n\n\t\t\tconst newPoint = invertedParentTransform.applyToPoint(pagePoint)\n\t\t\tconst newRotation = pageTransform.rotation() - parentPageRotation\n\n\t\t\tchanges.push({\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tparentId: parentId,\n\t\t\t\tx: newPoint.x,\n\t\t\t\ty: newPoint.y,\n\t\t\t\trotation: newRotation,\n\t\t\t\tindex: indices[i],\n\t\t\t\tisLocked: shape.isLocked, // this will re-lock locked shapes\n\t\t\t})\n\t\t}\n\n\t\tthis.updateShapes(changes)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Get the index above the highest child of a given parent.\n\t *\n\t * @param parentId - The id of the parent.\n\t *\n\t * @returns The index.\n\t *\n\t * @public\n\t */\n\tgetHighestIndexForParent(parent: TLParentId | TLPage | TLShape): IndexKey {\n\t\tconst parentId = typeof parent === 'string' ? parent : parent.id\n\t\tconst children = this._parentIdsToChildIds.get()[parentId]\n\n\t\tif (!children || children.length === 0) {\n\t\t\treturn 'a1' as IndexKey\n\t\t}\n\t\tconst shape = this.getShape(children[children.length - 1])!\n\t\treturn getIndexAbove(shape.index)\n\t}\n\n\t/**\n\t * A cache of children for each parent.\n\t *\n\t * @internal\n\t */\n\tprivate _childIdsCache = new WeakMapCache<any[], TLShapeId[]>()\n\n\t/**\n\t * Get an array of all the children of a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getSortedChildIdsForParent('frame1')\n\t * ```\n\t *\n\t * @param parentId - The id of the parent shape.\n\t *\n\t * @public\n\t */\n\tgetSortedChildIdsForParent(parent: TLParentId | TLPage | TLShape): TLShapeId[] {\n\t\tconst parentId = typeof parent === 'string' ? parent : parent.id\n\t\tconst ids = this._parentIdsToChildIds.get()[parentId]\n\t\tif (!ids) return EMPTY_ARRAY\n\t\treturn this._childIdsCache.get(ids, () => ids)\n\t}\n\n\t/**\n\t * Run a visitor function for all descendants of a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.visitDescendants('frame1', myCallback)\n\t * ```\n\t *\n\t * @param parentId - The id of the parent shape.\n\t * @param visitor - The visitor function.\n\t *\n\t * @public\n\t */\n\tvisitDescendants(\n\t\tparent: TLParentId | TLPage | TLShape,\n\t\tvisitor: (id: TLShapeId) => void | false\n\t): this {\n\t\tconst parentId = typeof parent === 'string' ? parent : parent.id\n\t\tconst children = this.getSortedChildIdsForParent(parentId)\n\t\tfor (const id of children) {\n\t\t\tif (visitor(id) === false) continue\n\t\t\tthis.visitDescendants(id, visitor)\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Get the shape ids of all descendants of the given shapes (including the shapes themselves).\n\t *\n\t * @param ids - The ids of the shapes to get descendants of.\n\t *\n\t * @returns The decscendant ids.\n\t *\n\t * @public\n\t */\n\tgetShapeAndDescendantIds(ids: TLShapeId[]): Set<TLShapeId> {\n\t\tconst idsToInclude = new Set<TLShapeId>()\n\n\t\tconst idsToCheck = [...ids]\n\n\t\twhile (idsToCheck.length > 0) {\n\t\t\tconst id = idsToCheck.pop()\n\t\t\tif (!id) break\n\t\t\tif (idsToInclude.has(id)) continue\n\t\t\tidsToInclude.add(id)\n\t\t\tfor (const childId of this.getSortedChildIdsForParent(id)) {\n\t\t\t\tidsToCheck.push(childId)\n\t\t\t}\n\t\t}\n\n\t\treturn idsToInclude\n\t}\n\n\t/**\n\t * Get the shape that some shapes should be dropped on at a given point.\n\t *\n\t * @param point - The point to find the parent for.\n\t * @param droppingShapes - The shapes that are being dropped.\n\t *\n\t * @returns The shape to drop on.\n\t *\n\t * @public\n\t */\n\tgetDroppingOverShape(point: VecLike, droppingShapes: TLShape[] = []) {\n\t\t// starting from the top...\n\t\tconst currentPageShapesSorted = this.getCurrentPageShapesSorted()\n\t\tfor (let i = currentPageShapesSorted.length - 1; i >= 0; i--) {\n\t\t\tconst shape = currentPageShapesSorted[i]\n\n\t\t\tif (\n\t\t\t\t// don't allow dropping on selected shapes\n\t\t\t\tthis.getSelectedShapeIds().includes(shape.id) ||\n\t\t\t\t// only allow shapes that can receive children\n\t\t\t\t!this.getShapeUtil(shape).canDropShapes(shape, droppingShapes) ||\n\t\t\t\t// don't allow dropping a shape on itself or one of it's children\n\t\t\t\tdroppingShapes.find((s) => s.id === shape.id || this.hasAncestor(shape, s.id))\n\t\t\t) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// Only allow dropping into the masked page bounds of the shape, e.g. when a frame is\n\t\t\t// partially clipped by its own parent frame\n\t\t\tconst maskedPageBounds = this.getShapeMaskedPageBounds(shape.id)\n\n\t\t\tif (\n\t\t\t\tmaskedPageBounds &&\n\t\t\t\tmaskedPageBounds.containsPoint(point) &&\n\t\t\t\tthis.getShapeGeometry(shape).hitTestPoint(this.getPointInShapeSpace(shape, point), 0, true)\n\t\t\t) {\n\t\t\t\treturn shape\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get the shape that should be selected when you click on a given shape, assuming there is\n\t * nothing already selected. It will not return anything higher than or including the current\n\t * focus layer.\n\t *\n\t * @param shape - The shape to get the outermost selectable shape for.\n\t * @param filter - A function to filter the selectable shapes.\n\t *\n\t * @returns The outermost selectable shape.\n\t *\n\t * @public\n\t */\n\tgetOutermostSelectableShape(\n\t\tshape: TLShape | TLShapeId,\n\t\tfilter?: (shape: TLShape) => boolean\n\t): TLShape {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tconst freshShape = this.getShape(id)!\n\t\tlet match = freshShape\n\t\tlet node = freshShape as TLShape | undefined\n\n\t\tconst focusedGroup = this.getFocusedGroup()\n\n\t\twhile (node) {\n\t\t\tif (\n\t\t\t\tthis.isShapeOfType<TLGroupShape>(node, 'group') &&\n\t\t\t\tfocusedGroup?.id !== node.id &&\n\t\t\t\t!this.hasAncestor(focusedGroup, node.id) &&\n\t\t\t\t(filter?.(node) ?? true)\n\t\t\t) {\n\t\t\t\tmatch = node\n\t\t\t} else if (focusedGroup?.id === node.id) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tnode = this.getShapeParent(node)\n\t\t}\n\n\t\treturn match\n\t}\n\n\t/* -------------------- Commands -------------------- */\n\n\t/**\n\t * Rotate shapes by a delta in radians.\n\t * Note: Currently, this assumes that the shapes are your currently selected shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.rotateShapesBy(editor.getSelectedShapeIds(), Math.PI)\n\t * editor.rotateShapesBy(editor.getSelectedShapeIds(), Math.PI / 2)\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) of the shapes to move.\n\t * @param delta - The delta in radians to apply to the selection rotation.\n\t */\n\trotateShapesBy(shapes: TLShapeId[] | TLShape[], delta: number): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (ids.length <= 0) return this\n\n\t\tconst snapshot = getRotationSnapshot({ editor: this })\n\t\tif (!snapshot) return this\n\t\tapplyRotationToSnapshotShapes({ delta, snapshot, editor: this, stage: 'one-off' })\n\n\t\treturn this\n\t}\n\n\tprivate getChangesToTranslateShape(initialShape: TLShape, newShapeCoords: VecLike): TLShape {\n\t\tlet workingShape = initialShape\n\t\tconst util = this.getShapeUtil(initialShape)\n\n\t\tworkingShape = applyPartialToShape(\n\t\t\tworkingShape,\n\t\t\tutil.onTranslateStart?.(workingShape) ?? undefined\n\t\t)\n\n\t\tworkingShape = applyPartialToShape(workingShape, {\n\t\t\tid: initialShape.id,\n\t\t\ttype: initialShape.type,\n\t\t\tx: newShapeCoords.x,\n\t\t\ty: newShapeCoords.y,\n\t\t})\n\n\t\tworkingShape = applyPartialToShape(\n\t\t\tworkingShape,\n\t\t\tutil.onTranslate?.(initialShape, workingShape) ?? undefined\n\t\t)\n\n\t\tworkingShape = applyPartialToShape(\n\t\t\tworkingShape,\n\t\t\tutil.onTranslateEnd?.(initialShape, workingShape) ?? undefined\n\t\t)\n\n\t\treturn workingShape\n\t}\n\n\t/**\n\t * Move shapes by a delta.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.nudgeShapes(['box1', 'box2'], { x: 8, y: 8 })\n\t * editor.nudgeShapes(editor.getSelectedShapes(), { x: 8, y: 8 }, { squashing: true })\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to move.\n\t * @param direction - The direction in which to move the shapes.\n\t * @param historyOptions - The history options for the change.\n\t */\n\tnudgeShapes(\n\t\tshapes: TLShapeId[] | TLShape[],\n\t\toffset: VecLike,\n\t\thistoryOptions?: TLCommandHistoryOptions\n\t): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (ids.length <= 0) return this\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tfor (const id of ids) {\n\t\t\tconst shape = this.getShape(id)!\n\t\t\tconst localDelta = Vec.From(offset)\n\t\t\tconst parentTransform = this.getShapeParentTransform(shape)\n\t\t\tif (parentTransform) localDelta.rot(-parentTransform.rotation())\n\n\t\t\tchanges.push(this.getChangesToTranslateShape(shape, localDelta.add(shape)))\n\t\t}\n\n\t\tthis.updateShapes(changes, {\n\t\t\tsquashing: true,\n\t\t\t...historyOptions,\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Duplicate shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.duplicateShapes(['box1', 'box2'], { x: 8, y: 8 })\n\t * editor.duplicateShapes(editor.getSelectedShapes(), { x: 8, y: 8 })\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to duplicate.\n\t * @param offset - The offset (in pixels) to apply to the duplicated shapes.\n\t *\n\t * @public\n\t */\n\tduplicateShapes(shapes: TLShapeId[] | TLShape[], offset?: VecLike): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (ids.length <= 0) return this\n\n\t\tconst initialIds = new Set(ids)\n\t\tconst idsToCreate: TLShapeId[] = []\n\t\tconst idsToCheck = [...ids]\n\n\t\twhile (idsToCheck.length > 0) {\n\t\t\tconst id = idsToCheck.pop()\n\t\t\tif (!id) break\n\t\t\tidsToCreate.push(id)\n\t\t\tthis.getSortedChildIdsForParent(id).forEach((childId) => idsToCheck.push(childId))\n\t\t}\n\n\t\tidsToCreate.reverse()\n\n\t\tconst idsMap = new Map<any, TLShapeId>(idsToCreate.map((id) => [id, createShapeId()]))\n\n\t\tconst shapesToCreate = compact(\n\t\t\tidsToCreate.map((id) => {\n\t\t\t\tconst shape = this.getShape(id)\n\n\t\t\t\tif (!shape) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\tconst createId = idsMap.get(id)!\n\n\t\t\t\tlet ox = 0\n\t\t\t\tlet oy = 0\n\n\t\t\t\tif (offset && initialIds.has(id)) {\n\t\t\t\t\tconst parentTransform = this.getShapeParentTransform(shape)\n\t\t\t\t\tconst vec = new Vec(offset.x, offset.y).rot(-parentTransform!.rotation())\n\t\t\t\t\tox = vec.x\n\t\t\t\t\toy = vec.y\n\t\t\t\t}\n\n\t\t\t\tconst parentId = shape.parentId ?? this.getCurrentPageId()\n\t\t\t\tconst siblings = this.getSortedChildIdsForParent(parentId)\n\t\t\t\tconst currentIndex = siblings.indexOf(shape.id)\n\t\t\t\tconst siblingAboveId = siblings[currentIndex + 1]\n\t\t\t\tconst siblingAbove = siblingAboveId ? this.getShape(siblingAboveId) : null\n\n\t\t\t\tconst index = siblingAbove\n\t\t\t\t\t? getIndexBetween(shape.index, siblingAbove.index)\n\t\t\t\t\t: getIndexAbove(shape.index)\n\n\t\t\t\tlet newShape: TLShape = structuredClone(shape)\n\n\t\t\t\tif (\n\t\t\t\t\tthis.isShapeOfType<TLArrowShape>(shape, 'arrow') &&\n\t\t\t\t\tthis.isShapeOfType<TLArrowShape>(newShape, 'arrow')\n\t\t\t\t) {\n\t\t\t\t\tconst info = this.getArrowInfo(shape)\n\t\t\t\t\tlet newStartShapeId: TLShapeId | undefined = undefined\n\t\t\t\t\tlet newEndShapeId: TLShapeId | undefined = undefined\n\n\t\t\t\t\tif (shape.props.start.type === 'binding') {\n\t\t\t\t\t\tnewStartShapeId = idsMap.get(shape.props.start.boundShapeId)\n\n\t\t\t\t\t\tif (!newStartShapeId) {\n\t\t\t\t\t\t\tif (info?.isValid) {\n\t\t\t\t\t\t\t\tconst { x, y } = info.start.point\n\t\t\t\t\t\t\t\tnewShape.props.start = {\n\t\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\t\t\ty,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst { start } = getArrowTerminalsInArrowSpace(this, shape)\n\t\t\t\t\t\t\t\tnewShape.props.start = {\n\t\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\t\tx: start.x,\n\t\t\t\t\t\t\t\t\ty: start.y,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shape.props.end.type === 'binding') {\n\t\t\t\t\t\tnewEndShapeId = idsMap.get(shape.props.end.boundShapeId)\n\t\t\t\t\t\tif (!newEndShapeId) {\n\t\t\t\t\t\t\tif (info?.isValid) {\n\t\t\t\t\t\t\t\tconst { x, y } = info.end.point\n\t\t\t\t\t\t\t\tnewShape.props.end = {\n\t\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\t\t\ty,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst { end } = getArrowTerminalsInArrowSpace(this, shape)\n\t\t\t\t\t\t\t\tnewShape.props.start = {\n\t\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\t\tx: end.x,\n\t\t\t\t\t\t\t\t\ty: end.y,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst infoAfter = getIsArrowStraight(newShape)\n\t\t\t\t\t\t? getStraightArrowInfo(this, newShape)\n\t\t\t\t\t\t: getCurvedArrowInfo(this, newShape)\n\n\t\t\t\t\tif (info?.isValid && infoAfter?.isValid && !getIsArrowStraight(shape)) {\n\t\t\t\t\t\tconst mpA = Vec.Med(info.start.handle, info.end.handle)\n\t\t\t\t\t\tconst distA = Vec.Dist(info.middle, mpA)\n\t\t\t\t\t\tconst distB = Vec.Dist(infoAfter.middle, mpA)\n\t\t\t\t\t\tif (newShape.props.bend < 0) {\n\t\t\t\t\t\t\tnewShape.props.bend += distB - distA\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewShape.props.bend -= distB - distA\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (newShape.props.start.type === 'binding' && newStartShapeId) {\n\t\t\t\t\t\tnewShape.props.start.boundShapeId = newStartShapeId\n\t\t\t\t\t}\n\n\t\t\t\t\tif (newShape.props.end.type === 'binding' && newEndShapeId) {\n\t\t\t\t\t\tnewShape.props.end.boundShapeId = newEndShapeId\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnewShape = { ...newShape, id: createId, x: shape.x + ox, y: shape.y + oy, index }\n\n\t\t\t\treturn newShape\n\t\t\t})\n\t\t)\n\n\t\tshapesToCreate.forEach((shape) => {\n\t\t\tif (isShapeId(shape.parentId)) {\n\t\t\t\tif (idsMap.has(shape.parentId)) {\n\t\t\t\t\tshape.parentId = idsMap.get(shape.parentId)!\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tthis.history.batch(() => {\n\t\t\tconst maxShapesReached =\n\t\t\t\tshapesToCreate.length + this.getCurrentPageShapeIds().size > MAX_SHAPES_PER_PAGE\n\n\t\t\tif (maxShapesReached) {\n\t\t\t\talertMaxShapes(this)\n\t\t\t}\n\n\t\t\tconst newShapes = maxShapesReached\n\t\t\t\t? shapesToCreate.slice(0, MAX_SHAPES_PER_PAGE - this.getCurrentPageShapeIds().size)\n\t\t\t\t: shapesToCreate\n\n\t\t\tconst ids = newShapes.map((s) => s.id)\n\n\t\t\tthis.createShapes(newShapes)\n\t\t\tthis.setSelectedShapes(ids)\n\n\t\t\tif (offset !== undefined) {\n\t\t\t\t// If we've offset the duplicated shapes, check to see whether their new bounds is entirely\n\t\t\t\t// contained in the current viewport. If not, then animate the camera to be centered on the\n\t\t\t\t// new shapes.\n\t\t\t\tconst selectionPageBounds = this.getSelectionPageBounds()\n\t\t\t\tconst viewportPageBounds = this.getViewportPageBounds()\n\t\t\t\tif (selectionPageBounds && !viewportPageBounds.contains(selectionPageBounds)) {\n\t\t\t\t\tthis.centerOnPoint(selectionPageBounds.center, {\n\t\t\t\t\t\tduration: ANIMATION_MEDIUM_MS,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Move shapes to page.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.moveShapesToPage(['box1', 'box2'], 'page1')\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) of the shapes to move.\n\t * @param pageId - The id of the page where the shapes will be moved.\n\t *\n\t * @public\n\t */\n\tmoveShapesToPage(shapes: TLShapeId[] | TLShape[], pageId: TLPageId): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (ids.length === 0) return this\n\t\tif (this.getInstanceState().isReadonly) return this\n\n\t\tconst currentPageId = this.getCurrentPageId()\n\n\t\tif (pageId === currentPageId) return this\n\t\tif (!this.store.has(pageId)) return this\n\n\t\t// Basically copy the shapes\n\t\tconst content = this.getContentFromCurrentPage(ids)\n\n\t\t// Just to be sure\n\t\tif (!content) return this\n\n\t\t// If there is no space on pageId, or if the selected shapes\n\t\t// would take the new page above the limit, don't move the shapes\n\t\tif (this.getPageShapeIds(pageId).size + content.shapes.length > MAX_SHAPES_PER_PAGE) {\n\t\t\talertMaxShapes(this, pageId)\n\t\t\treturn this\n\t\t}\n\n\t\tconst fromPageZ = this.getCamera().z\n\n\t\tthis.history.batch(() => {\n\t\t\t// Delete the shapes on the current page\n\t\t\tthis.deleteShapes(ids)\n\n\t\t\t// Move to the next page\n\t\t\tthis.setCurrentPage(pageId)\n\n\t\t\t// Put the shape content onto the new page; parents and indices will\n\t\t\t// be taken care of by the putContent method; make sure to pop any focus\n\t\t\t// layers so that the content will be put onto the page.\n\t\t\tthis.setFocusedGroup(null)\n\t\t\tthis.selectNone()\n\t\t\tthis.putContentOntoCurrentPage(content, {\n\t\t\t\tselect: true,\n\t\t\t\tpreserveIds: true,\n\t\t\t\tpreservePosition: true,\n\t\t\t})\n\n\t\t\t// Force the new page's camera to be at the same zoom level as the\n\t\t\t// \"from\" page's camera, then center the \"to\" page's camera on the\n\t\t\t// pasted shapes\n\t\t\tthis.setCamera({ ...this.getCamera(), z: fromPageZ })\n\t\t\tthis.centerOnPoint(this.getSelectionRotatedPageBounds()!.center)\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Toggle the lock state of one or more shapes. If there is a mix of locked and unlocked shapes, all shapes will be locked.\n\t *\n\t * @param shapes - The shapes (or shape ids) to toggle.\n\t *\n\t * @public\n\t */\n\ttoggleLock(shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (this.getInstanceState().isReadonly || ids.length === 0) return this\n\n\t\tlet allLocked = true,\n\t\t\tallUnlocked = true\n\t\tconst shapesToToggle: TLShape[] = []\n\t\tfor (const id of ids) {\n\t\t\tconst shape = this.getShape(id)\n\t\t\tif (shape) {\n\t\t\t\tshapesToToggle.push(shape)\n\t\t\t\tif (shape.isLocked) {\n\t\t\t\t\tallUnlocked = false\n\t\t\t\t} else {\n\t\t\t\t\tallLocked = false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.batch(() => {\n\t\t\tif (allUnlocked) {\n\t\t\t\tthis.updateShapes(\n\t\t\t\t\tshapesToToggle.map((shape) => ({ id: shape.id, type: shape.type, isLocked: true }))\n\t\t\t\t)\n\t\t\t\tthis.setSelectedShapes([])\n\t\t\t} else if (allLocked) {\n\t\t\t\tthis.updateShapes(\n\t\t\t\t\tshapesToToggle.map((shape) => ({ id: shape.id, type: shape.type, isLocked: false }))\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tthis.updateShapes(\n\t\t\t\t\tshapesToToggle.map((shape) => ({ id: shape.id, type: shape.type, isLocked: true }))\n\t\t\t\t)\n\t\t\t}\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Send shapes to the back of the page's object list.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.sendToBack(['id1', 'id2'])\n\t * editor.sendToBack(box1, box2)\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to move.\n\t *\n\t * @public\n\t */\n\tsendToBack(shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\t\tconst changes = getReorderingShapesChanges(this, 'toBack', ids as TLShapeId[])\n\t\tif (changes) this.updateShapes(changes)\n\t\treturn this\n\t}\n\n\t/**\n\t * Send shapes backward in the page's object list.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.sendBackward(['id1', 'id2'])\n\t * editor.sendBackward([box1, box2])\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to move.\n\t *\n\t * @public\n\t */\n\tsendBackward(shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\t\tconst changes = getReorderingShapesChanges(this, 'backward', ids as TLShapeId[])\n\t\tif (changes) this.updateShapes(changes)\n\t\treturn this\n\t}\n\n\t/**\n\t * Bring shapes forward in the page's object list.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.bringForward(['id1', 'id2'])\n\t * editor.bringForward(box1,  box2)\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to move.\n\t *\n\t * @public\n\t */\n\tbringForward(shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\t\tconst changes = getReorderingShapesChanges(this, 'forward', ids as TLShapeId[])\n\t\tif (changes) this.updateShapes(changes)\n\t\treturn this\n\t}\n\n\t/**\n\t * Bring shapes to the front of the page's object list.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.bringToFront(['id1', 'id2'])\n\t * editor.bringToFront([box1, box2])\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to move.\n\t *\n\t * @public\n\t */\n\tbringToFront(shapes: TLShapeId[] | TLShape[]): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\t\tconst changes = getReorderingShapesChanges(this, 'toFront', ids as TLShapeId[])\n\t\tif (changes) this.updateShapes(changes)\n\t\treturn this\n\t}\n\n\t/**\n\t * Flip shape positions.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.flipShapes([box1, box2], 'horizontal', 32)\n\t * editor.flipShapes(editor.getSelectedShapeIds(), 'horizontal', 32)\n\t * ```\n\t *\n\t * @param shapes - The ids of the shapes to flip.\n\t * @param operation - Whether to flip horizontally or vertically.\n\t *\n\t * @public\n\t */\n\tflipShapes(shapes: TLShapeId[] | TLShape[], operation: 'horizontal' | 'vertical'): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (this.getInstanceState().isReadonly) return this\n\n\t\tlet shapesToFlip = compact(ids.map((id) => this.getShape(id)))\n\n\t\tif (!shapesToFlip.length) return this\n\n\t\tshapesToFlip = compact(\n\t\t\tshapesToFlip\n\t\t\t\t.map((shape) => {\n\t\t\t\t\tif (this.isShapeOfType<TLGroupShape>(shape, 'group')) {\n\t\t\t\t\t\treturn this.getSortedChildIdsForParent(shape.id).map((id) => this.getShape(id))\n\t\t\t\t\t}\n\n\t\t\t\t\treturn shape\n\t\t\t\t})\n\t\t\t\t.flat()\n\t\t)\n\n\t\tconst scaleOriginPage = Box.Common(\n\t\t\tcompact(shapesToFlip.map((id) => this.getShapePageBounds(id)))\n\t\t).center\n\n\t\tthis.batch(() => {\n\t\t\tfor (const shape of shapesToFlip) {\n\t\t\t\tconst bounds = this.getShapeGeometry(shape).bounds\n\t\t\t\tconst initialPageTransform = this.getShapePageTransform(shape.id)\n\t\t\t\tif (!initialPageTransform) continue\n\t\t\t\tthis.resizeShape(\n\t\t\t\t\tshape.id,\n\t\t\t\t\t{ x: operation === 'horizontal' ? -1 : 1, y: operation === 'vertical' ? -1 : 1 },\n\t\t\t\t\t{\n\t\t\t\t\t\tinitialBounds: bounds,\n\t\t\t\t\t\tinitialPageTransform,\n\t\t\t\t\t\tinitialShape: shape,\n\t\t\t\t\t\tmode: 'scale_shape',\n\t\t\t\t\t\tscaleOrigin: scaleOriginPage,\n\t\t\t\t\t\tscaleAxisRotation: 0,\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Stack shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.stackShapes([box1, box2], 'horizontal', 32)\n\t * editor.stackShapes(editor.getSelectedShapeIds(), 'horizontal', 32)\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to stack.\n\t * @param operation - Whether to stack horizontally or vertically.\n\t * @param gap - The gap to leave between shapes.\n\t *\n\t * @public\n\t */\n\tstackShapes(\n\t\tshapes: TLShapeId[] | TLShape[],\n\t\toperation: 'horizontal' | 'vertical',\n\t\tgap: number\n\t): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\t\tif (this.getInstanceState().isReadonly) return this\n\n\t\tconst shapesToStack = compact(\n\t\t\tids\n\t\t\t\t.map((id) => this.getShape(id)) // always fresh shapes\n\t\t\t\t.filter((shape) => {\n\t\t\t\t\tif (!shape) return false\n\n\t\t\t\t\tif (this.isShapeOfType<TLArrowShape>(shape, 'arrow')) {\n\t\t\t\t\t\tif (shape.props.start.type === 'binding' || shape.props.end.type === 'binding') {\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true\n\t\t\t\t})\n\t\t)\n\n\t\tconst len = shapesToStack.length\n\n\t\tif ((gap === 0 && len < 3) || len < 2) return this\n\n\t\tconst pageBounds = Object.fromEntries(\n\t\t\tshapesToStack.map((shape) => [shape.id, this.getShapePageBounds(shape)!])\n\t\t)\n\n\t\tlet val: 'x' | 'y'\n\t\tlet min: 'minX' | 'minY'\n\t\tlet max: 'maxX' | 'maxY'\n\t\tlet dim: 'width' | 'height'\n\n\t\tif (operation === 'horizontal') {\n\t\t\tval = 'x'\n\t\t\tmin = 'minX'\n\t\t\tmax = 'maxX'\n\t\t\tdim = 'width'\n\t\t} else {\n\t\t\tval = 'y'\n\t\t\tmin = 'minY'\n\t\t\tmax = 'maxY'\n\t\t\tdim = 'height'\n\t\t}\n\n\t\tlet shapeGap: number\n\n\t\tif (gap === 0) {\n\t\t\tconst gaps: { gap: number; count: number }[] = []\n\n\t\t\tshapesToStack.sort((a, b) => pageBounds[a.id][min] - pageBounds[b.id][min])\n\n\t\t\t// Collect all of the gaps between shapes. We want to find\n\t\t\t// patterns (equal gaps between shapes) and use the most common\n\t\t\t// one as the gap for all of the shapes.\n\t\t\tfor (let i = 0; i < len - 1; i++) {\n\t\t\t\tconst shape = shapesToStack[i]\n\t\t\t\tconst nextShape = shapesToStack[i + 1]\n\n\t\t\t\tconst bounds = pageBounds[shape.id]\n\t\t\t\tconst nextBounds = pageBounds[nextShape.id]\n\n\t\t\t\tconst gap = nextBounds[min] - bounds[max]\n\n\t\t\t\tconst current = gaps.find((g) => g.gap === gap)\n\n\t\t\t\tif (current) {\n\t\t\t\t\tcurrent.count++\n\t\t\t\t} else {\n\t\t\t\t\tgaps.push({ gap, count: 1 })\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Which gap is the most common?\n\t\t\tlet maxCount = 0\n\t\t\tgaps.forEach((g) => {\n\t\t\t\tif (g.count > maxCount) {\n\t\t\t\t\tmaxCount = g.count\n\t\t\t\t\tshapeGap = g.gap\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t// If there is no most-common gap, use the average gap.\n\t\t\tif (maxCount === 1) {\n\t\t\t\tshapeGap = Math.max(0, gaps.reduce((a, c) => a + c.gap * c.count, 0) / (len - 1))\n\t\t\t}\n\t\t} else {\n\t\t\t// If a gap was provided, then use that instead.\n\t\t\tshapeGap = gap\n\t\t}\n\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tlet v = pageBounds[shapesToStack[0].id][max]\n\n\t\tshapesToStack.forEach((shape, i) => {\n\t\t\tif (i === 0) return\n\n\t\t\tconst delta = { x: 0, y: 0 }\n\t\t\tdelta[val] = v + shapeGap - pageBounds[shape.id][val]\n\n\t\t\tconst parent = this.getShapeParent(shape)\n\t\t\tconst localDelta = parent\n\t\t\t\t? Vec.Rot(delta, -this.getShapePageTransform(parent)!.decompose().rotation)\n\t\t\t\t: delta\n\n\t\t\tconst translateStartChanges = this.getShapeUtil(shape).onTranslateStart?.(shape)\n\n\t\t\tchanges.push(\n\t\t\t\ttranslateStartChanges\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t...translateStartChanges,\n\t\t\t\t\t\t\t[val]: shape[val] + localDelta[val],\n\t\t\t\t\t\t}\n\t\t\t\t\t: {\n\t\t\t\t\t\t\tid: shape.id as any,\n\t\t\t\t\t\t\ttype: shape.type,\n\t\t\t\t\t\t\t[val]: shape[val] + localDelta[val],\n\t\t\t\t\t\t}\n\t\t\t)\n\n\t\t\tv += pageBounds[shape.id][dim] + shapeGap\n\t\t})\n\n\t\tthis.updateShapes(changes)\n\t\treturn this\n\t}\n\n\t/**\n\t * Pack shapes into a grid centered on their current position. Based on potpack (https://github.com/mapbox/potpack).\n\t *\n\t * @example\n\t * ```ts\n\t * editor.packShapes([box1, box2], 32)\n\t * editor.packShapes(editor.getSelectedShapeIds(), 32)\n\t * ```\n\t *\n\t *\n\t * @param shapes - The shapes (or shape ids) to pack.\n\t * @param gap - The padding to apply to the packed shapes. Defaults to 16.\n\t */\n\tpackShapes(shapes: TLShapeId[] | TLShape[], gap: number): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (this.getInstanceState().isReadonly) return this\n\t\tif (ids.length < 2) return this\n\n\t\tconst shapesToPack = compact(\n\t\t\tids\n\t\t\t\t.map((id) => this.getShape(id)) // always fresh shapes\n\t\t\t\t.filter((shape) => {\n\t\t\t\t\tif (!shape) return false\n\n\t\t\t\t\tif (this.isShapeOfType<TLArrowShape>(shape, 'arrow')) {\n\t\t\t\t\t\tif (shape.props.start.type === 'binding' || shape.props.end.type === 'binding') {\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true\n\t\t\t\t})\n\t\t)\n\t\tconst shapePageBounds: Record<string, Box> = {}\n\t\tconst nextShapePageBounds: Record<string, Box> = {}\n\n\t\tlet shape: TLShape,\n\t\t\tbounds: Box,\n\t\t\tarea = 0\n\n\t\tfor (let i = 0; i < shapesToPack.length; i++) {\n\t\t\tshape = shapesToPack[i]\n\t\t\tbounds = this.getShapePageBounds(shape)!\n\t\t\tshapePageBounds[shape.id] = bounds\n\t\t\tnextShapePageBounds[shape.id] = bounds.clone()\n\t\t\tarea += bounds.width * bounds.height\n\t\t}\n\n\t\tconst commonBounds = Box.Common(compact(Object.values(shapePageBounds)))\n\n\t\tconst maxWidth = commonBounds.width\n\n\t\t// sort the shapes by height, descending\n\t\tshapesToPack.sort((a, b) => shapePageBounds[b.id].height - shapePageBounds[a.id].height)\n\n\t\t// Start with is (sort of) the square of the area\n\t\tconst startWidth = Math.max(Math.ceil(Math.sqrt(area / 0.95)), maxWidth)\n\n\t\t// first shape fills the width and is infinitely tall\n\t\tconst spaces: Box[] = [new Box(commonBounds.x, commonBounds.y, startWidth, Infinity)]\n\n\t\tlet width = 0\n\t\tlet height = 0\n\t\tlet space: Box\n\t\tlet last: Box\n\n\t\tfor (let i = 0; i < shapesToPack.length; i++) {\n\t\t\tshape = shapesToPack[i]\n\t\t\tbounds = nextShapePageBounds[shape.id]\n\n\t\t\t// starting at the back (smaller shapes)\n\t\t\tfor (let i = spaces.length - 1; i >= 0; i--) {\n\t\t\t\tspace = spaces[i]\n\n\t\t\t\t// find a space that is big enough to contain the shape\n\t\t\t\tif (bounds.width > space.width || bounds.height > space.height) continue\n\n\t\t\t\t// add the shape to its top-left corner\n\t\t\t\tbounds.x = space.x\n\t\t\t\tbounds.y = space.y\n\n\t\t\t\theight = Math.max(height, bounds.maxY)\n\t\t\t\twidth = Math.max(width, bounds.maxX)\n\n\t\t\t\tif (bounds.width === space.width && bounds.height === space.height) {\n\t\t\t\t\t// remove the space on a perfect fit\n\t\t\t\t\tlast = spaces.pop()!\n\t\t\t\t\tif (i < spaces.length) spaces[i] = last\n\t\t\t\t} else if (bounds.height === space.height) {\n\t\t\t\t\t// fit the shape into the space (width)\n\t\t\t\t\tspace.x += bounds.width + gap\n\t\t\t\t\tspace.width -= bounds.width + gap\n\t\t\t\t} else if (bounds.width === space.width) {\n\t\t\t\t\t// fit the shape into the space (height)\n\t\t\t\t\tspace.y += bounds.height + gap\n\t\t\t\t\tspace.height -= bounds.height + gap\n\t\t\t\t} else {\n\t\t\t\t\t// split the space into two spaces\n\t\t\t\t\tspaces.push(\n\t\t\t\t\t\tnew Box(\n\t\t\t\t\t\t\tspace.x + (bounds.width + gap),\n\t\t\t\t\t\t\tspace.y,\n\t\t\t\t\t\t\tspace.width - (bounds.width + gap),\n\t\t\t\t\t\t\tbounds.height\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\tspace.y += bounds.height + gap\n\t\t\t\t\tspace.height -= bounds.height + gap\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tconst commonAfter = Box.Common(Object.values(nextShapePageBounds))\n\t\tconst centerDelta = Vec.Sub(commonBounds.center, commonAfter.center)\n\n\t\tlet nextBounds: Box\n\n\t\tconst changes: TLShapePartial<any>[] = []\n\n\t\tfor (let i = 0; i < shapesToPack.length; i++) {\n\t\t\tshape = shapesToPack[i]\n\t\t\tbounds = shapePageBounds[shape.id]\n\t\t\tnextBounds = nextShapePageBounds[shape.id]\n\n\t\t\tconst delta = Vec.Sub(nextBounds.point, bounds.point).add(centerDelta)\n\t\t\tconst parentTransform = this.getShapeParentTransform(shape)\n\t\t\tif (parentTransform) delta.rot(-parentTransform.rotation())\n\n\t\t\tconst change: TLShapePartial = {\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tx: shape.x + delta.x,\n\t\t\t\ty: shape.y + delta.y,\n\t\t\t}\n\n\t\t\tconst translateStartChange = this.getShapeUtil(shape).onTranslateStart?.({\n\t\t\t\t...shape,\n\t\t\t\t...change,\n\t\t\t})\n\n\t\t\tif (translateStartChange) {\n\t\t\t\tchanges.push({ ...change, ...translateStartChange })\n\t\t\t} else {\n\t\t\t\tchanges.push(change)\n\t\t\t}\n\t\t}\n\n\t\tif (changes.length) {\n\t\t\tthis.updateShapes(changes)\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Align shape positions.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.alignShapes([box1, box2], 'left')\n\t * editor.alignShapes(editor.getSelectedShapeIds(), 'left')\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to align.\n\t * @param operation - The align operation to apply.\n\t *\n\t * @public\n\t */\n\n\talignShapes(\n\t\tshapes: TLShapeId[] | TLShape[],\n\t\toperation: 'left' | 'center-horizontal' | 'right' | 'top' | 'center-vertical' | 'bottom'\n\t): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (this.getInstanceState().isReadonly) return this\n\t\tif (ids.length < 2) return this\n\n\t\tconst shapesToAlign = compact(ids.map((id) => this.getShape(id))) // always fresh shapes\n\t\tconst shapePageBounds = Object.fromEntries(\n\t\t\tshapesToAlign.map((shape) => [shape.id, this.getShapePageBounds(shape)])\n\t\t)\n\t\tconst commonBounds = Box.Common(compact(Object.values(shapePageBounds)))\n\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tshapesToAlign.forEach((shape) => {\n\t\t\tconst pageBounds = shapePageBounds[shape.id]\n\t\t\tif (!pageBounds) return\n\n\t\t\tconst delta = { x: 0, y: 0 }\n\n\t\t\tswitch (operation) {\n\t\t\t\tcase 'top': {\n\t\t\t\t\tdelta.y = commonBounds.minY - pageBounds.minY\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'center-vertical': {\n\t\t\t\t\tdelta.y = commonBounds.midY - pageBounds.minY - pageBounds.height / 2\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'bottom': {\n\t\t\t\t\tdelta.y = commonBounds.maxY - pageBounds.minY - pageBounds.height\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'left': {\n\t\t\t\t\tdelta.x = commonBounds.minX - pageBounds.minX\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'center-horizontal': {\n\t\t\t\t\tdelta.x = commonBounds.midX - pageBounds.minX - pageBounds.width / 2\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'right': {\n\t\t\t\t\tdelta.x = commonBounds.maxX - pageBounds.minX - pageBounds.width\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst parent = this.getShapeParent(shape)\n\t\t\tconst localDelta = parent\n\t\t\t\t? Vec.Rot(delta, -this.getShapePageTransform(parent)!.decompose().rotation)\n\t\t\t\t: delta\n\n\t\t\tchanges.push(this.getChangesToTranslateShape(shape, Vec.Add(shape, localDelta)))\n\t\t})\n\n\t\tthis.updateShapes(changes)\n\t\treturn this\n\t}\n\n\t/**\n\t * Distribute shape positions.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.distributeShapes([box1, box2], 'horizontal')\n\t * editor.distributeShapes(editor.getSelectedShapeIds(), 'horizontal')\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to distribute.\n\t * @param operation - Whether to distribute shapes horizontally or vertically.\n\t *\n\t * @public\n\t */\n\tdistributeShapes(shapes: TLShapeId[] | TLShape[], operation: 'horizontal' | 'vertical'): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (this.getInstanceState().isReadonly) return this\n\t\tif (ids.length < 3) return this\n\n\t\tconst len = ids.length\n\t\tconst shapesToDistribute = compact(ids.map((id) => this.getShape(id))) // always fresh shapes\n\t\tconst pageBounds = Object.fromEntries(\n\t\t\tshapesToDistribute.map((shape) => [shape.id, this.getShapePageBounds(shape)!])\n\t\t)\n\n\t\tlet val: 'x' | 'y'\n\t\tlet min: 'minX' | 'minY'\n\t\tlet max: 'maxX' | 'maxY'\n\t\tlet mid: 'midX' | 'midY'\n\t\tlet dim: 'width' | 'height'\n\n\t\tif (operation === 'horizontal') {\n\t\t\tval = 'x'\n\t\t\tmin = 'minX'\n\t\t\tmax = 'maxX'\n\t\t\tmid = 'midX'\n\t\t\tdim = 'width'\n\t\t} else {\n\t\t\tval = 'y'\n\t\t\tmin = 'minY'\n\t\t\tmax = 'maxY'\n\t\t\tmid = 'midY'\n\t\t\tdim = 'height'\n\t\t}\n\t\tconst changes: TLShapePartial[] = []\n\n\t\t// Clustered\n\t\tconst first = shapesToDistribute.sort(\n\t\t\t(a, b) => pageBounds[a.id][min] - pageBounds[b.id][min]\n\t\t)[0]\n\t\tconst last = shapesToDistribute.sort((a, b) => pageBounds[b.id][max] - pageBounds[a.id][max])[0]\n\n\t\tconst midFirst = pageBounds[first.id][mid]\n\t\tconst step = (pageBounds[last.id][mid] - midFirst) / (len - 1)\n\t\tconst v = midFirst + step\n\n\t\tshapesToDistribute\n\t\t\t.filter((shape) => shape !== first && shape !== last)\n\t\t\t.sort((a, b) => pageBounds[a.id][mid] - pageBounds[b.id][mid])\n\t\t\t.forEach((shape, i) => {\n\t\t\t\tconst delta = { x: 0, y: 0 }\n\t\t\t\tdelta[val] = v + step * i - pageBounds[shape.id][dim] / 2 - pageBounds[shape.id][val]\n\n\t\t\t\tconst parent = this.getShapeParent(shape)\n\t\t\t\tconst localDelta = parent\n\t\t\t\t\t? Vec.Rot(delta, -this.getShapePageTransform(parent)!.rotation())\n\t\t\t\t\t: delta\n\n\t\t\t\tchanges.push(this.getChangesToTranslateShape(shape, Vec.Add(shape, localDelta)))\n\t\t\t})\n\n\t\tthis.updateShapes(changes)\n\t\treturn this\n\t}\n\n\t/**\n\t * Stretch shape sizes and positions to fill their common bounding box.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.stretchShapes([box1, box2], 'horizontal')\n\t * editor.stretchShapes(editor.getSelectedShapeIds(), 'horizontal')\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape ids) to stretch.\n\t * @param operation - Whether to stretch shapes horizontally or vertically.\n\t *\n\t * @public\n\t */\n\tstretchShapes(shapes: TLShapeId[] | TLShape[], operation: 'horizontal' | 'vertical'): this {\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (this.getInstanceState().isReadonly) return this\n\t\tif (ids.length < 2) return this\n\n\t\tconst shapesToStretch = compact(ids.map((id) => this.getShape(id))) // always fresh shapes\n\t\tconst shapeBounds = Object.fromEntries(ids.map((id) => [id, this.getShapeGeometry(id).bounds]))\n\t\tconst shapePageBounds = Object.fromEntries(ids.map((id) => [id, this.getShapePageBounds(id)!]))\n\t\tconst commonBounds = Box.Common(compact(Object.values(shapePageBounds)))\n\n\t\tswitch (operation) {\n\t\t\tcase 'vertical': {\n\t\t\t\tthis.batch(() => {\n\t\t\t\t\tfor (const shape of shapesToStretch) {\n\t\t\t\t\t\tconst pageRotation = this.getShapePageTransform(shape)!.rotation()\n\t\t\t\t\t\tif (pageRotation % PI2) continue\n\t\t\t\t\t\tconst bounds = shapeBounds[shape.id]\n\t\t\t\t\t\tconst pageBounds = shapePageBounds[shape.id]\n\t\t\t\t\t\tconst localOffset = new Vec(0, commonBounds.minY - pageBounds.minY)\n\t\t\t\t\t\tconst parentTransform = this.getShapeParentTransform(shape)\n\t\t\t\t\t\tif (parentTransform) localOffset.rot(-parentTransform.rotation())\n\n\t\t\t\t\t\tconst { x, y } = Vec.Add(localOffset, shape)\n\t\t\t\t\t\tthis.updateShapes([{ id: shape.id, type: shape.type, x, y }], { squashing: true })\n\t\t\t\t\t\tconst scale = new Vec(1, commonBounds.height / pageBounds.height)\n\t\t\t\t\t\tthis.resizeShape(shape.id, scale, {\n\t\t\t\t\t\t\tinitialBounds: bounds,\n\t\t\t\t\t\t\tscaleOrigin: new Vec(pageBounds.center.x, commonBounds.minY),\n\t\t\t\t\t\t\tscaleAxisRotation: 0,\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'horizontal': {\n\t\t\t\tthis.batch(() => {\n\t\t\t\t\tfor (const shape of shapesToStretch) {\n\t\t\t\t\t\tconst bounds = shapeBounds[shape.id]\n\t\t\t\t\t\tconst pageBounds = shapePageBounds[shape.id]\n\t\t\t\t\t\tconst pageRotation = this.getShapePageTransform(shape)!.rotation()\n\t\t\t\t\t\tif (pageRotation % PI2) continue\n\t\t\t\t\t\tconst localOffset = new Vec(commonBounds.minX - pageBounds.minX, 0)\n\t\t\t\t\t\tconst parentTransform = this.getShapeParentTransform(shape)\n\t\t\t\t\t\tif (parentTransform) localOffset.rot(-parentTransform.rotation())\n\n\t\t\t\t\t\tconst { x, y } = Vec.Add(localOffset, shape)\n\t\t\t\t\t\tthis.updateShapes([{ id: shape.id, type: shape.type, x, y }], { squashing: true })\n\t\t\t\t\t\tconst scale = new Vec(commonBounds.width / pageBounds.width, 1)\n\t\t\t\t\t\tthis.resizeShape(shape.id, scale, {\n\t\t\t\t\t\t\tinitialBounds: bounds,\n\t\t\t\t\t\t\tscaleOrigin: new Vec(commonBounds.minX, pageBounds.center.y),\n\t\t\t\t\t\t\tscaleAxisRotation: 0,\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Resize a shape.\n\t *\n\t * @param id - The id of the shape to resize.\n\t * @param scale - The scale factor to apply to the shape.\n\t * @param options - Additional options.\n\t *\n\t * @public\n\t */\n\tresizeShape(\n\t\tshape: TLShapeId | TLShape,\n\t\tscale: VecLike,\n\t\toptions: TLResizeShapeOptions = {}\n\t): this {\n\t\tconst id = typeof shape === 'string' ? shape : shape.id\n\t\tif (this.getInstanceState().isReadonly) return this\n\n\t\tif (!Number.isFinite(scale.x)) scale = new Vec(1, scale.y)\n\t\tif (!Number.isFinite(scale.y)) scale = new Vec(scale.x, 1)\n\n\t\tconst initialShape = options.initialShape ?? this.getShape(id)\n\t\tif (!initialShape) return this\n\n\t\tconst scaleOrigin = options.scaleOrigin ?? this.getShapePageBounds(id)?.center\n\t\tif (!scaleOrigin) return this\n\n\t\tconst pageTransform = options.initialPageTransform\n\t\t\t? Mat.Cast(options.initialPageTransform)\n\t\t\t: this.getShapePageTransform(id)\n\t\tif (!pageTransform) return this\n\n\t\tconst pageRotation = pageTransform.rotation()\n\n\t\tif (pageRotation == null) return this\n\n\t\tconst scaleAxisRotation = options.scaleAxisRotation ?? pageRotation\n\n\t\tconst initialBounds = options.initialBounds ?? this.getShapeGeometry(id).bounds\n\n\t\tif (!initialBounds) return this\n\n\t\tif (!areAnglesCompatible(pageRotation, scaleAxisRotation)) {\n\t\t\t// shape is awkwardly rotated, keep the aspect ratio locked and adopt the scale factor\n\t\t\t// from whichever axis is being scaled the least, to avoid the shape getting bigger\n\t\t\t// than the bounds of the selection\n\t\t\t// const minScale = Math.min(Math.abs(scale.x), Math.abs(scale.y))\n\t\t\treturn this._resizeUnalignedShape(id, scale, {\n\t\t\t\t...options,\n\t\t\t\tinitialBounds,\n\t\t\t\tscaleOrigin,\n\t\t\t\tscaleAxisRotation,\n\t\t\t\tinitialPageTransform: pageTransform,\n\t\t\t\tinitialShape,\n\t\t\t})\n\t\t}\n\n\t\tconst util = this.getShapeUtil(initialShape)\n\n\t\tif (util.isAspectRatioLocked(initialShape)) {\n\t\t\tif (Math.abs(scale.x) > Math.abs(scale.y)) {\n\t\t\t\tscale = new Vec(scale.x, Math.sign(scale.y) * Math.abs(scale.x))\n\t\t\t} else {\n\t\t\t\tscale = new Vec(Math.sign(scale.x) * Math.abs(scale.y), scale.y)\n\t\t\t}\n\t\t}\n\n\t\tif (util.onResize && util.canResize(initialShape)) {\n\t\t\t// get the model changes from the shape util\n\t\t\tconst newPagePoint = this._scalePagePoint(\n\t\t\t\tMat.applyToPoint(pageTransform, new Vec(0, 0)),\n\t\t\t\tscaleOrigin,\n\t\t\t\tscale,\n\t\t\t\tscaleAxisRotation\n\t\t\t)\n\n\t\t\tconst newLocalPoint = this.getPointInParentSpace(initialShape.id, newPagePoint)\n\n\t\t\t// resize the shape's local bounding box\n\t\t\tconst myScale = new Vec(scale.x, scale.y)\n\t\t\t// the shape is aligned with the rest of the shapes in the selection, but may be\n\t\t\t// 90deg offset from the main rotation of the selection, in which case\n\t\t\t// we need to flip the width and height scale factors\n\t\t\tconst areWidthAndHeightAlignedWithCorrectAxis = approximately(\n\t\t\t\t(pageRotation - scaleAxisRotation) % Math.PI,\n\t\t\t\t0\n\t\t\t)\n\t\t\tmyScale.x = areWidthAndHeightAlignedWithCorrectAxis ? scale.x : scale.y\n\t\t\tmyScale.y = areWidthAndHeightAlignedWithCorrectAxis ? scale.y : scale.x\n\n\t\t\t// adjust initial model for situations where the parent has moved during the resize\n\t\t\t// e.g. groups\n\t\t\tconst initialPagePoint = Mat.applyToPoint(pageTransform, new Vec())\n\n\t\t\t// need to adjust the shape's x and y points in case the parent has moved since start of resizing\n\t\t\tconst { x, y } = this.getPointInParentSpace(initialShape.id, initialPagePoint)\n\n\t\t\tthis.updateShapes(\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype: initialShape.type as any,\n\t\t\t\t\t\tx: newLocalPoint.x,\n\t\t\t\t\t\ty: newLocalPoint.y,\n\t\t\t\t\t\t...util.onResize(\n\t\t\t\t\t\t\t{ ...initialShape, x, y },\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnewPoint: newLocalPoint,\n\t\t\t\t\t\t\t\thandle: options.dragHandle ?? 'bottom_right',\n\t\t\t\t\t\t\t\t// don't set isSingle to true for children\n\t\t\t\t\t\t\t\tmode: options.mode ?? 'scale_shape',\n\t\t\t\t\t\t\t\tscaleX: myScale.x,\n\t\t\t\t\t\t\t\tscaleY: myScale.y,\n\t\t\t\t\t\t\t\tinitialBounds,\n\t\t\t\t\t\t\t\tinitialShape,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t{ squashing: true }\n\t\t\t)\n\t\t} else {\n\t\t\tconst initialPageCenter = Mat.applyToPoint(pageTransform, initialBounds.center)\n\t\t\t// get the model changes from the shape util\n\t\t\tconst newPageCenter = this._scalePagePoint(\n\t\t\t\tinitialPageCenter,\n\t\t\t\tscaleOrigin,\n\t\t\t\tscale,\n\t\t\t\tscaleAxisRotation\n\t\t\t)\n\n\t\t\tconst initialPageCenterInParentSpace = this.getPointInParentSpace(\n\t\t\t\tinitialShape.id,\n\t\t\t\tinitialPageCenter\n\t\t\t)\n\t\t\tconst newPageCenterInParentSpace = this.getPointInParentSpace(initialShape.id, newPageCenter)\n\n\t\t\tconst delta = Vec.Sub(newPageCenterInParentSpace, initialPageCenterInParentSpace)\n\t\t\t// apply the changes to the model\n\t\t\tthis.updateShapes(\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype: initialShape.type as any,\n\t\t\t\t\t\tx: initialShape.x + delta.x,\n\t\t\t\t\t\ty: initialShape.y + delta.y,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t{ squashing: true }\n\t\t\t)\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _scalePagePoint(\n\t\tpoint: VecLike,\n\t\tscaleOrigin: VecLike,\n\t\tscale: VecLike,\n\t\tscaleAxisRotation: number\n\t) {\n\t\tconst relativePoint = Vec.RotWith(point, scaleOrigin, -scaleAxisRotation).sub(scaleOrigin)\n\n\t\t// calculate the new point position relative to the scale origin\n\t\tconst newRelativePagePoint = Vec.MulV(relativePoint, scale)\n\n\t\t// and rotate it back to page coords to get the new page point of the resized shape\n\t\tconst destination = Vec.Add(newRelativePagePoint, scaleOrigin).rotWith(\n\t\t\tscaleOrigin,\n\t\t\tscaleAxisRotation\n\t\t)\n\n\t\treturn destination\n\t}\n\n\t/** @internal */\n\tprivate _resizeUnalignedShape(\n\t\tid: TLShapeId,\n\t\tscale: VecLike,\n\t\toptions: {\n\t\t\tinitialBounds: Box\n\t\t\tscaleOrigin: VecLike\n\t\t\tscaleAxisRotation: number\n\t\t\tinitialShape: TLShape\n\t\t\tinitialPageTransform: MatLike\n\t\t}\n\t) {\n\t\tconst { type } = options.initialShape\n\t\t// If a shape is not aligned with the scale axis we need to treat it differently to avoid skewing.\n\t\t// Instead of skewing we normalize the scale aspect ratio (i.e. keep the same scale magnitude in both axes)\n\t\t// and then after applying the scale to the shape we also rotate it if required and translate it so that it's center\n\t\t// point ends up in the right place.\n\n\t\tconst shapeScale = new Vec(scale.x, scale.y)\n\n\t\t// // make sure we are constraining aspect ratio, and using the smallest scale axis to avoid shapes getting bigger\n\t\t// // than the selection bounding box\n\t\tif (Math.abs(scale.x) > Math.abs(scale.y)) {\n\t\t\tshapeScale.x = Math.sign(scale.x) * Math.abs(scale.y)\n\t\t} else {\n\t\t\tshapeScale.y = Math.sign(scale.y) * Math.abs(scale.x)\n\t\t}\n\n\t\t// first we can scale the shape about its center point\n\t\tthis.resizeShape(id, shapeScale, {\n\t\t\tinitialShape: options.initialShape,\n\t\t\tinitialBounds: options.initialBounds,\n\t\t})\n\n\t\t// then if the shape is flipped in one axis only, we need to apply an extra rotation\n\t\t// to make sure the shape is mirrored correctly\n\t\tif (Math.sign(scale.x) * Math.sign(scale.y) < 0) {\n\t\t\tlet { rotation } = Mat.Decompose(options.initialPageTransform)\n\t\t\trotation -= 2 * rotation\n\t\t\tthis.updateShapes([{ id, type, rotation }], { squashing: true })\n\t\t}\n\n\t\t// Next we need to translate the shape so that it's center point ends up in the right place.\n\t\t// To do that we first need to calculate the center point of the shape in the current page space before the scale was applied.\n\t\tconst preScaleShapePageCenter = Mat.applyToPoint(\n\t\t\toptions.initialPageTransform,\n\t\t\toptions.initialBounds.center\n\t\t)\n\n\t\t// And now we scale the center point by the original scale factor\n\t\tconst postScaleShapePageCenter = this._scalePagePoint(\n\t\t\tpreScaleShapePageCenter,\n\t\t\toptions.scaleOrigin,\n\t\t\tscale,\n\t\t\toptions.scaleAxisRotation\n\t\t)\n\n\t\t// now calculate how far away the shape is from where it needs to be\n\t\tconst pageBounds = this.getShapePageBounds(id)!\n\t\tconst pageTransform = this.getShapePageTransform(id)!\n\t\tconst currentPageCenter = pageBounds.center\n\t\tconst shapePageTransformOrigin = pageTransform.point()\n\t\tif (!currentPageCenter || !shapePageTransformOrigin) return this\n\t\tconst pageDelta = Vec.Sub(postScaleShapePageCenter, currentPageCenter)\n\n\t\t// and finally figure out what the shape's new position should be\n\t\tconst postScaleShapePagePoint = Vec.Add(shapePageTransformOrigin, pageDelta)\n\t\tconst { x, y } = this.getPointInParentSpace(id, postScaleShapePagePoint)\n\n\t\tthis.updateShapes([{ id, type, x, y }], { squashing: true })\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Get the initial meta value for a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.getInitialMetaForShape = (shape) => {\n\t *   if (shape.type === 'note') {\n\t *     return { createdBy: myCurrentUser.id }\n\t *   }\n\t * }\n\t * ```\n\t *\n\t * @param shape - The shape to get the initial meta for.\n\t *\n\t * @public\n\t */\n\tgetInitialMetaForShape(_shape: TLShape): JsonObject {\n\t\treturn {}\n\t}\n\n\t/**\n\t * Create a single shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.createShape(myShape)\n\t * editor.createShape({ id: 'box1', type: 'text', props: { text: \"ok\" } })\n\t * ```\n\t *\n\t * @param shape - The shape (or shape partial) to create.\n\t *\n\t * @public\n\t */\n\tcreateShape<T extends TLUnknownShape>(shape: OptionalKeys<TLShapePartial<T>, 'id'>): this {\n\t\tthis._createShapes([shape])\n\t\treturn this\n\t}\n\n\t/**\n\t * Create shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.createShapes([myShape])\n\t * editor.createShapes([{ id: 'box1', type: 'text', props: { text: \"ok\" } }])\n\t * ```\n\t *\n\t * @param shapes - The shapes (or shape partials) to create.\n\t * @param select - Whether to select the created shapes. Defaults to false.\n\t *\n\t * @public\n\t */\n\tcreateShapes<T extends TLUnknownShape>(shapes: OptionalKeys<TLShapePartial<T>, 'id'>[]) {\n\t\tif (!Array.isArray(shapes)) {\n\t\t\tthrow Error('Editor.createShapes: must provide an array of shapes or shape partials')\n\t\t}\n\t\tthis._createShapes(shapes)\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _createShapes = this.history.createCommand(\n\t\t'createShapes',\n\t\t(partials: OptionalKeys<TLShapePartial, 'id'>[]) => {\n\t\t\tif (this.getInstanceState().isReadonly) return null\n\t\t\tif (partials.length <= 0) return null\n\n\t\t\tconst currentPageShapeIds = this.getCurrentPageShapeIds()\n\n\t\t\tconst maxShapesReached = partials.length + currentPageShapeIds.size > MAX_SHAPES_PER_PAGE\n\n\t\t\tif (maxShapesReached) {\n\t\t\t\t// can't create more shapes than fit on the page\n\t\t\t\talertMaxShapes(this)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (partials.length === 0) return null\n\n\t\t\treturn {\n\t\t\t\tdata: {\n\t\t\t\t\tcurrentPageId: this.getCurrentPageId(),\n\t\t\t\t\tpartials: partials.map((p) =>\n\t\t\t\t\t\tp.id ? p : { ...p, id: createShapeId() }\n\t\t\t\t\t) as TLShapePartial[],\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tdo: ({ partials }) => {\n\t\t\t\tconst focusedGroupId = this.getFocusedGroupId()\n\n\t\t\t\t// 1. Parents\n\n\t\t\t\t// Make sure that each partial will become the child of either the\n\t\t\t\t// page or another shape that exists (or that will exist) in this page.\n\n\t\t\t\t// find last parent id\n\t\t\t\tconst currentPageShapesSorted = this.getCurrentPageShapesSorted()\n\n\t\t\t\tpartials = partials.map((partial) => {\n\t\t\t\t\t// If the partial does not provide the parentId OR if the provided\n\t\t\t\t\t// parentId is NOT in the store AND NOT among the other shapes being\n\t\t\t\t\t// created, then we need to find a parent for the shape. This can be\n\t\t\t\t\t// another shape that exists under that point and which can receive\n\t\t\t\t\t// children of the creating shape's type, or else the page itself.\n\t\t\t\t\tif (\n\t\t\t\t\t\t!partial.parentId ||\n\t\t\t\t\t\t!(this.store.has(partial.parentId) || partials.some((p) => p.id === partial.parentId))\n\t\t\t\t\t) {\n\t\t\t\t\t\tlet parentId: TLParentId = this.getFocusedGroupId()\n\n\t\t\t\t\t\tfor (let i = currentPageShapesSorted.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\tconst parent = currentPageShapesSorted[i]\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t// parent.type === 'frame'\n\t\t\t\t\t\t\t\tthis.getShapeUtil(parent).canReceiveNewChildrenOfType(parent, partial.type) &&\n\t\t\t\t\t\t\t\tthis.isPointInShape(\n\t\t\t\t\t\t\t\t\tparent,\n\t\t\t\t\t\t\t\t\t// If no parent is provided, then we can treat the\n\t\t\t\t\t\t\t\t\t// shape's provided x/y as being in the page's space.\n\t\t\t\t\t\t\t\t\t{ x: partial.x ?? 0, y: partial.y ?? 0 },\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tmargin: 0,\n\t\t\t\t\t\t\t\t\t\thitInside: true,\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tparentId = parent.id\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst prevParentId = partial.parentId\n\n\t\t\t\t\t\t// a shape cannot be it's own parent. This was a rare issue with frames/groups in the syncFuzz tests.\n\t\t\t\t\t\tif (parentId === partial.id) {\n\t\t\t\t\t\t\tparentId = focusedGroupId\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If the parentid has changed...\n\t\t\t\t\t\tif (parentId !== prevParentId) {\n\t\t\t\t\t\t\tpartial = { ...partial }\n\n\t\t\t\t\t\t\tpartial.parentId = parentId\n\n\t\t\t\t\t\t\t// If the parent is a shape (rather than a page) then insert the\n\t\t\t\t\t\t\t// shapes into the shape's children. Adjust the point and page rotation to be\n\t\t\t\t\t\t\t// preserved relative to the parent.\n\t\t\t\t\t\t\tif (isShapeId(parentId)) {\n\t\t\t\t\t\t\t\tconst point = this.getPointInShapeSpace(this.getShape(parentId)!, {\n\t\t\t\t\t\t\t\t\tx: partial.x ?? 0,\n\t\t\t\t\t\t\t\t\ty: partial.y ?? 0,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tpartial.x = point.x\n\t\t\t\t\t\t\t\tpartial.y = point.y\n\t\t\t\t\t\t\t\tpartial.rotation =\n\t\t\t\t\t\t\t\t\t-this.getShapePageTransform(parentId)!.rotation() + (partial.rotation ?? 0)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn partial\n\t\t\t\t})\n\n\t\t\t\t// 2. Indices\n\n\t\t\t\t// Get the highest index among the parents of each of the\n\t\t\t\t// the shapes being created; we'll increment from there.\n\n\t\t\t\tconst parentIndices = new Map<TLParentId, IndexKey>()\n\n\t\t\t\tconst shapeRecordsToCreate: TLShape[] = []\n\n\t\t\t\tfor (const partial of partials) {\n\t\t\t\t\tconst util = this.getShapeUtil(partial)\n\n\t\t\t\t\t// If an index is not explicitly provided, then add the\n\t\t\t\t\t// shapes to the top of their parents' children; using the\n\t\t\t\t\t// value in parentsMappedToIndex, get the index above, use it,\n\t\t\t\t\t// and set it back to parentsMappedToIndex for next time.\n\t\t\t\t\tlet index = partial.index\n\n\t\t\t\t\tif (!index) {\n\t\t\t\t\t\t// Hello bug-seeker: have you just created a frame and then a shape\n\t\t\t\t\t\t// and found that the shape is automatically the child of the frame?\n\t\t\t\t\t\t// this is the reason why! It would be harder to have each shape specify\n\t\t\t\t\t\t// the frame as the parent when creating a shape inside of a frame, so\n\t\t\t\t\t\t// we do it here.\n\t\t\t\t\t\tconst parentId = partial.parentId ?? focusedGroupId\n\n\t\t\t\t\t\tif (!parentIndices.has(parentId)) {\n\t\t\t\t\t\t\tparentIndices.set(parentId, this.getHighestIndexForParent(parentId))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tindex = parentIndices.get(parentId)!\n\t\t\t\t\t\tparentIndices.set(parentId, getIndexAbove(index))\n\t\t\t\t\t}\n\n\t\t\t\t\t// The initial props starts as the shape utility's default props\n\t\t\t\t\tconst initialProps = util.getDefaultProps()\n\n\t\t\t\t\t// We then look up each key in the tab state's styles; and if it's there,\n\t\t\t\t\t// we use the value from the tab state's styles instead of the default.\n\t\t\t\t\tfor (const [style, propKey] of this.styleProps[partial.type]) {\n\t\t\t\t\t\t;(initialProps as any)[propKey] = this.getStyleForNextShape(style)\n\t\t\t\t\t}\n\n\t\t\t\t\t// When we create the shape, take in the partial (the props coming into the\n\t\t\t\t\t// function) and merge it with the default props.\n\t\t\t\t\tlet shapeRecordToCreate = (\n\t\t\t\t\t\tthis.store.schema.types.shape as RecordType<\n\t\t\t\t\t\t\tTLShape,\n\t\t\t\t\t\t\t'type' | 'props' | 'index' | 'parentId'\n\t\t\t\t\t\t>\n\t\t\t\t\t).create({\n\t\t\t\t\t\t...partial,\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\topacity: partial.opacity ?? this.getInstanceState().opacityForNextShape,\n\t\t\t\t\t\tparentId: partial.parentId ?? focusedGroupId,\n\t\t\t\t\t\tprops: 'props' in partial ? { ...initialProps, ...partial.props } : initialProps,\n\t\t\t\t\t})\n\n\t\t\t\t\tif (shapeRecordToCreate.index === undefined) {\n\t\t\t\t\t\tthrow Error('no index!')\n\t\t\t\t\t}\n\n\t\t\t\t\tconst next = this.getShapeUtil(shapeRecordToCreate).onBeforeCreate?.(shapeRecordToCreate)\n\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\tshapeRecordToCreate = next\n\t\t\t\t\t}\n\n\t\t\t\t\tshapeRecordsToCreate.push(shapeRecordToCreate)\n\t\t\t\t}\n\n\t\t\t\t// Add meta properties, if any, to the shapes\n\t\t\t\tshapeRecordsToCreate.forEach((shape) => {\n\t\t\t\t\tshape.meta = {\n\t\t\t\t\t\t...this.getInitialMetaForShape(shape),\n\t\t\t\t\t\t...shape.meta,\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tthis.store.put(shapeRecordsToCreate)\n\t\t\t},\n\t\t\tundo: ({ partials }) => {\n\t\t\t\tthis.store.remove(partials.map((p) => p.id))\n\t\t\t},\n\t\t}\n\t)\n\n\tprivate animatingShapes = new Map<TLShapeId, string>()\n\n\t/**\n\t * Animate a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.animateShape({ id: 'box1', type: 'box', x: 100, y: 100 })\n\t * editor.animateShape({ id: 'box1', type: 'box', x: 100, y: 100 }, { duration: 100, ease: t => t*t })\n\t * ```\n\t *\n\t * @param partial - The shape partial to update.\n\t * @param options - The animation's options.\n\t *\n\t * @public\n\t */\n\tanimateShape(\n\t\tpartial: TLShapePartial | null | undefined,\n\t\tanimationOptions?: TLAnimationOptions\n\t): this {\n\t\treturn this.animateShapes([partial], animationOptions)\n\t}\n\n\t/**\n\t * Animate shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.animateShapes([{ id: 'box1', type: 'box', x: 100, y: 100 }])\n\t * editor.animateShapes([{ id: 'box1', type: 'box', x: 100, y: 100 }], { duration: 100, ease: t => t*t })\n\t * ```\n\t *\n\t * @param partials - The shape partials to update.\n\t * @param options - The animation's options.\n\t *\n\t * @public\n\t */\n\tanimateShapes(\n\t\tpartials: (TLShapePartial | null | undefined)[],\n\t\tanimationOptions = {} as TLAnimationOptions\n\t): this {\n\t\tconst { duration = 500, easing = EASINGS.linear } = animationOptions\n\n\t\tconst animationId = uniqueId()\n\n\t\tlet remaining = duration\n\t\tlet t: number\n\n\t\ttype ShapeAnimation = {\n\t\t\tpartial: TLShapePartial\n\t\t\tvalues: { prop: string; from: number; to: number }[]\n\t\t}\n\n\t\tconst animations: ShapeAnimation[] = []\n\n\t\tlet partial: TLShapePartial | null | undefined, result: ShapeAnimation\n\t\tfor (let i = 0, n = partials.length; i < n; i++) {\n\t\t\tpartial = partials[i]\n\t\t\tif (!partial) continue\n\n\t\t\tresult = {\n\t\t\t\tpartial,\n\t\t\t\tvalues: [],\n\t\t\t}\n\n\t\t\tconst shape = this.getShape(partial.id)!\n\t\t\tif (!shape) continue\n\n\t\t\t// We only support animations for certain props\n\t\t\tfor (const key of ['x', 'y', 'rotation'] as const) {\n\t\t\t\tif (partial[key] !== undefined && shape[key] !== partial[key]) {\n\t\t\t\t\tresult.values.push({ prop: key, from: shape[key], to: partial[key] as number })\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tanimations.push(result)\n\t\t\tthis.animatingShapes.set(shape.id, animationId)\n\t\t}\n\n\t\tlet value: ShapeAnimation\n\n\t\tconst handleTick = (elapsed: number) => {\n\t\t\tremaining -= elapsed\n\n\t\t\tif (remaining < 0) {\n\t\t\t\tconst { animatingShapes } = this\n\t\t\t\tconst partialsToUpdate = partials.filter(\n\t\t\t\t\t(p) => p && animatingShapes.get(p.id) === animationId\n\t\t\t\t)\n\t\t\t\tif (partialsToUpdate.length) {\n\t\t\t\t\tthis.updateShapes(partialsToUpdate, { squashing: false })\n\t\t\t\t\t// update shapes also removes the shape from animating shapes\n\t\t\t\t}\n\n\t\t\t\tthis.removeListener('tick', handleTick)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tt = easing(1 - remaining / duration)\n\n\t\t\tconst { animatingShapes } = this\n\n\t\t\tconst updates: TLShapePartial[] = []\n\n\t\t\tlet animationIdForShape: string | undefined\n\t\t\tfor (let i = 0, n = animations.length; i < n; i++) {\n\t\t\t\tvalue = animations[i]\n\t\t\t\t// Is the animation for this shape still active?\n\t\t\t\tanimationIdForShape = animatingShapes.get(value.partial.id)\n\t\t\t\tif (animationIdForShape !== animationId) continue\n\n\t\t\t\t// Create the update\n\t\t\t\tupdates.push({\n\t\t\t\t\tid: value.partial.id,\n\t\t\t\t\ttype: value.partial.type,\n\t\t\t\t\t...value.values.reduce((acc, { prop, from, to }) => {\n\t\t\t\t\t\tacc[prop] = from + (to - from) * t\n\t\t\t\t\t\treturn acc\n\t\t\t\t\t}, {} as any),\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tthis._updateShapes(updates, { squashing: true })\n\t\t}\n\n\t\tthis.addListener('tick', handleTick)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Create a group containing the provided shapes.\n\t *\n\t * @param shapes - The shapes (or shape ids) to group. Defaults to the selected shapes.\n\t * @param groupId - The id of the group to create.\n\t *\n\t * @public\n\t */\n\tgroupShapes(shapes: TLShapeId[] | TLShape[], groupId = createShapeId()): this {\n\t\tif (!Array.isArray(shapes)) {\n\t\t\tthrow Error('Editor.groupShapes: must provide an array of shapes or shape ids')\n\t\t}\n\t\tif (this.getInstanceState().isReadonly) return this\n\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes.map((s) => (s as TLShape).id) as TLShapeId[])\n\n\t\tif (ids.length <= 1) return this\n\n\t\tconst shapesToGroup = compact(this._getUnlockedShapeIds(ids).map((id) => this.getShape(id)))\n\t\tconst sortedShapeIds = shapesToGroup.sort(sortByIndex).map((s) => s.id)\n\t\tconst pageBounds = Box.Common(compact(shapesToGroup.map((id) => this.getShapePageBounds(id))))\n\n\t\tconst { x, y } = pageBounds.point\n\n\t\tconst parentId = this.findCommonAncestor(shapesToGroup) ?? this.getCurrentPageId()\n\n\t\t// Only group when the select tool is active\n\t\tif (this.getCurrentToolId() !== 'select') return this\n\n\t\t// If not already in idle, cancel the current interaction (get back to idle)\n\t\tif (!this.isIn('select.idle')) {\n\t\t\tthis.cancel()\n\t\t}\n\n\t\t// Find all the shapes that have the same parentId, and use the highest index.\n\t\tconst shapesWithRootParent = shapesToGroup\n\t\t\t.filter((shape) => shape.parentId === parentId)\n\t\t\t.sort(sortByIndex)\n\n\t\tconst highestIndex = shapesWithRootParent[shapesWithRootParent.length - 1]?.index\n\n\t\tthis.batch(() => {\n\t\t\tthis.createShapes<TLGroupShape>([\n\t\t\t\t{\n\t\t\t\t\tid: groupId,\n\t\t\t\t\ttype: 'group',\n\t\t\t\t\tparentId,\n\t\t\t\t\tindex: highestIndex,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tprops: {},\n\t\t\t\t},\n\t\t\t])\n\t\t\tthis.reparentShapes(sortedShapeIds, groupId)\n\t\t\tthis.select(groupId)\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Ungroup some shapes.\n\t *\n\t * @param ids - Ids of the shapes to ungroup. Defaults to the selected shapes.\n\t *\n\t * @public\n\t */\n\tungroupShapes(ids: TLShapeId[]): this\n\tungroupShapes(ids: TLShape[]): this\n\tungroupShapes(_ids: TLShapeId[] | TLShape[]) {\n\t\tconst ids =\n\t\t\ttypeof _ids[0] === 'string' ? (_ids as TLShapeId[]) : (_ids as TLShape[]).map((s) => s.id)\n\t\tif (this.getInstanceState().isReadonly) return this\n\t\tif (ids.length === 0) return this\n\n\t\t// Only ungroup when the select tool is active\n\t\tif (this.getCurrentToolId() !== 'select') return this\n\n\t\t// If not already in idle, cancel the current interaction (get back to idle)\n\t\tif (!this.isIn('select.idle')) {\n\t\t\tthis.cancel()\n\t\t}\n\n\t\t// The ids of the selected shapes after ungrouping;\n\t\t// these include all of the grouped shapes children,\n\t\t// plus any shapes that were selected apart from the groups.\n\t\tconst idsToSelect = new Set<TLShapeId>()\n\n\t\t// Get all groups in the selection\n\t\tconst shapes = compact(ids.map((id) => this.getShape(id)))\n\n\t\tconst groups: TLGroupShape[] = []\n\n\t\tshapes.forEach((shape) => {\n\t\t\tif (this.isShapeOfType<TLGroupShape>(shape, 'group')) {\n\t\t\t\tgroups.push(shape)\n\t\t\t} else {\n\t\t\t\tidsToSelect.add(shape.id)\n\t\t\t}\n\t\t})\n\n\t\tif (groups.length === 0) return this\n\n\t\tthis.batch(() => {\n\t\t\tlet group: TLGroupShape\n\n\t\t\tfor (let i = 0, n = groups.length; i < n; i++) {\n\t\t\t\tgroup = groups[i]\n\t\t\t\tconst childIds = this.getSortedChildIdsForParent(group.id)\n\n\t\t\t\tfor (let j = 0, n = childIds.length; j < n; j++) {\n\t\t\t\t\tidsToSelect.add(childIds[j])\n\t\t\t\t}\n\n\t\t\t\tthis.reparentShapes(childIds, group.parentId, group.index)\n\t\t\t}\n\n\t\t\tthis.deleteShapes(groups.map((group) => group.id))\n\t\t\tthis.select(...idsToSelect)\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Update a shape using a partial of the shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.updateShape({ id: 'box1', type: 'geo', props: { w: 100, h: 100 } })\n\t * ```\n\t *\n\t * @param partial - The shape partial to update.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tupdateShape<T extends TLUnknownShape>(\n\t\tpartial: TLShapePartial<T> | null | undefined,\n\t\thistoryOptions?: TLCommandHistoryOptions\n\t) {\n\t\tthis.updateShapes([partial], historyOptions)\n\t\treturn this\n\t}\n\n\t/**\n\t * Update shapes using partials of each shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.updateShapes([{ id: 'box1', type: 'geo', props: { w: 100, h: 100 } }])\n\t * ```\n\t *\n\t * @param partials - The shape partials to update.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tupdateShapes<T extends TLUnknownShape>(\n\t\tpartials: (TLShapePartial<T> | null | undefined)[],\n\t\thistoryOptions?: TLCommandHistoryOptions\n\t) {\n\t\tconst compactedPartials: TLShapePartial<T>[] = Array(partials.length)\n\n\t\tfor (let i = 0, n = partials.length; i < n; i++) {\n\t\t\tconst partial = partials[i]\n\t\t\tif (!partial) continue\n\t\t\t// Get the current shape referenced by the partial\n\t\t\tconst shape = this.getShape(partial.id)\n\t\t\tif (!shape) continue\n\n\t\t\t// If the shape is locked and we're not setting isLocked to true, continue\n\t\t\tif (this.isShapeOrAncestorLocked(shape) && !Object.hasOwn(partial, 'isLocked')) continue\n\n\t\t\t// Remove any animating shapes from the list of partials\n\t\t\tthis.animatingShapes.delete(partial.id)\n\n\t\t\tcompactedPartials.push(partial)\n\t\t}\n\n\t\tthis._updateShapes(compactedPartials, historyOptions)\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _updateShapes = this.history.createCommand(\n\t\t'updateShapes',\n\t\t(\n\t\t\t_partials: (TLShapePartial | null | undefined)[],\n\t\t\thistoryOptions?: TLCommandHistoryOptions\n\t\t) => {\n\t\t\tif (this.getInstanceState().isReadonly) return null\n\n\t\t\tconst snapshots: Record<string, TLShape> = {}\n\t\t\tconst updates: Record<string, TLShape> = {}\n\n\t\t\tlet shape: TLShape | undefined\n\t\t\tlet updated: TLShape\n\n\t\t\tfor (let i = 0, n = _partials.length; i < n; i++) {\n\t\t\t\tconst partial = _partials[i]\n\t\t\t\t// Skip nullish partials (sometimes created by map fns returning undefined)\n\t\t\t\tif (!partial) continue\n\n\t\t\t\t// Get the current shape referenced by the partial\n\t\t\t\t// If there is no current shape, we'll skip this update\n\t\t\t\tshape = this.getShape(partial.id)\n\t\t\t\tif (!shape) continue\n\n\t\t\t\t// Get the updated version of the shape\n\t\t\t\t// If the update had no effect, we'll skip this update\n\t\t\t\tupdated = applyPartialToShape(shape, partial)\n\t\t\t\tif (updated === shape) continue\n\n\t\t\t\tsnapshots[shape.id] = shape\n\t\t\t\tupdates[shape.id] = updated\n\t\t\t}\n\n\t\t\treturn { data: { snapshots, updates }, ...historyOptions }\n\t\t},\n\t\t{\n\t\t\tdo: ({ updates }) => {\n\t\t\t\t// Iterate through array; if any shape has an onBeforeUpdate handler, call it\n\t\t\t\t// and, if the handler returns a new shape, replace the old shape with\n\t\t\t\t// the new one. This is used for example when repositioning a text shape\n\t\t\t\t// based on its new text content.\n\t\t\t\tthis.store.put(\n\t\t\t\t\tobjectMapValues(updates).map((shape) => {\n\t\t\t\t\t\tconst current = this.store.get(shape.id)\n\t\t\t\t\t\tif (current) {\n\t\t\t\t\t\t\tconst next = this.getShapeUtil(shape).onBeforeUpdate?.(current, shape)\n\t\t\t\t\t\t\tif (next) return next\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn shape\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t},\n\t\t\tundo: ({ snapshots }) => {\n\t\t\t\tthis.store.put(Object.values(snapshots))\n\t\t\t},\n\t\t\tsquash(prevData, nextData) {\n\t\t\t\treturn {\n\t\t\t\t\t// keep the oldest snapshots\n\t\t\t\t\tsnapshots: { ...nextData.snapshots, ...prevData.snapshots },\n\t\t\t\t\t// keep the newest updates\n\t\t\t\t\tupdates: { ...prevData.updates, ...nextData.updates },\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t)\n\n\t/** @internal */\n\tprivate _getUnlockedShapeIds(ids: TLShapeId[]): TLShapeId[] {\n\t\treturn ids.filter((id) => !this.getShape(id)?.isLocked)\n\t}\n\n\t/**\n\t * Delete shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.deleteShapes(['box1', 'box2'])\n\t * ```\n\t *\n\t * @param ids - The ids of the shapes to delete.\n\t *\n\t * @public\n\t */\n\tdeleteShapes(ids: TLShapeId[]): this\n\tdeleteShapes(shapes: TLShape[]): this\n\tdeleteShapes(_ids: TLShapeId[] | TLShape[]) {\n\t\tif (!Array.isArray(_ids)) {\n\t\t\tthrow Error('Editor.deleteShapes: must provide an array of shapes or shapeIds')\n\t\t}\n\t\tthis._deleteShapes(\n\t\t\tthis._getUnlockedShapeIds(\n\t\t\t\ttypeof _ids[0] === 'string' ? (_ids as TLShapeId[]) : (_ids as TLShape[]).map((s) => s.id)\n\t\t\t)\n\t\t)\n\t\treturn this\n\t}\n\n\t/**\n\t * Delete a shape.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.deleteShape(shape.id)\n\t * ```\n\t *\n\t * @param id - The id of the shape to delete.\n\t *\n\t * @public\n\t */\n\tdeleteShape(id: TLShapeId): this\n\tdeleteShape(shape: TLShape): this\n\tdeleteShape(_id: TLShapeId | TLShape) {\n\t\tthis.deleteShapes([typeof _id === 'string' ? _id : _id.id])\n\t\treturn this\n\t}\n\n\t/** @internal */\n\tprivate _deleteShapes = this.history.createCommand(\n\t\t'delete_shapes',\n\t\t(ids: TLShapeId[]) => {\n\t\t\tif (this.getInstanceState().isReadonly) return null\n\t\t\tif (ids.length === 0) return null\n\t\t\tconst prevSelectedShapeIds = [...this.getCurrentPageState().selectedShapeIds]\n\n\t\t\tconst allIds = new Set(ids)\n\n\t\t\tfor (const id of ids) {\n\t\t\t\tthis.visitDescendants(id, (childId) => {\n\t\t\t\t\tallIds.add(childId)\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tconst deletedIds = [...allIds]\n\t\t\tconst arrowBindings = this._getArrowBindingsIndex().get()\n\t\t\tconst snapshots = compact(\n\t\t\t\tdeletedIds.flatMap((id) => {\n\t\t\t\t\tconst shape = this.getShape(id)\n\n\t\t\t\t\t// Add any bound arrows to the snapshots, so that we can restore the bindings on undo\n\t\t\t\t\tconst bindings = arrowBindings[id]\n\t\t\t\t\tif (bindings && bindings.length > 0) {\n\t\t\t\t\t\treturn bindings.map(({ arrowId }) => this.getShape(arrowId)).concat(shape)\n\t\t\t\t\t}\n\t\t\t\t\treturn shape\n\t\t\t\t})\n\t\t\t)\n\n\t\t\tconst postSelectedShapeIds = prevSelectedShapeIds.filter((id) => !allIds.has(id))\n\n\t\t\treturn { data: { deletedIds, snapshots, prevSelectedShapeIds, postSelectedShapeIds } }\n\t\t},\n\t\t{\n\t\t\tdo: ({ deletedIds, postSelectedShapeIds }) => {\n\t\t\t\tthis.store.remove(deletedIds)\n\t\t\t\tthis.store.update(this.getCurrentPageState().id, (state) => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tselectedShapeIds: postSelectedShapeIds,\n\t\t\t\t}))\n\t\t\t},\n\t\t\tundo: ({ snapshots, prevSelectedShapeIds }) => {\n\t\t\t\tthis.store.put(snapshots)\n\t\t\t\tthis.store.update(this.getCurrentPageState().id, (state) => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tselectedShapeIds: prevSelectedShapeIds,\n\t\t\t\t}))\n\t\t\t},\n\t\t}\n\t)\n\n\t/* --------------------- Styles --------------------- */\n\n\t/**\n\t * Get all the current styles among the users selected shapes\n\t *\n\t * @internal\n\t */\n\tprivate _extractSharedStyles(shape: TLShape, sharedStyleMap: SharedStyleMap) {\n\t\tif (this.isShapeOfType<TLGroupShape>(shape, 'group')) {\n\t\t\t// For groups, ignore the styles of the group shape and instead include the styles of the\n\t\t\t// group's children. These are the shapes that would have their styles changed if the\n\t\t\t// user called `setStyle` on the current selection.\n\t\t\tconst childIds = this._parentIdsToChildIds.get()[shape.id]\n\t\t\tif (!childIds) return\n\n\t\t\tfor (let i = 0, n = childIds.length; i < n; i++) {\n\t\t\t\tthis._extractSharedStyles(this.getShape(childIds[i])!, sharedStyleMap)\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const [style, propKey] of this.styleProps[shape.type]) {\n\t\t\t\tsharedStyleMap.applyValue(style, getOwnProperty(shape.props, propKey))\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * A derived map containing all current styles among the user's selected shapes.\n\t *\n\t * @internal\n\t */\n\t@computed\n\tprivate _getSelectionSharedStyles(): ReadonlySharedStyleMap {\n\t\tconst selectedShapes = this.getSelectedShapes()\n\n\t\tconst sharedStyles = new SharedStyleMap()\n\t\tfor (const selectedShape of selectedShapes) {\n\t\t\tthis._extractSharedStyles(selectedShape, sharedStyles)\n\t\t}\n\n\t\treturn sharedStyles\n\t}\n\n\t/**\n\t * Get the style for the next shape.\n\t *\n\t * @example\n\t * ```ts\n\t * const color = editor.getStyleForNextShape(DefaultColorStyle)\n\t * ```\n\t *\n\t * @param style - The style to get.\n\t *\n\t * @public */\n\tgetStyleForNextShape<T>(style: StyleProp<T>): T {\n\t\tconst value = this.getInstanceState().stylesForNextShape[style.id]\n\t\treturn value === undefined ? style.defaultValue : (value as T)\n\t}\n\n\tgetShapeStyleIfExists<T>(shape: TLShape, style: StyleProp<T>): T | undefined {\n\t\tconst styleKey = this.styleProps[shape.type].get(style)\n\t\tif (styleKey === undefined) return undefined\n\t\treturn getOwnProperty(shape.props, styleKey) as T | undefined\n\t}\n\n\t/**\n\t * A map of all the current styles either in the current selection, or that are relevant to the\n\t * current tool.\n\t *\n\t * @example\n\t * ```ts\n\t * const color = editor.getSharedStyles().get(DefaultColorStyle)\n\t * if (color && color.type === 'shared') {\n\t *   print('All selected shapes have the same color:', color.value)\n\t * }\n\t * ```\n\t *\n\t * @public\n\t */\n\t@computed<ReadonlySharedStyleMap>({ isEqual: (a, b) => a.equals(b) })\n\tgetSharedStyles(): ReadonlySharedStyleMap {\n\t\t// If we're in selecting and if we have a selection, return the shared styles from the\n\t\t// current selection\n\t\tif (this.isIn('select') && this.getSelectedShapeIds().length > 0) {\n\t\t\treturn this._getSelectionSharedStyles()\n\t\t}\n\n\t\t// If the current tool is associated with a shape, return the styles for that shape.\n\t\t// Otherwise, just return an empty map.\n\t\tconst currentTool = this.root.getCurrent()!\n\t\tconst styles = new SharedStyleMap()\n\n\t\tif (!currentTool) return styles\n\n\t\tif (currentTool.shapeType) {\n\t\t\tfor (const style of this.styleProps[currentTool.shapeType].keys()) {\n\t\t\t\tstyles.applyValue(style, this.getStyleForNextShape(style))\n\t\t\t}\n\t\t}\n\n\t\treturn styles\n\t}\n\n\t/**\n\t * Get the currently selected shared opacity.\n\t * If any shapes are selected, this returns the shared opacity of the selected shapes.\n\t * Otherwise, this returns the chosen opacity for the next shape.\n\t *\n\t * @public\n\t */\n\t@computed getSharedOpacity(): SharedStyle<number> {\n\t\tif (this.isIn('select') && this.getSelectedShapeIds().length > 0) {\n\t\t\tconst shapesToCheck: TLShape[] = []\n\t\t\tconst addShape = (shapeId: TLShapeId) => {\n\t\t\t\tconst shape = this.getShape(shapeId)\n\t\t\t\tif (!shape) return\n\t\t\t\t// For groups, ignore the opacity of the group shape and instead include\n\t\t\t\t// the opacity of the group's children. These are the shapes that would have\n\t\t\t\t// their opacity changed if the user called `setOpacity` on the current selection.\n\t\t\t\tif (this.isShapeOfType<TLGroupShape>(shape, 'group')) {\n\t\t\t\t\tfor (const childId of this.getSortedChildIdsForParent(shape.id)) {\n\t\t\t\t\t\taddShape(childId)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tshapesToCheck.push(shape)\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const shapeId of this.getSelectedShapeIds()) {\n\t\t\t\taddShape(shapeId)\n\t\t\t}\n\n\t\t\tlet opacity: number | null = null\n\t\t\tfor (const shape of shapesToCheck) {\n\t\t\t\tif (opacity === null) {\n\t\t\t\t\topacity = shape.opacity\n\t\t\t\t} else if (opacity !== shape.opacity) {\n\t\t\t\t\treturn { type: 'mixed' }\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (opacity !== null) return { type: 'shared', value: opacity }\n\t\t}\n\t\treturn { type: 'shared', value: this.getInstanceState().opacityForNextShape }\n\t}\n\n\t/**\n\t * Set the opacity for the next shapes. This will effect subsequently created shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setOpacityForNextShapes(0.5)\n\t * editor.setOpacityForNextShapes(0.5, { squashing: true })\n\t * ```\n\t *\n\t * @param opacity - The opacity to set. Must be a number between 0 and 1 inclusive.\n\t * @param historyOptions - The history options for the change.\n\t */\n\tsetOpacityForNextShapes(opacity: number, historyOptions?: TLCommandHistoryOptions): this {\n\t\tthis.updateInstanceState({ opacityForNextShape: opacity }, historyOptions)\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the current opacity. This will effect any selected shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setOpacityForSelectedShapes(0.5)\n\t * editor.setOpacityForSelectedShapes(0.5, { squashing: true })\n\t * ```\n\t *\n\t * @param opacity - The opacity to set. Must be a number between 0 and 1 inclusive.\n\t * @param historyOptions - The history options for the change.\n\t */\n\tsetOpacityForSelectedShapes(opacity: number, historyOptions?: TLCommandHistoryOptions): this {\n\t\tconst selectedShapes = this.getSelectedShapes()\n\n\t\tif (selectedShapes.length > 0) {\n\t\t\tconst shapesToUpdate: TLShape[] = []\n\n\t\t\t// We can have many deep levels of grouped shape\n\t\t\t// Making a recursive function to look through all the levels\n\t\t\tconst addShapeById = (shape: TLShape) => {\n\t\t\t\tif (this.isShapeOfType<TLGroupShape>(shape, 'group')) {\n\t\t\t\t\tconst childIds = this.getSortedChildIdsForParent(shape)\n\t\t\t\t\tfor (const childId of childIds) {\n\t\t\t\t\t\taddShapeById(this.getShape(childId)!)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tshapesToUpdate.push(shape)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const id of selectedShapes) {\n\t\t\t\taddShapeById(id)\n\t\t\t}\n\n\t\t\tthis.updateShapes(\n\t\t\t\tshapesToUpdate.map((shape) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: shape.id,\n\t\t\t\t\t\ttype: shape.type,\n\t\t\t\t\t\topacity,\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\thistoryOptions\n\t\t\t)\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the value of a {@link @tldraw/tlschema#StyleProp} for the next shapes. This change will be applied to subsequently created shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setStyleForNextShapes(DefaultColorStyle, 'red')\n\t * editor.setStyleForNextShapes(DefaultColorStyle, 'red', { ephemeral: true })\n\t * ```\n\t *\n\t * @param style - The style to set.\n\t * @param value - The value to set.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tsetStyleForNextShapes<T>(\n\t\tstyle: StyleProp<T>,\n\t\tvalue: T,\n\t\thistoryOptions?: TLCommandHistoryOptions\n\t): this {\n\t\tconst stylesForNextShape = this.getInstanceState().stylesForNextShape\n\n\t\tthis.updateInstanceState(\n\t\t\t{ stylesForNextShape: { ...stylesForNextShape, [style.id]: value } },\n\t\t\thistoryOptions\n\t\t)\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the value of a {@link @tldraw/tlschema#StyleProp}. This change will be applied to the currently selected shapes.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.setStyleForSelectedShapes(DefaultColorStyle, 'red')\n\t * editor.setStyleForSelectedShapes(DefaultColorStyle, 'red', { ephemeral: true })\n\t * ```\n\t *\n\t * @param style - The style to set.\n\t * @param value - The value to set.\n\t * @param historyOptions - The history options for the change.\n\t *\n\t * @public\n\t */\n\tsetStyleForSelectedShapes<S extends StyleProp<any>>(\n\t\tstyle: S,\n\t\tvalue: StylePropValue<S>,\n\t\thistoryOptions?: TLCommandHistoryOptions\n\t): this {\n\t\tconst selectedShapes = this.getSelectedShapes()\n\n\t\tif (selectedShapes.length > 0) {\n\t\t\tconst updates: {\n\t\t\t\tutil: ShapeUtil\n\t\t\t\toriginalShape: TLShape\n\t\t\t\tupdatePartial: TLShapePartial\n\t\t\t}[] = []\n\n\t\t\t// We can have many deep levels of grouped shape\n\t\t\t// Making a recursive function to look through all the levels\n\t\t\tconst addShapeById = (shape: TLShape) => {\n\t\t\t\tif (this.isShapeOfType<TLGroupShape>(shape, 'group')) {\n\t\t\t\t\tconst childIds = this.getSortedChildIdsForParent(shape.id)\n\t\t\t\t\tfor (const childId of childIds) {\n\t\t\t\t\t\taddShapeById(this.getShape(childId)!)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst util = this.getShapeUtil(shape)\n\t\t\t\t\tconst stylePropKey = this.styleProps[shape.type].get(style)\n\t\t\t\t\tif (stylePropKey) {\n\t\t\t\t\t\tconst shapePartial: TLShapePartial = {\n\t\t\t\t\t\t\tid: shape.id,\n\t\t\t\t\t\t\ttype: shape.type,\n\t\t\t\t\t\t\tprops: { [stylePropKey]: value },\n\t\t\t\t\t\t}\n\t\t\t\t\t\tupdates.push({\n\t\t\t\t\t\t\tutil,\n\t\t\t\t\t\t\toriginalShape: shape,\n\t\t\t\t\t\t\tupdatePartial: shapePartial,\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const shape of selectedShapes) {\n\t\t\t\taddShapeById(shape)\n\t\t\t}\n\n\t\t\tthis.updateShapes(\n\t\t\t\tupdates.map(({ updatePartial }) => updatePartial),\n\t\t\t\thistoryOptions\n\t\t\t)\n\t\t}\n\n\t\treturn this\n\t}\n\n\t/* --------------------- Content -------------------- */\n\n\t/** @internal */\n\texternalAssetContentHandlers: {\n\t\t[K in TLExternalAssetContent['type']]: {\n\t\t\t[Key in K]:\n\t\t\t\t| null\n\t\t\t\t| ((info: TLExternalAssetContent & { type: Key }) => Promise<TLAsset | undefined>)\n\t\t}[K]\n\t} = {\n\t\tfile: null,\n\t\turl: null,\n\t}\n\n\t/**\n\t * Register an external content handler. This handler will be called when the editor receives\n\t * external content of the provided type. For example, the 'image' type handler will be called\n\t * when a user drops an image onto the canvas.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.registerExternalAssetHandler('text', myHandler)\n\t * ```\n\t *\n\t * @param type - The type of external content.\n\t * @param handler - The handler to use for this content type.\n\t *\n\t * @public\n\t */\n\tregisterExternalAssetHandler<T extends TLExternalAssetContent['type']>(\n\t\ttype: T,\n\t\thandler: null | ((info: TLExternalAssetContent & { type: T }) => Promise<TLAsset>)\n\t): this {\n\t\tthis.externalAssetContentHandlers[type] = handler as any\n\t\treturn this\n\t}\n\n\t/**\n\t * Get an asset for an external asset content type.\n\t *\n\t * @example\n\t * ```ts\n\t * const asset = await editor.getAssetForExternalContent({ type: 'file', file: myFile })\n\t * const asset = await editor.getAssetForExternalContent({ type: 'url', url: myUrl })\n\t * ```\n\t *\n\t * @param info - Info about the external content.\n\t * @returns The asset.\n\t */\n\tasync getAssetForExternalContent(info: TLExternalAssetContent): Promise<TLAsset | undefined> {\n\t\treturn await this.externalAssetContentHandlers[info.type]?.(info as any)\n\t}\n\n\t/** @internal */\n\texternalContentHandlers: {\n\t\t[K in TLExternalContent['type']]: {\n\t\t\t[Key in K]: null | ((info: TLExternalContent & { type: Key }) => void)\n\t\t}[K]\n\t} = {\n\t\ttext: null,\n\t\tfiles: null,\n\t\tembed: null,\n\t\t'svg-text': null,\n\t\turl: null,\n\t}\n\n\t/**\n\t * Register an external content handler. This handler will be called when the editor receives\n\t * external content of the provided type. For example, the 'image' type handler will be called\n\t * when a user drops an image onto the canvas.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.registerExternalContentHandler('text', myHandler)\n\t * ```\n\t *\n\t * @param type - The type of external content.\n\t * @param handler - The handler to use for this content type.\n\t *\n\t * @public\n\t */\n\tregisterExternalContentHandler<T extends TLExternalContent['type']>(\n\t\ttype: T,\n\t\thandler:\n\t\t\t| null\n\t\t\t| ((\n\t\t\t\t\tinfo: T extends TLExternalContent['type']\n\t\t\t\t\t\t? TLExternalContent & { type: T }\n\t\t\t\t\t\t: TLExternalContent\n\t\t\t  ) => void)\n\t): this {\n\t\tthis.externalContentHandlers[type] = handler as any\n\t\treturn this\n\t}\n\n\t/**\n\t * Handle external content, such as files, urls, embeds, or plain text which has been put into the app, for example by pasting external text or dropping external images onto canvas.\n\t *\n\t * @param info - Info about the external content.\n\t */\n\tasync putExternalContent(info: TLExternalContent): Promise<void> {\n\t\treturn this.externalContentHandlers[info.type]?.(info as any)\n\t}\n\n\t/**\n\t * Get content that can be exported for the given shape ids.\n\t *\n\t * @param shapes - The shapes (or shape ids) to get content for.\n\t *\n\t * @returns The exported content.\n\t *\n\t * @public\n\t */\n\tgetContentFromCurrentPage(shapes: TLShapeId[] | TLShape[]): TLContent | undefined {\n\t\t// todo: make this work with any page, not just the current page\n\t\tconst ids =\n\t\t\ttypeof shapes[0] === 'string'\n\t\t\t\t? (shapes as TLShapeId[])\n\t\t\t\t: (shapes as TLShape[]).map((s) => s.id)\n\n\t\tif (!ids) return\n\t\tif (ids.length === 0) return\n\n\t\tconst pageTransforms: Record<string, MatModel> = {}\n\n\t\tlet shapesForContent = dedupe(\n\t\t\tids\n\t\t\t\t.map((id) => this.getShape(id)!)\n\t\t\t\t.sort(sortByIndex)\n\t\t\t\t.flatMap((shape) => {\n\t\t\t\t\tconst allShapes = [shape]\n\t\t\t\t\tthis.visitDescendants(shape.id, (descendant) => {\n\t\t\t\t\t\tallShapes.push(this.getShape(descendant)!)\n\t\t\t\t\t})\n\t\t\t\t\treturn allShapes\n\t\t\t\t})\n\t\t)\n\n\t\tshapesForContent = shapesForContent.map((shape) => {\n\t\t\tpageTransforms[shape.id] = this.getShapePageTransform(shape.id)!\n\n\t\t\tshape = structuredClone(shape) as typeof shape\n\n\t\t\tif (this.isShapeOfType<TLArrowShape>(shape, 'arrow')) {\n\t\t\t\tconst startBindingId =\n\t\t\t\t\tshape.props.start.type === 'binding' ? shape.props.start.boundShapeId : undefined\n\n\t\t\t\tconst endBindingId =\n\t\t\t\t\tshape.props.end.type === 'binding' ? shape.props.end.boundShapeId : undefined\n\n\t\t\t\tconst info = this.getArrowInfo(shape)\n\n\t\t\t\tif (shape.props.start.type === 'binding') {\n\t\t\t\t\tif (!shapesForContent.some((s) => s.id === startBindingId)) {\n\t\t\t\t\t\t// Uh oh, the arrow's bound-to shape isn't among the shapes\n\t\t\t\t\t\t// that we're getting the content for. We should try to adjust\n\t\t\t\t\t\t// the arrow so that it appears in the place it would be\n\t\t\t\t\t\tif (info?.isValid) {\n\t\t\t\t\t\t\tconst { x, y } = info.start.point\n\t\t\t\t\t\t\tshape.props.start = {\n\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\t\ty,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst { start } = getArrowTerminalsInArrowSpace(this, shape)\n\t\t\t\t\t\t\tshape.props.start = {\n\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\tx: start.x,\n\t\t\t\t\t\t\t\ty: start.y,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (shape.props.end.type === 'binding') {\n\t\t\t\t\tif (!shapesForContent.some((s) => s.id === endBindingId)) {\n\t\t\t\t\t\tif (info?.isValid) {\n\t\t\t\t\t\t\tconst { x, y } = info.end.point\n\t\t\t\t\t\t\tshape.props.end = {\n\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\t\ty,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst { end } = getArrowTerminalsInArrowSpace(this, shape)\n\t\t\t\t\t\t\tshape.props.end = {\n\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\tx: end.x,\n\t\t\t\t\t\t\t\ty: end.y,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst infoAfter = getIsArrowStraight(shape)\n\t\t\t\t\t? getStraightArrowInfo(this, shape)\n\t\t\t\t\t: getCurvedArrowInfo(this, shape)\n\n\t\t\t\tif (info?.isValid && infoAfter?.isValid && !getIsArrowStraight(shape)) {\n\t\t\t\t\tconst mpA = Vec.Med(info.start.handle, info.end.handle)\n\t\t\t\t\tconst distA = Vec.Dist(info.middle, mpA)\n\t\t\t\t\tconst distB = Vec.Dist(infoAfter.middle, mpA)\n\t\t\t\t\tif (shape.props.bend < 0) {\n\t\t\t\t\t\tshape.props.bend += distB - distA\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshape.props.bend -= distB - distA\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn shape\n\t\t\t}\n\n\t\t\treturn shape\n\t\t})\n\n\t\tconst rootShapeIds: TLShapeId[] = []\n\n\t\tshapesForContent.forEach((shape) => {\n\t\t\tif (shapesForContent.find((s) => s.id === shape.parentId) === undefined) {\n\t\t\t\t// Need to get page point and rotation of the shape because shapes in\n\t\t\t\t// groups use local position/rotation\n\n\t\t\t\tconst pageTransform = this.getShapePageTransform(shape.id)!\n\t\t\t\tconst pagePoint = pageTransform.point()\n\t\t\t\tconst pageRotation = pageTransform.rotation()\n\t\t\t\tshape.x = pagePoint.x\n\t\t\t\tshape.y = pagePoint.y\n\t\t\t\tshape.rotation = pageRotation\n\t\t\t\tshape.parentId = this.getCurrentPageId()\n\n\t\t\t\trootShapeIds.push(shape.id)\n\t\t\t}\n\t\t})\n\n\t\tconst assetsSet = new Set<TLAssetId>()\n\n\t\tshapesForContent.forEach((shape) => {\n\t\t\tif ('assetId' in shape.props) {\n\t\t\t\tif (shape.props.assetId !== null) {\n\t\t\t\t\tassetsSet.add(shape.props.assetId)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\treturn {\n\t\t\tshapes: shapesForContent,\n\t\t\trootShapeIds,\n\t\t\tschema: this.store.schema.serialize(),\n\t\t\tassets: compact(Array.from(assetsSet).map((id) => this.getAsset(id))),\n\t\t}\n\t}\n\n\t/**\n\t * Place content into the editor.\n\t *\n\t * @param content - The content.\n\t * @param options - Options for placing the content.\n\t *\n\t * @public\n\t */\n\tputContentOntoCurrentPage(\n\t\tcontent: TLContent,\n\t\toptions: {\n\t\t\tpoint?: VecLike\n\t\t\tselect?: boolean\n\t\t\tpreservePosition?: boolean\n\t\t\tpreserveIds?: boolean\n\t\t} = {}\n\t): this {\n\t\tif (this.getInstanceState().isReadonly) return this\n\n\t\t// todo: make this able to support putting content onto any page, not just the current page\n\n\t\tif (!content.schema) {\n\t\t\tthrow Error('Could not put content:\\ncontent is missing a schema.')\n\t\t}\n\n\t\tconst { select = false, preserveIds = false, preservePosition = false } = options\n\t\tlet { point = undefined } = options\n\n\t\t// decide on a parent for the put shapes; if the parent is among the put shapes(?) then use its parent\n\n\t\tconst currentPageId = this.getCurrentPageId()\n\t\tconst { rootShapeIds } = content\n\n\t\t// We need to collect the migrated shapes and assets\n\t\tconst assets: TLAsset[] = []\n\t\tconst shapes: TLShape[] = []\n\n\t\t// Let's treat the content as a store, and then migrate that store.\n\t\tconst store: StoreSnapshot<TLRecord> = {\n\t\t\tstore: {\n\t\t\t\t...Object.fromEntries(content.assets.map((asset) => [asset.id, asset] as const)),\n\t\t\t\t...Object.fromEntries(content.shapes.map((asset) => [asset.id, asset] as const)),\n\t\t\t},\n\t\t\tschema: content.schema,\n\t\t}\n\t\tconst result = this.store.schema.migrateStoreSnapshot(store)\n\t\tif (result.type === 'error') {\n\t\t\tthrow Error('Could not put content: could not migrate content')\n\t\t}\n\t\tfor (const record of Object.values(result.value)) {\n\t\t\tswitch (record.typeName) {\n\t\t\t\tcase 'asset': {\n\t\t\t\t\tassets.push(record)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'shape': {\n\t\t\t\t\tshapes.push(record)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Ok, we've got our migrated shapes and assets, now we can continue!\n\t\tconst idMap = new Map<any, TLShapeId>(shapes.map((shape) => [shape.id, createShapeId()]))\n\n\t\t// By default, the paste parent will be the current page.\n\t\tlet pasteParentId = this.getCurrentPageId() as TLPageId | TLShapeId\n\t\tlet lowestDepth = Infinity\n\t\tlet lowestAncestors: TLShape[] = []\n\n\t\t// Among the selected shapes, find the shape with the fewest ancestors and use its first ancestor.\n\t\tfor (const shape of this.getSelectedShapes()) {\n\t\t\tif (lowestDepth === 0) break\n\n\t\t\tconst isFrame = this.isShapeOfType<TLFrameShape>(shape, 'frame')\n\t\t\tconst ancestors = this.getShapeAncestors(shape)\n\t\t\tif (isFrame) ancestors.push(shape)\n\n\t\t\tconst depth = isFrame ? ancestors.length + 1 : ancestors.length\n\n\t\t\tif (depth < lowestDepth) {\n\t\t\t\tlowestDepth = depth\n\t\t\t\tlowestAncestors = ancestors\n\t\t\t\tpasteParentId = isFrame ? shape.id : shape.parentId\n\t\t\t} else if (depth === lowestDepth) {\n\t\t\t\tif (lowestAncestors.length !== ancestors.length) {\n\t\t\t\t\tthrow Error(`Ancestors: ${lowestAncestors.length} !== ${ancestors.length}`)\n\t\t\t\t}\n\n\t\t\t\tif (lowestAncestors.length === 0) {\n\t\t\t\t\tpasteParentId = currentPageId\n\t\t\t\t\tbreak\n\t\t\t\t} else {\n\t\t\t\t\tpasteParentId = currentPageId\n\t\t\t\t\tfor (let i = 0; i < lowestAncestors.length; i++) {\n\t\t\t\t\t\tif (ancestors[i] !== lowestAncestors[i]) break\n\t\t\t\t\t\tpasteParentId = ancestors[i].id\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet isDuplicating = false\n\n\t\tif (!isPageId(pasteParentId)) {\n\t\t\tconst parent = this.getShape(pasteParentId)\n\t\t\tif (parent) {\n\t\t\t\tif (!this.getViewportPageBounds().includes(this.getShapePageBounds(parent)!)) {\n\t\t\t\t\tpasteParentId = currentPageId\n\t\t\t\t} else {\n\t\t\t\t\tif (rootShapeIds.length === 1) {\n\t\t\t\t\t\tconst rootShape = shapes.find((s) => s.id === rootShapeIds[0])!\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tthis.isShapeOfType<TLFrameShape>(parent, 'frame') &&\n\t\t\t\t\t\t\tthis.isShapeOfType<TLFrameShape>(rootShape, 'frame') &&\n\t\t\t\t\t\t\trootShape.props.w === parent?.props.w &&\n\t\t\t\t\t\t\trootShape.props.h === parent?.props.h\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tisDuplicating = true\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpasteParentId = currentPageId\n\t\t\t}\n\t\t}\n\n\t\tif (!isDuplicating) {\n\t\t\tisDuplicating = idMap.has(pasteParentId)\n\t\t}\n\n\t\tif (isDuplicating) {\n\t\t\tpasteParentId = this.getShape(pasteParentId)!.parentId\n\t\t}\n\n\t\tlet index = this.getHighestIndexForParent(pasteParentId) // todo: requires that the putting page is the current page\n\n\t\tconst rootShapes: TLShape[] = []\n\n\t\tconst newShapes: TLShape[] = shapes.map((shape): TLShape => {\n\t\t\tlet newShape: TLShape\n\n\t\t\tif (preserveIds) {\n\t\t\t\tnewShape = structuredClone(shape)\n\t\t\t\tidMap.set(shape.id, shape.id)\n\t\t\t} else {\n\t\t\t\tconst id = idMap.get(shape.id)!\n\n\t\t\t\t// Create the new shape (new except for the id)\n\t\t\t\tnewShape = structuredClone({ ...shape, id })\n\t\t\t}\n\n\t\t\tif (rootShapeIds.includes(shape.id)) {\n\t\t\t\tnewShape.parentId = currentPageId\n\t\t\t\trootShapes.push(newShape)\n\t\t\t}\n\n\t\t\t// Assign the child to its new parent.\n\n\t\t\t// If the child's parent is among the putting shapes, then assign\n\t\t\t// it to the new parent's id.\n\t\t\tif (idMap.has(newShape.parentId)) {\n\t\t\t\tnewShape.parentId = idMap.get(shape.parentId)!\n\t\t\t} else {\n\t\t\t\trootShapeIds.push(newShape.id)\n\t\t\t\t// newShape.parentId = pasteParentId\n\t\t\t\tnewShape.index = index\n\t\t\t\tindex = getIndexAbove(index)\n\t\t\t}\n\n\t\t\tif (this.isShapeOfType<TLArrowShape>(newShape, 'arrow')) {\n\t\t\t\tif (newShape.props.start.type === 'binding') {\n\t\t\t\t\tconst mappedId = idMap.get(newShape.props.start.boundShapeId)\n\t\t\t\t\tnewShape.props.start = mappedId\n\t\t\t\t\t\t? { ...newShape.props.start, boundShapeId: mappedId }\n\t\t\t\t\t\t: // this shouldn't happen, if you copy an arrow but not it's bound shape it should\n\t\t\t\t\t\t\t// convert the binding to a point at the time of copying\n\t\t\t\t\t\t\t{ type: 'point', x: 0, y: 0 }\n\t\t\t\t}\n\t\t\t\tif (newShape.props.end.type === 'binding') {\n\t\t\t\t\tconst mappedId = idMap.get(newShape.props.end.boundShapeId)\n\t\t\t\t\tnewShape.props.end = mappedId\n\t\t\t\t\t\t? { ...newShape.props.end, boundShapeId: mappedId }\n\t\t\t\t\t\t: // this shouldn't happen, if you copy an arrow but not it's bound shape it should\n\t\t\t\t\t\t\t// convert the binding to a point at the time of copying\n\t\t\t\t\t\t\t{ type: 'point', x: 0, y: 0 }\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn newShape\n\t\t})\n\n\t\tif (newShapes.length + this.getCurrentPageShapeIds().size > MAX_SHAPES_PER_PAGE) {\n\t\t\t// There's some complexity here involving children\n\t\t\t// that might be created without their parents, so\n\t\t\t// if we're going over the limit then just don't paste.\n\t\t\talertMaxShapes(this)\n\t\t\treturn this\n\t\t}\n\n\t\t// These are all the assets we need to create\n\t\tconst assetsToCreate: TLAsset[] = []\n\n\t\t// These assets have base64 data that may need to be hosted\n\t\tconst assetsToUpdate: (TLImageAsset | TLVideoAsset)[] = []\n\n\t\tfor (const asset of assets) {\n\t\t\tif (this.store.has(asset.id)) {\n\t\t\t\t// We already have this asset\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(asset.type === 'image' || asset.type === 'video') &&\n\t\t\t\tasset.props.src?.startsWith('data:image')\n\t\t\t) {\n\t\t\t\t// it's src is a base64 image or video; we need to create a new asset without the src,\n\t\t\t\t// then create a new asset from the original src. So we save a copy of the original asset,\n\t\t\t\t// then delete the src from the original asset.\n\t\t\t\tassetsToUpdate.push(structuredClone(asset as TLImageAsset | TLVideoAsset))\n\t\t\t\tasset.props.src = null\n\t\t\t}\n\n\t\t\t// Add the asset to the list of assets to create\n\t\t\tassetsToCreate.push(asset)\n\t\t}\n\n\t\t// Start loading the new assets, order does not matter\n\t\tPromise.allSettled(\n\t\t\t(assetsToUpdate as (TLImageAsset | TLVideoAsset)[]).map(async (asset) => {\n\t\t\t\t// Turn the data url into a file\n\t\t\t\tconst file = await dataUrlToFile(\n\t\t\t\t\tasset.props.src!,\n\t\t\t\t\tasset.props.name,\n\t\t\t\t\tasset.props.mimeType ?? 'image/png'\n\t\t\t\t)\n\n\t\t\t\t// Get a new asset for the file\n\t\t\t\tconst newAsset = await this.getAssetForExternalContent({ type: 'file', file })\n\n\t\t\t\tif (!newAsset) {\n\t\t\t\t\t// If we don't have a new asset, delete the old asset.\n\t\t\t\t\t// The shapes that reference this asset should break.\n\t\t\t\t\tthis.deleteAssets([asset.id])\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// Save the new asset under the old asset's id\n\t\t\t\tthis.updateAssets([{ ...newAsset, id: asset.id }])\n\t\t\t})\n\t\t)\n\n\t\tthis.batch(() => {\n\t\t\t// Create any assets that need to be created\n\t\t\tif (assetsToCreate.length > 0) {\n\t\t\t\tthis.createAssets(assetsToCreate)\n\t\t\t}\n\n\t\t\t// Create the shapes with root shapes as children of the page\n\t\t\tthis.createShapes(newShapes)\n\n\t\t\tif (select) {\n\t\t\t\tthis.select(...rootShapes.map((s) => s.id))\n\t\t\t}\n\n\t\t\t// And then, if needed, reparent the root shapes to the paste parent\n\t\t\tif (pasteParentId !== currentPageId) {\n\t\t\t\tthis.reparentShapes(\n\t\t\t\t\trootShapes.map((s) => s.id),\n\t\t\t\t\tpasteParentId\n\t\t\t\t)\n\t\t\t}\n\n\t\t\tconst newCreatedShapes = newShapes.map((s) => this.getShape(s.id)!)\n\t\t\tconst bounds = Box.Common(newCreatedShapes.map((s) => this.getShapePageBounds(s)!))\n\n\t\t\tif (point === undefined) {\n\t\t\t\tif (!isPageId(pasteParentId)) {\n\t\t\t\t\t// Put the shapes in the middle of the (on screen) parent\n\t\t\t\t\tconst shape = this.getShape(pasteParentId)!\n\t\t\t\t\tpoint = Mat.applyToPoint(\n\t\t\t\t\t\tthis.getShapePageTransform(shape),\n\t\t\t\t\t\tthis.getShapeGeometry(shape).bounds.center\n\t\t\t\t\t)\n\t\t\t\t} else {\n\t\t\t\t\tconst viewportPageBounds = this.getViewportPageBounds()\n\t\t\t\t\tif (preservePosition || viewportPageBounds.includes(Box.From(bounds))) {\n\t\t\t\t\t\t// Otherwise, put shapes where they used to be\n\t\t\t\t\t\tpoint = bounds.center\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If the old bounds are outside of the viewport...\n\t\t\t\t\t\t// put the shapes in the middle of the viewport\n\t\t\t\t\t\tpoint = viewportPageBounds.center\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (rootShapes.length === 1) {\n\t\t\t\tconst onlyRoot = rootShapes[0] as TLFrameShape\n\t\t\t\t// If the old bounds are in the viewport...\n\t\t\t\tif (this.isShapeOfType<TLFrameShape>(onlyRoot, 'frame')) {\n\t\t\t\t\twhile (\n\t\t\t\t\t\tthis.getShapesAtPoint(point).some(\n\t\t\t\t\t\t\t(shape) =>\n\t\t\t\t\t\t\t\tthis.isShapeOfType<TLFrameShape>(shape, 'frame') &&\n\t\t\t\t\t\t\t\tshape.props.w === onlyRoot.props.w &&\n\t\t\t\t\t\t\t\tshape.props.h === onlyRoot.props.h\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tpoint.x += bounds.w + 16\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst pageCenter = Box.Common(\n\t\t\t\tcompact(rootShapes.map(({ id }) => this.getShapePageBounds(id)))\n\t\t\t).center\n\n\t\t\tconst offset = Vec.Sub(point, pageCenter)\n\n\t\t\tthis.updateShapes(\n\t\t\t\trootShapes.map(({ id }) => {\n\t\t\t\t\tconst s = this.getShape(id)!\n\t\t\t\t\tconst localRotation = this.getShapeParentTransform(id).decompose().rotation\n\t\t\t\t\tconst localDelta = Vec.Rot(offset, -localRotation)\n\n\t\t\t\t\treturn { id: s.id, type: s.type, x: s.x + localDelta.x, y: s.y + localDelta.y }\n\t\t\t\t})\n\t\t\t)\n\t\t})\n\n\t\treturn this\n\t}\n\n\t/**\n\t * Get an exported SVG element of the given shapes.\n\t *\n\t * @param ids - The shapes (or shape ids) to export.\n\t * @param opts - Options for the export.\n\t *\n\t * @returns The SVG element.\n\t *\n\t * @public\n\t */\n\tasync getSvgElement(shapes: TLShapeId[] | TLShape[], opts = {} as Partial<TLSvgOptions>) {\n\t\tconst result = await getSvgJsx(this, shapes, opts)\n\t\tif (!result) return undefined\n\n\t\tconst fragment = document.createDocumentFragment()\n\t\tconst root = createRoot(fragment)\n\t\tflushSync(() => {\n\t\t\troot.render(result.jsx)\n\t\t})\n\n\t\tconst svg = fragment.firstElementChild\n\t\tassert(svg instanceof SVGSVGElement, 'Expected an SVG element')\n\n\t\troot.unmount()\n\t\treturn { svg, width: result.width, height: result.height }\n\t}\n\n\t/**\n\t * Get an exported SVG string of the given shapes.\n\t *\n\t * @param ids - The shapes (or shape ids) to export.\n\t * @param opts - Options for the export.\n\t *\n\t * @returns The SVG element.\n\t *\n\t * @public\n\t */\n\tasync getSvgString(shapes: TLShapeId[] | TLShape[], opts = {} as Partial<TLSvgOptions>) {\n\t\tconst result = await this.getSvgElement(shapes, opts)\n\t\tif (!result) return undefined\n\n\t\tconst serializer = new XMLSerializer()\n\t\treturn {\n\t\t\tsvg: serializer.serializeToString(result.svg),\n\t\t\twidth: result.width,\n\t\t\theight: result.height,\n\t\t}\n\t}\n\n\t/** @deprecated Use {@link Editor.getSvgString} or {@link Editor.getSvgElement} instead. */\n\tasync getSvg(shapes: TLShapeId[] | TLShape[], opts = {} as Partial<TLSvgOptions>) {\n\t\tconst result = await this.getSvgElement(shapes, opts)\n\t\tif (!result) return undefined\n\t\treturn result.svg\n\t}\n\n\t/* --------------------- Events --------------------- */\n\n\t/**\n\t * The app's current input state.\n\t *\n\t * @public\n\t */\n\tinputs = {\n\t\t/** The most recent pointer down's position in the current page space. */\n\t\toriginPagePoint: new Vec(),\n\t\t/** The most recent pointer down's position in screen space. */\n\t\toriginScreenPoint: new Vec(),\n\t\t/** The previous pointer position in the current page space. */\n\t\tpreviousPagePoint: new Vec(),\n\t\t/** The previous pointer position in screen space. */\n\t\tpreviousScreenPoint: new Vec(),\n\t\t/** The most recent pointer position in the current page space. */\n\t\tcurrentPagePoint: new Vec(),\n\t\t/** The most recent pointer position in screen space. */\n\t\tcurrentScreenPoint: new Vec(),\n\t\t/** A set containing the currently pressed keys. */\n\t\tkeys: new Set<string>(),\n\t\t/** A set containing the currently pressed buttons. */\n\t\tbuttons: new Set<number>(),\n\t\t/** Whether the input is from a pe. */\n\t\tisPen: false,\n\t\t/** Whether the shift key is currently pressed. */\n\t\tshiftKey: false,\n\t\t/** Whether the control or command key is currently pressed. */\n\t\tctrlKey: false,\n\t\t/** Whether the alt or option key is currently pressed. */\n\t\taltKey: false,\n\t\t/** Whether the user is dragging. */\n\t\tisDragging: false,\n\t\t/** Whether the user is pointing. */\n\t\tisPointing: false,\n\t\t/** Whether the user is pinching. */\n\t\tisPinching: false,\n\t\t/** Whether the user is editing. */\n\t\tisEditing: false,\n\t\t/** Whether the user is panning. */\n\t\tisPanning: false,\n\t\t/** Velocity of mouse pointer, in pixels per millisecond */\n\t\tpointerVelocity: new Vec(),\n\t}\n\n\t/**\n\t * Update the input points from a pointer, pinch, or wheel event.\n\t *\n\t * @param info - The event info.\n\t */\n\tprivate _updateInputsFromEvent(\n\t\tinfo: TLPointerEventInfo | TLPinchEventInfo | TLWheelEventInfo\n\t): void {\n\t\tconst {\n\t\t\tpointerVelocity,\n\t\t\tpreviousScreenPoint,\n\t\t\tpreviousPagePoint,\n\t\t\tcurrentScreenPoint,\n\t\t\tcurrentPagePoint,\n\t\t} = this.inputs\n\n\t\tconst { screenBounds } = this.store.unsafeGetWithoutCapture(TLINSTANCE_ID)!\n\t\tconst { x: cx, y: cy, z: cz } = this.store.unsafeGetWithoutCapture(this.getCameraId())!\n\n\t\tconst sx = info.point.x - screenBounds.x\n\t\tconst sy = info.point.y - screenBounds.y\n\t\tconst sz = info.point.z ?? 0.5\n\n\t\tpreviousScreenPoint.setTo(currentScreenPoint)\n\t\tpreviousPagePoint.setTo(currentPagePoint)\n\n\t\t// The \"screen bounds\" is relative to the user's actual screen.\n\t\t// The \"screen point\" is relative to the \"screen bounds\";\n\t\t// it will be 0,0 when its actual screen position is equal\n\t\t// to screenBounds.point. This is confusing!\n\t\tcurrentScreenPoint.set(sx, sy)\n\t\tconst nx = sx / cz - cx\n\t\tconst ny = sy / cz - cy\n\t\tif (isFinite(nx) && isFinite(ny)) {\n\t\t\tcurrentPagePoint.set(nx, ny, sz)\n\t\t}\n\n\t\tthis.inputs.isPen = info.type === 'pointer' && info.isPen\n\n\t\t// Reset velocity on pointer down, or when a pinch starts or ends\n\t\tif (info.name === 'pointer_down' || this.inputs.isPinching) {\n\t\t\tpointerVelocity.set(0, 0)\n\t\t}\n\n\t\t// todo: We only have to do this if there are multiple users in the document\n\t\tthis.store.put([\n\t\t\t{\n\t\t\t\tid: TLPOINTER_ID,\n\t\t\t\ttypeName: 'pointer',\n\t\t\t\tx: currentPagePoint.x,\n\t\t\t\ty: currentPagePoint.y,\n\t\t\t\tlastActivityTimestamp:\n\t\t\t\t\t// If our pointer moved only because we're following some other user, then don't\n\t\t\t\t\t// update our last activity timestamp; otherwise, update it to the current timestamp.\n\t\t\t\t\tinfo.type === 'pointer' && info.pointerId === INTERNAL_POINTER_IDS.CAMERA_MOVE\n\t\t\t\t\t\t? this.store.unsafeGetWithoutCapture(TLPOINTER_ID)?.lastActivityTimestamp ??\n\t\t\t\t\t\t\tthis._tickManager.now\n\t\t\t\t\t\t: this._tickManager.now,\n\t\t\t\tmeta: {},\n\t\t\t},\n\t\t])\n\t}\n\n\t/**\n\t * Dispatch a cancel event.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.cancel()\n\t * ```\n\t *\n\t * @public\n\t */\n\tcancel(): this {\n\t\tthis.dispatch({ type: 'misc', name: 'cancel' })\n\t\treturn this\n\t}\n\n\t/**\n\t * Dispatch an interrupt event.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.interrupt()\n\t * ```\n\t *\n\t * @public\n\t */\n\tinterrupt(): this {\n\t\tthis.dispatch({ type: 'misc', name: 'interrupt' })\n\t\treturn this\n\t}\n\n\t/**\n\t * Dispatch a complete event.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.complete()\n\t * ```\n\t *\n\t * @public\n\t */\n\tcomplete(): this {\n\t\tthis.dispatch({ type: 'misc', name: 'complete' })\n\t\treturn this\n\t}\n\n\t/**\n\t * A manager for recording multiple click events.\n\t *\n\t * @internal\n\t */\n\tprotected _clickManager = new ClickManager(this)\n\n\t/**\n\t * Prevent a double click event from firing the next time the user clicks\n\t *\n\t * @public\n\t */\n\tcancelDoubleClick() {\n\t\tthis._clickManager.cancelDoubleClickTimeout()\n\t}\n\n\t/**\n\t * The previous cursor. Used for restoring the cursor after pan events.\n\t *\n\t * @internal\n\t */\n\tprivate _prevCursor: TLCursorType = 'default'\n\n\t/** @internal */\n\tprivate _shiftKeyTimeout = -1 as any\n\n\t/** @internal */\n\tprivate _setShiftKeyTimeout = () => {\n\t\tthis.inputs.shiftKey = false\n\t\tthis.dispatch({\n\t\t\ttype: 'keyboard',\n\t\t\tname: 'key_up',\n\t\t\tkey: 'Shift',\n\t\t\tshiftKey: this.inputs.shiftKey,\n\t\t\tctrlKey: this.inputs.ctrlKey,\n\t\t\taltKey: this.inputs.altKey,\n\t\t\tcode: 'ShiftLeft',\n\t\t})\n\t}\n\n\t/** @internal */\n\tprivate _altKeyTimeout = -1 as any\n\n\t/** @internal */\n\tprivate _setAltKeyTimeout = () => {\n\t\tthis.inputs.altKey = false\n\t\tthis.dispatch({\n\t\t\ttype: 'keyboard',\n\t\t\tname: 'key_up',\n\t\t\tkey: 'Alt',\n\t\t\tshiftKey: this.inputs.shiftKey,\n\t\t\tctrlKey: this.inputs.ctrlKey,\n\t\t\taltKey: this.inputs.altKey,\n\t\t\tcode: 'AltLeft',\n\t\t})\n\t}\n\n\t/** @internal */\n\tprivate _ctrlKeyTimeout = -1 as any\n\n\t/** @internal */\n\tprivate _setCtrlKeyTimeout = () => {\n\t\tthis.inputs.ctrlKey = false\n\t\tthis.dispatch({\n\t\t\ttype: 'keyboard',\n\t\t\tname: 'key_up',\n\t\t\tkey: 'Ctrl',\n\t\t\tshiftKey: this.inputs.shiftKey,\n\t\t\tctrlKey: this.inputs.ctrlKey,\n\t\t\taltKey: this.inputs.altKey,\n\t\t\tcode: 'ControlLeft',\n\t\t})\n\t}\n\n\t/** @internal */\n\tprivate _restoreToolId = 'select'\n\n\t/** @internal */\n\tprivate _pinchStart = 1\n\n\t/** @internal */\n\tprivate _didPinch = false\n\n\t/** @internal */\n\tprivate _selectedShapeIdsAtPointerDown: TLShapeId[] = []\n\n\t/** @internal */\n\tprivate _longPressTimeout = -1 as any\n\n\t/** @internal */\n\tcapturedPointerId: number | null = null\n\n\t/**\n\t * Dispatch an event to the editor.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.dispatch(myPointerEvent)\n\t * ```\n\t *\n\t * @param info - The event info.\n\t *\n\t * @public\n\t */\n\tdispatch = (info: TLEventInfo): this => {\n\t\tthis._pendingEventsForNextTick.push(info)\n\t\tif (\n\t\t\t!(\n\t\t\t\t(info.type === 'pointer' && info.name === 'pointer_move') ||\n\t\t\t\tinfo.type === 'wheel' ||\n\t\t\t\tinfo.type === 'pinch'\n\t\t\t)\n\t\t) {\n\t\t\tthis._flushEventsForTick(0)\n\t\t}\n\t\treturn this\n\t}\n\n\tprivate _pendingEventsForNextTick: TLEventInfo[] = []\n\n\tprivate _flushEventsForTick(elapsed: number) {\n\t\tthis.batch(() => {\n\t\t\tif (this._pendingEventsForNextTick.length > 0) {\n\t\t\t\tconst events = [...this._pendingEventsForNextTick]\n\t\t\t\tthis._pendingEventsForNextTick.length = 0\n\t\t\t\tfor (const info of events) {\n\t\t\t\t\tthis._flushEventForTick(info)\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (elapsed > 0) {\n\t\t\t\tthis.root.handleEvent({ type: 'misc', name: 'tick', elapsed })\n\t\t\t}\n\t\t\tthis.scribbles.tick(elapsed)\n\t\t})\n\t}\n\n\tprivate _flushEventForTick = (info: TLEventInfo) => {\n\t\t// prevent us from spamming similar event errors if we're crashed.\n\t\t// todo: replace with new readonly mode?\n\t\tif (this.getCrashingError()) return this\n\n\t\tconst { inputs } = this\n\t\tconst { type } = info\n\n\t\tif (info.type === 'misc') {\n\t\t\t// stop panning if the interaction is cancelled or completed\n\t\t\tif (info.name === 'cancel' || info.name === 'complete') {\n\t\t\t\tthis.inputs.isDragging = false\n\n\t\t\t\tif (this.inputs.isPanning) {\n\t\t\t\t\tthis.inputs.isPanning = false\n\t\t\t\t\tthis.updateInstanceState({\n\t\t\t\t\t\tcursor: {\n\t\t\t\t\t\t\ttype: this._prevCursor,\n\t\t\t\t\t\t\trotation: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.root.handleEvent(info)\n\t\t\treturn\n\t\t}\n\n\t\tif (info.shiftKey) {\n\t\t\tclearInterval(this._shiftKeyTimeout)\n\t\t\tthis._shiftKeyTimeout = -1\n\t\t\tinputs.shiftKey = true\n\t\t} else if (!info.shiftKey && inputs.shiftKey && this._shiftKeyTimeout === -1) {\n\t\t\tthis._shiftKeyTimeout = setTimeout(this._setShiftKeyTimeout, 150)\n\t\t}\n\n\t\tif (info.altKey) {\n\t\t\tclearInterval(this._altKeyTimeout)\n\t\t\tthis._altKeyTimeout = -1\n\t\t\tinputs.altKey = true\n\t\t} else if (!info.altKey && inputs.altKey && this._altKeyTimeout === -1) {\n\t\t\tthis._altKeyTimeout = setTimeout(this._setAltKeyTimeout, 150)\n\t\t}\n\n\t\tif (info.ctrlKey) {\n\t\t\tclearInterval(this._ctrlKeyTimeout)\n\t\t\tthis._ctrlKeyTimeout = -1\n\t\t\tinputs.ctrlKey = true /** @internal */ /** @internal */ /** @internal */\n\t\t} else if (!info.ctrlKey && inputs.ctrlKey && this._ctrlKeyTimeout === -1) {\n\t\t\tthis._ctrlKeyTimeout = setTimeout(this._setCtrlKeyTimeout, 150)\n\t\t}\n\n\t\tconst { originPagePoint, originScreenPoint, currentPagePoint, currentScreenPoint } = inputs\n\n\t\tif (!inputs.isPointing) {\n\t\t\tinputs.isDragging = false\n\t\t}\n\n\t\tswitch (type) {\n\t\t\tcase 'pinch': {\n\t\t\t\tif (!this.getInstanceState().canMoveCamera) return\n\t\t\t\tclearTimeout(this._longPressTimeout)\n\t\t\t\tthis._updateInputsFromEvent(info)\n\n\t\t\t\tswitch (info.name) {\n\t\t\t\t\tcase 'pinch_start': {\n\t\t\t\t\t\tif (inputs.isPinching) return\n\n\t\t\t\t\t\tif (!inputs.isEditing) {\n\t\t\t\t\t\t\tthis._pinchStart = this.getCamera().z\n\t\t\t\t\t\t\tif (!this._selectedShapeIdsAtPointerDown.length) {\n\t\t\t\t\t\t\t\tthis._selectedShapeIdsAtPointerDown = this.getSelectedShapeIds()\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis._didPinch = true\n\n\t\t\t\t\t\t\tinputs.isPinching = true\n\n\t\t\t\t\t\t\tthis.interrupt()\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn // Stop here!\n\t\t\t\t\t}\n\t\t\t\t\tcase 'pinch': {\n\t\t\t\t\t\tif (!inputs.isPinching) return\n\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tpoint: { z = 1 },\n\t\t\t\t\t\t\tdelta: { x: dx, y: dy },\n\t\t\t\t\t\t} = info\n\n\t\t\t\t\t\tconst { screenBounds } = this.store.unsafeGetWithoutCapture(TLINSTANCE_ID)!\n\t\t\t\t\t\tconst { x, y } = Vec.SubXY(info.point, screenBounds.x, screenBounds.y)\n\n\t\t\t\t\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\n\t\t\t\t\t\tconst zoom = Math.min(MAX_ZOOM, Math.max(MIN_ZOOM, z))\n\n\t\t\t\t\t\tthis.stopCameraAnimation()\n\t\t\t\t\t\tif (this.getInstanceState().followingUserId) {\n\t\t\t\t\t\t\tthis.stopFollowingUser()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._setCamera(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tx: cx + dx / cz - x / cz + x / zoom,\n\t\t\t\t\t\t\t\ty: cy + dy / cz - y / cz + y / zoom,\n\t\t\t\t\t\t\t\tz: zoom,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t)\n\n\t\t\t\t\t\treturn // Stop here!\n\t\t\t\t\t}\n\t\t\t\t\tcase 'pinch_end': {\n\t\t\t\t\t\tif (!inputs.isPinching) return this\n\n\t\t\t\t\t\tinputs.isPinching = false\n\t\t\t\t\t\tconst { _selectedShapeIdsAtPointerDown } = this\n\t\t\t\t\t\tthis.setSelectedShapes(this._selectedShapeIdsAtPointerDown, { squashing: true })\n\t\t\t\t\t\tthis._selectedShapeIdsAtPointerDown = []\n\n\t\t\t\t\t\tif (this._didPinch) {\n\t\t\t\t\t\t\tthis._didPinch = false\n\t\t\t\t\t\t\tthis.once('tick', () => {\n\t\t\t\t\t\t\t\tif (!this._didPinch) {\n\t\t\t\t\t\t\t\t\tthis.setSelectedShapes(_selectedShapeIdsAtPointerDown, { squashing: true })\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn // Stop here!\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase 'wheel': {\n\t\t\t\tif (!this.getInstanceState().canMoveCamera) return\n\n\t\t\t\tthis._updateInputsFromEvent(info)\n\n\t\t\t\tif (this.getIsMenuOpen()) {\n\t\t\t\t\t// noop\n\t\t\t\t} else {\n\t\t\t\t\tthis.stopCameraAnimation()\n\t\t\t\t\tif (this.getInstanceState().followingUserId) {\n\t\t\t\t\t\tthis.stopFollowingUser()\n\t\t\t\t\t}\n\t\t\t\t\tif (inputs.ctrlKey) {\n\t\t\t\t\t\t// todo: Start or update the zoom end interval\n\n\t\t\t\t\t\t// If the alt or ctrl keys are pressed,\n\t\t\t\t\t\t// zoom or pan the camera and then return.\n\n\t\t\t\t\t\t// Subtract the top left offset from the user's point\n\n\t\t\t\t\t\tconst { x, y } = this.inputs.currentScreenPoint\n\n\t\t\t\t\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\n\t\t\t\t\t\tconst zoom = Math.min(MAX_ZOOM, Math.max(MIN_ZOOM, cz + (info.delta.z ?? 0) * cz))\n\n\t\t\t\t\t\tthis._setCamera(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tx: cx + (x / zoom - x) - (x / cz - x),\n\t\t\t\t\t\t\t\ty: cy + (y / zoom - y) - (y / cz - y),\n\t\t\t\t\t\t\t\tz: zoom,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t)\n\n\t\t\t\t\t\t// We want to return here because none of the states in our\n\t\t\t\t\t\t// statechart should respond to this event (a camera zoom)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update the camera here, which will dispatch a pointer move...\n\t\t\t\t\t// this will also update the pointer position, etc\n\t\t\t\t\tconst { x: cx, y: cy, z: cz } = this.getCamera()\n\t\t\t\t\tthis._setCamera({ x: cx + info.delta.x / cz, y: cy + info.delta.y / cz, z: cz }, true)\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t!inputs.isDragging &&\n\t\t\t\t\t\tinputs.isPointing &&\n\t\t\t\t\t\tVec.Dist2(originPagePoint, currentPagePoint) >\n\t\t\t\t\t\t\t(this.getInstanceState().isCoarsePointer ? COARSE_DRAG_DISTANCE : DRAG_DISTANCE) /\n\t\t\t\t\t\t\t\tthis.getZoomLevel()\n\t\t\t\t\t) {\n\t\t\t\t\t\tclearTimeout(this._longPressTimeout)\n\t\t\t\t\t\tinputs.isDragging = true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'pointer': {\n\t\t\t\t// If we're pinching, return\n\t\t\t\tif (inputs.isPinching) return\n\n\t\t\t\tthis._updateInputsFromEvent(info)\n\n\t\t\t\tconst { isPen } = info\n\n\t\t\t\tswitch (info.name) {\n\t\t\t\t\tcase 'pointer_down': {\n\t\t\t\t\t\tthis.clearOpenMenus()\n\n\t\t\t\t\t\tthis._longPressTimeout = setTimeout(() => {\n\t\t\t\t\t\t\tthis.dispatch({ ...info, name: 'long_press' })\n\t\t\t\t\t\t}, LONG_PRESS_DURATION)\n\n\t\t\t\t\t\tthis._selectedShapeIdsAtPointerDown = this.getSelectedShapeIds()\n\n\t\t\t\t\t\t// Firefox bug fix...\n\t\t\t\t\t\t// If it's a left-mouse-click, we store the pointer id for later user\n\t\t\t\t\t\tif (info.button === 0) {\n\t\t\t\t\t\t\tthis.capturedPointerId = info.pointerId\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Add the button from the buttons set\n\t\t\t\t\t\tinputs.buttons.add(info.button)\n\n\t\t\t\t\t\tinputs.isPointing = true\n\t\t\t\t\t\tinputs.isDragging = false\n\n\t\t\t\t\t\tif (this.getInstanceState().isPenMode) {\n\t\t\t\t\t\t\tif (!isPen) {\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (isPen) {\n\t\t\t\t\t\t\t\tthis.updateInstanceState({ isPenMode: true })\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (info.button === 5) {\n\t\t\t\t\t\t\t// Eraser button activates eraser\n\t\t\t\t\t\t\tthis._restoreToolId = this.getCurrentToolId()\n\t\t\t\t\t\t\tthis.complete()\n\t\t\t\t\t\t\tthis.setCurrentTool('eraser')\n\t\t\t\t\t\t} else if (info.button === 1) {\n\t\t\t\t\t\t\t// Middle mouse pan activates panning\n\t\t\t\t\t\t\tif (!this.inputs.isPanning) {\n\t\t\t\t\t\t\t\tthis._prevCursor = this.getInstanceState().cursor.type\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.inputs.isPanning = true\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.inputs.isPanning) {\n\t\t\t\t\t\t\tthis.stopCameraAnimation()\n\t\t\t\t\t\t\tthis.setCursor({ type: 'grabbing', rotation: 0 })\n\t\t\t\t\t\t\treturn this\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toriginScreenPoint.setTo(currentScreenPoint)\n\t\t\t\t\t\toriginPagePoint.setTo(currentPagePoint)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'pointer_move': {\n\t\t\t\t\t\t// If the user is in pen mode, but the pointer is not a pen, stop here.\n\t\t\t\t\t\tif (!isPen && this.getInstanceState().isPenMode) {\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.inputs.isPanning && this.inputs.isPointing) {\n\t\t\t\t\t\t\tclearTimeout(this._longPressTimeout)\n\t\t\t\t\t\t\t// Handle panning\n\t\t\t\t\t\t\tconst { currentScreenPoint, previousScreenPoint } = this.inputs\n\t\t\t\t\t\t\tthis.pan(Vec.Sub(currentScreenPoint, previousScreenPoint))\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!inputs.isDragging &&\n\t\t\t\t\t\t\tinputs.isPointing &&\n\t\t\t\t\t\t\tVec.Dist2(originPagePoint, currentPagePoint) >\n\t\t\t\t\t\t\t\t(this.getInstanceState().isCoarsePointer ? COARSE_DRAG_DISTANCE : DRAG_DISTANCE) /\n\t\t\t\t\t\t\t\t\tthis.getZoomLevel()\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tclearTimeout(this._longPressTimeout)\n\t\t\t\t\t\t\tinputs.isDragging = true\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'pointer_up': {\n\t\t\t\t\t\t// Remove the button from the buttons set\n\t\t\t\t\t\tinputs.buttons.delete(info.button)\n\n\t\t\t\t\t\tinputs.isPointing = false\n\t\t\t\t\t\tinputs.isDragging = false\n\n\t\t\t\t\t\tif (this.getIsMenuOpen()) {\n\t\t\t\t\t\t\t// Suppressing pointerup here as <ContextMenu/> doesn't seem to do what we what here.\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!isPen && this.getInstanceState().isPenMode) {\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Firefox bug fix...\n\t\t\t\t\t\t// If it's the same pointer that we stored earlier...\n\t\t\t\t\t\t// ... then it's probably still a left-mouse-click!\n\t\t\t\t\t\tif (this.capturedPointerId === info.pointerId) {\n\t\t\t\t\t\t\tthis.capturedPointerId = null\n\t\t\t\t\t\t\tinfo.button = 0\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (inputs.isPanning) {\n\t\t\t\t\t\t\tif (info.button === 1) {\n\t\t\t\t\t\t\t\tif (!this.inputs.keys.has(' ')) {\n\t\t\t\t\t\t\t\t\tinputs.isPanning = false\n\n\t\t\t\t\t\t\t\t\tthis.slideCamera({\n\t\t\t\t\t\t\t\t\t\tspeed: Math.min(2, this.inputs.pointerVelocity.len()),\n\t\t\t\t\t\t\t\t\t\tdirection: this.inputs.pointerVelocity,\n\t\t\t\t\t\t\t\t\t\tfriction: CAMERA_SLIDE_FRICTION,\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\tthis.setCursor({ type: this._prevCursor, rotation: 0 })\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.slideCamera({\n\t\t\t\t\t\t\t\t\t\tspeed: Math.min(2, this.inputs.pointerVelocity.len()),\n\t\t\t\t\t\t\t\t\t\tdirection: this.inputs.pointerVelocity,\n\t\t\t\t\t\t\t\t\t\tfriction: CAMERA_SLIDE_FRICTION,\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\tthis.setCursor({\n\t\t\t\t\t\t\t\t\t\ttype: 'grab',\n\t\t\t\t\t\t\t\t\t\trotation: 0,\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (info.button === 0) {\n\t\t\t\t\t\t\t\tthis.slideCamera({\n\t\t\t\t\t\t\t\t\tspeed: Math.min(2, this.inputs.pointerVelocity.len()),\n\t\t\t\t\t\t\t\t\tdirection: this.inputs.pointerVelocity,\n\t\t\t\t\t\t\t\t\tfriction: CAMERA_SLIDE_FRICTION,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tthis.setCursor({\n\t\t\t\t\t\t\t\t\ttype: 'grab',\n\t\t\t\t\t\t\t\t\trotation: 0,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (info.button === 5) {\n\t\t\t\t\t\t\t\t// Eraser button activates eraser\n\t\t\t\t\t\t\t\tthis.complete()\n\t\t\t\t\t\t\t\tthis.setCurrentTool(this._restoreToolId)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'keyboard': {\n\t\t\t\t// please, please\n\t\t\t\tif (info.key === 'ShiftRight') info.key = 'ShiftLeft'\n\t\t\t\tif (info.key === 'AltRight') info.key = 'AltLeft'\n\t\t\t\tif (info.code === 'ControlRight') info.code = 'ControlLeft'\n\n\t\t\t\tswitch (info.name) {\n\t\t\t\t\tcase 'key_down': {\n\t\t\t\t\t\t// Add the key from the keys set\n\t\t\t\t\t\tinputs.keys.add(info.code)\n\n\t\t\t\t\t\t// If the space key is pressed (but meta / control isn't!) activate panning\n\t\t\t\t\t\tif (!info.ctrlKey && info.code === 'Space') {\n\t\t\t\t\t\t\tif (!this.inputs.isPanning) {\n\t\t\t\t\t\t\t\tthis._prevCursor = this.getInstanceState().cursor.type\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.inputs.isPanning = true\n\t\t\t\t\t\t\tthis.setCursor({ type: this.inputs.isPointing ? 'grabbing' : 'grab', rotation: 0 })\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'key_up': {\n\t\t\t\t\t\t// Remove the key from the keys set\n\t\t\t\t\t\tinputs.keys.delete(info.code)\n\n\t\t\t\t\t\tif (info.code === 'Space' && !this.inputs.buttons.has(1)) {\n\t\t\t\t\t\t\tthis.inputs.isPanning = false\n\t\t\t\t\t\t\tthis.setCursor({ type: this._prevCursor, rotation: 0 })\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'key_repeat': {\n\t\t\t\t\t\t// noop\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\t// Correct the info name for right / middle clicks\n\t\tif (info.type === 'pointer') {\n\t\t\tif (info.button === 1) {\n\t\t\t\tinfo.name = 'middle_click'\n\t\t\t} else if (info.button === 2) {\n\t\t\t\tinfo.name = 'right_click'\n\t\t\t}\n\n\t\t\t// If a pointer event, send the event to the click manager.\n\t\t\tif (info.isPen === this.getInstanceState().isPenMode) {\n\t\t\t\tswitch (info.name) {\n\t\t\t\t\tcase 'pointer_down': {\n\t\t\t\t\t\tconst otherEvent = this._clickManager.transformPointerDownEvent(info)\n\t\t\t\t\t\tif (info.name !== otherEvent.name) {\n\t\t\t\t\t\t\tthis.root.handleEvent(info)\n\t\t\t\t\t\t\tthis.emit('event', info)\n\t\t\t\t\t\t\tthis.root.handleEvent(otherEvent)\n\t\t\t\t\t\t\tthis.emit('event', otherEvent)\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'pointer_up': {\n\t\t\t\t\t\tclearTimeout(this._longPressTimeout)\n\n\t\t\t\t\t\tconst otherEvent = this._clickManager.transformPointerUpEvent(info)\n\t\t\t\t\t\tif (info.name !== otherEvent.name) {\n\t\t\t\t\t\t\tthis.root.handleEvent(info)\n\t\t\t\t\t\t\tthis.emit('event', info)\n\t\t\t\t\t\t\tthis.root.handleEvent(otherEvent)\n\t\t\t\t\t\t\tthis.emit('event', otherEvent)\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'pointer_move': {\n\t\t\t\t\t\tthis._clickManager.handleMove()\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Send the event to the statechart. It will be handled by all\n\t\t// active states, starting at the root.\n\t\tthis.root.handleEvent(info)\n\t\tthis.emit('event', info)\n\n\t\treturn this\n\t}\n}\n\nfunction alertMaxShapes(editor: Editor, pageId = editor.getCurrentPageId()) {\n\tconst name = editor.getPage(pageId)!.name\n\teditor.emit('max-shapes', { name, pageId, count: MAX_SHAPES_PER_PAGE })\n}\n\nfunction applyPartialToShape<T extends TLShape>(prev: T, partial?: TLShapePartial<T>): T {\n\tif (!partial) return prev\n\tlet next = null as null | T\n\tconst entries = Object.entries(partial)\n\tfor (let i = 0, n = entries.length; i < n; i++) {\n\t\tconst [k, v] = entries[i]\n\t\tif (v === undefined) continue\n\n\t\t// Is the key a special key? We don't update those\n\t\tif (k === 'id' || k === 'type' || k === 'typeName') continue\n\n\t\t// Is the value the same as it was before?\n\t\tif (v === (prev as any)[k]) continue\n\n\t\t// There's a new value, so create the new shape if we haven't already (should we be cloning this?)\n\t\tif (!next) next = { ...prev }\n\n\t\t// for props / meta properties, we support updates with partials of this object\n\t\tif (k === 'props' || k === 'meta') {\n\t\t\tnext[k] = { ...prev[k] } as JsonObject\n\t\t\tfor (const [nextKey, nextValue] of Object.entries(v as object)) {\n\t\t\t\tif (nextValue !== undefined) {\n\t\t\t\t\t;(next[k] as JsonObject)[nextKey] = nextValue\n\t\t\t\t}\n\t\t\t}\n\t\t\tcontinue\n\t\t}\n\n\t\t// base property\n\t\t;(next as any)[k] = v\n\t}\n\tif (!next) return prev\n\treturn next\n}\n\nfunction pushShapeWithDescendants(editor: Editor, id: TLShapeId, result: TLShape[]): void {\n\tconst shape = editor.getShape(id)\n\tif (!shape) return\n\tresult.push(shape)\n\tconst childIds = editor.getSortedChildIdsForParent(id)\n\tfor (let i = 0, n = childIds.length; i < n; i++) {\n\t\tpushShapeWithDescendants(editor, childIds[i], result)\n\t}\n}\n", "import { TLGroupShape, groupShapeMigrations, groupShapeProps } from '@tldraw/tlschema'\nimport { SVGContainer } from '../../../components/SVGContainer'\nimport { Geometry2d } from '../../../primitives/geometry/Geometry2d'\nimport { Group2d } from '../../../primitives/geometry/Group2d'\nimport { Polygon2d } from '../../../primitives/geometry/Polygon2d'\nimport { Polyline2d } from '../../../primitives/geometry/Polyline2d'\nimport { Rectangle2d } from '../../../primitives/geometry/Rectangle2d'\nimport { ShapeUtil, TLOnChildrenChangeHandler } from '../ShapeUtil'\nimport { DashedOutlineBox } from './DashedOutlineBox'\n\n/** @public */\nexport class GroupShapeUtil extends ShapeUtil<TLGroupShape> {\n\tstatic override type = 'group' as const\n\tstatic override props = groupShapeProps\n\tstatic override migrations = groupShapeMigrations\n\n\toverride hideSelectionBoundsFg = () => true\n\n\toverride canBind = () => false\n\n\tgetDefaultProps(): TLGroupShape['props'] {\n\t\treturn {}\n\t}\n\n\tgetGeometry(shape: TLGroupShape): Geometry2d {\n\t\tconst children = this.editor.getSortedChildIdsForParent(shape.id)\n\t\tif (children.length === 0) {\n\t\t\treturn new Rectangle2d({ width: 1, height: 1, isFilled: false })\n\t\t}\n\n\t\treturn new Group2d({\n\t\t\tchildren: children.map((childId) => {\n\t\t\t\tconst shape = this.editor.getShape(childId)!\n\t\t\t\tconst geometry = this.editor.getShapeGeometry(childId)\n\t\t\t\tconst points = this.editor.getShapeLocalTransform(shape)!.applyToPoints(geometry.vertices)\n\n\t\t\t\tif (geometry.isClosed) {\n\t\t\t\t\treturn new Polygon2d({\n\t\t\t\t\t\tpoints,\n\t\t\t\t\t\tisFilled: true,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\treturn new Polyline2d({\n\t\t\t\t\tpoints,\n\t\t\t\t})\n\t\t\t}),\n\t\t})\n\t}\n\n\tcomponent(shape: TLGroupShape) {\n\t\tconst isErasing = this.editor.getErasingShapeIds().includes(shape.id)\n\n\t\tconst { hintingShapeIds } = this.editor.getCurrentPageState()\n\t\tconst isHintingOtherGroup =\n\t\t\thintingShapeIds.length > 0 &&\n\t\t\thintingShapeIds.some(\n\t\t\t\t(id) =>\n\t\t\t\t\tid !== shape.id &&\n\t\t\t\t\tthis.editor.isShapeOfType<TLGroupShape>(this.editor.getShape(id)!, 'group')\n\t\t\t)\n\n\t\tconst isFocused = this.editor.getCurrentPageState().focusedGroupId !== shape.id\n\n\t\tif (\n\t\t\t!isErasing && // always show the outline while we're erasing the group\n\t\t\t// show the outline while the group is focused unless something outside of the group is being hinted\n\t\t\t// this happens dropping shapes from a group onto some outside group\n\t\t\t(isFocused || isHintingOtherGroup)\n\t\t) {\n\t\t\treturn null\n\t\t}\n\n\t\tconst bounds = this.editor.getShapeGeometry(shape).bounds\n\n\t\treturn (\n\t\t\t<SVGContainer id={shape.id}>\n\t\t\t\t<DashedOutlineBox className=\"tl-group\" bounds={bounds} />\n\t\t\t</SVGContainer>\n\t\t)\n\t}\n\n\tindicator(shape: TLGroupShape) {\n\t\t// Not a class component, but eslint can't tell that :(\n\t\tconst bounds = this.editor.getShapeGeometry(shape).bounds\n\t\treturn <DashedOutlineBox className=\"\" bounds={bounds} />\n\t}\n\n\toverride onChildrenChange: TLOnChildrenChangeHandler<TLGroupShape> = (group) => {\n\t\tconst children = this.editor.getSortedChildIdsForParent(group.id)\n\t\tif (children.length === 0) {\n\t\t\tif (this.editor.getCurrentPageState().focusedGroupId === group.id) {\n\t\t\t\tthis.editor.popFocusedGroupId()\n\t\t\t}\n\t\t\tthis.editor.deleteShapes([group.id])\n\t\t\treturn\n\t\t} else if (children.length === 1) {\n\t\t\tif (this.editor.getCurrentPageState().focusedGroupId === group.id) {\n\t\t\t\tthis.editor.popFocusedGroupId()\n\t\t\t}\n\t\t\tthis.editor.reparentShapes(children, group.parentId)\n\t\t\tthis.editor.deleteShapes([group.id])\n\t\t\treturn\n\t\t}\n\t}\n}\n", "import classNames from 'classnames'\nimport * as React from 'react'\n\n/** @public */\nexport type SVGContainerProps = React.HTMLAttributes<SVGElement>\n\n/** @public */\nexport function SVGContainer({ children, className = '', ...rest }: SVGContainerProps) {\n\treturn (\n\t\t<svg {...rest} className={classNames('tl-svg-container', className)}>\n\t\t\t{children}\n\t\t</svg>\n\t)\n}\n", "import { Box } from './Box'\nimport { pointInPolygon } from './utils'\nimport { Vec, VecLike } from './Vec'\n\n// need even more intersections? See https://gist.github.com/steveruizok/35c02d526c707003a5c79761bfb89a52\n\n/**\n * Find the intersection between a line segment and a line segment.\n *\n * @param a1 - The first segment's first point.\n * @param a2 - The first segment's second point.\n * @param b1 - The second segment's first point.\n * @param b2 - The second segment's second point.\n * @public\n */\nexport function intersectLineSegmentLineSegment(\n\ta1: VecLike,\n\ta2: VecLike,\n\tb1: VecLike,\n\tb2: VecLike\n) {\n\tconst ABx = a1.x - b1.x\n\tconst ABy = a1.y - b1.y\n\tconst BVx = b2.x - b1.x\n\tconst BVy = b2.y - b1.y\n\tconst AVx = a2.x - a1.x\n\tconst AVy = a2.y - a1.y\n\tconst ua_t = BVx * ABy - BVy * ABx\n\tconst ub_t = AVx * ABy - AVy * ABx\n\tconst u_b = BVy * AVx - BVx * AVy\n\n\tif (ua_t === 0 || ub_t === 0) return null // coincident\n\n\tif (u_b === 0) return null // parallel\n\n\tif (u_b !== 0) {\n\t\tconst ua = ua_t / u_b\n\t\tconst ub = ub_t / u_b\n\t\tif (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n\t\t\treturn Vec.AddXY(a1, ua * AVx, ua * AVy)\n\t\t}\n\t}\n\n\treturn null // no intersection\n}\n\n/**\n * Find the intersections between a line segment and a circle.\n *\n * @param a1 - The segment's first point.\n * @param a2 - The segment's second point.\n * @param c - The circle's center.\n * @param r - The circle's radius.\n * @public\n */\nexport function intersectLineSegmentCircle(a1: VecLike, a2: VecLike, c: VecLike, r: number) {\n\tconst a = (a2.x - a1.x) * (a2.x - a1.x) + (a2.y - a1.y) * (a2.y - a1.y)\n\tconst b = 2 * ((a2.x - a1.x) * (a1.x - c.x) + (a2.y - a1.y) * (a1.y - c.y))\n\tconst cc =\n\t\tc.x * c.x + c.y * c.y + a1.x * a1.x + a1.y * a1.y - 2 * (c.x * a1.x + c.y * a1.y) - r * r\n\tconst deter = b * b - 4 * a * cc\n\n\tif (deter < 0) return null // outside\n\tif (deter === 0) return null // tangent\n\n\tconst e = Math.sqrt(deter)\n\tconst u1 = (-b + e) / (2 * a)\n\tconst u2 = (-b - e) / (2 * a)\n\n\tif ((u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1)) {\n\t\treturn null // outside or inside\n\t\t// if ((u1 < 0 && u2 < 0) || (u1 > 1 && u2 > 1)) {\n\t\t// \treturn null // outside\n\t\t// } else return null // inside'\n\t}\n\n\tconst result: VecLike[] = []\n\n\tif (0 <= u1 && u1 <= 1) result.push(Vec.Lrp(a1, a2, u1))\n\tif (0 <= u2 && u2 <= 1) result.push(Vec.Lrp(a1, a2, u2))\n\n\tif (result.length === 0) return null // no intersection\n\n\treturn result\n}\n\n/**\n * Find the intersections between a line segment and a polyline.\n *\n * @param a1 - The segment's first point.\n * @param a2 - The segment's second point.\n * @param points - The points in the polyline.\n * @public\n */\nexport function intersectLineSegmentPolyline(a1: VecLike, a2: VecLike, points: VecLike[]) {\n\tconst result: VecLike[] = []\n\tlet segmentIntersection: VecLike | null\n\n\tfor (let i = 0, n = points.length - 1; i < n; i++) {\n\t\tsegmentIntersection = intersectLineSegmentLineSegment(a1, a2, points[i], points[i + 1])\n\t\tif (segmentIntersection) result.push(segmentIntersection)\n\t}\n\n\tif (result.length === 0) return null // no intersection\n\n\treturn result\n}\n\n/**\n * Find the intersections between a line segment and a closed polygon.\n *\n * @param a1 - The segment's first point.\n * @param a2 - The segment's second point.\n * @param points - The points in the polygon.\n * @public\n */\nexport function intersectLineSegmentPolygon(a1: VecLike, a2: VecLike, points: VecLike[]) {\n\tconst result: VecLike[] = []\n\tlet segmentIntersection: VecLike | null\n\n\tfor (let i = 1, n = points.length; i < n + 1; i++) {\n\t\tsegmentIntersection = intersectLineSegmentLineSegment(\n\t\t\ta1,\n\t\t\ta2,\n\t\t\tpoints[i - 1],\n\t\t\tpoints[i % points.length]\n\t\t)\n\t\tif (segmentIntersection) result.push(segmentIntersection)\n\t}\n\n\tif (result.length === 0) return null // no intersection\n\n\treturn result\n}\n\n/**\n * Find the intersections between a circle and a circle.\n *\n * @param c1 - The first circle's center.\n * @param r1 - The first circle's radius.\n * @param c2 - The second circle's center.\n * @param r2 - The second circle's radius.\n * @public\n */\nexport function intersectCircleCircle(c1: VecLike, r1: number, c2: VecLike, r2: number) {\n\tlet dx = c2.x - c1.x\n\tlet dy = c2.y - c1.y\n\tconst d = Math.sqrt(dx * dx + dy * dy),\n\t\tx = (d * d - r2 * r2 + r1 * r1) / (2 * d),\n\t\ty = Math.sqrt(r1 * r1 - x * x)\n\tdx /= d\n\tdy /= d\n\treturn [\n\t\tnew Vec(c1.x + dx * x - dy * y, c1.y + dy * x + dx * y),\n\t\tnew Vec(c1.x + dx * x + dy * y, c1.y + dy * x - dx * y),\n\t]\n}\n\n/**\n * Find the intersections between a circle and a bounding box.\n *\n * @param c - The circle's center.\n * @param r - The circle's radius.\n * @param points - The points in the polygon.\n * @public\n */\nexport function intersectCirclePolygon(c: VecLike, r: number, points: VecLike[]) {\n\tconst result: VecLike[] = []\n\tlet a: VecLike, b: VecLike, int: VecLike[] | null\n\n\tfor (let i = 0, n = points.length; i < n; i++) {\n\t\ta = points[i]\n\t\tb = points[(i + 1) % points.length]\n\t\tint = intersectLineSegmentCircle(a, b, c, r)\n\t\tif (int) result.push(...int)\n\t}\n\n\tif (result.length === 0) return null // no intersection\n\n\treturn result\n}\n\n/**\n * Find the intersections between a circle and a bounding box.\n *\n * @param c - The circle's center.\n * @param r - The circle's radius.\n * @param points - The points in the polyline.\n * @public\n */\nexport function intersectCirclePolyline(c: VecLike, r: number, points: VecLike[]) {\n\tconst result: VecLike[] = []\n\tlet a: VecLike, b: VecLike, int: VecLike[] | null\n\n\tfor (let i = 1, n = points.length; i < n; i++) {\n\t\ta = points[i - 1]\n\t\tb = points[i]\n\t\tint = intersectLineSegmentCircle(a, b, c, r)\n\t\tif (int) result.push(...int)\n\t}\n\n\tif (result.length === 0) return null // no intersection\n\n\treturn result\n}\n\n/**\n * Find the intersections between a polygon and a bounding box.\n *\n * @public\n */\nexport function intersectPolygonBounds(points: VecLike[], bounds: Box) {\n\tconst result: VecLike[] = []\n\tlet segmentIntersection: VecLike[] | null\n\n\tfor (const side of bounds.sides) {\n\t\tsegmentIntersection = intersectLineSegmentPolygon(side[0], side[1], points)\n\t\tif (segmentIntersection) result.push(...segmentIntersection)\n\t}\n\n\tif (result.length === 0) return null // no intersection\n\n\treturn result\n}\n\nfunction ccw(A: VecLike, B: VecLike, C: VecLike) {\n\treturn (C.y - A.y) * (B.x - A.x) > (B.y - A.y) * (C.x - A.x)\n}\n\n/** @public */\nexport function linesIntersect(A: VecLike, B: VecLike, C: VecLike, D: VecLike) {\n\treturn ccw(A, C, D) !== ccw(B, C, D) && ccw(A, B, C) !== ccw(A, B, D)\n}\n\n/**\n * Create a new convex polygon as the intersection of two convex polygons.\n *\n * @param polygonA - An array of points representing the first polygon.\n * @param polygonB - An array of points representing the second polygon.\n * @public\n */\nexport function intersectPolygonPolygon(\n\tpolygonA: VecLike[],\n\tpolygonB: VecLike[]\n): VecLike[] | null {\n\t// Create an empty polygon as result\n\tconst result: Map<string, VecLike> = new Map()\n\tlet a: VecLike, b: VecLike, c: VecLike, d: VecLike\n\n\t// Add all corners of PolygonA that is inside PolygonB to result\n\tfor (let i = 0, n = polygonA.length; i < n; i++) {\n\t\ta = polygonA[i]\n\t\tif (pointInPolygon(a, polygonB)) {\n\t\t\tconst id = getPointId(a)\n\t\t\tif (!result.has(id)) {\n\t\t\t\tresult.set(id, a)\n\t\t\t}\n\t\t}\n\t}\n\t// Add all corners of PolygonB that is inside PolygonA to result\n\tfor (let i = 0, n = polygonB.length; i < n; i++) {\n\t\ta = polygonB[i]\n\t\tif (pointInPolygon(a, polygonA)) {\n\t\t\tconst id = getPointId(a)\n\t\t\tif (!result.has(id)) {\n\t\t\t\tresult.set(id, a)\n\t\t\t}\n\t\t}\n\t}\n\n\t// Add all intersection points to result\n\tfor (let i = 0, n = polygonA.length; i < n; i++) {\n\t\ta = polygonA[i]\n\t\tb = polygonA[(i + 1) % polygonA.length]\n\n\t\tfor (let j = 0, m = polygonB.length; j < m; j++) {\n\t\t\tc = polygonB[j]\n\t\t\td = polygonB[(j + 1) % polygonB.length]\n\t\t\tconst intersection = intersectLineSegmentLineSegment(a, b, c, d)\n\n\t\t\tif (intersection !== null) {\n\t\t\t\tconst id = getPointId(intersection)\n\t\t\t\tif (!result.has(id)) {\n\t\t\t\t\tresult.set(id, intersection)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (result.size === 0) return null // no intersection\n\n\t// Order all points in the result counter-clockwise.\n\treturn orderClockwise([...result.values()])\n}\n\nfunction getPointId(point: VecLike) {\n\treturn `${point.x},${point.y}`\n}\n\nfunction orderClockwise(points: VecLike[]): VecLike[] {\n\tconst C = Vec.Average(points)\n\treturn points.sort((A, B) => Vec.Angle(C, A) - Vec.Angle(C, B))\n}\n\n/** @public */\nexport function polygonsIntersect(a: VecLike[], b: VecLike[]) {\n\tlet a0: VecLike, a1: VecLike, b0: VecLike, b1: VecLike\n\tfor (let i = 0, n = a.length; i < n; i++) {\n\t\ta0 = a[i]\n\t\ta1 = a[(i + 1) % n]\n\t\tfor (let j = 0, m = b.length; j < m; j++) {\n\t\t\tb0 = b[j]\n\t\t\tb1 = b[(j + 1) % m]\n\t\t\tif (linesIntersect(a0, a1, b0, b1)) return true\n\t\t}\n\t}\n\treturn false\n}\n\n/** @public */\nexport function polygonIntersectsPolyline(polygon: VecLike[], polyline: VecLike[]) {\n\tlet a: VecLike, b: VecLike, c: VecLike, d: VecLike\n\tfor (let i = 0, n = polygon.length; i < n; i++) {\n\t\ta = polygon[i]\n\t\tb = polygon[(i + 1) % n]\n\n\t\tfor (let j = 1, m = polyline.length; j < m; j++) {\n\t\t\tc = polyline[j - 1]\n\t\t\td = polyline[j]\n\t\t\tif (linesIntersect(a, b, c, d)) return true\n\t\t}\n\t}\n\treturn false\n}\n", "import { Vec } from '../Vec'\nimport { linesIntersect } from '../intersect'\nimport { Geometry2d } from './Geometry2d'\n\n/** @public */\nexport class Edge2d extends Geometry2d {\n\tstart: Vec\n\tend: Vec\n\td: Vec\n\tu: Vec\n\tul: number\n\n\tconstructor(config: { start: Vec; end: Vec }) {\n\t\tsuper({ ...config, isClosed: false, isFilled: false })\n\t\tconst { start, end } = config\n\n\t\tthis.start = start\n\t\tthis.end = end\n\n\t\tthis.d = start.clone().sub(end) // the delta from start to end\n\t\tthis.u = this.d.clone().uni() // the unit vector of the edge\n\t\tthis.ul = this.u.len() // the length of the unit vector\n\t}\n\n\t_length?: number\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget length() {\n\t\tif (!this._length) {\n\t\t\treturn this.d.len()\n\t\t}\n\t\treturn this._length\n\t}\n\n\tmidPoint(): Vec {\n\t\treturn this.start.lrp(this.end, 0.5)\n\t}\n\n\toverride getVertices(): Vec[] {\n\t\treturn [this.start, this.end]\n\t}\n\n\toverride nearestPoint(point: Vec): Vec {\n\t\tconst { start, end, u, ul: l } = this\n\t\tif (l === 0) return start // no length in the unit vector\n\t\tconst k = Vec.Sub(point, start).dpr(u) / l\n\t\tconst cx = start.x + u.x * k\n\t\tif (cx < Math.min(start.x, end.x)) return start.x < end.x ? start : end\n\t\tif (cx > Math.max(start.x, end.x)) return start.x > end.x ? start : end\n\t\tconst cy = start.y + u.y * k\n\t\tif (cy < Math.min(start.y, end.y)) return start.y < end.y ? start : end\n\t\tif (cy > Math.max(start.y, end.y)) return start.y > end.y ? start : end\n\t\treturn new Vec(cx, cy)\n\t}\n\n\toverride hitTestLineSegment(A: Vec, B: Vec, distance = 0): boolean {\n\t\treturn (\n\t\t\tlinesIntersect(A, B, this.start, this.end) || this.distanceToLineSegment(A, B) <= distance\n\t\t)\n\t}\n}\n", "import { Vec } from '../Vec'\nimport { Edge2d } from './Edge2d'\nimport { Geometry2d, Geometry2dOptions } from './Geometry2d'\n\n/** @public */\nexport class Polyline2d extends Geometry2d {\n\tpoints: Vec[]\n\n\tconstructor(config: Omit<Geometry2dOptions, 'isFilled' | 'isClosed'> & { points: Vec[] }) {\n\t\tsuper({ isClosed: false, isFilled: false, ...config })\n\t\tconst { points } = config\n\t\tthis.points = points\n\t}\n\n\t_segments?: Edge2d[]\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget segments() {\n\t\tif (!this._segments) {\n\t\t\tthis._segments = []\n\t\t\tconst { vertices } = this\n\t\t\tfor (let i = 0, n = vertices.length - 1; i < n; i++) {\n\t\t\t\tconst start = vertices[i]\n\t\t\t\tconst end = vertices[i + 1]\n\t\t\t\tthis._segments.push(new Edge2d({ start, end }))\n\t\t\t}\n\n\t\t\tif (this.isClosed) {\n\t\t\t\tthis._segments.push(new Edge2d({ start: vertices[vertices.length - 1], end: vertices[0] }))\n\t\t\t}\n\t\t}\n\n\t\treturn this._segments\n\t}\n\n\t_length?: number\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget length() {\n\t\tif (!this._length) {\n\t\t\tthis._length = this.segments.reduce((acc, segment) => acc + segment.length, 0)\n\t\t}\n\t\treturn this._length\n\t}\n\n\tgetVertices() {\n\t\treturn this.points\n\t}\n\n\tnearestPoint(A: Vec): Vec {\n\t\tconst { segments } = this\n\t\tlet nearest = this.points[0]\n\t\tlet dist = Infinity\n\t\tlet p: Vec // current point on segment\n\t\tlet d: number // distance from A to p\n\t\tfor (let i = 0; i < segments.length; i++) {\n\t\t\tp = segments[i].nearestPoint(A)\n\t\t\td = Vec.Dist2(p, A)\n\t\t\tif (d < dist) {\n\t\t\t\tnearest = p\n\t\t\t\tdist = d\n\t\t\t}\n\t\t}\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn nearest\n\t}\n\n\thitTestLineSegment(A: Vec, B: Vec, distance = 0): boolean {\n\t\tconst { segments } = this\n\t\tfor (let i = 0, n = segments.length; i < n; i++) {\n\t\t\tif (segments[i].hitTestLineSegment(A, B, distance)) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t\treturn false\n\t}\n}\n", "import { Vec } from '../Vec'\nimport { Geometry2dOptions } from './Geometry2d'\nimport { Polyline2d } from './Polyline2d'\n\n/** @public */\nexport class Polygon2d extends Polyline2d {\n\tconstructor(config: Omit<Geometry2dOptions, 'isClosed'> & { points: Vec[] }) {\n\t\tsuper({ ...config })\n\t\tthis.isClosed = true\n\t}\n}\n", "import { Box } from '../Box'\nimport { Vec } from '../Vec'\nimport { Geometry2dOptions } from './Geometry2d'\nimport { Polygon2d } from './Polygon2d'\n\n/** @public */\nexport class Rectangle2d extends Polygon2d {\n\tx: number\n\ty: number\n\tw: number\n\th: number\n\n\tconstructor(\n\t\tconfig: Omit<Geometry2dOptions, 'isClosed'> & {\n\t\t\tx?: number\n\t\t\ty?: number\n\t\t\twidth: number\n\t\t\theight: number\n\t\t}\n\t) {\n\t\tconst { x = 0, y = 0, width, height } = config\n\t\tsuper({\n\t\t\t...config,\n\t\t\tpoints: [\n\t\t\t\tnew Vec(x, y),\n\t\t\t\tnew Vec(x + width, y),\n\t\t\t\tnew Vec(x + width, y + height),\n\t\t\t\tnew Vec(x, y + height),\n\t\t\t],\n\t\t})\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis.w = width\n\t\tthis.h = height\n\t}\n\n\tgetBounds() {\n\t\treturn new Box(this.x, this.y, this.w, this.h)\n\t}\n}\n", "/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { LegacyMigrations, MigrationSequence } from '@tldraw/store'\nimport {\n\tShapeProps,\n\tTLHandle,\n\tTLShape,\n\tTLShapePartial,\n\tTLShapePropsMigrations,\n\tTLUnknownShape,\n} from '@tldraw/tlschema'\nimport { ReactElement } from 'react'\nimport { Box } from '../../primitives/Box'\nimport { Vec } from '../../primitives/Vec'\nimport { Geometry2d } from '../../primitives/geometry/Geometry2d'\nimport type { Editor } from '../Editor'\nimport { BoundsSnapGeometry } from '../managers/SnapManager/BoundsSnaps'\nimport { HandleSnapGeometry } from '../managers/SnapManager/HandleSnaps'\nimport { SvgExportContext } from '../types/SvgExportContext'\nimport { TLResizeHandle } from '../types/selection-types'\n\n/** @public */\nexport interface TLShapeUtilConstructor<\n\tT extends TLUnknownShape,\n\tU extends ShapeUtil<T> = ShapeUtil<T>,\n> {\n\tnew (editor: Editor): U\n\ttype: T['type']\n\tprops?: ShapeProps<T>\n\tmigrations?: LegacyMigrations | TLShapePropsMigrations | MigrationSequence\n}\n\n/** @public */\nexport type TLShapeUtilFlag<T> = (shape: T) => boolean\n\n/** @public */\nexport interface TLShapeUtilCanvasSvgDef {\n\tkey: string\n\tcomponent: React.ComponentType\n}\n\n/** @public */\nexport abstract class ShapeUtil<Shape extends TLUnknownShape = TLUnknownShape> {\n\tconstructor(public editor: Editor) {}\n\tstatic props?: ShapeProps<TLUnknownShape>\n\tstatic migrations?: LegacyMigrations | TLShapePropsMigrations\n\n\t/**\n\t * The type of the shape util, which should match the shape's type.\n\t *\n\t * @public\n\t */\n\tstatic type: string\n\n\t/**\n\t * Get the default props for a shape.\n\t *\n\t * @public\n\t */\n\tabstract getDefaultProps(): Shape['props']\n\n\t/**\n\t * Get the shape's geometry.\n\t *\n\t * @param shape - The shape.\n\t * @public\n\t */\n\tabstract getGeometry(shape: Shape): Geometry2d\n\n\t/**\n\t * Get a JSX element for the shape (as an HTML element).\n\t *\n\t * @param shape - The shape.\n\t * @public\n\t */\n\tabstract component(shape: Shape): any\n\n\t/**\n\t * Get JSX describing the shape's indicator (as an SVG element).\n\t *\n\t * @param shape - The shape.\n\t * @public\n\t */\n\tabstract indicator(shape: Shape): any\n\n\t/**\n\t * Whether the shape can be snapped to by another shape.\n\t *\n\t * @public\n\t */\n\tcanSnap: TLShapeUtilFlag<Shape> = () => true\n\n\t/**\n\t * Whether the shape can be scrolled while editing.\n\t *\n\t * @public\n\t */\n\tcanScroll: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Whether the shape can be bound to by an arrow.\n\t *\n\t * @param _otherShape - The other shape attempting to bind to this shape.\n\t * @public\n\t */\n\tcanBind = <K>(_shape: Shape, _otherShape?: K) => true\n\n\t/**\n\t * Whether the shape can be double clicked to edit.\n\t *\n\t * @public\n\t */\n\tcanEdit: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Whether the shape can be resized.\n\t *\n\t * @public\n\t */\n\tcanResize: TLShapeUtilFlag<Shape> = () => true\n\n\t/**\n\t * Whether the shape can be edited in read-only mode.\n\t *\n\t * @public\n\t */\n\tcanEditInReadOnly: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Whether the shape can be cropped.\n\t *\n\t * @public\n\t */\n\tcanCrop: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Does this shape provide a background for its children? If this is true,\n\t * then any children with a `renderBackground` method will have their\n\t * backgrounds rendered _above_ this shape. Otherwise, the children's\n\t * backgrounds will be rendered above either the next ancestor that provides\n\t * a background, or the canvas background.\n\t *\n\t * @internal\n\t */\n\tprovidesBackgroundForChildren(shape: Shape): boolean {\n\t\treturn false\n\t}\n\n\t/**\n\t * Whether the shape should hide its resize handles when selected.\n\t *\n\t * @public\n\t */\n\thideResizeHandles: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Whether the shape should hide its rotation handles when selected.\n\t *\n\t * @public\n\t */\n\thideRotateHandle: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Whether the shape should hide its selection bounds background when selected.\n\t *\n\t * @public\n\t */\n\thideSelectionBoundsBg: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Whether the shape should hide its selection bounds foreground when selected.\n\t *\n\t * @public\n\t */\n\thideSelectionBoundsFg: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Whether the shape's aspect ratio is locked.\n\t *\n\t * @public\n\t */\n\tisAspectRatioLocked: TLShapeUtilFlag<Shape> = () => false\n\n\t/**\n\t * Get a JSX element for the shape (as an HTML element) to be rendered as part of the canvas background - behind any other shape content.\n\t *\n\t * @param shape - The shape.\n\t * @internal\n\t */\n\tbackgroundComponent?(shape: Shape): any\n\n\t/**\n\t * Get an array of handle models for the shape. This is an optional method.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * util.getHandles?.(myShape)\n\t * ```\n\t *\n\t * @param shape - The shape.\n\t * @public\n\t */\n\tgetHandles?(shape: Shape): TLHandle[]\n\n\t/**\n\t * Get whether the shape can receive children of a given type.\n\t *\n\t * @param type - The shape type.\n\t * @public\n\t */\n\tcanReceiveNewChildrenOfType(shape: Shape, type: TLShape['type']) {\n\t\treturn false\n\t}\n\n\t/**\n\t * Get whether the shape can receive children of a given type.\n\t *\n\t * @param shape - The shape type.\n\t * @param shapes - The shapes that are being dropped.\n\t * @public\n\t */\n\tcanDropShapes(shape: Shape, shapes: TLShape[]) {\n\t\treturn false\n\t}\n\n\t/**\n\t * Get the shape as an SVG object.\n\t *\n\t * @param shape - The shape.\n\t * @param ctx - The export context for the SVG - used for adding e.g. \\<def\\>s\n\t * @returns An SVG element.\n\t * @public\n\t */\n\ttoSvg?(shape: Shape, ctx: SvgExportContext): ReactElement | null | Promise<ReactElement | null>\n\n\t/**\n\t * Get the shape's background layer as an SVG object.\n\t *\n\t * @param shape - The shape.\n\t * @param ctx - ctx - The export context for the SVG - used for adding e.g. \\<def\\>s\n\t * @returns An SVG element.\n\t * @public\n\t */\n\ttoBackgroundSvg?(\n\t\tshape: Shape,\n\t\tctx: SvgExportContext\n\t): ReactElement | null | Promise<ReactElement | null>\n\n\t/** @internal */\n\texpandSelectionOutlinePx(shape: Shape): number {\n\t\treturn 0\n\t}\n\n\t/**\n\t * Return elements to be added to the \\<defs\\> section of the canvases SVG context. This can be\n\t * used to define SVG content (e.g. patterns & masks) that can be referred to by ID from svg\n\t * elements returned by `component`.\n\t *\n\t * Each def should have a unique `key`. If multiple defs from different shapes all have the same\n\t * key, only one will be used.\n\t */\n\tgetCanvasSvgDefs(): TLShapeUtilCanvasSvgDef[] {\n\t\treturn []\n\t}\n\n\t/**\n\t * Get the geometry to use when snapping to this this shape in translate/resize operations. See\n\t * {@link BoundsSnapGeometry} for details.\n\t */\n\tgetBoundsSnapGeometry(shape: Shape): BoundsSnapGeometry {\n\t\treturn {}\n\t}\n\n\t/**\n\t * Get the geometry to use when snapping handles to this shape. See {@link HandleSnapGeometry}\n\t * for details.\n\t */\n\tgetHandleSnapGeometry(shape: Shape): HandleSnapGeometry {\n\t\treturn {}\n\t}\n\n\t//  Events\n\n\t/**\n\t * A callback called just before a shape is created. This method provides a last chance to modify\n\t * the created shape.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * onBeforeCreate = (next) => {\n\t * \treturn { ...next, x: next.x + 1 }\n\t * }\n\t * ```\n\t *\n\t * @param next - The next shape.\n\t * @returns The next shape or void.\n\t * @public\n\t */\n\tonBeforeCreate?: TLOnBeforeCreateHandler<Shape>\n\n\t/**\n\t * A callback called just before a shape is updated. This method provides a last chance to modify\n\t * the updated shape.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * onBeforeUpdate = (prev, next) => {\n\t * \tif (prev.x === next.x) {\n\t * \t\treturn { ...next, x: next.x + 1 }\n\t * \t}\n\t * }\n\t * ```\n\t *\n\t * @param prev - The previous shape.\n\t * @param next - The next shape.\n\t * @returns The next shape or void.\n\t * @public\n\t */\n\tonBeforeUpdate?: TLOnBeforeUpdateHandler<Shape>\n\n\t/**\n\t * A callback called when some other shapes are dragged over this one.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * onDragShapesOver = (shape, shapes) => {\n\t * \tthis.editor.reparentShapes(shapes, shape.id)\n\t * }\n\t * ```\n\t *\n\t * @param shape - The shape.\n\t * @param shapes - The shapes that are being dragged over this one.\n\t * @public\n\t */\n\tonDragShapesOver?: TLOnDragHandler<Shape>\n\n\t/**\n\t * A callback called when some other shapes are dragged out of this one.\n\t *\n\t * @param shape - The shape.\n\t * @param shapes - The shapes that are being dragged out.\n\t * @public\n\t */\n\tonDragShapesOut?: TLOnDragHandler<Shape>\n\n\t/**\n\t * A callback called when some other shapes are dropped over this one.\n\t *\n\t * @param shape - The shape.\n\t * @param shapes - The shapes that are being dropped over this one.\n\t * @public\n\t */\n\tonDropShapesOver?: TLOnDragHandler<Shape>\n\n\t/**\n\t * A callback called when a shape starts being resized.\n\t *\n\t * @param shape - The shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonResizeStart?: TLOnResizeStartHandler<Shape>\n\n\t/**\n\t * A callback called when a shape changes from a resize.\n\t *\n\t * @param shape - The shape at the start of the resize.\n\t * @param info - Info about the resize.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonResize?: TLOnResizeHandler<Shape>\n\n\t/**\n\t * A callback called when a shape finishes resizing.\n\t *\n\t * @param initial - The shape at the start of the resize.\n\t * @param current - The current shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonResizeEnd?: TLOnResizeEndHandler<Shape>\n\n\t/**\n\t * A callback called when a shape starts being translated.\n\t *\n\t * @param shape - The shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonTranslateStart?: TLOnTranslateStartHandler<Shape>\n\n\t/**\n\t * A callback called when a shape changes from a translation.\n\t *\n\t * @param initial - The shape at the start of the translation.\n\t * @param current - The current shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonTranslate?: TLOnTranslateHandler<Shape>\n\n\t/**\n\t * A callback called when a shape finishes translating.\n\t *\n\t * @param initial - The shape at the start of the translation.\n\t * @param current - The current shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonTranslateEnd?: TLOnTranslateEndHandler<Shape>\n\n\t/**\n\t * A callback called when a shape's handle changes.\n\t *\n\t * @param shape - The current shape.\n\t * @param info - An object containing the handle and whether the handle is 'precise' or not.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonHandleDrag?: TLOnHandleDragHandler<Shape>\n\n\t/**\n\t * A callback called when a shape starts being rotated.\n\t *\n\t * @param shape - The shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonRotateStart?: TLOnRotateStartHandler<Shape>\n\n\t/**\n\t * A callback called when a shape changes from a rotation.\n\t *\n\t * @param initial - The shape at the start of the rotation.\n\t * @param current - The current shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonRotate?: TLOnRotateHandler<Shape>\n\n\t/**\n\t * A callback called when a shape finishes rotating.\n\t *\n\t * @param initial - The shape at the start of the rotation.\n\t * @param current - The current shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonRotateEnd?: TLOnRotateEndHandler<Shape>\n\n\t/**\n\t * Not currently used.\n\t *\n\t * @internal\n\t */\n\tonBindingChange?: TLOnBindingChangeHandler<Shape>\n\n\t/**\n\t * A callback called when a shape's children change.\n\t *\n\t * @param shape - The shape.\n\t * @returns An array of shape updates, or void.\n\t * @public\n\t */\n\tonChildrenChange?: TLOnChildrenChangeHandler<Shape>\n\n\t/**\n\t * A callback called when a shape's handle is double clicked.\n\t *\n\t * @param shape - The shape.\n\t * @param handle - The handle that is double-clicked.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonDoubleClickHandle?: TLOnDoubleClickHandleHandler<Shape>\n\n\t/**\n\t * A callback called when a shape's edge is double clicked.\n\t *\n\t * @param shape - The shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonDoubleClickEdge?: TLOnDoubleClickHandler<Shape>\n\n\t/**\n\t * A callback called when a shape is double clicked.\n\t *\n\t * @param shape - The shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonDoubleClick?: TLOnDoubleClickHandler<Shape>\n\n\t/**\n\t * A callback called when a shape is clicked.\n\t *\n\t * @param shape - The shape.\n\t * @returns A change to apply to the shape, or void.\n\t * @public\n\t */\n\tonClick?: TLOnClickHandler<Shape>\n\n\t/**\n\t * A callback called when a shape finishes being editing.\n\t *\n\t * @param shape - The shape.\n\t * @public\n\t */\n\tonEditEnd?: TLOnEditEndHandler<Shape>\n}\n\n/** @public */\nexport type TLOnBeforeCreateHandler<T extends TLShape> = (next: T) => T | void\n/** @public */\nexport type TLOnBeforeUpdateHandler<T extends TLShape> = (prev: T, next: T) => T | void\n/** @public */\nexport type TLOnTranslateStartHandler<T extends TLShape> = TLEventStartHandler<T>\n/** @public */\nexport type TLOnTranslateHandler<T extends TLShape> = TLEventChangeHandler<T>\n/** @public */\nexport type TLOnTranslateEndHandler<T extends TLShape> = TLEventChangeHandler<T>\n/** @public */\nexport type TLOnRotateStartHandler<T extends TLShape> = TLEventStartHandler<T>\n/** @public */\nexport type TLOnRotateHandler<T extends TLShape> = TLEventChangeHandler<T>\n/** @public */\nexport type TLOnRotateEndHandler<T extends TLShape> = TLEventChangeHandler<T>\n\n/**\n * The type of resize.\n *\n * 'scale_shape' - The shape is being scaled, usually as part of a larger selection.\n *\n * 'resize_bounds' - The user is directly manipulating an individual shape's bounds using a resize\n * handle. It is up to shape util implementers to decide how they want to handle the two\n * situations.\n *\n * @public\n */\nexport type TLResizeMode = 'scale_shape' | 'resize_bounds'\n\n/**\n * Info about a resize.\n * @param newPoint - The new local position of the shape.\n * @param handle - The handle being dragged.\n * @param mode - The type of resize.\n * @param scaleX - The scale in the x-axis.\n * @param scaleY - The scale in the y-axis.\n * @param initialBounds - The bounds of the shape at the start of the resize.\n * @param initialShape - The shape at the start of the resize.\n * @public\n */\nexport type TLResizeInfo<T extends TLShape> = {\n\tnewPoint: Vec\n\thandle: TLResizeHandle\n\tmode: TLResizeMode\n\tscaleX: number\n\tscaleY: number\n\tinitialBounds: Box\n\tinitialShape: T\n}\n\n/** @public */\nexport type TLOnResizeHandler<T extends TLShape> = (\n\tshape: T,\n\tinfo: TLResizeInfo<T>\n) => Omit<TLShapePartial<T>, 'id' | 'type'> | undefined | void\n\n/** @public */\nexport type TLOnResizeStartHandler<T extends TLShape> = TLEventStartHandler<T>\n\n/** @public */\nexport type TLOnResizeEndHandler<T extends TLShape> = TLEventChangeHandler<T>\n\n/* -------------------- Dragging -------------------- */\n\n/** @public */\nexport type TLOnDragHandler<T extends TLShape, R = void> = (shape: T, shapes: TLShape[]) => R\n\n/** @internal */\nexport type TLOnBindingChangeHandler<T extends TLShape> = (shape: T) => TLShapePartial<T> | void\n\n/** @public */\nexport type TLOnChildrenChangeHandler<T extends TLShape> = (shape: T) => TLShapePartial[] | void\n\n/** @public */\nexport type TLOnHandleDragHandler<T extends TLShape> = (\n\tshape: T,\n\tinfo: {\n\t\thandle: TLHandle\n\t\tisPrecise: boolean\n\t\tinitial?: T | undefined\n\t}\n) => TLShapePartial<T> | void\n\n/** @public */\nexport type TLOnClickHandler<T extends TLShape> = (shape: T) => TLShapePartial<T> | void\n/** @public */\nexport type TLOnEditEndHandler<T extends TLShape> = (shape: T) => void\n/** @public */\nexport type TLOnDoubleClickHandler<T extends TLShape> = (shape: T) => TLShapePartial<T> | void\n/** @public */\nexport type TLOnDoubleClickHandleHandler<T extends TLShape> = (\n\tshape: T,\n\thandle: TLHandle\n) => TLShapePartial<T> | void\n\ntype TLEventStartHandler<T extends TLShape> = (shape: T) => TLShapePartial<T> | void\ntype TLEventChangeHandler<T extends TLShape> = (initial: T, current: T) => TLShapePartial<T> | void\n", "import { useValue } from '@tldraw/state'\nimport { useEditor } from '../../../hooks/useEditor'\nimport { Box } from '../../../primitives/Box'\nimport { getPerfectDashProps } from '../shared/getPerfectDashProps'\n\nexport function DashedOutlineBox({ bounds, className }: { bounds: Box; className: string }) {\n\tconst editor = useEditor()\n\n\tconst zoomLevel = useValue('zoom level', () => editor.getZoomLevel(), [editor])\n\n\treturn (\n\t\t<g className={className} pointerEvents=\"none\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n\t\t\t{bounds.sides.map((side, i) => {\n\t\t\t\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(\n\t\t\t\t\tside[0].dist(side[1]),\n\t\t\t\t\t1 / zoomLevel,\n\t\t\t\t\t{\n\t\t\t\t\t\tstyle: 'dashed',\n\t\t\t\t\t\tlengthRatio: 4,\n\t\t\t\t\t}\n\t\t\t\t)\n\n\t\t\t\treturn (\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\tx1={side[0].x}\n\t\t\t\t\t\ty1={side[0].y}\n\t\t\t\t\t\tx2={side[1].x}\n\t\t\t\t\t\ty2={side[1].y}\n\t\t\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t})}\n\t\t</g>\n\t)\n}\n", "import { TLDefaultDashStyle } from '@tldraw/tlschema'\n\nexport function getPerfectDashProps(\n\ttotalLength: number,\n\tstrokeWidth: number,\n\topts = {} as Partial<{\n\t\tstyle: TLDefaultDashStyle\n\t\tsnap: number\n\t\tend: 'skip' | 'outset' | 'none'\n\t\tstart: 'skip' | 'outset' | 'none'\n\t\tlengthRatio: number\n\t\tclosed: boolean\n\t}>\n): {\n\tstrokeDasharray: string\n\tstrokeDashoffset: string\n} {\n\tconst {\n\t\tclosed = false,\n\t\tsnap = 1,\n\t\tstart = 'outset',\n\t\tend = 'outset',\n\t\tlengthRatio = 2,\n\t\tstyle = 'dashed',\n\t} = opts\n\n\tlet dashLength = 0\n\tlet dashCount = 0\n\tlet ratio = 1\n\tlet gapLength = 0\n\tlet strokeDashoffset = 0\n\n\tswitch (style) {\n\t\tcase 'dashed': {\n\t\t\tratio = 1\n\t\t\tdashLength = Math.min(strokeWidth * lengthRatio, totalLength / 4)\n\t\t\tbreak\n\t\t}\n\t\tcase 'dotted': {\n\t\t\tratio = 100\n\t\t\tdashLength = strokeWidth / ratio\n\t\t\tbreak\n\t\t}\n\t\tdefault: {\n\t\t\treturn {\n\t\t\t\tstrokeDasharray: 'none',\n\t\t\t\tstrokeDashoffset: 'none',\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!closed) {\n\t\tif (start === 'outset') {\n\t\t\ttotalLength += dashLength / 2\n\t\t\tstrokeDashoffset += dashLength / 2\n\t\t} else if (start === 'skip') {\n\t\t\ttotalLength -= dashLength\n\t\t\tstrokeDashoffset -= dashLength\n\t\t}\n\n\t\tif (end === 'outset') {\n\t\t\ttotalLength += dashLength / 2\n\t\t} else if (end === 'skip') {\n\t\t\ttotalLength -= dashLength\n\t\t}\n\t}\n\n\tdashCount = Math.floor(totalLength / dashLength / (2 * ratio))\n\tdashCount -= dashCount % snap\n\n\tif (dashCount < 3 && style === 'dashed') {\n\t\tif (totalLength / strokeWidth < 5) {\n\t\t\tdashLength = totalLength\n\t\t\tdashCount = 1\n\t\t\tgapLength = 0\n\t\t} else {\n\t\t\tdashLength = totalLength * 0.333\n\t\t\tgapLength = totalLength * 0.333\n\t\t}\n\t} else {\n\t\tdashCount = Math.max(dashCount, 3)\n\t\tdashLength = totalLength / dashCount / (2 * ratio)\n\n\t\tif (closed) {\n\t\t\tstrokeDashoffset = dashLength / 2\n\t\t\tgapLength = (totalLength - dashCount * dashLength) / dashCount\n\t\t} else {\n\t\t\tgapLength = (totalLength - dashCount * dashLength) / Math.max(1, dashCount - 1)\n\t\t}\n\t}\n\n\treturn {\n\t\tstrokeDasharray: [dashLength, gapLength].join(' '),\n\t\tstrokeDashoffset: strokeDashoffset.toString(),\n\t}\n}\n", "import { TLShapeUtilConstructor } from '../editor/shapes/ShapeUtil'\nimport { GroupShapeUtil } from '../editor/shapes/group/GroupShapeUtil'\n\n/** @public */\nexport type TLAnyShapeUtilConstructor = TLShapeUtilConstructor<any>\n\n/** @public */\nexport const coreShapes = [\n\t// created by grouping interactions, probably the corest core shape that we have\n\tGroupShapeUtil,\n] as const\n\nconst coreShapeTypes = new Set<string>(coreShapes.map((s) => s.type))\n\nexport function checkShapesAndAddCore(customShapes: readonly TLAnyShapeUtilConstructor[]) {\n\tconst shapes = [...coreShapes] as TLAnyShapeUtilConstructor[]\n\n\tconst addedCustomShapeTypes = new Set<string>()\n\tfor (const customShape of customShapes) {\n\t\tif (coreShapeTypes.has(customShape.type)) {\n\t\t\tthrow new Error(\n\t\t\t\t`Shape type \"${customShape.type}\" is a core shapes type and cannot be overridden`\n\t\t\t)\n\t\t}\n\t\tif (addedCustomShapeTypes.has(customShape.type)) {\n\t\t\tthrow new Error(`Shape type \"${customShape.type}\" is defined more than once`)\n\t\t}\n\t\tshapes.push(customShape)\n\t\taddedCustomShapeTypes.add(customShape.type)\n\t}\n\n\treturn shapes\n}\n", "import { StyleProp } from '@tldraw/tlschema'\nimport { exhaustiveSwitchError } from '@tldraw/utils'\n\n/**\n * The value of a particular {@link @tldraw/tlschema#StyleProp}.\n *\n * A `mixed` style means that in the current selection, there are lots of different values for the\n * same style prop - e.g. a red and a blue shape are selected.\n *\n * A `shared` style means that all shapes in the selection share the same value for this style prop.\n *\n * @public\n */\nexport type SharedStyle<T> =\n\t| { readonly type: 'mixed' }\n\t| { readonly type: 'shared'; readonly value: T }\n\nfunction sharedStyleEquals<T>(a: SharedStyle<T>, b: SharedStyle<T> | undefined) {\n\tif (!b) return false\n\tswitch (a.type) {\n\t\tcase 'mixed':\n\t\t\treturn b.type === 'mixed'\n\t\tcase 'shared':\n\t\t\treturn b.type === 'shared' && a.value === b.value\n\t\tdefault:\n\t\t\tthrow exhaustiveSwitchError(a)\n\t}\n}\n\n/**\n * A map of {@link @tldraw/tlschema#StyleProp | StyleProps} to their {@link SharedStyle} values. See\n * {@link Editor.getSharedStyles}.\n *\n * @public\n */\nexport class ReadonlySharedStyleMap {\n\t/** @internal */\n\tprotected map: Map<StyleProp<any>, SharedStyle<unknown>>\n\n\tconstructor(entries?: Iterable<[StyleProp<unknown>, SharedStyle<unknown>]>) {\n\t\tthis.map = new Map(entries)\n\t}\n\n\tget<T>(prop: StyleProp<T>): SharedStyle<T> | undefined {\n\t\treturn this.map.get(prop) as SharedStyle<T> | undefined\n\t}\n\n\tgetAsKnownValue<T>(prop: StyleProp<T>): T | undefined {\n\t\tconst value = this.get(prop)\n\t\tif (!value) return undefined\n\t\tif (value.type === 'mixed') return undefined\n\t\treturn value.value\n\t}\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget size() {\n\t\treturn this.map.size\n\t}\n\n\tequals(other: ReadonlySharedStyleMap) {\n\t\tif (this.size !== other.size) return false\n\n\t\tconst checkedKeys = new Set()\n\t\tfor (const [styleProp, value] of this) {\n\t\t\tif (!sharedStyleEquals(value, other.get(styleProp))) return false\n\t\t\tcheckedKeys.add(styleProp)\n\t\t}\n\t\tfor (const [styleProp, value] of other) {\n\t\t\tif (checkedKeys.has(styleProp)) continue\n\t\t\tif (!sharedStyleEquals(value, this.get(styleProp))) return false\n\t\t}\n\n\t\treturn true\n\t}\n\n\tkeys() {\n\t\treturn this.map.keys()\n\t}\n\n\tvalues() {\n\t\treturn this.map.values()\n\t}\n\n\tentries() {\n\t\treturn this.map.entries()\n\t}\n\n\t[Symbol.iterator]() {\n\t\treturn this.map[Symbol.iterator]()\n\t}\n}\n\n/** @internal */\nexport class SharedStyleMap extends ReadonlySharedStyleMap {\n\tset<T>(prop: StyleProp<T>, value: SharedStyle<T>) {\n\t\tthis.map.set(prop, value)\n\t}\n\n\tapplyValue<T>(prop: StyleProp<T>, value: T) {\n\t\tconst existingValue = this.get(prop)\n\n\t\t// if we don't have a value yet, set it\n\t\tif (!existingValue) {\n\t\t\tthis.set(prop, { type: 'shared', value })\n\t\t\treturn\n\t\t}\n\n\t\tswitch (existingValue.type) {\n\t\t\tcase 'mixed':\n\t\t\t\t// we're already mixed, adding new values won't help\n\t\t\t\treturn\n\t\t\tcase 'shared':\n\t\t\t\tif (existingValue.value !== value) {\n\t\t\t\t\t// if the value is different, we're now mixed:\n\t\t\t\t\tthis.set(prop, { type: 'mixed' })\n\t\t\t\t}\n\t\t\t\treturn\n\t\t\tdefault:\n\t\t\t\texhaustiveSwitchError(existingValue, 'type')\n\t\t}\n\t}\n}\n", "/** @public */\nexport class WeakMapCache<T extends object, K> {\n\titems = new WeakMap<T, K>()\n\n\tget<P extends T>(item: P, cb: (item: P) => K) {\n\t\tif (!this.items.has(item)) {\n\t\t\tthis.items.set(item, cb(item))\n\t\t}\n\t\treturn this.items.get(item)!\n\t}\n\n\taccess(item: T) {\n\t\treturn this.items.get(item)\n\t}\n\n\tset(item: T, value: K) {\n\t\tthis.items.set(item, value)\n\t}\n\n\thas(item: T) {\n\t\treturn this.items.has(item)\n\t}\n\n\tinvalidate(item: T) {\n\t\tthis.items.delete(item)\n\t}\n\n\tbust() {\n\t\tthis.items = new WeakMap()\n\t}\n}\n", "/** @public */\nexport function dataUrlToFile(url: string, filename: string, mimeType: string) {\n\treturn fetch(url)\n\t\t.then(function (res) {\n\t\t\treturn res.arrayBuffer()\n\t\t})\n\t\t.then(function (buf) {\n\t\t\treturn new File([buf], filename, { type: mimeType })\n\t\t})\n}\n", "/**\n * Get an incremented name (e.g. New page (2)) from a name (e.g. New page), based on an array of\n * existing names.\n *\n * @param name - The name to increment.\n * @param others - The array of existing names.\n * @public\n */\nexport function getIncrementedName(name: string, others: string[]) {\n\tlet result = name\n\tconst set = new Set(others)\n\n\twhile (set.has(result)) {\n\t\tresult = /^.*(\\d+)$/.exec(result)?.[1]\n\t\t\t? result.replace(/(\\d+)(?=\\D?)$/, (m) => {\n\t\t\t\t\treturn (+m + 1).toString()\n\t\t\t\t})\n\t\t\t: `${result} 1`\n\t}\n\n\treturn result\n}\n", "import { TLParentId, TLShape, TLShapeId, TLShapePartial } from '@tldraw/tlschema'\nimport { IndexKey, compact, getIndicesBetween, sortByIndex } from '@tldraw/utils'\nimport { Editor } from '../editor/Editor'\n\nexport function getReorderingShapesChanges(\n\teditor: Editor,\n\toperation: 'toBack' | 'toFront' | 'forward' | 'backward',\n\tids: TLShapeId[]\n) {\n\tif (ids.length === 0) return []\n\n\t// From the ids that are moving, collect the parents, their children, and which of those children are moving\n\tconst parents = new Map<TLParentId, { moving: Set<TLShape>; children: TLShape[] }>()\n\n\tfor (const shape of compact(ids.map((id) => editor.getShape(id)))) {\n\t\tconst { parentId } = shape\n\t\tif (!parents.has(parentId)) {\n\t\t\tparents.set(parentId, {\n\t\t\t\tchildren: compact(\n\t\t\t\t\teditor.getSortedChildIdsForParent(parentId).map((id) => editor.getShape(id))\n\t\t\t\t),\n\t\t\t\tmoving: new Set(),\n\t\t\t})\n\t\t}\n\t\tparents.get(parentId)!.moving.add(shape)\n\t}\n\n\tconst changes: TLShapePartial[] = []\n\n\tswitch (operation) {\n\t\tcase 'toBack': {\n\t\t\tparents.forEach(({ moving, children }) => reorderToBack(moving, children, changes))\n\t\t\tbreak\n\t\t}\n\t\tcase 'toFront': {\n\t\t\tparents.forEach(({ moving, children }) => reorderToFront(moving, children, changes))\n\t\t\tbreak\n\t\t}\n\t\tcase 'forward': {\n\t\t\tparents.forEach(({ moving, children }) => reorderForward(moving, children, changes))\n\t\t\tbreak\n\t\t}\n\t\tcase 'backward': {\n\t\t\tparents.forEach(({ moving, children }) => reorderBackward(moving, children, changes))\n\t\t\tbreak\n\t\t}\n\t}\n\n\treturn changes\n}\n\n/**\n * Reorders the moving shapes to the back of the parent's children.\n *\n * @param moving The set of shapes that are moving\n * @param children The parent's children\n * @param changes The changes array to push changes to\n */\nfunction reorderToBack(moving: Set<TLShape>, children: TLShape[], changes: TLShapePartial[]) {\n\tconst len = children.length\n\n\t// If all of the children are moving, there's nothing to do\n\tif (moving.size === len) return\n\n\tlet below: IndexKey | undefined\n\tlet above: IndexKey | undefined\n\n\t// Starting at the bottom of this parent's children...\n\tfor (let i = 0; i < len; i++) {\n\t\tconst shape = children[i]\n\n\t\tif (moving.has(shape)) {\n\t\t\t// If we've found a moving shape before we've found a non-moving shape,\n\t\t\t// then that shape is already at the back; we can remove it from the\n\t\t\t// moving set and mark it as the shape that will be below the moved shapes.\n\t\t\tbelow = shape.index\n\t\t\tmoving.delete(shape)\n\t\t} else {\n\t\t\t// The first non-moving shape we find will be above our moved shapes; we'll\n\t\t\t// put our moving shapes between it and the shape marked as below (if any).\n\t\t\tabove = shape.index\n\t\t\tbreak\n\t\t}\n\t}\n\n\tif (moving.size === 0) {\n\t\t// If our moving set is empty, there's nothing to do; all of our shapes were\n\t\t// already at the back of the parent's children.\n\t\treturn\n\t} else {\n\t\t// Sort the moving shapes by their current index, then apply the new indices\n\t\tconst indices = getIndicesBetween(below, above, moving.size)\n\t\tchanges.push(\n\t\t\t...Array.from(moving.values())\n\t\t\t\t.sort(sortByIndex)\n\t\t\t\t.map((shape, i) => ({ ...shape, index: indices[i] }))\n\t\t)\n\t}\n}\n\n/**\n * Reorders the moving shapes to the front of the parent's children.\n *\n * @param moving The set of shapes that are moving\n * @param children The parent's children\n * @param changes The changes array to push changes to\n */\nfunction reorderToFront(moving: Set<TLShape>, children: TLShape[], changes: TLShapePartial[]) {\n\tconst len = children.length\n\n\t// If all of the children are moving, there's nothing to do\n\tif (moving.size === len) return\n\n\tlet below: IndexKey | undefined\n\tlet above: IndexKey | undefined\n\n\t// Starting at the top of this parent's children...\n\tfor (let i = len - 1; i > -1; i--) {\n\t\tconst shape = children[i]\n\n\t\tif (moving.has(shape)) {\n\t\t\t// If we've found a moving shape before we've found a non-moving shape,\n\t\t\t// then that shape is already at the front; we can remove it from the\n\t\t\t// moving set and mark it as the shape that will be above the moved shapes.\n\t\t\tabove = shape.index\n\t\t\tmoving.delete(shape)\n\t\t} else {\n\t\t\t// The first non-moving shape we find will be below our moved shapes; we'll\n\t\t\t// put our moving shapes between it and the shape marked as above (if any).\n\t\t\tbelow = shape.index\n\t\t\tbreak\n\t\t}\n\t}\n\n\tif (moving.size === 0) {\n\t\t// If our moving set is empty, there's nothing to do; all of our shapes were\n\t\t// already at the front of the parent's children.\n\t\treturn\n\t} else {\n\t\t// Sort the moving shapes by their current index, then apply the new indices\n\t\tconst indices = getIndicesBetween(below, above, moving.size)\n\t\tchanges.push(\n\t\t\t...Array.from(moving.values())\n\t\t\t\t.sort(sortByIndex)\n\t\t\t\t.map((shape, i) => ({ ...shape, index: indices[i] }))\n\t\t)\n\t}\n}\n\n/**\n * Reorders the moving shapes forward in the parent's children.\n *\n * @param moving The set of shapes that are moving\n * @param children The parent's children\n * @param changes The changes array to push changes to\n */\nfunction reorderForward(moving: Set<TLShape>, children: TLShape[], changes: TLShapePartial[]) {\n\tconst len = children.length\n\n\t// If all of the children are moving, there's nothing to do\n\tif (moving.size === len) return\n\n\tlet state = { name: 'skipping' } as\n\t\t| { name: 'skipping' }\n\t\t| { name: 'selecting'; selectIndex: number }\n\n\t// Starting at the bottom of this parent's children...\n\tfor (let i = 0; i < len; i++) {\n\t\tconst isMoving = moving.has(children[i])\n\n\t\tswitch (state.name) {\n\t\t\tcase 'skipping': {\n\t\t\t\tif (!isMoving) continue\n\t\t\t\t// If we find a moving shape while skipping, start selecting\n\t\t\t\tstate = { name: 'selecting', selectIndex: i }\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'selecting': {\n\t\t\t\tif (isMoving) continue\n\t\t\t\t// if we find a non-moving shape while selecting, move all selected\n\t\t\t\t// shapes in front of the not moving shape; and start skipping\n\t\t\t\tconst { selectIndex } = state\n\t\t\t\tgetIndicesBetween(children[i].index, children[i + 1]?.index, i - selectIndex).forEach(\n\t\t\t\t\t(index, k) => changes.push({ ...children[selectIndex + k], index })\n\t\t\t\t)\n\t\t\t\tstate = { name: 'skipping' }\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Reorders the moving shapes backward in the parent's children.\n *\n * @param moving The set of shapes that are moving\n * @param children The parent's children\n * @param changes The changes array to push changes to\n */\nfunction reorderBackward(moving: Set<TLShape>, children: TLShape[], changes: TLShapePartial[]) {\n\tconst len = children.length\n\n\tif (moving.size === len) return\n\n\tlet state = { name: 'skipping' } as\n\t\t| { name: 'skipping' }\n\t\t| { name: 'selecting'; selectIndex: number }\n\n\t// Starting at the top of this parent's children...\n\tfor (let i = len - 1; i > -1; i--) {\n\t\tconst isMoving = moving.has(children[i])\n\n\t\tswitch (state.name) {\n\t\t\tcase 'skipping': {\n\t\t\t\tif (!isMoving) continue\n\t\t\t\t// If we find a moving shape while skipping, start selecting\n\t\t\t\tstate = { name: 'selecting', selectIndex: i }\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'selecting': {\n\t\t\t\tif (isMoving) continue\n\t\t\t\t// if we find a non-moving shape while selecting, move all selected\n\t\t\t\t// shapes in behind of the not moving shape; and start skipping\n\t\t\t\tgetIndicesBetween(children[i - 1]?.index, children[i].index, state.selectIndex - i).forEach(\n\t\t\t\t\t(index, k) => {\n\t\t\t\t\t\tchanges.push({ ...children[i + k + 1], index })\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\tstate = { name: 'skipping' }\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n}\n", "import { isShapeId, TLShape, TLShapePartial } from '@tldraw/tlschema'\nimport { structuredClone } from '@tldraw/utils'\nimport { Editor } from '../editor/Editor'\nimport { Mat } from '../primitives/Mat'\nimport { canonicalizeRotation } from '../primitives/utils'\nimport { Vec } from '../primitives/Vec'\n\n/** @internal */\nexport function getRotationSnapshot({ editor }: { editor: Editor }): TLRotationSnapshot | null {\n\tconst selectedShapes = editor.getSelectedShapes()\n\tconst selectionRotation = editor.getSelectionRotation()\n\tconst selectionBounds = editor.getSelectionRotatedPageBounds()\n\tconst {\n\t\tinputs: { originPagePoint },\n\t} = editor\n\n\t// todo: this assumes we're rotating the selected shapes\n\t// if we try to rotate shapes that aren't selected, this\n\t// will produce the wrong results\n\n\t// Return null if there are no selected shapes\n\tif (!selectionBounds) {\n\t\treturn null\n\t}\n\n\tconst selectionPageCenter = selectionBounds.center\n\t\t.clone()\n\t\t.rotWith(selectionBounds.point, selectionRotation)\n\n\treturn {\n\t\tselectionPageCenter: selectionPageCenter,\n\t\tinitialCursorAngle: selectionPageCenter.angle(originPagePoint),\n\t\tinitialSelectionRotation: selectionRotation,\n\t\tshapeSnapshots: selectedShapes.map((shape) => ({\n\t\t\tshape: structuredClone(shape),\n\t\t\tinitialPagePoint: editor.getShapePageTransform(shape.id)!.point(),\n\t\t})),\n\t}\n}\n\n/**\n * Info about a rotation that can be applied to the editor's selected shapes.\n *\n * @param selectionPageCenter - The center of the selection in page coordinates\n * @param initialCursorAngle - The angle of the cursor relative to the selection center when the rotation started\n * @param initialSelectionRotation - The rotation of the selection when the rotation started\n * @param shapeSnapshots - Info about each shape that is being rotated\n *\n * @public\n **/\nexport type TLRotationSnapshot = {\n\tselectionPageCenter: Vec\n\tinitialCursorAngle: number\n\tinitialSelectionRotation: number\n\tshapeSnapshots: {\n\t\tshape: TLShape\n\t\tinitialPagePoint: Vec\n\t}[]\n}\n\n/** @internal */\nexport function applyRotationToSnapshotShapes({\n\tdelta,\n\teditor,\n\tsnapshot,\n\tstage,\n}: {\n\tdelta: number\n\tsnapshot: TLRotationSnapshot\n\teditor: Editor\n\tstage: 'start' | 'update' | 'end' | 'one-off'\n}) {\n\tconst { selectionPageCenter, shapeSnapshots } = snapshot\n\n\teditor.updateShapes(\n\t\tshapeSnapshots.map(({ shape, initialPagePoint }) => {\n\t\t\t// We need to both rotate each shape individually and rotate the shapes\n\t\t\t// around the pivot point (the average center of all rotating shapes.)\n\n\t\t\tconst parentTransform = isShapeId(shape.parentId)\n\t\t\t\t? editor.getShapePageTransform(shape.parentId)!\n\t\t\t\t: Mat.Identity()\n\n\t\t\tconst newPagePoint = Vec.RotWith(initialPagePoint, selectionPageCenter, delta)\n\n\t\t\tconst newLocalPoint = Mat.applyToPoint(\n\t\t\t\t// use the current parent transform in case it has moved/resized since the start\n\t\t\t\t// (e.g. if rotating a shape at the edge of a group)\n\t\t\t\tMat.Inverse(parentTransform),\n\t\t\t\tnewPagePoint\n\t\t\t)\n\t\t\tconst newRotation = canonicalizeRotation(shape.rotation + delta)\n\n\t\t\treturn {\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tx: newLocalPoint.x,\n\t\t\t\ty: newLocalPoint.y,\n\t\t\t\trotation: newRotation,\n\t\t\t}\n\t\t})\n\t)\n\n\t// Handle change\n\n\tconst changes: TLShapePartial[] = []\n\n\tshapeSnapshots.forEach(({ shape }) => {\n\t\tconst current = editor.getShape(shape.id)\n\t\tif (!current) return\n\t\tconst util = editor.getShapeUtil(shape)\n\n\t\tif (stage === 'start' || stage === 'one-off') {\n\t\t\tconst changeStart = util.onRotateStart?.(shape)\n\t\t\tif (changeStart) changes.push(changeStart)\n\t\t}\n\n\t\tconst changeUpdate = util.onRotate?.(shape, current)\n\t\tif (changeUpdate) changes.push(changeUpdate)\n\n\t\tif (stage === 'end' || stage === 'one-off') {\n\t\t\tconst changeEnd = util.onRotateEnd?.(shape, current)\n\t\t\tif (changeEnd) changes.push(changeEnd)\n\t\t}\n\t})\n\n\tif (changes.length > 0) {\n\t\teditor.updateShapes(changes)\n\t}\n}\n", "import { Computed, RESET_VALUE, computed, isUninitialized } from '@tldraw/state'\nimport { TLArrowShape, TLShape, TLShapeId } from '@tldraw/tlschema'\nimport { Editor } from '../Editor'\n\ntype TLArrowBindingsIndex = Record<\n\tTLShapeId,\n\tundefined | { arrowId: TLShapeId; handleId: 'start' | 'end' }[]\n>\n\nexport const arrowBindingsIndex = (editor: Editor): Computed<TLArrowBindingsIndex> => {\n\tconst { store } = editor\n\tconst shapeHistory = store.query.filterHistory('shape')\n\tconst arrowQuery = store.query.records('shape', () => ({ type: { eq: 'arrow' as const } }))\n\tfunction fromScratch() {\n\t\tconst allArrows = arrowQuery.get() as TLArrowShape[]\n\n\t\tconst bindings2Arrows: TLArrowBindingsIndex = {}\n\n\t\tfor (const arrow of allArrows) {\n\t\t\tconst { start, end } = arrow.props\n\t\t\tif (start.type === 'binding') {\n\t\t\t\tconst arrows = bindings2Arrows[start.boundShapeId]\n\t\t\t\tif (arrows) arrows.push({ arrowId: arrow.id, handleId: 'start' })\n\t\t\t\telse bindings2Arrows[start.boundShapeId] = [{ arrowId: arrow.id, handleId: 'start' }]\n\t\t\t}\n\n\t\t\tif (end.type === 'binding') {\n\t\t\t\tconst arrows = bindings2Arrows[end.boundShapeId]\n\t\t\t\tif (arrows) arrows.push({ arrowId: arrow.id, handleId: 'end' })\n\t\t\t\telse bindings2Arrows[end.boundShapeId] = [{ arrowId: arrow.id, handleId: 'end' }]\n\t\t\t}\n\t\t}\n\n\t\treturn bindings2Arrows\n\t}\n\n\treturn computed<TLArrowBindingsIndex>('arrowBindingsIndex', (_lastValue, lastComputedEpoch) => {\n\t\tif (isUninitialized(_lastValue)) {\n\t\t\treturn fromScratch()\n\t\t}\n\n\t\tconst lastValue = _lastValue\n\n\t\tconst diff = shapeHistory.getDiffSince(lastComputedEpoch)\n\n\t\tif (diff === RESET_VALUE) {\n\t\t\treturn fromScratch()\n\t\t}\n\n\t\tlet nextValue: TLArrowBindingsIndex | undefined = undefined\n\n\t\tfunction ensureNewArray(boundShapeId: TLShapeId) {\n\t\t\t// this will never happen\n\t\t\tif (!nextValue) {\n\t\t\t\tnextValue = { ...lastValue }\n\t\t\t}\n\t\t\tif (!nextValue[boundShapeId]) {\n\t\t\t\tnextValue[boundShapeId] = []\n\t\t\t} else if (nextValue[boundShapeId] === lastValue[boundShapeId]) {\n\t\t\t\tnextValue[boundShapeId] = [...nextValue[boundShapeId]!]\n\t\t\t}\n\t\t}\n\n\t\tfunction removingBinding(\n\t\t\tboundShapeId: TLShapeId,\n\t\t\tarrowId: TLShapeId,\n\t\t\thandleId: 'start' | 'end'\n\t\t) {\n\t\t\tensureNewArray(boundShapeId)\n\t\t\tnextValue![boundShapeId] = nextValue![boundShapeId]!.filter(\n\t\t\t\t(binding) => binding.arrowId !== arrowId || binding.handleId !== handleId\n\t\t\t)\n\t\t\tif (nextValue![boundShapeId]!.length === 0) {\n\t\t\t\tdelete nextValue![boundShapeId]\n\t\t\t}\n\t\t}\n\n\t\tfunction addBinding(boundShapeId: TLShapeId, arrowId: TLShapeId, handleId: 'start' | 'end') {\n\t\t\tensureNewArray(boundShapeId)\n\t\t\tnextValue![boundShapeId]!.push({ arrowId, handleId })\n\t\t}\n\n\t\tfor (const changes of diff) {\n\t\t\tfor (const newShape of Object.values(changes.added)) {\n\t\t\t\tif (editor.isShapeOfType<TLArrowShape>(newShape, 'arrow')) {\n\t\t\t\t\tconst { start, end } = newShape.props\n\t\t\t\t\tif (start.type === 'binding') {\n\t\t\t\t\t\taddBinding(start.boundShapeId, newShape.id, 'start')\n\t\t\t\t\t}\n\t\t\t\t\tif (end.type === 'binding') {\n\t\t\t\t\t\taddBinding(end.boundShapeId, newShape.id, 'end')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const [prev, next] of Object.values(changes.updated) as [TLShape, TLShape][]) {\n\t\t\t\tif (\n\t\t\t\t\t!editor.isShapeOfType<TLArrowShape>(prev, 'arrow') ||\n\t\t\t\t\t!editor.isShapeOfType<TLArrowShape>(next, 'arrow')\n\t\t\t\t)\n\t\t\t\t\tcontinue\n\n\t\t\t\tfor (const handle of ['start', 'end'] as const) {\n\t\t\t\t\tconst prevTerminal = prev.props[handle]\n\t\t\t\t\tconst nextTerminal = next.props[handle]\n\n\t\t\t\t\tif (prevTerminal.type === 'binding' && nextTerminal.type === 'point') {\n\t\t\t\t\t\t// if the binding was removed\n\t\t\t\t\t\tremovingBinding(prevTerminal.boundShapeId, prev.id, handle)\n\t\t\t\t\t} else if (prevTerminal.type === 'point' && nextTerminal.type === 'binding') {\n\t\t\t\t\t\t// if the binding was added\n\t\t\t\t\t\taddBinding(nextTerminal.boundShapeId, next.id, handle)\n\t\t\t\t\t} else if (\n\t\t\t\t\t\tprevTerminal.type === 'binding' &&\n\t\t\t\t\t\tnextTerminal.type === 'binding' &&\n\t\t\t\t\t\tprevTerminal.boundShapeId !== nextTerminal.boundShapeId\n\t\t\t\t\t) {\n\t\t\t\t\t\t// if the binding was changed\n\t\t\t\t\t\tremovingBinding(prevTerminal.boundShapeId, prev.id, handle)\n\t\t\t\t\t\taddBinding(nextTerminal.boundShapeId, next.id, handle)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const prev of Object.values(changes.removed)) {\n\t\t\t\tif (editor.isShapeOfType<TLArrowShape>(prev, 'arrow')) {\n\t\t\t\t\tconst { start, end } = prev.props\n\t\t\t\t\tif (start.type === 'binding') {\n\t\t\t\t\t\tremovingBinding(start.boundShapeId, prev.id, 'start')\n\t\t\t\t\t}\n\t\t\t\t\tif (end.type === 'binding') {\n\t\t\t\t\t\tremovingBinding(end.boundShapeId, prev.id, 'end')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// TODO: add diff entries if we need them\n\t\treturn nextValue ?? lastValue\n\t})\n}\n", "import { computed, isUninitialized } from '@tldraw/state'\nimport { TLShapeId } from '@tldraw/tlschema'\nimport { Box } from '../../primitives/Box'\nimport { Editor } from '../Editor'\n\nfunction isShapeNotVisible(editor: Editor, id: TLShapeId, viewportPageBounds: Box): boolean {\n\tconst maskedPageBounds = editor.getShapeMaskedPageBounds(id)\n\t// if the shape is fully outside of its parent's clipping bounds...\n\tif (maskedPageBounds === undefined) return true\n\n\t// if the shape is fully outside of the viewport page bounds...\n\treturn !viewportPageBounds.includes(maskedPageBounds)\n}\n\n/**\n * Incremental derivation of not visible shapes.\n * Non visible shapes are shapes outside of the viewport page bounds and shapes outside of parent's clipping bounds.\n *\n * @param editor - Instance of the tldraw Editor.\n * @returns Incremental derivation of non visible shapes.\n */\nexport const notVisibleShapes = (editor: Editor) => {\n\tconst isCullingOffScreenShapes = Number.isFinite(editor.renderingBoundsMargin)\n\n\tfunction fromScratch(editor: Editor): Set<TLShapeId> {\n\t\tconst shapes = editor.getCurrentPageShapeIds()\n\t\tconst viewportPageBounds = editor.getViewportPageBounds()\n\t\tconst notVisibleShapes = new Set<TLShapeId>()\n\t\tshapes.forEach((id) => {\n\t\t\tif (isShapeNotVisible(editor, id, viewportPageBounds)) {\n\t\t\t\tnotVisibleShapes.add(id)\n\t\t\t}\n\t\t})\n\t\treturn notVisibleShapes\n\t}\n\treturn computed<Set<TLShapeId>>('getCulledShapes', (prevValue) => {\n\t\tif (!isCullingOffScreenShapes) return new Set<TLShapeId>()\n\n\t\tif (isUninitialized(prevValue)) {\n\t\t\treturn fromScratch(editor)\n\t\t}\n\n\t\tconst nextValue = fromScratch(editor)\n\n\t\tif (prevValue.size !== nextValue.size) return nextValue\n\t\tfor (const prev of prevValue) {\n\t\t\tif (!nextValue.has(prev)) {\n\t\t\t\treturn nextValue\n\t\t\t}\n\t\t}\n\t\treturn prevValue\n\t})\n}\n", "import { computed, isUninitialized, RESET_VALUE } from '@tldraw/state'\nimport { RecordsDiff } from '@tldraw/store'\nimport { isShape, TLParentId, TLRecord, TLShape, TLShapeId, TLStore } from '@tldraw/tlschema'\nimport { compact, sortByIndex } from '@tldraw/utils'\n\ntype Parents2Children = Record<TLParentId, TLShapeId[]>\n\nexport const parentsToChildren = (store: TLStore) => {\n\tconst shapeIdsQuery = store.query.ids<'shape'>('shape')\n\tconst shapeHistory = store.query.filterHistory('shape')\n\n\tfunction fromScratch() {\n\t\tconst result: Parents2Children = {}\n\t\tconst shapeIds = shapeIdsQuery.get()\n\t\tconst shapes = Array(shapeIds.size) as TLShape[]\n\t\tshapeIds.forEach((id) => shapes.push(store.get(id)!))\n\n\t\t// Sort the shapes by index\n\t\tshapes.sort(sortByIndex)\n\n\t\t// Populate the result object with an array for each parent.\n\t\tshapes.forEach((shape) => {\n\t\t\tif (!result[shape.parentId]) {\n\t\t\t\tresult[shape.parentId] = []\n\t\t\t}\n\t\t\tresult[shape.parentId].push(shape.id)\n\t\t})\n\n\t\treturn result\n\t}\n\n\treturn computed<Parents2Children>(\n\t\t'parentsToChildrenWithIndexes',\n\t\t(lastValue, lastComputedEpoch) => {\n\t\t\tif (isUninitialized(lastValue)) {\n\t\t\t\treturn fromScratch()\n\t\t\t}\n\n\t\t\tconst diff = shapeHistory.getDiffSince(lastComputedEpoch)\n\n\t\t\tif (diff === RESET_VALUE) {\n\t\t\t\treturn fromScratch()\n\t\t\t}\n\n\t\t\tif (diff.length === 0) return lastValue\n\n\t\t\tlet newValue: Record<TLParentId, TLShapeId[]> | null = null\n\n\t\t\tconst ensureNewArray = (parentId: TLParentId) => {\n\t\t\t\tif (!newValue) {\n\t\t\t\t\tnewValue = { ...lastValue }\n\t\t\t\t}\n\t\t\t\tif (!newValue[parentId]) {\n\t\t\t\t\tnewValue[parentId] = []\n\t\t\t\t} else if (newValue[parentId] === lastValue[parentId]) {\n\t\t\t\t\tnewValue[parentId] = [...newValue[parentId]!]\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst toSort = new Set<TLShapeId[]>()\n\n\t\t\tlet changes: RecordsDiff<TLRecord>\n\n\t\t\tfor (let i = 0, n = diff.length; i < n; i++) {\n\t\t\t\tchanges = diff[i]\n\n\t\t\t\t// Iterate through the added shapes, add them to the new value and mark them for sorting\n\t\t\t\tfor (const record of Object.values(changes.added)) {\n\t\t\t\t\tif (!isShape(record)) continue\n\t\t\t\t\tensureNewArray(record.parentId)\n\t\t\t\t\tnewValue![record.parentId].push(record.id)\n\t\t\t\t\ttoSort.add(newValue![record.parentId])\n\t\t\t\t}\n\n\t\t\t\t// Iterate through the updated shapes, add them to their parents in the new value and mark them for sorting\n\t\t\t\tfor (const [from, to] of Object.values(changes.updated)) {\n\t\t\t\t\tif (!isShape(to)) continue\n\t\t\t\t\tif (!isShape(from)) continue\n\n\t\t\t\t\tif (from.parentId !== to.parentId) {\n\t\t\t\t\t\t// If the parents have changed, remove the new value from the old parent and add it to the new parent\n\t\t\t\t\t\tensureNewArray(from.parentId)\n\t\t\t\t\t\tensureNewArray(to.parentId)\n\t\t\t\t\t\tnewValue![from.parentId].splice(newValue![from.parentId].indexOf(to.id), 1)\n\t\t\t\t\t\tnewValue![to.parentId].push(to.id)\n\t\t\t\t\t\ttoSort.add(newValue![to.parentId])\n\t\t\t\t\t} else if (from.index !== to.index) {\n\t\t\t\t\t\t// If the parent is the same but the index has changed (e.g. if they've been reordered), update the parent's array at the new index\n\t\t\t\t\t\tensureNewArray(to.parentId)\n\t\t\t\t\t\tconst idx = newValue![to.parentId].indexOf(to.id)\n\t\t\t\t\t\tnewValue![to.parentId][idx] = to.id\n\t\t\t\t\t\ttoSort.add(newValue![to.parentId])\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Iterate through the removed shapes, remove them from their parents in new value\n\t\t\t\tfor (const record of Object.values(changes.removed)) {\n\t\t\t\t\tif (!isShape(record)) continue\n\t\t\t\t\tensureNewArray(record.parentId)\n\t\t\t\t\tnewValue![record.parentId].splice(newValue![record.parentId].indexOf(record.id), 1)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Sort the arrays that have been marked for sorting\n\t\t\tfor (const arr of toSort) {\n\t\t\t\t// It's possible that some of the shapes may be deleted. But in which case would this be so?\n\t\t\t\tconst shapesInArr = compact(arr.map((id) => store.get(id)))\n\t\t\t\tshapesInArr.sort(sortByIndex)\n\t\t\t\tarr.splice(0, arr.length, ...shapesInArr.map((shape) => shape.id))\n\t\t\t}\n\n\t\t\treturn newValue ?? lastValue\n\t\t}\n\t)\n}\n", "import { computed, isUninitialized, RESET_VALUE, withDiff } from '@tldraw/state'\nimport { IncrementalSetConstructor } from '@tldraw/store'\nimport {\n\tisPageId,\n\tisShape,\n\tisShapeId,\n\tTLPageId,\n\tTLShape,\n\tTLShapeId,\n\tTLStore,\n} from '@tldraw/tlschema'\n\n/**\n * Get whether a shape is in the current page.\n *\n * @param store - The tldraw store.\n * @param pageId - The id of the page to check.\n * @param shape - The the shape to check.\n */\nconst isShapeInPage = (store: TLStore, pageId: TLPageId, shape: TLShape): boolean => {\n\twhile (!isPageId(shape.parentId)) {\n\t\tconst parent = store.get(shape.parentId)\n\t\tif (!parent) return false\n\t\tshape = parent\n\t}\n\n\treturn shape.parentId === pageId\n}\n\n/**\n * A derivation that returns a list of shape ids in the current page.\n *\n * @param store - The tldraw store.\n * @param getCurrentPageId - A function that returns the current page id.\n */\nexport const deriveShapeIdsInCurrentPage = (store: TLStore, getCurrentPageId: () => TLPageId) => {\n\tconst shapesIndex = store.query.ids('shape')\n\tlet lastPageId: null | TLPageId = null\n\tfunction fromScratch() {\n\t\tconst currentPageId = getCurrentPageId()\n\t\tlastPageId = currentPageId\n\t\treturn new Set(\n\t\t\t[...shapesIndex.get()].filter((id) => isShapeInPage(store, currentPageId, store.get(id)!))\n\t\t)\n\t}\n\treturn computed<Set<TLShapeId>>('_shapeIdsInCurrentPage', (prevValue, lastComputedEpoch) => {\n\t\tif (isUninitialized(prevValue)) {\n\t\t\treturn fromScratch()\n\t\t}\n\n\t\tconst currentPageId = getCurrentPageId()\n\n\t\tif (currentPageId !== lastPageId) {\n\t\t\treturn fromScratch()\n\t\t}\n\n\t\tconst diff = store.history.getDiffSince(lastComputedEpoch)\n\n\t\tif (diff === RESET_VALUE) {\n\t\t\treturn fromScratch()\n\t\t}\n\n\t\tconst builder = new IncrementalSetConstructor<TLShapeId>(\n\t\t\tprevValue\n\t\t) as IncrementalSetConstructor<TLShapeId>\n\n\t\tfor (const changes of diff) {\n\t\t\tfor (const record of Object.values(changes.added)) {\n\t\t\t\tif (isShape(record) && isShapeInPage(store, currentPageId, record)) {\n\t\t\t\t\tbuilder.add(record.id)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const [_from, to] of Object.values(changes.updated)) {\n\t\t\t\tif (isShape(to)) {\n\t\t\t\t\tif (isShapeInPage(store, currentPageId, to)) {\n\t\t\t\t\t\tbuilder.add(to.id)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuilder.remove(to.id)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const id of Object.keys(changes.removed)) {\n\t\t\t\tif (isShapeId(id)) {\n\t\t\t\t\tbuilder.remove(id)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst result = builder.get()\n\t\tif (!result) {\n\t\t\treturn prevValue\n\t\t}\n\n\t\treturn withDiff(result.value, result.diff)\n\t})\n}\n", "import {\n\tTLFrameShape,\n\tTLGroupShape,\n\tTLShape,\n\tTLShapeId,\n\tgetDefaultColorTheme,\n} from '@tldraw/tlschema'\nimport { Fragment, ReactElement } from 'react'\nimport { SVG_PADDING } from '../constants'\nimport { Editor } from './Editor'\nimport { SvgExportContext, SvgExportContextProvider, SvgExportDef } from './types/SvgExportContext'\nimport { TLSvgOptions } from './types/misc-types'\n\nexport async function getSvgJsx(\n\teditor: Editor,\n\tshapes: TLShapeId[] | TLShape[],\n\topts = {} as Partial<TLSvgOptions>\n) {\n\tconst ids =\n\t\ttypeof shapes[0] === 'string' ? (shapes as TLShapeId[]) : (shapes as TLShape[]).map((s) => s.id)\n\n\tif (ids.length === 0) return\n\tif (!window.document) throw Error('No document')\n\n\tconst { scale = 1, background = false, padding = SVG_PADDING, preserveAspectRatio = false } = opts\n\n\tconst isDarkMode = opts.darkMode ?? editor.user.getIsDarkMode()\n\tconst theme = getDefaultColorTheme({ isDarkMode })\n\n\t// ---Figure out which shapes we need to include\n\tconst shapeIdsToInclude = editor.getShapeAndDescendantIds(ids)\n\tconst renderingShapes = editor\n\t\t.getUnorderedRenderingShapes(false)\n\t\t.filter(({ id }) => shapeIdsToInclude.has(id))\n\n\t// --- Common bounding box of all shapes\n\tlet bbox = null\n\tif (opts.bounds) {\n\t\tbbox = opts.bounds\n\t} else {\n\t\tfor (const { id } of renderingShapes) {\n\t\t\tconst maskedPageBounds = editor.getShapeMaskedPageBounds(id)\n\t\t\tif (!maskedPageBounds) continue\n\t\t\tif (bbox) {\n\t\t\t\tbbox.union(maskedPageBounds)\n\t\t\t} else {\n\t\t\t\tbbox = maskedPageBounds.clone()\n\t\t\t}\n\t\t}\n\t}\n\n\t// no unmasked shapes to export\n\tif (!bbox) return\n\n\tconst singleFrameShapeId =\n\t\tids.length === 1 && editor.isShapeOfType<TLFrameShape>(editor.getShape(ids[0])!, 'frame')\n\t\t\t? ids[0]\n\t\t\t: null\n\tif (!singleFrameShapeId) {\n\t\t// Expand by an extra 32 pixels\n\t\tbbox.expandBy(padding)\n\t}\n\n\t// We want the svg image to be BIGGER THAN USUAL to account for image quality\n\tconst w = bbox.width * scale\n\tconst h = bbox.height * scale\n\n\ttry {\n\t\tdocument.body.focus?.() // weird but necessary\n\t} catch (e) {\n\t\t// not implemented\n\t}\n\n\tconst defChildren: ReactElement[] = []\n\n\tconst exportDefPromisesById = new Map<string, Promise<void>>()\n\tconst exportContext: SvgExportContext = {\n\t\tisDarkMode,\n\t\taddExportDef: (def: SvgExportDef) => {\n\t\t\tif (exportDefPromisesById.has(def.key)) return\n\t\t\tconst promise = (async () => {\n\t\t\t\tconst element = await def.getElement()\n\t\t\t\tif (!element) return\n\n\t\t\t\tdefChildren.push(<Fragment key={defChildren.length}>{element}</Fragment>)\n\t\t\t})()\n\t\t\texportDefPromisesById.set(def.key, promise)\n\t\t},\n\t}\n\n\tconst unorderedShapeElements = (\n\t\tawait Promise.all(\n\t\t\trenderingShapes.map(async ({ id, opacity, index, backgroundIndex }) => {\n\t\t\t\t// Don't render the frame if we're only exporting a single frame\n\t\t\t\tif (id === singleFrameShapeId) return []\n\n\t\t\t\tconst shape = editor.getShape(id)!\n\n\t\t\t\tif (editor.isShapeOfType<TLGroupShape>(shape, 'group')) return []\n\n\t\t\t\tconst util = editor.getShapeUtil(shape)\n\n\t\t\t\tlet toSvgResult = await util.toSvg?.(shape, exportContext)\n\t\t\t\tlet toBackgroundSvgResult = await util.toBackgroundSvg?.(shape, exportContext)\n\n\t\t\t\tif (!toSvgResult && !toBackgroundSvgResult) {\n\t\t\t\t\tconst bounds = editor.getShapePageBounds(shape)!\n\t\t\t\t\ttoSvgResult = (\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\twidth={bounds.w}\n\t\t\t\t\t\t\theight={bounds.h}\n\t\t\t\t\t\t\tfill={theme.solid}\n\t\t\t\t\t\t\tstroke={theme.grey.pattern}\n\t\t\t\t\t\t\tstrokeWidth={1}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tlet pageTransform = editor.getShapePageTransform(shape)!.toCssString()\n\t\t\t\tif ('scale' in shape.props) {\n\t\t\t\t\tif (shape.props.scale !== 1) {\n\t\t\t\t\t\tpageTransform = `${pageTransform} scale(${shape.props.scale}, ${shape.props.scale})`\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (toSvgResult) {\n\t\t\t\t\ttoSvgResult = (\n\t\t\t\t\t\t<g key={shape.id} transform={pageTransform} opacity={opacity}>\n\t\t\t\t\t\t\t{toSvgResult}\n\t\t\t\t\t\t</g>\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\tif (toBackgroundSvgResult) {\n\t\t\t\t\ttoBackgroundSvgResult = (\n\t\t\t\t\t\t<g key={`bg_${shape.id}`} transform={pageTransform} opacity={opacity}>\n\t\t\t\t\t\t\t{toBackgroundSvgResult}\n\t\t\t\t\t\t</g>\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\t// Create svg mask if shape has a frame as parent\n\t\t\t\tconst pageMask = editor.getShapeMask(shape.id)\n\t\t\t\tif (pageMask) {\n\t\t\t\t\t// Create a clip path and add it to defs\n\t\t\t\t\tconst pageMaskId = `mask_${shape.id.replace(':', '_')}`\n\t\t\t\t\tdefChildren.push(\n\t\t\t\t\t\t<clipPath key={defChildren.length} id={pageMaskId}>\n\t\t\t\t\t\t\t{/* Create a polyline mask that does the clipping */}\n\t\t\t\t\t\t\t<path d={`M${pageMask.map(({ x, y }) => `${x},${y}`).join('L')}Z`} />\n\t\t\t\t\t\t</clipPath>\n\t\t\t\t\t)\n\n\t\t\t\t\tif (toSvgResult) {\n\t\t\t\t\t\ttoSvgResult = (\n\t\t\t\t\t\t\t<g key={shape.id} clipPath={`url(#${pageMaskId})`}>\n\t\t\t\t\t\t\t\t{toSvgResult}\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\tif (toBackgroundSvgResult) {\n\t\t\t\t\t\ttoBackgroundSvgResult = (\n\t\t\t\t\t\t\t<g key={`bg_${shape.id}`} clipPath={`url(#${pageMaskId})`}>\n\t\t\t\t\t\t\t\t{toBackgroundSvgResult}\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst elements = []\n\t\t\t\tif (toSvgResult) {\n\t\t\t\t\telements.push({ zIndex: index, element: toSvgResult })\n\t\t\t\t}\n\t\t\t\tif (toBackgroundSvgResult) {\n\t\t\t\t\telements.push({ zIndex: backgroundIndex, element: toBackgroundSvgResult })\n\t\t\t\t}\n\n\t\t\t\treturn elements\n\t\t\t})\n\t\t)\n\t).flat()\n\n\tawait Promise.all(exportDefPromisesById.values())\n\n\tconst svg = (\n\t\t<SvgExportContextProvider editor={editor} context={exportContext}>\n\t\t\t<svg\n\t\t\t\tpreserveAspectRatio={preserveAspectRatio ? preserveAspectRatio : undefined}\n\t\t\t\tdirection=\"ltr\"\n\t\t\t\twidth={w}\n\t\t\t\theight={h}\n\t\t\t\tviewBox={`${bbox.minX} ${bbox.minY} ${bbox.width} ${bbox.height}`}\n\t\t\t\tstrokeLinecap=\"round\"\n\t\t\t\tstrokeLinejoin=\"round\"\n\t\t\t\tstyle={{\n\t\t\t\t\tbackgroundColor: background\n\t\t\t\t\t\t? singleFrameShapeId\n\t\t\t\t\t\t\t? theme.solid\n\t\t\t\t\t\t\t: theme.background\n\t\t\t\t\t\t: 'transparent',\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<defs>{defChildren}</defs>\n\t\t\t\t{unorderedShapeElements.sort((a, b) => a.zIndex - b.zIndex).map(({ element }) => element)}\n\t\t\t</svg>\n\t\t</SvgExportContextProvider>\n\t)\n\n\treturn { jsx: svg, width: w, height: h }\n}\n", "import { ReactElement, ReactNode, createContext, useContext } from 'react'\nimport { EditorContext } from '../../hooks/useEditor'\nimport { Editor } from '../Editor'\n\n/** @public */\nexport interface SvgExportDef {\n\tkey: string\n\tgetElement: () => Promise<ReactElement | null> | ReactElement | null\n}\n\n/** @public */\nexport interface SvgExportContext {\n\t/**\n\t * Add contents to the `<defs>` section of the export SVG. Each export def should have a unique\n\t * key. If multiple defs come with the same key, only one will be added.\n\t */\n\taddExportDef(def: SvgExportDef): void\n\n\t/**\n\t * Whether the export should be in dark mode.\n\t */\n\treadonly isDarkMode: boolean\n}\n\nconst Context = createContext<SvgExportContext | null>(null)\nexport function SvgExportContextProvider({\n\tcontext,\n\teditor,\n\tchildren,\n}: {\n\tcontext: SvgExportContext\n\teditor: Editor\n\tchildren: ReactNode\n}) {\n\treturn (\n\t\t<EditorContext.Provider value={editor}>\n\t\t\t<Context.Provider value={context}>{children}</Context.Provider>\n\t\t</EditorContext.Provider>\n\t)\n}\n\n/**\n * Returns the read-only parts of {@link SvgExportContext}.\n * @public\n */\nexport function useSvgExportContext() {\n\tconst ctx = useContext(Context)\n\tif (!ctx) return null\n\treturn { isDarkMode: ctx.isDarkMode }\n}\n", "import {\n\tCOARSE_DRAG_DISTANCE,\n\tDOUBLE_CLICK_DURATION,\n\tDRAG_DISTANCE,\n\tMULTI_CLICK_DURATION,\n} from '../../constants'\nimport { Vec } from '../../primitives/Vec'\nimport { uniqueId } from '../../utils/uniqueId'\nimport type { Editor } from '../Editor'\nimport { TLClickEventInfo, TLPointerEventInfo } from '../types/event-types'\n\ntype TLClickState =\n\t| 'idle'\n\t| 'pendingDouble'\n\t| 'pendingTriple'\n\t| 'pendingQuadruple'\n\t| 'pendingOverflow'\n\t| 'overflow'\n\nconst MAX_CLICK_DISTANCE = 40\n\nexport class ClickManager {\n\tconstructor(public editor: Editor) {}\n\n\tprivate _clickId = ''\n\n\tprivate _clickTimeout?: any\n\n\tprivate _clickScreenPoint?: Vec\n\n\tprivate _previousScreenPoint?: Vec\n\n\tprivate _getClickTimeout = (state: TLClickState, id = uniqueId()) => {\n\t\tthis._clickId = id\n\t\tclearTimeout(this._clickTimeout)\n\t\tthis._clickTimeout = setTimeout(\n\t\t\t() => {\n\t\t\t\tif (this._clickState === state && this._clickId === id) {\n\t\t\t\t\tswitch (this._clickState) {\n\t\t\t\t\t\tcase 'pendingTriple': {\n\t\t\t\t\t\t\tthis.editor.dispatch({\n\t\t\t\t\t\t\t\t...this.lastPointerInfo,\n\t\t\t\t\t\t\t\ttype: 'click',\n\t\t\t\t\t\t\t\tname: 'double_click',\n\t\t\t\t\t\t\t\tphase: 'settle',\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'pendingQuadruple': {\n\t\t\t\t\t\t\tthis.editor.dispatch({\n\t\t\t\t\t\t\t\t...this.lastPointerInfo,\n\t\t\t\t\t\t\t\ttype: 'click',\n\t\t\t\t\t\t\t\tname: 'triple_click',\n\t\t\t\t\t\t\t\tphase: 'settle',\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'pendingOverflow': {\n\t\t\t\t\t\t\tthis.editor.dispatch({\n\t\t\t\t\t\t\t\t...this.lastPointerInfo,\n\t\t\t\t\t\t\t\ttype: 'click',\n\t\t\t\t\t\t\t\tname: 'quadruple_click',\n\t\t\t\t\t\t\t\tphase: 'settle',\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t// noop\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._clickState = 'idle'\n\t\t\t\t}\n\t\t\t},\n\t\t\tstate === 'idle' || state === 'pendingDouble' ? DOUBLE_CLICK_DURATION : MULTI_CLICK_DURATION\n\t\t)\n\t}\n\n\t/**\n\t * The current click state.\n\t *\n\t * @internal\n\t */\n\tprivate _clickState?: TLClickState = 'idle'\n\n\t/**\n\t * The current click state.\n\t *\n\t * @public\n\t */\n\t// eslint-disable-next-line no-restricted-syntax\n\tget clickState() {\n\t\treturn this._clickState\n\t}\n\n\tlastPointerInfo = {} as TLPointerEventInfo\n\n\t/**\n\t * Start the double click timeout.\n\t *\n\t * @param info - The event info.\n\t */\n\ttransformPointerDownEvent = (info: TLPointerEventInfo): TLPointerEventInfo | TLClickEventInfo => {\n\t\tif (!this._clickState) return info\n\n\t\tthis._clickScreenPoint = Vec.From(info.point)\n\n\t\tif (\n\t\t\tthis._previousScreenPoint &&\n\t\t\tthis._previousScreenPoint.dist(this._clickScreenPoint) > MAX_CLICK_DISTANCE\n\t\t) {\n\t\t\tthis._clickState = 'idle'\n\t\t}\n\n\t\tthis._previousScreenPoint = this._clickScreenPoint\n\n\t\tthis.lastPointerInfo = info\n\n\t\tswitch (this._clickState) {\n\t\t\tcase 'idle': {\n\t\t\t\tthis._clickState = 'pendingDouble'\n\t\t\t\tthis._clickTimeout = this._getClickTimeout(this._clickState)\n\t\t\t\treturn info // returns the pointer event\n\t\t\t}\n\t\t\tcase 'pendingDouble': {\n\t\t\t\tthis._clickState = 'pendingTriple'\n\t\t\t\tthis._clickTimeout = this._getClickTimeout(this._clickState)\n\t\t\t\treturn {\n\t\t\t\t\t...info,\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tname: 'double_click',\n\t\t\t\t\tphase: 'down',\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase 'pendingTriple': {\n\t\t\t\tthis._clickState = 'pendingQuadruple'\n\t\t\t\tthis._clickTimeout = this._getClickTimeout(this._clickState)\n\t\t\t\treturn {\n\t\t\t\t\t...info,\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tname: 'triple_click',\n\t\t\t\t\tphase: 'down',\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase 'pendingQuadruple': {\n\t\t\t\tthis._clickState = 'pendingOverflow'\n\t\t\t\tthis._clickTimeout = this._getClickTimeout(this._clickState)\n\t\t\t\treturn {\n\t\t\t\t\t...info,\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tname: 'quadruple_click',\n\t\t\t\t\tphase: 'down',\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase 'pendingOverflow': {\n\t\t\t\tthis._clickState = 'overflow'\n\t\t\t\tthis._clickTimeout = this._getClickTimeout(this._clickState)\n\t\t\t\treturn info\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\t// overflow\n\t\t\t\tthis._clickTimeout = this._getClickTimeout(this._clickState)\n\t\t\t\treturn info\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Emit click_up events on pointer up.\n\t *\n\t * @param info - The event info.\n\t */\n\ttransformPointerUpEvent = (info: TLPointerEventInfo): TLPointerEventInfo | TLClickEventInfo => {\n\t\tif (!this._clickState) return info\n\n\t\tthis._clickScreenPoint = Vec.From(info.point)\n\n\t\tswitch (this._clickState) {\n\t\t\tcase 'pendingTriple': {\n\t\t\t\treturn {\n\t\t\t\t\t...this.lastPointerInfo,\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tname: 'double_click',\n\t\t\t\t\tphase: 'up',\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase 'pendingQuadruple': {\n\t\t\t\treturn {\n\t\t\t\t\t...this.lastPointerInfo,\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tname: 'triple_click',\n\t\t\t\t\tphase: 'up',\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase 'pendingOverflow': {\n\t\t\t\treturn {\n\t\t\t\t\t...this.lastPointerInfo,\n\t\t\t\t\ttype: 'click',\n\t\t\t\t\tname: 'quadruple_click',\n\t\t\t\t\tphase: 'up',\n\t\t\t\t}\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\t// idle, pendingDouble, overflow\n\t\t\t\treturn info\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Cancel the double click timeout.\n\t *\n\t * @internal\n\t */\n\tcancelDoubleClickTimeout = () => {\n\t\tthis._clickTimeout = clearTimeout(this._clickTimeout)\n\t\tthis._clickState = 'idle'\n\t}\n\n\t/**\n\t * Handle a move event, possibly cancelling the click timeout.\n\t *\n\t * @internal\n\t */\n\thandleMove = () => {\n\t\t// Cancel a double click event if the user has started dragging.\n\t\tif (\n\t\t\tthis._clickState !== 'idle' &&\n\t\t\tthis._clickScreenPoint &&\n\t\t\tVec.Dist2(this._clickScreenPoint, this.editor.inputs.currentScreenPoint) >\n\t\t\t\t(this.editor.getInstanceState().isCoarsePointer ? COARSE_DRAG_DISTANCE : DRAG_DISTANCE)\n\t\t) {\n\t\t\tthis.cancelDoubleClickTimeout()\n\t\t}\n\t}\n}\n", "import { Editor } from '../Editor'\n\nexport class EnvironmentManager {\n\tconstructor(public editor: Editor) {\n\t\tif (typeof window !== 'undefined' && 'navigator' in window) {\n\t\t\tthis.isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\n\t\t\tthis.isIos = !!navigator.userAgent.match(/iPad/i) || !!navigator.userAgent.match(/iPhone/i)\n\t\t\tthis.isChromeForIos = /crios.*safari/i.test(navigator.userAgent)\n\t\t\tthis.isFirefox = /firefox/i.test(navigator.userAgent)\n\t\t\tthis.isAndroid = /android/i.test(navigator.userAgent)\n\t\t} else {\n\t\t\tthis.isSafari = false\n\t\t\tthis.isIos = false\n\t\t\tthis.isChromeForIos = false\n\t\t\tthis.isFirefox = false\n\t\t\tthis.isAndroid = false\n\t\t}\n\t}\n\n\t/**\n\t * Whether the editor is running in Safari.\n\t *\n\t * @public\n\t */\n\treadonly isSafari: boolean\n\n\t/**\n\t * Whether the editor is running on iOS.\n\t *\n\t * @public\n\t */\n\treadonly isIos: boolean\n\n\t/**\n\t * Whether the editor is running on iOS.\n\t *\n\t * @public\n\t */\n\treadonly isChromeForIos: boolean\n\n\t/**\n\t * Whether the editor is running on Firefox.\n\t *\n\t * @public\n\t */\n\treadonly isFirefox: boolean\n\n\t/**\n\t * Whether the editor is running on Android.\n\t *\n\t * @public\n\t */\n\treadonly isAndroid: boolean\n}\n", "import { EMPTY_ARRAY } from '@tldraw/state'\n\nexport type Stack<T> = StackItem<T> | EmptyStackItem<T>\n\nexport function stack<T>(items?: Array<T>): Stack<T> {\n\tif (items) {\n\t\tlet result = EMPTY_STACK_ITEM as Stack<T>\n\t\twhile (items.length) {\n\t\t\tresult = result.push(items.pop()!)\n\t\t}\n\t\treturn result\n\t}\n\treturn EMPTY_STACK_ITEM as any\n}\n\nclass EmptyStackItem<T> implements Iterable<T> {\n\treadonly length = 0\n\treadonly head = null\n\treadonly tail: Stack<T> = this\n\n\tpush(head: T): Stack<T> {\n\t\treturn new StackItem<T>(head, this)\n\t}\n\n\ttoArray() {\n\t\treturn EMPTY_ARRAY\n\t}\n\n\t[Symbol.iterator]() {\n\t\treturn {\n\t\t\tnext() {\n\t\t\t\treturn { value: undefined, done: true as const }\n\t\t\t},\n\t\t}\n\t}\n}\n\nconst EMPTY_STACK_ITEM = new EmptyStackItem()\n\nclass StackItem<T> implements Iterable<T> {\n\tlength: number\n\tconstructor(\n\t\tpublic readonly head: T,\n\t\tpublic readonly tail: Stack<T>\n\t) {\n\t\tthis.length = tail.length + 1\n\t}\n\n\tpush(head: T): Stack<T> {\n\t\treturn new StackItem(head, this)\n\t}\n\n\ttoArray() {\n\t\treturn Array.from(this)\n\t}\n\n\t[Symbol.iterator]() {\n\t\tlet stack = this as Stack<T>\n\t\treturn {\n\t\t\tnext() {\n\t\t\t\tif (stack.length) {\n\t\t\t\t\tconst value = stack.head!\n\t\t\t\t\tstack = stack.tail\n\t\t\t\t\treturn { value, done: false as const }\n\t\t\t\t} else {\n\t\t\t\t\treturn { value: undefined, done: true as const }\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n}\n", "import { atom, transact } from '@tldraw/state'\nimport { devFreeze } from '@tldraw/store'\nimport { uniqueId } from '../../utils/uniqueId'\nimport { TLCommandHandler, TLCommandHistoryOptions, TLHistoryEntry } from '../types/history-types'\nimport { Stack, stack } from './Stack'\n\ntype CommandFn<Data> = (...args: any[]) =>\n\t| ({\n\t\t\tdata: Data\n\t  } & TLCommandHistoryOptions)\n\t| null\n\t| undefined\n\t| void\n\ntype ExtractData<Fn> = Fn extends CommandFn<infer Data> ? Data : never\ntype ExtractArgs<Fn> = Parameters<Extract<Fn, (...args: any[]) => any>>\n\nexport class HistoryManager<\n\tCTX extends {\n\t\temit: (name: 'change-history' | 'mark-history', ...args: any) => void\n\t},\n> {\n\t_undos = atom<Stack<TLHistoryEntry>>('HistoryManager.undos', stack()) // Updated by each action that includes and undo\n\t_redos = atom<Stack<TLHistoryEntry>>('HistoryManager.redos', stack()) // Updated when a user undoes\n\t_batchDepth = 0 // A flag for whether the user is in a batch operation\n\n\tconstructor(\n\t\tprivate readonly ctx: CTX,\n\t\tprivate readonly annotateError: (error: unknown) => void\n\t) {}\n\n\tonBatchComplete: () => void = () => void null\n\n\tprivate _commands: Record<string, TLCommandHandler<any>> = {}\n\n\tgetNumUndos() {\n\t\treturn this._undos.get().length\n\t}\n\tgetNumRedos() {\n\t\treturn this._redos.get().length\n\t}\n\tcreateCommand = <Name extends string, Constructor extends CommandFn<any>>(\n\t\tname: Name,\n\t\tconstructor: Constructor,\n\t\thandle: TLCommandHandler<ExtractData<Constructor>>\n\t) => {\n\t\tif (this._commands[name]) {\n\t\t\tthrow new Error(`Duplicate command: ${name}`)\n\t\t}\n\t\tthis._commands[name] = handle\n\n\t\tconst exec = (...args: ExtractArgs<Constructor>) => {\n\t\t\tif (!this._batchDepth) {\n\t\t\t\t// If we're not batching, run again in a batch\n\t\t\t\tthis.batch(() => exec(...args))\n\t\t\t\treturn this.ctx\n\t\t\t}\n\n\t\t\tconst result = constructor(...args)\n\n\t\t\tif (!result) {\n\t\t\t\treturn this.ctx\n\t\t\t}\n\n\t\t\tconst { data, ephemeral, squashing, preservesRedoStack } = result\n\n\t\t\tthis.ignoringUpdates((undos, redos) => {\n\t\t\t\thandle.do(data)\n\t\t\t\treturn { undos, redos }\n\t\t\t})\n\n\t\t\tif (!ephemeral) {\n\t\t\t\tconst prev = this._undos.get().head\n\t\t\t\tif (\n\t\t\t\t\tsquashing &&\n\t\t\t\t\tprev &&\n\t\t\t\t\tprev.type === 'command' &&\n\t\t\t\t\tprev.name === name &&\n\t\t\t\t\tprev.preservesRedoStack === preservesRedoStack\n\t\t\t\t) {\n\t\t\t\t\t// replace the last command with a squashed version\n\t\t\t\t\tthis._undos.update((undos) =>\n\t\t\t\t\t\tundos.tail.push({\n\t\t\t\t\t\t\t...prev,\n\t\t\t\t\t\t\tdata: devFreeze(handle.squash!(prev.data, data)),\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\t} else {\n\t\t\t\t\t// add to the undo stack\n\t\t\t\t\tthis._undos.update((undos) =>\n\t\t\t\t\t\tundos.push({\n\t\t\t\t\t\t\ttype: 'command',\n\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\tdata: devFreeze(data),\n\t\t\t\t\t\t\tpreservesRedoStack: preservesRedoStack,\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tif (!result.preservesRedoStack) {\n\t\t\t\t\tthis._redos.set(stack())\n\t\t\t\t}\n\n\t\t\t\tthis.ctx.emit('change-history', { reason: 'push' })\n\t\t\t}\n\n\t\t\treturn this.ctx\n\t\t}\n\n\t\treturn exec\n\t}\n\n\tbatch = (fn: () => void) => {\n\t\ttry {\n\t\t\tthis._batchDepth++\n\t\t\tif (this._batchDepth === 1) {\n\t\t\t\ttransact(() => {\n\t\t\t\t\tconst mostRecentAction = this._undos.get().head\n\t\t\t\t\tfn()\n\t\t\t\t\tif (mostRecentAction !== this._undos.get().head) {\n\t\t\t\t\t\tthis.onBatchComplete()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfn()\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.annotateError(error)\n\t\t\tthrow error\n\t\t} finally {\n\t\t\tthis._batchDepth--\n\t\t}\n\n\t\treturn this\n\t}\n\n\tprivate ignoringUpdates = (\n\t\tfn: (\n\t\t\tundos: Stack<TLHistoryEntry>,\n\t\t\tredos: Stack<TLHistoryEntry>\n\t\t) => { undos: Stack<TLHistoryEntry>; redos: Stack<TLHistoryEntry> }\n\t) => {\n\t\tlet undos = this._undos.get()\n\t\tlet redos = this._redos.get()\n\n\t\tthis._undos.set(stack())\n\t\tthis._redos.set(stack())\n\t\ttry {\n\t\t\t;({ undos, redos } = transact(() => fn(undos, redos)))\n\t\t} finally {\n\t\t\tthis._undos.set(undos)\n\t\t\tthis._redos.set(redos)\n\t\t}\n\t}\n\n\t// History\n\tprivate _undo = ({\n\t\tpushToRedoStack,\n\t\ttoMark = undefined,\n\t}: {\n\t\tpushToRedoStack: boolean\n\t\ttoMark?: string\n\t}) => {\n\t\tthis.ignoringUpdates((undos, redos) => {\n\t\t\tif (undos.length === 0) {\n\t\t\t\treturn { undos, redos }\n\t\t\t}\n\n\t\t\twhile (undos.head?.type === 'STOP') {\n\t\t\t\tconst mark = undos.head\n\t\t\t\tundos = undos.tail\n\t\t\t\tif (pushToRedoStack) {\n\t\t\t\t\tredos = redos.push(mark)\n\t\t\t\t}\n\t\t\t\tif (mark.id === toMark) {\n\t\t\t\t\tthis.ctx.emit(\n\t\t\t\t\t\t'change-history',\n\t\t\t\t\t\tpushToRedoStack ? { reason: 'undo' } : { reason: 'bail', markId: toMark }\n\t\t\t\t\t)\n\t\t\t\t\treturn { undos, redos }\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (undos.length === 0) {\n\t\t\t\tthis.ctx.emit(\n\t\t\t\t\t'change-history',\n\t\t\t\t\tpushToRedoStack ? { reason: 'undo' } : { reason: 'bail', markId: toMark }\n\t\t\t\t)\n\t\t\t\treturn { undos, redos }\n\t\t\t}\n\n\t\t\twhile (undos.head) {\n\t\t\t\tconst command = undos.head\n\t\t\t\tundos = undos.tail\n\n\t\t\t\tif (pushToRedoStack) {\n\t\t\t\t\tredos = redos.push(command)\n\t\t\t\t}\n\n\t\t\t\tif (command.type === 'STOP') {\n\t\t\t\t\tif (command.onUndo && (!toMark || command.id === toMark)) {\n\t\t\t\t\t\tthis.ctx.emit(\n\t\t\t\t\t\t\t'change-history',\n\t\t\t\t\t\t\tpushToRedoStack ? { reason: 'undo' } : { reason: 'bail', markId: toMark }\n\t\t\t\t\t\t)\n\t\t\t\t\t\treturn { undos, redos }\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst handler = this._commands[command.name]\n\t\t\t\t\thandler.undo(command.data)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.ctx.emit(\n\t\t\t\t'change-history',\n\t\t\t\tpushToRedoStack ? { reason: 'undo' } : { reason: 'bail', markId: toMark }\n\t\t\t)\n\t\t\treturn { undos, redos }\n\t\t})\n\n\t\treturn this\n\t}\n\n\tundo = () => {\n\t\tthis._undo({ pushToRedoStack: true })\n\n\t\treturn this\n\t}\n\n\tredo = () => {\n\t\tthis.ignoringUpdates((undos, redos) => {\n\t\t\tif (redos.length === 0) {\n\t\t\t\treturn { undos, redos }\n\t\t\t}\n\n\t\t\twhile (redos.head?.type === 'STOP') {\n\t\t\t\tundos = undos.push(redos.head)\n\t\t\t\tredos = redos.tail\n\t\t\t}\n\n\t\t\tif (redos.length === 0) {\n\t\t\t\tthis.ctx.emit('change-history', { reason: 'redo' })\n\t\t\t\treturn { undos, redos }\n\t\t\t}\n\n\t\t\twhile (redos.head) {\n\t\t\t\tconst command = redos.head\n\t\t\t\tundos = undos.push(redos.head)\n\t\t\t\tredos = redos.tail\n\n\t\t\t\tif (command.type === 'STOP') {\n\t\t\t\t\tif (command.onRedo) {\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst handler = this._commands[command.name]\n\t\t\t\t\tif (handler.redo) {\n\t\t\t\t\t\thandler.redo(command.data)\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandler.do(command.data)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.ctx.emit('change-history', { reason: 'redo' })\n\t\t\treturn { undos, redos }\n\t\t})\n\n\t\treturn this\n\t}\n\n\tbail = () => {\n\t\tthis._undo({ pushToRedoStack: false })\n\n\t\treturn this\n\t}\n\n\tbailToMark = (id: string) => {\n\t\tthis._undo({ pushToRedoStack: false, toMark: id })\n\n\t\treturn this\n\t}\n\n\tmark = (id = uniqueId(), onUndo = true, onRedo = true) => {\n\t\tconst mostRecent = this._undos.get().head\n\t\t// dedupe marks, why not\n\t\tif (mostRecent && mostRecent.type === 'STOP') {\n\t\t\tif (mostRecent.id === id && mostRecent.onUndo === onUndo && mostRecent.onRedo === onRedo) {\n\t\t\t\treturn mostRecent.id\n\t\t\t}\n\t\t}\n\n\t\tthis._undos.update((undos) => undos.push({ type: 'STOP', id, onUndo, onRedo }))\n\n\t\tthis.ctx.emit('mark-history', { id })\n\n\t\treturn id\n\t}\n\n\tclear() {\n\t\tthis._undos.set(stack())\n\t\tthis._redos.set(stack())\n\t}\n}\n", "import { TLScribble, VecModel } from '@tldraw/tlschema'\nimport { Vec } from '../../primitives/Vec'\nimport { uniqueId } from '../../utils/uniqueId'\nimport { Editor } from '../Editor'\n\ntype ScribbleItem = {\n\tid: string\n\tscribble: TLScribble\n\ttimeoutMs: number\n\tdelayRemaining: number\n\tprev: null | VecModel\n\tnext: null | VecModel\n}\n\n/** @public */\nexport class ScribbleManager {\n\tscribbleItems = new Map<string, ScribbleItem>()\n\tstate = 'paused' as 'paused' | 'running'\n\n\tconstructor(private editor: Editor) {}\n\n\taddScribble = (scribble: Partial<TLScribble>, id = uniqueId()) => {\n\t\tconst item: ScribbleItem = {\n\t\t\tid,\n\t\t\tscribble: {\n\t\t\t\tid,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: 'accent',\n\t\t\t\topacity: 0.8,\n\t\t\t\tdelay: 0,\n\t\t\t\tpoints: [],\n\t\t\t\tshrink: 0.1,\n\t\t\t\ttaper: true,\n\t\t\t\t...scribble,\n\t\t\t\tstate: 'starting',\n\t\t\t},\n\t\t\ttimeoutMs: 0,\n\t\t\tdelayRemaining: scribble.delay ?? 0,\n\t\t\tprev: null,\n\t\t\tnext: null,\n\t\t}\n\t\tthis.scribbleItems.set(id, item)\n\t\treturn item\n\t}\n\n\treset() {\n\t\tthis.editor.updateInstanceState({ scribbles: [] })\n\t\tthis.scribbleItems.clear()\n\t}\n\n\t/**\n\t * Start stopping the scribble. The scribble won't be removed until its last point is cleared.\n\t *\n\t * @public\n\t */\n\tstop = (id: ScribbleItem['id']) => {\n\t\tconst item = this.scribbleItems.get(id)\n\t\tif (!item) throw Error(`Scribble with id ${id} not found`)\n\t\titem.delayRemaining = Math.min(item.delayRemaining, 200)\n\t\titem.scribble.state = 'stopping'\n\t\treturn item\n\t}\n\n\t/**\n\t * Set the scribble's next point.\n\t *\n\t * @param point - The point to add.\n\t * @public\n\t */\n\taddPoint = (id: ScribbleItem['id'], x: number, y: number) => {\n\t\tconst item = this.scribbleItems.get(id)\n\t\tif (!item) throw Error(`Scribble with id ${id} not found`)\n\t\tconst { prev } = item\n\t\tconst point = { x, y, z: 0.5 }\n\t\tif (!prev || Vec.Dist(prev, point) >= 1) {\n\t\t\titem.next = point\n\t\t}\n\t\treturn item\n\t}\n\n\t/**\n\t * Update on each animation frame.\n\t *\n\t * @param elapsed - The number of milliseconds since the last tick.\n\t * @public\n\t */\n\ttick = (elapsed: number) => {\n\t\tif (this.scribbleItems.size === 0) return\n\t\tthis.editor.batch(() => {\n\t\t\tthis.scribbleItems.forEach((item) => {\n\t\t\t\t// let the item get at least eight points before\n\t\t\t\t//  switching from starting to active\n\t\t\t\tif (item.scribble.state === 'starting') {\n\t\t\t\t\tconst { next, prev } = item\n\t\t\t\t\tif (next && next !== prev) {\n\t\t\t\t\t\titem.prev = next\n\t\t\t\t\t\titem.scribble.points.push(next)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (item.scribble.points.length > 8) {\n\t\t\t\t\t\titem.scribble.state = 'active'\n\t\t\t\t\t}\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (item.delayRemaining > 0) {\n\t\t\t\t\titem.delayRemaining = Math.max(0, item.delayRemaining - elapsed)\n\t\t\t\t}\n\n\t\t\t\titem.timeoutMs += elapsed\n\t\t\t\tif (item.timeoutMs >= 16) {\n\t\t\t\t\titem.timeoutMs = 0\n\t\t\t\t}\n\n\t\t\t\tconst { delayRemaining, timeoutMs, prev, next, scribble } = item\n\n\t\t\t\tswitch (scribble.state) {\n\t\t\t\t\tcase 'active': {\n\t\t\t\t\t\tif (next && next !== prev) {\n\t\t\t\t\t\t\titem.prev = next\n\t\t\t\t\t\t\tscribble.points.push(next)\n\n\t\t\t\t\t\t\t// If we've run out of delay, then shrink the scribble from the start\n\t\t\t\t\t\t\tif (delayRemaining === 0) {\n\t\t\t\t\t\t\t\tif (scribble.points.length > 8) {\n\t\t\t\t\t\t\t\t\tscribble.points.shift()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// While not moving, shrink the scribble from the start\n\t\t\t\t\t\t\tif (timeoutMs === 0) {\n\t\t\t\t\t\t\t\tif (scribble.points.length > 1) {\n\t\t\t\t\t\t\t\t\tscribble.points.shift()\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Reset the item's delay\n\t\t\t\t\t\t\t\t\titem.delayRemaining = scribble.delay\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'stopping': {\n\t\t\t\t\t\tif (item.delayRemaining === 0) {\n\t\t\t\t\t\t\tif (timeoutMs === 0) {\n\t\t\t\t\t\t\t\t// If the scribble is down to one point, we're done!\n\t\t\t\t\t\t\t\tif (scribble.points.length === 1) {\n\t\t\t\t\t\t\t\t\tthis.scribbleItems.delete(item.id) // Remove the scribble\n\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (scribble.shrink) {\n\t\t\t\t\t\t\t\t\t// Drop the scribble's size as it shrinks\n\t\t\t\t\t\t\t\t\tscribble.size = Math.max(1, scribble.size * (1 - scribble.shrink))\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Drop the scribble's first point (its tail)\n\t\t\t\t\t\t\t\tscribble.points.shift()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'paused': {\n\t\t\t\t\t\t// Nothing to do while paused.\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t// The object here will get frozen into the record, so we need to\n\t\t\t// create a copies of the parts that what we'll be mutating later.\n\t\t\tthis.editor.updateInstanceState({\n\t\t\t\tscribbles: Array.from(this.scribbleItems.values())\n\t\t\t\t\t.map(({ scribble }) => ({\n\t\t\t\t\t\t...scribble,\n\t\t\t\t\t\tpoints: [...scribble.points],\n\t\t\t\t\t}))\n\t\t\t\t\t.slice(-5), // limit to three as a minor sanity check\n\t\t\t})\n\t\t})\n\t}\n}\n", "import { TLRecord, TLStore } from '@tldraw/tlschema'\n\n/** @public */\nexport type TLBeforeCreateHandler<R extends TLRecord> = (record: R, source: 'remote' | 'user') => R\n/** @public */\nexport type TLAfterCreateHandler<R extends TLRecord> = (\n\trecord: R,\n\tsource: 'remote' | 'user'\n) => void\n/** @public */\nexport type TLBeforeChangeHandler<R extends TLRecord> = (\n\tprev: R,\n\tnext: R,\n\tsource: 'remote' | 'user'\n) => R\n/** @public */\nexport type TLAfterChangeHandler<R extends TLRecord> = (\n\tprev: R,\n\tnext: R,\n\tsource: 'remote' | 'user'\n) => void\n/** @public */\nexport type TLBeforeDeleteHandler<R extends TLRecord> = (\n\trecord: R,\n\tsource: 'remote' | 'user'\n) => void | false\n/** @public */\nexport type TLAfterDeleteHandler<R extends TLRecord> = (\n\trecord: R,\n\tsource: 'remote' | 'user'\n) => void\n/** @public */\nexport type TLBatchCompleteHandler = () => void\n\n/**\n * The side effect manager (aka a \"correct state enforcer\") is responsible\n * for making sure that the editor's state is always correct. This includes\n * things like: deleting a shape if its parent is deleted; unbinding\n * arrows when their binding target is deleted; etc.\n *\n * @public\n */\nexport class SideEffectManager<\n\tCTX extends {\n\t\tstore: TLStore\n\t\thistory: { onBatchComplete: () => void }\n\t},\n> {\n\tconstructor(public editor: CTX) {\n\t\teditor.store.onBeforeCreate = (record, source) => {\n\t\t\tconst handlers = this._beforeCreateHandlers[\n\t\t\t\trecord.typeName\n\t\t\t] as TLBeforeCreateHandler<TLRecord>[]\n\t\t\tif (handlers) {\n\t\t\t\tlet r = record\n\t\t\t\tfor (const handler of handlers) {\n\t\t\t\t\tr = handler(r, source)\n\t\t\t\t}\n\t\t\t\treturn r\n\t\t\t}\n\n\t\t\treturn record\n\t\t}\n\n\t\teditor.store.onAfterCreate = (record, source) => {\n\t\t\tconst handlers = this._afterCreateHandlers[\n\t\t\t\trecord.typeName\n\t\t\t] as TLAfterCreateHandler<TLRecord>[]\n\t\t\tif (handlers) {\n\t\t\t\tfor (const handler of handlers) {\n\t\t\t\t\thandler(record, source)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor.store.onBeforeChange = (prev, next, source) => {\n\t\t\tconst handlers = this._beforeChangeHandlers[\n\t\t\t\tnext.typeName\n\t\t\t] as TLBeforeChangeHandler<TLRecord>[]\n\t\t\tif (handlers) {\n\t\t\t\tlet r = next\n\t\t\t\tfor (const handler of handlers) {\n\t\t\t\t\tr = handler(prev, r, source)\n\t\t\t\t}\n\t\t\t\treturn r\n\t\t\t}\n\n\t\t\treturn next\n\t\t}\n\n\t\tlet updateDepth = 0\n\n\t\teditor.store.onAfterChange = (prev, next, source) => {\n\t\t\tupdateDepth++\n\n\t\t\tif (updateDepth > 1000) {\n\t\t\t\tconsole.error('[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.')\n\t\t\t} else {\n\t\t\t\tconst handlers = this._afterChangeHandlers[\n\t\t\t\t\tnext.typeName\n\t\t\t\t] as TLAfterChangeHandler<TLRecord>[]\n\t\t\t\tif (handlers) {\n\t\t\t\t\tfor (const handler of handlers) {\n\t\t\t\t\t\thandler(prev, next, source)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tupdateDepth--\n\t\t}\n\n\t\teditor.store.onBeforeDelete = (record, source) => {\n\t\t\tconst handlers = this._beforeDeleteHandlers[\n\t\t\t\trecord.typeName\n\t\t\t] as TLBeforeDeleteHandler<TLRecord>[]\n\t\t\tif (handlers) {\n\t\t\t\tfor (const handler of handlers) {\n\t\t\t\t\tif (handler(record, source) === false) {\n\t\t\t\t\t\treturn false\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor.store.onAfterDelete = (record, source) => {\n\t\t\tconst handlers = this._afterDeleteHandlers[\n\t\t\t\trecord.typeName\n\t\t\t] as TLAfterDeleteHandler<TLRecord>[]\n\t\t\tif (handlers) {\n\t\t\t\tfor (const handler of handlers) {\n\t\t\t\t\thandler(record, source)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor.history.onBatchComplete = () => {\n\t\t\tthis._batchCompleteHandlers.forEach((fn) => fn())\n\t\t}\n\t}\n\n\tprivate _beforeCreateHandlers: Partial<{\n\t\t[K in TLRecord['typeName']]: TLBeforeCreateHandler<TLRecord & { typeName: K }>[]\n\t}> = {}\n\tprivate _afterCreateHandlers: Partial<{\n\t\t[K in TLRecord['typeName']]: TLAfterCreateHandler<TLRecord & { typeName: K }>[]\n\t}> = {}\n\tprivate _beforeChangeHandlers: Partial<{\n\t\t[K in TLRecord['typeName']]: TLBeforeChangeHandler<TLRecord & { typeName: K }>[]\n\t}> = {}\n\tprivate _afterChangeHandlers: Partial<{\n\t\t[K in TLRecord['typeName']]: TLAfterChangeHandler<TLRecord & { typeName: K }>[]\n\t}> = {}\n\n\tprivate _beforeDeleteHandlers: Partial<{\n\t\t[K in TLRecord['typeName']]: TLBeforeDeleteHandler<TLRecord & { typeName: K }>[]\n\t}> = {}\n\n\tprivate _afterDeleteHandlers: Partial<{\n\t\t[K in TLRecord['typeName']]: TLAfterDeleteHandler<TLRecord & { typeName: K }>[]\n\t}> = {}\n\n\tprivate _batchCompleteHandlers: TLBatchCompleteHandler[] = []\n\n\t/**\n\t * Register a handler to be called before a record of a certain type is created. Return a\n\t * modified record from the handler to change the record that will be created.\n\t *\n\t * Use this handle only to modify the creation of the record itself. If you want to trigger a\n\t * side-effect on a different record (for example, moving one shape when another is created),\n\t * use {@link SideEffectManager.registerAfterCreateHandler} instead.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.sideEffects.registerBeforeCreateHandler('shape', (shape, source) => {\n\t *     // only modify shapes created by the user\n\t *     if (source !== 'user') return shape\n\t *\n\t *     //by default, arrow shapes have no label. Let's make sure they always have a label.\n\t *     if (shape.type === 'arrow') {\n\t *         return {...shape, props: {...shape.props, text: 'an arrow'}}\n\t *     }\n\t *\n\t *     // other shapes get returned unmodified\n\t *     return shape\n\t * })\n\t * ```\n\t *\n\t * @param typeName - The type of record to listen for\n\t * @param handler - The handler to call\n\t */\n\tregisterBeforeCreateHandler<T extends TLRecord['typeName']>(\n\t\ttypeName: T,\n\t\thandler: TLBeforeCreateHandler<TLRecord & { typeName: T }>\n\t) {\n\t\tconst handlers = this._beforeCreateHandlers[typeName] as TLBeforeCreateHandler<any>[]\n\t\tif (!handlers) this._beforeCreateHandlers[typeName] = []\n\t\tthis._beforeCreateHandlers[typeName]!.push(handler)\n\t\treturn () => remove(this._beforeCreateHandlers[typeName]!, handler)\n\t}\n\n\t/**\n\t * Register a handler to be called after a record is created. This is useful for side-effects\n\t * that would update _other_ records. If you want to modify the record being created use\n\t * {@link SideEffectManager.registerBeforeCreateHandler} instead.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.sideEffects.registerAfterCreateHandler('page', (page, source) => {\n\t *     // Automatically create a shape when a page is created\n\t *     editor.createShape({\n\t *         id: createShapeId(),\n\t *         type: 'text',\n\t *         props: { text: page.name },\n\t *     })\n\t * })\n\t * ```\n\t *\n\t * @param typeName - The type of record to listen for\n\t * @param handler - The handler to call\n\t */\n\tregisterAfterCreateHandler<T extends TLRecord['typeName']>(\n\t\ttypeName: T,\n\t\thandler: TLAfterCreateHandler<TLRecord & { typeName: T }>\n\t) {\n\t\tconst handlers = this._afterCreateHandlers[typeName] as TLAfterCreateHandler<any>[]\n\t\tif (!handlers) this._afterCreateHandlers[typeName] = []\n\t\tthis._afterCreateHandlers[typeName]!.push(handler)\n\t\treturn () => remove(this._afterCreateHandlers[typeName]!, handler)\n\t}\n\n\t/**\n\t * Register a handler to be called before a record is changed. The handler is given the old and\n\t * new record - you can return a modified record to apply a different update, or the old record\n\t * to block the update entirely.\n\t *\n\t * Use this handler only for intercepting updates to the record itself. If you want to update\n\t * other records in response to a change, use\n\t * {@link SideEffectManager.registerAfterChangeHandler} instead.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.sideEffects.registerBeforeChangeHandler('shape', (prev, next, source) => {\n\t *     if (next.isLocked && !prev.isLocked) {\n\t *         // prevent shapes from ever being locked:\n\t *         return prev\n\t *     }\n\t *     // other types of change are allowed\n\t *     return next\n\t * })\n\t * ```\n\t *\n\t * @param typeName - The type of record to listen for\n\t * @param handler - The handler to call\n\t */\n\tregisterBeforeChangeHandler<T extends TLRecord['typeName']>(\n\t\ttypeName: T,\n\t\thandler: TLBeforeChangeHandler<TLRecord & { typeName: T }>\n\t) {\n\t\tconst handlers = this._beforeChangeHandlers[typeName] as TLBeforeChangeHandler<any>[]\n\t\tif (!handlers) this._beforeChangeHandlers[typeName] = []\n\t\tthis._beforeChangeHandlers[typeName]!.push(handler)\n\t\treturn () => remove(this._beforeChangeHandlers[typeName]!, handler)\n\t}\n\n\t/**\n\t * Register a handler to be called after a record is changed. This is useful for side-effects\n\t * that would update _other_ records - if you want to modify the record being changed, use\n\t * {@link SideEffectManager.registerBeforeChangeHandler} instead.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.sideEffects.registerAfterChangeHandler('shape', (prev, next, source) => {\n\t *     if (next.props.color === 'red') {\n\t *         // there can only be one red shape at a time:\n\t *         const otherRedShapes = editor.getCurrentPageShapes().filter(s => s.props.color === 'red' && s.id !== next.id)\n\t *         editor.updateShapes(otherRedShapes.map(s => ({...s, props: {...s.props, color: 'blue'}})))\n\t *     }\n\t * })\n\t * ```\n\t *\n\t * @param typeName - The type of record to listen for\n\t * @param handler - The handler to call\n\t */\n\tregisterAfterChangeHandler<T extends TLRecord['typeName']>(\n\t\ttypeName: T,\n\t\thandler: TLAfterChangeHandler<TLRecord & { typeName: T }>\n\t) {\n\t\tconst handlers = this._afterChangeHandlers[typeName] as TLAfterChangeHandler<any>[]\n\t\tif (!handlers) this._afterChangeHandlers[typeName] = []\n\t\tthis._afterChangeHandlers[typeName]!.push(handler as TLAfterChangeHandler<any>)\n\t\treturn () => remove(this._afterChangeHandlers[typeName]!, handler)\n\t}\n\n\t/**\n\t * Register a handler to be called before a record is deleted. The handler can return `false` to\n\t * prevent the deletion.\n\t *\n\t * Use this handler only for intercepting deletions of the record itself. If you want to do\n\t * something to other records in response to a deletion, use\n\t * {@link SideEffectManager.registerAfterDeleteHandler} instead.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.sideEffects.registerBeforeDeleteHandler('shape', (shape, source) => {\n\t *     if (shape.props.color === 'red') {\n\t *         // prevent red shapes from being deleted\n\t * \t       return false\n\t *     }\n\t * })\n\t * ```\n\t *\n\t * @param typeName - The type of record to listen for\n\t * @param handler - The handler to call\n\t */\n\tregisterBeforeDeleteHandler<T extends TLRecord['typeName']>(\n\t\ttypeName: T,\n\t\thandler: TLBeforeDeleteHandler<TLRecord & { typeName: T }>\n\t) {\n\t\tconst handlers = this._beforeDeleteHandlers[typeName] as TLBeforeDeleteHandler<any>[]\n\t\tif (!handlers) this._beforeDeleteHandlers[typeName] = []\n\t\tthis._beforeDeleteHandlers[typeName]!.push(handler as TLBeforeDeleteHandler<any>)\n\t\treturn () => remove(this._beforeDeleteHandlers[typeName]!, handler)\n\t}\n\n\t/**\n\t * Register a handler to be called after a record is deleted. This is useful for side-effects\n\t * that would update _other_ records - if you want to block the deletion of the record itself,\n\t * use {@link SideEffectManager.registerBeforeDeleteHandler} instead.\n\t *\n\t * @example\n\t * ```ts\n\t * editor.sideEffects.registerAfterDeleteHandler('shape', (shape, source) => {\n\t *     // if the last shape in a frame is deleted, delete the frame too:\n\t *     const parentFrame = editor.getShape(shape.parentId)\n\t *     if (!parentFrame || parentFrame.type !== 'frame') return\n\t *\n\t *     const siblings = editor.getSortedChildIdsForParent(parentFrame)\n\t *     if (siblings.length === 0) {\n\t *         editor.deleteShape(parentFrame.id)\n\t *     }\n\t * })\n\t * ```\n\t *\n\t * @param typeName - The type of record to listen for\n\t * @param handler - The handler to call\n\t */\n\tregisterAfterDeleteHandler<T extends TLRecord['typeName']>(\n\t\ttypeName: T,\n\t\thandler: TLAfterDeleteHandler<TLRecord & { typeName: T }>\n\t) {\n\t\tconst handlers = this._afterDeleteHandlers[typeName] as TLAfterDeleteHandler<any>[]\n\t\tif (!handlers) this._afterDeleteHandlers[typeName] = []\n\t\tthis._afterDeleteHandlers[typeName]!.push(handler as TLAfterDeleteHandler<any>)\n\t\treturn () => remove(this._afterDeleteHandlers[typeName]!, handler)\n\t}\n\n\t/**\n\t * Register a handler to be called when a store completes a batch.\n\t *\n\t * @example\n\t * ```ts\n\t * let count = 0\n\t *\n\t * editor.cleanup.registerBatchCompleteHandler(() => count++)\n\t *\n\t * editor.selectAll()\n\t * expect(count).toBe(1)\n\t *\n\t * editor.batch(() => {\n\t *\teditor.selectNone()\n\t * \teditor.selectAll()\n\t * })\n\t *\n\t * expect(count).toBe(2)\n\t * ```\n\t *\n\t * @param handler - The handler to call\n\t *\n\t * @public\n\t */\n\tregisterBatchCompleteHandler(handler: TLBatchCompleteHandler) {\n\t\tthis._batchCompleteHandlers.push(handler)\n\t\treturn () => remove(this._batchCompleteHandlers, handler)\n\t}\n}\n\nfunction remove(array: any[], item: any) {\n\tconst index = array.indexOf(item)\n\tif (index >= 0) {\n\t\tarray.splice(index, 1)\n\t}\n}\n", "import { computed } from '@tldraw/state'\nimport { TLShape, TLShapeId, VecModel } from '@tldraw/tlschema'\nimport { assertExists, dedupe } from '@tldraw/utils'\nimport {\n\tBox,\n\tSelectionCorner,\n\tSelectionEdge,\n\tflipSelectionHandleX,\n\tflipSelectionHandleY,\n\tisSelectionCorner,\n} from '../../../primitives/Box'\nimport { Mat } from '../../../primitives/Mat'\nimport { Vec } from '../../../primitives/Vec'\nimport { rangeIntersection, rangesOverlap } from '../../../primitives/utils'\nimport { uniqueId } from '../../../utils/uniqueId'\nimport { Editor } from '../../Editor'\nimport {\n\tGapsSnapIndicator,\n\tPointsSnapIndicator,\n\tSnapData,\n\tSnapIndicator,\n\tSnapManager,\n} from './SnapManager'\n\n/**\n * When moving or resizing shapes, the bounds of the shape can snap to key geometry on other nearby\n * shapes. Customize how a shape snaps to others with {@link ShapeUtil.getBoundsSnapGeometry}.\n *\n * @public\n */\nexport interface BoundsSnapGeometry {\n\t/**\n\t * Points that this shape will snap to. By default, this will be the corners and center of the\n\t * shapes bounding box. To disable snapping to a specific point, use an empty array.\n\t */\n\tpoints?: VecModel[]\n}\n\n/** @public */\nexport interface BoundsSnapPoint {\n\tid: string\n\tx: number\n\ty: number\n\thandle?: SelectionCorner\n}\n\ntype SnapPair = { thisPoint: BoundsSnapPoint; otherPoint: BoundsSnapPoint }\n\ntype NearestPointsSnap = {\n\t// selection snaps to a nearby snap point\n\ttype: 'points'\n\tpoints: SnapPair\n\tnudge: number\n}\n\ntype NearestSnap =\n\t| NearestPointsSnap\n\t| {\n\t\t\t// selection snaps to the center of a gap\n\t\t\ttype: 'gap_center'\n\t\t\tgap: Gap\n\t\t\tnudge: number\n\t  }\n\t| {\n\t\t\t// selection snaps to create a new gap of equal size to another gap\n\t\t\t// on the opposite side of some shape\n\t\t\ttype: 'gap_duplicate'\n\t\t\tgap: Gap\n\t\t\tprotrusionDirection: 'left' | 'right' | 'top' | 'bottom'\n\t\t\tnudge: number\n\t  }\n\ntype GapNode = {\n\tid: TLShapeId\n\tpageBounds: Box\n}\n\ntype Gap = {\n\t// e.g.\n\t//      start\n\t//      edge     \u2502         breadth\n\t//               \u2502       intersection\n\t//               \u25BC        [40,100]           end\n\t//                            \u2502            \u2502 edge\n\t// \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 100,0      \u2502            \u2502\n\t// \u2502           \u2502 \u2502            \u25BC            \u25BC\n\t// \u2502           \u2502 \u2502\n\t// \u2502  start    \u2502 \u2502            \u2502     200,40 \u2502 \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t// \u2502  node     \u2502 \u2502            \u2502            \u2502 \u2502           \u2502\n\t// \u2502           \u2502 \u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502  end      \u2502\n\t// \u2502           \u2502 \u2502            \u2502            \u2502 \u2502  node     \u2502\n\t// \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 100,100    \u2502            \u2502 \u2502           \u2502\n\t//                                         \u2502 \u2502           \u2502\n\t//                                 200,120 \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\t//\n\t//                       length 100\n\t//               \u25C4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25BA\n\tstartNode: GapNode\n\tendNode: GapNode\n\tstartEdge: [Vec, Vec]\n\tendEdge: [Vec, Vec]\n\tlength: number\n\tbreadthIntersection: [number, number]\n}\n\nconst round = (x: number) => {\n\t// round numbers to avoid glitches for floating point rounding errors\n\tconst decimalPlacesTolerance = 8\n\treturn Math.round(x * 10 ** decimalPlacesTolerance) / 10 ** decimalPlacesTolerance\n}\n\nfunction findAdjacentGaps(\n\tgaps: Gap[],\n\tshapeId: TLShapeId,\n\tgapLength: number,\n\tdirection: 'forward' | 'backward',\n\tintersection: [number, number]\n): Gap[] {\n\t// TODO: take advantage of the fact that gaps is sorted by starting position?\n\tconst matches = gaps.filter(\n\t\t(gap) =>\n\t\t\t(direction === 'forward' ? gap.startNode.id === shapeId : gap.endNode.id === shapeId) &&\n\t\t\tround(gap.length) === round(gapLength) &&\n\t\t\trangeIntersection(\n\t\t\t\tgap.breadthIntersection[0],\n\t\t\t\tgap.breadthIntersection[1],\n\t\t\t\tintersection[0],\n\t\t\t\tintersection[1]\n\t\t\t)\n\t)\n\n\tif (matches.length === 0) return []\n\n\tconst nextNodes = new Set<TLShapeId>()\n\n\tmatches.forEach((match) => {\n\t\tconst node = direction === 'forward' ? match.endNode.id : match.startNode.id\n\t\tif (!nextNodes.has(node)) {\n\t\t\tnextNodes.add(node)\n\t\t\tconst foundGaps = findAdjacentGaps(\n\t\t\t\tgaps,\n\t\t\t\tnode,\n\t\t\t\tgapLength,\n\t\t\t\tdirection,\n\t\t\t\trangeIntersection(\n\t\t\t\t\tmatch.breadthIntersection[0],\n\t\t\t\t\tmatch.breadthIntersection[1],\n\t\t\t\t\tintersection[0],\n\t\t\t\t\tintersection[1]\n\t\t\t\t)!\n\t\t\t)\n\n\t\t\tmatches.push(...foundGaps)\n\t\t}\n\t})\n\n\treturn matches\n}\n\nfunction dedupeGapSnaps(snaps: Array<Extract<SnapIndicator, { type: 'gaps' }>>) {\n\t// sort by descending order of number of gaps\n\tsnaps.sort((a, b) => b.gaps.length - a.gaps.length)\n\t// pop off any that are included already\n\tfor (let i = snaps.length - 1; i > 0; i--) {\n\t\tconst snap = snaps[i]\n\t\tfor (let j = i - 1; j >= 0; j--) {\n\t\t\tconst otherSnap = snaps[j]\n\t\t\t// if every edge in this snap is included in the other snap somewhere, then it's redundant\n\t\t\tif (\n\t\t\t\totherSnap.direction === snap.direction &&\n\t\t\t\tsnap.gaps.every(\n\t\t\t\t\t(gap) =>\n\t\t\t\t\t\totherSnap.gaps.some(\n\t\t\t\t\t\t\t(otherGap) =>\n\t\t\t\t\t\t\t\tround(gap.startEdge[0].x) === round(otherGap.startEdge[0].x) &&\n\t\t\t\t\t\t\t\tround(gap.startEdge[0].y) === round(otherGap.startEdge[0].y) &&\n\t\t\t\t\t\t\t\tround(gap.startEdge[1].x) === round(otherGap.startEdge[1].x) &&\n\t\t\t\t\t\t\t\tround(gap.startEdge[1].y) === round(otherGap.startEdge[1].y)\n\t\t\t\t\t\t) &&\n\t\t\t\t\t\totherSnap.gaps.some(\n\t\t\t\t\t\t\t(otherGap) =>\n\t\t\t\t\t\t\t\tround(gap.endEdge[0].x) === round(otherGap.endEdge[0].x) &&\n\t\t\t\t\t\t\t\tround(gap.endEdge[0].y) === round(otherGap.endEdge[0].y) &&\n\t\t\t\t\t\t\t\tround(gap.endEdge[1].x) === round(otherGap.endEdge[1].x) &&\n\t\t\t\t\t\t\t\tround(gap.endEdge[1].y) === round(otherGap.endEdge[1].y)\n\t\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tsnaps.splice(i, 1)\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class BoundsSnaps {\n\treadonly editor: Editor\n\tconstructor(readonly manager: SnapManager) {\n\t\tthis.editor = manager.editor\n\t}\n\n\t@computed private getSnapPointsCache() {\n\t\tconst { editor } = this\n\t\treturn editor.store.createComputedCache<BoundsSnapPoint[], TLShape>('snapPoints', (shape) => {\n\t\t\tconst pageTransform = editor.getShapePageTransform(shape.id)\n\t\t\tif (!pageTransform) return undefined\n\t\t\tconst boundsSnapGeometry = editor.getShapeUtil(shape).getBoundsSnapGeometry(shape)\n\t\t\tconst snapPoints =\n\t\t\t\tboundsSnapGeometry.points ?? editor.getShapeGeometry(shape).bounds.cornersAndCenter\n\n\t\t\tif (!pageTransform || !snapPoints) return undefined\n\t\t\treturn snapPoints.map((point, i) => {\n\t\t\t\tconst { x, y } = Mat.applyToPoint(pageTransform, point)\n\t\t\t\treturn { x, y, id: `${shape.id}:${i}` }\n\t\t\t})\n\t\t})\n\t}\n\n\tgetSnapPoints(shapeId: TLShapeId) {\n\t\treturn this.getSnapPointsCache().get(shapeId) ?? []\n\t}\n\n\t// Points which belong to snappable shapes\n\t@computed private getSnappablePoints() {\n\t\tconst snapPointsCache = this.getSnapPointsCache()\n\t\tconst snappableShapes = this.manager.getSnappableShapes()\n\t\tconst result: BoundsSnapPoint[] = []\n\n\t\tfor (const shapeId of snappableShapes) {\n\t\t\tconst snapPoints = snapPointsCache.get(shapeId)\n\t\t\tif (snapPoints) {\n\t\t\t\tresult.push(...snapPoints)\n\t\t\t}\n\t\t}\n\n\t\treturn result\n\t}\n\n\t@computed private getSnappableGapNodes(): Array<GapNode> {\n\t\treturn Array.from(this.manager.getSnappableShapes(), (shapeId) => ({\n\t\t\tid: shapeId,\n\t\t\tpageBounds: assertExists(this.editor.getShapePageBounds(shapeId)),\n\t\t}))\n\t}\n\n\t@computed private getVisibleGaps(): { horizontal: Gap[]; vertical: Gap[] } {\n\t\tconst horizontal: Gap[] = []\n\t\tconst vertical: Gap[] = []\n\n\t\tlet startNode: GapNode, endNode: GapNode\n\n\t\tconst sortedShapesOnCurrentPageHorizontal = this.getSnappableGapNodes().sort((a, b) => {\n\t\t\treturn a.pageBounds.minX - b.pageBounds.minX\n\t\t})\n\n\t\t// Collect horizontal gaps\n\t\tfor (let i = 0; i < sortedShapesOnCurrentPageHorizontal.length; i++) {\n\t\t\tstartNode = sortedShapesOnCurrentPageHorizontal[i]\n\t\t\tfor (let j = i + 1; j < sortedShapesOnCurrentPageHorizontal.length; j++) {\n\t\t\t\tendNode = sortedShapesOnCurrentPageHorizontal[j]\n\n\t\t\t\tif (\n\t\t\t\t\t// is there space between the boxes\n\t\t\t\t\tstartNode.pageBounds.maxX < endNode.pageBounds.minX &&\n\t\t\t\t\t// and they overlap in the y axis\n\t\t\t\t\trangesOverlap(\n\t\t\t\t\t\tstartNode.pageBounds.minY,\n\t\t\t\t\t\tstartNode.pageBounds.maxY,\n\t\t\t\t\t\tendNode.pageBounds.minY,\n\t\t\t\t\t\tendNode.pageBounds.maxY\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\thorizontal.push({\n\t\t\t\t\t\tstartNode,\n\t\t\t\t\t\tendNode,\n\t\t\t\t\t\tstartEdge: [\n\t\t\t\t\t\t\tnew Vec(startNode.pageBounds.maxX, startNode.pageBounds.minY),\n\t\t\t\t\t\t\tnew Vec(startNode.pageBounds.maxX, startNode.pageBounds.maxY),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tendEdge: [\n\t\t\t\t\t\t\tnew Vec(endNode.pageBounds.minX, endNode.pageBounds.minY),\n\t\t\t\t\t\t\tnew Vec(endNode.pageBounds.minX, endNode.pageBounds.maxY),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tlength: endNode.pageBounds.minX - startNode.pageBounds.maxX,\n\t\t\t\t\t\tbreadthIntersection: rangeIntersection(\n\t\t\t\t\t\t\tstartNode.pageBounds.minY,\n\t\t\t\t\t\t\tstartNode.pageBounds.maxY,\n\t\t\t\t\t\t\tendNode.pageBounds.minY,\n\t\t\t\t\t\t\tendNode.pageBounds.maxY\n\t\t\t\t\t\t)!,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Collect vertical gaps\n\t\tconst sortedShapesOnCurrentPageVertical = sortedShapesOnCurrentPageHorizontal.sort((a, b) => {\n\t\t\treturn a.pageBounds.minY - b.pageBounds.minY\n\t\t})\n\n\t\tfor (let i = 0; i < sortedShapesOnCurrentPageVertical.length; i++) {\n\t\t\tstartNode = sortedShapesOnCurrentPageVertical[i]\n\t\t\tfor (let j = i + 1; j < sortedShapesOnCurrentPageVertical.length; j++) {\n\t\t\t\tendNode = sortedShapesOnCurrentPageVertical[j]\n\n\t\t\t\tif (\n\t\t\t\t\t// is there space between the boxes\n\t\t\t\t\tstartNode.pageBounds.maxY < endNode.pageBounds.minY &&\n\t\t\t\t\t// do they overlap in the x axis\n\t\t\t\t\trangesOverlap(\n\t\t\t\t\t\tstartNode.pageBounds.minX,\n\t\t\t\t\t\tstartNode.pageBounds.maxX,\n\t\t\t\t\t\tendNode.pageBounds.minX,\n\t\t\t\t\t\tendNode.pageBounds.maxX\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tvertical.push({\n\t\t\t\t\t\tstartNode,\n\t\t\t\t\t\tendNode,\n\t\t\t\t\t\tstartEdge: [\n\t\t\t\t\t\t\tnew Vec(startNode.pageBounds.minX, startNode.pageBounds.maxY),\n\t\t\t\t\t\t\tnew Vec(startNode.pageBounds.maxX, startNode.pageBounds.maxY),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tendEdge: [\n\t\t\t\t\t\t\tnew Vec(endNode.pageBounds.minX, endNode.pageBounds.minY),\n\t\t\t\t\t\t\tnew Vec(endNode.pageBounds.maxX, endNode.pageBounds.minY),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tlength: endNode.pageBounds.minY - startNode.pageBounds.maxY,\n\t\t\t\t\t\tbreadthIntersection: rangeIntersection(\n\t\t\t\t\t\t\tstartNode.pageBounds.minX,\n\t\t\t\t\t\t\tstartNode.pageBounds.maxX,\n\t\t\t\t\t\t\tendNode.pageBounds.minX,\n\t\t\t\t\t\t\tendNode.pageBounds.maxX\n\t\t\t\t\t\t)!,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { horizontal, vertical }\n\t}\n\n\tsnapTranslateShapes({\n\t\tlockedAxis,\n\t\tinitialSelectionPageBounds,\n\t\tinitialSelectionSnapPoints,\n\t\tdragDelta,\n\t}: {\n\t\tlockedAxis: 'x' | 'y' | null\n\t\tinitialSelectionSnapPoints: BoundsSnapPoint[]\n\t\tinitialSelectionPageBounds: Box\n\t\tdragDelta: Vec\n\t}): SnapData {\n\t\tconst snapThreshold = this.manager.getSnapThreshold()\n\t\tconst visibleSnapPointsNotInSelection = this.getSnappablePoints()\n\n\t\tconst selectionPageBounds = initialSelectionPageBounds.clone().translate(dragDelta)\n\n\t\tconst selectionSnapPoints: BoundsSnapPoint[] = initialSelectionSnapPoints.map(\n\t\t\t({ x, y }, i) => ({\n\t\t\t\tid: 'selection:' + i,\n\t\t\t\tx: x + dragDelta.x,\n\t\t\t\ty: y + dragDelta.y,\n\t\t\t})\n\t\t)\n\n\t\tconst otherNodeSnapPoints = visibleSnapPointsNotInSelection\n\n\t\tconst nearestSnapsX: NearestSnap[] = []\n\t\tconst nearestSnapsY: NearestSnap[] = []\n\t\tconst minOffset = new Vec(snapThreshold, snapThreshold)\n\n\t\tthis.collectPointSnaps({\n\t\t\tminOffset,\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t\totherNodeSnapPoints,\n\t\t\tselectionSnapPoints,\n\t\t})\n\n\t\tthis.collectGapSnaps({\n\t\t\tselectionPageBounds,\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t\tminOffset,\n\t\t})\n\n\t\t// at the same time, calculate how far we need to nudge the shape to 'snap' to the target point(s)\n\t\tconst nudge = new Vec(\n\t\t\tlockedAxis === 'x' ? 0 : nearestSnapsX[0]?.nudge ?? 0,\n\t\t\tlockedAxis === 'y' ? 0 : nearestSnapsY[0]?.nudge ?? 0\n\t\t)\n\n\t\t// ok we've figured out how much the box should be nudged, now let's find all the snap points\n\t\t// that are exact after making that translation, so we can render all of them.\n\t\t// first reset everything and adjust the original shapes to conform to the nudge\n\t\tminOffset.x = 0\n\t\tminOffset.y = 0\n\t\tnearestSnapsX.length = 0\n\t\tnearestSnapsY.length = 0\n\t\tselectionSnapPoints.forEach((s) => {\n\t\t\ts.x += nudge.x\n\t\t\ts.y += nudge.y\n\t\t})\n\t\tselectionPageBounds.translate(nudge)\n\n\t\tthis.collectPointSnaps({\n\t\t\tminOffset,\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t\totherNodeSnapPoints,\n\t\t\tselectionSnapPoints,\n\t\t})\n\n\t\tthis.collectGapSnaps({\n\t\t\tselectionPageBounds,\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t\tminOffset,\n\t\t})\n\n\t\tconst pointSnapsLines = this.getPointSnapLines({\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t})\n\n\t\tconst gapSnapLines = this.getGapSnapLines({\n\t\t\tselectionPageBounds,\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t})\n\n\t\tthis.manager.setIndicators([...gapSnapLines, ...pointSnapsLines])\n\n\t\treturn { nudge }\n\t}\n\n\tsnapResizeShapes({\n\t\tinitialSelectionPageBounds,\n\t\tdragDelta,\n\t\thandle: originalHandle,\n\t\tisAspectRatioLocked,\n\t\tisResizingFromCenter,\n\t}: {\n\t\t// the page bounds when the pointer went down, before any dragging\n\t\tinitialSelectionPageBounds: Box\n\t\t// how far the pointer has been dragged\n\t\tdragDelta: Vec\n\n\t\thandle: SelectionCorner | SelectionEdge\n\t\tisAspectRatioLocked: boolean\n\t\tisResizingFromCenter: boolean\n\t}): SnapData {\n\t\tconst snapThreshold = this.manager.getSnapThreshold()\n\n\t\t// first figure out the new bounds of the selection\n\t\tconst {\n\t\t\tbox: unsnappedResizedPageBounds,\n\t\t\tscaleX,\n\t\t\tscaleY,\n\t\t} = Box.Resize(\n\t\t\tinitialSelectionPageBounds,\n\t\t\toriginalHandle,\n\t\t\tisResizingFromCenter ? dragDelta.x * 2 : dragDelta.x,\n\t\t\tisResizingFromCenter ? dragDelta.y * 2 : dragDelta.y,\n\t\t\tisAspectRatioLocked\n\t\t)\n\n\t\tlet handle = originalHandle\n\n\t\tif (scaleX < 0) {\n\t\t\thandle = flipSelectionHandleX(handle)\n\t\t}\n\t\tif (scaleY < 0) {\n\t\t\thandle = flipSelectionHandleY(handle)\n\t\t}\n\n\t\tif (isResizingFromCenter) {\n\t\t\t// reposition if resizing from center\n\t\t\tunsnappedResizedPageBounds.center = initialSelectionPageBounds.center\n\t\t}\n\n\t\tconst isXLocked = handle === 'top' || handle === 'bottom'\n\t\tconst isYLocked = handle === 'left' || handle === 'right'\n\n\t\tconst selectionSnapPoints = getResizeSnapPointsForHandle(handle, unsnappedResizedPageBounds)\n\n\t\tconst otherNodeSnapPoints = this.getSnappablePoints()\n\n\t\tconst nearestSnapsX: NearestPointsSnap[] = []\n\t\tconst nearestSnapsY: NearestPointsSnap[] = []\n\t\tconst minOffset = new Vec(snapThreshold, snapThreshold)\n\n\t\tthis.collectPointSnaps({\n\t\t\tminOffset,\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t\totherNodeSnapPoints,\n\t\t\tselectionSnapPoints,\n\t\t})\n\n\t\t// at the same time, calculate how far we need to nudge the shape to 'snap' to the target point(s)\n\t\tconst nudge = new Vec(\n\t\t\tisXLocked ? 0 : nearestSnapsX[0]?.nudge ?? 0,\n\t\t\tisYLocked ? 0 : nearestSnapsY[0]?.nudge ?? 0\n\t\t)\n\n\t\tif (isAspectRatioLocked && isSelectionCorner(handle) && nudge.len() !== 0) {\n\t\t\t// if the aspect ratio is locked we need to make the nudge diagonal rather than independent in each axis\n\t\t\t// so we use the aspect ratio along with one axis value to set the other axis value, but which axis we use\n\t\t\t// as a source of truth depends what we have snapped to and how far.\n\n\t\t\t// if we found a snap in both axes, pick the closest one and discard the other\n\t\t\tconst primaryNudgeAxis: 'x' | 'y' =\n\t\t\t\tnearestSnapsX.length && nearestSnapsY.length\n\t\t\t\t\t? Math.abs(nudge.x) < Math.abs(nudge.y)\n\t\t\t\t\t\t? 'x'\n\t\t\t\t\t\t: 'y'\n\t\t\t\t\t: nearestSnapsX.length\n\t\t\t\t\t\t? 'x'\n\t\t\t\t\t\t: 'y'\n\n\t\t\tconst ratio = initialSelectionPageBounds.aspectRatio\n\n\t\t\tif (primaryNudgeAxis === 'x') {\n\t\t\t\tnearestSnapsY.length = 0\n\t\t\t\tnudge.y = nudge.x / ratio\n\t\t\t\tif (handle === 'bottom_left' || handle === 'top_right') {\n\t\t\t\t\tnudge.y = -nudge.y\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnearestSnapsX.length = 0\n\t\t\t\tnudge.x = nudge.y * ratio\n\t\t\t\tif (handle === 'bottom_left' || handle === 'top_right') {\n\t\t\t\t\tnudge.x = -nudge.x\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// now resize the box after nudging, calculate the snaps again, and return the snap lines to match\n\t\t// the fully resized box\n\t\tconst snappedDelta = Vec.Add(dragDelta, nudge)\n\n\t\t// first figure out the new bounds of the selection\n\t\tconst { box: snappedResizedPageBounds } = Box.Resize(\n\t\t\tinitialSelectionPageBounds,\n\t\t\toriginalHandle,\n\t\t\tisResizingFromCenter ? snappedDelta.x * 2 : snappedDelta.x,\n\t\t\tisResizingFromCenter ? snappedDelta.y * 2 : snappedDelta.y,\n\t\t\tisAspectRatioLocked\n\t\t)\n\n\t\tif (isResizingFromCenter) {\n\t\t\t// reposition if resizing from center\n\t\t\tsnappedResizedPageBounds.center = initialSelectionPageBounds.center\n\t\t}\n\n\t\tconst snappedSelectionPoints = getResizeSnapPointsForHandle('any', snappedResizedPageBounds)\n\t\t// calculate snaps again using all points\n\t\tnearestSnapsX.length = 0\n\t\tnearestSnapsY.length = 0\n\t\tminOffset.x = 0\n\t\tminOffset.y = 0\n\n\t\tthis.collectPointSnaps({\n\t\t\tminOffset,\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t\totherNodeSnapPoints,\n\t\t\tselectionSnapPoints: snappedSelectionPoints,\n\t\t})\n\t\tconst pointSnaps = this.getPointSnapLines({\n\t\t\tnearestSnapsX,\n\t\t\tnearestSnapsY,\n\t\t})\n\n\t\tthis.manager.setIndicators([...pointSnaps])\n\n\t\treturn { nudge }\n\t}\n\n\tprivate collectPointSnaps({\n\t\tselectionSnapPoints,\n\t\totherNodeSnapPoints,\n\t\tminOffset,\n\t\tnearestSnapsX,\n\t\tnearestSnapsY,\n\t}: {\n\t\tselectionSnapPoints: BoundsSnapPoint[]\n\t\totherNodeSnapPoints: BoundsSnapPoint[]\n\t\tminOffset: Vec\n\t\tnearestSnapsX: NearestSnap[]\n\t\tnearestSnapsY: NearestSnap[]\n\t}) {\n\t\t// for each snap point on the bounding box of the selection, find the set of points\n\t\t// which are closest to it in each axis\n\t\tfor (const thisSnapPoint of selectionSnapPoints) {\n\t\t\tfor (const otherSnapPoint of otherNodeSnapPoints) {\n\t\t\t\tconst offset = Vec.Sub(thisSnapPoint, otherSnapPoint)\n\t\t\t\tconst offsetX = Math.abs(offset.x)\n\t\t\t\tconst offsetY = Math.abs(offset.y)\n\n\t\t\t\tif (round(offsetX) <= round(minOffset.x)) {\n\t\t\t\t\tif (round(offsetX) < round(minOffset.x)) {\n\t\t\t\t\t\t// we found a point that is significantly closer than all previous points\n\t\t\t\t\t\t// so wipe the slate clean and start over\n\t\t\t\t\t\tnearestSnapsX.length = 0\n\t\t\t\t\t}\n\n\t\t\t\t\tnearestSnapsX.push({\n\t\t\t\t\t\ttype: 'points',\n\t\t\t\t\t\tpoints: { thisPoint: thisSnapPoint, otherPoint: otherSnapPoint },\n\t\t\t\t\t\tnudge: otherSnapPoint.x - thisSnapPoint.x,\n\t\t\t\t\t})\n\t\t\t\t\tminOffset.x = offsetX\n\t\t\t\t}\n\n\t\t\t\tif (round(offsetY) <= round(minOffset.y)) {\n\t\t\t\t\tif (round(offsetY) < round(minOffset.y)) {\n\t\t\t\t\t\t// we found a point that is significantly closer than all previous points\n\t\t\t\t\t\t// so wipe the slate clean and start over\n\t\t\t\t\t\tnearestSnapsY.length = 0\n\t\t\t\t\t}\n\t\t\t\t\tnearestSnapsY.push({\n\t\t\t\t\t\ttype: 'points',\n\t\t\t\t\t\tpoints: { thisPoint: thisSnapPoint, otherPoint: otherSnapPoint },\n\t\t\t\t\t\tnudge: otherSnapPoint.y - thisSnapPoint.y,\n\t\t\t\t\t})\n\t\t\t\t\tminOffset.y = offsetY\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate collectGapSnaps({\n\t\tselectionPageBounds,\n\t\tminOffset,\n\t\tnearestSnapsX,\n\t\tnearestSnapsY,\n\t}: {\n\t\tselectionPageBounds: Box\n\t\tminOffset: Vec\n\t\tnearestSnapsX: NearestSnap[]\n\t\tnearestSnapsY: NearestSnap[]\n\t}) {\n\t\tconst { horizontal, vertical } = this.getVisibleGaps()\n\n\t\tfor (const gap of horizontal) {\n\t\t\t// ignore this gap if the selection doesn't overlap with it in the y axis\n\t\t\tif (\n\t\t\t\t!rangesOverlap(\n\t\t\t\t\tgap.breadthIntersection[0],\n\t\t\t\t\tgap.breadthIntersection[1],\n\t\t\t\t\tselectionPageBounds.minY,\n\t\t\t\t\tselectionPageBounds.maxY\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// check for center match\n\t\t\tconst gapMidX = gap.startEdge[0].x + gap.length / 2\n\t\t\tconst centerNudge = gapMidX - selectionPageBounds.center.x\n\t\t\tconst gapIsLargerThanSelection = gap.length > selectionPageBounds.width\n\n\t\t\tif (gapIsLargerThanSelection && round(Math.abs(centerNudge)) <= round(minOffset.x)) {\n\t\t\t\tif (round(Math.abs(centerNudge)) < round(minOffset.x)) {\n\t\t\t\t\t// reset if we found a closer snap\n\t\t\t\t\tnearestSnapsX.length = 0\n\t\t\t\t}\n\t\t\t\tminOffset.x = Math.abs(centerNudge)\n\n\t\t\t\tconst snap: NearestSnap = {\n\t\t\t\t\ttype: 'gap_center',\n\t\t\t\t\tgap,\n\t\t\t\t\tnudge: centerNudge,\n\t\t\t\t}\n\n\t\t\t\t// we need to avoid creating visual noise with too many center snaps in situations\n\t\t\t\t// where there are lots of adjacent items with even spacing\n\t\t\t\t// so let's only show other center snaps where the gap's breadth does not overlap with this one\n\t\t\t\t// i.e.\n\t\t\t\t//                \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t\t\t\t//                \u2502               \u2502\n\t\t\t\t//                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2518\n\t\t\t\t//                       \u253C    \u2502\n\t\t\t\t//                 \u250C\u2500\u2500\u2500\u2500\u2500\u2534\u2510   \u2502\n\t\t\t\t//                 \u2502      \u2502   \u253C\n\t\t\t\t//                 \u2514\u2500\u2500\u2500\u2500\u2500\u252C\u2518   \u2502\n\t\t\t\t//                       \u253C    \u2502\n\t\t\t\t//                   \u250C\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t\t\t\t//                   \u2502                \u2502  \u25C4\u2500\u2500\u2500\u2500  i'm dragging this one\n\t\t\t\t//                   \u2514\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\t\t\t\t//            \u2500\u2500\u2500\u2500\u2500\u25BA     \u253C    \u2502\n\t\t\t\t//                 \u250C\u2500\u2500\u2500\u2500\u2500\u2534\u2510   \u2502                don't show these\n\t\t\t\t// show these      \u2502      \u2502   \u253C                larger gaps since\n\t\t\t\t// smaller         \u2514\u2500\u2500\u2500\u2500\u2500\u252C\u2518   \u2502 \u25C4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 the smaller ones\n\t\t\t\t// gaps                  \u253C    \u2502                cover the same\n\t\t\t\t//              \u2500\u2500\u2500\u2500\u2500\u25BA  \u250C\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510          information\n\t\t\t\t//                      \u2502           \u2502\n\t\t\t\t//                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\t\t\t\t//\n\t\t\t\t// but we want to show all of these ones since the gap breadths don't overlap\n\t\t\t\t//            \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t\t\t\t//            \u2502             \u2502\n\t\t\t\t// \u250C\u2500\u2500\u2500\u2500\u2510     \u2514\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\t\t\t\t// \u2502    \u2502         \u2502\n\t\t\t\t// \u2514\u2500\u2500\u252C\u2500\u2518         \u253C\n\t\t\t\t//    \u253C           \u2502\n\t\t\t\t// \u250C\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2510\n\t\t\t\t// \u2502                \u2502 \u25C4\u2500\u2500\u2500\u2500\u2500 i'm dragging this one\n\t\t\t\t// \u2514\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2518\n\t\t\t\t//    \u253C           \u2502\n\t\t\t\t// \u250C\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510      \u253C\n\t\t\t\t// \u2502       \u2502      \u2502\n\t\t\t\t// \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u250C\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t\t\t\t//              \u2502         \u2502\n\t\t\t\t//              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\t\t\t\tconst otherCenterSnap = nearestSnapsX.find(({ type }) => type === 'gap_center') as\n\t\t\t\t\t| Extract<NearestSnap, { type: 'gap_center' }>\n\t\t\t\t\t| undefined\n\n\t\t\t\tconst gapBreadthsOverlap =\n\t\t\t\t\totherCenterSnap &&\n\t\t\t\t\trangeIntersection(\n\t\t\t\t\t\tgap.breadthIntersection[0],\n\t\t\t\t\t\tgap.breadthIntersection[1],\n\t\t\t\t\t\totherCenterSnap.gap.breadthIntersection[0],\n\t\t\t\t\t\totherCenterSnap.gap.breadthIntersection[1]\n\t\t\t\t\t)\n\n\t\t\t\t// if there is another center snap and it's bigger than this one, and it overlaps with this one, replace it\n\t\t\t\tif (otherCenterSnap && otherCenterSnap.gap.length > gap.length && gapBreadthsOverlap) {\n\t\t\t\t\tnearestSnapsX[nearestSnapsX.indexOf(otherCenterSnap)] = snap\n\t\t\t\t} else if (!otherCenterSnap || !gapBreadthsOverlap) {\n\t\t\t\t\tnearestSnapsX.push(snap)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// check for duplication left match\n\t\t\tconst duplicationLeftX = gap.startNode.pageBounds.minX - gap.length\n\t\t\tconst selectionRightX = selectionPageBounds.maxX\n\n\t\t\tconst duplicationLeftNudge = duplicationLeftX - selectionRightX\n\t\t\tif (round(Math.abs(duplicationLeftNudge)) <= round(minOffset.x)) {\n\t\t\t\tif (round(Math.abs(duplicationLeftNudge)) < round(minOffset.x)) {\n\t\t\t\t\t// reset if we found a closer snap\n\t\t\t\t\tnearestSnapsX.length = 0\n\t\t\t\t}\n\t\t\t\tminOffset.x = Math.abs(duplicationLeftNudge)\n\n\t\t\t\tnearestSnapsX.push({\n\t\t\t\t\ttype: 'gap_duplicate',\n\t\t\t\t\tgap,\n\t\t\t\t\tprotrusionDirection: 'left',\n\t\t\t\t\tnudge: duplicationLeftNudge,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\t// check for duplication right match\n\t\t\tconst duplicationRightX = gap.endNode.pageBounds.maxX + gap.length\n\t\t\tconst selectionLeftX = selectionPageBounds.minX\n\n\t\t\tconst duplicationRightNudge = duplicationRightX - selectionLeftX\n\t\t\tif (round(Math.abs(duplicationRightNudge)) <= round(minOffset.x)) {\n\t\t\t\tif (round(Math.abs(duplicationRightNudge)) < round(minOffset.x)) {\n\t\t\t\t\t// reset if we found a closer snap\n\t\t\t\t\tnearestSnapsX.length = 0\n\t\t\t\t}\n\t\t\t\tminOffset.x = Math.abs(duplicationRightNudge)\n\n\t\t\t\tnearestSnapsX.push({\n\t\t\t\t\ttype: 'gap_duplicate',\n\t\t\t\t\tgap,\n\t\t\t\t\tprotrusionDirection: 'right',\n\t\t\t\t\tnudge: duplicationRightNudge,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tfor (const gap of vertical) {\n\t\t\t// ignore this gap if the selection doesn't overlap with it in the y axis\n\t\t\tif (\n\t\t\t\t!rangesOverlap(\n\t\t\t\t\tgap.breadthIntersection[0],\n\t\t\t\t\tgap.breadthIntersection[1],\n\t\t\t\t\tselectionPageBounds.minX,\n\t\t\t\t\tselectionPageBounds.maxX\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// check for center match\n\t\t\tconst gapMidY = gap.startEdge[0].y + gap.length / 2\n\t\t\tconst centerNudge = gapMidY - selectionPageBounds.center.y\n\n\t\t\tconst gapIsLargerThanSelection = gap.length > selectionPageBounds.height\n\n\t\t\tif (gapIsLargerThanSelection && round(Math.abs(centerNudge)) <= round(minOffset.y)) {\n\t\t\t\tif (round(Math.abs(centerNudge)) < round(minOffset.y)) {\n\t\t\t\t\t// reset if we found a closer snap\n\t\t\t\t\tnearestSnapsY.length = 0\n\t\t\t\t}\n\t\t\t\tminOffset.y = Math.abs(centerNudge)\n\n\t\t\t\tconst snap: NearestSnap = {\n\t\t\t\t\ttype: 'gap_center',\n\t\t\t\t\tgap,\n\t\t\t\t\tnudge: centerNudge,\n\t\t\t\t}\n\n\t\t\t\t// we need to avoid creating visual noise with too many center snaps in situations\n\t\t\t\t// where there are lots of adjacent items with even spacing\n\t\t\t\t// so let's only show other center snaps where the gap's breadth does not overlap with this one\n\t\t\t\t// i.e.\n\t\t\t\t//                \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t\t\t\t//                \u2502               \u2502\n\t\t\t\t//                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2518\n\t\t\t\t//                       \u253C    \u2502\n\t\t\t\t//                 \u250C\u2500\u2500\u2500\u2500\u2500\u2534\u2510   \u2502\n\t\t\t\t//                 \u2502      \u2502   \u253C\n\t\t\t\t//                 \u2514\u2500\u2500\u2500\u2500\u2500\u252C\u2518   \u2502\n\t\t\t\t//                       \u253C    \u2502\n\t\t\t\t//                   \u250C\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t\t\t\t//                   \u2502                \u2502  \u25C4\u2500\u2500\u2500\u2500  i'm dragging this one\n\t\t\t\t//                   \u2514\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\t\t\t\t//            \u2500\u2500\u2500\u2500\u2500\u25BA     \u253C    \u2502\n\t\t\t\t//                 \u250C\u2500\u2500\u2500\u2500\u2500\u2534\u2510   \u2502                don't show these\n\t\t\t\t// show these      \u2502      \u2502   \u253C                larger gaps since\n\t\t\t\t// smaller         \u2514\u2500\u2500\u2500\u2500\u2500\u252C\u2518   \u2502 \u25C4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 the smaller ones\n\t\t\t\t// gaps                  \u253C    \u2502                cover the same\n\t\t\t\t//              \u2500\u2500\u2500\u2500\u2500\u25BA  \u250C\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510          information\n\t\t\t\t//                      \u2502           \u2502\n\t\t\t\t//                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\t\t\t\t//\n\t\t\t\t// but we want to show all of these ones since the gap breadths don't overlap\n\t\t\t\t//            \u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t\t\t\t//            \u2502             \u2502\n\t\t\t\t// \u250C\u2500\u2500\u2500\u2500\u2510     \u2514\u2500\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\t\t\t\t// \u2502    \u2502         \u2502\n\t\t\t\t// \u2514\u2500\u2500\u252C\u2500\u2518         \u253C\n\t\t\t\t//    \u253C           \u2502\n\t\t\t\t// \u250C\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2510\n\t\t\t\t// \u2502                \u2502 \u25C4\u2500\u2500\u2500\u2500\u2500 i'm dragging this one\n\t\t\t\t// \u2514\u2500\u2500\u252C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252C\u2500\u2518\n\t\t\t\t//    \u253C           \u2502\n\t\t\t\t// \u250C\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510      \u253C\n\t\t\t\t// \u2502       \u2502      \u2502\n\t\t\t\t// \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u250C\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\t\t\t\t//              \u2502         \u2502\n\t\t\t\t//              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\t\t\t\tconst otherCenterSnap = nearestSnapsY.find(({ type }) => type === 'gap_center') as\n\t\t\t\t\t| Extract<NearestSnap, { type: 'gap_center' }>\n\t\t\t\t\t| undefined\n\n\t\t\t\tconst gapBreadthsOverlap =\n\t\t\t\t\totherCenterSnap &&\n\t\t\t\t\trangesOverlap(\n\t\t\t\t\t\totherCenterSnap.gap.breadthIntersection[0],\n\t\t\t\t\t\totherCenterSnap.gap.breadthIntersection[1],\n\t\t\t\t\t\tgap.breadthIntersection[0],\n\t\t\t\t\t\tgap.breadthIntersection[1]\n\t\t\t\t\t)\n\n\t\t\t\t// if there is another center snap and it's bigger than this one, and it overlaps with this one, replace it\n\t\t\t\tif (otherCenterSnap && otherCenterSnap.gap.length > gap.length && gapBreadthsOverlap) {\n\t\t\t\t\tnearestSnapsY[nearestSnapsY.indexOf(otherCenterSnap)] = snap\n\t\t\t\t} else if (!otherCenterSnap || !gapBreadthsOverlap) {\n\t\t\t\t\tnearestSnapsY.push(snap)\n\t\t\t\t}\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// check for duplication top match\n\t\t\tconst duplicationTopY = gap.startNode.pageBounds.minY - gap.length\n\t\t\tconst selectionBottomY = selectionPageBounds.maxY\n\n\t\t\tconst duplicationTopNudge = duplicationTopY - selectionBottomY\n\t\t\tif (round(Math.abs(duplicationTopNudge)) <= round(minOffset.y)) {\n\t\t\t\tif (round(Math.abs(duplicationTopNudge)) < round(minOffset.y)) {\n\t\t\t\t\t// reset if we found a closer snap\n\t\t\t\t\tnearestSnapsY.length = 0\n\t\t\t\t}\n\t\t\t\tminOffset.y = Math.abs(duplicationTopNudge)\n\n\t\t\t\tnearestSnapsY.push({\n\t\t\t\t\ttype: 'gap_duplicate',\n\t\t\t\t\tgap,\n\t\t\t\t\tprotrusionDirection: 'top',\n\t\t\t\t\tnudge: duplicationTopNudge,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\t// check for duplication bottom match\n\t\t\tconst duplicationBottomY = gap.endNode.pageBounds.maxY + gap.length\n\t\t\tconst selectionTopY = selectionPageBounds.minY\n\n\t\t\tconst duplicationBottomNudge = duplicationBottomY - selectionTopY\n\t\t\tif (round(Math.abs(duplicationBottomNudge)) <= round(minOffset.y)) {\n\t\t\t\tif (round(Math.abs(duplicationBottomNudge)) < round(minOffset.y)) {\n\t\t\t\t\t// reset if we found a closer snap\n\t\t\t\t\tnearestSnapsY.length = 0\n\t\t\t\t}\n\t\t\t\tminOffset.y = Math.abs(duplicationBottomNudge)\n\n\t\t\t\tnearestSnapsY.push({\n\t\t\t\t\ttype: 'gap_duplicate',\n\t\t\t\t\tgap,\n\t\t\t\t\tprotrusionDirection: 'bottom',\n\t\t\t\t\tnudge: duplicationBottomNudge,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getPointSnapLines({\n\t\tnearestSnapsX,\n\t\tnearestSnapsY,\n\t}: {\n\t\tnearestSnapsX: NearestSnap[]\n\t\tnearestSnapsY: NearestSnap[]\n\t}): PointsSnapIndicator[] {\n\t\t// point snaps may align on multiple parallel lines so we need to split the pairs\n\t\t// into groups based on where they are in their their snap axes\n\t\tconst snapGroupsX = {} as { [key: string]: SnapPair[] }\n\t\tconst snapGroupsY = {} as { [key: string]: SnapPair[] }\n\n\t\tif (nearestSnapsX.length > 0) {\n\t\t\tfor (const snap of nearestSnapsX) {\n\t\t\t\tif (snap.type === 'points') {\n\t\t\t\t\tconst key = round(snap.points.otherPoint.x)\n\t\t\t\t\tif (!snapGroupsX[key]) {\n\t\t\t\t\t\tsnapGroupsX[key] = []\n\t\t\t\t\t}\n\t\t\t\t\tsnapGroupsX[key].push(snap.points)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (nearestSnapsY.length > 0) {\n\t\t\tfor (const snap of nearestSnapsY) {\n\t\t\t\tif (snap.type === 'points') {\n\t\t\t\t\tconst key = round(snap.points.otherPoint.y)\n\t\t\t\t\tif (!snapGroupsY[key]) {\n\t\t\t\t\t\tsnapGroupsY[key] = []\n\t\t\t\t\t}\n\t\t\t\t\tsnapGroupsY[key].push(snap.points)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// and finally create all the snap lines for the UI to render\n\t\treturn Object.values(snapGroupsX)\n\t\t\t.concat(Object.values(snapGroupsY))\n\t\t\t.map((snapGroup) => ({\n\t\t\t\tid: uniqueId(),\n\t\t\t\ttype: 'points',\n\t\t\t\tpoints: dedupe(\n\t\t\t\t\tsnapGroup\n\t\t\t\t\t\t.map((snap) => Vec.From(snap.otherPoint))\n\t\t\t\t\t\t// be sure to nudge over the selection snap points\n\t\t\t\t\t\t.concat(snapGroup.map((snap) => Vec.From(snap.thisPoint))),\n\t\t\t\t\t(a: Vec, b: Vec) => a.equals(b)\n\t\t\t\t),\n\t\t\t}))\n\t}\n\n\tprivate getGapSnapLines({\n\t\tselectionPageBounds,\n\t\tnearestSnapsX,\n\t\tnearestSnapsY,\n\t}: {\n\t\tselectionPageBounds: Box\n\t\tnearestSnapsX: NearestSnap[]\n\t\tnearestSnapsY: NearestSnap[]\n\t}): GapsSnapIndicator[] {\n\t\tconst { vertical, horizontal } = this.getVisibleGaps()\n\n\t\tconst selectionSides: Record<SelectionEdge, [Vec, Vec]> = {\n\t\t\ttop: selectionPageBounds.sides[0],\n\t\t\tright: selectionPageBounds.sides[1],\n\t\t\t// need bottom and left to be sorted asc, which .sides is not.\n\t\t\tbottom: [selectionPageBounds.corners[3], selectionPageBounds.corners[2]],\n\t\t\tleft: [selectionPageBounds.corners[0], selectionPageBounds.corners[3]],\n\t\t}\n\n\t\tconst result: GapsSnapIndicator[] = []\n\n\t\tif (nearestSnapsX.length > 0) {\n\t\t\tfor (const snap of nearestSnapsX) {\n\t\t\t\tif (snap.type === 'points') continue\n\n\t\t\t\tconst {\n\t\t\t\t\tgap: { breadthIntersection, startEdge, startNode, endNode, length, endEdge },\n\t\t\t\t} = snap\n\n\t\t\t\tswitch (snap.type) {\n\t\t\t\t\tcase 'gap_center': {\n\t\t\t\t\t\t// create\n\t\t\t\t\t\tconst newGapsLength = (length - selectionPageBounds.width) / 2\n\t\t\t\t\t\tconst gapBreadthIntersection = rangeIntersection(\n\t\t\t\t\t\t\tbreadthIntersection[0],\n\t\t\t\t\t\t\tbreadthIntersection[1],\n\t\t\t\t\t\t\tselectionPageBounds.minY,\n\t\t\t\t\t\t\tselectionPageBounds.maxY\n\t\t\t\t\t\t)!\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\ttype: 'gaps',\n\t\t\t\t\t\t\tdirection: 'horizontal',\n\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\tgaps: [\n\t\t\t\t\t\t\t\t...findAdjacentGaps(\n\t\t\t\t\t\t\t\t\thorizontal,\n\t\t\t\t\t\t\t\t\tstartNode.id,\n\t\t\t\t\t\t\t\t\tnewGapsLength,\n\t\t\t\t\t\t\t\t\t'backward',\n\t\t\t\t\t\t\t\t\tgapBreadthIntersection\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstartEdge,\n\t\t\t\t\t\t\t\t\tendEdge: selectionSides.left,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstartEdge: selectionSides.right,\n\t\t\t\t\t\t\t\t\tendEdge,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t...findAdjacentGaps(\n\t\t\t\t\t\t\t\t\thorizontal,\n\t\t\t\t\t\t\t\t\tendNode.id,\n\t\t\t\t\t\t\t\t\tnewGapsLength,\n\t\t\t\t\t\t\t\t\t'forward',\n\t\t\t\t\t\t\t\t\tgapBreadthIntersection\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t})\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'gap_duplicate': {\n\t\t\t\t\t\t// create\n\t\t\t\t\t\tconst gapBreadthIntersection = rangeIntersection(\n\t\t\t\t\t\t\tbreadthIntersection[0],\n\t\t\t\t\t\t\tbreadthIntersection[1],\n\t\t\t\t\t\t\tselectionPageBounds.minY,\n\t\t\t\t\t\t\tselectionPageBounds.maxY\n\t\t\t\t\t\t)!\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\ttype: 'gaps',\n\t\t\t\t\t\t\tdirection: 'horizontal',\n\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\tgaps:\n\t\t\t\t\t\t\t\tsnap.protrusionDirection === 'left'\n\t\t\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tstartEdge: selectionSides.right,\n\t\t\t\t\t\t\t\t\t\t\t\tendEdge: startEdge.map((v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tv.clone().addXY(-startNode.pageBounds.width, 0)\n\t\t\t\t\t\t\t\t\t\t\t\t) as [Vec, Vec],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t{ startEdge, endEdge },\n\t\t\t\t\t\t\t\t\t\t\t...findAdjacentGaps(\n\t\t\t\t\t\t\t\t\t\t\t\thorizontal,\n\t\t\t\t\t\t\t\t\t\t\t\tendNode.id,\n\t\t\t\t\t\t\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\t\t\t\t\t\t'forward',\n\t\t\t\t\t\t\t\t\t\t\t\tgapBreadthIntersection\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t: [\n\t\t\t\t\t\t\t\t\t\t\t...findAdjacentGaps(\n\t\t\t\t\t\t\t\t\t\t\t\thorizontal,\n\t\t\t\t\t\t\t\t\t\t\t\tstartNode.id,\n\t\t\t\t\t\t\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\t\t\t\t\t\t'backward',\n\t\t\t\t\t\t\t\t\t\t\t\tgapBreadthIntersection\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t{ startEdge, endEdge },\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tstartEdge: endEdge.map((v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tv.clone().addXY(snap.gap.endNode.pageBounds.width, 0)\n\t\t\t\t\t\t\t\t\t\t\t\t) as [Vec, Vec],\n\t\t\t\t\t\t\t\t\t\t\t\tendEdge: selectionSides.left,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (nearestSnapsY.length > 0) {\n\t\t\tfor (const snap of nearestSnapsY) {\n\t\t\t\tif (snap.type === 'points') continue\n\n\t\t\t\tconst {\n\t\t\t\t\tgap: { breadthIntersection, startEdge, startNode, endNode, length, endEdge },\n\t\t\t\t} = snap\n\n\t\t\t\tswitch (snap.type) {\n\t\t\t\t\tcase 'gap_center': {\n\t\t\t\t\t\tconst newGapsLength = (length - selectionPageBounds.height) / 2\n\t\t\t\t\t\tconst gapBreadthIntersection = rangeIntersection(\n\t\t\t\t\t\t\tbreadthIntersection[0],\n\t\t\t\t\t\t\tbreadthIntersection[1],\n\t\t\t\t\t\t\tselectionPageBounds.minX,\n\t\t\t\t\t\t\tselectionPageBounds.maxX\n\t\t\t\t\t\t)!\n\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\ttype: 'gaps',\n\t\t\t\t\t\t\tdirection: 'vertical',\n\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\tgaps: [\n\t\t\t\t\t\t\t\t...findAdjacentGaps(\n\t\t\t\t\t\t\t\t\tvertical,\n\t\t\t\t\t\t\t\t\tstartNode.id,\n\t\t\t\t\t\t\t\t\tnewGapsLength,\n\t\t\t\t\t\t\t\t\t'backward',\n\t\t\t\t\t\t\t\t\tgapBreadthIntersection\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstartEdge,\n\t\t\t\t\t\t\t\t\tendEdge: selectionSides.top,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstartEdge: selectionSides.bottom,\n\t\t\t\t\t\t\t\t\tendEdge,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t...findAdjacentGaps(\n\t\t\t\t\t\t\t\t\tvertical,\n\t\t\t\t\t\t\t\t\tsnap.gap.endNode.id,\n\t\t\t\t\t\t\t\t\tnewGapsLength,\n\t\t\t\t\t\t\t\t\t'forward',\n\t\t\t\t\t\t\t\t\tgapBreadthIntersection\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t})\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'gap_duplicate':\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst gapBreadthIntersection = rangeIntersection(\n\t\t\t\t\t\t\t\tbreadthIntersection[0],\n\t\t\t\t\t\t\t\tbreadthIntersection[1],\n\t\t\t\t\t\t\t\tselectionPageBounds.minX,\n\t\t\t\t\t\t\t\tselectionPageBounds.maxX\n\t\t\t\t\t\t\t)!\n\n\t\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\t\ttype: 'gaps',\n\t\t\t\t\t\t\t\tdirection: 'vertical',\n\t\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\t\tgaps:\n\t\t\t\t\t\t\t\t\tsnap.protrusionDirection === 'top'\n\t\t\t\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tstartEdge: selectionSides.bottom,\n\t\t\t\t\t\t\t\t\t\t\t\t\tendEdge: startEdge.map((v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.clone().addXY(0, -startNode.pageBounds.height)\n\t\t\t\t\t\t\t\t\t\t\t\t\t) as [Vec, Vec],\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t{ startEdge, endEdge },\n\t\t\t\t\t\t\t\t\t\t\t\t...findAdjacentGaps(\n\t\t\t\t\t\t\t\t\t\t\t\t\tvertical,\n\t\t\t\t\t\t\t\t\t\t\t\t\tendNode.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\t\t\t\t\t\t\t'forward',\n\t\t\t\t\t\t\t\t\t\t\t\t\tgapBreadthIntersection\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t: [\n\t\t\t\t\t\t\t\t\t\t\t\t...findAdjacentGaps(\n\t\t\t\t\t\t\t\t\t\t\t\t\tvertical,\n\t\t\t\t\t\t\t\t\t\t\t\t\tstartNode.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\t\t\t\t\t\t\t'backward',\n\t\t\t\t\t\t\t\t\t\t\t\t\tgapBreadthIntersection\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t{ startEdge, endEdge },\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tstartEdge: endEdge.map((v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.clone().addXY(0, endNode.pageBounds.height)\n\t\t\t\t\t\t\t\t\t\t\t\t\t) as [Vec, Vec],\n\t\t\t\t\t\t\t\t\t\t\t\t\tendEdge: selectionSides.top,\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdedupeGapSnaps(result)\n\t\treturn result\n\t}\n}\n\nfunction getResizeSnapPointsForHandle(\n\thandle: SelectionCorner | SelectionEdge | 'any',\n\tselectionPageBounds: Box\n): BoundsSnapPoint[] {\n\tconst { minX, maxX, minY, maxY } = selectionPageBounds\n\tconst result: BoundsSnapPoint[] = []\n\n\t// top left corner\n\tswitch (handle) {\n\t\tcase 'top':\n\t\tcase 'left':\n\t\tcase 'top_left':\n\t\tcase 'any':\n\t\t\tresult.push({\n\t\t\t\tid: 'top_left',\n\t\t\t\thandle: 'top_left',\n\t\t\t\tx: minX,\n\t\t\t\ty: minY,\n\t\t\t})\n\t}\n\n\t// top right corner\n\tswitch (handle) {\n\t\tcase 'top':\n\t\tcase 'right':\n\t\tcase 'top_right':\n\t\tcase 'any':\n\t\t\tresult.push({\n\t\t\t\tid: 'top_right',\n\t\t\t\thandle: 'top_right',\n\t\t\t\tx: maxX,\n\t\t\t\ty: minY,\n\t\t\t})\n\t}\n\n\t// bottom right corner\n\tswitch (handle) {\n\t\tcase 'bottom':\n\t\tcase 'right':\n\t\tcase 'bottom_right':\n\t\tcase 'any':\n\t\t\tresult.push({\n\t\t\t\tid: 'bottom_right',\n\t\t\t\thandle: 'bottom_right',\n\t\t\t\tx: maxX,\n\t\t\t\ty: maxY,\n\t\t\t})\n\t}\n\n\t// bottom left corner\n\tswitch (handle) {\n\t\tcase 'bottom':\n\t\tcase 'left':\n\t\tcase 'bottom_left':\n\t\tcase 'any':\n\t\t\tresult.push({\n\t\t\t\tid: 'bottom_left',\n\t\t\t\thandle: 'bottom_left',\n\t\t\t\tx: minX,\n\t\t\t\ty: maxY,\n\t\t\t})\n\t}\n\n\treturn result\n}\n", "import { computed } from '@tldraw/state'\nimport { TLHandle, TLShape, TLShapeId, VecModel } from '@tldraw/tlschema'\nimport { assertExists } from '@tldraw/utils'\nimport { Vec } from '../../../primitives/Vec'\nimport { Geometry2d } from '../../../primitives/geometry/Geometry2d'\nimport { uniqueId } from '../../../utils/uniqueId'\nimport { Editor } from '../../Editor'\nimport { SnapData, SnapManager } from './SnapManager'\n\n/**\n * When dragging a handle, users can snap the handle to key geometry on other nearby shapes.\n * Customize how handles snap to a shape by returning this from\n * {@link ShapeUtil.getHandleSnapGeometry}.\n *\n * Any co-ordinates here should be in the shape's local space.\n *\n * @public\n */\nexport interface HandleSnapGeometry {\n\t/**\n\t * A `Geometry2d` that describe the outline of the shape that the handle will snap to - fills\n\t * are ignored. By default, this is the same geometry returned by {@link ShapeUtil.getGeometry}.\n\t * Set this to `null` to disable handle snapping to this shape's outline.\n\t */\n\toutline?: Geometry2d | null\n\t/**\n\t * Key points on the shape that the handle will snap to. For example, the corners of a\n\t * rectangle, or the centroid of a triangle. By default, no points are used.\n\t */\n\tpoints?: VecModel[]\n\t/**\n\t * By default, handles can't snap to their own shape because moving the handle might change the\n\t * snapping location which can cause feedback loops. You can override this by returning a\n\t * version of `outline` that won't be affected by the current handle's position to use for\n\t * self-snapping.\n\t */\n\tgetSelfSnapOutline?(handle: TLHandle): Geometry2d | null\n\t/**\n\t * By default, handles can't snap to their own shape because moving the handle might change the\n\t * snapping location which can cause feedback loops. You can override this by returning a\n\t * version of `points` that won't be affected by the current handle's position to use for\n\t * self-snapping.\n\t */\n\tgetSelfSnapPoints?(handle: TLHandle): VecModel[]\n}\n\nconst defaultGetSelfSnapOutline = () => null\nconst defaultGetSelfSnapPoints = () => []\n\nexport class HandleSnaps {\n\treadonly editor: Editor\n\tconstructor(readonly manager: SnapManager) {\n\t\tthis.editor = manager.editor\n\t}\n\n\t@computed private getSnapGeometryCache() {\n\t\tconst { editor } = this\n\t\treturn editor.store.createComputedCache('handle snap geometry', (shape: TLShape) => {\n\t\t\tconst snapGeometry = editor.getShapeUtil(shape).getHandleSnapGeometry(shape)\n\n\t\t\treturn {\n\t\t\t\toutline:\n\t\t\t\t\tsnapGeometry.outline === undefined\n\t\t\t\t\t\t? editor.getShapeGeometry(shape)\n\t\t\t\t\t\t: snapGeometry.outline,\n\n\t\t\t\tpoints: snapGeometry.points ?? [],\n\t\t\t\tgetSelfSnapOutline: snapGeometry.getSelfSnapOutline ?? defaultGetSelfSnapOutline,\n\t\t\t\tgetSelfSnapPoints: snapGeometry.getSelfSnapPoints ?? defaultGetSelfSnapPoints,\n\t\t\t}\n\t\t})\n\t}\n\n\tprivate *iterateSnapPointsInPageSpace(currentShapeId: TLShapeId, currentHandle: TLHandle) {\n\t\tconst selfSnapPoints = this.getSnapGeometryCache()\n\t\t\t.get(currentShapeId)\n\t\t\t?.getSelfSnapPoints(currentHandle)\n\t\tif (selfSnapPoints && selfSnapPoints.length) {\n\t\t\tconst shapePageTransform = assertExists(this.editor.getShapePageTransform(currentShapeId))\n\t\t\tfor (const point of selfSnapPoints) {\n\t\t\t\tyield shapePageTransform.applyToPoint(point)\n\t\t\t}\n\t\t}\n\n\t\tfor (const shapeId of this.manager.getSnappableShapes()) {\n\t\t\tif (shapeId === currentShapeId) continue\n\t\t\tconst snapPoints = this.getSnapGeometryCache().get(shapeId)?.points\n\t\t\tif (!snapPoints || !snapPoints.length) continue\n\n\t\t\tconst shapePageTransform = assertExists(this.editor.getShapePageTransform(shapeId))\n\t\t\tfor (const point of snapPoints) {\n\t\t\t\tyield shapePageTransform.applyToPoint(point)\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate *iterateSnapOutlines(currentShapeId: TLShapeId, currentHandle: TLHandle) {\n\t\tconst selfSnapOutline = this.getSnapGeometryCache()\n\t\t\t.get(currentShapeId)\n\t\t\t?.getSelfSnapOutline(currentHandle)\n\t\tif (selfSnapOutline) {\n\t\t\tyield { shapeId: currentShapeId, outline: selfSnapOutline }\n\t\t}\n\n\t\tfor (const shapeId of this.manager.getSnappableShapes()) {\n\t\t\tif (shapeId === currentShapeId) continue\n\n\t\t\tconst snapOutline = this.getSnapGeometryCache().get(shapeId)?.outline\n\t\t\tif (!snapOutline) continue\n\n\t\t\tyield { shapeId, outline: snapOutline }\n\t\t}\n\t}\n\n\tprivate getHandleSnapPosition({\n\t\tcurrentShapeId,\n\t\thandle,\n\t\thandleInPageSpace,\n\t}: {\n\t\tcurrentShapeId: TLShapeId\n\t\thandle: TLHandle\n\t\thandleInPageSpace: Vec\n\t}): Vec | null {\n\t\tconst snapThreshold = this.manager.getSnapThreshold()\n\n\t\t// We snap to two different parts of the shape's handle snap geometry:\n\t\t// 1. The `points`. These are handles or other key points that we want to snap to with a\n\t\t//    higher priority than the normal outline snapping.\n\t\t// 2. The `outline`. This describes the outline of the shape, and we just snap to the\n\t\t//    nearest point on that outline.\n\n\t\t// Start with the points:\n\t\tlet minDistanceForSnapPoint = snapThreshold\n\t\tlet nearestSnapPoint: Vec | null = null\n\t\tfor (const snapPoint of this.iterateSnapPointsInPageSpace(currentShapeId, handle)) {\n\t\t\tif (Vec.DistMin(handleInPageSpace, snapPoint, minDistanceForSnapPoint)) {\n\t\t\t\tminDistanceForSnapPoint = Vec.Dist(handleInPageSpace, snapPoint)\n\t\t\t\tnearestSnapPoint = snapPoint\n\t\t\t}\n\t\t}\n\n\t\t// if we found a snap point, return it - we don't need to check the outlines because points\n\t\t// have a higher priority\n\t\tif (nearestSnapPoint) return nearestSnapPoint\n\n\t\tlet minDistanceForOutline = snapThreshold\n\t\tlet nearestPointOnOutline: Vec | null = null\n\n\t\tfor (const { shapeId, outline } of this.iterateSnapOutlines(currentShapeId, handle)) {\n\t\t\tconst shapePageTransform = assertExists(this.editor.getShapePageTransform(shapeId))\n\t\t\tconst pointInShapeSpace = this.editor.getPointInShapeSpace(shapeId, handleInPageSpace)\n\n\t\t\tconst nearestShapePointInShapeSpace = outline.nearestPoint(pointInShapeSpace)\n\t\t\tconst nearestInPageSpace = shapePageTransform.applyToPoint(nearestShapePointInShapeSpace)\n\n\t\t\tif (Vec.DistMin(handleInPageSpace, nearestInPageSpace, minDistanceForOutline)) {\n\t\t\t\tminDistanceForOutline = Vec.Dist(handleInPageSpace, nearestInPageSpace)\n\t\t\t\tnearestPointOnOutline = nearestInPageSpace\n\t\t\t}\n\t\t}\n\n\t\t// if we found a point on the outline, return it\n\t\tif (nearestPointOnOutline) return nearestPointOnOutline\n\n\t\t// if not, there's no nearby snap point\n\t\treturn null\n\t}\n\n\tsnapHandle({\n\t\tcurrentShapeId,\n\t\thandle,\n\t}: {\n\t\tcurrentShapeId: TLShapeId\n\t\thandle: TLHandle\n\t}): SnapData | null {\n\t\tconst currentShapeTransform = assertExists(this.editor.getShapePageTransform(currentShapeId))\n\t\tconst handleInPageSpace = currentShapeTransform.applyToPoint(handle)\n\t\tconst snapPosition = this.getHandleSnapPosition({ currentShapeId, handle, handleInPageSpace })\n\n\t\t// If we found a point, display snap lines, and return the nudge\n\t\tif (snapPosition) {\n\t\t\tthis.manager.setIndicators([\n\t\t\t\t{\n\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\ttype: 'points',\n\t\t\t\t\tpoints: [snapPosition],\n\t\t\t\t},\n\t\t\t])\n\n\t\t\treturn { nudge: Vec.Sub(snapPosition, handleInPageSpace) }\n\t\t}\n\n\t\treturn null\n\t}\n}\n", "import { EMPTY_ARRAY, atom, computed } from '@tldraw/state'\nimport { TLFrameShape, TLGroupShape, TLParentId, TLShapeId, isShapeId } from '@tldraw/tlschema'\nimport { Vec, VecLike } from '../../../primitives/Vec'\nimport type { Editor } from '../../Editor'\nimport { BoundsSnaps } from './BoundsSnaps'\nimport { HandleSnaps } from './HandleSnaps'\n\n/** @public */\nexport type PointsSnapIndicator = {\n\tid: string\n\ttype: 'points'\n\tpoints: VecLike[]\n}\n\n/** @public */\nexport type GapsSnapIndicator = {\n\tid: string\n\ttype: 'gaps'\n\tdirection: 'horizontal' | 'vertical'\n\tgaps: Array<{\n\t\tstartEdge: [VecLike, VecLike]\n\t\tendEdge: [VecLike, VecLike]\n\t}>\n}\n\n/** @public */\nexport type SnapIndicator = PointsSnapIndicator | GapsSnapIndicator\n\n/** @public */\nexport interface SnapData {\n\tnudge: Vec\n}\n\n/** @public */\nexport class SnapManager {\n\treadonly shapeBounds: BoundsSnaps\n\treadonly handles: HandleSnaps\n\n\tprivate _snapIndicators = atom<SnapIndicator[] | undefined>('snapLines', undefined)\n\n\tconstructor(public readonly editor: Editor) {\n\t\tthis.shapeBounds = new BoundsSnaps(this)\n\t\tthis.handles = new HandleSnaps(this)\n\t}\n\n\tgetIndicators() {\n\t\treturn this._snapIndicators.get() ?? (EMPTY_ARRAY as SnapIndicator[])\n\t}\n\n\tclearIndicators() {\n\t\tif (this.getIndicators().length) {\n\t\t\tthis._snapIndicators.set(undefined)\n\t\t}\n\t}\n\n\tsetIndicators(indicators: SnapIndicator[]) {\n\t\tthis._snapIndicators.set(indicators)\n\t}\n\n\t@computed getSnapThreshold() {\n\t\treturn 8 / this.editor.getZoomLevel()\n\t}\n\n\t// TODO: make this an incremental derivation\n\t@computed getSnappableShapes(): Set<TLShapeId> {\n\t\tconst { editor } = this\n\t\tconst renderingBounds = editor.getRenderingBounds()\n\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\n\t\tconst snappableShapes: Set<TLShapeId> = new Set()\n\n\t\tconst collectSnappableShapesFromParent = (parentId: TLParentId) => {\n\t\t\tif (isShapeId(parentId)) {\n\t\t\t\tconst parent = editor.getShape(parentId)\n\t\t\t\tif (parent && editor.isShapeOfType<TLFrameShape>(parent, 'frame')) {\n\t\t\t\t\tsnappableShapes.add(parentId)\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst sortedChildIds = editor.getSortedChildIdsForParent(parentId)\n\t\t\tfor (const childId of sortedChildIds) {\n\t\t\t\t// Skip any selected ids\n\t\t\t\tif (selectedShapeIds.includes(childId)) continue\n\t\t\t\tconst childShape = editor.getShape(childId)\n\t\t\t\tif (!childShape) continue\n\t\t\t\tconst util = editor.getShapeUtil(childShape)\n\t\t\t\t// Skip any shapes that don't allow snapping\n\t\t\t\tif (!util.canSnap(childShape)) continue\n\t\t\t\t// Only consider shapes if they're inside of the viewport page bounds\n\t\t\t\tconst pageBounds = editor.getShapePageBounds(childId)\n\t\t\t\tif (!(pageBounds && renderingBounds.includes(pageBounds))) continue\n\t\t\t\t// Snap to children of groups but not group itself\n\t\t\t\tif (editor.isShapeOfType<TLGroupShape>(childShape, 'group')) {\n\t\t\t\t\tcollectSnappableShapesFromParent(childId)\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tsnappableShapes.add(childId)\n\t\t\t}\n\t\t}\n\n\t\tcollectSnappableShapesFromParent(this.getCurrentCommonAncestor() ?? editor.getCurrentPageId())\n\n\t\treturn snappableShapes\n\t}\n\n\t// This needs to be external from any expensive work\n\t@computed getCurrentCommonAncestor() {\n\t\treturn this.editor.findCommonAncestor(this.editor.getSelectedShapes())\n\t}\n}\n", "import { BoxModel, TLDefaultHorizontalAlignStyle } from '@tldraw/tlschema'\nimport { Editor } from '../Editor'\n\nconst fixNewLines = /\\r?\\n|\\r/g\n\nfunction normalizeTextForDom(text: string) {\n\treturn text\n\t\t.replace(fixNewLines, '\\n')\n\t\t.split('\\n')\n\t\t.map((x) => x || ' ')\n\t\t.join('\\n')\n}\n\nconst textAlignmentsForLtr = {\n\tstart: 'left',\n\t'start-legacy': 'left',\n\tmiddle: 'center',\n\t'middle-legacy': 'center',\n\tend: 'right',\n\t'end-legacy': 'right',\n}\n\ntype TLOverflowMode = 'wrap' | 'truncate-ellipsis' | 'truncate-clip'\ntype TLMeasureTextSpanOpts = {\n\toverflow: TLOverflowMode\n\twidth: number\n\theight: number\n\tpadding: number\n\tfontSize: number\n\tfontWeight: string\n\tfontFamily: string\n\tfontStyle: string\n\tlineHeight: number\n\ttextAlign: TLDefaultHorizontalAlignStyle\n}\n\nconst spaceCharacterRegex = /\\s/\n\nexport class TextManager {\n\tbaseElm: HTMLDivElement\n\n\tconstructor(public editor: Editor) {\n\t\tconst container = this.editor.getContainer()\n\n\t\t// Remove any existing text measure element that\n\t\t// is a descendant of this editor's container\n\t\tcontainer.querySelector('#tldraw_text_measure')?.remove()\n\n\t\tconst elm = document.createElement('div')\n\t\telm.id = `tldraw_text_measure`\n\t\telm.classList.add('tl-text')\n\t\telm.classList.add('tl-text-measure')\n\t\telm.tabIndex = -1\n\t\tcontainer.appendChild(elm)\n\n\t\tthis.baseElm = elm\n\t}\n\n\tmeasureText = (\n\t\ttextToMeasure: string,\n\t\topts: {\n\t\t\tfontStyle: string\n\t\t\tfontWeight: string\n\t\t\tfontFamily: string\n\t\t\tfontSize: number\n\t\t\tlineHeight: number\n\t\t\t/**\n\t\t\t * When maxWidth is a number, the text will be wrapped to that maxWidth. When maxWidth\n\t\t\t * is null, the text will be measured without wrapping, but explicit line breaks and\n\t\t\t * space are preserved.\n\t\t\t */\n\t\t\tmaxWidth: null | number\n\t\t\tminWidth?: null | number\n\t\t\tpadding: string\n\t\t\tdisableOverflowWrapBreaking?: boolean\n\t\t}\n\t): BoxModel & { scrollWidth: number } => {\n\t\t// Duplicate our base element; we don't need to clone deep\n\t\tconst elm = this.baseElm?.cloneNode() as HTMLDivElement\n\t\tthis.baseElm.insertAdjacentElement('afterend', elm)\n\n\t\telm.setAttribute('dir', 'ltr')\n\t\telm.style.setProperty('font-family', opts.fontFamily)\n\t\telm.style.setProperty('font-style', opts.fontStyle)\n\t\telm.style.setProperty('font-weight', opts.fontWeight)\n\t\telm.style.setProperty('font-size', opts.fontSize + 'px')\n\t\telm.style.setProperty('line-height', opts.lineHeight * opts.fontSize + 'px')\n\t\telm.style.setProperty('max-width', opts.maxWidth === null ? null : opts.maxWidth + 'px')\n\t\telm.style.setProperty('min-width', opts.minWidth === null ? null : opts.minWidth + 'px')\n\t\telm.style.setProperty('padding', opts.padding)\n\t\telm.style.setProperty(\n\t\t\t'overflow-wrap',\n\t\t\topts.disableOverflowWrapBreaking ? 'normal' : 'break-word'\n\t\t)\n\n\t\telm.textContent = normalizeTextForDom(textToMeasure)\n\t\tconst scrollWidth = elm.scrollWidth\n\t\tconst rect = elm.getBoundingClientRect()\n\t\telm.remove()\n\n\t\treturn {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tw: rect.width,\n\t\t\th: rect.height,\n\t\t\tscrollWidth,\n\t\t}\n\t}\n\n\t/**\n\t * Given an html element, measure the position of each span of unbroken\n\t * word/white-space characters within any text nodes it contains.\n\t */\n\tmeasureElementTextNodeSpans(\n\t\telement: HTMLElement,\n\t\t{ shouldTruncateToFirstLine = false }: { shouldTruncateToFirstLine?: boolean } = {}\n\t): { spans: { box: BoxModel; text: string }[]; didTruncate: boolean } {\n\t\tconst spans = []\n\n\t\t// Measurements of individual spans are relative to the containing element\n\t\tconst elmBounds = element.getBoundingClientRect()\n\t\tconst offsetX = -elmBounds.left\n\t\tconst offsetY = -elmBounds.top\n\n\t\t// we measure by creating a range that spans each character in the elements text node\n\t\tconst range = new Range()\n\t\tconst textNode = element.childNodes[0]\n\t\tlet idx = 0\n\n\t\tlet currentSpan = null\n\t\tlet prevCharWasSpaceCharacter = null\n\t\tlet prevCharTop = 0\n\t\tlet didTruncate = false\n\t\tfor (const childNode of element.childNodes) {\n\t\t\tif (childNode.nodeType !== Node.TEXT_NODE) continue\n\n\t\t\tfor (const char of childNode.textContent ?? '') {\n\t\t\t\t// place the range around the characters we're interested in\n\t\t\t\trange.setStart(textNode, idx)\n\t\t\t\trange.setEnd(textNode, idx + char.length)\n\t\t\t\t// measure the range. some browsers return multiple rects for the\n\t\t\t\t// first char in a new line - one for the line break, and one for\n\t\t\t\t// the character itself. we're only interested in the character.\n\t\t\t\tconst rects = range.getClientRects()\n\t\t\t\tconst rect = rects[rects.length - 1]!\n\n\t\t\t\t// calculate the position of the character relative to the element\n\t\t\t\tconst top = rect.top + offsetY\n\t\t\t\tconst left = rect.left + offsetX\n\t\t\t\tconst right = rect.right + offsetX\n\n\t\t\t\tconst isSpaceCharacter = spaceCharacterRegex.test(char)\n\t\t\t\tif (\n\t\t\t\t\t// If we're at a word boundary...\n\t\t\t\t\tisSpaceCharacter !== prevCharWasSpaceCharacter ||\n\t\t\t\t\t// ...or we're on a different line...\n\t\t\t\t\ttop !== prevCharTop ||\n\t\t\t\t\t// ...or we're at the start of the text and haven't created a span yet...\n\t\t\t\t\t!currentSpan\n\t\t\t\t) {\n\t\t\t\t\t// ...then we're at a span boundary!\n\n\t\t\t\t\tif (currentSpan) {\n\t\t\t\t\t\t// if we're truncating to a single line & we just finished the first line, stop there\n\t\t\t\t\t\tif (shouldTruncateToFirstLine && top !== prevCharTop) {\n\t\t\t\t\t\t\tdidTruncate = true\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// otherwise add the span to the list ready to start a new one\n\t\t\t\t\t\tspans.push(currentSpan)\n\t\t\t\t\t}\n\n\t\t\t\t\t// start a new span\n\t\t\t\t\tcurrentSpan = {\n\t\t\t\t\t\tbox: { x: left, y: top, w: rect.width, h: rect.height },\n\t\t\t\t\t\ttext: char,\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// otherwise we just need to extend the current span with the next character\n\t\t\t\t\tcurrentSpan.box.w = right - currentSpan.box.x\n\t\t\t\t\tcurrentSpan.text += char\n\t\t\t\t}\n\n\t\t\t\tprevCharWasSpaceCharacter = isSpaceCharacter\n\t\t\t\tprevCharTop = top\n\t\t\t\tidx += char.length\n\t\t\t}\n\t\t}\n\n\t\t// Add the last span\n\t\tif (currentSpan) {\n\t\t\tspans.push(currentSpan)\n\t\t}\n\n\t\treturn { spans, didTruncate }\n\t}\n\n\t/**\n\t * Measure text into individual spans. Spans are created by rendering the\n\t * text, then dividing it up according to line breaks and word boundaries.\n\t *\n\t * It works by having the browser render the text, then measuring the\n\t * position of each character. You can use this to replicate the text-layout\n\t * algorithm of the current browser in e.g. an SVG export.\n\t */\n\tmeasureTextSpans(\n\t\ttextToMeasure: string,\n\t\topts: TLMeasureTextSpanOpts\n\t): { text: string; box: BoxModel }[] {\n\t\tif (textToMeasure === '') return []\n\n\t\tconst elm = this.baseElm?.cloneNode() as HTMLDivElement\n\t\tthis.baseElm.insertAdjacentElement('afterend', elm)\n\n\t\tconst elementWidth = Math.ceil(opts.width - opts.padding * 2)\n\t\telm.style.setProperty('width', `${elementWidth}px`)\n\t\telm.style.setProperty('height', 'min-content')\n\t\telm.style.setProperty('dir', 'ltr')\n\t\telm.style.setProperty('font-size', `${opts.fontSize}px`)\n\t\telm.style.setProperty('font-family', opts.fontFamily)\n\t\telm.style.setProperty('font-weight', opts.fontWeight)\n\t\telm.style.setProperty('line-height', `${opts.lineHeight * opts.fontSize}px`)\n\t\telm.style.setProperty('text-align', textAlignmentsForLtr[opts.textAlign])\n\n\t\tconst shouldTruncateToFirstLine =\n\t\t\topts.overflow === 'truncate-ellipsis' || opts.overflow === 'truncate-clip'\n\n\t\tif (shouldTruncateToFirstLine) {\n\t\t\telm.style.setProperty('overflow-wrap', 'anywhere')\n\t\t\telm.style.setProperty('word-break', 'break-all')\n\t\t}\n\n\t\tconst normalizedText = normalizeTextForDom(textToMeasure)\n\n\t\t// Render the text into the measurement element:\n\t\telm.textContent = normalizedText\n\n\t\t// actually measure the text:\n\t\tconst { spans, didTruncate } = this.measureElementTextNodeSpans(elm, {\n\t\t\tshouldTruncateToFirstLine,\n\t\t})\n\n\t\tif (opts.overflow === 'truncate-ellipsis' && didTruncate) {\n\t\t\t// we need to measure the ellipsis to know how much space it takes up\n\t\t\telm.textContent = '\u2026'\n\t\t\tconst ellipsisWidth = Math.ceil(this.measureElementTextNodeSpans(elm).spans[0].box.w)\n\n\t\t\t// then, we need to subtract that space from the width we have and measure again:\n\t\t\telm.style.setProperty('width', `${elementWidth - ellipsisWidth}px`)\n\t\t\telm.textContent = normalizedText\n\t\t\tconst truncatedSpans = this.measureElementTextNodeSpans(elm, {\n\t\t\t\tshouldTruncateToFirstLine: true,\n\t\t\t}).spans\n\n\t\t\t// Finally, we add in our ellipsis at the end of the last span. We\n\t\t\t// have to do this after measuring, not before, because adding the\n\t\t\t// ellipsis changes how whitespace might be getting collapsed by the\n\t\t\t// browser.\n\t\t\tconst lastSpan = truncatedSpans[truncatedSpans.length - 1]!\n\t\t\ttruncatedSpans.push({\n\t\t\t\ttext: '\u2026',\n\t\t\t\tbox: {\n\t\t\t\t\tx: Math.min(lastSpan.box.x + lastSpan.box.w, opts.width - opts.padding - ellipsisWidth),\n\t\t\t\t\ty: lastSpan.box.y,\n\t\t\t\t\tw: ellipsisWidth,\n\t\t\t\t\th: lastSpan.box.h,\n\t\t\t\t},\n\t\t\t})\n\t\t\treturn truncatedSpans\n\t\t}\n\n\t\telm.remove()\n\n\t\treturn spans\n\t}\n}\n", "import { throttleToNextFrame as _throttleToNextFrame } from '@tldraw/utils'\nimport { Vec } from '../../primitives/Vec'\nimport { Editor } from '../Editor'\n\nconst throttleToNextFrame =\n\ttypeof process !== 'undefined' && process.env.NODE_ENV === 'test'\n\t\t? // At test time we should use actual raf and not throttle, because throttle was set up to evaluate immediately during tests, which causes stack overflow\n\t\t\t// for the tick manager since it sets up a raf loop.\n\t\t\tfunction mockThrottle(cb: any) {\n\t\t\t\tconst frame = requestAnimationFrame(cb)\n\t\t\t\treturn () => cancelAnimationFrame(frame)\n\t\t\t}\n\t\t: _throttleToNextFrame\n\nexport class TickManager {\n\tconstructor(public editor: Editor) {\n\t\tthis.editor.disposables.add(this.dispose)\n\t\tthis.start()\n\t}\n\n\tcancelRaf?: null | (() => void)\n\tisPaused = true\n\tnow = 0\n\n\tstart = () => {\n\t\tthis.isPaused = false\n\t\tthis.cancelRaf?.()\n\t\tthis.cancelRaf = throttleToNextFrame(this.tick)\n\t\tthis.now = Date.now()\n\t}\n\n\ttick = () => {\n\t\tif (this.isPaused) {\n\t\t\treturn\n\t\t}\n\n\t\tconst now = Date.now()\n\t\tconst elapsed = now - this.now\n\t\tthis.now = now\n\n\t\tthis.updatePointerVelocity(elapsed)\n\t\tthis.editor.emit('frame', elapsed)\n\t\tthis.editor.emit('tick', elapsed)\n\t\tthis.cancelRaf = throttleToNextFrame(this.tick)\n\t}\n\n\t// Clear the listener\n\tdispose = () => {\n\t\tthis.isPaused = true\n\n\t\tthis.cancelRaf?.()\n\t}\n\n\tprivate prevPoint = new Vec()\n\n\tprivate updatePointerVelocity = (elapsed: number) => {\n\t\tconst {\n\t\t\tprevPoint,\n\t\t\teditor: {\n\t\t\t\tinputs: { currentScreenPoint, pointerVelocity },\n\t\t\t},\n\t\t} = this\n\n\t\tif (elapsed === 0) return\n\n\t\tconst delta = Vec.Sub(currentScreenPoint, prevPoint)\n\t\tthis.prevPoint = currentScreenPoint.clone()\n\n\t\tconst length = delta.len()\n\t\tconst direction = length ? delta.div(length) : new Vec(0, 0)\n\n\t\t// consider adjusting this with an easing rather than a linear interpolation\n\t\tconst next = pointerVelocity.clone().lrp(direction.mul(length / elapsed), 0.5)\n\n\t\t// if the velocity is very small, just set it to 0\n\t\tif (Math.abs(next.x) < 0.01) next.x = 0\n\t\tif (Math.abs(next.y) < 0.01) next.y = 0\n\n\t\tif (!pointerVelocity.equals(next)) {\n\t\t\tthis.editor.inputs.pointerVelocity = next\n\t\t}\n\t}\n}\n", "import { computed } from '@tldraw/state'\nimport {\n\tTLUserPreferences,\n\tdefaultUserPreferences,\n\tuserPrefersDarkUI,\n} from '../../config/TLUserPreferences'\nimport { TLUser } from '../../config/createTLUser'\n\nexport class UserPreferencesManager {\n\tconstructor(\n\t\tprivate readonly user: TLUser,\n\t\tprivate readonly inferDarkMode: boolean\n\t) {}\n\n\tupdateUserPreferences = (userPreferences: Partial<TLUserPreferences>) => {\n\t\tthis.user.setUserPreferences({\n\t\t\t...this.user.userPreferences.get(),\n\t\t\t...userPreferences,\n\t\t})\n\t}\n\t@computed getUserPreferences() {\n\t\treturn {\n\t\t\tid: this.getId(),\n\t\t\tname: this.getName(),\n\t\t\tlocale: this.getLocale(),\n\t\t\tcolor: this.getColor(),\n\t\t\tanimationSpeed: this.getAnimationSpeed(),\n\t\t\tisSnapMode: this.getIsSnapMode(),\n\t\t\tisDarkMode: this.getIsDarkMode(),\n\t\t\tisWrapMode: this.getIsWrapMode(),\n\t\t}\n\t}\n\t@computed getIsDarkMode() {\n\t\treturn (\n\t\t\tthis.user.userPreferences.get().isDarkMode ??\n\t\t\t(this.inferDarkMode ? userPrefersDarkUI() : false)\n\t\t)\n\t}\n\n\t/**\n\t * The speed at which the user can scroll by dragging toward the edge of the screen.\n\t */\n\t@computed getEdgeScrollSpeed() {\n\t\treturn this.user.userPreferences.get().edgeScrollSpeed ?? defaultUserPreferences.edgeScrollSpeed\n\t}\n\n\t@computed getAnimationSpeed() {\n\t\treturn this.user.userPreferences.get().animationSpeed ?? defaultUserPreferences.animationSpeed\n\t}\n\n\t@computed getId() {\n\t\treturn this.user.userPreferences.get().id\n\t}\n\n\t@computed getName() {\n\t\treturn this.user.userPreferences.get().name ?? defaultUserPreferences.name\n\t}\n\n\t@computed getLocale() {\n\t\treturn this.user.userPreferences.get().locale ?? defaultUserPreferences.locale\n\t}\n\n\t@computed getColor() {\n\t\treturn this.user.userPreferences.get().color ?? defaultUserPreferences.color\n\t}\n\n\t@computed getIsSnapMode() {\n\t\treturn this.user.userPreferences.get().isSnapMode ?? defaultUserPreferences.isSnapMode\n\t}\n\n\t@computed getIsWrapMode() {\n\t\treturn this.user.userPreferences.get().isWrapMode ?? defaultUserPreferences.isWrapMode\n\t}\n}\n", "import { TLArrowShape, TLArrowShapeTerminal, TLShape, TLShapeId } from '@tldraw/tlschema'\nimport { Mat } from '../../../../primitives/Mat'\nimport { Vec } from '../../../../primitives/Vec'\nimport { Group2d } from '../../../../primitives/geometry/Group2d'\nimport { Editor } from '../../../Editor'\n\nexport function getIsArrowStraight(shape: TLArrowShape) {\n\treturn Math.abs(shape.props.bend) < 8 // snap to +-8px\n}\n\nexport type BoundShapeInfo<T extends TLShape = TLShape> = {\n\tshape: T\n\tdidIntersect: boolean\n\tisExact: boolean\n\tisClosed: boolean\n\ttransform: Mat\n\toutline: Vec[]\n}\n\nexport function getBoundShapeInfoForTerminal(\n\teditor: Editor,\n\tterminal: TLArrowShapeTerminal\n): BoundShapeInfo | undefined {\n\tif (terminal.type === 'point') {\n\t\treturn\n\t}\n\n\tconst shape = editor.getShape(terminal.boundShapeId)!\n\tconst transform = editor.getShapePageTransform(shape)!\n\tconst geometry = editor.getShapeGeometry(shape)\n\n\t// This is hacky: we're only looking at the first child in the group. Really the arrow should\n\t// consider all items in the group which are marked as snappable as separate polygons with which\n\t// to intersect, in the case of a group that has multiple children which do not overlap; or else\n\t// flatten the geometry into a set of polygons and intersect with that.\n\tconst outline = geometry instanceof Group2d ? geometry.children[0].vertices : geometry.vertices\n\n\treturn {\n\t\tshape,\n\t\ttransform,\n\t\tisClosed: geometry.isClosed,\n\t\tisExact: terminal.isExact,\n\t\tdidIntersect: false,\n\t\toutline,\n\t}\n}\n\nfunction getArrowTerminalInArrowSpace(\n\teditor: Editor,\n\tarrowPageTransform: Mat,\n\tterminal: TLArrowShapeTerminal,\n\tforceImprecise: boolean\n) {\n\tif (terminal.type === 'point') {\n\t\treturn Vec.From(terminal)\n\t}\n\n\tconst boundShape = editor.getShape(terminal.boundShapeId)\n\n\tif (!boundShape) {\n\t\t// this can happen in multiplayer contexts where the shape is being deleted\n\t\treturn new Vec(0, 0)\n\t} else {\n\t\t// Find the actual local point of the normalized terminal on\n\t\t// the bound shape and transform it to page space, then transform\n\t\t// it to arrow space\n\t\tconst { point, size } = editor.getShapeGeometry(boundShape).bounds\n\t\tconst shapePoint = Vec.Add(\n\t\t\tpoint,\n\t\t\tVec.MulV(\n\t\t\t\t// if the parent is the bound shape, then it's ALWAYS precise\n\t\t\t\tterminal.isPrecise || forceImprecise ? terminal.normalizedAnchor : { x: 0.5, y: 0.5 },\n\t\t\t\tsize\n\t\t\t)\n\t\t)\n\t\tconst pagePoint = Mat.applyToPoint(editor.getShapePageTransform(boundShape)!, shapePoint)\n\t\tconst arrowPoint = Mat.applyToPoint(Mat.Inverse(arrowPageTransform), pagePoint)\n\t\treturn arrowPoint\n\t}\n}\n\n/** @public */\nexport function getArrowTerminalsInArrowSpace(editor: Editor, shape: TLArrowShape) {\n\tconst arrowPageTransform = editor.getShapePageTransform(shape)!\n\n\tlet startBoundShapeId: TLShapeId | undefined\n\tlet endBoundShapeId: TLShapeId | undefined\n\n\tif (shape.props.start.type === 'binding' && shape.props.end.type === 'binding') {\n\t\tstartBoundShapeId = shape.props.start.boundShapeId\n\t\tendBoundShapeId = shape.props.end.boundShapeId\n\t}\n\n\tconst boundShapeRelationships = getBoundShapeRelationships(\n\t\teditor,\n\t\tstartBoundShapeId,\n\t\tendBoundShapeId\n\t)\n\n\tconst start = getArrowTerminalInArrowSpace(\n\t\teditor,\n\t\tarrowPageTransform,\n\t\tshape.props.start,\n\t\tboundShapeRelationships === 'double-bound' || boundShapeRelationships === 'start-contains-end'\n\t)\n\n\tconst end = getArrowTerminalInArrowSpace(\n\t\teditor,\n\t\tarrowPageTransform,\n\t\tshape.props.end,\n\t\tboundShapeRelationships === 'double-bound' || boundShapeRelationships === 'end-contains-start'\n\t)\n\n\treturn { start, end }\n}\n\n/** @internal */\nexport const MIN_ARROW_LENGTH = 10\n/** @internal */\nexport const BOUND_ARROW_OFFSET = 10\n/** @internal */\nexport const WAY_TOO_BIG_ARROW_BEND_FACTOR = 10\n\n/** @public */\nexport const STROKE_SIZES: Record<string, number> = {\n\ts: 2,\n\tm: 3.5,\n\tl: 5,\n\txl: 10,\n}\n\n/**\n * Get the relationships for an arrow that has two bound shape terminals.\n * If the arrow has only one bound shape, then it is always \"safe\" to apply\n * standard offsets and precision behavior. If the shape is bound to the same\n * shape on both ends, then that is an exception. If one of the shape's\n * terminals is bound to a shape that contains / is contained by the shape that\n * is bound to the other terminal, then that is also an exception.\n *\n * @param editor - the editor instance\n * @param startShapeId - the bound shape from the arrow's start\n * @param endShapeId - the bound shape from the arrow's end\n *\n *  @internal */\nexport function getBoundShapeRelationships(\n\teditor: Editor,\n\tstartShapeId?: TLShapeId,\n\tendShapeId?: TLShapeId\n) {\n\tif (!startShapeId || !endShapeId) return 'safe'\n\tif (startShapeId === endShapeId) return 'double-bound'\n\tconst startBounds = editor.getShapePageBounds(startShapeId)\n\tconst endBounds = editor.getShapePageBounds(endShapeId)\n\tif (startBounds && endBounds) {\n\t\tif (startBounds.contains(endBounds)) return 'start-contains-end'\n\t\tif (endBounds.contains(startBounds)) return 'end-contains-start'\n\t}\n\treturn 'safe'\n}\n", "import { TLArrowShape } from '@tldraw/tlschema'\nimport { Mat, MatModel } from '../../../../primitives/Mat'\nimport { Vec, VecLike } from '../../../../primitives/Vec'\nimport {\n\tintersectLineSegmentPolygon,\n\tintersectLineSegmentPolyline,\n} from '../../../../primitives/intersect'\nimport { Editor } from '../../../Editor'\nimport { TLArrowInfo } from './arrow-types'\nimport {\n\tBOUND_ARROW_OFFSET,\n\tBoundShapeInfo,\n\tMIN_ARROW_LENGTH,\n\tSTROKE_SIZES,\n\tgetArrowTerminalsInArrowSpace,\n\tgetBoundShapeInfoForTerminal,\n\tgetBoundShapeRelationships,\n} from './shared'\n\nexport function getStraightArrowInfo(editor: Editor, shape: TLArrowShape): TLArrowInfo {\n\tconst { start, end, arrowheadStart, arrowheadEnd } = shape.props\n\n\tconst terminalsInArrowSpace = getArrowTerminalsInArrowSpace(editor, shape)\n\n\tconst a = terminalsInArrowSpace.start.clone()\n\tconst b = terminalsInArrowSpace.end.clone()\n\tconst c = Vec.Med(a, b)\n\n\tif (Vec.Equals(a, b)) {\n\t\treturn {\n\t\t\tisStraight: true,\n\t\t\tstart: {\n\t\t\t\thandle: a,\n\t\t\t\tpoint: a,\n\t\t\t\tarrowhead: shape.props.arrowheadStart,\n\t\t\t},\n\t\t\tend: {\n\t\t\t\thandle: b,\n\t\t\t\tpoint: b,\n\t\t\t\tarrowhead: shape.props.arrowheadEnd,\n\t\t\t},\n\t\t\tmiddle: c,\n\t\t\tisValid: false,\n\t\t\tlength: 0,\n\t\t}\n\t}\n\n\tconst uAB = Vec.Sub(b, a).uni()\n\n\t// Update the arrowhead points using intersections with the bound shapes, if any.\n\n\tconst startShapeInfo = getBoundShapeInfoForTerminal(editor, start)\n\tconst endShapeInfo = getBoundShapeInfoForTerminal(editor, end)\n\n\tconst arrowPageTransform = editor.getShapePageTransform(shape)!\n\n\t// Update the position of the arrowhead's end point\n\tupdateArrowheadPointWithBoundShape(\n\t\tb, // <-- will be mutated\n\t\tterminalsInArrowSpace.start,\n\t\tarrowPageTransform,\n\t\tendShapeInfo\n\t)\n\n\t// Then update the position of the arrowhead's end point\n\tupdateArrowheadPointWithBoundShape(\n\t\ta, // <-- will be mutated\n\t\tterminalsInArrowSpace.end,\n\t\tarrowPageTransform,\n\t\tstartShapeInfo\n\t)\n\n\tlet offsetA = 0\n\tlet offsetB = 0\n\tlet strokeOffsetA = 0\n\tlet strokeOffsetB = 0\n\tlet minLength = MIN_ARROW_LENGTH\n\n\tconst isSelfIntersection =\n\t\tstartShapeInfo && endShapeInfo && startShapeInfo.shape === endShapeInfo.shape\n\n\tconst relationship =\n\t\tstartShapeInfo && endShapeInfo\n\t\t\t? getBoundShapeRelationships(editor, startShapeInfo.shape.id, endShapeInfo.shape.id)\n\t\t\t: 'safe'\n\n\tif (\n\t\trelationship === 'safe' &&\n\t\tstartShapeInfo &&\n\t\tendShapeInfo &&\n\t\t!isSelfIntersection &&\n\t\t!startShapeInfo.isExact &&\n\t\t!endShapeInfo.isExact\n\t) {\n\t\tif (endShapeInfo.didIntersect && !startShapeInfo.didIntersect) {\n\t\t\t// ...and if only the end shape intersected, then make it\n\t\t\t// a short arrow ending at the end shape intersection.\n\n\t\t\tif (startShapeInfo.isClosed) {\n\t\t\t\ta.setTo(b.clone().add(uAB.clone().mul(MIN_ARROW_LENGTH)))\n\t\t\t}\n\t\t} else if (!endShapeInfo.didIntersect) {\n\t\t\t// ...and if only the end shape intersected, or if neither\n\t\t\t// shape intersected, then make it a short arrow starting\n\t\t\t// at the start shape intersection.\n\t\t\tif (endShapeInfo.isClosed) {\n\t\t\t\tb.setTo(a.clone().sub(uAB.clone().mul(MIN_ARROW_LENGTH)))\n\t\t\t}\n\t\t}\n\t}\n\n\tconst distance = Vec.Sub(b, a)\n\t// Check for divide-by-zero before we call uni()\n\tconst u = Vec.Len(distance) ? distance.uni() : Vec.From(distance)\n\tconst didFlip = !Vec.Equals(u, uAB)\n\n\t// If the arrow is bound non-exact to a start shape and the\n\t// start point has an arrowhead, then offset the start point\n\tif (!isSelfIntersection) {\n\t\tif (\n\t\t\trelationship !== 'start-contains-end' &&\n\t\t\tstartShapeInfo &&\n\t\t\tarrowheadStart !== 'none' &&\n\t\t\t!startShapeInfo.isExact\n\t\t) {\n\t\t\tstrokeOffsetA =\n\t\t\t\tSTROKE_SIZES[shape.props.size] / 2 +\n\t\t\t\t('size' in startShapeInfo.shape.props\n\t\t\t\t\t? STROKE_SIZES[startShapeInfo.shape.props.size] / 2\n\t\t\t\t\t: 0)\n\t\t\toffsetA = BOUND_ARROW_OFFSET + strokeOffsetA\n\t\t\tminLength += strokeOffsetA\n\t\t}\n\n\t\t// If the arrow is bound non-exact to an end shape and the\n\t\t// end point has an arrowhead offset the end point\n\t\tif (\n\t\t\trelationship !== 'end-contains-start' &&\n\t\t\tendShapeInfo &&\n\t\t\tarrowheadEnd !== 'none' &&\n\t\t\t!endShapeInfo.isExact\n\t\t) {\n\t\t\tstrokeOffsetB =\n\t\t\t\tSTROKE_SIZES[shape.props.size] / 2 +\n\t\t\t\t('size' in endShapeInfo.shape.props ? STROKE_SIZES[endShapeInfo.shape.props.size] / 2 : 0)\n\t\t\toffsetB = BOUND_ARROW_OFFSET + strokeOffsetB\n\t\t\tminLength += strokeOffsetB\n\t\t}\n\t}\n\n\t// Adjust offsets if the length of the arrow is too small\n\n\tconst tA = a.clone().add(u.clone().mul(offsetA * (didFlip ? -1 : 1)))\n\tconst tB = b.clone().sub(u.clone().mul(offsetB * (didFlip ? -1 : 1)))\n\n\tif (Vec.DistMin(tA, tB, minLength)) {\n\t\tif (offsetA !== 0 && offsetB !== 0) {\n\t\t\t// both bound + offset\n\t\t\toffsetA *= -1.5\n\t\t\toffsetB *= -1.5\n\t\t} else if (offsetA !== 0) {\n\t\t\t// start bound + offset\n\t\t\toffsetA *= -1\n\t\t} else if (offsetB !== 0) {\n\t\t\t// end bound + offset\n\t\t\toffsetB *= -1\n\t\t} else {\n\t\t\t// noop, its just a really short arrow\n\t\t}\n\t}\n\n\ta.add(u.clone().mul(offsetA * (didFlip ? -1 : 1)))\n\tb.sub(u.clone().mul(offsetB * (didFlip ? -1 : 1)))\n\n\t// If the handles flipped their order, then set the center handle\n\t// to the midpoint of the terminals (rather than the midpoint of the\n\t// arrow body); otherwise, it may not be \"between\" the other terminals.\n\tif (didFlip) {\n\t\tif (startShapeInfo && endShapeInfo) {\n\t\t\t// If we have two bound shapes...then make the arrow a short arrow from\n\t\t\t// the start point towards where the end point should be.\n\t\t\tb.setTo(Vec.Add(a, u.clone().mul(-MIN_ARROW_LENGTH)))\n\t\t}\n\t\tc.setTo(Vec.Med(terminalsInArrowSpace.start, terminalsInArrowSpace.end))\n\t} else {\n\t\tc.setTo(Vec.Med(a, b))\n\t}\n\n\tconst length = Vec.Dist(a, b)\n\n\treturn {\n\t\tisStraight: true,\n\t\tstart: {\n\t\t\thandle: terminalsInArrowSpace.start,\n\t\t\tpoint: a,\n\t\t\tarrowhead: shape.props.arrowheadStart,\n\t\t},\n\t\tend: {\n\t\t\thandle: terminalsInArrowSpace.end,\n\t\t\tpoint: b,\n\t\t\tarrowhead: shape.props.arrowheadEnd,\n\t\t},\n\t\tmiddle: c,\n\t\tisValid: length > 0,\n\t\tlength,\n\t}\n}\n\n/** Get an intersection point from A -> B with bound shape (target) from shape (arrow). */\nfunction updateArrowheadPointWithBoundShape(\n\tpoint: Vec,\n\topposite: Vec,\n\tarrowPageTransform: MatModel,\n\ttargetShapeInfo?: BoundShapeInfo\n) {\n\tif (targetShapeInfo === undefined) {\n\t\t// No bound shape? The arrowhead point will be at the arrow terminal.\n\t\treturn\n\t}\n\n\tif (targetShapeInfo.isExact) {\n\t\t// Exact type binding? The arrowhead point will be at the arrow terminal.\n\t\treturn\n\t}\n\n\t// From and To in page space\n\tconst pageFrom = Mat.applyToPoint(arrowPageTransform, opposite)\n\tconst pageTo = Mat.applyToPoint(arrowPageTransform, point)\n\n\t// From and To in local space of the target shape\n\tconst targetFrom = Mat.applyToPoint(Mat.Inverse(targetShapeInfo.transform), pageFrom)\n\tconst targetTo = Mat.applyToPoint(Mat.Inverse(targetShapeInfo.transform), pageTo)\n\n\tconst isClosed = targetShapeInfo.isClosed\n\tconst fn = isClosed ? intersectLineSegmentPolygon : intersectLineSegmentPolyline\n\n\tconst intersection = fn(targetFrom, targetTo, targetShapeInfo.outline)\n\n\tlet targetInt: VecLike | undefined\n\n\tif (intersection !== null) {\n\t\ttargetInt =\n\t\t\tintersection.sort((p1, p2) => Vec.Dist2(p1, targetFrom) - Vec.Dist2(p2, targetFrom))[0] ??\n\t\t\t(isClosed ? undefined : targetTo)\n\t}\n\n\tif (targetInt === undefined) {\n\t\t// No intersection? The arrowhead point will be at the arrow terminal.\n\t\treturn\n\t}\n\n\tconst pageInt = Mat.applyToPoint(targetShapeInfo.transform, targetInt)\n\tconst arrowInt = Mat.applyToPoint(Mat.Inverse(arrowPageTransform), pageInt)\n\n\tpoint.setTo(arrowInt)\n\n\ttargetShapeInfo.didIntersect = true\n}\n", "import { TLArrowShape } from '@tldraw/tlschema'\nimport { Mat } from '../../../../primitives/Mat'\nimport { Vec, VecLike } from '../../../../primitives/Vec'\nimport { intersectCirclePolygon, intersectCirclePolyline } from '../../../../primitives/intersect'\nimport {\n\tPI,\n\tPI2,\n\tclockwiseAngleDist,\n\tcounterClockwiseAngleDist,\n\tisSafeFloat,\n} from '../../../../primitives/utils'\nimport type { Editor } from '../../../Editor'\nimport { TLArcInfo, TLArrowInfo } from './arrow-types'\nimport {\n\tBOUND_ARROW_OFFSET,\n\tMIN_ARROW_LENGTH,\n\tSTROKE_SIZES,\n\tWAY_TOO_BIG_ARROW_BEND_FACTOR,\n\tgetArrowTerminalsInArrowSpace,\n\tgetBoundShapeInfoForTerminal,\n\tgetBoundShapeRelationships,\n} from './shared'\nimport { getStraightArrowInfo } from './straight-arrow'\n\nexport function getCurvedArrowInfo(\n\teditor: Editor,\n\tshape: TLArrowShape,\n\textraBend = 0\n): TLArrowInfo {\n\tconst { arrowheadEnd, arrowheadStart } = shape.props\n\tconst bend = shape.props.bend + extraBend\n\n\tif (Math.abs(bend) > Math.abs(shape.props.bend * WAY_TOO_BIG_ARROW_BEND_FACTOR)) {\n\t\treturn getStraightArrowInfo(editor, shape)\n\t}\n\n\tconst terminalsInArrowSpace = getArrowTerminalsInArrowSpace(editor, shape)\n\n\tconst med = Vec.Med(terminalsInArrowSpace.start, terminalsInArrowSpace.end) // point between start and end\n\tconst distance = Vec.Sub(terminalsInArrowSpace.end, terminalsInArrowSpace.start)\n\t// Check for divide-by-zero before we call uni()\n\tconst u = Vec.Len(distance) ? distance.uni() : Vec.From(distance) // unit vector between start and end\n\tconst middle = Vec.Add(med, u.per().mul(-bend)) // middle handle\n\n\tconst startShapeInfo = getBoundShapeInfoForTerminal(editor, shape.props.start)\n\tconst endShapeInfo = getBoundShapeInfoForTerminal(editor, shape.props.end)\n\n\t// The positions of the body of the arrow, which may be different\n\t// than the arrow's start / end points if the arrow is bound to shapes\n\tconst a = terminalsInArrowSpace.start.clone()\n\tconst b = terminalsInArrowSpace.end.clone()\n\tconst c = middle.clone()\n\n\tif (Vec.Equals(a, b)) {\n\t\treturn {\n\t\t\tisStraight: true,\n\t\t\tstart: {\n\t\t\t\thandle: a,\n\t\t\t\tpoint: a,\n\t\t\t\tarrowhead: shape.props.arrowheadStart,\n\t\t\t},\n\t\t\tend: {\n\t\t\t\thandle: b,\n\t\t\t\tpoint: b,\n\t\t\t\tarrowhead: shape.props.arrowheadEnd,\n\t\t\t},\n\t\t\tmiddle: c,\n\t\t\tisValid: false,\n\t\t\tlength: 0,\n\t\t}\n\t}\n\n\tconst isClockwise = shape.props.bend < 0\n\tconst distFn = isClockwise ? clockwiseAngleDist : counterClockwiseAngleDist\n\n\tconst handleArc = getArcInfo(a, b, c)\n\tconst handle_aCA = Vec.Angle(handleArc.center, a)\n\tconst handle_aCB = Vec.Angle(handleArc.center, b)\n\tconst handle_dAB = distFn(handle_aCA, handle_aCB)\n\n\tif (\n\t\thandleArc.length === 0 ||\n\t\thandleArc.size === 0 ||\n\t\t!isSafeFloat(handleArc.length) ||\n\t\t!isSafeFloat(handleArc.size)\n\t) {\n\t\treturn getStraightArrowInfo(editor, shape)\n\t}\n\n\tconst tempA = a.clone()\n\tconst tempB = b.clone()\n\tconst tempC = c.clone()\n\n\tconst arrowPageTransform = editor.getShapePageTransform(shape)!\n\n\tlet offsetA = 0\n\tlet offsetB = 0\n\n\tlet minLength = MIN_ARROW_LENGTH\n\n\tif (startShapeInfo && !startShapeInfo.isExact) {\n\t\tconst startInPageSpace = Mat.applyToPoint(arrowPageTransform, tempA)\n\t\tconst centerInPageSpace = Mat.applyToPoint(arrowPageTransform, handleArc.center)\n\t\tconst endInPageSpace = Mat.applyToPoint(arrowPageTransform, tempB)\n\n\t\tconst inverseTransform = Mat.Inverse(startShapeInfo.transform)\n\n\t\tconst startInStartShapeLocalSpace = Mat.applyToPoint(inverseTransform, startInPageSpace)\n\t\tconst centerInStartShapeLocalSpace = Mat.applyToPoint(inverseTransform, centerInPageSpace)\n\t\tconst endInStartShapeLocalSpace = Mat.applyToPoint(inverseTransform, endInPageSpace)\n\n\t\tconst { isClosed } = startShapeInfo\n\t\tconst fn = isClosed ? intersectCirclePolygon : intersectCirclePolyline\n\n\t\tlet point: VecLike | undefined\n\n\t\tlet intersections = fn(centerInStartShapeLocalSpace, handleArc.radius, startShapeInfo.outline)\n\n\t\tif (intersections) {\n\t\t\tconst angleToStart = centerInStartShapeLocalSpace.angle(startInStartShapeLocalSpace)\n\t\t\tconst angleToEnd = centerInStartShapeLocalSpace.angle(endInStartShapeLocalSpace)\n\t\t\tconst dAB = distFn(angleToStart, angleToEnd)\n\n\t\t\t// Filter out any intersections that aren't in the arc\n\t\t\tintersections = intersections.filter(\n\t\t\t\t(pt) => distFn(angleToStart, centerInStartShapeLocalSpace.angle(pt)) <= dAB\n\t\t\t)\n\n\t\t\tconst targetDist = dAB * 0.25\n\n\t\t\tintersections.sort(\n\t\t\t\tisClosed\n\t\t\t\t\t? (p0, p1) =>\n\t\t\t\t\t\t\tMath.abs(distFn(angleToStart, centerInStartShapeLocalSpace.angle(p0)) - targetDist) <\n\t\t\t\t\t\t\tMath.abs(distFn(angleToStart, centerInStartShapeLocalSpace.angle(p1)) - targetDist)\n\t\t\t\t\t\t\t\t? -1\n\t\t\t\t\t\t\t\t: 1\n\t\t\t\t\t: (p0, p1) =>\n\t\t\t\t\t\t\tdistFn(angleToStart, centerInStartShapeLocalSpace.angle(p0)) <\n\t\t\t\t\t\t\tdistFn(angleToStart, centerInStartShapeLocalSpace.angle(p1))\n\t\t\t\t\t\t\t\t? -1\n\t\t\t\t\t\t\t\t: 1\n\t\t\t)\n\n\t\t\tpoint = intersections[0] ?? (isClosed ? undefined : startInStartShapeLocalSpace)\n\t\t} else {\n\t\t\tpoint = isClosed ? undefined : startInStartShapeLocalSpace\n\t\t}\n\n\t\tif (point) {\n\t\t\ttempA.setTo(\n\t\t\t\teditor.getPointInShapeSpace(shape, Mat.applyToPoint(startShapeInfo.transform, point))\n\t\t\t)\n\n\t\t\tstartShapeInfo.didIntersect = true\n\n\t\t\tif (arrowheadStart !== 'none') {\n\t\t\t\tconst strokeOffset =\n\t\t\t\t\tSTROKE_SIZES[shape.props.size] / 2 +\n\t\t\t\t\t('size' in startShapeInfo.shape.props\n\t\t\t\t\t\t? STROKE_SIZES[startShapeInfo.shape.props.size] / 2\n\t\t\t\t\t\t: 0)\n\t\t\t\toffsetA = BOUND_ARROW_OFFSET + strokeOffset\n\t\t\t\tminLength += strokeOffset\n\t\t\t}\n\t\t}\n\t}\n\n\tif (endShapeInfo && !endShapeInfo.isExact) {\n\t\t// get points in shape's coordinates?\n\t\tconst startInPageSpace = Mat.applyToPoint(arrowPageTransform, tempA)\n\t\tconst endInPageSpace = Mat.applyToPoint(arrowPageTransform, tempB)\n\t\tconst centerInPageSpace = Mat.applyToPoint(arrowPageTransform, handleArc.center)\n\n\t\tconst inverseTransform = Mat.Inverse(endShapeInfo.transform)\n\n\t\tconst startInEndShapeLocalSpace = Mat.applyToPoint(inverseTransform, startInPageSpace)\n\t\tconst centerInEndShapeLocalSpace = Mat.applyToPoint(inverseTransform, centerInPageSpace)\n\t\tconst endInEndShapeLocalSpace = Mat.applyToPoint(inverseTransform, endInPageSpace)\n\n\t\tconst isClosed = endShapeInfo.isClosed\n\t\tconst fn = isClosed ? intersectCirclePolygon : intersectCirclePolyline\n\n\t\tlet point: VecLike | undefined\n\n\t\tlet intersections = fn(centerInEndShapeLocalSpace, handleArc.radius, endShapeInfo.outline)\n\n\t\tif (intersections) {\n\t\t\tconst angleToStart = centerInEndShapeLocalSpace.angle(startInEndShapeLocalSpace)\n\t\t\tconst angleToEnd = centerInEndShapeLocalSpace.angle(endInEndShapeLocalSpace)\n\t\t\tconst dAB = distFn(angleToStart, angleToEnd)\n\t\t\tconst targetDist = dAB * 0.75\n\n\t\t\t// or simplified...\n\n\t\t\tintersections = intersections.filter(\n\t\t\t\t(pt) => distFn(angleToStart, centerInEndShapeLocalSpace.angle(pt)) <= dAB\n\t\t\t)\n\n\t\t\tintersections.sort(\n\t\t\t\tisClosed\n\t\t\t\t\t? (p0, p1) =>\n\t\t\t\t\t\t\tMath.abs(distFn(angleToStart, centerInEndShapeLocalSpace.angle(p0)) - targetDist) <\n\t\t\t\t\t\t\tMath.abs(distFn(angleToStart, centerInEndShapeLocalSpace.angle(p1)) - targetDist)\n\t\t\t\t\t\t\t\t? -1\n\t\t\t\t\t\t\t\t: 1\n\t\t\t\t\t: (p0, p1) =>\n\t\t\t\t\t\t\tdistFn(angleToStart, centerInEndShapeLocalSpace.angle(p0)) <\n\t\t\t\t\t\t\tdistFn(angleToStart, centerInEndShapeLocalSpace.angle(p1))\n\t\t\t\t\t\t\t\t? -1\n\t\t\t\t\t\t\t\t: 1\n\t\t\t)\n\n\t\t\tif (intersections[0]) {\n\t\t\t\tpoint = intersections[0]\n\t\t\t} else {\n\t\t\t\tpoint = isClosed ? undefined : endInEndShapeLocalSpace\n\t\t\t}\n\t\t} else {\n\t\t\tpoint = isClosed ? undefined : endInEndShapeLocalSpace\n\t\t}\n\n\t\tif (point) {\n\t\t\t// Set b to target local point -> page point -> shape local point\n\t\t\ttempB.setTo(\n\t\t\t\teditor.getPointInShapeSpace(shape, Mat.applyToPoint(endShapeInfo.transform, point))\n\t\t\t)\n\n\t\t\tendShapeInfo.didIntersect = true\n\n\t\t\tif (arrowheadEnd !== 'none') {\n\t\t\t\tconst strokeOffset =\n\t\t\t\t\tSTROKE_SIZES[shape.props.size] / 2 +\n\t\t\t\t\t('size' in endShapeInfo.shape.props ? STROKE_SIZES[endShapeInfo.shape.props.size] / 2 : 0)\n\t\t\t\toffsetB = BOUND_ARROW_OFFSET + strokeOffset\n\t\t\t\tminLength += strokeOffset\n\t\t\t}\n\t\t}\n\t}\n\n\t// Apply arrowhead offsets\n\n\tlet aCA = Vec.Angle(handleArc.center, tempA) // angle center -> a\n\tlet aCB = Vec.Angle(handleArc.center, tempB) // angle center -> b\n\tlet dAB = distFn(aCA, aCB) // angle distance between a and b\n\tlet lAB = dAB * handleArc.radius // length of arc between a and b\n\n\t// Try the offsets first, then check whether the distance between the points is too small;\n\t// if it is, flip the offsets and expand them. We need to do this using temporary points\n\t// so that we can apply them both in a balanced way.\n\tconst tA = tempA.clone()\n\tconst tB = tempB.clone()\n\n\tif (offsetA !== 0) {\n\t\tconst n = (offsetA / lAB) * (isClockwise ? 1 : -1)\n\t\tconst u = Vec.FromAngle(aCA + dAB * n)\n\t\ttA.setTo(handleArc.center).add(u.mul(handleArc.radius))\n\t}\n\n\tif (offsetB !== 0) {\n\t\tconst n = (offsetB / lAB) * (isClockwise ? -1 : 1)\n\t\tconst u = Vec.FromAngle(aCB + dAB * n)\n\t\ttB.setTo(handleArc.center).add(u.mul(handleArc.radius))\n\t}\n\n\tif (Vec.DistMin(tA, tB, minLength)) {\n\t\tif (offsetA !== 0 && offsetB !== 0) {\n\t\t\toffsetA *= -1.5\n\t\t\toffsetB *= -1.5\n\t\t} else if (offsetA !== 0) {\n\t\t\toffsetA *= -2\n\t\t} else if (offsetB !== 0) {\n\t\t\toffsetB *= -2\n\t\t} else {\n\t\t\t// noop\n\t\t}\n\t}\n\n\tif (offsetA !== 0) {\n\t\tconst n = (offsetA / lAB) * (isClockwise ? 1 : -1)\n\t\tconst u = Vec.FromAngle(aCA + dAB * n)\n\t\ttempA.setTo(handleArc.center).add(u.mul(handleArc.radius))\n\t}\n\n\tif (offsetB !== 0) {\n\t\tconst n = (offsetB / lAB) * (isClockwise ? -1 : 1)\n\t\tconst u = Vec.FromAngle(aCB + dAB * n)\n\t\ttempB.setTo(handleArc.center).add(u.mul(handleArc.radius))\n\t}\n\n\t// Did we miss intersections? This happens when we have overlapping shapes.\n\tif (startShapeInfo && endShapeInfo && !startShapeInfo.isExact && !endShapeInfo.isExact) {\n\t\taCA = Vec.Angle(handleArc.center, tempA) // angle center -> a\n\t\taCB = Vec.Angle(handleArc.center, tempB) // angle center -> b\n\t\tdAB = distFn(aCA, aCB) // angle distance between a and b\n\t\tlAB = dAB * handleArc.radius // length of arc between a and b\n\t\tconst relationship = getBoundShapeRelationships(\n\t\t\teditor,\n\t\t\tstartShapeInfo.shape.id,\n\t\t\tendShapeInfo.shape.id\n\t\t)\n\n\t\tif (relationship === 'double-bound' && lAB < 30) {\n\t\t\ttempA.setTo(a)\n\t\t\ttempB.setTo(b)\n\t\t\ttempC.setTo(c)\n\t\t} else if (relationship === 'safe') {\n\t\t\tif (startShapeInfo && !startShapeInfo.didIntersect) {\n\t\t\t\ttempA.setTo(a)\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(endShapeInfo && !endShapeInfo.didIntersect) ||\n\t\t\t\tdistFn(handle_aCA, aCA) > distFn(handle_aCA, aCB)\n\t\t\t) {\n\t\t\t\tconst n = Math.min(0.9, MIN_ARROW_LENGTH / lAB) * (isClockwise ? 1 : -1)\n\t\t\t\tconst u = Vec.FromAngle(aCA + dAB * n)\n\t\t\t\ttempB.setTo(handleArc.center).add(u.mul(handleArc.radius))\n\t\t\t}\n\t\t}\n\t}\n\n\tplaceCenterHandle(\n\t\thandleArc.center,\n\t\thandleArc.radius,\n\t\ttempA,\n\t\ttempB,\n\t\ttempC,\n\t\thandle_dAB,\n\t\tisClockwise\n\t)\n\n\tif (tempA.equals(tempB)) {\n\t\ttempA.setTo(tempC.clone().addXY(1, 1))\n\t\ttempB.setTo(tempC.clone().subXY(1, 1))\n\t}\n\n\ta.setTo(tempA)\n\tb.setTo(tempB)\n\tc.setTo(tempC)\n\tconst bodyArc = getArcInfo(a, b, c)\n\n\treturn {\n\t\tisStraight: false,\n\t\tstart: {\n\t\t\tpoint: a,\n\t\t\thandle: terminalsInArrowSpace.start,\n\t\t\tarrowhead: shape.props.arrowheadStart,\n\t\t},\n\t\tend: {\n\t\t\tpoint: b,\n\t\t\thandle: terminalsInArrowSpace.end,\n\t\t\tarrowhead: shape.props.arrowheadEnd,\n\t\t},\n\t\tmiddle: c,\n\t\thandleArc,\n\t\tbodyArc,\n\t\tisValid: bodyArc.length !== 0 && isFinite(bodyArc.center.x) && isFinite(bodyArc.center.y),\n\t}\n}\n\n/**\n * Get info about an arc formed by three points.\n *\n * @param a - The start of the arc\n * @param b - The end of the arc\n * @param c - A point on the arc\n */\nfunction getArcInfo(a: VecLike, b: VecLike, c: VecLike): TLArcInfo {\n\t// find a circle from the three points\n\tconst u = -2 * (a.x * (b.y - c.y) - a.y * (b.x - c.x) + b.x * c.y - c.x * b.y)\n\n\tconst center = {\n\t\tx:\n\t\t\t((a.x * a.x + a.y * a.y) * (c.y - b.y) +\n\t\t\t\t(b.x * b.x + b.y * b.y) * (a.y - c.y) +\n\t\t\t\t(c.x * c.x + c.y * c.y) * (b.y - a.y)) /\n\t\t\tu,\n\t\ty:\n\t\t\t((a.x * a.x + a.y * a.y) * (b.x - c.x) +\n\t\t\t\t(b.x * b.x + b.y * b.y) * (c.x - a.x) +\n\t\t\t\t(c.x * c.x + c.y * c.y) * (a.x - b.x)) /\n\t\t\tu,\n\t}\n\n\tconst radius = Vec.Dist(center, a)\n\n\t// Whether to draw the arc clockwise or counter-clockwise (are the points clockwise?)\n\tconst sweepFlag = +Vec.Clockwise(a, c, b)\n\n\t// The base angle of the arc in radians\n\tconst ab = ((a.y - b.y) ** 2 + (a.x - b.x) ** 2) ** 0.5\n\tconst bc = ((b.y - c.y) ** 2 + (b.x - c.x) ** 2) ** 0.5\n\tconst ca = ((c.y - a.y) ** 2 + (c.x - a.x) ** 2) ** 0.5\n\n\tconst theta = Math.acos((bc * bc + ca * ca - ab * ab) / (2 * bc * ca)) * 2\n\n\t// Whether to draw the long arc or short arc\n\tconst largeArcFlag = +(PI > theta)\n\n\t// The size of the arc to draw in radians\n\tconst size = (PI2 - theta) * (sweepFlag ? 1 : -1)\n\n\t// The length of the arc to draw in distance units\n\tconst length = size * radius\n\n\treturn {\n\t\tcenter,\n\t\tradius,\n\t\tsize,\n\t\tlength,\n\t\tlargeArcFlag,\n\t\tsweepFlag,\n\t}\n}\n\nfunction placeCenterHandle(\n\tcenter: VecLike,\n\tradius: number,\n\ttempA: Vec,\n\ttempB: Vec,\n\ttempC: Vec,\n\toriginalArcLength: number,\n\tisClockwise: boolean\n) {\n\tconst aCA = Vec.Angle(center, tempA) // angle center -> a\n\tconst aCB = Vec.Angle(center, tempB) // angle center -> b\n\tlet dAB = clockwiseAngleDist(aCA, aCB) // angle distance between a and b\n\tif (!isClockwise) dAB = PI2 - dAB\n\n\tconst n = 0.5 * (isClockwise ? 1 : -1)\n\tconst u = Vec.FromAngle(aCA + dAB * n)\n\ttempC.setTo(center).add(u.mul(radius))\n\n\tif (dAB > originalArcLength) {\n\t\ttempC.rotWith(center, PI)\n\t\tconst t = tempB.clone()\n\t\ttempB.setTo(tempA)\n\t\ttempA.setTo(t)\n\t}\n}\n", "import { TLHandle, TLShape, VecModel } from '@tldraw/tlschema'\nimport { VecLike } from '../../primitives/Vec'\nimport { TLSelectionHandle } from './selection-types'\n\n/** @public */\nexport type UiEventType = 'pointer' | 'click' | 'keyboard' | 'wheel' | 'pinch' | 'zoom'\n\n/** @public */\nexport type TLPointerEventTarget =\n\t| { target: 'canvas'; shape?: undefined }\n\t| { target: 'selection'; handle?: TLSelectionHandle; shape?: undefined }\n\t| { target: 'shape'; shape: TLShape }\n\t| { target: 'handle'; shape: TLShape; handle: TLHandle }\n\n/** @public */\nexport type TLPointerEventName =\n\t| 'pointer_down'\n\t| 'pointer_move'\n\t| 'long_press'\n\t| 'pointer_up'\n\t| 'right_click'\n\t| 'middle_click'\n\n/** @public */\nexport type TLCLickEventName = 'double_click' | 'triple_click' | 'quadruple_click'\n\n/** @public */\nexport type TLPinchEventName = 'pinch_start' | 'pinch' | 'pinch_end'\n\n/** @public */\nexport type TLKeyboardEventName = 'key_down' | 'key_up' | 'key_repeat'\n\n/** @public */\nexport type TLEventName =\n\t| TLPointerEventName\n\t| TLCLickEventName\n\t| TLPinchEventName\n\t| TLKeyboardEventName\n\t| 'wheel'\n\t| 'cancel'\n\t| 'complete'\n\t| 'interrupt'\n\t| 'tick'\n\n/** @public */\nexport interface TLBaseEventInfo {\n\ttype: UiEventType\n\tshiftKey: boolean\n\taltKey: boolean\n\tctrlKey: boolean\n}\n\n/** @public */\nexport type TLPointerEventInfo = TLBaseEventInfo & {\n\ttype: 'pointer'\n\tname: TLPointerEventName\n\t// The pointer position in client space, i.e. clientX / clientY\n\tpoint: VecLike\n\tpointerId: number\n\tbutton: number\n\tisPen: boolean\n} & TLPointerEventTarget\n\n/** @public */\nexport type TLClickEventInfo = TLBaseEventInfo & {\n\ttype: 'click'\n\tname: TLCLickEventName\n\tpoint: VecLike\n\tpointerId: number\n\tbutton: number\n\tphase: 'down' | 'up' | 'settle'\n} & TLPointerEventTarget\n\n/** @public */\nexport type TLKeyboardEventInfo = TLBaseEventInfo & {\n\ttype: 'keyboard'\n\tname: TLKeyboardEventName\n\tkey: string\n\tcode: string\n}\n\n/** @public */\nexport type TLPinchEventInfo = TLBaseEventInfo & {\n\ttype: 'pinch'\n\tname: TLPinchEventName\n\tpoint: VecModel\n\tdelta: VecModel\n}\n\n/** @public */\nexport type TLWheelEventInfo = TLBaseEventInfo & {\n\ttype: 'wheel'\n\tname: 'wheel'\n\tdelta: VecModel\n\tpoint: VecModel\n}\n\n/** @public */\nexport type TLCancelEventInfo = { type: 'misc'; name: 'cancel' }\n/** @public */\nexport type TLCompleteEventInfo = { type: 'misc'; name: 'complete' }\n/** @public */\nexport type TLInterruptEventInfo = { type: 'misc'; name: 'interrupt' }\n/** @public */\nexport type TLTickEventInfo = { type: 'misc'; name: 'tick'; elapsed: number }\n\n/** @public */\nexport type TLEventInfo =\n\t| TLPointerEventInfo\n\t| TLClickEventInfo\n\t| TLKeyboardEventInfo\n\t| TLPinchEventInfo\n\t| TLWheelEventInfo\n\t| TLCancelEventInfo\n\t| TLCompleteEventInfo\n\t| TLInterruptEventInfo\n\t| TLTickEventInfo\n\n/** @public */\nexport type TLPointerEvent = (info: TLPointerEventInfo) => void\n/** @public */\nexport type TLClickEvent = (info: TLClickEventInfo) => void\n/** @public */\nexport type TLKeyboardEvent = (info: TLKeyboardEventInfo) => void\n/** @public */\nexport type TLPinchEvent = (info: TLPinchEventInfo) => void\n/** @public */\nexport type TLWheelEvent = (info: TLWheelEventInfo) => void\n/** @public */\nexport type TLCancelEvent = (info: TLCancelEventInfo) => void\n/** @public */\nexport type TLCompleteEvent = (info: TLCompleteEventInfo) => void\n/** @public */\nexport type TLInterruptEvent = (info: TLInterruptEventInfo) => void\n/** @public */\nexport type TLTickEvent = (info: TLTickEventInfo) => void\n\n/** @public */\nexport type UiEvent =\n\t| TLPointerEvent\n\t| TLClickEvent\n\t| TLKeyboardEvent\n\t| TLPinchEvent\n\t| TLCancelEvent\n\t| TLCompleteEvent\n\n/** @public */\nexport type TLEnterEventHandler = (info: any, from: string) => void\n/** @public */\nexport type TLExitEventHandler = (info: any, to: string) => void\n\n/** @public */\nexport interface TLEventHandlers {\n\tonPointerDown: TLPointerEvent\n\tonPointerMove: TLPointerEvent\n\tonLongPress: TLPointerEvent\n\tonRightClick: TLPointerEvent\n\tonDoubleClick: TLClickEvent\n\tonTripleClick: TLClickEvent\n\tonQuadrupleClick: TLClickEvent\n\tonMiddleClick: TLPointerEvent\n\tonPointerUp: TLPointerEvent\n\tonKeyDown: TLKeyboardEvent\n\tonKeyUp: TLKeyboardEvent\n\tonKeyRepeat: TLKeyboardEvent\n\tonWheel: TLWheelEvent\n\tonCancel: TLCancelEvent\n\tonComplete: TLCompleteEvent\n\tonInterrupt: TLInterruptEvent\n\tonTick: TLTickEvent\n}\n\n/** @public */\nexport const EVENT_NAME_MAP: Record<\n\tExclude<TLEventName, TLPinchEventName>,\n\tkeyof TLEventHandlers\n> = {\n\twheel: 'onWheel',\n\tpointer_down: 'onPointerDown',\n\tpointer_move: 'onPointerMove',\n\tlong_press: 'onLongPress',\n\tpointer_up: 'onPointerUp',\n\tright_click: 'onRightClick',\n\tmiddle_click: 'onMiddleClick',\n\tkey_down: 'onKeyDown',\n\tkey_up: 'onKeyUp',\n\tkey_repeat: 'onKeyRepeat',\n\tcancel: 'onCancel',\n\tcomplete: 'onComplete',\n\tinterrupt: 'onInterrupt',\n\tdouble_click: 'onDoubleClick',\n\ttriple_click: 'onTripleClick',\n\tquadruple_click: 'onQuadrupleClick',\n\ttick: 'onTick',\n}\n", "import { Atom, Computed, atom, computed } from '@tldraw/state'\nimport type { Editor } from '../Editor'\nimport {\n\tEVENT_NAME_MAP,\n\tTLEnterEventHandler,\n\tTLEventHandlers,\n\tTLEventInfo,\n\tTLExitEventHandler,\n\tTLPinchEventInfo,\n} from '../types/event-types'\n\ntype TLStateNodeType = 'branch' | 'leaf' | 'root'\n\n/** @public */\nexport interface TLStateNodeConstructor {\n\tnew (editor: Editor, parent?: StateNode): StateNode\n\tid: string\n\tinitial?: string\n\tchildren?: () => TLStateNodeConstructor[]\n}\n\n/** @public */\nexport abstract class StateNode implements Partial<TLEventHandlers> {\n\tconstructor(\n\t\tpublic editor: Editor,\n\t\tparent?: StateNode\n\t) {\n\t\tconst { id, children, initial } = this.constructor as TLStateNodeConstructor\n\n\t\tthis.id = id\n\t\tthis._isActive = atom<boolean>('toolIsActive' + this.id, false)\n\t\tthis._current = atom<StateNode | undefined>('toolState' + this.id, undefined)\n\n\t\tthis._path = computed('toolPath' + this.id, () => {\n\t\t\tconst current = this.getCurrent()\n\t\t\treturn this.id + (current ? `.${current.getPath()}` : '')\n\t\t})\n\n\t\tthis.parent = parent ?? ({} as any)\n\n\t\tif (this.parent) {\n\t\t\tif (children && initial) {\n\t\t\t\tthis.type = 'branch'\n\t\t\t\tthis.initial = initial\n\t\t\t\tthis.children = Object.fromEntries(\n\t\t\t\t\tchildren().map((Ctor) => [Ctor.id, new Ctor(this.editor, this)])\n\t\t\t\t)\n\t\t\t\tthis._current.set(this.children[this.initial])\n\t\t\t} else {\n\t\t\t\tthis.type = 'leaf'\n\t\t\t}\n\t\t} else {\n\t\t\tthis.type = 'root'\n\n\t\t\tif (children && initial) {\n\t\t\t\tthis.initial = initial\n\t\t\t\tthis.children = Object.fromEntries(\n\t\t\t\t\tchildren().map((Ctor) => [Ctor.id, new Ctor(this.editor, this)])\n\t\t\t\t)\n\t\t\t\tthis._current.set(this.children[this.initial])\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic id: string\n\tstatic initial?: string\n\tstatic children?: () => TLStateNodeConstructor[]\n\n\tid: string\n\ttype: TLStateNodeType\n\tshapeType?: string\n\tinitial?: string\n\tchildren?: Record<string, StateNode>\n\tparent: StateNode\n\n\t/**\n\t * This node's path of active state nodes\n\t *\n\t * @public\n\t */\n\tgetPath() {\n\t\treturn this._path.get()\n\t}\n\t_path: Computed<string>\n\n\t/**\n\t * This node's current active child node, if any.\n\t *\n\t * @public\n\t */\n\tgetCurrent() {\n\t\treturn this._current.get()\n\t}\n\tprivate _current: Atom<StateNode | undefined>\n\n\t/**\n\t * Whether this node is active.\n\t *\n\t * @public\n\t */\n\tgetIsActive() {\n\t\treturn this._isActive.get()\n\t}\n\tprivate _isActive: Atom<boolean>\n\n\t/**\n\t * Transition to a new active child state node.\n\t *\n\t * @example\n\t * ```ts\n\t * parentState.transition('childStateA')\n\t * parentState.transition('childStateB', { myData: 4 })\n\t *```\n\t *\n\t * @param id - The id of the child state node to transition to.\n\t * @param info - Any data to pass to the `onEnter` and `onExit` handlers.\n\t *\n\t * @public\n\t */\n\ttransition = (id: string, info: any = {}) => {\n\t\tconst path = id.split('.')\n\n\t\tlet currState = this as StateNode\n\n\t\tfor (let i = 0; i < path.length; i++) {\n\t\t\tconst id = path[i]\n\t\t\tconst prevChildState = currState.getCurrent()\n\t\t\tconst nextChildState = currState.children?.[id]\n\n\t\t\tif (!nextChildState) {\n\t\t\t\tthrow Error(`${currState.id} - no child state exists with the id ${id}.`)\n\t\t\t}\n\n\t\t\tif (prevChildState?.id !== nextChildState.id) {\n\t\t\t\tprevChildState?.exit(info, id)\n\t\t\t\tcurrState._current.set(nextChildState)\n\t\t\t\tnextChildState.enter(info, prevChildState?.id || 'initial')\n\t\t\t\tif (!nextChildState.getIsActive()) break\n\t\t\t}\n\n\t\t\tcurrState = nextChildState\n\t\t}\n\n\t\treturn this\n\t}\n\n\thandleEvent = (info: Exclude<TLEventInfo, TLPinchEventInfo>) => {\n\t\tconst cbName = EVENT_NAME_MAP[info.name]\n\t\tconst currentActiveChild = this._current.__unsafe__getWithoutCapture()\n\t\tthis[cbName]?.(info as any)\n\t\tif (\n\t\t\tthis._isActive.__unsafe__getWithoutCapture() &&\n\t\t\tcurrentActiveChild &&\n\t\t\tcurrentActiveChild === this._current.__unsafe__getWithoutCapture()\n\t\t) {\n\t\t\tcurrentActiveChild.handleEvent(info)\n\t\t}\n\t}\n\n\t// todo: move this logic into transition\n\tenter = (info: any, from: string) => {\n\t\tthis._isActive.set(true)\n\t\tthis.onEnter?.(info, from)\n\n\t\tif (this.children && this.initial && this.getIsActive()) {\n\t\t\tconst initial = this.children[this.initial]\n\t\t\tthis._current.set(initial)\n\t\t\tinitial.enter(info, from)\n\t\t}\n\t}\n\n\t// todo: move this logic into transition\n\texit = (info: any, from: string) => {\n\t\tthis._isActive.set(false)\n\t\tthis.onExit?.(info, from)\n\n\t\tif (!this.getIsActive()) {\n\t\t\tthis.getCurrent()?.exit(info, from)\n\t\t}\n\t}\n\n\t/**\n\t * This is a hack / escape hatch that will tell the editor to\n\t * report a different state as active (in `getCurrentToolId()`) when\n\t * this state is active. This is usually used when a tool transitions\n\t * to a child of a different state for a certain interaction and then\n\t * returns to the original tool when that interaction completes; and\n\t * where we would want to show the original tool as active in the UI.\n\t *\n\t * @public\n\t */\n\t_currentToolIdMask = atom('curent tool id mask', undefined as string | undefined)\n\n\tgetCurrentToolIdMask() {\n\t\treturn this._currentToolIdMask.get()\n\t}\n\n\tsetCurrentToolIdMask(id: string | undefined) {\n\t\tthis._currentToolIdMask.set(id)\n\t}\n\n\tonWheel?: TLEventHandlers['onWheel']\n\tonPointerDown?: TLEventHandlers['onPointerDown']\n\tonPointerMove?: TLEventHandlers['onPointerMove']\n\tonLongPress?: TLEventHandlers['onLongPress']\n\tonPointerUp?: TLEventHandlers['onPointerUp']\n\tonDoubleClick?: TLEventHandlers['onDoubleClick']\n\tonTripleClick?: TLEventHandlers['onTripleClick']\n\tonQuadrupleClick?: TLEventHandlers['onQuadrupleClick']\n\tonRightClick?: TLEventHandlers['onRightClick']\n\tonMiddleClick?: TLEventHandlers['onMiddleClick']\n\tonKeyDown?: TLEventHandlers['onKeyDown']\n\tonKeyUp?: TLEventHandlers['onKeyUp']\n\tonKeyRepeat?: TLEventHandlers['onKeyRepeat']\n\tonCancel?: TLEventHandlers['onCancel']\n\tonComplete?: TLEventHandlers['onComplete']\n\tonInterrupt?: TLEventHandlers['onInterrupt']\n\tonTick?: TLEventHandlers['onTick']\n\n\tonEnter?: TLEnterEventHandler\n\tonExit?: TLExitEventHandler\n}\n", "import { TLEventHandlers } from '../types/event-types'\nimport { StateNode } from './StateNode'\n\nexport class RootState extends StateNode {\n\tstatic override id = 'root'\n\tstatic override initial = ''\n\tstatic override children = () => []\n\n\toverride onKeyDown: TLEventHandlers['onKeyDown'] = (info) => {\n\t\t// todo: move this logic up to the tldraw library, as the \"zoom\" tool only exists there\n\t\tswitch (info.code) {\n\t\t\tcase 'KeyZ': {\n\t\t\t\tif (!(info.shiftKey || info.ctrlKey)) {\n\t\t\t\t\tconst currentTool = this.getCurrent()\n\t\t\t\t\tif (currentTool && currentTool.getCurrent()?.id === 'idle' && this.children!['zoom']) {\n\t\t\t\t\t\tthis.editor.setCurrentTool('zoom', { ...info, onInteractionEnd: currentTool.id })\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n}\n", "import { useValue } from '@tldraw/state'\nimport { useSvgExportContext } from '../editor/types/SvgExportContext'\nimport { useEditor } from './useEditor'\n\n/** @public */\nexport function useIsDarkMode() {\n\tconst editor = useEditor()\n\tconst exportContext = useSvgExportContext()\n\treturn useValue('isDarkMode', () => exportContext?.isDarkMode ?? editor.user.getIsDarkMode(), [\n\t\texportContext,\n\t\teditor,\n\t])\n}\n", "import { useQuickReactor } from '@tldraw/state'\nimport { TLCursorType } from '@tldraw/tlschema'\nimport { PI, radiansToDegrees } from '../primitives/utils'\nimport { useContainer } from './useContainer'\nimport { useEditor } from './useEditor'\nimport { useIsDarkMode } from './useIsDarkMode'\n\nconst CORNER_SVG = `<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>`\nconst EDGE_SVG = `<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>`\nconst ROTATE_CORNER_SVG = `<path d=\"M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z\" fill=\"black\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z\" fill=\"white\"/>`\n\nfunction getCursorCss(\n\tsvg: string,\n\tr: number,\n\ttr: number,\n\tf: boolean,\n\tcolor: string,\n\thotspotX = 16,\n\thotspotY = 16\n) {\n\tconst a = (-tr - r) * (PI / 180)\n\tconst s = Math.sin(a)\n\tconst c = Math.cos(a)\n\tconst dx = 1 * c - 1 * s\n\tconst dy = 1 * s + 1 * c\n\n\treturn (\n\t\t`url(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${color};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${dx}' dy='${dy}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${\n\t\t\tr + tr\n\t\t} 16 16)${f ? ` scale(-1,-1) translate(0, -32)` : ''}' filter='url(%23shadow)'>` +\n\t\tsvg.replaceAll(`\"`, `'`) +\n\t\t`</g></svg>\") ${hotspotX} ${hotspotY}, pointer`\n\t)\n}\n\nconst STATIC_CURSORS = [\n\t'default',\n\t'pointer',\n\t'cross',\n\t'move',\n\t'grab',\n\t'grabbing',\n\t'text',\n\t'zoom-in',\n\t'zoom-out',\n]\n\ntype CursorFunction = (rotation: number, flip: boolean, color: string) => string\n\nconst CURSORS: Record<TLCursorType, CursorFunction> = {\n\tnone: () => 'none',\n\t'ew-resize': (r, f, c) => getCursorCss(EDGE_SVG, r, 0, f, c),\n\t'ns-resize': (r, f, c) => getCursorCss(EDGE_SVG, r, 90, f, c),\n\t'nesw-resize': (r, f, c) => getCursorCss(CORNER_SVG, r, 0, f, c),\n\t'nwse-resize': (r, f, c) => getCursorCss(CORNER_SVG, r, 90, f, c),\n\t'nwse-rotate': (r, f, c) => getCursorCss(ROTATE_CORNER_SVG, r, 0, f, c),\n\t'nesw-rotate': (r, f, c) => getCursorCss(ROTATE_CORNER_SVG, r, 90, f, c),\n\t'senw-rotate': (r, f, c) => getCursorCss(ROTATE_CORNER_SVG, r, 180, f, c),\n\t'swne-rotate': (r, f, c) => getCursorCss(ROTATE_CORNER_SVG, r, 270, f, c),\n}\n\n/** @public */\nexport function getCursor(cursor: TLCursorType, rotation = 0, color = 'black') {\n\treturn CURSORS[cursor](radiansToDegrees(rotation), false, color)\n}\n\nexport function useCursor() {\n\tconst editor = useEditor()\n\tconst container = useContainer()\n\tconst isDarkMode = useIsDarkMode()\n\n\tuseQuickReactor(\n\t\t'useCursor',\n\t\t() => {\n\t\t\tconst { type, rotation } = editor.getInstanceState().cursor\n\n\t\t\tif (STATIC_CURSORS.includes(type)) {\n\t\t\t\tcontainer.style.setProperty('--tl-cursor', `var(--tl-cursor-${type})`)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tcontainer.style.setProperty(\n\t\t\t\t'--tl-cursor',\n\t\t\t\tgetCursor(type, rotation, isDarkMode ? 'white' : 'black')\n\t\t\t)\n\t\t},\n\t\t[editor, container, isDarkMode]\n\t)\n}\n", "import { useValue } from '@tldraw/state'\nimport React from 'react'\nimport { debugFlags } from '../utils/debug-flags'\nimport { useContainer } from './useContainer'\nimport { useEditor } from './useEditor'\nimport { useIsDarkMode } from './useIsDarkMode'\n\nexport function useDarkMode() {\n\tconst editor = useEditor()\n\tconst container = useContainer()\n\tconst isDarkMode = useIsDarkMode()\n\tconst forceSrgb = useValue(debugFlags.forceSrgb)\n\n\tReact.useEffect(() => {\n\t\tif (isDarkMode) {\n\t\t\tcontainer.setAttribute('data-color-mode', 'dark')\n\t\t\tcontainer.classList.remove('tl-theme__light')\n\t\t\tcontainer.classList.add('tl-theme__dark')\n\t\t} else {\n\t\t\tcontainer.setAttribute('data-color-mode', 'light')\n\t\t\tcontainer.classList.remove('tl-theme__dark')\n\t\t\tcontainer.classList.add('tl-theme__light')\n\t\t}\n\t\tif (forceSrgb) {\n\t\t\tcontainer.classList.add('tl-theme__force-sRGB')\n\t\t} else {\n\t\t\tcontainer.classList.remove('tl-theme__force-sRGB')\n\t\t}\n\t}, [editor, container, forceSrgb, isDarkMode])\n}\n", "import { assert } from '@tldraw/utils'\nimport { useCallback, useDebugValue, useLayoutEffect, useRef } from 'react'\n\n/**\n * Allows you to define event handlers that can read the latest props/state but has a stable\n * function identity.\n *\n * These event callbacks may not be called in React render functions! An error won't be thrown, but\n * in the real implementation it would be!\n *\n * Uses a modified version of the user-land implementation included in the [`useEvent()` RFC][1].\n * Our version until such a hook is available natively.\n *\n * The RFC was closed on 27 September 2022, the React team plans to come up with a new RFC to\n * provide similar functionality in the future. We will migrate to this functionality when\n * available.\n *\n * IMPORTANT CAVEAT: You should not call event callbacks in layout effects of React component\n * children! Internally this hook uses a layout effect and parent component layout effects run after\n * child component layout effects. Use this hook responsibly.\n *\n * [1]: https://github.com/reactjs/rfcs/pull/220\n *\n * @internal\n */\nexport function useEvent<Args extends Array<unknown>, Result>(\n\thandler: (...args: Args) => Result\n): (...args: Args) => Result {\n\tconst handlerRef = useRef<(...args: Args) => Result>()\n\n\t// In a real implementation, this would run before layout effects\n\tuseLayoutEffect(() => {\n\t\thandlerRef.current = handler\n\t})\n\n\tuseDebugValue(handler)\n\n\treturn useCallback((...args: Args) => {\n\t\t// In a real implementation, this would throw if called during render\n\t\tconst fn = handlerRef.current\n\t\tassert(fn, 'fn does not exist')\n\t\treturn fn(...args)\n\t}, [])\n}\n", "import { useLayoutEffect } from 'react'\nimport { useContainer } from './useContainer'\nimport { useEditor } from './useEditor'\n\n/** @internal */\nexport function useFocusEvents(autoFocus: boolean) {\n\tconst editor = useEditor()\n\tconst container = useContainer()\n\tuseLayoutEffect(() => {\n\t\tif (autoFocus) {\n\t\t\t// When autoFocus is true, update the editor state to be focused\n\t\t\t// unless it's already focused\n\t\t\tif (!editor.getInstanceState().isFocused) {\n\t\t\t\teditor.updateInstanceState({ isFocused: true })\n\t\t\t}\n\n\t\t\t// Note: Focus is also handled by the side effect manager in tldraw.\n\t\t\t// Importantly, if a user manually sets isFocused to true (or if it\n\t\t\t// changes for any reason from false to true), the side effect manager\n\t\t\t// in tldraw will also take care of the focus. However, it may be that\n\t\t\t// on first mount the editor already has isFocused: true in the model,\n\t\t\t// so we also need to focus it here just to be sure.\n\t\t\teditor.getContainer().focus()\n\t\t} else {\n\t\t\t// When autoFocus is false, update the editor state to be not focused\n\t\t\t// unless it's already not focused\n\t\t\tif (editor.getInstanceState().isFocused) {\n\t\t\t\teditor.updateInstanceState({ isFocused: false })\n\t\t\t}\n\t\t}\n\t}, [editor, container, autoFocus])\n}\n", "import { useEffect, useState } from 'react'\n\n/** @public */\nexport function useForceUpdate() {\n\tconst [_, ss] = useState(0)\n\tuseEffect(() => ss((s) => s + 1), [])\n}\n", "import { StoreSnapshot } from '@tldraw/store'\nimport { TLRecord } from '@tldraw/tlschema'\nimport { useEffect, useState } from 'react'\nimport { TLStoreOptions } from '../config/createTLStore'\nimport { TLStoreWithStatus } from '../utils/sync/StoreWithStatus'\nimport { TLLocalSyncClient } from '../utils/sync/TLLocalSyncClient'\nimport { uniqueId } from '../utils/uniqueId'\nimport { useTLStore } from './useTLStore'\n\n/** @internal */\nexport function useLocalStore({\n\tpersistenceKey,\n\tsessionId,\n\t...rest\n}: {\n\tpersistenceKey?: string\n\tsessionId?: string\n\tsnapshot?: StoreSnapshot<TLRecord>\n} & TLStoreOptions): TLStoreWithStatus {\n\tconst [state, setState] = useState<{ id: string; storeWithStatus: TLStoreWithStatus } | null>(\n\t\tnull\n\t)\n\tconst store = useTLStore(rest)\n\n\tuseEffect(() => {\n\t\tconst id = uniqueId()\n\n\t\tif (!persistenceKey) {\n\t\t\tsetState({\n\t\t\t\tid,\n\t\t\t\tstoreWithStatus: { status: 'not-synced', store },\n\t\t\t})\n\t\t\treturn\n\t\t}\n\n\t\tsetState({\n\t\t\tid,\n\t\t\tstoreWithStatus: { status: 'loading' },\n\t\t})\n\n\t\tconst setStoreWithStatus = (storeWithStatus: TLStoreWithStatus) => {\n\t\t\tsetState((prev) => {\n\t\t\t\tif (prev?.id === id) {\n\t\t\t\t\treturn { id, storeWithStatus }\n\t\t\t\t}\n\t\t\t\treturn prev\n\t\t\t})\n\t\t}\n\n\t\tconst client = new TLLocalSyncClient(store, {\n\t\t\tsessionId,\n\t\t\tpersistenceKey,\n\t\t\tonLoad() {\n\t\t\t\tsetStoreWithStatus({ store, status: 'synced-local' })\n\t\t\t},\n\t\t\tonLoadError(err: any) {\n\t\t\t\tsetStoreWithStatus({ status: 'error', error: err })\n\t\t\t},\n\t\t})\n\n\t\treturn () => {\n\t\t\tsetState((prevState) => (prevState?.id === id ? null : prevState))\n\t\t\tclient.close()\n\t\t}\n\t}, [persistenceKey, store, sessionId])\n\n\treturn state?.storeWithStatus ?? { status: 'loading' }\n}\n", "import { Signal, computed, transact } from '@tldraw/state'\nimport { RecordsDiff, UnknownRecord, squashRecordDiffs } from '@tldraw/store'\nimport {\n\tCameraRecordType,\n\tInstancePageStateRecordType,\n\tTLINSTANCE_ID,\n\tTLPageId,\n\tTLRecord,\n\tTLShapeId,\n\tTLStore,\n\tpageIdValidator,\n\tshapeIdValidator,\n} from '@tldraw/tlschema'\nimport {\n\tdeleteFromSessionStorage,\n\tgetFromSessionStorage,\n\tobjectMapFromEntries,\n\tsetInSessionStorage,\n\tstructuredClone,\n} from '@tldraw/utils'\nimport { T } from '@tldraw/validate'\nimport { uniqueId } from '../utils/uniqueId'\n\nconst tabIdKey = 'TLDRAW_TAB_ID_v2' as const\n\nconst window = globalThis.window as\n\t| {\n\t\t\tnavigator: Window['navigator']\n\t\t\taddEventListener: Window['addEventListener']\n\t\t\tTLDRAW_TAB_ID_v2?: string\n\t  }\n\t| undefined\n\n// https://stackoverflow.com/a/9039885\nfunction iOS() {\n\tif (!window) return false\n\treturn (\n\t\t['iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod'].includes(\n\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\twindow.navigator.platform\n\t\t) ||\n\t\t// iPad on iOS 13 detection\n\t\t(window.navigator.userAgent.includes('Mac') && 'ontouchend' in document)\n\t)\n}\n\n/**\n * A string that is unique per browser tab\n * @public\n */\nexport const TAB_ID: string = window\n\t? window[tabIdKey] ?? getFromSessionStorage(tabIdKey) ?? `TLDRAW_INSTANCE_STATE_V1_` + uniqueId()\n\t: '<error>'\nif (window) {\n\twindow[tabIdKey] = TAB_ID\n\tif (iOS()) {\n\t\t// iOS does not trigger beforeunload\n\t\t// so we need to keep the sessionStorage value around\n\t\t// and hope the user doesn't figure out a way to duplicate their tab\n\t\t// in which case they'll have two tabs with the same UI state.\n\t\t// It's not a big deal, but it's not ideal.\n\t\t// And anyway I can't see a way to duplicate a tab in iOS Safari.\n\t\tsetInSessionStorage(tabIdKey, TAB_ID)\n\t} else {\n\t\tdeleteFromSessionStorage(tabIdKey)\n\t}\n}\n\nwindow?.addEventListener('beforeunload', () => {\n\tsetInSessionStorage(tabIdKey, TAB_ID)\n})\n\nconst Versions = {\n\tInitial: 0,\n} as const\n\nconst CURRENT_SESSION_STATE_SNAPSHOT_VERSION = Math.max(...Object.values(Versions))\n\nfunction migrate(snapshot: any) {\n\tif (snapshot.version < Versions.Initial) {\n\t\t// initial version\n\t\t// noop\n\t}\n\t// add further migrations down here. see TLUserPreferences.ts for an example.\n\n\t// finally\n\tsnapshot.version = CURRENT_SESSION_STATE_SNAPSHOT_VERSION\n}\n\n/**\n * The state of the editor instance, not including any document state.\n *\n * @public\n */\nexport interface TLSessionStateSnapshot {\n\tversion: number\n\tcurrentPageId: TLPageId\n\tisFocusMode: boolean\n\texportBackground: boolean\n\tisDebugMode: boolean\n\tisToolLocked: boolean\n\tisGridMode: boolean\n\tpageStates: Array<{\n\t\tpageId: TLPageId\n\t\tcamera: { x: number; y: number; z: number }\n\t\tselectedShapeIds: TLShapeId[]\n\t\tfocusedGroupId: TLShapeId | null\n\t}>\n}\n\nconst sessionStateSnapshotValidator: T.Validator<TLSessionStateSnapshot> = T.object({\n\tversion: T.number,\n\tcurrentPageId: pageIdValidator,\n\tisFocusMode: T.boolean,\n\texportBackground: T.boolean,\n\tisDebugMode: T.boolean,\n\tisToolLocked: T.boolean,\n\tisGridMode: T.boolean,\n\tpageStates: T.arrayOf(\n\t\tT.object({\n\t\t\tpageId: pageIdValidator,\n\t\t\tcamera: T.object({\n\t\t\t\tx: T.number,\n\t\t\t\ty: T.number,\n\t\t\t\tz: T.number,\n\t\t\t}),\n\t\t\tselectedShapeIds: T.arrayOf(shapeIdValidator),\n\t\t\tfocusedGroupId: shapeIdValidator.nullable(),\n\t\t})\n\t),\n})\n\nfunction migrateAndValidateSessionStateSnapshot(state: unknown): TLSessionStateSnapshot | null {\n\tif (!state || typeof state !== 'object') {\n\t\tconsole.warn('Invalid instance state')\n\t\treturn null\n\t}\n\tif (!('version' in state) || typeof state.version !== 'number') {\n\t\tconsole.warn('No version in instance state')\n\t\treturn null\n\t}\n\tif (state.version !== CURRENT_SESSION_STATE_SNAPSHOT_VERSION) {\n\t\tstate = structuredClone(state)\n\t\tmigrate(state)\n\t}\n\n\ttry {\n\t\treturn sessionStateSnapshotValidator.validate(state)\n\t} catch (e) {\n\t\tconsole.warn(e)\n\t\treturn null\n\t}\n}\n\n/**\n * Creates a signal of the instance state for a given store.\n * @public\n * @param store - The store to create the instance state snapshot signal for\n * @returns\n */\nexport function createSessionStateSnapshotSignal(\n\tstore: TLStore\n): Signal<TLSessionStateSnapshot | null> {\n\tconst $allPageIds = store.query.ids('page')\n\n\treturn computed<TLSessionStateSnapshot | null>('sessionStateSnapshot', () => {\n\t\tconst instanceState = store.get(TLINSTANCE_ID)\n\t\tif (!instanceState) return null\n\n\t\tconst allPageIds = [...$allPageIds.get()]\n\t\treturn {\n\t\t\tversion: CURRENT_SESSION_STATE_SNAPSHOT_VERSION,\n\t\t\tcurrentPageId: instanceState.currentPageId,\n\t\t\texportBackground: instanceState.exportBackground,\n\t\t\tisFocusMode: instanceState.isFocusMode,\n\t\t\tisDebugMode: instanceState.isDebugMode,\n\t\t\tisToolLocked: instanceState.isToolLocked,\n\t\t\tisGridMode: instanceState.isGridMode,\n\t\t\tpageStates: allPageIds.map((id) => {\n\t\t\t\tconst ps = store.get(InstancePageStateRecordType.createId(id))\n\t\t\t\tconst camera = store.get(CameraRecordType.createId(id))\n\t\t\t\treturn {\n\t\t\t\t\tpageId: id,\n\t\t\t\t\tcamera: {\n\t\t\t\t\t\tx: camera?.x ?? 0,\n\t\t\t\t\t\ty: camera?.y ?? 0,\n\t\t\t\t\t\tz: camera?.z ?? 1,\n\t\t\t\t\t},\n\t\t\t\t\tselectedShapeIds: ps?.selectedShapeIds ?? [],\n\t\t\t\t\tfocusedGroupId: ps?.focusedGroupId ?? null,\n\t\t\t\t} satisfies TLSessionStateSnapshot['pageStates'][0]\n\t\t\t}),\n\t\t} satisfies TLSessionStateSnapshot\n\t})\n}\n\n/**\n * Loads a snapshot of the editor's instance state into the store of a new editor instance.\n *\n * @public\n * @param store - The store to load the instance state into\n * @param snapshot - The instance state snapshot to load\n * @returns\n */\nexport function loadSessionStateSnapshotIntoStore(\n\tstore: TLStore,\n\tsnapshot: TLSessionStateSnapshot\n) {\n\tconst res = migrateAndValidateSessionStateSnapshot(snapshot)\n\tif (!res) return\n\n\t// remove all page states and cameras and the instance state\n\tconst allPageStatesAndCameras = store\n\t\t.allRecords()\n\t\t.filter((r) => r.typeName === 'instance_page_state' || r.typeName === 'camera')\n\n\tconst removeDiff: RecordsDiff<TLRecord> = {\n\t\tadded: {},\n\t\tupdated: {},\n\t\tremoved: {\n\t\t\t...objectMapFromEntries(allPageStatesAndCameras.map((r) => [r.id, r])),\n\t\t},\n\t}\n\tif (store.has(TLINSTANCE_ID)) {\n\t\tremoveDiff.removed[TLINSTANCE_ID] = store.get(TLINSTANCE_ID)!\n\t}\n\n\tconst addDiff: RecordsDiff<TLRecord> = {\n\t\tremoved: {},\n\t\tupdated: {},\n\t\tadded: {\n\t\t\t[TLINSTANCE_ID]: store.schema.types.instance.create({\n\t\t\t\tid: TLINSTANCE_ID,\n\t\t\t\tcurrentPageId: res.currentPageId,\n\t\t\t\tisDebugMode: res.isDebugMode,\n\t\t\t\tisFocusMode: res.isFocusMode,\n\t\t\t\tisToolLocked: res.isToolLocked,\n\t\t\t\tisGridMode: res.isGridMode,\n\t\t\t\texportBackground: res.exportBackground,\n\t\t\t}),\n\t\t},\n\t}\n\n\t// replace them with new ones\n\tfor (const ps of res.pageStates) {\n\t\tconst cameraId = CameraRecordType.createId(ps.pageId)\n\t\tconst pageStateId = InstancePageStateRecordType.createId(ps.pageId)\n\t\taddDiff.added[cameraId] = CameraRecordType.create({\n\t\t\tid: CameraRecordType.createId(ps.pageId),\n\t\t\tx: ps.camera.x,\n\t\t\ty: ps.camera.y,\n\t\t\tz: ps.camera.z,\n\t\t})\n\t\taddDiff.added[pageStateId] = InstancePageStateRecordType.create({\n\t\t\tid: InstancePageStateRecordType.createId(ps.pageId),\n\t\t\tpageId: ps.pageId,\n\t\t\tselectedShapeIds: ps.selectedShapeIds,\n\t\t\tfocusedGroupId: ps.focusedGroupId,\n\t\t})\n\t}\n\n\ttransact(() => {\n\t\tstore.applyDiff(squashRecordDiffs([removeDiff, addDiff]))\n\t\tstore.ensureStoreIsUsable()\n\t})\n}\n\n/**\n * @internal\n */\nexport function extractSessionStateFromLegacySnapshot(\n\tstore: Record<string, UnknownRecord>\n): TLSessionStateSnapshot | null {\n\tconst instanceRecords = []\n\tfor (const record of Object.values(store)) {\n\t\tif (record.typeName?.match(/^(instance.*|pointer|camera)$/)) {\n\t\t\tinstanceRecords.push(record)\n\t\t}\n\t}\n\n\t// for scratch documents, we need to extract the most recently-used instance and it's associated page states\n\t// but oops we don't have the concept of \"most recently-used\" so we'll just take the first one\n\tconst oldInstance = instanceRecords.filter(\n\t\t(r) => r.typeName === 'instance' && r.id !== TLINSTANCE_ID\n\t)[0] as any\n\tif (!oldInstance) return null\n\n\tconst result: TLSessionStateSnapshot = {\n\t\tversion: CURRENT_SESSION_STATE_SNAPSHOT_VERSION,\n\t\tcurrentPageId: oldInstance.currentPageId,\n\t\texportBackground: !!oldInstance.exportBackground,\n\t\tisFocusMode: !!oldInstance.isFocusMode,\n\t\tisDebugMode: !!oldInstance.isDebugMode,\n\t\tisToolLocked: !!oldInstance.isToolLocked,\n\t\tisGridMode: false,\n\t\tpageStates: instanceRecords\n\t\t\t.filter((r: any) => r.typeName === 'instance_page_state' && r.instanceId === oldInstance.id)\n\t\t\t.map((ps: any): TLSessionStateSnapshot['pageStates'][0] => {\n\t\t\t\tconst camera = (store[ps.cameraId] as any) ?? { x: 0, y: 0, z: 1 }\n\t\t\t\treturn {\n\t\t\t\t\tpageId: ps.pageId,\n\t\t\t\t\tcamera: {\n\t\t\t\t\t\tx: camera.x,\n\t\t\t\t\t\ty: camera.y,\n\t\t\t\t\t\tz: camera.z,\n\t\t\t\t\t},\n\t\t\t\t\tselectedShapeIds: ps.selectedShapeIds,\n\t\t\t\t\tfocusedGroupId: ps.focusedGroupId,\n\t\t\t\t}\n\t\t\t}),\n\t}\n\n\ttry {\n\t\tsessionStateSnapshotValidator.validate(result)\n\t\treturn result\n\t} catch (e) {\n\t\treturn null\n\t}\n}\n", "/** @internal */\nexport function showCantWriteToIndexDbAlert() {\n\twindow.alert(\n\t\t`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.\n\nKeep seeing this message?\n\u2022 If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser.\n\u2022 If your hard disk is full, try clearing up some space and then reload the page.`\n\t)\n}\n\n/** @internal */\nexport function showCantReadFromIndexDbAlert() {\n\twindow.alert(\n\t\t`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.\n\nKeep seeing this message?\n\u2022 If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser.`\n\t)\n}\n", "const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n", "import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n", "import { RecordsDiff, SerializedSchema, SerializedStore } from '@tldraw/store'\nimport { TLRecord, TLStoreSchema } from '@tldraw/tlschema'\nimport { getFromLocalStorage, setInLocalStorage } from '@tldraw/utils'\nimport { IDBPDatabase, openDB } from 'idb'\nimport { TLSessionStateSnapshot } from '../../config/TLSessionStateSnapshot'\n\n// DO NOT CHANGE THESE WITHOUT ADDING MIGRATION LOGIC. DOING SO WOULD WIPE ALL EXISTING DATA.\nconst STORE_PREFIX = 'TLDRAW_DOCUMENT_v2'\nconst dbNameIndexKey = 'TLDRAW_DB_NAME_INDEX_v2'\n\nconst Table = {\n\tRecords: 'records',\n\tSchema: 'schema',\n\tSessionState: 'session_state',\n} as const\n\ntype StoreName = (typeof Table)[keyof typeof Table]\n\nasync function withDb<T>(storeId: string, cb: (db: IDBPDatabase<StoreName>) => Promise<T>) {\n\taddDbName(storeId)\n\tconst db = await openDB<StoreName>(storeId, 3, {\n\t\tupgrade(database) {\n\t\t\tif (!database.objectStoreNames.contains(Table.Records)) {\n\t\t\t\tdatabase.createObjectStore(Table.Records)\n\t\t\t}\n\t\t\tif (!database.objectStoreNames.contains(Table.Schema)) {\n\t\t\t\tdatabase.createObjectStore(Table.Schema)\n\t\t\t}\n\t\t\tif (!database.objectStoreNames.contains(Table.SessionState)) {\n\t\t\t\tdatabase.createObjectStore(Table.SessionState)\n\t\t\t}\n\t\t},\n\t})\n\ttry {\n\t\treturn await cb(db)\n\t} finally {\n\t\tdb.close()\n\t}\n}\n\ntype LoadResult = {\n\trecords: TLRecord[]\n\tschema?: SerializedSchema\n\tsessionStateSnapshot?: TLSessionStateSnapshot | null\n}\n\ntype SessionStateSnapshotRow = {\n\tid: string\n\tsnapshot: TLSessionStateSnapshot\n\tupdatedAt: number\n}\n\n/** @internal */\nexport async function loadDataFromStore({\n\tpersistenceKey,\n\tsessionId,\n\tdidCancel,\n}: {\n\tpersistenceKey: string\n\tsessionId?: string\n\tdidCancel?: () => boolean\n}): Promise<undefined | LoadResult> {\n\tconst storeId = STORE_PREFIX + persistenceKey\n\tif (!getAllIndexDbNames().includes(storeId)) return undefined\n\tawait pruneSessionState({ persistenceKey, didCancel })\n\treturn await withDb(storeId, async (db) => {\n\t\tif (didCancel?.()) return undefined\n\t\tconst tx = db.transaction([Table.Records, Table.Schema, Table.SessionState], 'readonly')\n\t\tconst recordsStore = tx.objectStore(Table.Records)\n\t\tconst schemaStore = tx.objectStore(Table.Schema)\n\t\tconst sessionStateStore = tx.objectStore(Table.SessionState)\n\t\tlet sessionStateSnapshot = sessionId\n\t\t\t? ((await sessionStateStore.get(sessionId)) as SessionStateSnapshotRow | undefined)?.snapshot\n\t\t\t: null\n\t\tif (!sessionStateSnapshot) {\n\t\t\t// get the most recent session state\n\t\t\tconst all = (await sessionStateStore.getAll()) as SessionStateSnapshotRow[]\n\t\t\tsessionStateSnapshot = all.sort((a, b) => a.updatedAt - b.updatedAt).pop()?.snapshot\n\t\t}\n\t\tconst result = {\n\t\t\trecords: await recordsStore.getAll(),\n\t\t\tschema: await schemaStore.get(Table.Schema),\n\t\t\tsessionStateSnapshot,\n\t\t} satisfies LoadResult\n\t\tif (didCancel?.()) {\n\t\t\ttx.abort()\n\t\t\treturn undefined\n\t\t}\n\t\tawait tx.done\n\t\treturn result\n\t})\n}\n\n/** @internal */\nexport async function storeChangesInIndexedDb({\n\tpersistenceKey,\n\tschema,\n\tchanges,\n\tsessionId,\n\tsessionStateSnapshot,\n\tdidCancel,\n}: {\n\tpersistenceKey: string\n\tschema: TLStoreSchema\n\tchanges: RecordsDiff<any>\n\tsessionId?: string | null\n\tsessionStateSnapshot?: TLSessionStateSnapshot | null\n\tdidCancel?: () => boolean\n}) {\n\tconst storeId = STORE_PREFIX + persistenceKey\n\tawait withDb(storeId, async (db) => {\n\t\tconst tx = db.transaction([Table.Records, Table.Schema, Table.SessionState], 'readwrite')\n\t\tconst recordsStore = tx.objectStore(Table.Records)\n\t\tconst schemaStore = tx.objectStore(Table.Schema)\n\t\tconst sessionStateStore = tx.objectStore(Table.SessionState)\n\n\t\tfor (const [id, record] of Object.entries(changes.added)) {\n\t\t\tawait recordsStore.put(record, id)\n\t\t}\n\n\t\tfor (const [_prev, updated] of Object.values(changes.updated)) {\n\t\t\tawait recordsStore.put(updated, updated.id)\n\t\t}\n\n\t\tfor (const id of Object.keys(changes.removed)) {\n\t\t\tawait recordsStore.delete(id)\n\t\t}\n\n\t\tschemaStore.put(schema.serialize(), Table.Schema)\n\t\tif (sessionStateSnapshot && sessionId) {\n\t\t\tsessionStateStore.put(\n\t\t\t\t{\n\t\t\t\t\tsnapshot: sessionStateSnapshot,\n\t\t\t\t\tupdatedAt: Date.now(),\n\t\t\t\t\tid: sessionId,\n\t\t\t\t} satisfies SessionStateSnapshotRow,\n\t\t\t\tsessionId\n\t\t\t)\n\t\t} else if (sessionStateSnapshot || sessionId) {\n\t\t\tconsole.error('sessionStateSnapshot and instanceId must be provided together')\n\t\t}\n\n\t\tif (didCancel?.()) return tx.abort()\n\n\t\tawait tx.done\n\t})\n}\n\n/** @internal */\nexport async function storeSnapshotInIndexedDb({\n\tpersistenceKey,\n\tschema,\n\tsnapshot,\n\tsessionId,\n\tsessionStateSnapshot,\n\tdidCancel,\n}: {\n\tpersistenceKey: string\n\tschema: TLStoreSchema\n\tsnapshot: SerializedStore<any>\n\tsessionId?: string | null\n\tsessionStateSnapshot?: TLSessionStateSnapshot | null\n\tdidCancel?: () => boolean\n}) {\n\tconst storeId = STORE_PREFIX + persistenceKey\n\tawait withDb(storeId, async (db) => {\n\t\tconst tx = db.transaction([Table.Records, Table.Schema, Table.SessionState], 'readwrite')\n\t\tconst recordsStore = tx.objectStore(Table.Records)\n\t\tconst schemaStore = tx.objectStore(Table.Schema)\n\t\tconst sessionStateStore = tx.objectStore(Table.SessionState)\n\n\t\tawait recordsStore.clear()\n\n\t\tfor (const [id, record] of Object.entries(snapshot)) {\n\t\t\tawait recordsStore.put(record, id)\n\t\t}\n\n\t\tschemaStore.put(schema.serialize(), Table.Schema)\n\n\t\tif (sessionStateSnapshot && sessionId) {\n\t\t\tsessionStateStore.put(\n\t\t\t\t{\n\t\t\t\t\tsnapshot: sessionStateSnapshot,\n\t\t\t\t\tupdatedAt: Date.now(),\n\t\t\t\t\tid: sessionId,\n\t\t\t\t} satisfies SessionStateSnapshotRow,\n\t\t\t\tsessionId\n\t\t\t)\n\t\t} else if (sessionStateSnapshot || sessionId) {\n\t\t\tconsole.error('sessionStateSnapshot and instanceId must be provided together')\n\t\t}\n\n\t\tif (didCancel?.()) return tx.abort()\n\n\t\tawait tx.done\n\t})\n}\n\nasync function pruneSessionState({\n\tpersistenceKey,\n\tdidCancel,\n}: {\n\tpersistenceKey: string\n\tdidCancel?: () => boolean\n}) {\n\tawait withDb(STORE_PREFIX + persistenceKey, async (db) => {\n\t\tconst tx = db.transaction([Table.SessionState], 'readwrite')\n\t\tconst sessionStateStore = tx.objectStore(Table.SessionState)\n\t\tconst all = (await sessionStateStore.getAll()).sort((a, b) => a.updatedAt - b.updatedAt)\n\t\tif (all.length < 10) {\n\t\t\tawait tx.done\n\t\t\treturn\n\t\t}\n\t\tconst toDelete = all.slice(0, all.length - 10)\n\t\tfor (const { id } of toDelete) {\n\t\t\tawait sessionStateStore.delete(id)\n\t\t}\n\t\tif (didCancel?.()) return tx.abort()\n\t\tawait tx.done\n\t})\n}\n\n/** @internal */\nexport function getAllIndexDbNames(): string[] {\n\tconst result = JSON.parse(getFromLocalStorage(dbNameIndexKey) || '[]') ?? []\n\tif (!Array.isArray(result)) {\n\t\treturn []\n\t}\n\treturn result\n}\n\nfunction addDbName(name: string) {\n\tconst all = new Set(getAllIndexDbNames())\n\tall.add(name)\n\tsetInLocalStorage(dbNameIndexKey, JSON.stringify([...all]))\n}\n", "import { Signal, transact } from '@tldraw/state'\nimport { RecordsDiff, SerializedSchema, UnknownRecord, squashRecordDiffs } from '@tldraw/store'\nimport { TLStore } from '@tldraw/tlschema'\nimport { assert } from '@tldraw/utils'\nimport {\n\tTAB_ID,\n\tTLSessionStateSnapshot,\n\tcreateSessionStateSnapshotSignal,\n\textractSessionStateFromLegacySnapshot,\n\tloadSessionStateSnapshotIntoStore,\n} from '../../config/TLSessionStateSnapshot'\nimport { showCantReadFromIndexDbAlert, showCantWriteToIndexDbAlert } from './alerts'\nimport { loadDataFromStore, storeChangesInIndexedDb, storeSnapshotInIndexedDb } from './indexedDb'\n\n/** How should we debounce persists? */\nconst PERSIST_THROTTLE_MS = 350\n/** If we're in an error state, how long should we wait before retrying a write? */\nconst PERSIST_RETRY_THROTTLE_MS = 10_000\n\nconst UPDATE_INSTANCE_STATE = Symbol('UPDATE_INSTANCE_STATE')\n\n/**\n * IMPORTANT!!!\n *\n * This is just a quick-n-dirty temporary solution that will be replaced with the remote sync client\n * once it has the db integrated\n */\n\ntype SyncMessage = {\n\ttype: 'diff'\n\tstoreId: string\n\tchanges: RecordsDiff<UnknownRecord>\n\tschema: SerializedSchema\n}\n\n// Sent by new clients when they connect\n// If another client is on the channel with a newer schema version\n// It will\ntype AnnounceMessage = {\n\ttype: 'announce'\n\tschema: SerializedSchema\n}\n\ntype Message = SyncMessage | AnnounceMessage\n\ntype UnpackPromise<T> = T extends Promise<infer U> ? U : T\n\nconst msg = (msg: Message) => msg\n\n/** @internal */\nexport class BroadcastChannelMock {\n\tonmessage?: (e: MessageEvent) => void\n\tconstructor(_name: string) {\n\t\t// noop\n\t}\n\tpostMessage(_msg: Message) {\n\t\t// noop\n\t}\n\tclose() {\n\t\t// noop\n\t}\n}\n\nconst BC = typeof BroadcastChannel === 'undefined' ? BroadcastChannelMock : BroadcastChannel\n\n/** @internal */\nexport class TLLocalSyncClient {\n\tprivate disposables = new Set<() => void>()\n\tprivate diffQueue: Array<RecordsDiff<UnknownRecord> | typeof UPDATE_INSTANCE_STATE> = []\n\tprivate didDispose = false\n\tprivate shouldDoFullDBWrite = true\n\tprivate isReloading = false\n\treadonly persistenceKey: string\n\treadonly sessionId: string\n\treadonly serializedSchema: SerializedSchema\n\tprivate isDebugging = false\n\tprivate readonly documentTypes: ReadonlySet<string>\n\tprivate readonly $sessionStateSnapshot: Signal<TLSessionStateSnapshot | null>\n\n\tinitTime = Date.now()\n\tprivate debug(...args: any[]) {\n\t\tif (this.isDebugging) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.debug(...args)\n\t\t}\n\t}\n\tconstructor(\n\t\tpublic readonly store: TLStore,\n\t\t{\n\t\t\tpersistenceKey,\n\t\t\tsessionId = TAB_ID,\n\t\t\tonLoad,\n\t\t\tonLoadError,\n\t\t}: {\n\t\t\tpersistenceKey: string\n\t\t\tsessionId?: string\n\t\t\tonLoad: (self: TLLocalSyncClient) => void\n\t\t\tonLoadError: (error: Error) => void\n\t\t},\n\t\tpublic readonly channel = new BC(`tldraw-tab-sync-${persistenceKey}`)\n\t) {\n\t\tif (typeof window !== 'undefined') {\n\t\t\t;(window as any).tlsync = this\n\t\t}\n\t\tthis.persistenceKey = persistenceKey\n\t\tthis.sessionId = sessionId\n\n\t\tthis.serializedSchema = this.store.schema.serialize()\n\t\tthis.$sessionStateSnapshot = createSessionStateSnapshotSignal(this.store)\n\n\t\tthis.disposables.add(\n\t\t\t// Set up a subscription to changes from the store: When\n\t\t\t// the store changes (and if the change was made by the user)\n\t\t\t// then immediately send the diff to other tabs via postMessage\n\t\t\t// and schedule a persist.\n\t\t\tstore.listen(\n\t\t\t\t({ changes }) => {\n\t\t\t\t\tthis.diffQueue.push(changes)\n\t\t\t\t\tthis.channel.postMessage(\n\t\t\t\t\t\tmsg({\n\t\t\t\t\t\t\ttype: 'diff',\n\t\t\t\t\t\t\tstoreId: this.store.id,\n\t\t\t\t\t\t\tchanges,\n\t\t\t\t\t\t\tschema: this.serializedSchema,\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\t\tthis.schedulePersist()\n\t\t\t\t},\n\t\t\t\t{ source: 'user', scope: 'document' }\n\t\t\t)\n\t\t)\n\t\tthis.disposables.add(\n\t\t\tstore.listen(\n\t\t\t\t() => {\n\t\t\t\t\tthis.diffQueue.push(UPDATE_INSTANCE_STATE)\n\t\t\t\t\tthis.schedulePersist()\n\t\t\t\t},\n\t\t\t\t{ scope: 'session' }\n\t\t\t)\n\t\t)\n\n\t\tthis.connect(onLoad, onLoadError)\n\n\t\tthis.documentTypes = new Set(\n\t\t\tObject.values(this.store.schema.types)\n\t\t\t\t.filter((t) => t.scope === 'document')\n\t\t\t\t.map((t) => t.typeName)\n\t\t)\n\t}\n\n\tprivate async connect(onLoad: (client: this) => void, onLoadError: (error: Error) => void) {\n\t\tthis.debug('connecting')\n\t\tlet data: UnpackPromise<ReturnType<typeof loadDataFromStore>> | undefined\n\n\t\ttry {\n\t\t\tdata = await loadDataFromStore({\n\t\t\t\tpersistenceKey: this.persistenceKey,\n\t\t\t\tsessionId: this.sessionId,\n\t\t\t\tdidCancel: () => this.didDispose,\n\t\t\t})\n\t\t} catch (error: any) {\n\t\t\tonLoadError(error)\n\t\t\tshowCantReadFromIndexDbAlert()\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\twindow.location.reload()\n\t\t\t}\n\t\t\treturn\n\t\t}\n\n\t\tthis.debug('loaded data from store', data, 'didDispose', this.didDispose)\n\t\tif (this.didDispose) return\n\n\t\ttry {\n\t\t\tif (data) {\n\t\t\t\tconst documentSnapshot = Object.fromEntries(data.records.map((r) => [r.id, r]))\n\t\t\t\tconst sessionStateSnapshot =\n\t\t\t\t\tdata.sessionStateSnapshot ?? extractSessionStateFromLegacySnapshot(documentSnapshot)\n\t\t\t\tconst migrationResult = this.store.schema.migrateStoreSnapshot({\n\t\t\t\t\tstore: documentSnapshot,\n\t\t\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\t\t\tschema: data.schema ?? this.store.schema.serializeEarliestVersion(),\n\t\t\t\t})\n\n\t\t\t\tif (migrationResult.type === 'error') {\n\t\t\t\t\tconsole.error('failed to migrate store', migrationResult)\n\t\t\t\t\tonLoadError(new Error(`Failed to migrate store: ${migrationResult.reason}`))\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// 3. Merge the changes into the REAL STORE\n\t\t\t\tthis.store.mergeRemoteChanges(() => {\n\t\t\t\t\t// Calling put will validate the records!\n\t\t\t\t\tthis.store.put(\n\t\t\t\t\t\tObject.values(migrationResult.value).filter((r) => this.documentTypes.has(r.typeName)),\n\t\t\t\t\t\t'initialize'\n\t\t\t\t\t)\n\t\t\t\t})\n\n\t\t\t\tif (sessionStateSnapshot) {\n\t\t\t\t\tloadSessionStateSnapshotIntoStore(this.store, sessionStateSnapshot)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.channel.onmessage = ({ data }) => {\n\t\t\t\tthis.debug('got message', data)\n\t\t\t\tconst msg = data as Message\n\t\t\t\t// if their schema is earlier than ours, we need to tell them so they can refresh\n\t\t\t\t// if their schema is later than ours, we need to refresh\n\t\t\t\tconst res = this.store.schema.getMigrationsSince(msg.schema)\n\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\t// we are older, refresh\n\t\t\t\t\t// but add a safety check to make sure we don't get in an infinite loop\n\t\t\t\t\tconst timeSinceInit = Date.now() - this.initTime\n\t\t\t\t\tif (timeSinceInit < 5000) {\n\t\t\t\t\t\t// This tab was just reloaded, but is out of date compared to other tabs.\n\t\t\t\t\t\t// Not expecting this to ever happen. It should only happen if we roll back a release that incremented\n\t\t\t\t\t\t// the schema version (which we should never do)\n\t\t\t\t\t\t// Or maybe during development if you have multiple local tabs open running the app on prod mode and you\n\t\t\t\t\t\t// check out an older commit. Dev server should be fine.\n\t\t\t\t\t\tonLoadError(new Error('Schema mismatch, please close other tabs and reload the page'))\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tthis.debug('reloading')\n\t\t\t\t\tthis.isReloading = true\n\t\t\t\t\twindow?.location?.reload?.()\n\t\t\t\t\treturn\n\t\t\t\t} else if (res.value.length > 0) {\n\t\t\t\t\t// they are older, tell them to refresh and not write any more data\n\t\t\t\t\tthis.debug('telling them to reload')\n\t\t\t\t\tthis.channel.postMessage({ type: 'announce', schema: this.serializedSchema })\n\t\t\t\t\t// schedule a full db write in case they wrote data anyway\n\t\t\t\t\tthis.shouldDoFullDBWrite = true\n\t\t\t\t\tthis.persistIfNeeded()\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t// otherwise, all good, same version :)\n\t\t\t\tif (msg.type === 'diff') {\n\t\t\t\t\tthis.debug('applying diff')\n\t\t\t\t\ttransact(() => {\n\t\t\t\t\t\tthis.store.mergeRemoteChanges(() => {\n\t\t\t\t\t\t\tthis.store.applyDiff(msg.changes as any)\n\t\t\t\t\t\t\tthis.store.ensureStoreIsUsable()\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.channel.postMessage({ type: 'announce', schema: this.serializedSchema })\n\t\t\tthis.disposables.add(() => {\n\t\t\t\tthis.channel.close()\n\t\t\t})\n\t\t\tonLoad(this)\n\t\t} catch (e: any) {\n\t\t\tthis.debug('error loading data from store', e)\n\t\t\tif (this.didDispose) return\n\t\t\tonLoadError(e)\n\t\t\treturn\n\t\t}\n\t}\n\n\tclose() {\n\t\tthis.debug('closing')\n\t\tthis.didDispose = true\n\t\tthis.disposables.forEach((d) => d())\n\t}\n\n\tprivate isPersisting = false\n\tprivate didLastWriteError = false\n\tprivate scheduledPersistTimeout: ReturnType<typeof setTimeout> | null = null\n\n\t/**\n\t * Schedule a persist. Persists don't happen immediately: they are throttled to avoid writing too\n\t * often, and will retry if failed.\n\t *\n\t * @internal\n\t */\n\tprivate schedulePersist() {\n\t\tthis.debug('schedulePersist', this.scheduledPersistTimeout)\n\t\tif (this.scheduledPersistTimeout) return\n\t\tthis.scheduledPersistTimeout = setTimeout(\n\t\t\t() => {\n\t\t\t\tthis.scheduledPersistTimeout = null\n\t\t\t\tthis.persistIfNeeded()\n\t\t\t},\n\t\t\tthis.didLastWriteError ? PERSIST_RETRY_THROTTLE_MS : PERSIST_THROTTLE_MS\n\t\t)\n\t}\n\n\t/**\n\t * Persist to IndexedDB only under certain circumstances:\n\t *\n\t * - If we're not already persisting\n\t * - If we're not reloading the page\n\t * - And we have something to persist (a full db write scheduled or changes in the diff queue)\n\t *\n\t * @internal\n\t */\n\tprivate persistIfNeeded() {\n\t\tthis.debug('persistIfNeeded', {\n\t\t\tisPersisting: this.isPersisting,\n\t\t\tisReloading: this.isReloading,\n\t\t\tshouldDoFullDBWrite: this.shouldDoFullDBWrite,\n\t\t\tdiffQueueLength: this.diffQueue.length,\n\t\t\tstoreIsPossiblyCorrupt: this.store.isPossiblyCorrupted(),\n\t\t})\n\n\t\t// if we've scheduled a persist for the future, that's no longer needed\n\t\tif (this.scheduledPersistTimeout) {\n\t\t\tclearTimeout(this.scheduledPersistTimeout)\n\t\t\tthis.scheduledPersistTimeout = null\n\t\t}\n\n\t\t// if a persist is already in progress, we don't need to do anything -\n\t\t// if there are still outstanding changes once it's finished, it'll\n\t\t// schedule another persist\n\t\tif (this.isPersisting) return\n\n\t\t// if we're reloading the page, it's because there's a newer client\n\t\t// present so lets not overwrite their changes\n\t\tif (this.isReloading) return\n\n\t\t// if the store is possibly corrupted, we don't want to persist\n\t\tif (this.store.isPossiblyCorrupted()) return\n\n\t\t// if we're scheduled for a full write or if we have changes outstanding, let's persist them!\n\t\tif (this.shouldDoFullDBWrite || this.diffQueue.length > 0) {\n\t\t\tthis.doPersist()\n\t\t}\n\t}\n\n\t/**\n\t * Actually persist to IndexedDB. If the write fails, then we'll retry with a full db write after\n\t * a short delay.\n\t */\n\tprivate async doPersist() {\n\t\tassert(!this.isPersisting, 'persist already in progress')\n\t\tthis.isPersisting = true\n\n\t\tthis.debug('doPersist start')\n\n\t\t// instantly empty the diff queue, but keep our own copy of it. this way\n\t\t// diffs that come in during the persist will still get tracked\n\t\tconst diffQueue = this.diffQueue\n\t\tthis.diffQueue = []\n\n\t\ttry {\n\t\t\tif (this.shouldDoFullDBWrite) {\n\t\t\t\tthis.shouldDoFullDBWrite = false\n\t\t\t\tawait storeSnapshotInIndexedDb({\n\t\t\t\t\tpersistenceKey: this.persistenceKey,\n\t\t\t\t\tschema: this.store.schema,\n\t\t\t\t\tsnapshot: this.store.serialize(),\n\t\t\t\t\tdidCancel: () => this.didDispose,\n\t\t\t\t\tsessionId: this.sessionId,\n\t\t\t\t\tsessionStateSnapshot: this.$sessionStateSnapshot.get(),\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tconst diffs = squashRecordDiffs(\n\t\t\t\t\tdiffQueue.filter((d): d is RecordsDiff<UnknownRecord> => d !== UPDATE_INSTANCE_STATE)\n\t\t\t\t)\n\t\t\t\tawait storeChangesInIndexedDb({\n\t\t\t\t\tpersistenceKey: this.persistenceKey,\n\t\t\t\t\tchanges: diffs,\n\t\t\t\t\tschema: this.store.schema,\n\t\t\t\t\tdidCancel: () => this.didDispose,\n\t\t\t\t\tsessionId: this.sessionId,\n\t\t\t\t\tsessionStateSnapshot: this.$sessionStateSnapshot.get(),\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.didLastWriteError = false\n\t\t} catch (e) {\n\t\t\t// set this.shouldDoFullDBWrite because we clear the diffQueue no matter what,\n\t\t\t// so if this is just a temporary error, we will still persist all changes\n\t\t\tthis.shouldDoFullDBWrite = true\n\t\t\tthis.didLastWriteError = true\n\t\t\tconsole.error('failed to store changes in indexed db', e)\n\n\t\t\tshowCantWriteToIndexDbAlert()\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\t// adios\n\t\t\t\twindow.location.reload()\n\t\t\t}\n\t\t}\n\n\t\tthis.isPersisting = false\n\t\tthis.debug('doPersist end')\n\n\t\t// changes might have come in between when we started the persist and\n\t\t// now. we request another persist so any new changes can get written\n\t\tthis.schedulePersist()\n\t}\n}\n", "import { StoreSnapshot } from '@tldraw/store'\nimport { TLRecord } from '@tldraw/tlschema'\nimport { areObjectsShallowEqual } from '@tldraw/utils'\nimport { useState } from 'react'\nimport { TLStoreOptions, createTLStore } from '../config/createTLStore'\n\n/** @public */\ntype UseTLStoreOptions = TLStoreOptions & {\n\tsnapshot?: StoreSnapshot<TLRecord>\n}\n\nfunction createStore(opts: UseTLStoreOptions) {\n\tconst store = createTLStore(opts)\n\tif (opts.snapshot) {\n\t\tstore.loadSnapshot(opts.snapshot)\n\t}\n\treturn { store, opts }\n}\n\n/** @public */\nexport function useTLStore(opts: TLStoreOptions & { snapshot?: StoreSnapshot<TLRecord> }) {\n\tconst [current, setCurrent] = useState(() => createStore(opts))\n\n\tif (!areObjectsShallowEqual(current.opts, opts)) {\n\t\tconst next = createStore(opts)\n\t\tsetCurrent(next)\n\t\treturn next.store\n\t}\n\n\treturn current.store\n}\n", "import { HistoryEntry, MigrationSequence, SerializedStore, Store, StoreSchema } from '@tldraw/store'\nimport {\n\tSchemaShapeInfo,\n\tTLRecord,\n\tTLStore,\n\tTLStoreProps,\n\tTLUnknownShape,\n\tcreateTLSchema,\n} from '@tldraw/tlschema'\nimport { TLShapeUtilConstructor } from '../editor/shapes/ShapeUtil'\nimport { TLAnyShapeUtilConstructor, checkShapesAndAddCore } from './defaultShapes'\n\n/** @public */\nexport type TLStoreOptions = {\n\tinitialData?: SerializedStore<TLRecord>\n\tdefaultName?: string\n} & (\n\t| { shapeUtils?: readonly TLAnyShapeUtilConstructor[]; migrations?: readonly MigrationSequence[] }\n\t| { schema?: StoreSchema<TLRecord, TLStoreProps> }\n)\n\n/** @public */\nexport type TLStoreEventInfo = HistoryEntry<TLRecord>\n\n/**\n * A helper for creating a TLStore. Custom shapes cannot override default shapes.\n *\n * @param opts - Options for creating the store.\n *\n * @public */\nexport function createTLStore({ initialData, defaultName = '', ...rest }: TLStoreOptions): TLStore {\n\tconst schema =\n\t\t'schema' in rest && rest.schema\n\t\t\t? // we have a schema\n\t\t\t\trest.schema\n\t\t\t: // we need a schema\n\t\t\t\tcreateTLSchema({\n\t\t\t\t\tshapes: currentPageShapesToShapeMap(\n\t\t\t\t\t\tcheckShapesAndAddCore('shapeUtils' in rest && rest.shapeUtils ? rest.shapeUtils : [])\n\t\t\t\t\t),\n\t\t\t\t\tmigrations: 'migrations' in rest ? rest.migrations : [],\n\t\t\t\t})\n\n\treturn new Store({\n\t\tschema,\n\t\tinitialData,\n\t\tprops: {\n\t\t\tdefaultName,\n\t\t},\n\t})\n}\n\nfunction currentPageShapesToShapeMap(shapeUtils: TLShapeUtilConstructor<TLUnknownShape>[]) {\n\treturn Object.fromEntries(\n\t\tshapeUtils.map((s): [string, SchemaShapeInfo] => [\n\t\t\ts.type,\n\t\t\t{\n\t\t\t\tprops: s.props,\n\t\t\t\tmigrations: s.migrations,\n\t\t\t},\n\t\t])\n\t)\n}\n", "import * as React from 'react'\nimport { useEditor } from './useEditor'\n\nlet isMobileSafari = false\n\nif (typeof window !== 'undefined') {\n\tconst ua = window.navigator.userAgent\n\tconst iOS = !!ua.match(/iPad/i) || !!ua.match(/iPhone/i)\n\tconst webkit = !!ua.match(/WebKit/i)\n\tisMobileSafari = iOS && webkit && !ua.match(/CriOS/i)\n}\n\nexport function useSafariFocusOutFix(): void {\n\tconst editor = useEditor()\n\n\tReact.useEffect(() => {\n\t\tif (!isMobileSafari) return\n\n\t\tfunction handleFocusOut(e: FocusEvent) {\n\t\t\tif (\n\t\t\t\t(e.target instanceof HTMLInputElement && e.target.type === 'text') ||\n\t\t\t\te.target instanceof HTMLTextAreaElement\n\t\t\t) {\n\t\t\t\teditor.complete()\n\t\t\t}\n\t\t}\n\n\t\t// Send event on iOS when a user presses the \"Done\" key while editing a text element.\n\t\tdocument.addEventListener('focusout', handleFocusOut)\n\t\treturn () => document.removeEventListener('focusout', handleFocusOut)\n\t}, [editor])\n}\n", "import { EffectScheduler } from '@tldraw/state'\nimport { debounce } from '@tldraw/utils'\nimport * as React from 'react'\nimport { useContainer } from './useContainer'\nimport { useEditor } from './useEditor'\n\nexport function useZoomCss() {\n\tconst editor = useEditor()\n\tconst container = useContainer()\n\n\tReact.useEffect(() => {\n\t\tconst setScale = (s: number) => container.style.setProperty('--tl-zoom', s.toString())\n\t\tconst setScaleDebounced = debounce(setScale, 100)\n\n\t\tconst scheduler = new EffectScheduler('useZoomCss', () => {\n\t\t\tconst numShapes = editor.getCurrentPageShapeIds().size\n\t\t\tif (numShapes < 300) {\n\t\t\t\tsetScale(editor.getZoomLevel())\n\t\t\t} else {\n\t\t\t\tsetScaleDebounced(editor.getZoomLevel())\n\t\t\t}\n\t\t})\n\n\t\tscheduler.attach()\n\t\tscheduler.execute()\n\n\t\treturn () => {\n\t\t\tscheduler.detach()\n\t\t}\n\t}, [editor, container])\n}\n", "import classNames from 'classnames'\nimport * as React from 'react'\n\n/** @public */\nexport type HTMLContainerProps = React.HTMLAttributes<HTMLDivElement>\n\n/** @public */\nexport function HTMLContainer({ children, className = '', ...rest }: HTMLContainerProps) {\n\treturn (\n\t\t<div {...rest} className={classNames('tl-html-container', className)}>\n\t\t\t{children}\n\t\t</div>\n\t)\n}\n", "import { VecModel } from '@tldraw/tlschema'\nimport { Box } from '../../../primitives/Box'\nimport { Vec } from '../../../primitives/Vec'\nimport { TLResizeHandle } from '../../types/selection-types'\nimport { TLBaseBoxShape } from '../BaseBoxShapeUtil'\nimport { TLResizeMode } from '../ShapeUtil'\n\n/** @public */\nexport type ResizeBoxOptions = Partial<{\n\tminWidth: number\n\tmaxWidth: number\n\tminHeight: number\n\tmaxHeight: number\n}>\n\n/** @public */\nexport function resizeBox(\n\tshape: TLBaseBoxShape,\n\tinfo: {\n\t\tnewPoint: VecModel\n\t\thandle: TLResizeHandle\n\t\tmode: TLResizeMode\n\t\tscaleX: number\n\t\tscaleY: number\n\t\tinitialBounds: Box\n\t\tinitialShape: TLBaseBoxShape\n\t},\n\topts = {} as ResizeBoxOptions\n) {\n\tconst { newPoint, handle, scaleX, scaleY } = info\n\tconst { minWidth = 1, maxWidth = Infinity, minHeight = 1, maxHeight = Infinity } = opts\n\n\tlet w = shape.props.w * scaleX\n\tlet h = shape.props.h * scaleY\n\n\tconst offset = new Vec(0, 0)\n\n\tif (w > 0) {\n\t\tif (w < minWidth) {\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left':\n\t\t\t\tcase 'left':\n\t\t\t\tcase 'bottom_left': {\n\t\t\t\t\toffset.x = w - minWidth\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'top':\n\t\t\t\tcase 'bottom': {\n\t\t\t\t\toffset.x = (w - minWidth) / 2\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\toffset.x = 0\n\t\t\t\t}\n\t\t\t}\n\t\t\tw = minWidth\n\t\t}\n\t} else {\n\t\toffset.x = w\n\t\tw = -w\n\t\tif (w < minWidth) {\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left':\n\t\t\t\tcase 'left':\n\t\t\t\tcase 'bottom_left': {\n\t\t\t\t\toffset.x = -w\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\toffset.x = -minWidth\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tw = minWidth\n\t\t}\n\t}\n\n\tif (h > 0) {\n\t\tif (h < minHeight) {\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left':\n\t\t\t\tcase 'top':\n\t\t\t\tcase 'top_right': {\n\t\t\t\t\toffset.y = h - minHeight\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'right':\n\t\t\t\tcase 'left': {\n\t\t\t\t\toffset.y = (h - minHeight) / 2\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\toffset.y = 0\n\t\t\t\t}\n\t\t\t}\n\n\t\t\th = minHeight\n\t\t}\n\t} else {\n\t\toffset.y = h\n\t\th = -h\n\t\tif (h < minHeight) {\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left':\n\t\t\t\tcase 'top':\n\t\t\t\tcase 'top_right': {\n\t\t\t\t\toffset.y = -h\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\toffset.y = -minHeight\n\t\t\t\t}\n\t\t\t}\n\t\t\th = minHeight\n\t\t}\n\t}\n\n\tconst { x, y } = offset.rot(shape.rotation).add(newPoint)\n\n\treturn {\n\t\tx,\n\t\ty,\n\t\tprops: {\n\t\t\tw: Math.min(maxWidth, w),\n\t\t\th: Math.min(maxHeight, h),\n\t\t},\n\t}\n}\n", "import { TLBaseShape } from '@tldraw/tlschema'\nimport { Geometry2d } from '../../primitives/geometry/Geometry2d'\nimport { Rectangle2d } from '../../primitives/geometry/Rectangle2d'\nimport { HandleSnapGeometry } from '../managers/SnapManager/HandleSnaps'\nimport { ShapeUtil, TLOnResizeHandler } from './ShapeUtil'\nimport { resizeBox } from './shared/resizeBox'\n\n/** @public */\nexport type TLBaseBoxShape = TLBaseShape<string, { w: number; h: number }>\n\n/** @public */\nexport abstract class BaseBoxShapeUtil<Shape extends TLBaseBoxShape> extends ShapeUtil<Shape> {\n\tgetGeometry(shape: Shape): Geometry2d {\n\t\treturn new Rectangle2d({\n\t\t\twidth: shape.props.w,\n\t\t\theight: shape.props.h,\n\t\t\tisFilled: true,\n\t\t})\n\t}\n\n\toverride onResize: TLOnResizeHandler<any> = (shape, info) => {\n\t\treturn resizeBox(shape, info)\n\t}\n\n\toverride getHandleSnapGeometry(shape: Shape): HandleSnapGeometry {\n\t\treturn {\n\t\t\tpoints: this.getGeometry(shape).bounds.cornersAndCenter,\n\t\t}\n\t}\n}\n", "import { TLEventHandlers } from '../../../types/event-types'\nimport { StateNode } from '../../StateNode'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('pointing', info)\n\t}\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n}\n", "import { createShapeId } from '@tldraw/tlschema'\nimport { Vec } from '../../../../primitives/Vec'\nimport { TLBaseBoxShape } from '../../../shapes/BaseBoxShapeUtil'\nimport { TLEventHandlers } from '../../../types/event-types'\nimport { StateNode } from '../../StateNode'\nimport { BaseBoxShapeTool } from '../BaseBoxShapeTool'\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\tmarkId = ''\n\n\twasFocusedOnEnter = false\n\n\toverride onEnter = () => {\n\t\tthis.wasFocusedOnEnter = !this.editor.getIsMenuOpen()\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tconst { originPagePoint } = this.editor.inputs\n\n\t\t\tconst shapeType = (this.parent as BaseBoxShapeTool)!.shapeType\n\n\t\t\tconst id = createShapeId()\n\n\t\t\tthis.markId = `creating:${id}`\n\n\t\t\tthis.editor.mark(this.markId)\n\n\t\t\tthis.editor\n\t\t\t\t.createShapes<TLBaseBoxShape>([\n\t\t\t\t\t{\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype: shapeType,\n\t\t\t\t\t\tx: originPagePoint.x,\n\t\t\t\t\t\ty: originPagePoint.y,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tw: 1,\n\t\t\t\t\t\t\th: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t\t.select(id)\n\t\t\tthis.editor.setCurrentTool('select.resizing', {\n\t\t\t\t...info,\n\t\t\t\ttarget: 'selection',\n\t\t\t\thandle: 'bottom_right',\n\t\t\t\tisCreating: true,\n\t\t\t\tcreationCursorOffset: { x: 1, y: 1 },\n\t\t\t\tonInteractionEnd: this.parent.id,\n\t\t\t\tonCreate: (this.parent as BaseBoxShapeTool).onCreate,\n\t\t\t})\n\t\t}\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onInterrupt: TLEventHandlers['onInterrupt'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tcomplete() {\n\t\tconst { originPagePoint } = this.editor.inputs\n\n\t\tif (!this.wasFocusedOnEnter) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.editor.mark(this.markId)\n\n\t\tconst shapeType = (this.parent as BaseBoxShapeTool)!.shapeType as TLBaseBoxShape['type']\n\n\t\tconst id = createShapeId()\n\n\t\tthis.editor.mark(this.markId)\n\n\t\tthis.editor.createShapes<TLBaseBoxShape>([\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\ttype: shapeType,\n\t\t\t\tx: originPagePoint.x,\n\t\t\t\ty: originPagePoint.y,\n\t\t\t},\n\t\t])\n\n\t\tconst shape = this.editor.getShape<TLBaseBoxShape>(id)!\n\t\tconst { w, h } = this.editor.getShapeUtil(shape).getDefaultProps() as TLBaseBoxShape['props']\n\t\tconst delta = new Vec(w / 2, h / 2)\n\n\t\tconst parentTransform = this.editor.getShapeParentTransform(shape)\n\t\tif (parentTransform) delta.rot(-parentTransform.rotation())\n\n\t\tthis.editor.updateShapes<TLBaseBoxShape>([\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\ttype: shapeType,\n\t\t\t\tx: shape.x - delta.x,\n\t\t\t\ty: shape.y - delta.y,\n\t\t\t},\n\t\t])\n\n\t\tthis.editor.setSelectedShapes([id])\n\n\t\tif (this.editor.getInstanceState().isToolLocked) {\n\t\t\tthis.parent.transition('idle')\n\t\t} else {\n\t\t\tthis.editor.setCurrentTool('select.idle')\n\t\t}\n\t}\n\n\tcancel() {\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import { TLShape } from '@tldraw/tlschema'\nimport { StateNode } from '../StateNode'\nimport { Idle } from './children/Idle'\nimport { Pointing } from './children/Pointing'\n\n/** @public */\nexport abstract class BaseBoxShapeTool extends StateNode {\n\tstatic override id = 'box'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Pointing]\n\n\tabstract override shapeType: string\n\n\tonCreate?: (_shape: TLShape | null) => void | null\n}\n", "import { useValue } from '@tldraw/state'\nimport { TLShapeId } from '@tldraw/tlschema'\nimport { useEditor } from './useEditor'\n\n/** @public */\nexport function useIsCropping(shapeId: TLShapeId) {\n\tconst editor = useEditor()\n\treturn useValue('isCropping', () => editor.getCroppingShapeId() === shapeId, [editor, shapeId])\n}\n", "import { useValue } from '@tldraw/state'\nimport { TLShapeId } from '@tldraw/tlschema'\nimport { useEditor } from './useEditor'\n\n/** @public */\nexport function useIsEditing(shapeId: TLShapeId) {\n\tconst editor = useEditor()\n\treturn useValue('isEditing', () => editor.getEditingShapeId() === shapeId, [editor, shapeId])\n}\n", "import { useId } from 'react'\n\n/**\n * React's useId hook returns a unique id for the component. However, it uses a colon in the id,\n * which is not valid for CSS selectors. This hook replaces the colon with an underscore.\n *\n * @internal\n */\nexport function useSafeId() {\n\treturn useId().replace(/:/g, '_')\n}\n", "import { useMemo } from 'react'\nimport { TLSelectionHandle } from '../editor/types/selection-types'\nimport {\n\tloopToHtmlElement,\n\treleasePointerCapture,\n\tsetPointerCapture,\n\tstopEventPropagation,\n} from '../utils/dom'\nimport { getPointerInfo } from '../utils/getPointerInfo'\nimport { useEditor } from './useEditor'\n\n/** @public */\nexport function useSelectionEvents(handle: TLSelectionHandle) {\n\tconst editor = useEditor()\n\n\tconst events = useMemo(\n\t\tfunction selectionEvents() {\n\t\t\tconst onPointerDown: React.PointerEventHandler = (e) => {\n\t\t\t\tif ((e as any).isKilled) return\n\n\t\t\t\tif (e.button === 2) {\n\t\t\t\t\teditor.dispatch({\n\t\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\t\ttarget: 'selection',\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tname: 'right_click',\n\t\t\t\t\t\t...getPointerInfo(e),\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (e.button !== 0) return\n\n\t\t\t\t// Because the events are probably set on SVG elements,\n\t\t\t\t// we need to instead place pointer capture on the first HTML\n\t\t\t\t// element above the event's target; and set a listener to\n\t\t\t\t// remove pointer capture when the pointer is released.\n\n\t\t\t\tconst elm = loopToHtmlElement(e.currentTarget)\n\n\t\t\t\tfunction releaseCapture() {\n\t\t\t\t\telm.removeEventListener('pointerup', releaseCapture)\n\t\t\t\t\treleasePointerCapture(elm, e)\n\t\t\t\t}\n\n\t\t\t\tsetPointerCapture(elm, e)\n\t\t\t\telm.addEventListener('pointerup', releaseCapture)\n\n\t\t\t\teditor.dispatch({\n\t\t\t\t\tname: 'pointer_down',\n\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\ttarget: 'selection',\n\t\t\t\t\thandle,\n\t\t\t\t\t...getPointerInfo(e),\n\t\t\t\t})\n\t\t\t\tstopEventPropagation(e)\n\t\t\t}\n\n\t\t\t// Track the last screen point\n\t\t\tlet lastX: number, lastY: number\n\n\t\t\tfunction onPointerMove(e: React.PointerEvent) {\n\t\t\t\tif ((e as any).isKilled) return\n\t\t\t\tif (e.button !== 0) return\n\t\t\t\tif (e.clientX === lastX && e.clientY === lastY) return\n\t\t\t\tlastX = e.clientX\n\t\t\t\tlastY = e.clientY\n\n\t\t\t\teditor.dispatch({\n\t\t\t\t\tname: 'pointer_move',\n\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\ttarget: 'selection',\n\t\t\t\t\thandle,\n\t\t\t\t\t...getPointerInfo(e),\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tconst onPointerUp: React.PointerEventHandler = (e) => {\n\t\t\t\tif ((e as any).isKilled) return\n\t\t\t\tif (e.button !== 0) return\n\n\t\t\t\teditor.dispatch({\n\t\t\t\t\tname: 'pointer_up',\n\t\t\t\t\ttype: 'pointer',\n\t\t\t\t\ttarget: 'selection',\n\t\t\t\t\thandle,\n\t\t\t\t\t...getPointerInfo(e),\n\t\t\t\t})\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tonPointerDown,\n\t\t\t\tonPointerMove,\n\t\t\t\tonPointerUp,\n\t\t\t}\n\t\t},\n\t\t[editor, handle]\n\t)\n\n\treturn events\n}\n", "const SPACING = 20\nconst MIN_COUNT = 8\n\nexport function getVerticesCountForLength(length: number, spacing = SPACING) {\n\treturn Math.max(MIN_COUNT, Math.ceil(length / spacing))\n}\n", "import { Vec } from '../Vec'\nimport { intersectLineSegmentCircle } from '../intersect'\nimport { getArcMeasure, getPointInArcT, getPointOnCircle } from '../utils'\nimport { Geometry2d, Geometry2dOptions } from './Geometry2d'\nimport { getVerticesCountForLength } from './geometry-constants'\n\n/** @public */\nexport class Arc2d extends Geometry2d {\n\t_center: Vec\n\tradius: number\n\tstart: Vec\n\tend: Vec\n\n\tmeasure: number\n\tlength: number\n\tangleStart: number\n\tangleEnd: number\n\n\tconstructor(\n\t\tconfig: Omit<Geometry2dOptions, 'isFilled' | 'isClosed'> & {\n\t\t\tcenter: Vec\n\t\t\tradius: number\n\t\t\tstart: Vec\n\t\t\tend: Vec\n\t\t\tsweepFlag: number\n\t\t\tlargeArcFlag: number\n\t\t}\n\t) {\n\t\tsuper({ ...config, isFilled: false, isClosed: false })\n\t\tconst { center, radius, sweepFlag, largeArcFlag, start, end } = config\n\t\tif (start.equals(end)) throw Error(`Arc must have different start and end points.`)\n\n\t\t// ensure that the start and end are clockwise\n\t\tthis.angleStart = Vec.Angle(center, start)\n\t\tthis.angleEnd = Vec.Angle(center, end)\n\t\tthis.measure = getArcMeasure(this.angleStart, this.angleEnd, sweepFlag, largeArcFlag)\n\t\tthis.length = this.measure * radius\n\n\t\tthis.start = start\n\t\tthis.end = end\n\n\t\tthis._center = center\n\t\tthis.radius = radius\n\t}\n\n\tnearestPoint(point: Vec): Vec {\n\t\tconst { _center, measure, radius, angleEnd, angleStart, start: A, end: B } = this\n\t\tconst t = getPointInArcT(measure, angleStart, angleEnd, _center.angle(point))\n\t\tif (t <= 0) return A\n\t\tif (t >= 1) return B\n\n\t\t// Get the point (P) on the arc, then pick the nearest of A, B, and P\n\t\tconst P = _center.clone().add(point.clone().sub(_center).uni().mul(radius))\n\n\t\tlet nearest: Vec | undefined\n\t\tlet dist = Infinity\n\t\tlet d: number\n\t\tfor (const p of [A, B, P]) {\n\t\t\td = Vec.Dist2(point, p)\n\t\t\tif (d < dist) {\n\t\t\t\tnearest = p\n\t\t\t\tdist = d\n\t\t\t}\n\t\t}\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn nearest\n\t}\n\n\thitTestLineSegment(A: Vec, B: Vec): boolean {\n\t\tconst { _center, radius, measure, angleStart, angleEnd } = this\n\t\tconst intersection = intersectLineSegmentCircle(A, B, _center, radius)\n\t\tif (intersection === null) return false\n\n\t\treturn intersection.some((p) => {\n\t\t\tconst result = getPointInArcT(measure, angleStart, angleEnd, _center.angle(p))\n\t\t\treturn result >= 0 && result <= 1\n\t\t})\n\t}\n\n\tgetVertices(): Vec[] {\n\t\tconst { _center, measure, length, radius, angleStart } = this\n\t\tconst vertices: Vec[] = []\n\n\t\tfor (let i = 0, n = getVerticesCountForLength(Math.abs(length)); i < n + 1; i++) {\n\t\t\tconst t = (i / n) * measure\n\t\t\tconst angle = angleStart + t\n\t\t\tvertices.push(getPointOnCircle(_center, radius, angle))\n\t\t}\n\n\t\treturn vertices\n\t}\n}\n", "import { Box } from '../Box'\nimport { Vec } from '../Vec'\nimport { intersectLineSegmentCircle } from '../intersect'\nimport { PI2, getPointOnCircle } from '../utils'\nimport { Geometry2d, Geometry2dOptions } from './Geometry2d'\nimport { getVerticesCountForLength } from './geometry-constants'\n\n/** @public */\nexport class Circle2d extends Geometry2d {\n\t_center: Vec\n\tradius: number\n\tx: number\n\ty: number\n\n\tconstructor(\n\t\tpublic config: Omit<Geometry2dOptions, 'isClosed'> & {\n\t\t\tx?: number\n\t\t\ty?: number\n\t\t\tradius: number\n\t\t\tisFilled: boolean\n\t\t}\n\t) {\n\t\tsuper({ isClosed: true, ...config })\n\t\tconst { x = 0, y = 0, radius } = config\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis._center = new Vec(radius + x, radius + y)\n\t\tthis.radius = radius\n\t}\n\n\tgetBounds() {\n\t\treturn new Box(this.x, this.y, this.radius * 2, this.radius * 2)\n\t}\n\n\tgetVertices(): Vec[] {\n\t\tconst { _center, radius } = this\n\t\tconst perimeter = PI2 * radius\n\t\tconst vertices: Vec[] = []\n\t\tfor (let i = 0, n = getVerticesCountForLength(perimeter); i < n; i++) {\n\t\t\tconst angle = (i / n) * PI2\n\t\t\tvertices.push(getPointOnCircle(_center, radius, angle))\n\t\t}\n\t\treturn vertices\n\t}\n\n\tnearestPoint(point: Vec): Vec {\n\t\tconst { _center, radius } = this\n\t\tif (_center.equals(point)) return Vec.AddXY(_center, radius, 0)\n\t\treturn _center.clone().add(point.clone().sub(_center).uni().mul(radius))\n\t}\n\n\thitTestLineSegment(A: Vec, B: Vec, distance = 0): boolean {\n\t\tconst { _center, radius } = this\n\t\treturn intersectLineSegmentCircle(A, B, _center, radius + distance) !== null\n\t}\n}\n", "import { Vec } from '../Vec'\nimport { Geometry2dOptions } from './Geometry2d'\nimport { Polyline2d } from './Polyline2d'\n\n/** @public */\nexport class CubicBezier2d extends Polyline2d {\n\ta: Vec\n\tb: Vec\n\tc: Vec\n\td: Vec\n\n\tconstructor(\n\t\tconfig: Omit<Geometry2dOptions, 'isFilled' | 'isClosed'> & {\n\t\t\tstart: Vec\n\t\t\tcp1: Vec\n\t\t\tcp2: Vec\n\t\t\tend: Vec\n\t\t}\n\t) {\n\t\tconst { start: a, cp1: b, cp2: c, end: d } = config\n\t\tsuper({ ...config, points: [a, d] })\n\n\t\tthis.a = a\n\t\tthis.b = b\n\t\tthis.c = c\n\t\tthis.d = d\n\t}\n\n\toverride getVertices() {\n\t\tconst vertices = [] as Vec[]\n\t\tconst { a, b, c, d } = this\n\t\t// we'll always use ten vertices for each bezier curve\n\t\tfor (let i = 0, n = 10; i <= n; i++) {\n\t\t\tconst t = i / n\n\t\t\tvertices.push(\n\t\t\t\tnew Vec(\n\t\t\t\t\t(1 - t) * (1 - t) * (1 - t) * a.x +\n\t\t\t\t\t\t3 * ((1 - t) * (1 - t)) * t * b.x +\n\t\t\t\t\t\t3 * (1 - t) * (t * t) * c.x +\n\t\t\t\t\t\tt * t * t * d.x,\n\t\t\t\t\t(1 - t) * (1 - t) * (1 - t) * a.y +\n\t\t\t\t\t\t3 * ((1 - t) * (1 - t)) * t * b.y +\n\t\t\t\t\t\t3 * (1 - t) * (t * t) * c.y +\n\t\t\t\t\t\tt * t * t * d.y\n\t\t\t\t)\n\t\t\t)\n\t\t}\n\t\treturn vertices\n\t}\n\n\tmidPoint() {\n\t\treturn getAtT(this, 0.5)\n\t}\n\n\tnearestPoint(A: Vec): Vec {\n\t\tlet nearest: Vec | undefined\n\t\tlet dist = Infinity\n\t\tlet d: number\n\t\tlet p: Vec\n\t\tfor (const edge of this.segments) {\n\t\t\tp = edge.nearestPoint(A)\n\t\t\td = Vec.Dist2(p, A)\n\t\t\tif (d < dist) {\n\t\t\t\tnearest = p\n\t\t\t\tdist = d\n\t\t\t}\n\t\t}\n\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn nearest\n\t}\n}\n\nfunction getAtT(segment: CubicBezier2d, t: number) {\n\tconst { a, b, c, d } = segment\n\treturn new Vec(\n\t\t(1 - t) * (1 - t) * (1 - t) * a.x +\n\t\t\t3 * ((1 - t) * (1 - t)) * t * b.x +\n\t\t\t3 * (1 - t) * (t * t) * c.x +\n\t\t\tt * t * t * d.x,\n\t\t(1 - t) * (1 - t) * (1 - t) * a.y +\n\t\t\t3 * ((1 - t) * (1 - t)) * t * b.y +\n\t\t\t3 * (1 - t) * (t * t) * c.y +\n\t\t\tt * t * t * d.y\n\t)\n}\n", "import { Vec } from '../Vec'\nimport { CubicBezier2d } from './CubicBezier2d'\nimport { Geometry2d, Geometry2dOptions } from './Geometry2d'\n\n/** @public */\nexport class CubicSpline2d extends Geometry2d {\n\tpoints: Vec[]\n\n\tconstructor(config: Omit<Geometry2dOptions, 'isClosed' | 'isFilled'> & { points: Vec[] }) {\n\t\tsuper({ ...config, isClosed: false, isFilled: false })\n\t\tconst { points } = config\n\n\t\tthis.points = points\n\t}\n\n\t_segments?: CubicBezier2d[]\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget segments() {\n\t\tif (!this._segments) {\n\t\t\tthis._segments = []\n\t\t\tconst { points } = this\n\n\t\t\tconst len = points.length\n\t\t\tconst last = len - 2\n\t\t\tconst k = 1.25\n\n\t\t\tfor (let i = 0; i < len - 1; i++) {\n\t\t\t\tconst p0 = i === 0 ? points[0] : points[i - 1]\n\t\t\t\tconst p1 = points[i]\n\t\t\t\tconst p2 = points[i + 1]\n\t\t\t\tconst p3 = i === last ? p2 : points[i + 2]\n\t\t\t\tconst start = p1,\n\t\t\t\t\tcp1 =\n\t\t\t\t\t\ti === 0 ? p0 : new Vec(p1.x + ((p2.x - p0.x) / 6) * k, p1.y + ((p2.y - p0.y) / 6) * k),\n\t\t\t\t\tcp2 =\n\t\t\t\t\t\ti === last\n\t\t\t\t\t\t\t? p2\n\t\t\t\t\t\t\t: new Vec(p2.x - ((p3.x - p1.x) / 6) * k, p2.y - ((p3.y - p1.y) / 6) * k),\n\t\t\t\t\tend = p2\n\n\t\t\t\tthis._segments.push(new CubicBezier2d({ start, cp1, cp2, end }))\n\t\t\t}\n\t\t}\n\n\t\treturn this._segments\n\t}\n\n\t_length?: number\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget length() {\n\t\tif (!this._length) {\n\t\t\tthis._length = this.segments.reduce((acc, segment) => acc + segment.length, 0)\n\t\t}\n\t\treturn this._length\n\t}\n\n\tgetVertices() {\n\t\tconst vertices = this.segments.reduce((acc, segment) => {\n\t\t\treturn acc.concat(segment.vertices)\n\t\t}, [] as Vec[])\n\t\tvertices.push(this.points[this.points.length - 1])\n\t\treturn vertices\n\t}\n\n\tnearestPoint(A: Vec): Vec {\n\t\tlet nearest: Vec | undefined\n\t\tlet dist = Infinity\n\t\tlet d: number\n\t\tlet p: Vec\n\t\tfor (const segment of this.segments) {\n\t\t\tp = segment.nearestPoint(A)\n\t\t\td = Vec.Dist2(p, A)\n\t\t\tif (d < dist) {\n\t\t\t\tnearest = p\n\t\t\t\tdist = d\n\t\t\t}\n\t\t}\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn nearest\n\t}\n\n\thitTestLineSegment(A: Vec, B: Vec): boolean {\n\t\treturn this.segments.some((segment) => segment.hitTestLineSegment(A, B))\n\t}\n}\n", "import { Box } from '../Box'\nimport { Vec } from '../Vec'\nimport { PI, PI2 } from '../utils'\nimport { Edge2d } from './Edge2d'\nimport { Geometry2d, Geometry2dOptions } from './Geometry2d'\nimport { getVerticesCountForLength } from './geometry-constants'\n\n/** @public */\nexport class Ellipse2d extends Geometry2d {\n\tw: number\n\th: number\n\n\tconstructor(\n\t\tpublic config: Omit<Geometry2dOptions, 'isClosed'> & {\n\t\t\twidth: number\n\t\t\theight: number\n\t\t}\n\t) {\n\t\tsuper({ ...config, isClosed: true })\n\t\tconst { width, height } = config\n\t\tthis.w = width\n\t\tthis.h = height\n\t}\n\n\t_edges?: Edge2d[]\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tget edges() {\n\t\tif (!this._edges) {\n\t\t\tconst { vertices } = this\n\t\t\tthis._edges = []\n\t\t\tfor (let i = 0, n = vertices.length; i < n; i++) {\n\t\t\t\tconst start = vertices[i]\n\t\t\t\tconst end = vertices[(i + 1) % n]\n\t\t\t\tthis._edges.push(new Edge2d({ start, end }))\n\t\t\t}\n\t\t}\n\n\t\treturn this._edges\n\t}\n\n\tgetVertices() {\n\t\t// Perimeter of the ellipse\n\t\tconst w = Math.max(1, this.w)\n\t\tconst h = Math.max(1, this.h)\n\t\tconst cx = w / 2\n\t\tconst cy = h / 2\n\t\tconst q = Math.pow(cx - cy, 2) / Math.pow(cx + cy, 2)\n\t\tconst p = PI * (cx + cy) * (1 + (3 * q) / (10 + Math.sqrt(4 - 3 * q)))\n\t\t// Number of points\n\t\tconst len = getVerticesCountForLength(p)\n\t\t// Size of step\n\t\tconst step = PI2 / len\n\n\t\tconst a = Math.cos(step)\n\t\tconst b = Math.sin(step)\n\n\t\tlet sin = 0\n\t\tlet cos = 1\n\t\tlet ts = 0\n\t\tlet tc = 1\n\n\t\tconst vertices = Array(len)\n\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tvertices[i] = new Vec(cx + cx * cos, cy + cy * sin)\n\t\t\tts = b * cos + a * sin\n\t\t\ttc = a * cos - b * sin\n\t\t\tsin = ts\n\t\t\tcos = tc\n\t\t}\n\n\t\treturn vertices\n\t}\n\n\tnearestPoint(A: Vec): Vec {\n\t\tlet nearest: Vec | undefined\n\t\tlet dist = Infinity\n\t\tlet d: number\n\t\tlet p: Vec\n\t\tfor (const edge of this.edges) {\n\t\t\tp = edge.nearestPoint(A)\n\t\t\td = Vec.Dist2(p, A)\n\t\t\tif (d < dist) {\n\t\t\t\tnearest = p\n\t\t\t\tdist = d\n\t\t\t}\n\t\t}\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn nearest\n\t}\n\n\thitTestLineSegment(A: Vec, B: Vec): boolean {\n\t\treturn this.edges.some((edge) => edge.hitTestLineSegment(A, B))\n\t}\n\n\tgetBounds() {\n\t\treturn new Box(0, 0, this.w, this.h)\n\t}\n}\n", "import { Vec } from '../Vec'\nimport { Geometry2d, Geometry2dOptions } from './Geometry2d'\n\n/** @public */\nexport class Point2d extends Geometry2d {\n\tpoint: Vec\n\n\tconstructor(\n\t\tconfig: Omit<Geometry2dOptions, 'isClosed' | 'isFilled'> & { margin: number; point: Vec }\n\t) {\n\t\tsuper({ ...config, isClosed: true, isFilled: true })\n\t\tconst { point } = config\n\n\t\tthis.point = point\n\t}\n\n\tgetVertices() {\n\t\treturn [this.point]\n\t}\n\n\tnearestPoint(): Vec {\n\t\treturn this.point\n\t}\n\n\thitTestLineSegment(A: Vec, B: Vec, margin: number): boolean {\n\t\treturn Vec.DistanceToLineSegment(A, B, this.point) < margin\n\t}\n}\n", "import { Vec } from '../Vec'\nimport { HALF_PI, PI } from '../utils'\nimport { Ellipse2d } from './Ellipse2d'\nimport { Geometry2dOptions } from './Geometry2d'\n\nconst STADIUM_VERTICES_LENGTH = 18\n\n/** @public */\nexport class Stadium2d extends Ellipse2d {\n\tconstructor(\n\t\tpublic config: Omit<Geometry2dOptions, 'isClosed'> & { width: number; height: number }\n\t) {\n\t\tsuper({ ...config })\n\t}\n\n\tgetVertices() {\n\t\tconst w = Math.max(1, this.w)\n\t\tconst h = Math.max(1, this.h)\n\t\tconst cx = w / 2\n\t\tconst cy = h / 2\n\t\tconst points: Vec[] = Array(STADIUM_VERTICES_LENGTH)\n\t\tlet t1: number, t2: number\n\t\tif (h > w) {\n\t\t\tfor (let i = 0; i < STADIUM_VERTICES_LENGTH - 1; i++) {\n\t\t\t\tt1 = -PI + (PI * i) / (STADIUM_VERTICES_LENGTH - 2)\n\t\t\t\tt2 = (PI * i) / (STADIUM_VERTICES_LENGTH - 2)\n\t\t\t\tpoints[i] = new Vec(cx + cx * Math.cos(t1), cx + cx * Math.sin(t1))\n\t\t\t\tpoints[i + (STADIUM_VERTICES_LENGTH - 1)] = new Vec(\n\t\t\t\t\tcx + cx * Math.cos(t2),\n\t\t\t\t\th - cx + cx * Math.sin(t2)\n\t\t\t\t)\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = 0; i < STADIUM_VERTICES_LENGTH - 1; i++) {\n\t\t\t\tt1 = -HALF_PI + (PI * i) / (STADIUM_VERTICES_LENGTH - 2)\n\t\t\t\tt2 = HALF_PI + (PI * -i) / (STADIUM_VERTICES_LENGTH - 2)\n\t\t\t\tpoints[i] = new Vec(w - cy + cy * Math.cos(t1), h - cy + cy * Math.sin(t1))\n\t\t\t\tpoints[i + (STADIUM_VERTICES_LENGTH - 1)] = new Vec(\n\t\t\t\t\tcy - cy * Math.cos(t2),\n\t\t\t\t\th - cy + cy * Math.sin(t2)\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\treturn points\n\t}\n}\n", "import { COARSE_POINTER_WIDTH, EDGE_SCROLL_DISTANCE, EDGE_SCROLL_SPEED } from '../constants'\nimport { Editor } from '../editor/Editor'\n\n/**\n * Helper function to get the scroll proximity factor for a given position.\n * @param position - The mouse position on the axis.\n * @param dimension - The component dimension on the axis.\n * @internal\n */\nfunction getEdgeProximityFactor(\n\tposition: number,\n\tdimension: number,\n\tisCoarse: boolean,\n\tinsetStart: boolean,\n\tinsetEnd: boolean\n) {\n\tconst dist = EDGE_SCROLL_DISTANCE\n\tconst pw = isCoarse ? COARSE_POINTER_WIDTH : 0 // pointer width\n\tconst pMin = position - pw\n\tconst pMax = position + pw\n\tconst min = insetStart ? 0 : dist\n\tconst max = insetEnd ? dimension : dimension - dist\n\tif (pMin < min) {\n\t\treturn Math.min(1, (min - pMin) / dist)\n\t} else if (pMax > max) {\n\t\treturn -Math.min(1, (pMax - max) / dist)\n\t}\n\treturn 0\n}\n\n/**\n * Moves the camera when the mouse is close to the edge of the screen.\n * @public\n */\nexport function moveCameraWhenCloseToEdge(editor: Editor) {\n\tif (\n\t\t!editor.inputs.isDragging ||\n\t\teditor.inputs.isPanning ||\n\t\t!editor.getInstanceState().canMoveCamera\n\t)\n\t\treturn\n\n\tconst {\n\t\tinputs: {\n\t\t\tcurrentScreenPoint: { x, y },\n\t\t},\n\t} = editor\n\tconst zoomLevel = editor.getZoomLevel()\n\tconst screenBounds = editor.getViewportScreenBounds()\n\n\t// Determines how much the speed is affected by the screen size\n\tconst screenSizeFactorX = screenBounds.w < 1000 ? 0.612 : 1\n\tconst screenSizeFactorY = screenBounds.h < 1000 ? 0.612 : 1\n\n\tconst {\n\t\tisCoarsePointer,\n\t\tinsets: [t, r, b, l],\n\t} = editor.getInstanceState()\n\tconst proximityFactorX = getEdgeProximityFactor(x, screenBounds.w, isCoarsePointer, l, r)\n\tconst proximityFactorY = getEdgeProximityFactor(y, screenBounds.h, isCoarsePointer, t, b)\n\n\tif (proximityFactorX === 0 && proximityFactorY === 0) return\n\n\t// Determines the base speed of the scroll\n\tconst pxSpeed = editor.user.getEdgeScrollSpeed() * EDGE_SCROLL_SPEED\n\tconst scrollDeltaX = (pxSpeed * proximityFactorX * screenSizeFactorX) / zoomLevel\n\tconst scrollDeltaY = (pxSpeed * proximityFactorY * screenSizeFactorY) / zoomLevel\n\n\tconst camera = editor.getCamera()\n\n\teditor.setCamera({\n\t\tx: camera.x + scrollDeltaX,\n\t\ty: camera.y + scrollDeltaY,\n\t})\n}\n", "import { clearLocalStorage, clearSessionStorage } from '@tldraw/utils'\nimport { deleteDB } from 'idb'\nimport { getAllIndexDbNames } from './indexedDb'\n\n/**\n * Clear the database of all data associated with tldraw.\n *\n * @public */\nexport async function hardReset({ shouldReload = true } = {}) {\n\tclearSessionStorage()\n\n\tawait Promise.all(getAllIndexDbNames().map((db) => deleteDB(db)))\n\n\tclearLocalStorage()\n\tif (shouldReload) {\n\t\twindow.location.reload()\n\t}\n}\n\nif (typeof window !== 'undefined') {\n\tif (process.env.NODE_ENV === 'development') {\n\t\t;(window as any).hardReset = hardReset\n\t}\n\t// window.__tldraw__hardReset is used to inject the logic into the tldraw library\n\t;(window as any).__tldraw__hardReset = hardReset\n}\n", "import { runtime } from './runtime'\n\n/** @public */\nexport function openWindow(url: string, target = '_blank') {\n\truntime.openWindow(url, target)\n}\n", "// Important! don't move this tlschema re-export to lib/index.ts, doing so causes esbuild to produce\n// incorrect output. https://github.com/evanw/esbuild/issues/1737\n\nexport {\n\tEMPTY_ARRAY,\n\tatom,\n\tcomputed,\n\treact,\n\ttrack,\n\ttransact,\n\ttransaction,\n\tuseComputed,\n\tuseQuickReactor,\n\tuseReactor,\n\tuseValue,\n\twhyAmIRunning,\n\ttype Atom,\n\ttype Signal,\n} from '@tldraw/state'\nexport type { TLCommandHistoryOptions } from './lib/editor/types/history-types'\n// eslint-disable-next-line local/no-export-star\nexport * from '@tldraw/store'\n// eslint-disable-next-line local/no-export-star\nexport * from '@tldraw/tlschema'\n// eslint-disable-next-line local/no-export-star\nexport * from '@tldraw/utils'\n// eslint-disable-next-line local/no-export-star\nexport * from '@tldraw/validate'\nexport {\n\tErrorScreen,\n\tLoadingScreen,\n\tTldrawEditor,\n\ttype TLOnMountHandler,\n\ttype TldrawEditorBaseProps,\n\ttype TldrawEditorProps,\n} from './lib/TldrawEditor'\nexport {\n\tErrorBoundary,\n\tOptionalErrorBoundary,\n\ttype TLErrorBoundaryProps,\n} from './lib/components/ErrorBoundary'\nexport { HTMLContainer, type HTMLContainerProps } from './lib/components/HTMLContainer'\nexport { SVGContainer, type SVGContainerProps } from './lib/components/SVGContainer'\nexport { DefaultBackground } from './lib/components/default-components/DefaultBackground'\nexport { DefaultBrush, type TLBrushProps } from './lib/components/default-components/DefaultBrush'\nexport { DefaultCanvas } from './lib/components/default-components/DefaultCanvas'\nexport {\n\tDefaultCollaboratorHint,\n\ttype TLCollaboratorHintProps,\n} from './lib/components/default-components/DefaultCollaboratorHint'\nexport {\n\tDefaultCursor,\n\ttype TLCursorProps,\n} from './lib/components/default-components/DefaultCursor'\nexport { DefaultErrorFallback } from './lib/components/default-components/DefaultErrorFallback'\nexport { DefaultGrid, type TLGridProps } from './lib/components/default-components/DefaultGrid'\nexport {\n\tDefaultHandle,\n\ttype TLHandleProps,\n} from './lib/components/default-components/DefaultHandle'\nexport {\n\tDefaultHandles,\n\ttype TLHandlesProps,\n} from './lib/components/default-components/DefaultHandles'\nexport {\n\tDefaultScribble,\n\ttype TLScribbleProps,\n} from './lib/components/default-components/DefaultScribble'\nexport {\n\tDefaultSelectionBackground,\n\ttype TLSelectionBackgroundProps,\n} from './lib/components/default-components/DefaultSelectionBackground'\nexport {\n\tDefaultSelectionForeground,\n\ttype TLSelectionForegroundProps,\n} from './lib/components/default-components/DefaultSelectionForeground'\nexport {\n\tDefaultShapeIndicator,\n\ttype TLShapeIndicatorProps,\n} from './lib/components/default-components/DefaultShapeIndicator'\nexport {\n\tDefaultSnapIndicator,\n\ttype TLSnapIndicatorProps,\n} from './lib/components/default-components/DefaultSnapIndictor'\nexport { DefaultSpinner } from './lib/components/default-components/DefaultSpinner'\nexport { DefaultSvgDefs } from './lib/components/default-components/DefaultSvgDefs'\nexport {\n\tTAB_ID,\n\tcreateSessionStateSnapshotSignal,\n\textractSessionStateFromLegacySnapshot,\n\tloadSessionStateSnapshotIntoStore,\n\ttype TLSessionStateSnapshot,\n} from './lib/config/TLSessionStateSnapshot'\nexport {\n\tUSER_COLORS,\n\tdefaultUserPreferences,\n\tgetFreshUserPreferences,\n\tgetUserPreferences,\n\tsetUserPreferences,\n\ttype TLUserPreferences,\n} from './lib/config/TLUserPreferences'\nexport {\n\tcreateTLStore,\n\ttype TLStoreEventInfo,\n\ttype TLStoreOptions,\n} from './lib/config/createTLStore'\nexport { createTLUser } from './lib/config/createTLUser'\nexport { coreShapes, type TLAnyShapeUtilConstructor } from './lib/config/defaultShapes'\nexport {\n\tANIMATION_MEDIUM_MS,\n\tANIMATION_SHORT_MS,\n\tCAMERA_SLIDE_FRICTION,\n\tDEFAULT_ANIMATION_OPTIONS,\n\tDOUBLE_CLICK_DURATION,\n\tDRAG_DISTANCE,\n\tGRID_STEPS,\n\tHASH_PATTERN_ZOOM_NAMES,\n\tHIT_TEST_MARGIN,\n\tMAX_PAGES,\n\tMAX_SHAPES_PER_PAGE,\n\tMAX_ZOOM,\n\tMIN_ZOOM,\n\tMULTI_CLICK_DURATION,\n\tSIDES,\n\tSVG_PADDING,\n\tZOOMS,\n} from './lib/constants'\nexport {\n\tEditor,\n\ttype TLAnimationOptions,\n\ttype TLEditorOptions,\n\ttype TLResizeShapeOptions,\n} from './lib/editor/Editor'\nexport type {\n\tSideEffectManager,\n\tTLAfterChangeHandler,\n\tTLAfterCreateHandler,\n\tTLAfterDeleteHandler,\n\tTLBatchCompleteHandler,\n\tTLBeforeChangeHandler,\n\tTLBeforeCreateHandler,\n\tTLBeforeDeleteHandler,\n} from './lib/editor/managers/SideEffectManager'\nexport {\n\ttype BoundsSnapGeometry,\n\ttype BoundsSnapPoint,\n} from './lib/editor/managers/SnapManager/BoundsSnaps'\nexport { type HandleSnapGeometry } from './lib/editor/managers/SnapManager/HandleSnaps'\nexport {\n\tSnapManager,\n\ttype GapsSnapIndicator,\n\ttype PointsSnapIndicator,\n\ttype SnapIndicator,\n} from './lib/editor/managers/SnapManager/SnapManager'\nexport { BaseBoxShapeUtil, type TLBaseBoxShape } from './lib/editor/shapes/BaseBoxShapeUtil'\nexport {\n\tShapeUtil,\n\ttype TLOnBeforeCreateHandler,\n\ttype TLOnBeforeUpdateHandler,\n\ttype TLOnBindingChangeHandler,\n\ttype TLOnChildrenChangeHandler,\n\ttype TLOnClickHandler,\n\ttype TLOnDoubleClickHandleHandler,\n\ttype TLOnDoubleClickHandler,\n\ttype TLOnDragHandler,\n\ttype TLOnEditEndHandler,\n\ttype TLOnHandleDragHandler,\n\ttype TLOnResizeEndHandler,\n\ttype TLOnResizeHandler,\n\ttype TLOnResizeStartHandler,\n\ttype TLOnRotateEndHandler,\n\ttype TLOnRotateHandler,\n\ttype TLOnRotateStartHandler,\n\ttype TLOnTranslateEndHandler,\n\ttype TLOnTranslateHandler,\n\ttype TLOnTranslateStartHandler,\n\ttype TLResizeInfo,\n\ttype TLResizeMode,\n\ttype TLShapeUtilCanvasSvgDef,\n\ttype TLShapeUtilConstructor,\n\ttype TLShapeUtilFlag,\n} from './lib/editor/shapes/ShapeUtil'\nexport { GroupShapeUtil } from './lib/editor/shapes/group/GroupShapeUtil'\nexport {\n\ttype TLArcInfo,\n\ttype TLArrowInfo,\n\ttype TLArrowPoint,\n} from './lib/editor/shapes/shared/arrow/arrow-types'\nexport { getArrowTerminalsInArrowSpace } from './lib/editor/shapes/shared/arrow/shared'\nexport { resizeBox, type ResizeBoxOptions } from './lib/editor/shapes/shared/resizeBox'\nexport { BaseBoxShapeTool } from './lib/editor/tools/BaseBoxShapeTool/BaseBoxShapeTool'\nexport { StateNode, type TLStateNodeConstructor } from './lib/editor/tools/StateNode'\nexport {\n\tuseSvgExportContext,\n\ttype SvgExportContext,\n\ttype SvgExportDef,\n} from './lib/editor/types/SvgExportContext'\nexport { type TLContent } from './lib/editor/types/clipboard-types'\nexport { type TLEventMap, type TLEventMapHandler } from './lib/editor/types/emit-types'\nexport {\n\tEVENT_NAME_MAP,\n\ttype TLBaseEventInfo,\n\ttype TLCLickEventName,\n\ttype TLCancelEvent,\n\ttype TLCancelEventInfo,\n\ttype TLClickEvent,\n\ttype TLClickEventInfo,\n\ttype TLCompleteEvent,\n\ttype TLCompleteEventInfo,\n\ttype TLEnterEventHandler,\n\ttype TLEventHandlers,\n\ttype TLEventInfo,\n\ttype TLEventName,\n\ttype TLExitEventHandler,\n\ttype TLInterruptEvent,\n\ttype TLInterruptEventInfo,\n\ttype TLKeyboardEvent,\n\ttype TLKeyboardEventInfo,\n\ttype TLKeyboardEventName,\n\ttype TLPinchEvent,\n\ttype TLPinchEventInfo,\n\ttype TLPinchEventName,\n\ttype TLPointerEvent,\n\ttype TLPointerEventInfo,\n\ttype TLPointerEventName,\n\ttype TLPointerEventTarget,\n\ttype TLTickEvent,\n\ttype TLWheelEvent,\n\ttype TLWheelEventInfo,\n\ttype UiEvent,\n\ttype UiEventType,\n} from './lib/editor/types/event-types'\nexport {\n\ttype TLExternalAssetContent,\n\ttype TLExternalContent,\n\ttype TLExternalContentSource,\n} from './lib/editor/types/external-content'\nexport {\n\ttype TLCommand,\n\ttype TLCommandHandler,\n\ttype TLHistoryEntry,\n\ttype TLHistoryMark,\n} from './lib/editor/types/history-types'\nexport { type RequiredKeys, type TLSvgOptions } from './lib/editor/types/misc-types'\nexport { type TLResizeHandle, type TLSelectionHandle } from './lib/editor/types/selection-types'\nexport { ContainerProvider, useContainer } from './lib/hooks/useContainer'\nexport { getCursor } from './lib/hooks/useCursor'\nexport { EditorContext, useEditor } from './lib/hooks/useEditor'\nexport { useEditorComponents } from './lib/hooks/useEditorComponents'\nexport type { TLEditorComponents } from './lib/hooks/useEditorComponents'\nexport { useEvent } from './lib/hooks/useEvent'\nexport { useShallowArrayIdentity, useShallowObjectIdentity } from './lib/hooks/useIdentity'\nexport { useIsCropping } from './lib/hooks/useIsCropping'\nexport { useIsDarkMode } from './lib/hooks/useIsDarkMode'\nexport { useIsEditing } from './lib/hooks/useIsEditing'\nexport { useLocalStore } from './lib/hooks/useLocalStore'\nexport { usePeerIds } from './lib/hooks/usePeerIds'\nexport { usePresence } from './lib/hooks/usePresence'\nexport { useSafeId } from './lib/hooks/useSafeId'\nexport { useSelectionEvents } from './lib/hooks/useSelectionEvents'\nexport { useTLStore } from './lib/hooks/useTLStore'\nexport { useTransform } from './lib/hooks/useTransform'\nexport {\n\tBox,\n\tROTATE_CORNER_TO_SELECTION_CORNER,\n\trotateSelectionHandle,\n\ttype BoxLike,\n\ttype RotateCorner,\n\ttype SelectionCorner,\n\ttype SelectionEdge,\n\ttype SelectionHandle,\n} from './lib/primitives/Box'\nexport { Mat, type MatLike, type MatModel } from './lib/primitives/Mat'\nexport { Vec, type VecLike } from './lib/primitives/Vec'\nexport { EASINGS } from './lib/primitives/easings'\nexport { Arc2d } from './lib/primitives/geometry/Arc2d'\nexport { Circle2d } from './lib/primitives/geometry/Circle2d'\nexport { CubicBezier2d } from './lib/primitives/geometry/CubicBezier2d'\nexport { CubicSpline2d } from './lib/primitives/geometry/CubicSpline2d'\nexport { Edge2d } from './lib/primitives/geometry/Edge2d'\nexport { Ellipse2d } from './lib/primitives/geometry/Ellipse2d'\nexport { Geometry2d } from './lib/primitives/geometry/Geometry2d'\nexport { Group2d } from './lib/primitives/geometry/Group2d'\nexport { Point2d } from './lib/primitives/geometry/Point2d'\nexport { Polygon2d } from './lib/primitives/geometry/Polygon2d'\nexport { Polyline2d } from './lib/primitives/geometry/Polyline2d'\nexport { Rectangle2d } from './lib/primitives/geometry/Rectangle2d'\nexport { Stadium2d } from './lib/primitives/geometry/Stadium2d'\nexport {\n\tintersectCircleCircle,\n\tintersectCirclePolygon,\n\tintersectCirclePolyline,\n\tintersectLineSegmentCircle,\n\tintersectLineSegmentLineSegment,\n\tintersectLineSegmentPolygon,\n\tintersectLineSegmentPolyline,\n\tintersectPolygonBounds,\n\tintersectPolygonPolygon,\n\tlinesIntersect,\n\tpolygonIntersectsPolyline,\n\tpolygonsIntersect,\n} from './lib/primitives/intersect'\nexport {\n\tHALF_PI,\n\tPI,\n\tPI2,\n\tSIN,\n\tangleDistance,\n\tapproximately,\n\tareAnglesCompatible,\n\taverage,\n\tcanonicalizeRotation,\n\tclamp,\n\tclampRadians,\n\tclockwiseAngleDist,\n\tcounterClockwiseAngleDist,\n\tdegreesToRadians,\n\tgetArcMeasure,\n\tgetPointInArcT,\n\tgetPointOnCircle,\n\tgetPolygonVertices,\n\tisSafeFloat,\n\tperimeterOfEllipse,\n\tpointInPolygon,\n\tprecise,\n\tradiansToDegrees,\n\trangeIntersection,\n\tshortAngleDist,\n\tsnapAngle,\n\ttoDomPrecision,\n\ttoFixed,\n\ttoPrecision,\n} from './lib/primitives/utils'\nexport {\n\tReadonlySharedStyleMap,\n\tSharedStyleMap,\n\ttype SharedStyle,\n} from './lib/utils/SharedStylesMap'\nexport { WeakMapCache } from './lib/utils/WeakMapCache'\nexport { dataUrlToFile } from './lib/utils/assets'\nexport { debugFlags, featureFlags, type DebugFlag } from './lib/utils/debug-flags'\nexport {\n\tloopToHtmlElement,\n\tpreventDefault,\n\treleasePointerCapture,\n\tsetPointerCapture,\n\tstopEventPropagation,\n} from './lib/utils/dom'\nexport { moveCameraWhenCloseToEdge } from './lib/utils/edgeScrolling'\nexport { getIncrementedName } from './lib/utils/getIncrementedName'\nexport { getPointerInfo } from './lib/utils/getPointerInfo'\nexport { getSvgPathFromPoints } from './lib/utils/getSvgPathFromPoints'\nexport { hardResetEditor } from './lib/utils/hardResetEditor'\nexport { normalizeWheel } from './lib/utils/normalizeWheel'\nexport { refreshPage } from './lib/utils/refreshPage'\nexport {\n\tapplyRotationToSnapshotShapes,\n\tgetRotationSnapshot,\n\ttype TLRotationSnapshot,\n} from './lib/utils/rotation'\nexport { runtime, setRuntimeOverrides } from './lib/utils/runtime'\nexport { type TLStoreWithStatus } from './lib/utils/sync/StoreWithStatus'\nexport { hardReset } from './lib/utils/sync/hardReset'\nexport { uniq } from './lib/utils/uniq'\nexport { uniqueId } from './lib/utils/uniqueId'\nexport { openWindow } from './lib/utils/window-open'\n\n/** @polyfills */\n\nimport 'core-js/stable/array/at.js'\nimport 'core-js/stable/array/flat-map.js'\nimport 'core-js/stable/array/flat.js'\nimport 'core-js/stable/string/at.js'\nimport 'core-js/stable/string/replace-all.js'\n", "import {\n\tEditor,\n\tTLArrowShape,\n\tTLDrawShape,\n\tTLGroupShape,\n\tTLLineShape,\n\tTLTextShape,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\n\nfunction shapesWithUnboundArrows(editor: Editor) {\n\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\tconst selectedShapes = selectedShapeIds.map((id) => {\n\t\treturn editor.getShape(id)\n\t})\n\n\treturn selectedShapes.filter((shape) => {\n\t\tif (!shape) return false\n\t\tif (\n\t\t\teditor.isShapeOfType<TLArrowShape>(shape, 'arrow') &&\n\t\t\tshape.props.start.type === 'binding'\n\t\t) {\n\t\t\treturn false\n\t\t}\n\t\tif (editor.isShapeOfType<TLArrowShape>(shape, 'arrow') && shape.props.end.type === 'binding') {\n\t\t\treturn false\n\t\t}\n\t\treturn true\n\t})\n}\n\n/** @internal */\nexport const useThreeStackableItems = () => {\n\tconst editor = useEditor()\n\treturn useValue('threeStackableItems', () => shapesWithUnboundArrows(editor).length > 2, [editor])\n}\n\n/** @internal */\nexport const useAllowGroup = () => {\n\tconst editor = useEditor()\n\treturn useValue(\n\t\t'allow group',\n\t\t() => {\n\t\t\t// We can't group arrows that are bound to shapes that aren't selected\n\t\t\t// if more than one shape has an arrow bound to it, allow group\n\t\t\tconst selectedShapes = editor.getSelectedShapes()\n\n\t\t\tif (selectedShapes.length < 2) return false\n\n\t\t\tfor (const shape of selectedShapes) {\n\t\t\t\tif (editor.isShapeOfType<TLArrowShape>(shape, 'arrow')) {\n\t\t\t\t\tconst { start, end } = shape.props\n\t\t\t\t\tif (start.type === 'binding') {\n\t\t\t\t\t\t// if the other shape is not among the selected shapes...\n\t\t\t\t\t\tif (!selectedShapes.some((s) => s.id === start.boundShapeId)) {\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (end.type === 'binding') {\n\t\t\t\t\t\t// if the other shape is not among the selected shapes...\n\t\t\t\t\t\tif (!selectedShapes.some((s) => s.id === end.boundShapeId)) {\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true\n\t\t},\n\t\t[editor]\n\t)\n}\n\n/** @internal */\nexport const useAllowUngroup = () => {\n\tconst editor = useEditor()\n\treturn useValue(\n\t\t'allowUngroup',\n\t\t() => editor.getSelectedShapeIds().some((id) => editor.getShape(id)?.type === 'group'),\n\t\t[editor]\n\t)\n}\n\nexport const showMenuPaste =\n\ttypeof window !== 'undefined' &&\n\t'navigator' in window &&\n\tBoolean(navigator.clipboard) &&\n\tBoolean(navigator.clipboard.read)\n\n/**\n * Returns true if the number of LOCKED OR UNLOCKED selected shapes is at least min or at most max.\n */\nexport function useAnySelectedShapesCount(min?: number, max?: number) {\n\tconst editor = useEditor()\n\treturn useValue(\n\t\t'selectedShapes',\n\t\t() => {\n\t\t\tconst len = editor.getSelectedShapes().length\n\t\t\tif (min === undefined) {\n\t\t\t\tif (max === undefined) {\n\t\t\t\t\t// just length\n\t\t\t\t\treturn len\n\t\t\t\t} else {\n\t\t\t\t\t// max but no min\n\t\t\t\t\treturn len <= max\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (max === undefined) {\n\t\t\t\t\t// min but no max\n\t\t\t\t\treturn len >= min\n\t\t\t\t} else {\n\t\t\t\t\t// max and min\n\t\t\t\t\treturn len >= min && len <= max\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[editor, min, max]\n\t)\n}\n\n/**\n * Returns true if the number of UNLOCKED selected shapes is at least min or at most max.\n */\nexport function useUnlockedSelectedShapesCount(min?: number, max?: number) {\n\tconst editor = useEditor()\n\treturn useValue(\n\t\t'selectedShapes',\n\t\t() => {\n\t\t\tconst len = editor\n\t\t\t\t.getSelectedShapes()\n\t\t\t\t.filter((s) => !editor.isShapeOrAncestorLocked(s)).length\n\t\t\tif (min === undefined) {\n\t\t\t\tif (max === undefined) {\n\t\t\t\t\t// just length\n\t\t\t\t\treturn len\n\t\t\t\t} else {\n\t\t\t\t\t// max but no min\n\t\t\t\t\treturn len <= max\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (max === undefined) {\n\t\t\t\t\t// min but no max\n\t\t\t\t\treturn len >= min\n\t\t\t\t} else {\n\t\t\t\t\t// max and min\n\t\t\t\t\treturn len >= min && len <= max\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[editor]\n\t)\n}\n\nexport function useShowAutoSizeToggle() {\n\tconst editor = useEditor()\n\treturn useValue(\n\t\t'showAutoSizeToggle',\n\t\t() => {\n\t\t\tconst selectedShapes = editor.getSelectedShapes()\n\t\t\treturn (\n\t\t\t\tselectedShapes.length === 1 &&\n\t\t\t\teditor.isShapeOfType<TLTextShape>(selectedShapes[0], 'text') &&\n\t\t\t\tselectedShapes[0].props.autoSize === false\n\t\t\t)\n\t\t},\n\t\t[editor]\n\t)\n}\n\nexport function useHasLinkShapeSelected() {\n\tconst editor = useEditor()\n\treturn useValue(\n\t\t'hasLinkShapeSelected',\n\t\t() => {\n\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\t\treturn !!(\n\t\t\t\tonlySelectedShape &&\n\t\t\t\tonlySelectedShape.type !== 'embed' &&\n\t\t\t\t'url' in onlySelectedShape.props &&\n\t\t\t\t!onlySelectedShape.isLocked\n\t\t\t)\n\t\t},\n\t\t[editor]\n\t)\n}\n\nexport function useOnlyFlippableShape() {\n\tconst editor = useEditor()\n\treturn useValue(\n\t\t'onlyFlippableShape',\n\t\t() => {\n\t\t\tconst shape = editor.getOnlySelectedShape()\n\t\t\treturn (\n\t\t\t\tshape &&\n\t\t\t\t(editor.isShapeOfType<TLGroupShape>(shape, 'group') ||\n\t\t\t\t\teditor.isShapeOfType<TLArrowShape>(shape, 'arrow') ||\n\t\t\t\t\teditor.isShapeOfType<TLLineShape>(shape, 'line') ||\n\t\t\t\t\teditor.isShapeOfType<TLDrawShape>(shape, 'draw'))\n\t\t\t)\n\t\t},\n\t\t[editor]\n\t)\n}\n\n/** @public */\nexport function useCanRedo() {\n\tconst editor = useEditor()\n\treturn useValue('useCanRedo', () => editor.getCanRedo(), [editor])\n}\n\n/** @public */\nexport function useCanUndo() {\n\tconst editor = useEditor()\n\treturn useValue('useCanUndo', () => editor.getCanUndo(), [editor])\n}\n", "import {\n\tEditor,\n\tErrorScreen,\n\tExpand,\n\tLoadingScreen,\n\tMigrationSequence,\n\tStoreSnapshot,\n\tTLEditorComponents,\n\tTLOnMountHandler,\n\tTLRecord,\n\tTLStore,\n\tTLStoreWithStatus,\n\tTldrawEditor,\n\tTldrawEditorBaseProps,\n\tuseEditor,\n\tuseEditorComponents,\n\tuseEvent,\n\tuseShallowArrayIdentity,\n\tuseShallowObjectIdentity,\n} from '@tldraw/editor'\nimport { useLayoutEffect, useMemo } from 'react'\nimport { TldrawHandles } from './canvas/TldrawHandles'\nimport { TldrawScribble } from './canvas/TldrawScribble'\nimport { TldrawSelectionBackground } from './canvas/TldrawSelectionBackground'\nimport { TldrawSelectionForeground } from './canvas/TldrawSelectionForeground'\nimport {\n\tTLExternalContentProps,\n\tregisterDefaultExternalContentHandlers,\n} from './defaultExternalContentHandlers'\nimport { defaultShapeTools } from './defaultShapeTools'\nimport { defaultShapeUtils } from './defaultShapeUtils'\nimport { registerDefaultSideEffects } from './defaultSideEffects'\nimport { defaultTools } from './defaultTools'\nimport { TldrawUi, TldrawUiProps } from './ui/TldrawUi'\nimport { TLUiComponents, useTldrawUiComponents } from './ui/context/components'\nimport { useToasts } from './ui/context/toasts'\nimport { usePreloadAssets } from './ui/hooks/usePreloadAssets'\nimport { useTranslation } from './ui/hooks/useTranslation/useTranslation'\nimport { useDefaultEditorAssetsWithOverrides } from './utils/static-assets/assetUrls'\n\n/**@public */\nexport type TLComponents = Expand<TLEditorComponents & TLUiComponents>\n\n/** @public */\nexport type TldrawProps = Expand<\n\t// combine components from base editor and ui\n\t(Omit<TldrawUiProps, 'components'> &\n\t\tOmit<TldrawEditorBaseProps, 'components'> & {\n\t\t\tcomponents?: TLComponents\n\t\t}) &\n\t\t// external content\n\t\tPartial<TLExternalContentProps> &\n\t\t// store stuff\n\t\t(| {\n\t\t\t\t\tstore: TLStore | TLStoreWithStatus\n\t\t\t  }\n\t\t\t| {\n\t\t\t\t\tstore?: undefined\n\t\t\t\t\tmigrations?: readonly MigrationSequence[]\n\t\t\t\t\tpersistenceKey?: string\n\t\t\t\t\tsessionId?: string\n\t\t\t\t\tdefaultName?: string\n\t\t\t\t\t/**\n\t\t\t\t\t * A snapshot to load for the store's initial data / schema.\n\t\t\t\t\t */\n\t\t\t\t\tsnapshot?: StoreSnapshot<TLRecord>\n\t\t\t  }\n\t\t)\n>\n\n/** @public */\nexport function Tldraw(props: TldrawProps) {\n\tconst {\n\t\tchildren,\n\t\tmaxImageDimension,\n\t\tmaxAssetSize,\n\t\tacceptedImageMimeTypes,\n\t\tacceptedVideoMimeTypes,\n\t\tonMount,\n\t\tcomponents = {},\n\t\tshapeUtils = [],\n\t\ttools = [],\n\t\t...rest\n\t} = props\n\n\tconst _components = useShallowObjectIdentity(components)\n\tconst componentsWithDefault = useMemo(\n\t\t() => ({\n\t\t\tScribble: TldrawScribble,\n\t\t\tCollaboratorScribble: TldrawScribble,\n\t\t\tSelectionForeground: TldrawSelectionForeground,\n\t\t\tSelectionBackground: TldrawSelectionBackground,\n\t\t\tHandles: TldrawHandles,\n\t\t\t..._components,\n\t\t}),\n\t\t[_components]\n\t)\n\n\tconst _shapeUtils = useShallowArrayIdentity(shapeUtils)\n\tconst shapeUtilsWithDefaults = useMemo(\n\t\t() => [...defaultShapeUtils, ..._shapeUtils],\n\t\t[_shapeUtils]\n\t)\n\n\tconst _tools = useShallowArrayIdentity(tools)\n\tconst toolsWithDefaults = useMemo(\n\t\t() => [...defaultTools, ...defaultShapeTools, ..._tools],\n\t\t[_tools]\n\t)\n\n\tconst assets = useDefaultEditorAssetsWithOverrides(rest.assetUrls)\n\tconst { done: preloadingComplete, error: preloadingError } = usePreloadAssets(assets)\n\tif (preloadingError) {\n\t\treturn <ErrorScreen>Could not load assets. Please refresh the page.</ErrorScreen>\n\t}\n\tif (!preloadingComplete) {\n\t\treturn <LoadingScreen>Loading assets...</LoadingScreen>\n\t}\n\n\treturn (\n\t\t<TldrawEditor\n\t\t\tinitialState=\"select\"\n\t\t\t{...rest}\n\t\t\tcomponents={componentsWithDefault}\n\t\t\tshapeUtils={shapeUtilsWithDefaults}\n\t\t\ttools={toolsWithDefaults}\n\t\t>\n\t\t\t<TldrawUi {...rest} components={componentsWithDefault}>\n\t\t\t\t<InsideOfEditorAndUiContext\n\t\t\t\t\tmaxImageDimension={maxImageDimension}\n\t\t\t\t\tmaxAssetSize={maxAssetSize}\n\t\t\t\t\tacceptedImageMimeTypes={acceptedImageMimeTypes}\n\t\t\t\t\tacceptedVideoMimeTypes={acceptedVideoMimeTypes}\n\t\t\t\t\tonMount={onMount}\n\t\t\t\t/>\n\t\t\t\t{children}\n\t\t\t</TldrawUi>\n\t\t</TldrawEditor>\n\t)\n}\n\nconst defaultAcceptedImageMimeTypes = Object.freeze([\n\t'image/jpeg',\n\t'image/png',\n\t'image/gif',\n\t'image/svg+xml',\n])\n\nconst defaultAcceptedVideoMimeTypes = Object.freeze(['video/mp4', 'video/quicktime'])\n\n// We put these hooks into a component here so that they can run inside of the context provided by TldrawEditor and TldrawUi.\nfunction InsideOfEditorAndUiContext({\n\tmaxImageDimension = 1000,\n\tmaxAssetSize = 10 * 1024 * 1024, // 10mb\n\tacceptedImageMimeTypes = defaultAcceptedImageMimeTypes,\n\tacceptedVideoMimeTypes = defaultAcceptedVideoMimeTypes,\n\tonMount,\n}: Partial<TLExternalContentProps & { onMount: TLOnMountHandler }>) {\n\tconst editor = useEditor()\n\tconst toasts = useToasts()\n\tconst msg = useTranslation()\n\n\tconst onMountEvent = useEvent((editor: Editor) => {\n\t\tconst unsubs: (void | (() => void) | undefined)[] = []\n\n\t\tunsubs.push(...registerDefaultSideEffects(editor))\n\n\t\t// for content handling, first we register the default handlers...\n\t\tregisterDefaultExternalContentHandlers(\n\t\t\teditor,\n\t\t\t{\n\t\t\t\tmaxImageDimension,\n\t\t\t\tmaxAssetSize,\n\t\t\t\tacceptedImageMimeTypes,\n\t\t\t\tacceptedVideoMimeTypes,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttoasts,\n\t\t\t\tmsg,\n\t\t\t}\n\t\t)\n\n\t\t// ...then we run the onMount prop, which may override the above\n\t\tunsubs.push(onMount?.(editor))\n\n\t\treturn () => {\n\t\t\tunsubs.forEach((fn) => fn?.())\n\t\t}\n\t})\n\n\tuseLayoutEffect(() => {\n\t\tif (editor) return onMountEvent?.(editor)\n\t}, [editor, onMountEvent])\n\n\tconst { Canvas } = useEditorComponents()\n\tconst { ContextMenu } = useTldrawUiComponents()\n\n\tif (ContextMenu) {\n\t\t// should wrap canvas\n\t\treturn <ContextMenu />\n\t}\n\n\tif (Canvas) {\n\t\treturn <Canvas />\n\t}\n\n\treturn null\n}\n", "import { TLHandlesProps, useEditor, useValue } from '@tldraw/editor'\n\n/** @public */\nexport function TldrawHandles({ children }: TLHandlesProps) {\n\tconst editor = useEditor()\n\n\t// todo: maybe display note shape handles here?\n\n\tconst shouldDisplayHandles = useValue(\n\t\t'shouldDisplayHandles',\n\t\t() => {\n\t\t\tif (editor.isInAny('select.idle', 'select.pointing_handle', 'select.pointing_shape')) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t\tif (editor.isInAny('select.editing_shape')) {\n\t\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\t\t\treturn onlySelectedShape && editor.isShapeOfType(onlySelectedShape, 'note')\n\t\t\t}\n\t\t\treturn false\n\t\t},\n\t\t[editor]\n\t)\n\n\tif (!shouldDisplayHandles) return null\n\n\treturn <svg className=\"tl-user-handles tl-overlays__item\">{children}</svg>\n}\n", "import { EASINGS, TLScribbleProps, getSvgPathFromPoints } from '@tldraw/editor'\nimport classNames from 'classnames'\nimport { getStroke } from '../shapes/shared/freehand/getStroke'\n\n/** @public */\nexport function TldrawScribble({ scribble, zoom, color, opacity, className }: TLScribbleProps) {\n\tif (!scribble.points.length) return null\n\n\tconst stroke = getStroke(scribble.points, {\n\t\tsize: scribble.size / zoom,\n\t\tstart: { taper: scribble.taper, easing: EASINGS.linear },\n\t\tlast: scribble.state === 'stopping',\n\t\tsimulatePressure: false,\n\t\tstreamline: 0.32,\n\t})\n\n\tlet d: string\n\n\tif (stroke.length < 4) {\n\t\t// the stroke will be 3 points as a sort of shrugging fail state, so let's draw a dot instead\n\t\tconst r = scribble.size / zoom / 2\n\t\tconst { x, y } = scribble.points[scribble.points.length - 1]\n\t\td = `M ${x - r},${y} a ${r},${r} 0 1,0 ${r * 2},0 a ${r},${r} 0 1,0 ${-r * 2},0`\n\t} else {\n\t\t// If we do have a stroke, then draw the stroke path\n\t\td = getSvgPathFromPoints(stroke)\n\t}\n\n\treturn (\n\t\t<svg className={className ? classNames('tl-overlays__item', className) : className}>\n\t\t\t<path\n\t\t\t\tclassName=\"tl-scribble\"\n\t\t\t\td={d}\n\t\t\t\tfill={color ?? `var(--color-${scribble.color})`}\n\t\t\t\topacity={opacity ?? scribble.opacity}\n\t\t\t/>\n\t\t</svg>\n\t)\n}\n", "import { Vec } from '@tldraw/editor'\nimport type { StrokeOptions, StrokePoint } from './types'\n\nconst { PI } = Math\n\n// Browser strokes seem to be off if PI is regular, a tiny offset seems to fix it\nconst FIXED_PI = PI + 0.0001\n\n/**\n * @internal\n */\nexport function getStrokeOutlineTracks(\n\tstrokePoints: StrokePoint[],\n\toptions: StrokeOptions = {}\n): { left: Vec[]; right: Vec[] } {\n\tconst { size = 16, smoothing = 0.5 } = options\n\n\t// We can't do anything with an empty array or a stroke with negative size.\n\tif (strokePoints.length === 0 || size <= 0) {\n\t\treturn { left: [], right: [] }\n\t}\n\n\tconst firstStrokePoint = strokePoints[0]\n\tconst lastStrokePoint = strokePoints[strokePoints.length - 1]\n\n\t// The total length of the line\n\tconst totalLength = lastStrokePoint.runningLength\n\n\t// The minimum allowed distance between points (squared)\n\tconst minDistance = Math.pow(size * smoothing, 2)\n\n\t// Our collected left and right points\n\tconst leftPts: Vec[] = []\n\tconst rightPts: Vec[] = []\n\n\t// Previous vector\n\tlet prevVector = strokePoints[0].vector\n\n\t// Previous left and right points\n\tlet pl = strokePoints[0].point\n\tlet pr = pl\n\n\t// Temporary left and right points\n\tlet tl = pl\n\tlet tr = pr\n\n\t// Keep track of whether the previous point is a sharp corner\n\t// ... so that we don't detect the same corner twice\n\tlet isPrevPointSharpCorner = false\n\n\t/*\n    Find the outline's left and right points\n\n    Iterating through the points and populate the rightPts and leftPts arrays,\n    skipping the first and last pointsm, which will get caps later on.\n  */\n\n\tlet strokePoint: StrokePoint\n\n\tfor (let i = 0; i < strokePoints.length; i++) {\n\t\tstrokePoint = strokePoints[i]\n\t\tconst { point, vector } = strokePoints[i]\n\n\t\t/*\n      Handle sharp corners\n\n      Find the difference (dot product) between the current and next vector.\n      If the next vector is at more than a right angle to the current vector,\n      draw a cap at the current point.\n    */\n\n\t\tconst prevDpr = strokePoint.vector.dpr(prevVector)\n\t\tconst nextVector = (i < strokePoints.length - 1 ? strokePoints[i + 1] : strokePoints[i]).vector\n\t\tconst nextDpr = i < strokePoints.length - 1 ? nextVector.dpr(strokePoint.vector) : 1\n\n\t\tconst isPointSharpCorner = prevDpr < 0 && !isPrevPointSharpCorner\n\t\tconst isNextPointSharpCorner = nextDpr !== null && nextDpr < 0.2\n\n\t\tif (isPointSharpCorner || isNextPointSharpCorner) {\n\t\t\t// It's a sharp corner. Draw a rounded cap and move on to the next point\n\t\t\t// Considering saving these and drawing them later? So that we can avoid\n\t\t\t// crossing future points.\n\n\t\t\tif (nextDpr > -0.62 && totalLength - strokePoint.runningLength > strokePoint.radius) {\n\t\t\t\t// Draw a \"soft\" corner\n\t\t\t\tconst offset = prevVector.clone().mul(strokePoint.radius)\n\t\t\t\tconst cpr = prevVector.clone().cpr(nextVector)\n\n\t\t\t\tif (cpr < 0) {\n\t\t\t\t\ttl = Vec.Add(point, offset)\n\t\t\t\t\ttr = Vec.Sub(point, offset)\n\t\t\t\t} else {\n\t\t\t\t\ttl = Vec.Sub(point, offset)\n\t\t\t\t\ttr = Vec.Add(point, offset)\n\t\t\t\t}\n\n\t\t\t\tleftPts.push(tl)\n\t\t\t\trightPts.push(tr)\n\t\t\t} else {\n\t\t\t\t// Draw a \"sharp\" corner\n\t\t\t\tconst offset = prevVector.clone().mul(strokePoint.radius).per()\n\t\t\t\tconst start = Vec.Sub(strokePoint.input, offset)\n\n\t\t\t\tfor (let step = 1 / 13, t = 0; t < 1; t += step) {\n\t\t\t\t\ttl = Vec.RotWith(start, strokePoint.input, FIXED_PI * t)\n\t\t\t\t\tleftPts.push(tl)\n\n\t\t\t\t\ttr = Vec.RotWith(start, strokePoint.input, FIXED_PI + FIXED_PI * -t)\n\t\t\t\t\trightPts.push(tr)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpl = tl\n\t\t\tpr = tr\n\n\t\t\tif (isNextPointSharpCorner) {\n\t\t\t\tisPrevPointSharpCorner = true\n\t\t\t}\n\n\t\t\tcontinue\n\t\t}\n\n\t\tisPrevPointSharpCorner = false\n\n\t\tif (strokePoint === firstStrokePoint || strokePoint === lastStrokePoint) {\n\t\t\tconst offset = Vec.Per(vector).mul(strokePoint.radius)\n\t\t\tleftPts.push(Vec.Sub(point, offset))\n\t\t\trightPts.push(Vec.Add(point, offset))\n\n\t\t\tcontinue\n\t\t}\n\n\t\t/* \n      Add regular points\n\n      Project points to either side of the current point, using the\n      calculated size as a distance. If a point's distance to the \n      previous point on that side greater than the minimum distance\n      (or if the corner is kinda sharp), add the points to the side's\n      points array.\n    */\n\n\t\tconst offset = Vec.Lrp(nextVector, vector, nextDpr).per().mul(strokePoint.radius)\n\n\t\ttl = Vec.Sub(point, offset)\n\n\t\tif (i <= 1 || Vec.Dist2(pl, tl) > minDistance) {\n\t\t\tleftPts.push(tl)\n\t\t\tpl = tl\n\t\t}\n\n\t\ttr = Vec.Add(point, offset)\n\n\t\tif (i <= 1 || Vec.Dist2(pr, tr) > minDistance) {\n\t\t\trightPts.push(tr)\n\t\t\tpr = tr\n\t\t}\n\n\t\t// Set variables for next iteration\n\t\tprevVector = vector\n\n\t\tcontinue\n\t}\n\n\t/*\n    Return the points in the correct winding order: begin on the left side, then \n    continue around the end cap, then come back along the right side, and finally \n    complete the start cap.\n  */\n\n\treturn {\n\t\tleft: leftPts,\n\t\tright: rightPts,\n\t}\n}\n\n/**\n * ## getStrokeOutlinePoints\n *\n * Get an array of points (as `[x, y]`) representing the outline of a stroke.\n *\n * @param points - An array of StrokePoints as returned from `getStrokePoints`.\n * @param options - An object with options.\n * @public\n */\nexport function getStrokeOutlinePoints(\n\tstrokePoints: StrokePoint[],\n\toptions: StrokeOptions = {}\n): Vec[] {\n\tconst { size = 16, start = {}, end = {}, last: isComplete = false } = options\n\n\tconst { cap: capStart = true } = start\n\tconst { cap: capEnd = true } = end\n\n\t// We can't do anything with an empty array or a stroke with negative size.\n\tif (strokePoints.length === 0 || size <= 0) {\n\t\treturn []\n\t}\n\n\tconst firstStrokePoint = strokePoints[0]\n\tconst lastStrokePoint = strokePoints[strokePoints.length - 1]\n\n\t// The total length of the line\n\tconst totalLength = lastStrokePoint.runningLength\n\n\tconst taperStart =\n\t\tstart.taper === false\n\t\t\t? 0\n\t\t\t: start.taper === true\n\t\t\t\t? Math.max(size, totalLength)\n\t\t\t\t: (start.taper as number)\n\n\tconst taperEnd =\n\t\tend.taper === false\n\t\t\t? 0\n\t\t\t: end.taper === true\n\t\t\t\t? Math.max(size, totalLength)\n\t\t\t\t: (end.taper as number)\n\n\t// The minimum allowed distance between points (squared)\n\t// Our collected left and right points\n\tconst { left: leftPts, right: rightPts } = getStrokeOutlineTracks(strokePoints, options)\n\n\t/*\n    Drawing caps\n    \n    Now that we have our points on either side of the line, we need to\n    draw caps at the start and end. Tapered lines don't have caps, but\n    may have dots for very short lines.\n  */\n\n\tconst firstPoint = firstStrokePoint.point\n\n\tconst lastPoint =\n\t\tstrokePoints.length > 1\n\t\t\t? strokePoints[strokePoints.length - 1].point\n\t\t\t: Vec.AddXY(firstStrokePoint.point, 1, 1)\n\n\t/* \n    Draw a dot for very short or completed strokes\n    \n    If the line is too short to gather left or right points and if the line is\n    not tapered on either side, draw a dot. If the line is tapered, then only\n    draw a dot if the line is both very short and complete. If we draw a dot,\n    we can just return those points.\n  */\n\n\tif (strokePoints.length === 1) {\n\t\tif (!(taperStart || taperEnd) || isComplete) {\n\t\t\tconst start = Vec.Add(\n\t\t\t\tfirstPoint,\n\t\t\t\tVec.Sub(firstPoint, lastPoint).uni().per().mul(-firstStrokePoint.radius)\n\t\t\t)\n\t\t\tconst dotPts: Vec[] = []\n\t\t\tfor (let step = 1 / 13, t = step; t <= 1; t += step) {\n\t\t\t\tdotPts.push(Vec.RotWith(start, firstPoint, FIXED_PI * 2 * t))\n\t\t\t}\n\t\t\treturn dotPts\n\t\t}\n\t}\n\n\t/*\n    Draw a start cap\n\n    Unless the line has a tapered start, or unless the line has a tapered end\n    and the line is very short, draw a start cap around the first point. Use\n    the distance between the second left and right point for the cap's radius.\n    Finally remove the first left and right points. :psyduck:\n  */\n\n\tconst startCap: Vec[] = []\n\tif (taperStart || (taperEnd && strokePoints.length === 1)) {\n\t\t// The start point is tapered, noop\n\t} else if (capStart) {\n\t\t// Draw the round cap - add thirteen points rotating the right point around the start point to the left point\n\t\tfor (let step = 1 / 8, t = step; t <= 1; t += step) {\n\t\t\tconst pt = Vec.RotWith(rightPts[0], firstPoint, FIXED_PI * t)\n\t\t\tstartCap.push(pt)\n\t\t}\n\t} else {\n\t\t// Draw the flat cap - add a point to the left and right of the start point\n\t\tconst cornersVector = Vec.Sub(leftPts[0], rightPts[0])\n\t\tconst offsetA = Vec.Mul(cornersVector, 0.5)\n\t\tconst offsetB = Vec.Mul(cornersVector, 0.51)\n\n\t\tstartCap.push(\n\t\t\tVec.Sub(firstPoint, offsetA),\n\t\t\tVec.Sub(firstPoint, offsetB),\n\t\t\tVec.Add(firstPoint, offsetB),\n\t\t\tVec.Add(firstPoint, offsetA)\n\t\t)\n\t}\n\n\t/*\n    Draw an end cap\n\n    If the line does not have a tapered end, and unless the line has a tapered\n    start and the line is very short, draw a cap around the last point. Finally,\n    remove the last left and right points. Otherwise, add the last point. Note\n    that This cap is a full-turn-and-a-half: this prevents incorrect caps on\n    sharp end turns.\n  */\n\n\tconst endCap: Vec[] = []\n\tconst direction = lastStrokePoint.vector.clone().per().neg()\n\n\tif (taperEnd || (taperStart && strokePoints.length === 1)) {\n\t\t// Tapered end - push the last point to the line\n\t\tendCap.push(lastPoint)\n\t} else if (capEnd) {\n\t\t// Draw the round end cap\n\t\tconst start = Vec.Add(lastPoint, Vec.Mul(direction, lastStrokePoint.radius))\n\t\tfor (let step = 1 / 29, t = step; t < 1; t += step) {\n\t\t\tendCap.push(Vec.RotWith(start, lastPoint, FIXED_PI * 3 * t))\n\t\t}\n\t} else {\n\t\t// Draw the flat end cap\n\t\tendCap.push(\n\t\t\tVec.Add(lastPoint, Vec.Mul(direction, lastStrokePoint.radius)),\n\t\t\tVec.Add(lastPoint, Vec.Mul(direction, lastStrokePoint.radius * 0.99)),\n\t\t\tVec.Sub(lastPoint, Vec.Mul(direction, lastStrokePoint.radius * 0.99)),\n\t\t\tVec.Sub(lastPoint, Vec.Mul(direction, lastStrokePoint.radius))\n\t\t)\n\t}\n\n\t/*\n    Return the points in the correct winding order: begin on the left side, then \n    continue around the end cap, then come back along the right side, and finally \n    complete the start cap.\n  */\n\n\treturn leftPts.concat(endCap, rightPts.reverse(), startCap)\n}\n", "import { Vec, VecLike } from '@tldraw/editor'\nimport type { StrokeOptions, StrokePoint } from './types'\n\nconst MIN_START_PRESSURE = 0.025\nconst MIN_END_PRESSURE = 0.01\n\n/**\n * ## getStrokePoints\n *\n * Get an array of points as objects with an adjusted point, pressure, vector, distance, and\n * runningLength.\n *\n * @param points - An array of points (as `[x, y, pressure]` or `{x, y, pressure}`). Pressure is\n *   optional in both cases.\n * @param options - An object with options.\n * @public\n */\nexport function getStrokePoints(\n\trawInputPoints: VecLike[],\n\toptions: StrokeOptions = {}\n): StrokePoint[] {\n\tconst { streamline = 0.5, size = 16, simulatePressure = false } = options\n\n\t// If we don't have any points, return an empty array.\n\tif (rawInputPoints.length === 0) return []\n\n\t// Find the interpolation level between points.\n\tconst t = 0.15 + (1 - streamline) * 0.85\n\n\t// Whatever the input is, make sure that the points are in number[][].\n\tlet pts = rawInputPoints.map(Vec.From)\n\n\tlet pointsRemovedFromNearEnd = 0\n\n\tif (!simulatePressure) {\n\t\t// Strip low pressure points from the start of the array.\n\t\tlet pt = pts[0]\n\t\twhile (pt) {\n\t\t\tif (pt.z >= MIN_START_PRESSURE) break\n\t\t\tpts.shift()\n\t\t\tpt = pts[0]\n\t\t}\n\t}\n\n\tif (!simulatePressure) {\n\t\t// Strip low pressure points from the end of the array.\n\t\tlet pt = pts[pts.length - 1]\n\t\twhile (pt) {\n\t\t\tif (pt.z >= MIN_END_PRESSURE) break\n\t\t\tpts.pop()\n\t\t\tpt = pts[pts.length - 1]\n\t\t}\n\t}\n\n\tif (pts.length === 0)\n\t\treturn [\n\t\t\t{\n\t\t\t\tpoint: Vec.From(rawInputPoints[0]),\n\t\t\t\tinput: Vec.From(rawInputPoints[0]),\n\t\t\t\tpressure: simulatePressure ? 0.5 : 0.15,\n\t\t\t\tvector: new Vec(1, 1),\n\t\t\t\tdistance: 0,\n\t\t\t\trunningLength: 0,\n\t\t\t\tradius: 1,\n\t\t\t},\n\t\t]\n\n\t// Strip points that are too close to the first point.\n\tlet pt = pts[1]\n\twhile (pt) {\n\t\tif (Vec.Dist2(pt, pts[0]) > (size / 3) ** 2) break\n\t\tpts[0].z = Math.max(pts[0].z, pt.z) // Use maximum pressure\n\t\tpts.splice(1, 1)\n\t\tpt = pts[1]\n\t}\n\n\t// Strip points that are too close to the last point.\n\tconst last = pts.pop()!\n\tpt = pts[pts.length - 1]\n\twhile (pt) {\n\t\tif (Vec.Dist2(pt, last) > (size / 3) ** 2) break\n\t\tpts.pop()\n\t\tpt = pts[pts.length - 1]\n\t\tpointsRemovedFromNearEnd++\n\t}\n\tpts.push(last)\n\n\tconst isComplete =\n\t\toptions.last ||\n\t\t!options.simulatePressure ||\n\t\t(pts.length > 1 && Vec.Dist2(pts[pts.length - 1], pts[pts.length - 2]) < size ** 2) ||\n\t\tpointsRemovedFromNearEnd > 0\n\n\t// Add extra points between the two, to help avoid \"dash\" lines\n\t// for strokes with tapered start and ends. Don't mutate the\n\t// input array!\n\tif (pts.length === 2 && options.simulatePressure) {\n\t\tconst last = pts[1]\n\t\tpts = pts.slice(0, -1)\n\t\tfor (let i = 1; i < 5; i++) {\n\t\t\tconst next = Vec.Lrp(pts[0], last, i / 4)\n\t\t\tnext.z = ((pts[0].z + (last.z - pts[0].z)) * i) / 4\n\t\t\tpts.push(next)\n\t\t}\n\t}\n\n\t// The strokePoints array will hold the points for the stroke.\n\t// Start it out with the first point, which needs no adjustment.\n\tconst strokePoints: StrokePoint[] = [\n\t\t{\n\t\t\tpoint: pts[0],\n\t\t\tinput: pts[0],\n\t\t\tpressure: simulatePressure ? 0.5 : pts[0].z,\n\t\t\tvector: new Vec(1, 1),\n\t\t\tdistance: 0,\n\t\t\trunningLength: 0,\n\t\t\tradius: 1,\n\t\t},\n\t]\n\n\t// We use the totalLength to keep track of the total distance\n\tlet totalLength = 0\n\n\t// We're set this to the latest point, so we can use it to calculate\n\t// the distance and vector of the next point.\n\tlet prev = strokePoints[0]\n\n\t// Iterate through all of the points, creating StrokePoints.\n\tlet point: Vec, distance: number\n\n\tif (isComplete && streamline > 0) {\n\t\tpts.push(pts[pts.length - 1].clone())\n\t}\n\n\tfor (let i = 1, n = pts.length; i < n; i++) {\n\t\tpoint =\n\t\t\t!t || (options.last && i === n - 1) ? pts[i].clone() : pts[i].clone().lrp(prev.point, 1 - t)\n\n\t\t// If the new point is the same as the previous point, skip ahead.\n\t\tif (prev.point.equals(point)) continue\n\n\t\t// How far is the new point from the previous point?\n\t\tdistance = Vec.Dist(point, prev.point)\n\n\t\t// Add this distance to the total \"running length\" of the line.\n\t\ttotalLength += distance\n\n\t\t// At the start of the line, we wait until the new point is a\n\t\t// certain distance away from the original point, to avoid noise\n\n\t\tif (i < 4 && totalLength < size) {\n\t\t\tcontinue\n\t\t}\n\n\t\t// Create a new strokepoint (it will be the new \"previous\" one).\n\t\tprev = {\n\t\t\tinput: pts[i],\n\t\t\t// The adjusted point\n\t\t\tpoint,\n\t\t\t// The input pressure (or .5 if not specified)\n\t\t\tpressure: simulatePressure ? 0.5 : pts[i].z,\n\t\t\t// The vector from the current point to the previous point\n\t\t\tvector: Vec.Sub(prev.point, point).uni(),\n\t\t\t// The distance between the current point and the previous point\n\t\t\tdistance,\n\t\t\t// The total distance so far\n\t\t\trunningLength: totalLength,\n\t\t\t// The stroke point's radius\n\t\t\tradius: 1,\n\t\t}\n\n\t\t// Push it to the strokePoints array.\n\t\tstrokePoints.push(prev)\n\t}\n\n\t// Set the vector of the first point to be the same as the second point.\n\tif (strokePoints[1]?.vector) {\n\t\tstrokePoints[0].vector = strokePoints[1].vector.clone()\n\t}\n\n\tif (totalLength < 1) {\n\t\tconst maxPressureAmongPoints = Math.max(0.5, ...strokePoints.map((s) => s.pressure))\n\t\tstrokePoints.forEach((s) => (s.pressure = maxPressureAmongPoints))\n\t}\n\n\treturn strokePoints\n}\n", "import { EASINGS } from '@tldraw/editor'\nimport { StrokeOptions, StrokePoint } from './types'\n\nconst { min } = Math\n\n// This is the rate of change for simulated pressure. It could be an option.\nconst RATE_OF_PRESSURE_CHANGE = 0.275\n\n/** @public */\nexport function setStrokePointRadii(strokePoints: StrokePoint[], options: StrokeOptions) {\n\tconst {\n\t\tsize = 16,\n\t\tthinning = 0.5,\n\t\tsimulatePressure = true,\n\t\teasing = (t) => t,\n\t\tstart = {},\n\t\tend = {},\n\t} = options\n\n\tconst { easing: taperStartEase = EASINGS.easeOutQuad } = start\n\tconst { easing: taperEndEase = EASINGS.easeOutCubic } = end\n\n\tconst totalLength = strokePoints[strokePoints.length - 1].runningLength\n\n\tlet firstRadius: number | undefined\n\tlet prevPressure = strokePoints[0].pressure\n\tlet strokePoint: StrokePoint\n\n\tif (!simulatePressure && totalLength < size) {\n\t\tconst max = strokePoints.reduce((max, curr) => Math.max(max, curr.pressure), 0.5)\n\t\tstrokePoints.forEach((sp) => {\n\t\t\tsp.pressure = max\n\t\t\tsp.radius = size * easing(0.5 - thinning * (0.5 - sp.pressure))\n\t\t})\n\t\treturn strokePoints\n\t} else {\n\t\t// Calculate initial pressure based on the average of the first\n\t\t// n number of points. This prevents \"dots\" at the start of the\n\t\t// line. Drawn lines almost always start slow!\n\t\tlet p: number\n\t\tfor (let i = 0, n = strokePoints.length; i < n; i++) {\n\t\t\tstrokePoint = strokePoints[i]\n\t\t\tif (strokePoint.runningLength > size * 5) break\n\t\t\tconst sp = min(1, strokePoint.distance / size)\n\t\t\tif (simulatePressure) {\n\t\t\t\tconst rp = min(1, 1 - sp)\n\t\t\t\tp = min(1, prevPressure + (rp - prevPressure) * (sp * RATE_OF_PRESSURE_CHANGE))\n\t\t\t} else {\n\t\t\t\tp = min(1, prevPressure + (strokePoint.pressure - prevPressure) * 0.5)\n\t\t\t}\n\t\t\tprevPressure = prevPressure + (p - prevPressure) * 0.5\n\t\t}\n\n\t\t// Now calculate pressure and radius for each point\n\t\tfor (let i = 0; i < strokePoints.length; i++) {\n\t\t\tstrokePoint = strokePoints[i]\n\t\t\tif (thinning) {\n\t\t\t\tlet { pressure } = strokePoint\n\t\t\t\tconst sp = min(1, strokePoint.distance / size)\n\t\t\t\tif (simulatePressure) {\n\t\t\t\t\t// If we're simulating pressure, then do so based on the distance\n\t\t\t\t\t// between the current point and the previous point, and the size\n\t\t\t\t\t// of the stroke.\n\t\t\t\t\tconst rp = min(1, 1 - sp)\n\t\t\t\t\tpressure = min(1, prevPressure + (rp - prevPressure) * (sp * RATE_OF_PRESSURE_CHANGE))\n\t\t\t\t} else {\n\t\t\t\t\t// Otherwise, use the input pressure slightly smoothed based on the\n\t\t\t\t\t// distance between the current point and the previous point.\n\t\t\t\t\tpressure = min(\n\t\t\t\t\t\t1,\n\t\t\t\t\t\tprevPressure + (pressure - prevPressure) * (sp * RATE_OF_PRESSURE_CHANGE)\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tstrokePoint.radius = size * easing(0.5 - thinning * (0.5 - pressure))\n\n\t\t\t\tprevPressure = pressure\n\t\t\t} else {\n\t\t\t\tstrokePoint.radius = size / 2\n\t\t\t}\n\n\t\t\tif (firstRadius === undefined) {\n\t\t\t\tfirstRadius = strokePoint.radius\n\t\t\t}\n\t\t}\n\t}\n\n\tconst taperStart =\n\t\tstart.taper === false\n\t\t\t? 0\n\t\t\t: start.taper === true\n\t\t\t\t? Math.max(size, totalLength)\n\t\t\t\t: (start.taper as number)\n\n\tconst taperEnd =\n\t\tend.taper === false\n\t\t\t? 0\n\t\t\t: end.taper === true\n\t\t\t\t? Math.max(size, totalLength)\n\t\t\t\t: (end.taper as number)\n\n\tif (taperStart || taperEnd) {\n\t\tfor (let i = 0; i < strokePoints.length; i++) {\n\t\t\tstrokePoint = strokePoints[i]\n\t\t\t/*\n\t\t\t\tApply tapering\n\n\t\t\t\tIf the current length is within the taper distance at either the\n\t\t\t\tstart or the end, calculate the taper strengths. Apply the smaller \n\t\t\t\tof the two taper strengths to the radius.\n\t\t\t*/\n\n\t\t\tconst { runningLength } = strokePoint\n\n\t\t\tconst ts = runningLength < taperStart ? taperStartEase(runningLength / taperStart) : 1\n\n\t\t\tconst te =\n\t\t\t\ttotalLength - runningLength < taperEnd\n\t\t\t\t\t? taperEndEase((totalLength - runningLength) / taperEnd)\n\t\t\t\t\t: 1\n\n\t\t\tstrokePoint.radius = Math.max(0.01, strokePoint.radius * Math.min(ts, te))\n\t\t}\n\t}\n\n\treturn strokePoints\n}\n", "import { Vec, VecLike } from '@tldraw/editor'\nimport { getStrokeOutlinePoints } from './getStrokeOutlinePoints'\nimport { getStrokePoints } from './getStrokePoints'\nimport { setStrokePointRadii } from './setStrokePointRadii'\nimport type { StrokeOptions } from './types'\n\n/**\n * ## getStroke\n *\n * Get an array of points describing a polygon that surrounds the input points.\n *\n * @param points - An array of points (as `[x, y, pressure]` or `{x, y, pressure}`). Pressure is\n *   optional in both cases.\n * @param options - An object with options.\n * @public\n */\n\nexport function getStroke(points: VecLike[], options: StrokeOptions = {}): Vec[] {\n\treturn getStrokeOutlinePoints(\n\t\tsetStrokePointRadii(getStrokePoints(points, options), options),\n\t\toptions\n\t)\n}\n", "import {\n\tDefaultSelectionBackground,\n\tTLSelectionBackgroundProps,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\n\n/** @public */\nexport const TldrawSelectionBackground = ({ bounds, rotation }: TLSelectionBackgroundProps) => {\n\tconst editor = useEditor()\n\n\tconst shouldDisplay = useValue(\n\t\t'should display',\n\t\t() =>\n\t\t\teditor.isInAny(\n\t\t\t\t'select.idle',\n\t\t\t\t'select.brushing',\n\t\t\t\t'select.scribble_brushing',\n\t\t\t\t'select.pointing_shape',\n\t\t\t\t'select.pointing_selection',\n\t\t\t\t'text.resizing'\n\t\t\t),\n\t\t[editor]\n\t)\n\n\tif (!shouldDisplay) return null\n\n\treturn <DefaultSelectionBackground bounds={bounds} rotation={rotation} />\n}\n", "import {\n\tRotateCorner,\n\tTLEmbedShape,\n\tTLSelectionForegroundProps,\n\tTLTextShape,\n\tgetCursor,\n\ttoDomPrecision,\n\ttrack,\n\tuseEditor,\n\tuseSelectionEvents,\n\tuseTransform,\n\tuseValue,\n} from '@tldraw/editor'\nimport classNames from 'classnames'\nimport { useRef } from 'react'\nimport { useReadonly } from '../ui/hooks/useReadonly'\nimport { TldrawCropHandles } from './TldrawCropHandles'\n\n/** @public */\nexport const TldrawSelectionForeground = track(function TldrawSelectionForeground({\n\tbounds,\n\trotation,\n}: TLSelectionForegroundProps) {\n\tconst editor = useEditor()\n\tconst rSvg = useRef<SVGSVGElement>(null)\n\n\tconst isReadonlyMode = useReadonly()\n\tconst topEvents = useSelectionEvents('top')\n\tconst rightEvents = useSelectionEvents('right')\n\tconst bottomEvents = useSelectionEvents('bottom')\n\tconst leftEvents = useSelectionEvents('left')\n\tconst topLeftEvents = useSelectionEvents('top_left')\n\tconst topRightEvents = useSelectionEvents('top_right')\n\tconst bottomRightEvents = useSelectionEvents('bottom_right')\n\tconst bottomLeftEvents = useSelectionEvents('bottom_left')\n\n\tconst isDefaultCursor =\n\t\t!editor.getIsMenuOpen() && editor.getInstanceState().cursor.type === 'default'\n\tconst isCoarsePointer = editor.getInstanceState().isCoarsePointer\n\n\tconst onlyShape = editor.getOnlySelectedShape()\n\tconst isLockedShape = onlyShape && editor.isShapeOrAncestorLocked(onlyShape)\n\n\t// if all shapes have an expandBy for the selection outline, we can expand by the l\n\tconst expandOutlineBy = onlyShape\n\t\t? editor.getShapeUtil(onlyShape).expandSelectionOutlinePx(onlyShape)\n\t\t: 0\n\n\tuseTransform(rSvg, bounds?.x, bounds?.y, 1, editor.getSelectionRotation(), {\n\t\tx: -expandOutlineBy,\n\t\ty: -expandOutlineBy,\n\t})\n\n\tif (!bounds) return null\n\tbounds = bounds.clone().expandBy(expandOutlineBy).zeroFix()\n\n\tconst zoom = editor.getZoomLevel()\n\tconst isChangingStyle = editor.getInstanceState().isChangingStyle\n\n\tconst width = bounds.width\n\tconst height = bounds.height\n\n\tconst size = 8 / zoom\n\tconst isTinyX = width < size * 2\n\tconst isTinyY = height < size * 2\n\n\tconst isSmallX = width < size * 4\n\tconst isSmallY = height < size * 4\n\tconst isSmallCropX = width < size * 5\n\tconst isSmallCropY = height < size * 5\n\n\tconst mobileHandleMultiplier = isCoarsePointer ? 1.75 : 1\n\tconst targetSize = (6 / zoom) * mobileHandleMultiplier\n\n\tconst targetSizeX = (isSmallX ? targetSize / 2 : targetSize) * (mobileHandleMultiplier * 0.75)\n\tconst targetSizeY = (isSmallY ? targetSize / 2 : targetSize) * (mobileHandleMultiplier * 0.75)\n\n\tconst showSelectionBounds =\n\t\t(onlyShape ? !editor.getShapeUtil(onlyShape).hideSelectionBoundsFg(onlyShape) : true) &&\n\t\t!isChangingStyle\n\n\tlet shouldDisplayBox =\n\t\t(showSelectionBounds &&\n\t\t\teditor.isInAny(\n\t\t\t\t'select.idle',\n\t\t\t\t'select.brushing',\n\t\t\t\t'select.scribble_brushing',\n\t\t\t\t'select.pointing_canvas',\n\t\t\t\t'select.pointing_selection',\n\t\t\t\t'select.pointing_shape',\n\t\t\t\t'select.crop.idle',\n\t\t\t\t'select.crop.pointing_crop',\n\t\t\t\t'select.pointing_resize_handle',\n\t\t\t\t'select.pointing_crop_handle'\n\t\t\t)) ||\n\t\t(showSelectionBounds &&\n\t\t\teditor.isIn('select.resizing') &&\n\t\t\tonlyShape &&\n\t\t\teditor.isShapeOfType<TLTextShape>(onlyShape, 'text'))\n\n\tif (onlyShape && shouldDisplayBox) {\n\t\tif (editor.environment.isFirefox && editor.isShapeOfType<TLEmbedShape>(onlyShape, 'embed')) {\n\t\t\tshouldDisplayBox = false\n\t\t}\n\t}\n\n\tconst showCropHandles =\n\t\teditor.isInAny(\n\t\t\t'select.pointing_crop_handle',\n\t\t\t'select.crop.idle',\n\t\t\t'select.crop.pointing_crop'\n\t\t) &&\n\t\t!isChangingStyle &&\n\t\t!isReadonlyMode\n\n\tconst shouldDisplayControls =\n\t\teditor.isInAny(\n\t\t\t'select.idle',\n\t\t\t'select.pointing_selection',\n\t\t\t'select.pointing_shape',\n\t\t\t'select.crop.idle'\n\t\t) &&\n\t\t!isChangingStyle &&\n\t\t!isReadonlyMode\n\n\tconst showCornerRotateHandles =\n\t\t!isCoarsePointer &&\n\t\t!(isTinyX || isTinyY) &&\n\t\t(shouldDisplayControls || showCropHandles) &&\n\t\t(onlyShape ? !editor.getShapeUtil(onlyShape).hideRotateHandle(onlyShape) : true) &&\n\t\t!isLockedShape\n\n\tconst showMobileRotateHandle =\n\t\tisCoarsePointer &&\n\t\t(!isSmallX || !isSmallY) &&\n\t\t(shouldDisplayControls || showCropHandles) &&\n\t\t(onlyShape ? !editor.getShapeUtil(onlyShape).hideRotateHandle(onlyShape) : true) &&\n\t\t!isLockedShape\n\n\tconst showResizeHandles =\n\t\tshouldDisplayControls &&\n\t\t(onlyShape\n\t\t\t? editor.getShapeUtil(onlyShape).canResize(onlyShape) &&\n\t\t\t\t!editor.getShapeUtil(onlyShape).hideResizeHandles(onlyShape)\n\t\t\t: true) &&\n\t\t!showCropHandles &&\n\t\t!isLockedShape\n\n\tconst hideAlternateCornerHandles = isTinyX || isTinyY\n\tconst showOnlyOneHandle = isTinyX && isTinyY\n\tconst hideAlternateCropHandles = isSmallCropX || isSmallCropY\n\n\tconst showHandles = showResizeHandles || showCropHandles\n\tconst hideRotateCornerHandles = !showCornerRotateHandles\n\tconst hideMobileRotateHandle = !shouldDisplayControls || !showMobileRotateHandle\n\tconst hideTopLeftCorner = !shouldDisplayControls || !showHandles\n\tconst hideTopRightCorner = !shouldDisplayControls || !showHandles || hideAlternateCornerHandles\n\tconst hideBottomLeftCorner = !shouldDisplayControls || !showHandles || hideAlternateCornerHandles\n\tconst hideBottomRightCorner =\n\t\t!shouldDisplayControls || !showHandles || (showOnlyOneHandle && !showCropHandles)\n\n\t// If we're showing crop handles, then show the edges too.\n\t// If we're showing resize handles, then show the edges only\n\t// if we're not hiding them for some other reason.\n\tlet hideVerticalEdgeTargets = true\n\t// The same logic above applies here, except another nuance is that\n\t// we enable resizing for text on mobile (coarse).\n\tlet hideHorizontalEdgeTargets = true\n\n\tif (showCropHandles) {\n\t\thideVerticalEdgeTargets = hideAlternateCropHandles\n\t\thideHorizontalEdgeTargets = hideAlternateCropHandles\n\t} else if (showResizeHandles) {\n\t\thideVerticalEdgeTargets = hideAlternateCornerHandles || showOnlyOneHandle || isCoarsePointer\n\t\tconst isMobileAndTextShape = isCoarsePointer && onlyShape && onlyShape.type === 'text'\n\t\thideHorizontalEdgeTargets = hideVerticalEdgeTargets && !isMobileAndTextShape\n\t}\n\n\tconst textHandleHeight = Math.min(24 / zoom, height - targetSizeY * 3)\n\tconst showTextResizeHandles =\n\t\tshouldDisplayControls &&\n\t\tisCoarsePointer &&\n\t\tonlyShape &&\n\t\teditor.isShapeOfType<TLTextShape>(onlyShape, 'text') &&\n\t\ttextHandleHeight * zoom >= 4\n\n\treturn (\n\t\t<svg className=\"tl-overlays__item tl-selection__fg\" data-testid=\"selection-foreground\">\n\t\t\t<g ref={rSvg}>\n\t\t\t\t{shouldDisplayBox && (\n\t\t\t\t\t<rect\n\t\t\t\t\t\tclassName=\"tl-selection__fg__outline\"\n\t\t\t\t\t\twidth={toDomPrecision(width)}\n\t\t\t\t\t\theight={toDomPrecision(height)}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t<RotateCornerHandle\n\t\t\t\t\tdata-testid=\"selection.rotate.top-left\"\n\t\t\t\t\tcx={0}\n\t\t\t\t\tcy={0}\n\t\t\t\t\ttargetSize={targetSize}\n\t\t\t\t\tcorner=\"top_left_rotate\"\n\t\t\t\t\tcursor={isDefaultCursor ? getCursor('nwse-rotate', rotation) : undefined}\n\t\t\t\t\tisHidden={hideRotateCornerHandles}\n\t\t\t\t/>\n\t\t\t\t<RotateCornerHandle\n\t\t\t\t\tdata-testid=\"selection.rotate.top-right\"\n\t\t\t\t\tcx={width + targetSize * 3}\n\t\t\t\t\tcy={0}\n\t\t\t\t\ttargetSize={targetSize}\n\t\t\t\t\tcorner=\"top_right_rotate\"\n\t\t\t\t\tcursor={isDefaultCursor ? getCursor('nesw-rotate', rotation) : undefined}\n\t\t\t\t\tisHidden={hideRotateCornerHandles}\n\t\t\t\t/>\n\t\t\t\t<RotateCornerHandle\n\t\t\t\t\tdata-testid=\"selection.rotate.bottom-left\"\n\t\t\t\t\tcx={0}\n\t\t\t\t\tcy={height + targetSize * 3}\n\t\t\t\t\ttargetSize={targetSize}\n\t\t\t\t\tcorner=\"bottom_left_rotate\"\n\t\t\t\t\tcursor={isDefaultCursor ? getCursor('swne-rotate', rotation) : undefined}\n\t\t\t\t\tisHidden={hideRotateCornerHandles}\n\t\t\t\t/>\n\t\t\t\t<RotateCornerHandle\n\t\t\t\t\tdata-testid=\"selection.rotate.bottom-right\"\n\t\t\t\t\tcx={width + targetSize * 3}\n\t\t\t\t\tcy={height + targetSize * 3}\n\t\t\t\t\ttargetSize={targetSize}\n\t\t\t\t\tcorner=\"bottom_right_rotate\"\n\t\t\t\t\tcursor={isDefaultCursor ? getCursor('senw-rotate', rotation) : undefined}\n\t\t\t\t\tisHidden={hideRotateCornerHandles}\n\t\t\t\t/>\n\t\t\t\t<MobileRotateHandle\n\t\t\t\t\tdata-testid=\"selection.rotate.mobile\"\n\t\t\t\t\tcx={isSmallX ? -targetSize * 1.5 : width / 2}\n\t\t\t\t\tcy={isSmallX ? height / 2 : -targetSize * 1.5}\n\t\t\t\t\tsize={size}\n\t\t\t\t\tisHidden={hideMobileRotateHandle}\n\t\t\t\t/>\n\t\t\t\t{/* Targets */}\n\t\t\t\t<rect\n\t\t\t\t\tclassName={classNames('tl-transparent', {\n\t\t\t\t\t\t'tl-hidden': hideVerticalEdgeTargets,\n\t\t\t\t\t})}\n\t\t\t\t\tdata-testid=\"selection.resize.top\"\n\t\t\t\t\taria-label=\"top target\"\n\t\t\t\t\tpointerEvents=\"all\"\n\t\t\t\t\tx={0}\n\t\t\t\t\ty={toDomPrecision(0 - (isSmallY ? targetSizeY * 2 : targetSizeY))}\n\t\t\t\t\twidth={toDomPrecision(width)}\n\t\t\t\t\theight={toDomPrecision(Math.max(1, targetSizeY * 2))}\n\t\t\t\t\tstyle={isDefaultCursor ? { cursor: getCursor('ns-resize', rotation) } : undefined}\n\t\t\t\t\t{...topEvents}\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\tclassName={classNames('tl-transparent', {\n\t\t\t\t\t\t'tl-hidden': hideHorizontalEdgeTargets,\n\t\t\t\t\t})}\n\t\t\t\t\tdata-testid=\"selection.resize.right\"\n\t\t\t\t\taria-label=\"right target\"\n\t\t\t\t\tpointerEvents=\"all\"\n\t\t\t\t\tx={toDomPrecision(width - (isSmallX ? 0 : targetSizeX))}\n\t\t\t\t\ty={0}\n\t\t\t\t\theight={toDomPrecision(height)}\n\t\t\t\t\twidth={toDomPrecision(Math.max(1, targetSizeX * 2))}\n\t\t\t\t\tstyle={isDefaultCursor ? { cursor: getCursor('ew-resize', rotation) } : undefined}\n\t\t\t\t\t{...rightEvents}\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\tclassName={classNames('tl-transparent', {\n\t\t\t\t\t\t'tl-hidden': hideVerticalEdgeTargets,\n\t\t\t\t\t})}\n\t\t\t\t\tdata-testid=\"selection.resize.bottom\"\n\t\t\t\t\taria-label=\"bottom target\"\n\t\t\t\t\tpointerEvents=\"all\"\n\t\t\t\t\tx={0}\n\t\t\t\t\ty={toDomPrecision(height - (isSmallY ? 0 : targetSizeY))}\n\t\t\t\t\twidth={toDomPrecision(width)}\n\t\t\t\t\theight={toDomPrecision(Math.max(1, targetSizeY * 2))}\n\t\t\t\t\tstyle={isDefaultCursor ? { cursor: getCursor('ns-resize', rotation) } : undefined}\n\t\t\t\t\t{...bottomEvents}\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\tclassName={classNames('tl-transparent', {\n\t\t\t\t\t\t'tl-hidden': hideHorizontalEdgeTargets,\n\t\t\t\t\t})}\n\t\t\t\t\tdata-testid=\"selection.resize.left\"\n\t\t\t\t\taria-label=\"left target\"\n\t\t\t\t\tpointerEvents=\"all\"\n\t\t\t\t\tx={toDomPrecision(0 - (isSmallX ? targetSizeX * 2 : targetSizeX))}\n\t\t\t\t\ty={0}\n\t\t\t\t\theight={toDomPrecision(height)}\n\t\t\t\t\twidth={toDomPrecision(Math.max(1, targetSizeX * 2))}\n\t\t\t\t\tstyle={isDefaultCursor ? { cursor: getCursor('ew-resize', rotation) } : undefined}\n\t\t\t\t\t{...leftEvents}\n\t\t\t\t/>\n\t\t\t\t{/* Corner Targets */}\n\t\t\t\t<rect\n\t\t\t\t\tclassName={classNames('tl-transparent', {\n\t\t\t\t\t\t'tl-hidden': hideTopLeftCorner,\n\t\t\t\t\t})}\n\t\t\t\t\tdata-testid=\"selection.target.top-left\"\n\t\t\t\t\taria-label=\"top-left target\"\n\t\t\t\t\tpointerEvents=\"all\"\n\t\t\t\t\tx={toDomPrecision(0 - (isSmallX ? targetSizeX * 2 : targetSizeX * 1.5))}\n\t\t\t\t\ty={toDomPrecision(0 - (isSmallY ? targetSizeY * 2 : targetSizeY * 1.5))}\n\t\t\t\t\twidth={toDomPrecision(targetSizeX * 3)}\n\t\t\t\t\theight={toDomPrecision(targetSizeY * 3)}\n\t\t\t\t\tstyle={isDefaultCursor ? { cursor: getCursor('nwse-resize', rotation) } : undefined}\n\t\t\t\t\t{...topLeftEvents}\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\tclassName={classNames('tl-transparent', {\n\t\t\t\t\t\t'tl-hidden': hideTopRightCorner,\n\t\t\t\t\t})}\n\t\t\t\t\tdata-testid=\"selection.target.top-right\"\n\t\t\t\t\taria-label=\"top-right target\"\n\t\t\t\t\tpointerEvents=\"all\"\n\t\t\t\t\tx={toDomPrecision(width - (isSmallX ? 0 : targetSizeX * 1.5))}\n\t\t\t\t\ty={toDomPrecision(0 - (isSmallY ? targetSizeY * 2 : targetSizeY * 1.5))}\n\t\t\t\t\twidth={toDomPrecision(targetSizeX * 3)}\n\t\t\t\t\theight={toDomPrecision(targetSizeY * 3)}\n\t\t\t\t\tstyle={isDefaultCursor ? { cursor: getCursor('nesw-resize', rotation) } : undefined}\n\t\t\t\t\t{...topRightEvents}\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\tclassName={classNames('tl-transparent', {\n\t\t\t\t\t\t'tl-hidden': hideBottomRightCorner,\n\t\t\t\t\t})}\n\t\t\t\t\tdata-testid=\"selection.target.bottom-right\"\n\t\t\t\t\taria-label=\"bottom-right target\"\n\t\t\t\t\tpointerEvents=\"all\"\n\t\t\t\t\tx={toDomPrecision(width - (isSmallX ? targetSizeX : targetSizeX * 1.5))}\n\t\t\t\t\ty={toDomPrecision(height - (isSmallY ? targetSizeY : targetSizeY * 1.5))}\n\t\t\t\t\twidth={toDomPrecision(targetSizeX * 3)}\n\t\t\t\t\theight={toDomPrecision(targetSizeY * 3)}\n\t\t\t\t\tstyle={isDefaultCursor ? { cursor: getCursor('nwse-resize', rotation) } : undefined}\n\t\t\t\t\t{...bottomRightEvents}\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\tclassName={classNames('tl-transparent', {\n\t\t\t\t\t\t'tl-hidden': hideBottomLeftCorner,\n\t\t\t\t\t})}\n\t\t\t\t\tdata-testid=\"selection.target.bottom-left\"\n\t\t\t\t\taria-label=\"bottom-left target\"\n\t\t\t\t\tpointerEvents=\"all\"\n\t\t\t\t\tx={toDomPrecision(0 - (isSmallX ? targetSizeX * 3 : targetSizeX * 1.5))}\n\t\t\t\t\ty={toDomPrecision(height - (isSmallY ? 0 : targetSizeY * 1.5))}\n\t\t\t\t\twidth={toDomPrecision(targetSizeX * 3)}\n\t\t\t\t\theight={toDomPrecision(targetSizeY * 3)}\n\t\t\t\t\tstyle={isDefaultCursor ? { cursor: getCursor('nesw-resize', rotation) } : undefined}\n\t\t\t\t\t{...bottomLeftEvents}\n\t\t\t\t/>\n\t\t\t\t{/* Resize Handles */}\n\t\t\t\t{showResizeHandles && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\tdata-testid=\"selection.resize.top-left\"\n\t\t\t\t\t\t\tclassName={classNames('tl-corner-handle', {\n\t\t\t\t\t\t\t\t'tl-hidden': hideTopLeftCorner,\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\taria-label=\"top_left handle\"\n\t\t\t\t\t\t\tx={toDomPrecision(0 - size / 2)}\n\t\t\t\t\t\t\ty={toDomPrecision(0 - size / 2)}\n\t\t\t\t\t\t\twidth={toDomPrecision(size)}\n\t\t\t\t\t\t\theight={toDomPrecision(size)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\tdata-testid=\"selection.resize.top-right\"\n\t\t\t\t\t\t\tclassName={classNames('tl-corner-handle', {\n\t\t\t\t\t\t\t\t'tl-hidden': hideTopRightCorner,\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\taria-label=\"top_right handle\"\n\t\t\t\t\t\t\tx={toDomPrecision(width - size / 2)}\n\t\t\t\t\t\t\ty={toDomPrecision(0 - size / 2)}\n\t\t\t\t\t\t\twidth={toDomPrecision(size)}\n\t\t\t\t\t\t\theight={toDomPrecision(size)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\tdata-testid=\"selection.resize.bottom-right\"\n\t\t\t\t\t\t\tclassName={classNames('tl-corner-handle', {\n\t\t\t\t\t\t\t\t'tl-hidden': hideBottomRightCorner,\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\taria-label=\"bottom_right handle\"\n\t\t\t\t\t\t\tx={toDomPrecision(width - size / 2)}\n\t\t\t\t\t\t\ty={toDomPrecision(height - size / 2)}\n\t\t\t\t\t\t\twidth={toDomPrecision(size)}\n\t\t\t\t\t\t\theight={toDomPrecision(size)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\tdata-testid=\"selection.resize.bottom-left\"\n\t\t\t\t\t\t\tclassName={classNames('tl-corner-handle', {\n\t\t\t\t\t\t\t\t'tl-hidden': hideBottomLeftCorner,\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\taria-label=\"bottom_left handle\"\n\t\t\t\t\t\t\tx={toDomPrecision(0 - size / 2)}\n\t\t\t\t\t\t\ty={toDomPrecision(height - size / 2)}\n\t\t\t\t\t\t\twidth={toDomPrecision(size)}\n\t\t\t\t\t\t\theight={toDomPrecision(size)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t\t{showTextResizeHandles && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\tdata-testid=\"selection.text-resize.left.handle\"\n\t\t\t\t\t\t\tclassName=\"tl-text-handle\"\n\t\t\t\t\t\t\taria-label=\"bottom_left handle\"\n\t\t\t\t\t\t\tx={toDomPrecision(0 - size / 4)}\n\t\t\t\t\t\t\ty={toDomPrecision(height / 2 - textHandleHeight / 2)}\n\t\t\t\t\t\t\trx={size / 4}\n\t\t\t\t\t\t\twidth={toDomPrecision(size / 2)}\n\t\t\t\t\t\t\theight={toDomPrecision(textHandleHeight)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\tdata-testid=\"selection.text-resize.right.handle\"\n\t\t\t\t\t\t\tclassName=\"tl-text-handle\"\n\t\t\t\t\t\t\taria-label=\"bottom_left handle\"\n\t\t\t\t\t\t\trx={size / 4}\n\t\t\t\t\t\t\tx={toDomPrecision(width - size / 4)}\n\t\t\t\t\t\t\ty={toDomPrecision(height / 2 - textHandleHeight / 2)}\n\t\t\t\t\t\t\twidth={toDomPrecision(size / 2)}\n\t\t\t\t\t\t\theight={toDomPrecision(textHandleHeight)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t\t{/* Crop Handles */}\n\t\t\t\t{showCropHandles && (\n\t\t\t\t\t<TldrawCropHandles\n\t\t\t\t\t\t{...{\n\t\t\t\t\t\t\tsize,\n\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\thideAlternateHandles: hideAlternateCropHandles,\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</g>\n\t\t</svg>\n\t)\n})\n\nexport const RotateCornerHandle = function RotateCornerHandle({\n\tcx,\n\tcy,\n\ttargetSize,\n\tcorner,\n\tcursor,\n\tisHidden,\n\t'data-testid': testId,\n}: {\n\tcx: number\n\tcy: number\n\ttargetSize: number\n\tcorner: RotateCorner\n\tcursor?: string\n\tisHidden: boolean\n\t'data-testid'?: string\n}) {\n\tconst events = useSelectionEvents(corner)\n\treturn (\n\t\t<rect\n\t\t\tclassName={classNames('tl-transparent', 'tl-rotate-corner', { 'tl-hidden': isHidden })}\n\t\t\tdata-testid={testId}\n\t\t\taria-label={`${corner} target`}\n\t\t\tpointerEvents=\"all\"\n\t\t\tx={toDomPrecision(cx - targetSize * 3)}\n\t\t\ty={toDomPrecision(cy - targetSize * 3)}\n\t\t\twidth={toDomPrecision(Math.max(1, targetSize * 3))}\n\t\t\theight={toDomPrecision(Math.max(1, targetSize * 3))}\n\t\t\tcursor={cursor}\n\t\t\t{...events}\n\t\t/>\n\t)\n}\n\nconst SQUARE_ROOT_PI = Math.sqrt(Math.PI)\n\nexport const MobileRotateHandle = function RotateHandle({\n\tcx,\n\tcy,\n\tsize,\n\tisHidden,\n\t'data-testid': testId,\n}: {\n\tcx: number\n\tcy: number\n\tsize: number\n\tisHidden: boolean\n\t'data-testid'?: string\n}) {\n\tconst events = useSelectionEvents('mobile_rotate')\n\n\tconst editor = useEditor()\n\tconst zoom = useValue('zoom level', () => editor.getZoomLevel(), [editor])\n\tconst bgRadius = Math.max(14 * (1 / zoom), 20 / Math.max(1, zoom))\n\n\treturn (\n\t\t<g>\n\t\t\t<circle\n\t\t\t\tdata-testid={testId}\n\t\t\t\tpointerEvents=\"all\"\n\t\t\t\tclassName={classNames('tl-transparent', 'tl-mobile-rotate__bg', { 'tl-hidden': isHidden })}\n\t\t\t\tcx={cx}\n\t\t\t\tcy={cy}\n\t\t\t\tr={bgRadius}\n\t\t\t\t{...events}\n\t\t\t/>\n\t\t\t<circle\n\t\t\t\tclassName={classNames('tl-mobile-rotate__fg', { 'tl-hidden': isHidden })}\n\t\t\t\tcx={cx}\n\t\t\t\tcy={cy}\n\t\t\t\tr={size / SQUARE_ROOT_PI}\n\t\t\t/>\n\t\t</g>\n\t)\n}\n", "import { useEditor, useValue } from '@tldraw/editor'\n\n/** @public */\nexport function useReadonly() {\n\tconst editor = useEditor()\n\treturn useValue('isReadonlyMode', () => editor.getInstanceState().isReadonly, [editor])\n}\n", "import { toDomPrecision } from '@tldraw/editor'\nimport classNames from 'classnames'\n\nexport interface TldrawCropHandlesProps {\n\tsize: number\n\twidth: number\n\theight: number\n\thideAlternateHandles: boolean\n}\n\nexport function TldrawCropHandles({\n\tsize,\n\twidth,\n\theight,\n\thideAlternateHandles,\n}: TldrawCropHandlesProps) {\n\tconst cropStrokeWidth = toDomPrecision(size / 3)\n\tconst offset = cropStrokeWidth / 2\n\n\treturn (\n\t\t<svg className=\"tl-overlays__item\">\n\t\t\t{/* Top left */}\n\t\t\t<polyline\n\t\t\t\tclassName=\"tl-corner-crop-handle\"\n\t\t\t\tpoints={`\n\t\t\t\t\t\t${toDomPrecision(0 - offset)},${toDomPrecision(size)} \n\t\t\t\t\t\t${toDomPrecision(0 - offset)},${toDomPrecision(0 - offset)} \n\t\t\t\t\t\t${toDomPrecision(size)},${toDomPrecision(0 - offset)}`}\n\t\t\t\tstrokeWidth={cropStrokeWidth}\n\t\t\t\tdata-testid=\"selection.crop.top_left\"\n\t\t\t\taria-label=\"top_left handle\"\n\t\t\t/>\n\t\t\t{/* Top */}\n\t\t\t<line\n\t\t\t\tclassName={classNames('tl-corner-crop-edge-handle', {\n\t\t\t\t\t'tl-hidden': hideAlternateHandles,\n\t\t\t\t})}\n\t\t\t\tx1={toDomPrecision(width / 2 - size)}\n\t\t\t\ty1={toDomPrecision(0 - offset)}\n\t\t\t\tx2={toDomPrecision(width / 2 + size)}\n\t\t\t\ty2={toDomPrecision(0 - offset)}\n\t\t\t\tstrokeWidth={cropStrokeWidth}\n\t\t\t\tdata-testid=\"selection.crop.top\"\n\t\t\t\taria-label=\"top handle\"\n\t\t\t/>\n\t\t\t{/* Top right */}\n\t\t\t<polyline\n\t\t\t\tclassName={classNames('tl-corner-crop-handle', {\n\t\t\t\t\t'tl-hidden': hideAlternateHandles,\n\t\t\t\t})}\n\t\t\t\tpoints={`\n\t\t\t\t\t\t${toDomPrecision(width - size)},${toDomPrecision(0 - offset)} \n\t\t\t\t\t\t${toDomPrecision(width + offset)},${toDomPrecision(0 - offset)} \n\t\t\t\t\t\t${toDomPrecision(width + offset)},${toDomPrecision(size)}`}\n\t\t\t\tstrokeWidth={cropStrokeWidth}\n\t\t\t\tdata-testid=\"selection.crop.top_right\"\n\t\t\t\taria-label=\"top_right handle\"\n\t\t\t/>\n\t\t\t{/* Right */}\n\t\t\t<line\n\t\t\t\tclassName={classNames('tl-corner-crop-edge-handle', {\n\t\t\t\t\t'tl-hidden': hideAlternateHandles,\n\t\t\t\t})}\n\t\t\t\tx1={toDomPrecision(width + offset)}\n\t\t\t\ty1={toDomPrecision(height / 2 - size)}\n\t\t\t\tx2={toDomPrecision(width + offset)}\n\t\t\t\ty2={toDomPrecision(height / 2 + size)}\n\t\t\t\tstrokeWidth={cropStrokeWidth}\n\t\t\t\tdata-testid=\"selection.crop.right\"\n\t\t\t\taria-label=\"right handle\"\n\t\t\t/>\n\t\t\t{/* Bottom right */}\n\t\t\t<polyline\n\t\t\t\tclassName=\"tl-corner-crop-handle\"\n\t\t\t\tpoints={`\n\t\t\t\t\t\t${toDomPrecision(width + offset)},${toDomPrecision(height - size)} \n\t\t\t\t\t\t${toDomPrecision(width + offset)},${toDomPrecision(height + offset)}\n\t\t\t\t\t\t${toDomPrecision(width - size)},${toDomPrecision(height + offset)}`}\n\t\t\t\tstrokeWidth={cropStrokeWidth}\n\t\t\t\tdata-testid=\"selection.crop.bottom_right\"\n\t\t\t\taria-label=\"bottom_right handle\"\n\t\t\t/>\n\t\t\t{/* Bottom */}\n\t\t\t<line\n\t\t\t\tclassName={classNames('tl-corner-crop-edge-handle', {\n\t\t\t\t\t'tl-hidden': hideAlternateHandles,\n\t\t\t\t})}\n\t\t\t\tx1={toDomPrecision(width / 2 - size)}\n\t\t\t\ty1={toDomPrecision(height + offset)}\n\t\t\t\tx2={toDomPrecision(width / 2 + size)}\n\t\t\t\ty2={toDomPrecision(height + offset)}\n\t\t\t\tstrokeWidth={cropStrokeWidth}\n\t\t\t\tdata-testid=\"selection.crop.bottom\"\n\t\t\t\taria-label=\"bottom handle\"\n\t\t\t/>\n\t\t\t{/* Bottom left */}\n\t\t\t<polyline\n\t\t\t\tclassName={classNames('tl-corner-crop-handle', {\n\t\t\t\t\t'tl-hidden': hideAlternateHandles,\n\t\t\t\t})}\n\t\t\t\tpoints={`\n\t\t\t\t\t\t${toDomPrecision(0 + size)},${toDomPrecision(height + offset)} \n\t\t\t\t\t\t${toDomPrecision(0 - offset)},${toDomPrecision(height + offset)}\n\t\t\t\t\t\t${toDomPrecision(0 - offset)},${toDomPrecision(height - size)}`}\n\t\t\t\tstrokeWidth={cropStrokeWidth}\n\t\t\t\tdata-testid=\"selection.crop.bottom_left\"\n\t\t\t\taria-label=\"bottom_left handle\"\n\t\t\t/>\n\t\t\t{/* Left */}\n\t\t\t<line\n\t\t\t\tclassName={classNames('tl-corner-crop-edge-handle', {\n\t\t\t\t\t'tl-hidden': hideAlternateHandles,\n\t\t\t\t})}\n\t\t\t\tx1={toDomPrecision(0 - offset)}\n\t\t\t\ty1={toDomPrecision(height / 2 - size)}\n\t\t\t\tx2={toDomPrecision(0 - offset)}\n\t\t\t\ty2={toDomPrecision(height / 2 + size)}\n\t\t\t\tstrokeWidth={cropStrokeWidth}\n\t\t\t\tdata-testid=\"selection.crop.left\"\n\t\t\t\taria-label=\"left handle\"\n\t\t\t/>\n\t\t</svg>\n\t)\n}\n", "import { TLDefaultFontStyle, TLDefaultSizeStyle } from '@tldraw/editor'\n\n/** @public */\nexport const TEXT_PROPS = {\n\tlineHeight: 1.35,\n\tfontWeight: 'normal',\n\tfontVariant: 'normal',\n\tfontStyle: 'normal',\n\tpadding: '0px',\n}\n\n/** @public */\nexport const STROKE_SIZES: Record<TLDefaultSizeStyle, number> = {\n\ts: 2,\n\tm: 3.5,\n\tl: 5,\n\txl: 10,\n}\n\n/** @public */\nexport const FONT_SIZES: Record<TLDefaultSizeStyle, number> = {\n\ts: 18,\n\tm: 24,\n\tl: 36,\n\txl: 44,\n}\n\n/** @public */\nexport const LABEL_FONT_SIZES: Record<TLDefaultSizeStyle, number> = {\n\ts: 18,\n\tm: 22,\n\tl: 26,\n\txl: 32,\n}\n\n/** @public */\nexport const ARROW_LABEL_FONT_SIZES: Record<TLDefaultSizeStyle, number> = {\n\ts: 18,\n\tm: 20,\n\tl: 24,\n\txl: 28,\n}\n\n/** @public */\nexport const FONT_FAMILIES: Record<TLDefaultFontStyle, string> = {\n\tdraw: 'var(--tl-font-draw)',\n\tsans: 'var(--tl-font-sans)',\n\tserif: 'var(--tl-font-serif)',\n\tmono: 'var(--tl-font-mono)',\n}\n\n/** @internal */\nexport const LABEL_TO_ARROW_PADDING = 20\n/** @internal */\nexport const ARROW_LABEL_PADDING = 4.25\n/** @internal */\nexport const LABEL_PADDING = 16\n", "/* eslint-env browser, worker */\n\n/**\n * Tests ability to read pixel data from canvas elements of various dimensions\n * by decreasing canvas height and/or width until a test succeeds.\n *\n * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n * IMPORTANT: DO NOT USE ES6 CODE THAT REQUIRES BABEL HELPERS IN THIS FILE.\n *            This function will be used on the main thread and as part of an\n *            inline web worker, but access to Babel helpers will be available\n *            only on the main thread.\n * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n *\n * @param {object} settings\n * @param {number[][]} settings.sizes\n * @param {function} settings.onError\n * @param {function} settings.onSuccess\n */\nfunction canvasTest(settings) {\n    const size     = settings.sizes.shift();\n    const width    = Math.max(Math.ceil(size[0]), 1);\n    const height   = Math.max(Math.ceil(size[1]), 1);\n    const fill     = [width - 1, height - 1, 1, 1]; // x, y, width, height\n    const job      = Date.now();\n    const isWorker = typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope;\n\n    let cropCvs, testCvs;\n\n    if (isWorker) {\n        cropCvs = new OffscreenCanvas(1, 1);\n        testCvs = new OffscreenCanvas(width, height);\n    }\n    else {\n        cropCvs = document.createElement('canvas');\n        cropCvs.width = 1;\n        cropCvs.height = 1;\n        testCvs = document.createElement('canvas');\n        testCvs.width = width;\n        testCvs.height = height;\n    }\n\n    const cropCtx = cropCvs.getContext('2d');\n    const testCtx = testCvs.getContext('2d');\n\n    if (testCtx) {\n        testCtx.fillRect.apply(testCtx, fill);\n\n        // Render the test pixel in the bottom-right corner of the\n        // test canvas in the top-left of the 1x1 crop canvas. This\n        // dramatically reducing the time for getImageData to complete.\n        cropCtx.drawImage(testCvs, width - 1, height - 1, 1, 1, 0, 0, 1, 1);\n    }\n\n    // Verify image data (Pass = 255, Fail = 0)\n    const isTestPass = cropCtx && cropCtx.getImageData(0, 0, 1, 1).data[3] !== 0;\n    const benchmark  = Date.now() - job; // milliseconds\n\n    // Release canvas elements (Safari memory usage fix)\n    // See: https://stackoverflow.com/questions/52532614/total-canvas-memory-use-exceeds-the-maximum-limit-safari-12\n    [cropCvs, testCvs].forEach(cvs => {\n        cvs.height = 0;\n        cvs.width = 0;\n    });\n\n    // Running in a web worker\n    if (isWorker) {\n        postMessage({\n            width,\n            height,\n            benchmark,\n            isTestPass\n        });\n\n        if (!isTestPass && settings.sizes.length) {\n            canvasTest(settings);\n        }\n    }\n    else if (isTestPass) {\n        settings.onSuccess(width, height, benchmark);\n    }\n    else {\n        settings.onError(width, height, benchmark);\n\n        if (settings.sizes.length) {\n            canvasTest(settings);\n        }\n    }\n\n    return isTestPass;\n}\n\nexport default canvasTest;\n", "const testSizes = {\n    area: [\n        // Chrome 70 (Mac, Win)\n        // Chrome 68 (Android 4.4)\n        // Edge 17 (Win)\n        // Safari 7-12 (Mac)\n        16384,\n        // Chrome 68 (Android 7.1-9)\n        14188,\n        // Chrome 68 (Android 5)\n        11402,\n        // Firefox 63 (Mac, Win)\n        11180,\n        // Chrome 68 (Android 6)\n        10836,\n        // IE 9-11 (Win)\n        8192,\n        // IE Mobile (Windows Phone 8.x)\n        // Safari (iOS 9 - 12)\n        4096,\n        // Failed\n        1\n    ],\n    height: [\n        // Safari 7-12 (Mac)\n        // Safari (iOS 9-12)\n        8388607,\n        // Chrome 83 (Mac, Win)\n        65535,\n        // Chrome 70 (Mac, Win)\n        // Chrome 68 (Android 4.4-9)\n        // Firefox 63 (Mac, Win)\n        32767,\n        // Edge 17 (Win)\n        // IE11 (Win)\n        16384,\n        // IE 9-10 (Win)\n        8192,\n        // IE Mobile (Windows Phone 8.x)\n        4096,\n        // Failed\n        1\n    ],\n    width: [\n        // Safari 7-12 (Mac)\n        // Safari (iOS 9-12)\n        4194303,\n        // Chrome 83 (Mac, Win)\n        65535,\n        // Chrome 70 (Mac, Win)\n        // Chrome 68 (Android 4.4-9)\n        // Firefox 63 (Mac, Win)\n        32767,\n        // Edge 17 (Win)\n        // IE11 (Win)\n        16384,\n        // IE 9-10 (Win)\n        8192,\n        // IE Mobile (Windows Phone 8.x)\n        4096,\n        // Failed\n        1\n    ]\n};\n\nexport default testSizes;", "import canvasTest from './canvas-test';\nimport testSizes from './test-sizes';\n\n\n// Constants & Variables\n// =============================================================================\nconst defaults = {\n    max       : null,\n    min       : 1,\n    sizes     : [],\n    step      : 1024,\n    usePromise: false,\n    useWorker : false,\n    // Callbacks\n    onError   : Function.prototype,\n    onSuccess : Function.prototype\n};\nconst workerJobs = {\n    // jobID: {\n    //     onError: fn(),\n    //     onSuccess: fn()\n    // }\n};\n\n\n// Functions (Private)\n// =============================================================================\n/**\n * Creates a 2d array of canvas dimensions either from the default testSizes\n * object or the width/height/min/step values provided.\n *\n * @param   {object} settings\n * @param   {number} settings.width\n * @param   {number} settings.height\n * @param   {number} settings.min\n * @param   {number} settings.step\n * @param   {number[][]} settings.sizes\n * @returns {number[][]}\n */\nfunction createSizesArray(settings) {\n    const isArea   = settings.width === settings.height;\n    const isWidth  = settings.height === 1;\n    const isHeight = settings.width === 1;\n    const sizes    = [];\n\n    // Use settings.sizes\n    if (!settings.width || !settings.height) {\n        settings.sizes.forEach(testSize => {\n            const width  = isArea || isWidth ? testSize : 1;\n            const height = isArea || isHeight ? testSize : 1;\n\n            sizes.push([width, height]);\n        });\n    }\n    // Generate sizes from width, height, and step\n    else {\n        const testMin  = settings.min || defaults.min;\n        const testStep = settings.step || defaults.step;\n        let   testSize = Math.max(settings.width, settings.height);\n\n        while (testSize >= testMin) {\n            const width  = isArea || isWidth ? testSize : 1;\n            const height = isArea || isHeight ? testSize : 1;\n\n            sizes.push([width, height]);\n            testSize -= testStep;\n        }\n    }\n\n    return sizes;\n}\n\n/**\n * Handles calls from maxArea(), maxHeight(), maxWidth(), and test() methods.\n *\n * @param {object} settings\n * @param {number[][]} settings.sizes\n * @param {function} settings.onError\n * @param {function} settings.onSuccess\n */\nfunction handleMethod(settings) {\n    const hasCanvasSupport          = window && 'HTMLCanvasElement' in window;\n    const hasOffscreenCanvasSupport = window && 'OffscreenCanvas' in window;\n    const jobID                     = Date.now();\n    const { onError, onSuccess, ...settingsWithoutCallbacks } = settings;\n\n    let worker  = null;\n\n    /* istanbul ignore if */\n    if (!hasCanvasSupport) {\n        return false;\n    }\n\n    // Create web worker\n    if (settings.useWorker && hasOffscreenCanvasSupport) {\n        const js = `\n            var canvasTest = ${canvasTest.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `;\n        const blob    = new Blob([js], { type: 'application/javascript' });\n        const blobURL = URL.createObjectURL(blob);\n\n        worker = new Worker(blobURL);\n        URL.revokeObjectURL(blobURL);\n\n        // Listen for messages from worker\n        worker.onmessage = function(e) {\n            const { width, height, benchmark, isTestPass } = e.data;\n\n            if (isTestPass) {\n                workerJobs[jobID].onSuccess(width, height, benchmark);\n\n                delete workerJobs[jobID];\n            }\n            else {\n                workerJobs[jobID].onError(width, height, benchmark);\n            }\n        };\n    }\n\n    // Promise\n    if (settings.usePromise) {\n        return new Promise((resolve, reject) => {\n            const promiseSettings = {\n                ...settings,\n                onError(width, height, benchmark) {\n                    let isLastTest;\n\n                    // If running on the main thread, an empty settings.sizes\n                    // array indicates the last test.\n                    if (settings.sizes.length === 0) {\n                        isLastTest = true;\n                    }\n                    // If running in a web worker, the settings.sizes array\n                    // accessible to this callback wil not be modified because a\n                    // copy of the settings object is sent to the worker.\n                    // Therefore, a comparison of the width and height returned\n                    // to this callback and the last [width, height] item in the\n                    // settings.sizes array is used to determine the last test.\n                    else {\n                        const [[lastWidth, lastHeight]] = settings.sizes.slice(-1);\n                        isLastTest = width === lastWidth && height === lastHeight;\n                    }\n\n                    onError(width, height, benchmark);\n\n                    if (isLastTest) {\n                        reject({ width, height, benchmark });\n                    }\n                },\n                onSuccess(width, height, benchmark) {\n                    onSuccess(width, height, benchmark);\n                    resolve({ width, height, benchmark });\n                }\n            };\n\n            if (worker) {\n                const { onError, onSuccess } = promiseSettings;\n\n                // Store callbacks in workerJobs object\n                workerJobs[jobID] = { onError, onSuccess };\n\n                // Send message to work\n                worker.postMessage(settingsWithoutCallbacks);\n            }\n            else {\n                canvasTest(promiseSettings);\n            }\n        });\n    }\n    // Standard Callbacks\n    else {\n        if (worker) {\n            // Store callbacks in workerJobs object\n            workerJobs[jobID] = { onError, onSuccess };\n\n            // Send message to worker\n            worker.postMessage(settingsWithoutCallbacks);\n        }\n        else {\n            return canvasTest(settings);\n        }\n    }\n}\n\n\n// Methods\n// =============================================================================\nconst canvasSize = {\n    /**\n     * Determines maximum area of an HTML canvas element. When `max` is\n     * unspecified, an optimized test will be performed using known maximum\n     * values from a variety of browsers and platforms.\n     *\n     * @param {object} [options]\n     * @param {number} [options.max]\n     * @param {number} [options.min=1]\n     * @param {number} [options.step=1024]\n     * @param {boolean} [options.usePromise=false]\n     * @param {boolean} [options.useWorker=false]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxArea(options = {}) {\n        const sizes = createSizesArray({\n            width : options.max,\n            height: options.max,\n            min   : options.min,\n            step  : options.step,\n            sizes : [...testSizes.area]\n        });\n        const settings = { ...defaults, ...options, sizes };\n\n        return handleMethod(settings);\n    },\n\n    /**\n     * Determines maximum height of an HTML canvas element. When `max` is\n     * unspecified, an optimized test will be performed using known maximum\n     * values from a variety of browsers and platforms.\n     *\n     * @param {object} [options]\n     * @param {number} [options.max]\n     * @param {number} [options.min=1]\n     * @param {number} [options.step=1024]\n     * @param {boolean} [options.usePromise=false]\n     * @param {boolean} [options.useWorker=false]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxHeight(options = {}) {\n        const sizes = createSizesArray({\n            width : 1,\n            height: options.max,\n            min   : options.min,\n            step  : options.step,\n            sizes : [...testSizes.height]\n        });\n        const settings = { ...defaults, ...options, sizes };\n\n        return handleMethod(settings);\n    },\n\n    /**\n     * Determines maximum width of an HTML canvas element. When `max` is\n     * unspecified, an optimized test will be performed using known maximum\n     * values from a variety of browsers and platforms.\n     *\n     * @param {object} [options]\n     * @param {number} [options.max]\n     * @param {number} [options.min=1]\n     * @param {number} [options.step=1024]\n     * @param {boolean} [options.usePromise=false]\n     * @param {boolean} [options.useWorker=false]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxWidth(options = {}) {\n        const sizes = createSizesArray({\n            width : options.max,\n            height: 1,\n            min   : options.min,\n            step  : options.step,\n            sizes : [...testSizes.width]\n        });\n        const settings = { ...defaults, ...options, sizes };\n\n        return handleMethod(settings);\n    },\n\n    /**\n     * Tests ability to read pixel data from canvas of specified dimension(s).\n     *\n     * @param {object} [options]\n     * @param {number} [options.width]\n     * @param {number} [options.height]\n     * @param {number[][]} [options.sizes]\n     * @param {boolean} [options.usePromise=false]\n     * @param {boolean} [options.useWorker=false]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    test(options = {}) {\n        const settings = { ...defaults, ...options };\n\n        // Prevent mutation of sizes array\n        settings.sizes = [...settings.sizes];\n\n        if (settings.width && settings.height) {\n            settings.sizes = [[settings.width, settings.height]];\n        }\n\n        return handleMethod(settings);\n    }\n};\n\n\n// Exports\n// =============================================================================\nexport default canvasSize;", "import canvasSize from 'canvas-size'\n\nexport type CanvasMaxSize = {\n\tmaxWidth: number\n\tmaxHeight: number\n\tmaxArea: number\n}\n\nlet maxSizePromise: Promise<CanvasMaxSize> | null = null\n\nfunction getBrowserCanvasMaxSize() {\n\tif (!maxSizePromise) {\n\t\tmaxSizePromise = calculateBrowserCanvasMaxSize()\n\t}\n\n\treturn maxSizePromise\n}\n\nasync function calculateBrowserCanvasMaxSize(): Promise<CanvasMaxSize> {\n\tconst maxWidth = await canvasSize.maxWidth({ usePromise: true })\n\tconst maxHeight = await canvasSize.maxHeight({ usePromise: true })\n\tconst maxArea = await canvasSize.maxArea({ usePromise: true })\n\treturn {\n\t\tmaxWidth: maxWidth.width,\n\t\tmaxHeight: maxHeight.height,\n\t\tmaxArea: maxArea.width * maxArea.height,\n\t}\n}\n\n// https://github.com/jhildenbiddle/canvas-size?tab=readme-ov-file#test-results\nconst MAX_SAFE_CANVAS_DIMENSION = 8192\nconst MAX_SAFE_CANVAS_AREA = 4096 * 4096\n\nexport async function clampToBrowserMaxCanvasSize(width: number, height: number) {\n\tif (\n\t\twidth <= MAX_SAFE_CANVAS_DIMENSION &&\n\t\theight <= MAX_SAFE_CANVAS_DIMENSION &&\n\t\twidth * height <= MAX_SAFE_CANVAS_AREA\n\t) {\n\t\treturn [width, height]\n\t}\n\n\tconst { maxWidth, maxHeight, maxArea } = await getBrowserCanvasMaxSize()\n\tconst aspectRatio = width / height\n\n\tif (width > maxWidth) {\n\t\twidth = maxWidth\n\t\theight = width / aspectRatio\n\t}\n\n\tif (height > maxHeight) {\n\t\theight = maxHeight\n\t\twidth = height * aspectRatio\n\t}\n\n\tif (width * height > maxArea) {\n\t\tconst ratio = Math.sqrt(maxArea / (width * height))\n\t\twidth *= ratio\n\t\theight *= ratio\n\t}\n\n\treturn [width, height]\n}\n", "/*!\n * MIT License\n * Modified code originally from <https://github.com/qzb/is-animated>\n * Copyright (c) 2016 J\u00F3zef Soko\u0142owski <j.k.sokolowski@gmail.com>\n */\n\n/** Returns total length of data blocks sequence */\nfunction getDataBlocksLength(buffer: Uint8Array, offset: number): number {\n\tlet length = 0\n\n\twhile (buffer[offset + length]) {\n\t\tlength += buffer[offset + length] + 1\n\t}\n\n\treturn length + 1\n}\n\n/**\n * Checks if buffer contains GIF image\n *\n * @public\n */\nexport function isGIF(buffer: ArrayBuffer): boolean {\n\tconst enc = new TextDecoder('ascii')\n\tconst header = enc.decode(buffer.slice(0, 3))\n\treturn header === 'GIF'\n}\n\n/**\n * Checks if buffer contains animated GIF image\n *\n * @public\n */\nexport function isAnimated(buffer: ArrayBuffer): boolean {\n\tconst view = new Uint8Array(buffer)\n\tlet hasColorTable, colorTableSize\n\tlet offset = 0\n\tlet imagesCount = 0\n\n\t// Check if this is this image has valid GIF header.\n\t// If not return false. Chrome, FF and IE doesn't handle GIFs with invalid version.\n\tif (!isGIF(buffer)) {\n\t\treturn false\n\t}\n\n\t// Skip header, logical screen descriptor and global color table\n\n\thasColorTable = view[10] & 0x80 // 0b10000000\n\tcolorTableSize = view[10] & 0x07 // 0b00000111\n\n\toffset += 6 // skip header\n\toffset += 7 // skip logical screen descriptor\n\toffset += hasColorTable ? 3 * Math.pow(2, colorTableSize + 1) : 0 // skip global color table\n\n\t// Find if there is more than one image descriptor\n\n\twhile (imagesCount < 2 && offset < view.length) {\n\t\tswitch (view[offset]) {\n\t\t\t// Image descriptor block. According to specification there could be any\n\t\t\t// number of these blocks (even zero). When there is more than one image\n\t\t\t// descriptor browsers will display animation (they shouldn't when there\n\t\t\t// is no delays defined, but they do it anyway).\n\t\t\tcase 0x2c:\n\t\t\t\timagesCount += 1\n\n\t\t\t\thasColorTable = view[offset + 9] & 0x80 // 0b10000000\n\t\t\t\tcolorTableSize = view[offset + 9] & 0x07 // 0b00000111\n\n\t\t\t\toffset += 10 // skip image descriptor\n\t\t\t\toffset += hasColorTable ? 3 * Math.pow(2, colorTableSize + 1) : 0 // skip local color table\n\t\t\t\toffset += getDataBlocksLength(view, offset + 1) + 1 // skip image data\n\n\t\t\t\tbreak\n\n\t\t\t// Skip all extension blocks. In theory this \"plain text extension\" blocks\n\t\t\t// could be frames of animation, but no browser renders them.\n\t\t\tcase 0x21:\n\t\t\t\toffset += 2 // skip introducer and label\n\t\t\t\toffset += getDataBlocksLength(view, offset) // skip this block and following data blocks\n\n\t\t\t\tbreak\n\n\t\t\t// Stop processing on trailer block,\n\t\t\t// all data after this point will is ignored by decoders\n\t\t\tcase 0x3b:\n\t\t\t\toffset = view.length // fast forward to end of buffer\n\t\t\t\tbreak\n\n\t\t\t// Oops! This GIF seems to be invalid\n\t\t\tdefault:\n\t\t\t\t// fast forward to end of buffer\n\t\t\t\toffset = view.length\n\t\t\t\tbreak\n\t\t}\n\t}\n\n\treturn imagesCount > 1\n}\n", "import { MediaHelpers, assertExists } from '@tldraw/editor'\nimport { clampToBrowserMaxCanvasSize } from '../../shapes/shared/getBrowserCanvasMaxSize'\nimport { isAnimated } from './is-gif-animated'\n\ntype BoxWidthHeight = {\n\tw: number\n\th: number\n}\n\n/**\n * Contains the size within the given box size\n *\n * @param originalSize - The size of the asset\n * @param containBoxSize - The container size\n * @returns Adjusted size\n * @public\n */\nexport function containBoxSize(\n\toriginalSize: BoxWidthHeight,\n\tcontainBoxSize: BoxWidthHeight\n): BoxWidthHeight {\n\tconst overByXScale = originalSize.w / containBoxSize.w\n\tconst overByYScale = originalSize.h / containBoxSize.h\n\n\tif (overByXScale <= 1 && overByYScale <= 1) {\n\t\treturn originalSize\n\t} else if (overByXScale > overByYScale) {\n\t\treturn {\n\t\t\tw: originalSize.w / overByXScale,\n\t\t\th: originalSize.h / overByXScale,\n\t\t}\n\t} else {\n\t\treturn {\n\t\t\tw: originalSize.w / overByYScale,\n\t\t\th: originalSize.h / overByYScale,\n\t\t}\n\t}\n}\n\n/**\n * Resize an image Blob to be smaller than it is currently.\n *\n * @example\n * ```ts\n * const image = await (await fetch('/image.jpg')).blob()\n * const size = await getImageSize(image)\n * const resizedImage = await downsizeImage(image, size.w / 2, size.h / 2, { type: \"image/jpeg\", quality: 0.92 })\n * ```\n *\n * @param image - The image Blob.\n * @param width - The desired width.\n * @param height - The desired height.\n * @param opts - Options for the image.\n * @public\n */\nexport async function downsizeImage(\n\tblob: Blob,\n\twidth: number,\n\theight: number,\n\topts = {} as { type?: string; quality?: number }\n): Promise<Blob> {\n\tconst image = await MediaHelpers.usingObjectURL(blob, MediaHelpers.loadImage)\n\tconst { type = blob.type, quality = 0.92 } = opts\n\tconst [desiredWidth, desiredHeight] = await clampToBrowserMaxCanvasSize(\n\t\tMath.min(width * 2, image.naturalWidth),\n\t\tMath.min(height * 2, image.naturalHeight)\n\t)\n\n\tconst canvas = document.createElement('canvas')\n\tcanvas.width = desiredWidth\n\tcanvas.height = desiredHeight\n\tconst ctx = assertExists(\n\t\tcanvas.getContext('2d', { willReadFrequently: true }),\n\t\t'Could not get canvas context'\n\t)\n\tctx.imageSmoothingEnabled = true\n\tctx.imageSmoothingQuality = 'high'\n\tctx.drawImage(image, 0, 0, desiredWidth, desiredHeight)\n\n\treturn new Promise((resolve, reject) => {\n\t\tcanvas.toBlob(\n\t\t\t(blob) => {\n\t\t\t\tif (blob) {\n\t\t\t\t\tresolve(blob)\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error('Could not resize image'))\n\t\t\t\t}\n\t\t\t},\n\t\t\ttype,\n\t\t\tquality\n\t\t)\n\t})\n}\n\n/** @public */\nexport const DEFAULT_ACCEPTED_IMG_TYPE = ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml']\n/** @public */\nexport const DEFAULT_ACCEPTED_VID_TYPE = ['video/mp4', 'video/quicktime']\n\n/** @public */\nexport async function isGifAnimated(file: Blob): Promise<boolean> {\n\treturn isAnimated(await file.arrayBuffer())\n}\n", "import { EMBED_DEFINITIONS, EmbedDefinition } from '@tldraw/editor'\n\n// https://github.com/sindresorhus/escape-string-regexp/blob/main/index.js\nfunction escapeStringRegexp(string: string) {\n\tif (typeof string !== 'string') {\n\t\tthrow new TypeError('Expected a string')\n\t}\n\n\t// Escape characters with special meaning either inside or outside character sets.\n\t// Use a simple backslash escape when it\u2019s always valid, and a `\\xnn` escape when the simpler form would be disallowed by Unicode patterns\u2019 stricter grammar.\n\treturn string.replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&').replace(/-/g, '\\\\x2d')\n}\n\n/** @public */\nexport function matchEmbedUrl(url: string) {\n\tconst host = new URL(url).host.replace('www.', '')\n\tfor (const localEmbedDef of EMBED_DEFINITIONS) {\n\t\tif (checkHostnames(localEmbedDef.hostnames, host)) {\n\t\t\tconst originalUrl = localEmbedDef.fromEmbedUrl(url)\n\t\t\tif (originalUrl) {\n\t\t\t\treturn {\n\t\t\t\t\tdefinition: localEmbedDef,\n\t\t\t\t\turl: originalUrl,\n\t\t\t\t\tembedUrl: url,\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nconst globlikeRegExp = (input: string) => {\n\treturn input\n\t\t.split('*')\n\t\t.map((str) => escapeStringRegexp(str))\n\t\t.join('.+')\n}\n\nconst checkHostnames = (hostnames: readonly string[], targetHostname: string) => {\n\treturn !!hostnames.find((hostname) => {\n\t\tconst re = new RegExp(globlikeRegExp(hostname))\n\t\treturn targetHostname.match(re)\n\t})\n}\n\n/** @public */\nexport function matchUrl(url: string) {\n\tconst host = new URL(url).host.replace('www.', '')\n\tfor (const localEmbedDef of EMBED_DEFINITIONS) {\n\t\tif (checkHostnames(localEmbedDef.hostnames, host)) {\n\t\t\tconst embedUrl = localEmbedDef.toEmbedUrl(url)\n\n\t\t\tif (embedUrl) {\n\t\t\t\treturn {\n\t\t\t\t\tdefinition: localEmbedDef,\n\t\t\t\t\tembedUrl,\n\t\t\t\t\turl,\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n/** @public */\nexport type TLEmbedResult =\n\t| {\n\t\t\tdefinition: EmbedDefinition\n\t\t\turl: string\n\t\t\tembedUrl: string\n\t  }\n\t| undefined\n\n/**\n * Tests whether an URL supports embedding and returns the result.\n *\n * @param inputUrl - The URL to match\n * @public\n */\nexport function getEmbedInfoUnsafely(inputUrl: string): TLEmbedResult {\n\tconst result = matchUrl(inputUrl) ?? matchEmbedUrl(inputUrl)\n\treturn result\n}\n\n/**\n * Tests whether an URL supports embedding and returns the result. If we encounter an error, we\n * return undefined.\n *\n * @param inputUrl - The URL to match\n * @public\n */\nexport function getEmbedInfo(inputUrl: string): TLEmbedResult {\n\ttry {\n\t\treturn getEmbedInfoUnsafely(inputUrl)\n\t} catch (e) {\n\t\t// Don't throw here! We'll throw it from the embed shape's shape util\n\t\tconsole.error(e)\n\t}\n\n\treturn undefined\n}\n", "/*!\n * MIT License\n * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit\n * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)\n */\n\n// TODO: Most of this file can be moved into a DOM utils library.\n\n/** @internal */\nexport type ReplacerCallback = (substring: string, ...args: unknown[]) => string\n\n/**\t@public */\nexport const INDENT = '  '\n\n/** @internal */\nexport class TextHelpers {\n\tstatic insertTextFirefox(field: HTMLTextAreaElement | HTMLInputElement, text: string): void {\n\t\t// Found on https://www.everythingfrontend.com/blog/insert-text-into-textarea-at-cursor-position.html \uD83C\uDF88\n\t\tfield.setRangeText(\n\t\t\ttext,\n\t\t\tfield.selectionStart || 0,\n\t\t\tfield.selectionEnd || 0,\n\t\t\t'end' // Without this, the cursor is either at the beginning or text remains selected\n\t\t)\n\n\t\tfield.dispatchEvent(\n\t\t\tnew InputEvent('input', {\n\t\t\t\tdata: text,\n\t\t\t\tinputType: 'insertText',\n\t\t\t\tisComposing: false, // TODO: fix @types/jsdom, this shouldn't be required\n\t\t\t})\n\t\t)\n\t}\n\n\t/**\n\t * Inserts text at the cursor\u2019s position, replacing any selection, with **undo** support and by\n\t * firing the input event.\n\t */\n\tstatic insert(field: HTMLTextAreaElement | HTMLInputElement, text: string): void {\n\t\tconst document = field.ownerDocument\n\t\tconst initialFocus = document.activeElement\n\t\tif (initialFocus !== field) {\n\t\t\tfield.focus()\n\t\t}\n\n\t\t// eslint-disable-next-line deprecation/deprecation\n\t\tif (!document.execCommand('insertText', false, text)) {\n\t\t\tTextHelpers.insertTextFirefox(field, text)\n\t\t}\n\n\t\tif (initialFocus === document.body) {\n\t\t\tfield.blur()\n\t\t} else if (initialFocus instanceof HTMLElement && initialFocus !== field) {\n\t\t\tinitialFocus.focus()\n\t\t}\n\t}\n\n\t/**\n\t * Replaces the entire content, equivalent to field.value = text but with **undo** support and by\n\t * firing the input event.\n\t */\n\tstatic set(field: HTMLTextAreaElement | HTMLInputElement, text: string): void {\n\t\tfield.select()\n\t\tTextHelpers.insert(field, text)\n\t}\n\n\t/** Get the selected text in a field or an empty string if nothing is selected. */\n\tstatic getSelection(field: HTMLTextAreaElement | HTMLInputElement): string {\n\t\tconst { selectionStart, selectionEnd } = field\n\t\treturn field.value.slice(\n\t\t\tselectionStart ? selectionStart : undefined,\n\t\t\tselectionEnd ? selectionEnd : undefined\n\t\t)\n\t}\n\n\t/**\n\t * Adds the wrappingText before and after field\u2019s selection (or cursor). If endWrappingText is\n\t * provided, it will be used instead of wrappingText at on the right.\n\t */\n\tstatic wrapSelection(\n\t\tfield: HTMLTextAreaElement | HTMLInputElement,\n\t\twrap: string,\n\t\twrapEnd?: string\n\t): void {\n\t\tconst { selectionStart, selectionEnd } = field\n\t\tconst selection = TextHelpers.getSelection(field)\n\t\tTextHelpers.insert(field, wrap + selection + (wrapEnd ?? wrap))\n\n\t\t// Restore the selection around the previously-selected text\n\t\tfield.selectionStart = (selectionStart || 0) + wrap.length\n\t\tfield.selectionEnd = (selectionEnd || 0) + wrap.length\n\t}\n\n\t/** Finds and replaces strings and regex in the field\u2019s value. */\n\tstatic replace(\n\t\tfield: HTMLTextAreaElement | HTMLInputElement,\n\t\tsearchValue: string | RegExp,\n\t\treplacer: string | ReplacerCallback\n\t): void {\n\t\t/** Remembers how much each match offset should be adjusted */\n\t\tlet drift = 0\n\t\tfield.value.replace(searchValue, (...args): string => {\n\t\t\t// Select current match to replace it later\n\t\t\tconst matchStart = drift + (args[args.length - 2] as number)\n\t\t\tconst matchLength = args[0].length\n\t\t\tfield.selectionStart = matchStart\n\t\t\tfield.selectionEnd = matchStart + matchLength\n\t\t\tconst replacement = typeof replacer === 'string' ? replacer : replacer(...args)\n\t\t\tTextHelpers.insert(field, replacement)\n\t\t\t// Select replacement. Without this, the cursor would be after the replacement\n\t\t\tfield.selectionStart = matchStart\n\t\t\tdrift += replacement.length - matchLength\n\t\t\treturn replacement\n\t\t})\n\t}\n\n\tstatic findLineEnd(value: string, currentEnd: number): number {\n\t\t// Go to the beginning of the last line\n\t\tconst lastLineStart = value.lastIndexOf('\\n', currentEnd - 1) + 1\n\t\t// There's nothing to unindent after the last cursor, so leave it as is\n\t\tif (value.charAt(lastLineStart) !== '\\t') {\n\t\t\treturn currentEnd\n\t\t}\n\t\treturn lastLineStart + 1 // Include the first character, which will be a tab\n\t}\n\n\tstatic indent(element: HTMLTextAreaElement): void {\n\t\tconst { selectionStart, selectionEnd, value } = element\n\t\tconst selectedContrast = value.slice(selectionStart, selectionEnd)\n\t\t// The first line should be indented, even if it starts with \\n\n\t\t// The last line should only be indented if includes any character after \\n\n\t\tconst lineBreakCount = /\\n/g.exec(selectedContrast)?.length\n\n\t\tif (lineBreakCount && lineBreakCount > 0) {\n\t\t\t// Select full first line to replace everything at once\n\t\t\tconst firstLineStart = value.lastIndexOf('\\n', selectionStart - 1) + 1\n\n\t\t\tconst newSelection = element.value.slice(firstLineStart, selectionEnd - 1)\n\t\t\tconst indentedText = newSelection.replace(\n\t\t\t\t/^|\\n/g, // Match all line starts\n\t\t\t\t`$&${INDENT}`\n\t\t\t)\n\t\t\tconst replacementsCount = indentedText.length - newSelection.length\n\n\t\t\t// Replace newSelection with indentedText\n\t\t\telement.setSelectionRange(firstLineStart, selectionEnd - 1)\n\t\t\tTextHelpers.insert(element, indentedText)\n\n\t\t\t// Restore selection position, including the indentation\n\t\t\telement.setSelectionRange(selectionStart + 1, selectionEnd + replacementsCount)\n\t\t} else {\n\t\t\tTextHelpers.insert(element, INDENT)\n\t\t}\n\t}\n\n\t// The first line should always be unindented\n\t// The last line should only be unindented if the selection includes any characters after \\n\n\tstatic unindent(element: HTMLTextAreaElement): void {\n\t\tconst { selectionStart, selectionEnd, value } = element\n\n\t\t// Select the whole first line because it might contain \\t\n\t\tconst firstLineStart = value.lastIndexOf('\\n', selectionStart - 1) + 1\n\t\tconst minimumSelectionEnd = TextHelpers.findLineEnd(value, selectionEnd)\n\n\t\tconst newSelection = element.value.slice(firstLineStart, minimumSelectionEnd)\n\t\tconst indentedText = newSelection.replace(/(^|\\n)(\\t| {1,2})/g, '$1')\n\t\tconst replacementsCount = newSelection.length - indentedText.length\n\n\t\t// Replace newSelection with indentedText\n\t\telement.setSelectionRange(firstLineStart, minimumSelectionEnd)\n\t\tTextHelpers.insert(element, indentedText)\n\n\t\t// Restore selection position, including the indentation\n\t\tconst firstLineIndentation = /\\t| {1,2}/.exec(value.slice(firstLineStart, selectionStart))\n\n\t\tconst difference = firstLineIndentation ? firstLineIndentation[0].length : 0\n\n\t\tconst newSelectionStart = selectionStart - difference\n\t\telement.setSelectionRange(\n\t\t\tselectionStart - difference,\n\t\t\tMath.max(newSelectionStart, selectionEnd - replacementsCount)\n\t\t)\n\t}\n\n\tstatic indentCE(element: HTMLElement): void {\n\t\tconst selection = window.getSelection()\n\t\tconst value = element.innerText\n\t\tconst selectionStart = getCaretIndex(element) ?? 0\n\t\tconst selectionEnd = getCaretIndex(element) ?? 0\n\t\tconst selectedContrast = value.slice(selectionStart, selectionEnd)\n\t\t// The first line should be indented, even if it starts with \\n\n\t\t// The last line should only be indented if includes any character after \\n\n\t\tconst lineBreakCount = /\\n/g.exec(selectedContrast)?.length\n\n\t\tif (lineBreakCount && lineBreakCount > 0) {\n\t\t\t// Select full first line to replace everything at once\n\t\t\tconst firstLineStart = value.lastIndexOf('\\n', selectionStart - 1) + 1\n\n\t\t\tconst newSelection = value.slice(firstLineStart, selectionEnd - 1)\n\t\t\tconst indentedText = newSelection.replace(\n\t\t\t\t/^|\\n/g, // Match all line starts\n\t\t\t\t`$&${INDENT}`\n\t\t\t)\n\t\t\tconst replacementsCount = indentedText.length - newSelection.length\n\n\t\t\t// Replace newSelection with indentedText\n\n\t\t\tif (selection) {\n\t\t\t\tselection.setBaseAndExtent(\n\t\t\t\t\telement,\n\t\t\t\t\tselectionStart + 1,\n\t\t\t\t\telement,\n\t\t\t\t\tselectionEnd + replacementsCount\n\t\t\t\t)\n\t\t\t\t// element.setSelectionRange(firstLineStart, selectionEnd - 1)\n\t\t\t\t// TextHelpers.insert(element, indentedText)\n\n\t\t\t\t// Restore selection position, including the indentation\n\t\t\t\t// element.setSelectionRange(selectionStart + 1, selectionEnd + replacementsCount)\n\t\t\t}\n\t\t} else {\n\t\t\tconst selection = window.getSelection()\n\t\t\telement.innerText = value.slice(0, selectionStart) + INDENT + value.slice(selectionStart)\n\t\t\tselection?.setBaseAndExtent(element, selectionStart + 1, element, selectionStart + 2)\n\t\t\t// TextHelpers.insert(element, INDENT)\n\t\t}\n\t}\n\n\tstatic unindentCE(element: HTMLElement): void {\n\t\tconst selection = window.getSelection()\n\t\tconst value = element.innerText\n\t\t// const { selectionStart, selectionEnd } = element\n\t\tconst selectionStart = getCaretIndex(element) ?? 0\n\t\tconst selectionEnd = getCaretIndex(element) ?? 0\n\n\t\t// Select the whole first line because it might contain \\t\n\t\tconst firstLineStart = value.lastIndexOf('\\n', selectionStart - 1) + 1\n\t\tconst minimumSelectionEnd = TextHelpers.findLineEnd(value, selectionEnd)\n\n\t\tconst newSelection = value.slice(firstLineStart, minimumSelectionEnd)\n\t\tconst indentedText = newSelection.replace(/(^|\\n)(\\t| {1,2})/g, '$1')\n\t\tconst replacementsCount = newSelection.length - indentedText.length\n\n\t\tif (selection) {\n\t\t\t// Replace newSelection with indentedText\n\t\t\tselection.setBaseAndExtent(element, firstLineStart, element, minimumSelectionEnd)\n\t\t\t// TextHelpers.insert(element, indentedText)\n\n\t\t\t// Restore selection position, including the indentation\n\t\t\tconst firstLineIndentation = /\\t| {1,2}/.exec(value.slice(firstLineStart, selectionStart))\n\n\t\t\tconst difference = firstLineIndentation ? firstLineIndentation[0].length : 0\n\n\t\t\tconst newSelectionStart = selectionStart - difference\n\t\t\tselection.setBaseAndExtent(\n\t\t\t\telement,\n\t\t\t\tselectionStart - difference,\n\t\t\t\telement,\n\t\t\t\tMath.max(newSelectionStart, selectionEnd - replacementsCount)\n\t\t\t)\n\t\t}\n\t}\n\n\tstatic fixNewLines = /\\r?\\n|\\r/g\n\n\tstatic normalizeText(text: string) {\n\t\treturn text.replace(TextHelpers.fixNewLines, '\\n')\n\t}\n\n\tstatic normalizeTextForDom(text: string) {\n\t\treturn text\n\t\t\t.replace(TextHelpers.fixNewLines, '\\n')\n\t\t\t.split('\\n')\n\t\t\t.map((x) => x || ' ')\n\t\t\t.join('\\n')\n\t}\n}\n\nfunction getCaretIndex(element: HTMLElement) {\n\tif (typeof window.getSelection === 'undefined') return\n\tconst selection = window.getSelection()\n\tif (!selection) return\n\tlet position = 0\n\tif (selection.rangeCount !== 0) {\n\t\tconst range = selection.getRangeAt(0)\n\t\tconst preCaretRange = range.cloneRange()\n\t\tpreCaretRange.selectNodeContents(element)\n\t\tpreCaretRange.setEnd(range.endContainer, range.endOffset)\n\t\tposition = preCaretRange.toString().length\n\t}\n\treturn position\n}\n", "import { INDENT } from '../../shapes/shared/TextHelpers'\n\nconst rtlRegex = /[\\u0590-\\u05FF\\u0600-\\u06FF\\u0750-\\u077F\\u08A0-\\u08FF\\uFB50-\\uFDFF\\uFE70-\\uFEFF]/\nexport function isRightToLeftLanguage(text: string) {\n\treturn rtlRegex.test(text)\n}\n\n/**\n * Replace any tabs with double spaces.\n * @param text - The text to replace tabs in.\n * @internal\n */\nfunction replaceTabsWithSpaces(text: string) {\n\treturn text.replace(/\\t/g, INDENT)\n}\n\n/**\n * Strip common minimum indentation from each line.\n * @param text - The text to strip.\n * @internal\n */\nfunction stripCommonMinimumIndentation(text: string): string {\n\t// Split the text into individual lines\n\tconst lines = text.split('\\n')\n\n\t// remove any leading lines that are only whitespace or newlines\n\twhile (lines[0] && lines[0].trim().length === 0) {\n\t\tlines.shift()\n\t}\n\n\tlet minIndentation = Infinity\n\tfor (const line of lines) {\n\t\tif (line.trim().length > 0) {\n\t\t\tconst indentation = line.length - line.trimStart().length\n\t\t\tminIndentation = Math.min(minIndentation, indentation)\n\t\t}\n\t}\n\n\treturn lines.map((line) => line.slice(minIndentation)).join('\\n')\n}\n\n/**\n * Strip trailing whitespace from each line and remove any trailing newlines.\n * @param text - The text to strip.\n * @internal\n */\nfunction stripTrailingWhitespace(text: string): string {\n\treturn text.replace(/[ \\t]+$/gm, '').replace(/\\n+$/, '')\n}\n\n/** @internal */\nexport function cleanupText(text: string) {\n\treturn stripTrailingWhitespace(stripCommonMinimumIndentation(replaceTabsWithSpaces(text)))\n}\n\n/** @public */\nexport const truncateStringWithEllipsis = (str: string, maxLength: number) => {\n\treturn str.length <= maxLength ? str : str.substring(0, maxLength - 3) + '...'\n}\n", "import {\n\tAssetRecordType,\n\tEditor,\n\tFileHelpers,\n\tMediaHelpers,\n\tTLAsset,\n\tTLAssetId,\n\tTLBookmarkShape,\n\tTLEmbedShape,\n\tTLShapeId,\n\tTLShapePartial,\n\tTLTextShape,\n\tTLTextShapeProps,\n\tVec,\n\tVecLike,\n\tassert,\n\tcompact,\n\tcreateShapeId,\n\tgetHashForBuffer,\n\tgetHashForString,\n} from '@tldraw/editor'\nimport { FONT_FAMILIES, FONT_SIZES, TEXT_PROPS } from './shapes/shared/default-shape-constants'\nimport { TLUiToastsContextType } from './ui/context/toasts'\nimport { useTranslation } from './ui/hooks/useTranslation/useTranslation'\nimport { containBoxSize, downsizeImage, isGifAnimated } from './utils/assets/assets'\nimport { getEmbedInfo } from './utils/embeds/embeds'\nimport { cleanupText, isRightToLeftLanguage, truncateStringWithEllipsis } from './utils/text/text'\n\n/** @public */\nexport type TLExternalContentProps = {\n\t// The maximum dimension (width or height) of an image. Images larger than this will be rescaled to fit. Defaults to infinity.\n\tmaxImageDimension: number\n\t// The maximum size (in bytes) of an asset. Assets larger than this will be rejected. Defaults to 10mb (10 * 1024 * 1024).\n\tmaxAssetSize: number\n\t// The mime types of images that are allowed to be handled. Defaults to ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml'].\n\tacceptedImageMimeTypes: readonly string[]\n\t// The mime types of videos that are allowed to be handled. Defaults to ['video/mp4', 'video/webm', 'video/quicktime'].\n\tacceptedVideoMimeTypes: readonly string[]\n}\n\nexport function registerDefaultExternalContentHandlers(\n\teditor: Editor,\n\t{\n\t\tmaxImageDimension,\n\t\tmaxAssetSize,\n\t\tacceptedImageMimeTypes,\n\t\tacceptedVideoMimeTypes,\n\t}: TLExternalContentProps,\n\t{ toasts, msg }: { toasts: TLUiToastsContextType; msg: ReturnType<typeof useTranslation> }\n) {\n\t// files -> asset\n\teditor.registerExternalAssetHandler('file', async ({ file: _file }) => {\n\t\tconst name = _file.name\n\t\tlet file: Blob = _file\n\t\tconst isImageType = acceptedImageMimeTypes.includes(file.type)\n\t\tconst isVideoType = acceptedVideoMimeTypes.includes(file.type)\n\n\t\tassert(isImageType || isVideoType, `File type not allowed: ${file.type}`)\n\t\tassert(\n\t\t\tfile.size <= maxAssetSize,\n\t\t\t`File size too big: ${(file.size / 1024).toFixed()}kb > ${(maxAssetSize / 1024).toFixed()}kb`\n\t\t)\n\n\t\tif (file.type === 'video/quicktime') {\n\t\t\t// hack to make .mov videos work\n\t\t\tfile = new Blob([file], { type: 'video/mp4' })\n\t\t}\n\n\t\tlet size = isImageType\n\t\t\t? await MediaHelpers.getImageSize(file)\n\t\t\t: await MediaHelpers.getVideoSize(file)\n\n\t\tconst isAnimated = file.type === 'image/gif' ? await isGifAnimated(file) : isVideoType\n\n\t\tconst hash = await getHashForBuffer(await file.arrayBuffer())\n\n\t\tif (isFinite(maxImageDimension)) {\n\t\t\tconst resizedSize = containBoxSize(size, { w: maxImageDimension, h: maxImageDimension })\n\t\t\tif (size !== resizedSize && (file.type === 'image/jpeg' || file.type === 'image/png')) {\n\t\t\t\tsize = resizedSize\n\t\t\t}\n\t\t}\n\n\t\t// Always rescale the image\n\t\tif (file.type === 'image/jpeg' || file.type === 'image/png') {\n\t\t\tfile = await downsizeImage(file, size.w, size.h, {\n\t\t\t\ttype: file.type,\n\t\t\t\tquality: 0.92,\n\t\t\t})\n\t\t}\n\n\t\tconst assetId: TLAssetId = AssetRecordType.createId(hash)\n\n\t\tconst asset = AssetRecordType.create({\n\t\t\tid: assetId,\n\t\t\ttype: isImageType ? 'image' : 'video',\n\t\t\ttypeName: 'asset',\n\t\t\tprops: {\n\t\t\t\tname,\n\t\t\t\tsrc: await FileHelpers.blobToDataUrl(file),\n\t\t\t\tw: size.w,\n\t\t\t\th: size.h,\n\t\t\t\tmimeType: file.type,\n\t\t\t\tisAnimated,\n\t\t\t},\n\t\t})\n\n\t\treturn asset\n\t})\n\n\t// urls -> bookmark asset\n\teditor.registerExternalAssetHandler('url', async ({ url }) => {\n\t\tlet meta: { image: string; title: string; description: string }\n\n\t\ttry {\n\t\t\tconst resp = await fetch(url, { method: 'GET', mode: 'no-cors' })\n\t\t\tconst html = await resp.text()\n\t\t\tconst doc = new DOMParser().parseFromString(html, 'text/html')\n\t\t\tmeta = {\n\t\t\t\timage: doc.head.querySelector('meta[property=\"og:image\"]')?.getAttribute('content') ?? '',\n\t\t\t\ttitle:\n\t\t\t\t\tdoc.head.querySelector('meta[property=\"og:title\"]')?.getAttribute('content') ??\n\t\t\t\t\ttruncateStringWithEllipsis(url, 32),\n\t\t\t\tdescription:\n\t\t\t\t\tdoc.head.querySelector('meta[property=\"og:description\"]')?.getAttribute('content') ?? '',\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(error)\n\t\t\ttoasts.addToast({\n\t\t\t\ttitle: msg('assets.url.failed'),\n\t\t\t\tseverity: 'error',\n\t\t\t})\n\t\t\tmeta = { image: '', title: truncateStringWithEllipsis(url, 32), description: '' }\n\t\t}\n\n\t\t// Create the bookmark asset from the meta\n\t\treturn {\n\t\t\tid: AssetRecordType.createId(getHashForString(url)),\n\t\t\ttypeName: 'asset',\n\t\t\ttype: 'bookmark',\n\t\t\tprops: {\n\t\t\t\tsrc: url,\n\t\t\t\tdescription: meta.description,\n\t\t\t\timage: meta.image,\n\t\t\t\ttitle: meta.title,\n\t\t\t},\n\t\t\tmeta: {},\n\t\t}\n\t})\n\n\t// svg text\n\teditor.registerExternalContentHandler('svg-text', async ({ point, text }) => {\n\t\tconst position =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey ? editor.inputs.currentPagePoint : editor.getViewportPageCenter())\n\n\t\tconst svg = new DOMParser().parseFromString(text, 'image/svg+xml').querySelector('svg')\n\t\tif (!svg) {\n\t\t\tthrow new Error('No <svg/> element present')\n\t\t}\n\n\t\tlet width = parseFloat(svg.getAttribute('width') || '0')\n\t\tlet height = parseFloat(svg.getAttribute('height') || '0')\n\n\t\tif (!(width && height)) {\n\t\t\tdocument.body.appendChild(svg)\n\t\t\tconst box = svg.getBoundingClientRect()\n\t\t\tdocument.body.removeChild(svg)\n\n\t\t\twidth = box.width\n\t\t\theight = box.height\n\t\t}\n\n\t\tconst asset = await editor.getAssetForExternalContent({\n\t\t\ttype: 'file',\n\t\t\tfile: new File([text], 'asset.svg', { type: 'image/svg+xml' }),\n\t\t})\n\n\t\tif (!asset) throw Error('Could not create an asset')\n\n\t\tcreateShapesForAssets(editor, [asset], position)\n\t})\n\n\t// embeds\n\teditor.registerExternalContentHandler('embed', ({ point, url, embed }) => {\n\t\tconst position =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey ? editor.inputs.currentPagePoint : editor.getViewportPageCenter())\n\n\t\tconst { width, height } = embed\n\n\t\tconst id = createShapeId()\n\n\t\tconst shapePartial: TLShapePartial<TLEmbedShape> = {\n\t\t\tid,\n\t\t\ttype: 'embed',\n\t\t\tx: position.x - (width || 450) / 2,\n\t\t\ty: position.y - (height || 450) / 2,\n\t\t\tprops: {\n\t\t\t\tw: width,\n\t\t\t\th: height,\n\t\t\t\turl,\n\t\t\t},\n\t\t}\n\n\t\teditor.createShapes([shapePartial]).select(id)\n\t})\n\n\t// files\n\teditor.registerExternalContentHandler('files', async ({ point, files }) => {\n\t\tconst position =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey ? editor.inputs.currentPagePoint : editor.getViewportPageCenter())\n\n\t\tconst pagePoint = new Vec(position.x, position.y)\n\n\t\tconst assets: TLAsset[] = []\n\n\t\tawait Promise.all(\n\t\t\tfiles.map(async (file, i) => {\n\t\t\t\tif (file.size > maxAssetSize) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`File size too big: ${(file.size / 1024).toFixed()}kb > ${(\n\t\t\t\t\t\t\tmaxAssetSize / 1024\n\t\t\t\t\t\t).toFixed()}kb`\n\t\t\t\t\t)\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\t// Use mime type instead of file ext, this is because\n\t\t\t\t// window.navigator.clipboard does not preserve file names\n\t\t\t\t// of copied files.\n\t\t\t\tif (!file.type) {\n\t\t\t\t\tthrow new Error('No mime type')\n\t\t\t\t}\n\n\t\t\t\t// We can only accept certain extensions (either images or a videos)\n\t\t\t\tif (!acceptedImageMimeTypes.concat(acceptedVideoMimeTypes).includes(file.type)) {\n\t\t\t\t\tconsole.warn(`${file.name} not loaded - Extension not allowed.`)\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tconst asset = await editor.getAssetForExternalContent({ type: 'file', file })\n\n\t\t\t\t\tif (!asset) {\n\t\t\t\t\t\tthrow Error('Could not create an asset')\n\t\t\t\t\t}\n\n\t\t\t\t\tassets[i] = asset\n\t\t\t\t} catch (error) {\n\t\t\t\t\ttoasts.addToast({\n\t\t\t\t\t\ttitle: msg('assets.files.upload-failed'),\n\t\t\t\t\t\tseverity: 'error',\n\t\t\t\t\t})\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t\treturn null\n\t\t\t\t}\n\t\t\t})\n\t\t)\n\n\t\tcreateShapesForAssets(editor, compact(assets), pagePoint)\n\t})\n\n\t// text\n\teditor.registerExternalContentHandler('text', async ({ point, text }) => {\n\t\tconst p =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey ? editor.inputs.currentPagePoint : editor.getViewportPageCenter())\n\n\t\tconst defaultProps = editor.getShapeUtil<TLTextShape>('text').getDefaultProps()\n\n\t\tconst textToPaste = cleanupText(text)\n\n\t\t// If we're pasting into a text shape, update the text.\n\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\tif (onlySelectedShape && 'text' in onlySelectedShape.props) {\n\t\t\teditor.updateShapes([\n\t\t\t\t{\n\t\t\t\t\tid: onlySelectedShape.id,\n\t\t\t\t\ttype: onlySelectedShape.type,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttext: textToPaste,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\n\t\t\treturn\n\t\t}\n\n\t\t// Measure the text with default values\n\t\tlet w: number\n\t\tlet h: number\n\t\tlet autoSize: boolean\n\t\tlet align = 'middle' as TLTextShapeProps['align']\n\n\t\tconst isMultiLine = textToPaste.split('\\n').length > 1\n\n\t\t// check whether the text contains the most common characters in RTL languages\n\t\tconst isRtl = isRightToLeftLanguage(textToPaste)\n\n\t\tif (isMultiLine) {\n\t\t\talign = isMultiLine ? (isRtl ? 'end' : 'start') : 'middle'\n\t\t}\n\n\t\tconst rawSize = editor.textMeasure.measureText(textToPaste, {\n\t\t\t...TEXT_PROPS,\n\t\t\tfontFamily: FONT_FAMILIES[defaultProps.font],\n\t\t\tfontSize: FONT_SIZES[defaultProps.size],\n\t\t\tmaxWidth: null,\n\t\t})\n\n\t\tconst minWidth = Math.min(\n\t\t\tisMultiLine ? editor.getViewportPageBounds().width * 0.9 : 920,\n\t\t\tMath.max(200, editor.getViewportPageBounds().width * 0.9)\n\t\t)\n\n\t\tif (rawSize.w > minWidth) {\n\t\t\tconst shrunkSize = editor.textMeasure.measureText(textToPaste, {\n\t\t\t\t...TEXT_PROPS,\n\t\t\t\tfontFamily: FONT_FAMILIES[defaultProps.font],\n\t\t\t\tfontSize: FONT_SIZES[defaultProps.size],\n\t\t\t\tmaxWidth: minWidth,\n\t\t\t})\n\t\t\tw = shrunkSize.w\n\t\t\th = shrunkSize.h\n\t\t\tautoSize = false\n\t\t\talign = isRtl ? 'end' : 'start'\n\t\t} else {\n\t\t\t// autosize is fine\n\t\t\tw = rawSize.w\n\t\t\th = rawSize.h\n\t\t\tautoSize = true\n\t\t}\n\n\t\tif (p.y - h / 2 < editor.getViewportPageBounds().minY + 40) {\n\t\t\tp.y = editor.getViewportPageBounds().minY + 40 + h / 2\n\t\t}\n\n\t\teditor.createShapes<TLTextShape>([\n\t\t\t{\n\t\t\t\tid: createShapeId(),\n\t\t\t\ttype: 'text',\n\t\t\t\tx: p.x - w / 2,\n\t\t\t\ty: p.y - h / 2,\n\t\t\t\tprops: {\n\t\t\t\t\ttext: textToPaste,\n\t\t\t\t\t// if the text has more than one line, align it to the left\n\t\t\t\t\talign,\n\t\t\t\t\tautoSize,\n\t\t\t\t\tw,\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\t})\n\n\t// url\n\teditor.registerExternalContentHandler('url', async ({ point, url }) => {\n\t\t// try to paste as an embed first\n\t\tconst embedInfo = getEmbedInfo(url)\n\n\t\tif (embedInfo) {\n\t\t\treturn editor.putExternalContent({\n\t\t\t\ttype: 'embed',\n\t\t\t\turl: embedInfo.url,\n\t\t\t\tpoint,\n\t\t\t\tembed: embedInfo.definition,\n\t\t\t})\n\t\t}\n\n\t\tconst position =\n\t\t\tpoint ??\n\t\t\t(editor.inputs.shiftKey ? editor.inputs.currentPagePoint : editor.getViewportPageCenter())\n\n\t\tconst assetId: TLAssetId = AssetRecordType.createId(getHashForString(url))\n\t\tconst shape = createEmptyBookmarkShape(editor, url, position)\n\n\t\t// Use an existing asset if we have one, or else else create a new one\n\t\tlet asset = editor.getAsset(assetId) as TLAsset\n\t\tlet shouldAlsoCreateAsset = false\n\t\tif (!asset) {\n\t\t\tshouldAlsoCreateAsset = true\n\t\t\ttry {\n\t\t\t\tconst bookmarkAsset = await editor.getAssetForExternalContent({ type: 'url', url })\n\t\t\t\tif (!bookmarkAsset) throw Error('Could not create an asset')\n\t\t\t\tasset = bookmarkAsset\n\t\t\t} catch (e) {\n\t\t\t\ttoasts.addToast({\n\t\t\t\t\ttitle: msg('assets.url.failed'),\n\t\t\t\t\tseverity: 'error',\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\teditor.batch(() => {\n\t\t\tif (shouldAlsoCreateAsset) {\n\t\t\t\teditor.createAssets([asset])\n\t\t\t}\n\n\t\t\teditor.updateShapes([\n\t\t\t\t{\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: shape.type,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tassetId: asset.id,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\t\t})\n\t})\n}\n\nexport async function createShapesForAssets(\n\teditor: Editor,\n\tassets: TLAsset[],\n\tposition: VecLike\n): Promise<TLShapeId[]> {\n\tif (!assets.length) return []\n\n\tconst currentPoint = Vec.From(position)\n\tconst partials: TLShapePartial[] = []\n\n\tfor (const asset of assets) {\n\t\tswitch (asset.type) {\n\t\t\tcase 'bookmark': {\n\t\t\t\tpartials.push({\n\t\t\t\t\tid: createShapeId(),\n\t\t\t\t\ttype: 'bookmark',\n\t\t\t\t\tx: currentPoint.x - 150,\n\t\t\t\t\ty: currentPoint.y - 160,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tassetId: asset.id,\n\t\t\t\t\t\turl: asset.props.src,\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tcurrentPoint.x += 300\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'image': {\n\t\t\t\tpartials.push({\n\t\t\t\t\tid: createShapeId(),\n\t\t\t\t\ttype: 'image',\n\t\t\t\t\tx: currentPoint.x - asset.props.w / 2,\n\t\t\t\t\ty: currentPoint.y - asset.props.h / 2,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tassetId: asset.id,\n\t\t\t\t\t\tw: asset.props.w,\n\t\t\t\t\t\th: asset.props.h,\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tcurrentPoint.x += asset.props.w\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'video': {\n\t\t\t\tpartials.push({\n\t\t\t\t\tid: createShapeId(),\n\t\t\t\t\ttype: 'video',\n\t\t\t\t\tx: currentPoint.x - asset.props.w / 2,\n\t\t\t\t\ty: currentPoint.y - asset.props.h / 2,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tassetId: asset.id,\n\t\t\t\t\t\tw: asset.props.w,\n\t\t\t\t\t\th: asset.props.h,\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tcurrentPoint.x += asset.props.w\n\t\t\t}\n\t\t}\n\t}\n\n\teditor.batch(() => {\n\t\t// Create any assets\n\t\tconst assetsToCreate = assets.filter((asset) => !editor.getAsset(asset.id))\n\t\tif (assetsToCreate.length) {\n\t\t\teditor.createAssets(assetsToCreate)\n\t\t}\n\n\t\t// Create the shapes\n\t\teditor.createShapes(partials).select(...partials.map((p) => p.id))\n\n\t\t// Re-position shapes so that the center of the group is at the provided point\n\t\tcenterSelectionAroundPoint(editor, position)\n\t})\n\n\treturn partials.map((p) => p.id)\n}\n\nfunction centerSelectionAroundPoint(editor: Editor, position: VecLike) {\n\t// Re-position shapes so that the center of the group is at the provided point\n\tconst viewportPageBounds = editor.getViewportPageBounds()\n\tlet selectionPageBounds = editor.getSelectionPageBounds()\n\n\tif (selectionPageBounds) {\n\t\tconst offset = selectionPageBounds!.center.sub(position)\n\n\t\teditor.updateShapes(\n\t\t\teditor.getSelectedShapes().map((shape) => {\n\t\t\t\tconst localRotation = editor.getShapeParentTransform(shape).decompose().rotation\n\t\t\t\tconst localDelta = Vec.Rot(offset, -localRotation)\n\t\t\t\treturn {\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: shape.type,\n\t\t\t\t\tx: shape.x! - localDelta.x,\n\t\t\t\t\ty: shape.y! - localDelta.y,\n\t\t\t\t}\n\t\t\t})\n\t\t)\n\t}\n\n\t// Zoom out to fit the shapes, if necessary\n\tselectionPageBounds = editor.getSelectionPageBounds()\n\tif (selectionPageBounds && !viewportPageBounds.contains(selectionPageBounds)) {\n\t\teditor.zoomToSelection()\n\t}\n}\n\nexport function createEmptyBookmarkShape(\n\teditor: Editor,\n\turl: string,\n\tposition: VecLike\n): TLBookmarkShape {\n\tconst partial: TLShapePartial = {\n\t\tid: createShapeId(),\n\t\ttype: 'bookmark',\n\t\tx: position.x - 150,\n\t\ty: position.y - 160,\n\t\topacity: 1,\n\t\tprops: {\n\t\t\tassetId: null,\n\t\t\turl,\n\t\t},\n\t}\n\n\teditor.batch(() => {\n\t\teditor.createShapes([partial]).select(partial.id)\n\t\tcenterSelectionAroundPoint(editor, position)\n\t})\n\n\treturn editor.getShape(partial.id) as TLBookmarkShape\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('pointing', info)\n\t}\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n\n\toverride onKeyUp: TLEventHandlers['onKeyUp'] = (info) => {\n\t\tif (info.key === 'Enter') {\n\t\t\tif (this.editor.getInstanceState().isReadonly) return null\n\t\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\t\t\t// If the only selected shape is editable, start editing it\n\t\t\tif (\n\t\t\t\tonlySelectedShape &&\n\t\t\t\tthis.editor.getShapeUtil(onlySelectedShape).canEdit(onlySelectedShape)\n\t\t\t) {\n\t\t\t\tthis.editor.setCurrentTool('select')\n\t\t\t\tthis.editor.setEditingShape(onlySelectedShape.id)\n\t\t\t\tthis.editor.root.getCurrent()?.transition('editing_shape', {\n\t\t\t\t\t...info,\n\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\tshape: onlySelectedShape,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n}\n", "import { StateNode, TLArrowShape, TLEventHandlers, createShapeId } from '@tldraw/editor'\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\tshape?: TLArrowShape\n\n\tmarkId = ''\n\n\toverride onEnter = () => {\n\t\tthis.didTimeout = false\n\n\t\tconst target = this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint, {\n\t\t\tfilter: (targetShape) => {\n\t\t\t\treturn !targetShape.isLocked && this.editor.getShapeUtil(targetShape).canBind(targetShape)\n\t\t\t},\n\t\t\tmargin: 0,\n\t\t\thitInside: true,\n\t\t\trenderingOnly: true,\n\t\t})\n\n\t\tif (!target) {\n\t\t\tthis.createArrowShape()\n\t\t} else {\n\t\t\tthis.editor.setHintingShapes([target.id])\n\t\t}\n\n\t\tthis.startPreciseTimeout()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.shape = undefined\n\t\tthis.editor.setHintingShapes([])\n\t\tthis.clearPreciseTimeout()\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tif (!this.shape) {\n\t\t\t\tthis.createArrowShape()\n\t\t\t}\n\n\t\t\tif (!this.shape) throw Error(`expected shape`)\n\n\t\t\tthis.updateArrowShapeEndHandle()\n\n\t\t\tthis.editor.setCurrentTool('select.dragging_handle', {\n\t\t\t\tshape: this.shape,\n\t\t\t\thandle: this.editor.getShapeHandles(this.shape)!.find((h) => h.id === 'end')!,\n\t\t\t\tisCreating: true,\n\t\t\t\tonInteractionEnd: 'arrow',\n\t\t\t})\n\t\t}\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt: TLEventHandlers['onInterrupt'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tcancel() {\n\t\tif (this.shape) {\n\t\t\t// the arrow might not have been created yet!\n\t\t\tthis.editor.bailToMark(this.markId)\n\t\t}\n\t\tthis.editor.setHintingShapes([])\n\t\tthis.parent.transition('idle')\n\t}\n\n\tcreateArrowShape() {\n\t\tconst { originPagePoint } = this.editor.inputs\n\n\t\tconst id = createShapeId()\n\n\t\tthis.markId = `creating:${id}`\n\t\tthis.editor.mark(this.markId)\n\n\t\tthis.editor.createShapes<TLArrowShape>([\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\ttype: 'arrow',\n\t\t\t\tx: originPagePoint.x,\n\t\t\t\ty: originPagePoint.y,\n\t\t\t},\n\t\t])\n\n\t\tconst shape = this.editor.getShape<TLArrowShape>(id)\n\t\tif (!shape) throw Error(`expected shape`)\n\n\t\tconst handles = this.editor.getShapeHandles(shape)\n\t\tif (!handles) throw Error(`expected handles for arrow`)\n\n\t\tconst util = this.editor.getShapeUtil<TLArrowShape>('arrow')\n\t\tconst initial = this.shape\n\t\tconst startHandle = handles.find((h) => h.id === 'start')!\n\t\tconst change = util.onHandleDrag?.(shape, {\n\t\t\thandle: { ...startHandle, x: 0, y: 0 },\n\t\t\tisPrecise: true,\n\t\t\tinitial: initial,\n\t\t})\n\n\t\tif (change) {\n\t\t\tconst startTerminal = change.props?.start\n\t\t\tif (startTerminal?.type === 'binding') {\n\t\t\t\tthis.editor.setHintingShapes([startTerminal.boundShapeId])\n\t\t\t}\n\t\t\tthis.editor.updateShapes([change], { squashing: true })\n\t\t}\n\n\t\t// Cache the current shape after those changes\n\t\tthis.shape = this.editor.getShape(id)\n\t\tthis.editor.select(id)\n\t}\n\n\tupdateArrowShapeEndHandle() {\n\t\tconst shape = this.shape\n\t\tif (!shape) throw Error(`expected shape`)\n\n\t\tconst handles = this.editor.getShapeHandles(shape)\n\t\tif (!handles) throw Error(`expected handles for arrow`)\n\n\t\tconst shapeWithOutEndOffset = {\n\t\t\t...shape,\n\t\t\tprops: { ...shape.props, end: { ...shape.props.end, x: 0, y: 0 } },\n\t\t}\n\n\t\t// end update\n\t\t{\n\t\t\tconst util = this.editor.getShapeUtil<TLArrowShape>('arrow')\n\t\t\tconst initial = this.shape\n\t\t\tconst point = this.editor.getPointInShapeSpace(shape, this.editor.inputs.currentPagePoint)\n\t\t\tconst endHandle = handles.find((h) => h.id === 'end')!\n\t\t\tconst change = util.onHandleDrag?.(shapeWithOutEndOffset, {\n\t\t\t\thandle: { ...endHandle, x: point.x, y: point.y },\n\t\t\t\tisPrecise: false, // sure about that?\n\t\t\t\tinitial: initial,\n\t\t\t})\n\n\t\t\tif (change) {\n\t\t\t\tconst endTerminal = change.props?.end\n\t\t\t\tif (endTerminal?.type === 'binding') {\n\t\t\t\t\tthis.editor.setHintingShapes([endTerminal.boundShapeId])\n\t\t\t\t}\n\t\t\t\tthis.editor.updateShapes([change], { squashing: true })\n\t\t\t}\n\t\t}\n\n\t\t// start update\n\t\t{\n\t\t\tconst util = this.editor.getShapeUtil<TLArrowShape>('arrow')\n\t\t\tconst initial = this.shape\n\t\t\tconst startHandle = handles.find((h) => h.id === 'start')!\n\t\t\tconst change = util.onHandleDrag?.(shapeWithOutEndOffset, {\n\t\t\t\thandle: { ...startHandle, x: 0, y: 0 },\n\t\t\t\tisPrecise: this.didTimeout, // sure about that?\n\t\t\t\tinitial: initial,\n\t\t\t})\n\n\t\t\tif (change) {\n\t\t\t\tthis.editor.updateShapes([change], { squashing: true })\n\t\t\t}\n\t\t}\n\n\t\t// Cache the current shape after those changes\n\t\tthis.shape = this.editor.getShape(shape.id)\n\t}\n\n\tprivate preciseTimeout = -1\n\tprivate didTimeout = false\n\tprivate startPreciseTimeout() {\n\t\tthis.preciseTimeout = window.setTimeout(() => {\n\t\t\tif (!this.getIsActive()) return\n\t\t\tthis.didTimeout = true\n\t\t}, 320)\n\t}\n\tprivate clearPreciseTimeout() {\n\t\tclearTimeout(this.preciseTimeout)\n\t}\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Idle } from './toolStates/Idle'\nimport { Pointing } from './toolStates/Pointing'\n\n/** @public */\nexport class ArrowShapeTool extends StateNode {\n\tstatic override id = 'arrow'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Pointing]\n\n\toverride shapeType = 'arrow'\n}\n", "import {\n\tDRAG_DISTANCE,\n\tMat,\n\tStateNode,\n\tTLDefaultSizeStyle,\n\tTLDrawShape,\n\tTLDrawShapeSegment,\n\tTLEventHandlers,\n\tTLHighlightShape,\n\tTLPointerEventInfo,\n\tTLShapePartial,\n\tVec,\n\tVecModel,\n\tcreateShapeId,\n\tlast,\n\tsnapAngle,\n\tstructuredClone,\n\ttoFixed,\n\tuniqueId,\n} from '@tldraw/editor'\nimport { STROKE_SIZES } from '../../shared/default-shape-constants'\n\ntype DrawableShape = TLDrawShape | TLHighlightShape\n\nexport class Drawing extends StateNode {\n\tstatic override id = 'drawing'\n\n\tinfo = {} as TLPointerEventInfo\n\n\tinitialShape?: DrawableShape\n\n\toverride shapeType = this.parent.id === 'highlight' ? ('highlight' as const) : ('draw' as const)\n\n\tutil = this.editor.getShapeUtil(this.shapeType)\n\n\tisPen = false\n\n\tsegmentMode = 'free' as 'free' | 'straight' | 'starting_straight' | 'starting_free'\n\n\tdidJustShiftClickToExtendPreviousShapeLine = false\n\n\tpagePointWhereCurrentSegmentChanged = {} as Vec\n\n\tpagePointWhereNextSegmentChanged = null as Vec | null\n\n\tlastRecordedPoint = {} as Vec\n\tmergeNextPoint = false\n\tcurrentLineLength = 0\n\n\tcanDraw = false\n\n\tmarkId = null as null | string\n\n\toverride onEnter = (info: TLPointerEventInfo) => {\n\t\tthis.markId = null\n\t\tthis.info = info\n\t\tthis.canDraw = !this.editor.getIsMenuOpen()\n\t\tthis.lastRecordedPoint = this.editor.inputs.currentPagePoint.clone()\n\t\tif (this.canDraw) {\n\t\t\tthis.startShape()\n\t\t}\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tconst { inputs } = this.editor\n\n\t\tif (this.isPen !== inputs.isPen) {\n\t\t\t// The user made a palm gesture before starting a pen gesture;\n\t\t\t// ideally we'd start the new shape here but we could also just bail\n\t\t\t// as the next interaction will work correctly\n\t\t\tif (this.markId) {\n\t\t\t\tthis.editor.bailToMark(this.markId)\n\t\t\t\tthis.startShape()\n\t\t\t\treturn\n\t\t\t}\n\t\t} else {\n\t\t\t// If we came in from a menu but have no started dragging...\n\t\t\tif (!this.canDraw && inputs.isDragging) {\n\t\t\t\tthis.startShape()\n\t\t\t\tthis.canDraw = true // bad name\n\t\t\t}\n\t\t}\n\n\t\tif (this.canDraw) {\n\t\t\tif (inputs.isPen) {\n\t\t\t\t// Don't update the shape if we haven't moved far enough from the last time we recorded a point\n\t\t\t\tif (\n\t\t\t\t\tVec.Dist(inputs.currentPagePoint, this.lastRecordedPoint) >=\n\t\t\t\t\t1 / this.editor.getZoomLevel()\n\t\t\t\t) {\n\t\t\t\t\tthis.lastRecordedPoint = inputs.currentPagePoint.clone()\n\t\t\t\t\tthis.mergeNextPoint = false\n\t\t\t\t} else {\n\t\t\t\t\tthis.mergeNextPoint = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.mergeNextPoint = false\n\t\t\t}\n\n\t\t\tthis.updateDrawingShape()\n\t\t}\n\t}\n\n\toverride onKeyDown: TLEventHandlers['onKeyDown'] = (info) => {\n\t\tif (info.key === 'Shift') {\n\t\t\tswitch (this.segmentMode) {\n\t\t\t\tcase 'free': {\n\t\t\t\t\t// We've just entered straight mode, go to straight mode\n\t\t\t\t\tthis.segmentMode = 'starting_straight'\n\t\t\t\t\tthis.pagePointWhereNextSegmentChanged = this.editor.inputs.currentPagePoint.clone()\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'starting_free': {\n\t\t\t\t\tthis.segmentMode = 'starting_straight'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.updateDrawingShape()\n\t}\n\n\toverride onKeyUp: TLEventHandlers['onKeyUp'] = (info) => {\n\t\tif (info.key === 'Shift') {\n\t\t\tthis.editor.snaps.clearIndicators()\n\n\t\t\tswitch (this.segmentMode) {\n\t\t\t\tcase 'straight': {\n\t\t\t\t\t// We've just exited straight mode, go back to free mode\n\t\t\t\t\tthis.segmentMode = 'starting_free'\n\t\t\t\t\tthis.pagePointWhereNextSegmentChanged = this.editor.inputs.currentPagePoint.clone()\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'starting_straight': {\n\t\t\t\t\tthis.pagePointWhereNextSegmentChanged = null\n\t\t\t\t\tthis.segmentMode = 'free'\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.updateDrawingShape()\n\t}\n\n\toverride onExit? = () => {\n\t\tthis.editor.snaps.clearIndicators()\n\t\tthis.pagePointWhereCurrentSegmentChanged = this.editor.inputs.currentPagePoint.clone()\n\t}\n\n\tcanClose() {\n\t\treturn this.shapeType !== 'highlight'\n\t}\n\n\tgetIsClosed(segments: TLDrawShapeSegment[], size: TLDefaultSizeStyle) {\n\t\tif (!this.canClose()) return false\n\n\t\tconst strokeWidth = STROKE_SIZES[size]\n\t\tconst firstPoint = segments[0].points[0]\n\t\tconst lastSegment = segments[segments.length - 1]\n\t\tconst lastPoint = lastSegment.points[lastSegment.points.length - 1]\n\n\t\treturn (\n\t\t\tfirstPoint !== lastPoint &&\n\t\t\tthis.currentLineLength > strokeWidth * 4 &&\n\t\t\tVec.DistMin(firstPoint, lastPoint, strokeWidth * 2)\n\t\t)\n\t}\n\n\tprivate startShape() {\n\t\tconst {\n\t\t\tinputs: { originPagePoint, isPen },\n\t\t} = this.editor\n\n\t\tthis.markId = 'draw start ' + uniqueId()\n\t\tthis.editor.mark(this.markId)\n\n\t\tthis.isPen = isPen\n\n\t\tconst pressure = this.isPen ? this.info.point.z! * 1.25 : 0.5\n\n\t\tthis.segmentMode = this.editor.inputs.shiftKey ? 'straight' : 'free'\n\n\t\tthis.didJustShiftClickToExtendPreviousShapeLine = false\n\n\t\tthis.lastRecordedPoint = originPagePoint.clone()\n\n\t\tif (this.initialShape) {\n\t\t\tconst shape = this.editor.getShape<DrawableShape>(this.initialShape.id)\n\n\t\t\tif (shape && this.segmentMode === 'straight') {\n\t\t\t\t// Connect dots\n\n\t\t\t\tthis.didJustShiftClickToExtendPreviousShapeLine = true\n\n\t\t\t\tconst prevSegment = last(shape.props.segments)\n\t\t\t\tif (!prevSegment) throw Error('Expected a previous segment!')\n\t\t\t\tconst prevPoint = last(prevSegment.points)\n\t\t\t\tif (!prevPoint) throw Error('Expected a previous point!')\n\n\t\t\t\tconst { x, y } = this.editor.getPointInShapeSpace(shape, originPagePoint).toFixed()\n\n\t\t\t\tconst pressure = this.isPen ? this.info.point.z! * 1.25 : 0.5\n\n\t\t\t\tconst newSegment: TLDrawShapeSegment = {\n\t\t\t\t\ttype: this.segmentMode,\n\t\t\t\t\tpoints: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx: prevPoint.x,\n\t\t\t\t\t\t\ty: prevPoint.y,\n\t\t\t\t\t\t\tz: +pressure.toFixed(2),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\ty,\n\t\t\t\t\t\t\tz: +pressure.toFixed(2),\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}\n\n\t\t\t\t// Convert prevPoint to page space\n\t\t\t\tconst prevPointPageSpace = Mat.applyToPoint(\n\t\t\t\t\tthis.editor.getShapePageTransform(shape.id)!,\n\t\t\t\t\tprevPoint\n\t\t\t\t)\n\t\t\t\tthis.pagePointWhereCurrentSegmentChanged = prevPointPageSpace\n\t\t\t\tthis.pagePointWhereNextSegmentChanged = null\n\t\t\t\tconst segments = [...shape.props.segments, newSegment]\n\n\t\t\t\tif (this.currentLineLength < STROKE_SIZES[shape.props.size] * 4) {\n\t\t\t\t\tthis.currentLineLength = this.getLineLength(segments)\n\t\t\t\t}\n\n\t\t\t\tconst shapePartial: TLShapePartial<DrawableShape> = {\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: this.shapeType,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tsegments,\n\t\t\t\t\t},\n\t\t\t\t}\n\n\t\t\t\tif (this.canClose()) {\n\t\t\t\t\t;(shapePartial as TLShapePartial<TLDrawShape>).props!.isClosed = this.getIsClosed(\n\t\t\t\t\t\tsegments,\n\t\t\t\t\t\tshape.props.size\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tthis.editor.updateShapes<TLDrawShape | TLHighlightShape>([shapePartial])\n\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\t// Create a new shape\n\n\t\tthis.pagePointWhereCurrentSegmentChanged = originPagePoint.clone()\n\t\tconst id = createShapeId()\n\n\t\tthis.editor.createShapes<DrawableShape>([\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\ttype: this.shapeType,\n\t\t\t\tx: originPagePoint.x,\n\t\t\t\ty: originPagePoint.y,\n\t\t\t\tprops: {\n\t\t\t\t\tisPen: this.isPen,\n\t\t\t\t\tsegments: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: this.segmentMode,\n\t\t\t\t\t\t\tpoints: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\t\t\tz: +pressure.toFixed(2),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\t\tthis.currentLineLength = 0\n\t\tthis.initialShape = this.editor.getShape<DrawableShape>(id)\n\t}\n\n\tprivate updateDrawingShape() {\n\t\tconst { initialShape } = this\n\t\tconst { inputs } = this.editor\n\n\t\tif (!initialShape) return\n\n\t\tconst {\n\t\t\tid,\n\t\t\tprops: { size },\n\t\t} = initialShape\n\n\t\tconst shape = this.editor.getShape<DrawableShape>(id)!\n\n\t\tif (!shape) return\n\n\t\tconst { segments } = shape.props\n\n\t\tconst { x, y, z } = this.editor.getPointInShapeSpace(shape, inputs.currentPagePoint).toFixed()\n\n\t\tconst newPoint = { x, y, z: this.isPen ? +(z! * 1.25).toFixed(2) : 0.5 }\n\n\t\tswitch (this.segmentMode) {\n\t\t\tcase 'starting_straight': {\n\t\t\t\tconst { pagePointWhereNextSegmentChanged } = this\n\n\t\t\t\tif (pagePointWhereNextSegmentChanged === null) {\n\t\t\t\t\tthrow Error('We should have a point where the segment changed')\n\t\t\t\t}\n\n\t\t\t\tconst hasMovedFarEnough =\n\t\t\t\t\tVec.Dist2(pagePointWhereNextSegmentChanged, inputs.currentPagePoint) > DRAG_DISTANCE\n\n\t\t\t\t// Find the distance from where the pointer was when shift was released and\n\t\t\t\t// where it is now; if it's far enough away, then update the page point where\n\t\t\t\t// the current segment changed (to match the pagepoint where next segment changed)\n\t\t\t\t// and set the pagepoint where next segment changed to null.\n\t\t\t\tif (hasMovedFarEnough) {\n\t\t\t\t\tthis.pagePointWhereCurrentSegmentChanged = this.pagePointWhereNextSegmentChanged!.clone()\n\t\t\t\t\tthis.pagePointWhereNextSegmentChanged = null\n\n\t\t\t\t\t// Set the new mode\n\t\t\t\t\tthis.segmentMode = 'straight'\n\n\t\t\t\t\tconst prevSegment = last(segments)\n\t\t\t\t\tif (!prevSegment) throw Error('Expected a previous segment!')\n\n\t\t\t\t\tconst prevLastPoint = last(prevSegment.points)\n\t\t\t\t\tif (!prevLastPoint) throw Error('Expected a previous last point!')\n\n\t\t\t\t\tlet newSegment: TLDrawShapeSegment\n\n\t\t\t\t\tconst newLastPoint = this.editor\n\t\t\t\t\t\t.getPointInShapeSpace(shape, this.pagePointWhereCurrentSegmentChanged)\n\t\t\t\t\t\t.toFixed()\n\t\t\t\t\t\t.toJson()\n\n\t\t\t\t\tif (prevSegment.type === 'straight') {\n\t\t\t\t\t\tthis.currentLineLength += Vec.Dist(prevLastPoint, newLastPoint)\n\n\t\t\t\t\t\tnewSegment = {\n\t\t\t\t\t\t\ttype: 'straight',\n\t\t\t\t\t\t\tpoints: [{ ...prevLastPoint }, newLastPoint],\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst transform = this.editor.getShapePageTransform(shape)!\n\n\t\t\t\t\t\tthis.pagePointWhereCurrentSegmentChanged = Mat.applyToPoint(transform, prevLastPoint)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewSegment = {\n\t\t\t\t\t\t\ttype: 'straight',\n\t\t\t\t\t\t\tpoints: [newLastPoint, newPoint],\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst shapePartial: TLShapePartial<DrawableShape> = {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype: this.shapeType,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tsegments: [...segments, newSegment],\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.canClose()) {\n\t\t\t\t\t\t;(shapePartial as TLShapePartial<TLDrawShape>).props!.isClosed = this.getIsClosed(\n\t\t\t\t\t\t\tsegments,\n\t\t\t\t\t\t\tsize\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.editor.updateShapes<TLDrawShape | TLHighlightShape>([shapePartial], {\n\t\t\t\t\t\tsquashing: true,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'starting_free': {\n\t\t\t\tconst { pagePointWhereNextSegmentChanged } = this\n\n\t\t\t\tif (pagePointWhereNextSegmentChanged === null) {\n\t\t\t\t\tthrow Error('We should have a point where the segment changed')\n\t\t\t\t}\n\n\t\t\t\tconst hasMovedFarEnough =\n\t\t\t\t\tVec.Dist2(pagePointWhereNextSegmentChanged, inputs.currentPagePoint) > DRAG_DISTANCE\n\n\t\t\t\t// Find the distance from where the pointer was when shift was released and\n\t\t\t\t// where it is now; if it's far enough away, then update the page point where\n\t\t\t\t// the current segment changed (to match the pagepoint where next segment changed)\n\t\t\t\t// and set the pagepoint where next segment changed to null.\n\t\t\t\tif (hasMovedFarEnough) {\n\t\t\t\t\tthis.pagePointWhereCurrentSegmentChanged = this.pagePointWhereNextSegmentChanged!.clone()\n\t\t\t\t\tthis.pagePointWhereNextSegmentChanged = null\n\n\t\t\t\t\t// Set the new mode\n\t\t\t\t\tthis.segmentMode = 'free'\n\n\t\t\t\t\tconst newSegments = segments.slice()\n\t\t\t\t\tconst prevStraightSegment = newSegments[newSegments.length - 1]\n\t\t\t\t\tconst prevPoint = last(prevStraightSegment.points)\n\n\t\t\t\t\tif (!prevPoint) {\n\t\t\t\t\t\tthrow Error('No previous point!')\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create the new free segment and interpolate the points between where the last line\n\t\t\t\t\t// ended and where the pointer is now\n\t\t\t\t\tconst newFreeSegment: TLDrawShapeSegment = {\n\t\t\t\t\t\ttype: 'free',\n\t\t\t\t\t\tpoints: [...Vec.PointsBetween(prevPoint, newPoint, 6).map((p) => p.toFixed().toJson())],\n\t\t\t\t\t}\n\n\t\t\t\t\tconst finalSegments = [...newSegments, newFreeSegment]\n\n\t\t\t\t\tif (this.currentLineLength < STROKE_SIZES[shape.props.size] * 4) {\n\t\t\t\t\t\tthis.currentLineLength = this.getLineLength(finalSegments)\n\t\t\t\t\t}\n\n\t\t\t\t\tconst shapePartial: TLShapePartial<DrawableShape> = {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype: this.shapeType,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tsegments: finalSegments,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.canClose()) {\n\t\t\t\t\t\t;(shapePartial as TLShapePartial<TLDrawShape>).props!.isClosed = this.getIsClosed(\n\t\t\t\t\t\t\tfinalSegments,\n\t\t\t\t\t\t\tsize\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.editor.updateShapes([shapePartial], { squashing: true })\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'straight': {\n\t\t\t\tconst newSegments = segments.slice()\n\t\t\t\tconst newSegment = newSegments[newSegments.length - 1]\n\n\t\t\t\tconst { pagePointWhereCurrentSegmentChanged } = this\n\t\t\t\tconst { ctrlKey, currentPagePoint } = this.editor.inputs\n\n\t\t\t\tif (!pagePointWhereCurrentSegmentChanged)\n\t\t\t\t\tthrow Error('We should have a point where the segment changed')\n\n\t\t\t\tlet pagePoint: VecModel\n\t\t\t\tlet shouldSnapToAngle = false\n\n\t\t\t\tif (this.didJustShiftClickToExtendPreviousShapeLine) {\n\t\t\t\t\tif (this.editor.inputs.isDragging) {\n\t\t\t\t\t\t// If we've just shift clicked to extend a line, only snap once we've started dragging\n\t\t\t\t\t\tshouldSnapToAngle = !ctrlKey\n\t\t\t\t\t\tthis.didJustShiftClickToExtendPreviousShapeLine = false\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// noop\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If we're not shift clicking to extend a line, but we're holding shift, then we should snap\n\t\t\t\t\tshouldSnapToAngle = !ctrlKey // don't snap angle while snapping line\n\t\t\t\t}\n\n\t\t\t\tlet newPoint = this.editor.getPointInShapeSpace(shape, currentPagePoint).toFixed().toJson()\n\t\t\t\tlet didSnap = false\n\t\t\t\tlet snapSegment: TLDrawShapeSegment | undefined = undefined\n\n\t\t\t\tconst shouldSnap = this.editor.user.getIsSnapMode() ? !ctrlKey : ctrlKey\n\n\t\t\t\tif (shouldSnap) {\n\t\t\t\t\tif (newSegments.length > 2) {\n\t\t\t\t\t\tlet nearestPoint: VecModel | undefined = undefined\n\t\t\t\t\t\tlet minDistance = 8 / this.editor.getZoomLevel()\n\n\t\t\t\t\t\t// Don't try to snap to the last two segments\n\t\t\t\t\t\tfor (let i = 0, n = segments.length - 2; i < n; i++) {\n\t\t\t\t\t\t\tconst segment = segments[i]\n\t\t\t\t\t\t\tif (!segment) break\n\t\t\t\t\t\t\tif (segment.type === 'free') continue\n\n\t\t\t\t\t\t\tconst first = segment.points[0]\n\t\t\t\t\t\t\tconst lastPoint = last(segment.points)\n\t\t\t\t\t\t\tif (!(first && lastPoint)) continue\n\n\t\t\t\t\t\t\t// Snap to the nearest point on the segment, if it's closer than the previous snapped point\n\t\t\t\t\t\t\tconst nearestPointOnSegment = Vec.NearestPointOnLineSegment(\n\t\t\t\t\t\t\t\tfirst,\n\t\t\t\t\t\t\t\tlastPoint,\n\t\t\t\t\t\t\t\tnewPoint\n\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\tif (Vec.DistMin(nearestPointOnSegment, newPoint, minDistance)) {\n\t\t\t\t\t\t\t\tnearestPoint = nearestPointOnSegment.toFixed().toJson()\n\t\t\t\t\t\t\t\tminDistance = Vec.Dist(nearestPointOnSegment, newPoint)\n\t\t\t\t\t\t\t\tsnapSegment = segment\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (nearestPoint) {\n\t\t\t\t\t\t\tdidSnap = true\n\t\t\t\t\t\t\tnewPoint = nearestPoint\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (didSnap && snapSegment) {\n\t\t\t\t\tconst transform = this.editor.getShapePageTransform(shape)!\n\t\t\t\t\tconst first = snapSegment.points[0]\n\t\t\t\t\tconst lastPoint = last(snapSegment.points)\n\t\t\t\t\tif (!lastPoint) throw Error('Expected a last point!')\n\n\t\t\t\t\tconst A = Mat.applyToPoint(transform, first)\n\n\t\t\t\t\tconst B = Mat.applyToPoint(transform, lastPoint)\n\n\t\t\t\t\tconst snappedPoint = Mat.applyToPoint(transform, newPoint)\n\n\t\t\t\t\tthis.editor.snaps.setIndicators([\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\ttype: 'points',\n\t\t\t\t\t\t\tpoints: [A, snappedPoint, B],\n\t\t\t\t\t\t},\n\t\t\t\t\t])\n\t\t\t\t} else {\n\t\t\t\t\tthis.editor.snaps.clearIndicators()\n\n\t\t\t\t\tif (shouldSnapToAngle) {\n\t\t\t\t\t\t// Snap line angle to nearest 15 degrees\n\t\t\t\t\t\tconst currentAngle = Vec.Angle(pagePointWhereCurrentSegmentChanged, currentPagePoint)\n\t\t\t\t\t\tconst snappedAngle = snapAngle(currentAngle, 24)\n\t\t\t\t\t\tconst angleDiff = snappedAngle - currentAngle\n\n\t\t\t\t\t\tpagePoint = Vec.RotWith(\n\t\t\t\t\t\t\tcurrentPagePoint,\n\t\t\t\t\t\t\tpagePointWhereCurrentSegmentChanged,\n\t\t\t\t\t\t\tangleDiff\n\t\t\t\t\t\t)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpagePoint = currentPagePoint\n\t\t\t\t\t}\n\n\t\t\t\t\tnewPoint = this.editor.getPointInShapeSpace(shape, pagePoint).toFixed().toJson()\n\t\t\t\t}\n\n\t\t\t\t// If the previous segment is a one point free shape and is the first segment of the line,\n\t\t\t\t// then the user just did a click-and-immediately-press-shift to create a new straight line\n\t\t\t\t// without continuing the previous line. In this case, we want to remove the previous segment.\n\n\t\t\t\tthis.currentLineLength += Vec.Dist(newSegment.points[0], newPoint)\n\n\t\t\t\tnewSegments[newSegments.length - 1] = {\n\t\t\t\t\t...newSegment,\n\t\t\t\t\ttype: 'straight',\n\t\t\t\t\tpoints: [newSegment.points[0], newPoint],\n\t\t\t\t}\n\n\t\t\t\tconst shapePartial: TLShapePartial<DrawableShape> = {\n\t\t\t\t\tid,\n\t\t\t\t\ttype: this.shapeType,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tsegments: newSegments,\n\t\t\t\t\t},\n\t\t\t\t}\n\n\t\t\t\tif (this.canClose()) {\n\t\t\t\t\t;(shapePartial as TLShapePartial<TLDrawShape>).props!.isClosed = this.getIsClosed(\n\t\t\t\t\t\tsegments,\n\t\t\t\t\t\tsize\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tthis.editor.updateShapes([shapePartial], { squashing: true })\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'free': {\n\t\t\t\tconst newSegments = segments.slice()\n\t\t\t\tconst newSegment = newSegments[newSegments.length - 1]\n\t\t\t\tconst newPoints = [...newSegment.points]\n\n\t\t\t\tif (newPoints.length && this.mergeNextPoint) {\n\t\t\t\t\tconst { z } = newPoints[newPoints.length - 1]\n\t\t\t\t\tnewPoints[newPoints.length - 1] = {\n\t\t\t\t\t\tx: newPoint.x,\n\t\t\t\t\t\ty: newPoint.y,\n\t\t\t\t\t\tz: z ? Math.max(z, newPoint.z) : newPoint.z,\n\t\t\t\t\t}\n\t\t\t\t\t// Note: we could recompute the line length here, but it's not really necessary\n\t\t\t\t\t// this.currentLineLength = this.getLineLength(newSegments)\n\t\t\t\t} else {\n\t\t\t\t\tthis.currentLineLength += Vec.Dist(newPoints[newPoints.length - 1], newPoint)\n\t\t\t\t\tnewPoints.push(newPoint)\n\t\t\t\t}\n\n\t\t\t\tnewSegments[newSegments.length - 1] = {\n\t\t\t\t\t...newSegment,\n\t\t\t\t\tpoints: newPoints,\n\t\t\t\t}\n\n\t\t\t\tif (this.currentLineLength < STROKE_SIZES[shape.props.size] * 4) {\n\t\t\t\t\tthis.currentLineLength = this.getLineLength(newSegments)\n\t\t\t\t}\n\n\t\t\t\tconst shapePartial: TLShapePartial<DrawableShape> = {\n\t\t\t\t\tid,\n\t\t\t\t\ttype: this.shapeType,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tsegments: newSegments,\n\t\t\t\t\t},\n\t\t\t\t}\n\n\t\t\t\tif (this.canClose()) {\n\t\t\t\t\t;(shapePartial as TLShapePartial<TLDrawShape>).props!.isClosed = this.getIsClosed(\n\t\t\t\t\t\tnewSegments,\n\t\t\t\t\t\tsize\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tthis.editor.updateShapes([shapePartial], { squashing: true })\n\n\t\t\t\t// Set a maximum length for the lines array; after 200 points, complete the line.\n\t\t\t\tif (newPoints.length > 500) {\n\t\t\t\t\tthis.editor.updateShapes([{ id, type: this.shapeType, props: { isComplete: true } }])\n\n\t\t\t\t\tconst newShapeId = createShapeId()\n\n\t\t\t\t\tthis.editor.createShapes<DrawableShape>([\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: newShapeId,\n\t\t\t\t\t\t\ttype: this.shapeType,\n\t\t\t\t\t\t\tx: toFixed(inputs.currentPagePoint.x),\n\t\t\t\t\t\t\ty: toFixed(inputs.currentPagePoint.y),\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tisPen: this.isPen,\n\t\t\t\t\t\t\t\tsegments: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttype: 'free',\n\t\t\t\t\t\t\t\t\t\tpoints: [{ x: 0, y: 0, z: this.isPen ? +(z! * 1.25).toFixed() : 0.5 }],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t])\n\n\t\t\t\t\tthis.initialShape = structuredClone(this.editor.getShape<DrawableShape>(newShapeId)!)\n\t\t\t\t\tthis.mergeNextPoint = false\n\t\t\t\t\tthis.lastRecordedPoint = inputs.currentPagePoint.clone()\n\t\t\t\t\tthis.currentLineLength = 0\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getLineLength(segments: TLDrawShapeSegment[]) {\n\t\tlet length = 0\n\n\t\tfor (const segment of segments) {\n\t\t\tfor (let i = 0; i < segment.points.length - 1; i++) {\n\t\t\t\tconst A = segment.points[i]\n\t\t\t\tconst B = segment.points[i + 1]\n\t\t\t\tlength += Vec.Dist2(B, A)\n\t\t\t}\n\t\t}\n\n\t\treturn Math.sqrt(length)\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onInterrupt: TLEventHandlers['onInterrupt'] = () => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.markId) {\n\t\t\tthis.editor.bailToMark(this.markId)\n\t\t}\n\t\tthis.cancel()\n\t}\n\n\tcomplete() {\n\t\t// If we weren't focused when the drawing shape started, and if\n\t\t// we haven't dragged far enough to start dragging, then don't do\n\t\t// anything here. Most likely we clicked back into the canvas from\n\t\t// a menu or other UI element.\n\t\tif (!this.canDraw) {\n\t\t\tthis.cancel()\n\t\t\treturn\n\t\t}\n\n\t\tconst { initialShape } = this\n\t\tif (!initialShape) return\n\t\tthis.editor.updateShapes([\n\t\t\t{ id: initialShape.id, type: initialShape.type, props: { isComplete: true } },\n\t\t])\n\n\t\tthis.parent.transition('idle')\n\t}\n\n\tcancel() {\n\t\tthis.parent.transition('idle', this.info)\n\t}\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('drawing', info)\n\t}\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Drawing } from './toolStates/Drawing'\nimport { Idle } from './toolStates/Idle'\n\n/** @public */\nexport class DrawShapeTool extends StateNode {\n\tstatic override id = 'draw'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Drawing]\n\n\toverride shapeType = 'draw'\n\n\toverride onExit = () => {\n\t\tconst drawingState = this.children!['drawing'] as Drawing\n\t\tdrawingState.initialShape = undefined\n\t}\n}\n", "import { BaseBoxShapeTool, TLShape, TLShapeId } from '@tldraw/editor'\n\n/** @public */\nexport class FrameShapeTool extends BaseBoxShapeTool {\n\tstatic override id = 'frame'\n\tstatic override initial = 'idle'\n\toverride shapeType = 'frame'\n\n\toverride onCreate = (shape: TLShape | null): void => {\n\t\tif (!shape) return\n\n\t\tconst bounds = this.editor.getShapePageBounds(shape)!\n\t\tconst shapesToAddToFrame: TLShapeId[] = []\n\t\tconst ancestorIds = this.editor.getShapeAncestors(shape).map((shape) => shape.id)\n\n\t\tthis.editor.getSortedChildIdsForParent(shape.parentId).map((siblingShapeId) => {\n\t\t\tconst siblingShape = this.editor.getShape(siblingShapeId)\n\t\t\tif (!siblingShape) return\n\t\t\t// We don't want to frame the frame itself\n\t\t\tif (siblingShape.id === shape.id) return\n\t\t\tif (siblingShape.isLocked) return\n\n\t\t\tconst pageShapeBounds = this.editor.getShapePageBounds(siblingShape)\n\t\t\tif (!pageShapeBounds) return\n\n\t\t\t// Frame shape encloses page shape\n\t\t\tif (bounds.contains(pageShapeBounds)) {\n\t\t\t\tif (canEnclose(siblingShape, ancestorIds, shape)) {\n\t\t\t\t\tshapesToAddToFrame.push(siblingShape.id)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tthis.editor.reparentShapes(shapesToAddToFrame, shape.id)\n\n\t\tif (this.editor.getInstanceState().isToolLocked) {\n\t\t\tthis.editor.setCurrentTool('frame')\n\t\t} else {\n\t\t\tthis.editor.setCurrentTool('select.idle')\n\t\t}\n\t}\n}\n\n/** @internal */\nfunction canEnclose(shape: TLShape, ancestorIds: TLShapeId[], frame: TLShape): boolean {\n\t// We don't want to pull in shapes that are ancestors of the frame (can create a cycle)\n\tif (ancestorIds.includes(shape.id)) {\n\t\treturn false\n\t}\n\t// We only want to pull in shapes that are siblings of the frame\n\tif (shape.parentId === frame.parentId) {\n\t\treturn true\n\t}\n\treturn false\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('pointing', info)\n\t}\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n\n\toverride onKeyUp: TLEventHandlers['onKeyUp'] = (info) => {\n\t\tif (info.key === 'Enter') {\n\t\t\tif (this.editor.getInstanceState().isReadonly) return null\n\n\t\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\t\t\t// If the only selected shape is editable, start editing it\n\t\t\tif (\n\t\t\t\tonlySelectedShape &&\n\t\t\t\tthis.editor.getShapeUtil(onlySelectedShape).canEdit(onlySelectedShape)\n\t\t\t) {\n\t\t\t\tthis.editor.setCurrentTool('select')\n\t\t\t\tthis.editor.setEditingShape(onlySelectedShape.id)\n\t\t\t\tthis.editor.root.getCurrent()?.transition('editing_shape', {\n\t\t\t\t\t...info,\n\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\tshape: onlySelectedShape,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n}\n", "import {\n\tBox,\n\tGeoShapeGeoStyle,\n\tStateNode,\n\tTLEventHandlers,\n\tTLGeoShape,\n\tcreateShapeId,\n} from '@tldraw/editor'\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\tmarkId = ''\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tconst { originPagePoint } = this.editor.inputs\n\n\t\t\tconst id = createShapeId()\n\n\t\t\tthis.markId = `creating:${id}`\n\n\t\t\tthis.editor.mark(this.markId)\n\n\t\t\tthis.editor\n\t\t\t\t.createShapes<TLGeoShape>([\n\t\t\t\t\t{\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\tx: originPagePoint.x,\n\t\t\t\t\t\ty: originPagePoint.y,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tw: 1,\n\t\t\t\t\t\t\th: 1,\n\t\t\t\t\t\t\tgeo: this.editor.getStyleForNextShape(GeoShapeGeoStyle),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t\t.select(id)\n\t\t\t\t.setCurrentTool('select.resizing', {\n\t\t\t\t\t...info,\n\t\t\t\t\ttarget: 'selection',\n\t\t\t\t\thandle: 'bottom_right',\n\t\t\t\t\tisCreating: true,\n\t\t\t\t\tcreationCursorOffset: { x: 1, y: 1 },\n\t\t\t\t\tonInteractionEnd: 'geo',\n\t\t\t\t})\n\t\t}\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onInterrupt: TLEventHandlers['onInterrupt'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate complete() {\n\t\tconst { originPagePoint } = this.editor.inputs\n\n\t\tconst id = createShapeId()\n\n\t\tthis.markId = `creating:${id}`\n\n\t\tthis.editor.mark(this.markId)\n\n\t\tthis.editor.createShapes<TLGeoShape>([\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\ttype: 'geo',\n\t\t\t\tx: originPagePoint.x,\n\t\t\t\ty: originPagePoint.y,\n\t\t\t\tprops: {\n\t\t\t\t\tgeo: this.editor.getStyleForNextShape(GeoShapeGeoStyle),\n\t\t\t\t\tw: 1,\n\t\t\t\t\th: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\n\t\tconst shape = this.editor.getShape<TLGeoShape>(id)!\n\t\tif (!shape) return\n\n\t\tconst bounds =\n\t\t\tshape.props.geo === 'star'\n\t\t\t\t? new Box(0, 0, 200, 190)\n\t\t\t\t: shape.props.geo === 'cloud'\n\t\t\t\t\t? new Box(0, 0, 300, 180)\n\t\t\t\t\t: new Box(0, 0, 200, 200)\n\n\t\tconst delta = bounds.center\n\t\tconst parentTransform = this.editor.getShapeParentTransform(shape)\n\t\tif (parentTransform) delta.rot(-parentTransform.rotation())\n\n\t\tthis.editor.select(id)\n\t\tthis.editor.updateShapes<TLGeoShape>([\n\t\t\t{\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: 'geo',\n\t\t\t\tx: shape.x - delta.x,\n\t\t\t\ty: shape.y - delta.y,\n\t\t\t\tprops: {\n\t\t\t\t\tgeo: this.editor.getStyleForNextShape(GeoShapeGeoStyle),\n\t\t\t\t\tw: bounds.width,\n\t\t\t\t\th: bounds.height,\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\n\t\tif (this.editor.getInstanceState().isToolLocked) {\n\t\t\tthis.parent.transition('idle')\n\t\t} else {\n\t\t\tthis.editor.setCurrentTool('select', {})\n\t\t}\n\t}\n\n\tprivate cancel() {\n\t\t// we should not have created any shapes yet, so no need to bail\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Idle } from './toolStates/Idle'\nimport { Pointing } from './toolStates/Pointing'\n\n/** @public */\nexport class GeoShapeTool extends StateNode {\n\tstatic override id = 'geo'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Pointing]\n\toverride shapeType = 'geo'\n}\n", "// shared custody\nimport { StateNode } from '@tldraw/editor'\nimport { Drawing } from '../draw/toolStates/Drawing'\nimport { Idle } from '../draw/toolStates/Idle'\n\n/** @public */\nexport class HighlightShapeTool extends StateNode {\n\tstatic override id = 'highlight'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Drawing]\n\toverride shapeType = 'highlight'\n\n\toverride onExit = () => {\n\t\tconst drawingState = this.children!['drawing'] as Drawing\n\t\tdrawingState.initialShape = undefined\n\t}\n}\n", "import { StateNode, TLEventHandlers, TLShapeId } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\tprivate shapeId = '' as TLShapeId\n\n\toverride onEnter = (info: { shapeId: TLShapeId }) => {\n\t\tthis.shapeId = info.shapeId\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = () => {\n\t\tthis.parent.transition('pointing', { shapeId: this.shapeId })\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n}\n", "import {\n\tMat,\n\tStateNode,\n\tTLEventHandlers,\n\tTLInterruptEvent,\n\tTLLineShape,\n\tTLShapeId,\n\tVec,\n\tcreateShapeId,\n\tgetIndexAbove,\n\tlast,\n\tsortByIndex,\n\tstructuredClone,\n} from '@tldraw/editor'\n\nconst MINIMUM_DISTANCE_BETWEEN_SHIFT_CLICKED_HANDLES = 2\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\tshape = {} as TLLineShape\n\n\tmarkId: string | undefined\n\n\toverride onEnter = (info: { shapeId?: TLShapeId }) => {\n\t\tconst { inputs } = this.editor\n\t\tconst { currentPagePoint } = inputs\n\n\t\tthis.markId = undefined\n\n\t\t// Previously created line shape that we might be extending\n\t\tconst shape = info.shapeId && this.editor.getShape<TLLineShape>(info.shapeId)\n\n\t\tif (shape && inputs.shiftKey) {\n\t\t\t// Extending a previous shape\n\t\t\tthis.markId = `creating:${shape.id}`\n\t\t\tthis.editor.mark(this.markId)\n\t\t\tthis.shape = shape\n\n\t\t\tconst handles = this.editor.getShapeHandles(this.shape)\n\t\t\tif (!handles) return\n\n\t\t\tconst vertexHandles = handles.filter((h) => h.type === 'vertex').sort(sortByIndex)\n\t\t\tconst endHandle = vertexHandles[vertexHandles.length - 1]\n\t\t\tconst prevEndHandle = vertexHandles[vertexHandles.length - 2]\n\n\t\t\tconst shapePagePoint = Mat.applyToPoint(\n\t\t\t\tthis.editor.getShapeParentTransform(this.shape)!,\n\t\t\t\tnew Vec(this.shape.x, this.shape.y)\n\t\t\t)\n\n\t\t\tconst nextPoint = Vec.Sub(currentPagePoint, shapePagePoint).addXY(0.1, 0.1)\n\t\t\tconst points = structuredClone(this.shape.props.points)\n\n\t\t\tif (\n\t\t\t\tVec.DistMin(endHandle, prevEndHandle, MINIMUM_DISTANCE_BETWEEN_SHIFT_CLICKED_HANDLES) ||\n\t\t\t\tVec.DistMin(nextPoint, endHandle, MINIMUM_DISTANCE_BETWEEN_SHIFT_CLICKED_HANDLES)\n\t\t\t) {\n\t\t\t\t// Don't add a new point if the distance between the last two points is too small\n\t\t\t\tpoints[endHandle.id] = {\n\t\t\t\t\tid: endHandle.id,\n\t\t\t\t\tindex: endHandle.index,\n\t\t\t\t\tx: nextPoint.x,\n\t\t\t\t\ty: nextPoint.y,\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Add a new point\n\t\t\t\tconst nextIndex = getIndexAbove(endHandle.index)\n\t\t\t\tpoints[nextIndex] = {\n\t\t\t\t\tid: nextIndex,\n\t\t\t\t\tindex: nextIndex,\n\t\t\t\t\tx: nextPoint.x,\n\t\t\t\t\ty: nextPoint.y,\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.editor.updateShapes([\n\t\t\t\t{\n\t\t\t\t\tid: this.shape.id,\n\t\t\t\t\ttype: this.shape.type,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tpoints,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\t\t} else {\n\t\t\tconst id = createShapeId()\n\n\t\t\tthis.markId = `creating:${id}`\n\t\t\tthis.editor.mark(this.markId)\n\n\t\t\tthis.editor.createShapes<TLLineShape>([\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\ttype: 'line',\n\t\t\t\t\tx: currentPagePoint.x,\n\t\t\t\t\ty: currentPagePoint.y,\n\t\t\t\t},\n\t\t\t])\n\n\t\t\tthis.editor.select(id)\n\t\t\tthis.shape = this.editor.getShape(id)!\n\t\t}\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tif (!this.shape) return\n\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tconst handles = this.editor.getShapeHandles(this.shape)\n\t\t\tif (!handles) {\n\t\t\t\tif (this.markId) this.editor.bailToMark(this.markId)\n\t\t\t\tthrow Error('No handles found')\n\t\t\t}\n\t\t\tconst lastHandle = last(handles)!\n\t\t\tthis.editor.setCurrentTool('select.dragging_handle', {\n\t\t\t\tshape: this.shape,\n\t\t\t\tisCreating: true,\n\t\t\t\t// remove the offset that we added to the handle when we created it\n\t\t\t\thandle: { ...lastHandle, x: lastHandle.x - 0.1, y: lastHandle.y - 0.1 },\n\t\t\t\tonInteractionEnd: 'line',\n\t\t\t})\n\t\t}\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onInterrupt: TLInterruptEvent = () => {\n\t\tthis.parent.transition('idle')\n\t\tif (this.markId) this.editor.bailToMark(this.markId)\n\t\tthis.editor.snaps.clearIndicators()\n\t}\n\n\tcomplete() {\n\t\tthis.parent.transition('idle', { shapeId: this.shape.id })\n\t\tthis.editor.snaps.clearIndicators()\n\t}\n\n\tcancel() {\n\t\tif (this.markId) this.editor.bailToMark(this.markId)\n\t\tthis.parent.transition('idle', { shapeId: this.shape.id })\n\t\tthis.editor.snaps.clearIndicators()\n\t}\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Idle } from './toolStates/Idle'\nimport { Pointing } from './toolStates/Pointing'\n\n/** @public */\nexport class LineShapeTool extends StateNode {\n\tstatic override id = 'line'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Pointing]\n\n\toverride shapeType = 'line'\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('pointing', info)\n\t}\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n}\n", "import {\n\tANIMATION_MEDIUM_MS,\n\tEditor,\n\tGeometry2d,\n\tMat,\n\tTLShape,\n\tTLShapeId,\n\tVec,\n\tcompact,\n\tpointInPolygon,\n\tpolygonIntersectsPolyline,\n\tpolygonsIntersect,\n} from '@tldraw/editor'\n\n/** @internal */\nexport function kickoutOccludedShapes(editor: Editor, shapeIds: TLShapeId[]) {\n\t// const shapes = shapeIds.map((id) => editor.getShape(id)).filter((s) => s) as TLShape[]\n\tconst parentsToCheck = new Set<TLShape>()\n\tfor (const id of shapeIds) {\n\t\t// If the shape exists and the shape has an onDragShapesOut\n\t\t// function, add it to the set\n\t\tconst shape = editor.getShape(id)\n\t\tif (!shape) continue\n\t\tif (editor.getShapeUtil(shape).onDragShapesOut) {\n\t\t\tparentsToCheck.add(shape)\n\t\t}\n\t\t// If the shape's parent is a shape and the shape's parent\n\t\t// has an onDragShapesOut function, add it to the set\n\t\tconst parent = editor.getShape(shape.parentId)\n\t\tif (!parent) continue\n\t\tif (editor.getShapeUtil(parent).onDragShapesOut) {\n\t\t\tparentsToCheck.add(parent)\n\t\t}\n\t}\n\n\tconst parentsWithKickedOutChildren = new Map<TLShape, TLShapeId[]>()\n\n\tfor (const parent of parentsToCheck) {\n\t\tconst occludedChildren = getOccludedChildren(editor, parent)\n\t\tif (occludedChildren.length) {\n\t\t\tparentsWithKickedOutChildren.set(parent, occludedChildren)\n\t\t}\n\t}\n\n\t// now call onDragShapesOut for each parent\n\tfor (const [parent, kickedOutChildrenIds] of parentsWithKickedOutChildren) {\n\t\tconst shapeUtil = editor.getShapeUtil(parent)\n\t\tconst kickedOutChildren = compact(kickedOutChildrenIds.map((id) => editor.getShape(id)))\n\t\tshapeUtil.onDragShapesOut?.(parent, kickedOutChildren)\n\t}\n}\n\n/** @public */\nexport function getOccludedChildren(editor: Editor, parent: TLShape) {\n\tconst childIds = editor.getSortedChildIdsForParent(parent.id)\n\tif (childIds.length === 0) return []\n\tconst parentPageBounds = editor.getShapePageBounds(parent)\n\tif (!parentPageBounds) return []\n\n\tlet parentGeometry: Geometry2d | undefined\n\tlet parentPageTransform: Mat | undefined\n\tlet parentPageCorners: Vec[] | undefined\n\n\tconst results: TLShapeId[] = []\n\n\tfor (const childId of childIds) {\n\t\tconst shapePageBounds = editor.getShapePageBounds(childId)\n\t\tif (!shapePageBounds) {\n\t\t\t// Not occluded, shape doesn't exist\n\t\t\tcontinue\n\t\t}\n\n\t\tif (!parentPageBounds.includes(shapePageBounds)) {\n\t\t\t// Not in shape's bounds, shape is occluded\n\t\t\tresults.push(childId)\n\t\t\tcontinue\n\t\t}\n\n\t\t// There might be a lot of children; we don't want to do this for all of them,\n\t\t// but we also don't want to do it at all if we don't have to. ??= to the rescue!\n\n\t\tparentGeometry ??= editor.getShapeGeometry(parent)\n\t\tparentPageTransform ??= editor.getShapePageTransform(parent)\n\t\tparentPageCorners ??= parentPageTransform.applyToPoints(parentGeometry.vertices)\n\n\t\tconst parentCornersInShapeSpace = editor\n\t\t\t.getShapePageTransform(childId)\n\t\t\t.clone()\n\t\t\t.invert()\n\t\t\t.applyToPoints(parentPageCorners)\n\n\t\t// If any of the shape's vertices are inside the occluder, it's not occluded\n\t\tconst { vertices, isClosed } = editor.getShapeGeometry(childId)\n\n\t\tif (vertices.some((v) => pointInPolygon(v, parentCornersInShapeSpace))) {\n\t\t\t// not occluded, vertices are in the occluder's corners\n\t\t\tcontinue\n\t\t}\n\n\t\t// If any the shape's vertices intersect the edge of the occluder, it's not occluded\n\t\tif (isClosed) {\n\t\t\tif (polygonsIntersect(parentCornersInShapeSpace, vertices)) {\n\t\t\t\t// not occluded, vertices intersect parent's corners\n\t\t\t\tcontinue\n\t\t\t}\n\t\t} else if (polygonIntersectsPolyline(parentCornersInShapeSpace, vertices)) {\n\t\t\t// not occluded, vertices intersect parent's corners\n\t\t\tcontinue\n\t\t}\n\n\t\t// Passed all checks, shape is occluded\n\t\tresults.push(childId)\n\t}\n\n\treturn results\n}\n\n/** @internal */\nexport function startEditingShapeWithLabel(editor: Editor, shape: TLShape, selectAll = false) {\n\t// Finish this shape and start editing the next one\n\teditor.select(shape)\n\teditor.setEditingShape(shape)\n\teditor.setCurrentTool('select.editing_shape', {\n\t\ttarget: 'shape',\n\t\tshape: shape,\n\t})\n\tif (selectAll) {\n\t\teditor.emit('select-all-text', { shapeId: shape.id })\n\t}\n\tzoomToShapeIfOffscreen(editor)\n}\n\nconst ZOOM_TO_SHAPE_PADDING = 16\nexport function zoomToShapeIfOffscreen(editor: Editor) {\n\tconst selectionPageBounds = editor.getSelectionPageBounds()\n\tconst viewportPageBounds = editor.getViewportPageBounds()\n\tif (selectionPageBounds && !viewportPageBounds.contains(selectionPageBounds)) {\n\t\tconst eb = selectionPageBounds\n\t\t\t.clone()\n\t\t\t// Expand the bounds by the padding\n\t\t\t.expandBy(ZOOM_TO_SHAPE_PADDING / editor.getZoomLevel())\n\t\t\t// then expand the bounds to include the viewport bounds\n\t\t\t.expand(viewportPageBounds)\n\n\t\t// then use the difference between the centers to calculate the offset\n\t\tconst nextBounds = viewportPageBounds.clone().translate({\n\t\t\tx: (eb.center.x - viewportPageBounds.center.x) * 2,\n\t\t\ty: (eb.center.y - viewportPageBounds.center.y) * 2,\n\t\t})\n\t\teditor.zoomToBounds(nextBounds, {\n\t\t\tduration: ANIMATION_MEDIUM_MS,\n\t\t\tinset: 0,\n\t\t})\n\t}\n}\n", "import { Editor, IndexKey, TLNoteShape, TLShape, Vec, compact, createShapeId } from '@tldraw/editor'\nimport { zoomToShapeIfOffscreen } from '../../tools/SelectTool/selectHelpers'\n\n/** @internal */\nexport const ADJACENT_NOTE_MARGIN = 20\n/** @internal */\nexport const CLONE_HANDLE_MARGIN = 0\n/** @internal */\nexport const NOTE_SIZE = 200\n/** @internal */\nexport const NOTE_CENTER_OFFSET = { x: NOTE_SIZE / 2, y: NOTE_SIZE / 2 }\n/** @internal */\nexport const NOTE_PIT_RADIUS = 10\n\nconst DEFAULT_PITS = {\n\t['a1' as IndexKey]: new Vec(NOTE_SIZE * 0.5, NOTE_SIZE * -0.5 - ADJACENT_NOTE_MARGIN), // t\n\t['a2' as IndexKey]: new Vec(NOTE_SIZE * 1.5 + ADJACENT_NOTE_MARGIN, NOTE_SIZE * 0.5), // r\n\t['a3' as IndexKey]: new Vec(NOTE_SIZE * 0.5, NOTE_SIZE * 1.5 + ADJACENT_NOTE_MARGIN), // b\n\t['a4' as IndexKey]: new Vec(NOTE_SIZE * -0.5 - ADJACENT_NOTE_MARGIN, NOTE_SIZE * 0.5), // l\n}\n\n/**\n * Get the adjacent positions for a particular note shape.\n *\n * @param pagePoint - The point of the note shape on the page.\n * @param pageRotation - The rotation of the note shape on the page.\n * @param growY - The growY of the note shape.\n * @param extraHeight - The extra height to add to the top position above the note shape (ie the growY of the dragging shape).\n *\n * @internal */\nexport function getNoteAdjacentPositions(\n\tpagePoint: Vec,\n\tpageRotation: number,\n\tgrowY: number,\n\textraHeight: number\n): Record<IndexKey, Vec> {\n\treturn Object.fromEntries(\n\t\tObject.entries(DEFAULT_PITS).map(([id, v], i) => {\n\t\t\tconst point = v.clone()\n\t\t\tif (i === 0 && extraHeight) {\n\t\t\t\t// apply top margin (the growY of the moving note shape)\n\t\t\t\tpoint.y -= extraHeight\n\t\t\t} else if (i === 2 && growY) {\n\t\t\t\t// apply bottom margin (the growY of this note shape)\n\t\t\t\tpoint.y += growY\n\t\t\t}\n\t\t\treturn [id, point.rot(pageRotation).add(pagePoint)]\n\t\t})\n\t)\n}\n\n/**\n * Get all of the available note adjacent positions, excluding the selected shapes.\n *\n * @param editor - The editor instance.\n * @param rotation - The rotation of the note shape.\n * @param extraHeight - The extra height to add to the top position above the note shape (ie the growY of the dragging shape).\n *\n * @internal */\nexport function getAvailableNoteAdjacentPositions(\n\teditor: Editor,\n\trotation: number,\n\textraHeight: number\n) {\n\tconst selectedShapeIds = new Set(editor.getSelectedShapeIds())\n\tconst minSize = (NOTE_SIZE + ADJACENT_NOTE_MARGIN + extraHeight) ** 2\n\tconst allCenters = new Map<TLNoteShape, Vec>()\n\tconst positions: (Vec | undefined)[] = []\n\n\t// Get all the positions that are adjacent to the selected note shapes\n\tfor (const shape of editor.getCurrentPageShapes()) {\n\t\tif (!editor.isShapeOfType<TLNoteShape>(shape, 'note') || selectedShapeIds.has(shape.id)) {\n\t\t\tcontinue\n\t\t}\n\n\t\tconst transform = editor.getShapePageTransform(shape.id)!\n\n\t\t// If the note has a different rotation, we can't use its adjacent positions\n\t\tif (rotation !== transform.rotation()) continue\n\n\t\t// Save the unselected note shape's center\n\t\tallCenters.set(shape, editor.getShapePageBounds(shape)!.center)\n\n\t\t// And push its position to the positions array\n\t\tpositions.push(\n\t\t\t...Object.values(\n\t\t\t\tgetNoteAdjacentPositions(transform.point(), rotation, shape.props.growY, extraHeight)\n\t\t\t)\n\t\t)\n\t}\n\n\t// Remove positions that are inside of another note shape\n\tconst len = positions.length\n\tlet position: Vec | undefined\n\tfor (const [shape, center] of allCenters) {\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tposition = positions[i]\n\t\t\tif (!position) continue\n\t\t\tif (Vec.Dist2(center, position) > minSize) continue\n\t\t\tif (editor.isPointInShape(shape, position)) {\n\t\t\t\tpositions[i] = undefined\n\t\t\t}\n\t\t}\n\t}\n\n\treturn compact(positions)\n}\n\n/**\n * For a particular adjacent note position, get the shape in that position or create a new one.\n *\n * @param editor - The editor instance.\n * @param shape - The note shape to create or select.\n * @param center - The center of the note shape.\n * @param pageRotation - The rotation of the note shape on the page.\n * @param forceNew - Whether to force the creation of a new note shape.\n *\n * @internal */\nexport function getNoteShapeForAdjacentPosition(\n\teditor: Editor,\n\tshape: TLNoteShape,\n\tcenter: Vec,\n\tpageRotation: number,\n\tforceNew = false\n) {\n\t// There might already be a note in that position! If there is, we'll\n\t// select the next note and switch focus to it. If there's not, then\n\t// we'll create a new note in that position.\n\n\tlet nextNote: TLShape | undefined\n\n\t// Check the center of where a new note would be\n\t// Start from the top of the stack, and work our way down\n\tconst allShapesOnPage = editor.getCurrentPageShapesSorted()\n\n\tconst minDistance = NOTE_SIZE + ADJACENT_NOTE_MARGIN ** 2\n\n\tfor (let i = allShapesOnPage.length - 1; i >= 0; i--) {\n\t\tconst otherNote = allShapesOnPage[i]\n\t\tif (otherNote.type === 'note' && otherNote.id !== shape.id) {\n\t\t\tconst otherBounds = editor.getShapePageBounds(otherNote)\n\t\t\tif (\n\t\t\t\totherBounds &&\n\t\t\t\tVec.Dist2(otherBounds.center, center) < minDistance &&\n\t\t\t\teditor.isPointInShape(otherNote, center)\n\t\t\t) {\n\t\t\t\tnextNote = otherNote\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\teditor.complete()\n\n\t// If we didn't find any in that position, then create a new one\n\tif (!nextNote || forceNew) {\n\t\teditor.mark('creating note shape')\n\t\tconst id = createShapeId()\n\n\t\t// We create it at the center first, so that it becomes\n\t\t//  the child of whatever parent was at that center\n\t\teditor.createShape({\n\t\t\tid,\n\t\t\ttype: 'note',\n\t\t\tx: center.x,\n\t\t\ty: center.y,\n\t\t\trotation: pageRotation,\n\t\t\topacity: shape.opacity,\n\t\t\tprops: {\n\t\t\t\t// Use the props of the shape we're cloning\n\t\t\t\t...shape.props,\n\t\t\t\t// ...except for these values, which should reset to their defaults\n\t\t\t\ttext: '',\n\t\t\t\tgrowY: 0,\n\t\t\t\tfontSizeAdjustment: 0,\n\t\t\t\turl: '',\n\t\t\t},\n\t\t})\n\n\t\t// Now we need to correct its location within its new parent\n\n\t\tconst createdShape = editor.getShape(id)!\n\n\t\t// We need to put the page point in the same coordinate\n\t\t// space as the newly created shape (i.e its parent's space)\n\t\tconst topLeft = editor.getPointInParentSpace(\n\t\t\tcreatedShape,\n\t\t\tVec.Sub(center, Vec.Rot(NOTE_CENTER_OFFSET, pageRotation))\n\t\t)\n\n\t\teditor.updateShape({\n\t\t\tid,\n\t\t\ttype: 'note',\n\t\t\tx: topLeft.x,\n\t\t\ty: topLeft.y,\n\t\t})\n\n\t\tnextNote = editor.getShape(id)!\n\t}\n\n\tzoomToShapeIfOffscreen(editor)\n\treturn nextNote\n}\n", "import {\n\tEditor,\n\tStateNode,\n\tTLEventHandlers,\n\tTLInterruptEvent,\n\tTLNoteShape,\n\tTLPointerEventInfo,\n\tTLShapeId,\n\tVec,\n\tcreateShapeId,\n} from '@tldraw/editor'\nimport { NOTE_PIT_RADIUS, getAvailableNoteAdjacentPositions } from '../noteHelpers'\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\tdragged = false\n\n\tinfo = {} as TLPointerEventInfo\n\n\twasFocusedOnEnter = false\n\n\tmarkId = ''\n\n\tshape = {} as TLNoteShape\n\n\toverride onEnter = () => {\n\t\tconst { editor } = this\n\n\t\tthis.wasFocusedOnEnter = !editor.getIsMenuOpen()\n\n\t\tif (this.wasFocusedOnEnter) {\n\t\t\tconst id = createShapeId()\n\t\t\tthis.markId = `creating:${id}`\n\t\t\teditor.mark(this.markId)\n\n\t\t\t// Check for note pits; if the pointer is close to one, place the note centered on the pit\n\t\t\tconst center = this.editor.inputs.originPagePoint.clone()\n\t\t\tconst offset = getNotePitOffset(this.editor, center)\n\t\t\tif (offset) {\n\t\t\t\tcenter.sub(offset)\n\t\t\t}\n\t\t\tthis.shape = createSticky(this.editor, id, center)\n\t\t}\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tif (!this.wasFocusedOnEnter) {\n\t\t\t\tconst id = createShapeId()\n\t\t\t\tconst center = this.editor.inputs.originPagePoint.clone()\n\t\t\t\tconst offset = getNotePitOffset(this.editor, center)\n\t\t\t\tif (offset) {\n\t\t\t\t\tcenter.sub(offset)\n\t\t\t\t}\n\t\t\t\tthis.shape = createSticky(this.editor, id, center)\n\t\t\t}\n\n\t\t\tthis.editor.setCurrentTool('select.translating', {\n\t\t\t\t...info,\n\t\t\t\ttarget: 'shape',\n\t\t\t\tshape: this.shape,\n\t\t\t\tonInteractionEnd: 'note',\n\t\t\t\tisCreating: true,\n\t\t\t\tonCreate: () => {\n\t\t\t\t\tthis.editor.setEditingShape(this.shape.id)\n\t\t\t\t\tthis.editor.setCurrentTool('select.editing_shape')\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onInterrupt: TLInterruptEvent = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate complete() {\n\t\tif (this.wasFocusedOnEnter) {\n\t\t\tif (this.editor.getInstanceState().isToolLocked) {\n\t\t\t\tthis.parent.transition('idle')\n\t\t\t} else {\n\t\t\t\tthis.editor.setEditingShape(this.shape.id)\n\t\t\t\tthis.editor.setCurrentTool('select.editing_shape', {\n\t\t\t\t\t...this.info,\n\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\tshape: this.shape,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate cancel() {\n\t\tthis.editor.bailToMark(this.markId)\n\t\tthis.parent.transition('idle', this.info)\n\t}\n}\n\nexport function getNotePitOffset(editor: Editor, center: Vec) {\n\tlet min = NOTE_PIT_RADIUS / editor.getZoomLevel() // in screen space\n\tlet offset: Vec | undefined\n\tfor (const pit of getAvailableNoteAdjacentPositions(editor, 0, 0)) {\n\t\t// only check page rotations of zero\n\t\tconst deltaToPit = Vec.Sub(center, pit)\n\t\tconst dist = deltaToPit.len()\n\t\tif (dist < min) {\n\t\t\tmin = dist\n\t\t\toffset = deltaToPit\n\t\t}\n\t}\n\treturn offset\n}\n\nexport function createSticky(editor: Editor, id: TLShapeId, center: Vec) {\n\teditor\n\t\t.createShape({\n\t\t\tid,\n\t\t\ttype: 'note',\n\t\t\tx: center.x,\n\t\t\ty: center.y,\n\t\t})\n\t\t.select(id)\n\n\tconst shape = editor.getShape<TLNoteShape>(id)!\n\tconst bounds = editor.getShapeGeometry(shape).bounds\n\n\t// Center the text around the created point\n\teditor.updateShapes([\n\t\t{\n\t\t\tid,\n\t\t\ttype: 'note',\n\t\t\tx: shape.x - bounds.width / 2,\n\t\t\ty: shape.y - bounds.height / 2,\n\t\t},\n\t])\n\n\treturn editor.getShape<TLNoteShape>(id)!\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Idle } from './toolStates/Idle'\nimport { Pointing } from './toolStates/Pointing'\n\n/** @public */\nexport class NoteShapeTool extends StateNode {\n\tstatic override id = 'note'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Pointing]\n\toverride shapeType = 'note'\n}\n", "import { Editor, HIT_TEST_MARGIN, TLShape, throttle } from '@tldraw/editor'\n\nfunction _updateHoveredId(editor: Editor) {\n\t// todo: consider replacing `get hoveredShapeId` with this; it would mean keeping hoveredShapeId in memory rather than in the store and possibly re-computing it more often than necessary\n\tconst hitShape = editor.getShapeAtPoint(editor.inputs.currentPagePoint, {\n\t\thitInside: false,\n\t\thitLabels: false,\n\t\tmargin: HIT_TEST_MARGIN / editor.getZoomLevel(),\n\t\trenderingOnly: true,\n\t})\n\n\tif (!hitShape) return editor.setHoveredShape(null)\n\n\tlet shapeToHover: TLShape | undefined = undefined\n\n\tconst outermostShape = editor.getOutermostSelectableShape(hitShape)\n\n\tif (outermostShape === hitShape) {\n\t\tshapeToHover = hitShape\n\t} else {\n\t\tif (\n\t\t\toutermostShape.id === editor.getFocusedGroupId() ||\n\t\t\teditor.getSelectedShapeIds().includes(outermostShape.id)\n\t\t) {\n\t\t\tshapeToHover = hitShape\n\t\t} else {\n\t\t\tshapeToHover = outermostShape\n\t\t}\n\t}\n\n\treturn editor.setHoveredShape(shapeToHover.id)\n}\n\nexport const updateHoveredId =\n\tprocess.env.NODE_ENV === 'test' ? _updateHoveredId : throttle(_updateHoveredId, 32)\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\nimport { updateHoveredId } from '../../../tools/selection-logic/updateHoveredId'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tswitch (info.target) {\n\t\t\tcase 'shape':\n\t\t\tcase 'canvas': {\n\t\t\t\tupdateHoveredId(this.editor)\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('pointing', info)\n\t}\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n\n\toverride onKeyDown: TLEventHandlers['onKeyDown'] = (info) => {\n\t\tif (info.key === 'Enter') {\n\t\t\tif (this.editor.getInstanceState().isReadonly) return null\n\t\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\t\t\t// If the only selected shape is editable, start editing it\n\t\t\tif (\n\t\t\t\tonlySelectedShape &&\n\t\t\t\tthis.editor.getShapeUtil(onlySelectedShape).canEdit(onlySelectedShape)\n\t\t\t) {\n\t\t\t\tthis.editor.setCurrentTool('select')\n\t\t\t\tthis.editor.setEditingShape(onlySelectedShape.id)\n\t\t\t\tthis.editor.root.getCurrent()?.transition('editing_shape', {\n\t\t\t\t\t...info,\n\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\tshape: onlySelectedShape,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n}\n", "import { StateNode, TLEventHandlers, TLTextShape, createShapeId } from '@tldraw/editor'\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\tshape?: TLTextShape\n\n\tmarkId = ''\n\n\toverride onExit = () => {\n\t\tthis.editor.setHintingShapes([])\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tconst {\n\t\t\t\tinputs: { originPagePoint },\n\t\t\t} = this.editor\n\n\t\t\tconst id = createShapeId()\n\n\t\t\tthis.markId = `creating:${id}`\n\t\t\tthis.editor.mark(this.markId)\n\n\t\t\tthis.editor.createShapes<TLTextShape>([\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\tx: originPagePoint.x,\n\t\t\t\t\ty: originPagePoint.y,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\tautoSize: false,\n\t\t\t\t\t\tw: 20,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\n\t\t\tthis.editor.select(id)\n\n\t\t\tthis.shape = this.editor.getShape(id)\n\t\t\tif (!this.shape) return\n\n\t\t\tconst { shape } = this\n\n\t\t\tthis.editor.setCurrentTool('select.resizing', {\n\t\t\t\t...info,\n\t\t\t\ttarget: 'selection',\n\t\t\t\thandle: 'right',\n\t\t\t\tisCreating: true,\n\t\t\t\tcreationCursorOffset: { x: 1, y: 1 },\n\t\t\t\tonInteractionEnd: 'text',\n\t\t\t\tonCreate: () => {\n\t\t\t\t\tthis.editor.setEditingShape(shape.id)\n\t\t\t\t\tthis.editor.setCurrentTool('select.editing_shape')\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t}\n\n\toverride onPointerUp = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate complete() {\n\t\tthis.editor.mark('creating text shape')\n\t\tconst id = createShapeId()\n\t\tconst { x, y } = this.editor.inputs.currentPagePoint\n\t\tthis.editor\n\t\t\t.createShapes([\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\tautoSize: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\t\t\t.select(id)\n\n\t\tthis.editor.setEditingShape(id)\n\t\tthis.editor.setCurrentTool('select')\n\t\tthis.editor.root.getCurrent()?.transition('editing_shape')\n\t}\n\n\tprivate cancel() {\n\t\tthis.parent.transition('idle')\n\t\tthis.editor.bailToMark(this.markId)\n\t}\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Idle } from './toolStates/Idle'\nimport { Pointing } from './toolStates/Pointing'\n\n/** @public */\nexport class TextShapeTool extends StateNode {\n\tstatic override id = 'text'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Pointing]\n\toverride shapeType = 'text'\n}\n", "import { ArrowShapeTool } from './shapes/arrow/ArrowShapeTool'\nimport { DrawShapeTool } from './shapes/draw/DrawShapeTool'\nimport { FrameShapeTool } from './shapes/frame/FrameShapeTool'\nimport { GeoShapeTool } from './shapes/geo/GeoShapeTool'\nimport { HighlightShapeTool } from './shapes/highlight/HighlightShapeTool'\nimport { LineShapeTool } from './shapes/line/LineShapeTool'\nimport { NoteShapeTool } from './shapes/note/NoteShapeTool'\nimport { TextShapeTool } from './shapes/text/TextShapeTool'\n\n/** @public */\nexport const defaultShapeTools = [\n\tTextShapeTool,\n\tDrawShapeTool,\n\tGeoShapeTool,\n\tNoteShapeTool,\n\tLineShapeTool,\n\tFrameShapeTool,\n\tArrowShapeTool,\n\tHighlightShapeTool,\n]\n", "import {\n\tArc2d,\n\tBox,\n\tEdge2d,\n\tEditor,\n\tGeometry2d,\n\tGroup2d,\n\tRectangle2d,\n\tSVGContainer,\n\tShapeUtil,\n\tSvgExportContext,\n\tTLArrowShape,\n\tTLArrowShapeProps,\n\tTLHandle,\n\tTLOnEditEndHandler,\n\tTLOnHandleDragHandler,\n\tTLOnResizeHandler,\n\tTLOnTranslateHandler,\n\tTLOnTranslateStartHandler,\n\tTLShapePartial,\n\tTLShapeUtilCanvasSvgDef,\n\tTLShapeUtilFlag,\n\tVec,\n\tarrowShapeMigrations,\n\tarrowShapeProps,\n\tgetArrowTerminalsInArrowSpace,\n\tgetDefaultColorTheme,\n\tmapObjectMapValues,\n\tobjectMapEntries,\n\tstructuredClone,\n\ttoDomPrecision,\n\ttrack,\n\tuseEditor,\n\tuseIsEditing,\n} from '@tldraw/editor'\nimport React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../shared/ShapeFill'\nimport { SvgTextLabel } from '../shared/SvgTextLabel'\nimport { ARROW_LABEL_FONT_SIZES, STROKE_SIZES } from '../shared/default-shape-constants'\nimport {\n\tgetFillDefForCanvas,\n\tgetFillDefForExport,\n\tgetFontDefForExport,\n} from '../shared/defaultStyleDefs'\nimport { getPerfectDashProps } from '../shared/getPerfectDashProps'\nimport { getArrowLabelPosition } from './arrowLabel'\nimport { getArrowheadPathForType } from './arrowheads'\nimport {\n\tgetCurvedArrowHandlePath,\n\tgetSolidCurvedArrowPath,\n\tgetSolidStraightArrowPath,\n\tgetStraightArrowHandlePath,\n} from './arrowpaths'\nimport { ArrowTextLabel } from './components/ArrowTextLabel'\n\nlet globalRenderIndex = 0\n\nenum ARROW_HANDLES {\n\tSTART = 'start',\n\tMIDDLE = 'middle',\n\tEND = 'end',\n}\n\n/** @public */\nexport class ArrowShapeUtil extends ShapeUtil<TLArrowShape> {\n\tstatic override type = 'arrow' as const\n\tstatic override props = arrowShapeProps\n\tstatic override migrations = arrowShapeMigrations\n\n\toverride canEdit = () => true\n\toverride canBind = () => false\n\toverride canSnap = () => false\n\toverride hideResizeHandles: TLShapeUtilFlag<TLArrowShape> = () => true\n\toverride hideRotateHandle: TLShapeUtilFlag<TLArrowShape> = () => true\n\toverride hideSelectionBoundsBg: TLShapeUtilFlag<TLArrowShape> = () => true\n\toverride hideSelectionBoundsFg: TLShapeUtilFlag<TLArrowShape> = () => true\n\n\toverride getDefaultProps(): TLArrowShape['props'] {\n\t\treturn {\n\t\t\tdash: 'draw',\n\t\t\tsize: 'm',\n\t\t\tfill: 'none',\n\t\t\tcolor: 'black',\n\t\t\tlabelColor: 'black',\n\t\t\tbend: 0,\n\t\t\tstart: { type: 'point', x: 0, y: 0 },\n\t\t\tend: { type: 'point', x: 2, y: 0 },\n\t\t\tarrowheadStart: 'none',\n\t\t\tarrowheadEnd: 'arrow',\n\t\t\ttext: '',\n\t\t\tlabelPosition: 0.5,\n\t\t\tfont: 'draw',\n\t\t}\n\t}\n\n\tgetGeometry(shape: TLArrowShape) {\n\t\tconst info = this.editor.getArrowInfo(shape)!\n\n\t\tconst debugGeom: Geometry2d[] = []\n\n\t\tconst bodyGeom = info.isStraight\n\t\t\t? new Edge2d({\n\t\t\t\t\tstart: Vec.From(info.start.point),\n\t\t\t\t\tend: Vec.From(info.end.point),\n\t\t\t\t})\n\t\t\t: new Arc2d({\n\t\t\t\t\tcenter: Vec.Cast(info.handleArc.center),\n\t\t\t\t\tradius: info.handleArc.radius,\n\t\t\t\t\tstart: Vec.Cast(info.start.point),\n\t\t\t\t\tend: Vec.Cast(info.end.point),\n\t\t\t\t\tsweepFlag: info.bodyArc.sweepFlag,\n\t\t\t\t\tlargeArcFlag: info.bodyArc.largeArcFlag,\n\t\t\t\t})\n\n\t\tlet labelGeom\n\t\tif (shape.props.text.trim()) {\n\t\t\tconst labelPosition = getArrowLabelPosition(this.editor, shape)\n\t\t\tdebugGeom.push(...labelPosition.debugGeom)\n\t\t\tlabelGeom = new Rectangle2d({\n\t\t\t\tx: labelPosition.box.x,\n\t\t\t\ty: labelPosition.box.y,\n\t\t\t\twidth: labelPosition.box.w,\n\t\t\t\theight: labelPosition.box.h,\n\t\t\t\tisFilled: true,\n\t\t\t\tisLabel: true,\n\t\t\t})\n\t\t}\n\n\t\treturn new Group2d({\n\t\t\tchildren: [...(labelGeom ? [bodyGeom, labelGeom] : [bodyGeom]), ...debugGeom],\n\t\t})\n\t}\n\n\toverride getHandles(shape: TLArrowShape): TLHandle[] {\n\t\tconst info = this.editor.getArrowInfo(shape)!\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: ARROW_HANDLES.START,\n\t\t\t\ttype: 'vertex',\n\t\t\t\tindex: 'a0',\n\t\t\t\tx: info.start.handle.x,\n\t\t\t\ty: info.start.handle.y,\n\t\t\t\tcanBind: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: ARROW_HANDLES.MIDDLE,\n\t\t\t\ttype: 'virtual',\n\t\t\t\tindex: 'a2',\n\t\t\t\tx: info.middle.x,\n\t\t\t\ty: info.middle.y,\n\t\t\t\tcanBind: false,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: ARROW_HANDLES.END,\n\t\t\t\ttype: 'vertex',\n\t\t\t\tindex: 'a3',\n\t\t\t\tx: info.end.handle.x,\n\t\t\t\ty: info.end.handle.y,\n\t\t\t\tcanBind: true,\n\t\t\t},\n\t\t].filter(Boolean) as TLHandle[]\n\t}\n\n\toverride onHandleDrag: TLOnHandleDragHandler<TLArrowShape> = (shape, { handle, isPrecise }) => {\n\t\tconst handleId = handle.id as ARROW_HANDLES\n\n\t\tif (handleId === ARROW_HANDLES.MIDDLE) {\n\t\t\t// Bending the arrow...\n\t\t\tconst { start, end } = getArrowTerminalsInArrowSpace(this.editor, shape)\n\n\t\t\tconst delta = Vec.Sub(end, start)\n\t\t\tconst v = Vec.Per(delta)\n\n\t\t\tconst med = Vec.Med(end, start)\n\t\t\tconst A = Vec.Sub(med, v)\n\t\t\tconst B = Vec.Add(med, v)\n\n\t\t\tconst point = Vec.NearestPointOnLineSegment(A, B, handle, false)\n\t\t\tlet bend = Vec.Dist(point, med)\n\t\t\tif (Vec.Clockwise(point, end, med)) bend *= -1\n\t\t\treturn { id: shape.id, type: shape.type, props: { bend } }\n\t\t}\n\n\t\t// Start or end, pointing the arrow...\n\n\t\tconst next = structuredClone(shape) as TLArrowShape\n\n\t\tif (this.editor.inputs.ctrlKey) {\n\t\t\t// todo: maybe double check that this isn't equal to the other handle too?\n\t\t\t// Skip binding\n\t\t\tnext.props[handleId] = {\n\t\t\t\ttype: 'point',\n\t\t\t\tx: handle.x,\n\t\t\t\ty: handle.y,\n\t\t\t}\n\t\t\treturn next\n\t\t}\n\n\t\tconst point = this.editor.getShapePageTransform(shape.id)!.applyToPoint(handle)\n\n\t\tconst target = this.editor.getShapeAtPoint(point, {\n\t\t\thitInside: true,\n\t\t\thitFrameInside: true,\n\t\t\tmargin: 0,\n\t\t\tfilter: (targetShape) => {\n\t\t\t\treturn !targetShape.isLocked && this.editor.getShapeUtil(targetShape).canBind(targetShape)\n\t\t\t},\n\t\t})\n\n\t\tif (!target) {\n\t\t\t// todo: maybe double check that this isn't equal to the other handle too?\n\t\t\tnext.props[handleId] = {\n\t\t\t\ttype: 'point',\n\t\t\t\tx: handle.x,\n\t\t\t\ty: handle.y,\n\t\t\t}\n\t\t\treturn next\n\t\t}\n\n\t\t// we've got a target! the handle is being dragged over a shape, bind to it\n\n\t\tconst targetGeometry = this.editor.getShapeGeometry(target)\n\t\tconst targetBounds = Box.ZeroFix(targetGeometry.bounds)\n\t\tconst pageTransform = this.editor.getShapePageTransform(next.id)!\n\t\tconst pointInPageSpace = pageTransform.applyToPoint(handle)\n\t\tconst pointInTargetSpace = this.editor.getPointInShapeSpace(target, pointInPageSpace)\n\n\t\tlet precise = isPrecise\n\n\t\tif (!precise) {\n\t\t\t// If we're switching to a new bound shape, then precise only if moving slowly\n\t\t\tconst prevHandle = next.props[handleId]\n\t\t\tif (\n\t\t\t\tprevHandle.type === 'point' ||\n\t\t\t\t(prevHandle.type === 'binding' && target.id !== prevHandle.boundShapeId)\n\t\t\t) {\n\t\t\t\tprecise = this.editor.inputs.pointerVelocity.len() < 0.5\n\t\t\t}\n\t\t}\n\n\t\tif (!isPrecise) {\n\t\t\tif (!targetGeometry.isClosed) {\n\t\t\t\tprecise = true\n\t\t\t}\n\n\t\t\t// Double check that we're not going to be doing an imprecise snap on\n\t\t\t// the same shape twice, as this would result in a zero length line\n\t\t\tconst otherHandle =\n\t\t\t\tnext.props[handleId === ARROW_HANDLES.START ? ARROW_HANDLES.END : ARROW_HANDLES.START]\n\t\t\tif (\n\t\t\t\totherHandle.type === 'binding' &&\n\t\t\t\ttarget.id === otherHandle.boundShapeId &&\n\t\t\t\totherHandle.isPrecise\n\t\t\t) {\n\t\t\t\tprecise = true\n\t\t\t}\n\t\t}\n\n\t\tconst normalizedAnchor = {\n\t\t\tx: (pointInTargetSpace.x - targetBounds.minX) / targetBounds.width,\n\t\t\ty: (pointInTargetSpace.y - targetBounds.minY) / targetBounds.height,\n\t\t}\n\n\t\tif (precise) {\n\t\t\t// Turn off precision if we're within a certain distance to the center of the shape.\n\t\t\t// Funky math but we want the snap distance to be 4 at the minimum and either\n\t\t\t// 16 or 15% of the smaller dimension of the target shape, whichever is smaller\n\t\t\tif (\n\t\t\t\tVec.Dist(pointInTargetSpace, targetBounds.center) <\n\t\t\t\tMath.max(4, Math.min(Math.min(targetBounds.width, targetBounds.height) * 0.15, 16)) /\n\t\t\t\t\tthis.editor.getZoomLevel()\n\t\t\t) {\n\t\t\t\tnormalizedAnchor.x = 0.5\n\t\t\t\tnormalizedAnchor.y = 0.5\n\t\t\t}\n\t\t}\n\n\t\tnext.props[handleId] = {\n\t\t\ttype: 'binding',\n\t\t\tboundShapeId: target.id,\n\t\t\tnormalizedAnchor: normalizedAnchor,\n\t\t\tisPrecise: precise,\n\t\t\tisExact: this.editor.inputs.altKey,\n\t\t}\n\n\t\tif (next.props.start.type === 'binding' && next.props.end.type === 'binding') {\n\t\t\tif (next.props.start.boundShapeId === next.props.end.boundShapeId) {\n\t\t\t\tif (Vec.Equals(next.props.start.normalizedAnchor, next.props.end.normalizedAnchor)) {\n\t\t\t\t\tnext.props.end.normalizedAnchor.x += 0.05\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn next\n\t}\n\n\toverride onTranslateStart: TLOnTranslateStartHandler<TLArrowShape> = (shape) => {\n\t\tconst startBindingId =\n\t\t\tshape.props.start.type === 'binding' ? shape.props.start.boundShapeId : null\n\t\tconst endBindingId = shape.props.end.type === 'binding' ? shape.props.end.boundShapeId : null\n\n\t\tconst terminalsInArrowSpace = getArrowTerminalsInArrowSpace(this.editor, shape)\n\t\tconst shapePageTransform = this.editor.getShapePageTransform(shape.id)!\n\n\t\t// If at least one bound shape is in the selection, do nothing;\n\t\t// If no bound shapes are in the selection, unbind any bound shapes\n\n\t\tconst selectedShapeIds = this.editor.getSelectedShapeIds()\n\t\tconst shapesToCheck = new Set<string>()\n\t\tif (startBindingId) {\n\t\t\t// Add shape and all ancestors to set\n\t\t\tshapesToCheck.add(startBindingId)\n\t\t\tthis.editor.getShapeAncestors(startBindingId).forEach((a) => shapesToCheck.add(a.id))\n\t\t}\n\t\tif (endBindingId) {\n\t\t\t// Add shape and all ancestors to set\n\t\t\tshapesToCheck.add(endBindingId)\n\t\t\tthis.editor.getShapeAncestors(endBindingId).forEach((a) => shapesToCheck.add(a.id))\n\t\t}\n\t\t// If any of the shapes are selected, return\n\t\tfor (const id of selectedShapeIds) {\n\t\t\tif (shapesToCheck.has(id)) return\n\t\t}\n\n\t\tlet result = shape\n\n\t\t// When we start translating shapes, record where their bindings were in page space so we\n\t\t// can maintain them as we translate the arrow\n\t\tshapeAtTranslationStart.set(shape, {\n\t\t\tpagePosition: shapePageTransform.applyToPoint(shape),\n\t\t\tterminalBindings: mapObjectMapValues(terminalsInArrowSpace, (terminalName, point) => {\n\t\t\t\tconst terminal = shape.props[terminalName]\n\t\t\t\tif (terminal.type !== 'binding') return null\n\t\t\t\treturn {\n\t\t\t\t\tbinding: terminal,\n\t\t\t\t\tshapePosition: point,\n\t\t\t\t\tpagePosition: shapePageTransform.applyToPoint(point),\n\t\t\t\t}\n\t\t\t}),\n\t\t})\n\n\t\tfor (const handleName of [ARROW_HANDLES.START, ARROW_HANDLES.END] as const) {\n\t\t\tconst terminal = shape.props[handleName]\n\t\t\tif (terminal.type !== 'binding') continue\n\t\t\tresult = {\n\t\t\t\t...shape,\n\t\t\t\tprops: { ...shape.props, [handleName]: { ...terminal, isPrecise: true } },\n\t\t\t}\n\t\t}\n\n\t\treturn result\n\t}\n\n\toverride onTranslate?: TLOnTranslateHandler<TLArrowShape> = (initialShape, shape) => {\n\t\tconst atTranslationStart = shapeAtTranslationStart.get(initialShape)\n\t\tif (!atTranslationStart) return\n\n\t\tconst shapePageTransform = this.editor.getShapePageTransform(shape.id)!\n\t\tconst pageDelta = Vec.Sub(\n\t\t\tshapePageTransform.applyToPoint(shape),\n\t\t\tatTranslationStart.pagePosition\n\t\t)\n\n\t\tlet result = shape\n\t\tfor (const [terminalName, terminalBinding] of objectMapEntries(\n\t\t\tatTranslationStart.terminalBindings\n\t\t)) {\n\t\t\tif (!terminalBinding) continue\n\n\t\t\tconst newPagePoint = Vec.Add(terminalBinding.pagePosition, Vec.Mul(pageDelta, 0.5))\n\t\t\tconst newTarget = this.editor.getShapeAtPoint(newPagePoint, {\n\t\t\t\thitInside: true,\n\t\t\t\thitFrameInside: true,\n\t\t\t\tmargin: 0,\n\t\t\t\tfilter: (targetShape) => {\n\t\t\t\t\treturn !targetShape.isLocked && this.editor.getShapeUtil(targetShape).canBind(targetShape)\n\t\t\t\t},\n\t\t\t})\n\n\t\t\tif (newTarget?.id === terminalBinding.binding.boundShapeId) {\n\t\t\t\tconst targetBounds = Box.ZeroFix(this.editor.getShapeGeometry(newTarget).bounds)\n\t\t\t\tconst pointInTargetSpace = this.editor.getPointInShapeSpace(newTarget, newPagePoint)\n\t\t\t\tconst normalizedAnchor = {\n\t\t\t\t\tx: (pointInTargetSpace.x - targetBounds.minX) / targetBounds.width,\n\t\t\t\t\ty: (pointInTargetSpace.y - targetBounds.minY) / targetBounds.height,\n\t\t\t\t}\n\t\t\t\tresult = {\n\t\t\t\t\t...result,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...result.props,\n\t\t\t\t\t\t[terminalName]: { ...terminalBinding.binding, isPrecise: true, normalizedAnchor },\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult = {\n\t\t\t\t\t...result,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...result.props,\n\t\t\t\t\t\t[terminalName]: {\n\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\tx: terminalBinding.shapePosition.x,\n\t\t\t\t\t\t\ty: terminalBinding.shapePosition.y,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result\n\t}\n\n\toverride onResize: TLOnResizeHandler<TLArrowShape> = (shape, info) => {\n\t\tconst { scaleX, scaleY } = info\n\n\t\tconst terminals = getArrowTerminalsInArrowSpace(this.editor, shape)\n\n\t\tconst { start, end } = structuredClone<TLArrowShape['props']>(shape.props)\n\t\tlet { bend } = shape.props\n\n\t\t// Rescale start handle if it's not bound to a shape\n\t\tif (start.type === 'point') {\n\t\t\tstart.x = terminals.start.x * scaleX\n\t\t\tstart.y = terminals.start.y * scaleY\n\t\t}\n\n\t\t// Rescale end handle if it's not bound to a shape\n\t\tif (end.type === 'point') {\n\t\t\tend.x = terminals.end.x * scaleX\n\t\t\tend.y = terminals.end.y * scaleY\n\t\t}\n\n\t\t// todo: we should only change the normalized anchor positions\n\t\t// of the shape's handles if the bound shape is also being resized\n\n\t\tconst mx = Math.abs(scaleX)\n\t\tconst my = Math.abs(scaleY)\n\n\t\tif (scaleX < 0 && scaleY >= 0) {\n\t\t\tif (bend !== 0) {\n\t\t\t\tbend *= -1\n\t\t\t\tbend *= Math.max(mx, my)\n\t\t\t}\n\n\t\t\tif (start.type === 'binding') {\n\t\t\t\tstart.normalizedAnchor.x = 1 - start.normalizedAnchor.x\n\t\t\t}\n\n\t\t\tif (end.type === 'binding') {\n\t\t\t\tend.normalizedAnchor.x = 1 - end.normalizedAnchor.x\n\t\t\t}\n\t\t} else if (scaleX >= 0 && scaleY < 0) {\n\t\t\tif (bend !== 0) {\n\t\t\t\tbend *= -1\n\t\t\t\tbend *= Math.max(mx, my)\n\t\t\t}\n\n\t\t\tif (start.type === 'binding') {\n\t\t\t\tstart.normalizedAnchor.y = 1 - start.normalizedAnchor.y\n\t\t\t}\n\n\t\t\tif (end.type === 'binding') {\n\t\t\t\tend.normalizedAnchor.y = 1 - end.normalizedAnchor.y\n\t\t\t}\n\t\t} else if (scaleX >= 0 && scaleY >= 0) {\n\t\t\tif (bend !== 0) {\n\t\t\t\tbend *= Math.max(mx, my)\n\t\t\t}\n\t\t} else if (scaleX < 0 && scaleY < 0) {\n\t\t\tif (bend !== 0) {\n\t\t\t\tbend *= Math.max(mx, my)\n\t\t\t}\n\n\t\t\tif (start.type === 'binding') {\n\t\t\t\tstart.normalizedAnchor.x = 1 - start.normalizedAnchor.x\n\t\t\t\tstart.normalizedAnchor.y = 1 - start.normalizedAnchor.y\n\t\t\t}\n\n\t\t\tif (end.type === 'binding') {\n\t\t\t\tend.normalizedAnchor.x = 1 - end.normalizedAnchor.x\n\t\t\t\tend.normalizedAnchor.y = 1 - end.normalizedAnchor.y\n\t\t\t}\n\t\t}\n\n\t\tconst next = {\n\t\t\tprops: {\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tbend,\n\t\t\t},\n\t\t}\n\n\t\treturn next\n\t}\n\n\toverride onDoubleClickHandle = (\n\t\tshape: TLArrowShape,\n\t\thandle: TLHandle\n\t): TLShapePartial<TLArrowShape> | void => {\n\t\tswitch (handle.id) {\n\t\t\tcase ARROW_HANDLES.START: {\n\t\t\t\treturn {\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: shape.type,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...shape.props,\n\t\t\t\t\t\tarrowheadStart: shape.props.arrowheadStart === 'none' ? 'arrow' : 'none',\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t\tcase ARROW_HANDLES.END: {\n\t\t\t\treturn {\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: shape.type,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...shape.props,\n\t\t\t\t\t\tarrowheadEnd: shape.props.arrowheadEnd === 'none' ? 'arrow' : 'none',\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcomponent(shape: TLArrowShape) {\n\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\t\tconst shouldDisplayHandles =\n\t\t\tthis.editor.isInAny(\n\t\t\t\t'select.idle',\n\t\t\t\t'select.pointing_handle',\n\t\t\t\t'select.dragging_handle',\n\t\t\t\t'select.translating',\n\t\t\t\t'arrow.dragging'\n\t\t\t) && !this.editor.getInstanceState().isReadonly\n\n\t\tconst info = this.editor.getArrowInfo(shape)\n\t\tif (!info?.isValid) return null\n\n\t\tconst labelPosition = getArrowLabelPosition(this.editor, shape)\n\t\tconst isSelected = shape.id === this.editor.getOnlySelectedShapeId()\n\t\tconst isEditing = this.editor.getEditingShapeId() === shape.id\n\t\tconst showArrowLabel = isEditing || shape.props.text\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<SVGContainer id={shape.id} style={{ minWidth: 50, minHeight: 50 }}>\n\t\t\t\t\t<ArrowSvg\n\t\t\t\t\t\tshape={shape}\n\t\t\t\t\t\tshouldDisplayHandles={shouldDisplayHandles && onlySelectedShape === shape}\n\t\t\t\t\t/>\n\t\t\t\t</SVGContainer>\n\t\t\t\t{showArrowLabel && (\n\t\t\t\t\t<ArrowTextLabel\n\t\t\t\t\t\tid={shape.id}\n\t\t\t\t\t\ttext={shape.props.text}\n\t\t\t\t\t\tfont={shape.props.font}\n\t\t\t\t\t\tsize={shape.props.size}\n\t\t\t\t\t\tposition={labelPosition.box.center}\n\t\t\t\t\t\twidth={labelPosition.box.w}\n\t\t\t\t\t\tisSelected={isSelected}\n\t\t\t\t\t\tlabelColor={shape.props.labelColor}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</>\n\t\t)\n\t}\n\n\tindicator(shape: TLArrowShape) {\n\t\tconst { start, end } = getArrowTerminalsInArrowSpace(this.editor, shape)\n\n\t\tconst info = this.editor.getArrowInfo(shape)\n\t\tconst geometry = this.editor.getShapeGeometry<Group2d>(shape)\n\t\tconst bounds = geometry.bounds\n\n\t\tconst labelGeometry = shape.props.text.trim() ? (geometry.children[1] as Rectangle2d) : null\n\n\t\t// eslint-disable-next-line react-hooks/rules-of-hooks\n\t\tconst isEditing = useIsEditing(shape.id)\n\n\t\tif (!info) return null\n\t\tif (Vec.Equals(start, end)) return null\n\n\t\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\n\t\tconst as = info.start.arrowhead && getArrowheadPathForType(info, 'start', strokeWidth)\n\t\tconst ae = info.end.arrowhead && getArrowheadPathForType(info, 'end', strokeWidth)\n\n\t\tconst path = info.isStraight ? getSolidStraightArrowPath(info) : getSolidCurvedArrowPath(info)\n\n\t\tconst includeMask =\n\t\t\t(as && info.start.arrowhead !== 'arrow') ||\n\t\t\t(ae && info.end.arrowhead !== 'arrow') ||\n\t\t\t!!labelGeometry\n\n\t\tconst maskId = (shape.id + '_clip').replace(':', '_')\n\n\t\tif (isEditing && labelGeometry) {\n\t\t\treturn (\n\t\t\t\t<rect\n\t\t\t\t\tx={toDomPrecision(labelGeometry.x)}\n\t\t\t\t\ty={toDomPrecision(labelGeometry.y)}\n\t\t\t\t\twidth={labelGeometry.w}\n\t\t\t\t\theight={labelGeometry.h}\n\t\t\t\t\trx={3.5}\n\t\t\t\t\try={3.5}\n\t\t\t\t/>\n\t\t\t)\n\t\t}\n\n\t\treturn (\n\t\t\t<g>\n\t\t\t\t{includeMask && (\n\t\t\t\t\t<defs>\n\t\t\t\t\t\t<mask id={maskId}>\n\t\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\t\tx={bounds.minX - 100}\n\t\t\t\t\t\t\t\ty={bounds.minY - 100}\n\t\t\t\t\t\t\t\twidth={bounds.w + 200}\n\t\t\t\t\t\t\t\theight={bounds.h + 200}\n\t\t\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{labelGeometry && (\n\t\t\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\t\t\tx={toDomPrecision(labelGeometry.x)}\n\t\t\t\t\t\t\t\t\ty={toDomPrecision(labelGeometry.y)}\n\t\t\t\t\t\t\t\t\twidth={labelGeometry.w}\n\t\t\t\t\t\t\t\t\theight={labelGeometry.h}\n\t\t\t\t\t\t\t\t\tfill=\"black\"\n\t\t\t\t\t\t\t\t\trx={3.5}\n\t\t\t\t\t\t\t\t\try={3.5}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{as && (\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td={as}\n\t\t\t\t\t\t\t\t\tfill={info.start.arrowhead === 'arrow' ? 'none' : 'black'}\n\t\t\t\t\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{ae && (\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td={ae}\n\t\t\t\t\t\t\t\t\tfill={info.end.arrowhead === 'arrow' ? 'none' : 'black'}\n\t\t\t\t\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</mask>\n\t\t\t\t\t</defs>\n\t\t\t\t)}\n\t\t\t\t{/* firefox will clip if you provide a maskURL even if there is no mask matching that URL in the DOM */}\n\t\t\t\t<g {...(includeMask ? { mask: `url(#${maskId})` } : undefined)}>\n\t\t\t\t\t{/* This rect needs to be here if we're creating a mask due to an svg quirk on Chrome */}\n\t\t\t\t\t{includeMask && (\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\tx={bounds.minX - 100}\n\t\t\t\t\t\t\ty={bounds.minY - 100}\n\t\t\t\t\t\t\twidth={bounds.width + 200}\n\t\t\t\t\t\t\theight={bounds.height + 200}\n\t\t\t\t\t\t\topacity={0}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t<path d={path} />\n\t\t\t\t</g>\n\t\t\t\t{as && <path d={as} />}\n\t\t\t\t{ae && <path d={ae} />}\n\t\t\t\t{labelGeometry && (\n\t\t\t\t\t<rect\n\t\t\t\t\t\tx={toDomPrecision(labelGeometry.x)}\n\t\t\t\t\t\ty={toDomPrecision(labelGeometry.y)}\n\t\t\t\t\t\twidth={labelGeometry.w}\n\t\t\t\t\t\theight={labelGeometry.h}\n\t\t\t\t\t\trx={3.5}\n\t\t\t\t\t\try={3.5}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</g>\n\t\t)\n\t}\n\n\toverride onEditEnd: TLOnEditEndHandler<TLArrowShape> = (shape) => {\n\t\tconst {\n\t\t\tid,\n\t\t\ttype,\n\t\t\tprops: { text },\n\t\t} = shape\n\n\t\tif (text.trimEnd() !== shape.props.text) {\n\t\t\tthis.editor.updateShapes<TLArrowShape>([\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\ttype,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttext: text.trimEnd(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\t\t}\n\t}\n\n\toverride toSvg(shape: TLArrowShape, ctx: SvgExportContext) {\n\t\tctx.addExportDef(getFillDefForExport(shape.props.fill))\n\t\tif (shape.props.text) ctx.addExportDef(getFontDefForExport(shape.props.font))\n\t\tconst theme = getDefaultColorTheme(ctx)\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<ArrowSvg shape={shape} shouldDisplayHandles={false} />\n\t\t\t\t<SvgTextLabel\n\t\t\t\t\tfontSize={ARROW_LABEL_FONT_SIZES[shape.props.size]}\n\t\t\t\t\tfont={shape.props.font}\n\t\t\t\t\talign=\"middle\"\n\t\t\t\t\tverticalAlign=\"middle\"\n\t\t\t\t\ttext={shape.props.text}\n\t\t\t\t\tlabelColor={theme[shape.props.labelColor].solid}\n\t\t\t\t\tbounds={getArrowLabelPosition(this.editor, shape).box}\n\t\t\t\t\tpadding={4}\n\t\t\t\t/>\n\t\t\t</>\n\t\t)\n\t}\n\n\toverride getCanvasSvgDefs(): TLShapeUtilCanvasSvgDef[] {\n\t\treturn [\n\t\t\tgetFillDefForCanvas(),\n\t\t\t{\n\t\t\t\tkey: `arrow:dot`,\n\t\t\t\tcomponent: ArrowheadDotDef,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: `arrow:cross`,\n\t\t\t\tcomponent: ArrowheadCrossDef,\n\t\t\t},\n\t\t]\n\t}\n}\n\nfunction getLength(editor: Editor, shape: TLArrowShape): number {\n\tconst info = editor.getArrowInfo(shape)!\n\n\treturn info.isStraight\n\t\t? Vec.Dist(info.start.handle, info.end.handle)\n\t\t: Math.abs(info.handleArc.length)\n}\n\nconst ArrowSvg = track(function ArrowSvg({\n\tshape,\n\tshouldDisplayHandles,\n}: {\n\tshape: TLArrowShape\n\tshouldDisplayHandles: boolean\n}) {\n\tconst editor = useEditor()\n\tconst theme = useDefaultColorTheme()\n\tconst info = editor.getArrowInfo(shape)\n\tconst bounds = Box.ZeroFix(editor.getShapeGeometry(shape).bounds)\n\n\tconst changeIndex = React.useMemo<number>(() => {\n\t\treturn editor.environment.isSafari ? (globalRenderIndex += 1) : 0\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [shape])\n\n\tif (!info?.isValid) return null\n\n\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\n\tconst as = info.start.arrowhead && getArrowheadPathForType(info, 'start', strokeWidth)\n\tconst ae = info.end.arrowhead && getArrowheadPathForType(info, 'end', strokeWidth)\n\n\tconst path = info.isStraight ? getSolidStraightArrowPath(info) : getSolidCurvedArrowPath(info)\n\n\tlet handlePath: null | React.JSX.Element = null\n\n\tif (shouldDisplayHandles) {\n\t\tconst sw = 2\n\t\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(\n\t\t\tgetLength(editor, shape),\n\t\t\tsw,\n\t\t\t{\n\t\t\t\tend: 'skip',\n\t\t\t\tstart: 'skip',\n\t\t\t\tlengthRatio: 2.5,\n\t\t\t}\n\t\t)\n\n\t\thandlePath =\n\t\t\tshape.props.start.type === 'binding' || shape.props.end.type === 'binding' ? (\n\t\t\t\t<path\n\t\t\t\t\tclassName=\"tl-arrow-hint\"\n\t\t\t\t\td={info.isStraight ? getStraightArrowHandlePath(info) : getCurvedArrowHandlePath(info)}\n\t\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\t\tstrokeWidth={sw}\n\t\t\t\t\tmarkerStart={\n\t\t\t\t\t\tshape.props.start.type === 'binding'\n\t\t\t\t\t\t\t? shape.props.start.isExact\n\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t: shape.props.start.isPrecise\n\t\t\t\t\t\t\t\t\t? 'url(#arrowhead-cross)'\n\t\t\t\t\t\t\t\t\t: 'url(#arrowhead-dot)'\n\t\t\t\t\t\t\t: ''\n\t\t\t\t\t}\n\t\t\t\t\tmarkerEnd={\n\t\t\t\t\t\tshape.props.end.type === 'binding'\n\t\t\t\t\t\t\t? shape.props.end.isExact\n\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t: shape.props.end.isPrecise\n\t\t\t\t\t\t\t\t\t? 'url(#arrowhead-cross)'\n\t\t\t\t\t\t\t\t\t: 'url(#arrowhead-dot)'\n\t\t\t\t\t\t\t: ''\n\t\t\t\t\t}\n\t\t\t\t\topacity={0.16}\n\t\t\t\t/>\n\t\t\t) : null\n\t}\n\n\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(\n\t\tinfo.isStraight ? info.length : Math.abs(info.bodyArc.length),\n\t\tstrokeWidth,\n\t\t{\n\t\t\tstyle: shape.props.dash,\n\t\t}\n\t)\n\n\tconst labelPosition = getArrowLabelPosition(editor, shape)\n\n\tconst maskStartArrowhead = !(info.start.arrowhead === 'none' || info.start.arrowhead === 'arrow')\n\tconst maskEndArrowhead = !(info.end.arrowhead === 'none' || info.end.arrowhead === 'arrow')\n\n\t// NOTE: I know right setting `changeIndex` hacky-as right! But we need this because otherwise safari loses\n\t// the mask, see <https://linear.app/tldraw/issue/TLD-1500/changing-arrow-color-makes-line-pass-through-text>\n\tconst maskId = (shape.id + '_clip_' + changeIndex).replace(':', '_')\n\n\treturn (\n\t\t<>\n\t\t\t{/* Yep */}\n\t\t\t<defs>\n\t\t\t\t<mask id={maskId}>\n\t\t\t\t\t<rect\n\t\t\t\t\t\tx={toDomPrecision(-100 + bounds.minX)}\n\t\t\t\t\t\ty={toDomPrecision(-100 + bounds.minY)}\n\t\t\t\t\t\twidth={toDomPrecision(bounds.width + 200)}\n\t\t\t\t\t\theight={toDomPrecision(bounds.height + 200)}\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t\t{shape.props.text.trim() && (\n\t\t\t\t\t\t<rect\n\t\t\t\t\t\t\tx={labelPosition.box.x}\n\t\t\t\t\t\t\ty={labelPosition.box.y}\n\t\t\t\t\t\t\twidth={labelPosition.box.w}\n\t\t\t\t\t\t\theight={labelPosition.box.h}\n\t\t\t\t\t\t\tfill=\"black\"\n\t\t\t\t\t\t\trx={4}\n\t\t\t\t\t\t\try={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\t{as && maskStartArrowhead && (\n\t\t\t\t\t\t<path d={as} fill={info.start.arrowhead === 'arrow' ? 'none' : 'black'} stroke=\"none\" />\n\t\t\t\t\t)}\n\t\t\t\t\t{ae && maskEndArrowhead && (\n\t\t\t\t\t\t<path d={ae} fill={info.end.arrowhead === 'arrow' ? 'none' : 'black'} stroke=\"none\" />\n\t\t\t\t\t)}\n\t\t\t\t</mask>\n\t\t\t</defs>\n\t\t\t<g\n\t\t\t\tfill=\"none\"\n\t\t\t\tstroke={theme[shape.props.color].solid}\n\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\tstrokeLinejoin=\"round\"\n\t\t\t\tstrokeLinecap=\"round\"\n\t\t\t\tpointerEvents=\"none\"\n\t\t\t>\n\t\t\t\t{handlePath}\n\t\t\t\t{/* firefox will clip if you provide a maskURL even if there is no mask matching that URL in the DOM */}\n\t\t\t\t<g mask={`url(#${maskId})`}>\n\t\t\t\t\t<rect\n\t\t\t\t\t\tx={toDomPrecision(bounds.minX - 100)}\n\t\t\t\t\t\ty={toDomPrecision(bounds.minY - 100)}\n\t\t\t\t\t\twidth={toDomPrecision(bounds.width + 200)}\n\t\t\t\t\t\theight={toDomPrecision(bounds.height + 200)}\n\t\t\t\t\t\topacity={0}\n\t\t\t\t\t/>\n\t\t\t\t\t<path d={path} strokeDasharray={strokeDasharray} strokeDashoffset={strokeDashoffset} />\n\t\t\t\t</g>\n\t\t\t\t{as && maskStartArrowhead && shape.props.fill !== 'none' && (\n\t\t\t\t\t<ShapeFill theme={theme} d={as} color={shape.props.color} fill={shape.props.fill} />\n\t\t\t\t)}\n\t\t\t\t{ae && maskEndArrowhead && shape.props.fill !== 'none' && (\n\t\t\t\t\t<ShapeFill theme={theme} d={ae} color={shape.props.color} fill={shape.props.fill} />\n\t\t\t\t)}\n\t\t\t\t{as && <path d={as} />}\n\t\t\t\t{ae && <path d={ae} />}\n\t\t\t</g>\n\t\t</>\n\t)\n})\n\nconst shapeAtTranslationStart = new WeakMap<\n\tTLArrowShape,\n\t{\n\t\tpagePosition: Vec\n\t\tterminalBindings: Record<\n\t\t\t'start' | 'end',\n\t\t\t{\n\t\t\t\tpagePosition: Vec\n\t\t\t\tshapePosition: Vec\n\t\t\t\tbinding: Extract<TLArrowShapeProps['start'], { type: 'binding' }>\n\t\t\t} | null\n\t\t>\n\t}\n>()\n\nfunction ArrowheadDotDef() {\n\treturn (\n\t\t<marker id=\"arrowhead-dot\" className=\"tl-arrow-hint\" refX=\"3.0\" refY=\"3.0\" orient=\"0\">\n\t\t\t<circle cx=\"3\" cy=\"3\" r=\"2\" strokeDasharray=\"100%\" />\n\t\t</marker>\n\t)\n}\n\nfunction ArrowheadCrossDef() {\n\treturn (\n\t\t<marker id=\"arrowhead-cross\" className=\"tl-arrow-hint\" refX=\"3.0\" refY=\"3.0\" orient=\"auto\">\n\t\t\t<line x1=\"1.5\" y1=\"1.5\" x2=\"4.5\" y2=\"4.5\" strokeDasharray=\"100%\" />\n\t\t\t<line x1=\"1.5\" y1=\"4.5\" x2=\"4.5\" y2=\"1.5\" strokeDasharray=\"100%\" />\n\t\t</marker>\n\t)\n}\n", "import {\n\tHASH_PATTERN_ZOOM_NAMES,\n\tTLDefaultColorStyle,\n\tTLDefaultColorTheme,\n\tTLDefaultFillStyle,\n\tgetDefaultColorTheme,\n\tuseEditor,\n\tuseIsDarkMode,\n\tuseSvgExportContext,\n\tuseValue,\n} from '@tldraw/editor'\nimport React from 'react'\n\nexport interface ShapeFillProps {\n\td: string\n\tfill: TLDefaultFillStyle\n\tcolor: TLDefaultColorStyle\n\ttheme: TLDefaultColorTheme\n}\n\n/** @public */\nexport function useDefaultColorTheme() {\n\treturn getDefaultColorTheme({ isDarkMode: useIsDarkMode() })\n}\n\nexport const ShapeFill = React.memo(function ShapeFill({ theme, d, color, fill }: ShapeFillProps) {\n\tswitch (fill) {\n\t\tcase 'none': {\n\t\t\treturn null\n\t\t}\n\t\tcase 'solid': {\n\t\t\treturn <path fill={theme[color].semi} d={d} />\n\t\t}\n\t\tcase 'semi': {\n\t\t\treturn <path fill={theme.solid} d={d} />\n\t\t}\n\t\tcase 'pattern': {\n\t\t\treturn <PatternFill theme={theme} color={color} fill={fill} d={d} />\n\t\t}\n\t}\n})\n\nconst PatternFill = function PatternFill({ d, color, theme }: ShapeFillProps) {\n\tconst editor = useEditor()\n\tconst svgExport = useSvgExportContext()\n\tconst zoomLevel = useValue('zoomLevel', () => editor.getZoomLevel(), [editor])\n\n\tconst intZoom = Math.ceil(zoomLevel)\n\tconst teenyTiny = editor.getZoomLevel() <= 0.18\n\n\treturn (\n\t\t<>\n\t\t\t<path fill={theme[color].pattern} d={d} />\n\t\t\t<path\n\t\t\t\tfill={\n\t\t\t\t\tsvgExport\n\t\t\t\t\t\t? `url(#${HASH_PATTERN_ZOOM_NAMES[`1_${theme.id}`]})`\n\t\t\t\t\t\t: teenyTiny\n\t\t\t\t\t\t\t? theme[color].semi\n\t\t\t\t\t\t\t: `url(#${HASH_PATTERN_ZOOM_NAMES[`${intZoom}_${theme.id}`]})`\n\t\t\t\t}\n\t\t\t\td={d}\n\t\t\t/>\n\t\t</>\n\t)\n}\n", "import {\n\tBox,\n\tDefaultFontFamilies,\n\tTLDefaultFontStyle,\n\tTLDefaultHorizontalAlignStyle,\n\tTLDefaultVerticalAlignStyle,\n\tuseEditor,\n} from '@tldraw/editor'\nimport { useDefaultColorTheme } from './ShapeFill'\nimport { createTextJsxFromSpans } from './createTextJsxFromSpans'\nimport { TEXT_PROPS } from './default-shape-constants'\nimport { getLegacyOffsetX } from './legacyProps'\n\nexport function SvgTextLabel({\n\tfontSize,\n\tfont,\n\talign,\n\tverticalAlign,\n\ttext,\n\tlabelColor,\n\tbounds,\n\tpadding = 16,\n\tstroke = true,\n}: {\n\tfontSize: number\n\tfont: TLDefaultFontStyle\n\t// fill?: TLDefaultFillStyle\n\talign: TLDefaultHorizontalAlignStyle\n\tverticalAlign: TLDefaultVerticalAlignStyle\n\twrap?: boolean\n\ttext: string\n\tlabelColor: string\n\tbounds: Box\n\tpadding?: number\n\tstroke?: boolean\n}) {\n\tconst editor = useEditor()\n\tconst theme = useDefaultColorTheme()\n\n\tconst opts = {\n\t\tfontSize,\n\t\tfontFamily: DefaultFontFamilies[font],\n\t\ttextAlign: align,\n\t\tverticalTextAlign: verticalAlign,\n\t\twidth: Math.ceil(bounds.width),\n\t\theight: Math.ceil(bounds.height),\n\t\tpadding,\n\t\tlineHeight: TEXT_PROPS.lineHeight,\n\t\tfontStyle: 'normal',\n\t\tfontWeight: 'normal',\n\t\toverflow: 'wrap' as const,\n\t\toffsetX: 0,\n\t\toffsetY: 0,\n\t\tfill: labelColor,\n\t\tstroke: undefined as string | undefined,\n\t\tstrokeWidth: undefined as number | undefined,\n\t}\n\n\tconst spans = editor.textMeasure.measureTextSpans(text, opts)\n\tconst offsetX = getLegacyOffsetX(align, padding, spans, bounds.width)\n\tif (offsetX) {\n\t\topts.offsetX = offsetX\n\t}\n\n\topts.offsetX += bounds.x\n\topts.offsetY += bounds.y\n\n\tconst mainSpans = createTextJsxFromSpans(editor, spans, opts)\n\n\tlet outlineSpans = null\n\tif (stroke) {\n\t\topts.fill = theme.background\n\t\topts.stroke = theme.background\n\t\topts.strokeWidth = 2\n\t\toutlineSpans = createTextJsxFromSpans(editor, spans, opts)\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{outlineSpans}\n\t\t\t{mainSpans}\n\t\t</>\n\t)\n}\n", "import {\n\tBox,\n\tBoxModel,\n\tEditor,\n\tTLDefaultHorizontalAlignStyle,\n\tTLDefaultVerticalAlignStyle,\n} from '@tldraw/editor'\n\nfunction correctSpacesToNbsp(input: string) {\n\treturn input.replace(/\\s/g, '\\xa0')\n}\n\n/** Get an SVG element for a text shape. */\nexport function createTextJsxFromSpans(\n\teditor: Editor,\n\tspans: { text: string; box: BoxModel }[],\n\topts: {\n\t\tfontSize: number\n\t\tfontFamily: string\n\t\ttextAlign: TLDefaultHorizontalAlignStyle\n\t\tverticalTextAlign: TLDefaultVerticalAlignStyle\n\t\tfontWeight: string\n\t\tfontStyle: string\n\t\twidth: number\n\t\theight: number\n\t\tstroke?: string\n\t\tstrokeWidth?: number\n\t\tfill?: string\n\t\tpadding?: number\n\t\toffsetX?: number\n\t\toffsetY?: number\n\t}\n) {\n\tconst { padding = 0 } = opts\n\tif (spans.length === 0) return null\n\n\tconst bounds = Box.From(spans[0].box)\n\tfor (const { box } of spans) {\n\t\tbounds.union(box)\n\t}\n\n\tconst offsetX = padding + (opts.offsetX ?? 0)\n\tconst offsetY =\n\t\t(opts.offsetY ?? 0) +\n\t\topts.fontSize / 2 +\n\t\t(opts.verticalTextAlign === 'start'\n\t\t\t? padding\n\t\t\t: opts.verticalTextAlign === 'end'\n\t\t\t\t? opts.height - padding - bounds.height\n\t\t\t\t: (Math.ceil(opts.height) - bounds.height) / 2)\n\n\t// Create text span elements for each word\n\tlet currentLineTop = null\n\tconst children = []\n\tfor (const { text, box } of spans) {\n\t\t// if we broke a line, add a line break span. This helps tools like\n\t\t// figma import our exported svg correctly\n\t\tconst didBreakLine = currentLineTop !== null && box.y > currentLineTop\n\t\tif (didBreakLine) {\n\t\t\tchildren.push(\n\t\t\t\t<tspan\n\t\t\t\t\tkey={children.length}\n\t\t\t\t\talignmentBaseline=\"mathematical\"\n\t\t\t\t\tx={offsetX}\n\t\t\t\t\ty={box.y + offsetY}\n\t\t\t\t>\n\t\t\t\t\t{'\\n'}\n\t\t\t\t</tspan>\n\t\t\t)\n\t\t}\n\n\t\tchildren.push(\n\t\t\t<tspan\n\t\t\t\tkey={children.length}\n\t\t\t\talignmentBaseline=\"mathematical\"\n\t\t\t\tx={box.x + offsetX}\n\t\t\t\ty={box.y + offsetY}\n\t\t\t>\n\t\t\t\t{correctSpacesToNbsp(text)}\n\t\t\t</tspan>\n\t\t)\n\n\t\tcurrentLineTop = box.y\n\t}\n\n\treturn (\n\t\t<text\n\t\t\tfontSize={opts.fontSize}\n\t\t\tfontFamily={opts.fontFamily}\n\t\t\tfontStyle={opts.fontFamily}\n\t\t\tfontWeight={opts.fontWeight}\n\t\t\tdominantBaseline=\"mathematical\"\n\t\t\talignmentBaseline=\"mathematical\"\n\t\t\tstroke={opts.stroke}\n\t\t\tstrokeWidth={opts.strokeWidth}\n\t\t\tfill={opts.fill}\n\t\t>\n\t\t\t{children}\n\t\t</text>\n\t)\n}\n", "import { Box, BoxModel, TLDefaultHorizontalAlignStyle } from '@tldraw/editor'\n\nexport function getLegacyOffsetX(\n\talign: TLDefaultHorizontalAlignStyle | string,\n\tpadding: number,\n\tspans: { text: string; box: BoxModel }[],\n\ttotalWidth: number\n): number | undefined {\n\tif ((align === 'start-legacy' || align === 'end-legacy') && spans.length !== 0) {\n\t\tconst spansBounds = Box.From(spans[0].box)\n\t\tfor (const { box } of spans) {\n\t\t\tspansBounds.union(box)\n\t\t}\n\t\tif (align === 'start-legacy') {\n\t\t\treturn (totalWidth - 2 * padding - spansBounds.width) / 2\n\t\t} else if (align === 'end-legacy') {\n\t\t\treturn -(totalWidth - 2 * padding - spansBounds.width) / 2\n\t\t}\n\t}\n}\n\n// sneaky TLDefaultHorizontalAlignStyle for legacies\nexport function isLegacyAlign(align: TLDefaultHorizontalAlignStyle | string): boolean {\n\treturn align === 'start-legacy' || align === 'middle-legacy' || align === 'end-legacy'\n}\n", "import {\n\tDefaultColorThemePalette,\n\tDefaultFontFamilies,\n\tDefaultFontStyle,\n\tFileHelpers,\n\tHASH_PATTERN_ZOOM_NAMES,\n\tMAX_ZOOM,\n\tSvgExportDef,\n\tTLDefaultFillStyle,\n\tTLDefaultFontStyle,\n\tTLShapeUtilCanvasSvgDef,\n\tdebugFlags,\n\tuseEditor,\n} from '@tldraw/editor'\nimport { useEffect, useMemo, useRef, useState } from 'react'\nimport { useDefaultColorTheme } from './ShapeFill'\n\n/** @public */\nexport function getFontDefForExport(fontStyle: TLDefaultFontStyle): SvgExportDef {\n\treturn {\n\t\tkey: `${DefaultFontStyle.id}:${fontStyle}`,\n\t\tgetElement: async () => {\n\t\t\tconst font = findFont(fontStyle)\n\t\t\tif (!font) return null\n\n\t\t\tconst url: string = (font as any).$$_url\n\t\t\tconst fontFaceRule: string = (font as any).$$_fontface\n\t\t\tif (!url || !fontFaceRule) return null\n\n\t\t\tconst fontFile = await (await fetch(url)).blob()\n\t\t\tconst base64FontFile = await FileHelpers.blobToDataUrl(fontFile)\n\n\t\t\tconst newFontFaceRule = fontFaceRule.replace(url, base64FontFile)\n\t\t\treturn <style>{newFontFaceRule}</style>\n\t\t},\n\t}\n}\n\nfunction findFont(name: TLDefaultFontStyle): FontFace | null {\n\tconst fontFamily = DefaultFontFamilies[name]\n\tfor (const font of document.fonts) {\n\t\tif (fontFamily.includes(font.family)) {\n\t\t\treturn font\n\t\t}\n\t}\n\treturn null\n}\n\n/** @public */\nexport function getFillDefForExport(fill: TLDefaultFillStyle): SvgExportDef {\n\treturn {\n\t\tkey: `${DefaultFontStyle.id}:${fill}`,\n\t\tgetElement: async () => {\n\t\t\tif (fill !== 'pattern') return null\n\n\t\t\treturn <HashPatternForExport />\n\t\t},\n\t}\n}\n\nfunction HashPatternForExport() {\n\tconst theme = useDefaultColorTheme()\n\tconst t = 8 / 12\n\treturn (\n\t\t<>\n\t\t\t<mask id=\"hash_pattern_mask\">\n\t\t\t\t<rect x=\"0\" y=\"0\" width=\"8\" height=\"8\" fill=\"white\" />\n\t\t\t\t<g strokeLinecap=\"round\" stroke=\"black\">\n\t\t\t\t\t<line x1={t * 1} y1={t * 3} x2={t * 3} y2={t * 1} />\n\t\t\t\t\t<line x1={t * 5} y1={t * 7} x2={t * 7} y2={t * 5} />\n\t\t\t\t\t<line x1={t * 9} y1={t * 11} x2={t * 11} y2={t * 9} />\n\t\t\t\t</g>\n\t\t\t</mask>\n\t\t\t<pattern\n\t\t\t\tid={HASH_PATTERN_ZOOM_NAMES[`1_${theme.id}`]}\n\t\t\t\twidth=\"8\"\n\t\t\t\theight=\"8\"\n\t\t\t\tpatternUnits=\"userSpaceOnUse\"\n\t\t\t>\n\t\t\t\t<rect x=\"0\" y=\"0\" width=\"8\" height=\"8\" fill={theme.solid} mask=\"url(#hash_pattern_mask)\" />\n\t\t\t</pattern>\n\t\t</>\n\t)\n}\n\nexport function getFillDefForCanvas(): TLShapeUtilCanvasSvgDef {\n\treturn {\n\t\tkey: `${DefaultFontStyle.id}:pattern`,\n\t\tcomponent: PatternFillDefForCanvas,\n\t}\n}\nconst TILE_PATTERN_SIZE = 8\n\nconst generateImage = (dpr: number, currentZoom: number, darkMode: boolean) => {\n\treturn new Promise<Blob>((resolve, reject) => {\n\t\tconst size = TILE_PATTERN_SIZE * currentZoom * dpr\n\n\t\tconst canvasEl = document.createElement('canvas')\n\t\tcanvasEl.width = size\n\t\tcanvasEl.height = size\n\n\t\tconst ctx = canvasEl.getContext('2d')\n\t\tif (!ctx) return\n\n\t\tctx.fillStyle = darkMode ? '#212529' : '#f8f9fa'\n\t\tctx.fillRect(0, 0, size, size)\n\n\t\t// This essentially generates an inverse of the pattern we're drawing.\n\t\tctx.globalCompositeOperation = 'destination-out'\n\n\t\tctx.lineCap = 'round'\n\t\tctx.lineWidth = 1.25 * currentZoom * dpr\n\n\t\tconst t = 8 / 12\n\t\tconst s = (v: number) => v * currentZoom * dpr\n\n\t\tctx.beginPath()\n\t\tctx.moveTo(s(t * 1), s(t * 3))\n\t\tctx.lineTo(s(t * 3), s(t * 1))\n\n\t\tctx.moveTo(s(t * 5), s(t * 7))\n\t\tctx.lineTo(s(t * 7), s(t * 5))\n\n\t\tctx.moveTo(s(t * 9), s(t * 11))\n\t\tctx.lineTo(s(t * 11), s(t * 9))\n\t\tctx.stroke()\n\n\t\tcanvasEl.toBlob((blob) => {\n\t\t\tif (!blob || debugFlags.throwToBlob.get()) {\n\t\t\t\treject()\n\t\t\t} else {\n\t\t\t\tresolve(blob)\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst canvasBlob = (size: [number, number], fn: (ctx: CanvasRenderingContext2D) => void) => {\n\tconst canvas = document.createElement('canvas')\n\tcanvas.width = size[0]\n\tcanvas.height = size[1]\n\tconst ctx = canvas.getContext('2d')\n\tif (!ctx) return ''\n\tfn(ctx)\n\treturn canvas.toDataURL()\n}\ntype PatternDef = { zoom: number; url: string; darkMode: boolean }\n\nconst getDefaultPatterns = () => {\n\tconst defaultPatterns: PatternDef[] = []\n\tfor (let i = 1; i <= Math.ceil(MAX_ZOOM); i++) {\n\t\tconst whitePixelBlob = canvasBlob([1, 1], (ctx) => {\n\t\t\tctx.fillStyle = DefaultColorThemePalette.lightMode.black.semi\n\t\t\tctx.fillRect(0, 0, 1, 1)\n\t\t})\n\t\tconst blackPixelBlob = canvasBlob([1, 1], (ctx) => {\n\t\t\tctx.fillStyle = DefaultColorThemePalette.darkMode.black.semi\n\t\t\tctx.fillRect(0, 0, 1, 1)\n\t\t})\n\t\tdefaultPatterns.push({\n\t\t\tzoom: i,\n\t\t\turl: whitePixelBlob,\n\t\t\tdarkMode: false,\n\t\t})\n\t\tdefaultPatterns.push({\n\t\t\tzoom: i,\n\t\t\turl: blackPixelBlob,\n\t\t\tdarkMode: true,\n\t\t})\n\t}\n\treturn defaultPatterns\n}\n\nfunction usePattern() {\n\tconst editor = useEditor()\n\tconst dpr = editor.getInstanceState().devicePixelRatio\n\tconst [isReady, setIsReady] = useState(false)\n\tconst defaultPatterns = useMemo(() => getDefaultPatterns(), [])\n\tconst [backgroundUrls, setBackgroundUrls] = useState<PatternDef[]>(defaultPatterns)\n\n\tuseEffect(() => {\n\t\tif (process.env.NODE_ENV === 'test') {\n\t\t\tsetIsReady(true)\n\t\t\treturn\n\t\t}\n\n\t\tconst promises: Promise<{ zoom: number; url: string; darkMode: boolean }>[] = []\n\n\t\tfor (let i = 1; i <= Math.ceil(MAX_ZOOM); i++) {\n\t\t\tpromises.push(\n\t\t\t\tgenerateImage(dpr, i, false).then((blob) => ({\n\t\t\t\t\tzoom: i,\n\t\t\t\t\turl: URL.createObjectURL(blob),\n\t\t\t\t\tdarkMode: false,\n\t\t\t\t}))\n\t\t\t)\n\t\t\tpromises.push(\n\t\t\t\tgenerateImage(dpr, i, true).then((blob) => ({\n\t\t\t\t\tzoom: i,\n\t\t\t\t\turl: URL.createObjectURL(blob),\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t}))\n\t\t\t)\n\t\t}\n\n\t\tlet isCancelled = false\n\t\tPromise.all(promises).then((urls) => {\n\t\t\tif (isCancelled) return\n\t\t\tsetBackgroundUrls(urls)\n\t\t\tsetIsReady(true)\n\t\t})\n\n\t\treturn () => {\n\t\t\tisCancelled = true\n\t\t\tsetIsReady(false)\n\t\t}\n\t}, [dpr])\n\n\tconst defs = (\n\t\t<>\n\t\t\t{backgroundUrls.map((item) => {\n\t\t\t\tconst key = item.zoom + (item.darkMode ? '_dark' : '_light')\n\t\t\t\treturn (\n\t\t\t\t\t<pattern\n\t\t\t\t\t\tkey={key}\n\t\t\t\t\t\tid={HASH_PATTERN_ZOOM_NAMES[key]}\n\t\t\t\t\t\twidth={TILE_PATTERN_SIZE}\n\t\t\t\t\t\theight={TILE_PATTERN_SIZE}\n\t\t\t\t\t\tpatternUnits=\"userSpaceOnUse\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<image href={item.url} width={TILE_PATTERN_SIZE} height={TILE_PATTERN_SIZE} />\n\t\t\t\t\t</pattern>\n\t\t\t\t)\n\t\t\t})}\n\t\t</>\n\t)\n\n\treturn { defs, isReady }\n}\n\nfunction PatternFillDefForCanvas() {\n\tconst editor = useEditor()\n\tconst containerRef = useRef<SVGGElement>(null)\n\tconst { defs, isReady } = usePattern()\n\n\tuseEffect(() => {\n\t\tif (isReady && editor.environment.isSafari) {\n\t\t\tconst htmlLayer = findHtmlLayerParent(containerRef.current!)\n\t\t\tif (htmlLayer) {\n\t\t\t\t// Wait for `patternContext` to be picked up\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\thtmlLayer.style.display = 'none'\n\n\t\t\t\t\t// Wait for 'display = \"none\"' to take effect\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\thtmlLayer.style.display = ''\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}, [editor, isReady])\n\n\treturn (\n\t\t<g ref={containerRef} data-testid={isReady ? 'ready-pattern-fill-defs' : undefined}>\n\t\t\t{defs}\n\t\t</g>\n\t)\n}\n\nfunction findHtmlLayerParent(element: Element): HTMLElement | null {\n\tif (element.classList.contains('tl-html-layer')) return element as HTMLElement\n\tif (element.parentElement) return findHtmlLayerParent(element.parentElement)\n\treturn null\n}\n", "import { TLDefaultDashStyle } from '@tldraw/editor'\n\n/** @public */\nexport function getPerfectDashProps(\n\ttotalLength: number,\n\tstrokeWidth: number,\n\topts = {} as Partial<{\n\t\tstyle: TLDefaultDashStyle\n\t\tsnap: number\n\t\tend: 'skip' | 'outset' | 'none'\n\t\tstart: 'skip' | 'outset' | 'none'\n\t\tlengthRatio: number\n\t\tclosed: boolean\n\t}>\n): {\n\tstrokeDasharray: string\n\tstrokeDashoffset: string\n} {\n\tconst {\n\t\tclosed = false,\n\t\tsnap = 1,\n\t\tstart = 'outset',\n\t\tend = 'outset',\n\t\tlengthRatio = 2,\n\t\tstyle = 'dashed',\n\t} = opts\n\n\tlet dashLength = 0\n\tlet dashCount = 0\n\tlet ratio = 1\n\tlet gapLength = 0\n\tlet strokeDashoffset = 0\n\n\tswitch (style) {\n\t\tcase 'dashed': {\n\t\t\tratio = 1\n\t\t\tdashLength = Math.min(strokeWidth * lengthRatio, totalLength / 4)\n\t\t\tbreak\n\t\t}\n\t\tcase 'dotted': {\n\t\t\tratio = 100\n\t\t\tdashLength = strokeWidth / ratio\n\t\t\tbreak\n\t\t}\n\t\tdefault: {\n\t\t\treturn {\n\t\t\t\tstrokeDasharray: 'none',\n\t\t\t\tstrokeDashoffset: 'none',\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!closed) {\n\t\tif (start === 'outset') {\n\t\t\ttotalLength += dashLength / 2\n\t\t\tstrokeDashoffset += dashLength / 2\n\t\t} else if (start === 'skip') {\n\t\t\ttotalLength -= dashLength\n\t\t\tstrokeDashoffset -= dashLength\n\t\t}\n\n\t\tif (end === 'outset') {\n\t\t\ttotalLength += dashLength / 2\n\t\t} else if (end === 'skip') {\n\t\t\ttotalLength -= dashLength\n\t\t}\n\t}\n\n\tdashCount = Math.floor(totalLength / dashLength / (2 * ratio))\n\tdashCount -= dashCount % snap\n\n\tif (dashCount < 3 && style === 'dashed') {\n\t\tif (totalLength / strokeWidth < 5) {\n\t\t\tdashLength = totalLength\n\t\t\tdashCount = 1\n\t\t\tgapLength = 0\n\t\t} else {\n\t\t\tdashLength = totalLength * 0.333\n\t\t\tgapLength = totalLength * 0.333\n\t\t}\n\t} else {\n\t\tdashCount = Math.max(dashCount, 3)\n\t\tdashLength = totalLength / dashCount / (2 * ratio)\n\n\t\tif (closed) {\n\t\t\tstrokeDashoffset = dashLength / 2\n\t\t\tgapLength = (totalLength - dashCount * dashLength) / dashCount\n\t\t} else {\n\t\t\tgapLength = (totalLength - dashCount * dashLength) / Math.max(1, dashCount - 1)\n\t\t}\n\t}\n\n\treturn {\n\t\tstrokeDasharray: [dashLength, gapLength].join(' '),\n\t\tstrokeDashoffset: strokeDashoffset.toString(),\n\t}\n}\n", "import {\n\tArc2d,\n\tBox,\n\tCircle2d,\n\tEdge2d,\n\tEditor,\n\tGeometry2d,\n\tPolygon2d,\n\tTLArrowInfo,\n\tTLArrowShape,\n\tVec,\n\tVecLike,\n\tangleDistance,\n\tclamp,\n\tgetPointOnCircle,\n\tintersectCirclePolygon,\n\tintersectLineSegmentPolygon,\n} from '@tldraw/editor'\nimport {\n\tARROW_LABEL_FONT_SIZES,\n\tARROW_LABEL_PADDING,\n\tFONT_FAMILIES,\n\tLABEL_TO_ARROW_PADDING,\n\tSTROKE_SIZES,\n\tTEXT_PROPS,\n} from '../shared/default-shape-constants'\n\nconst labelSizeCache = new WeakMap<TLArrowShape, Vec>()\n\nfunction getArrowLabelSize(editor: Editor, shape: TLArrowShape) {\n\tconst cachedSize = labelSizeCache.get(shape)\n\tif (cachedSize) return cachedSize\n\n\tconst info = editor.getArrowInfo(shape)!\n\tlet width = 0\n\tlet height = 0\n\n\tconst bodyGeom = info.isStraight\n\t\t? new Edge2d({\n\t\t\t\tstart: Vec.From(info.start.point),\n\t\t\t\tend: Vec.From(info.end.point),\n\t\t\t})\n\t\t: new Arc2d({\n\t\t\t\tcenter: Vec.Cast(info.handleArc.center),\n\t\t\t\tradius: info.handleArc.radius,\n\t\t\t\tstart: Vec.Cast(info.start.point),\n\t\t\t\tend: Vec.Cast(info.end.point),\n\t\t\t\tsweepFlag: info.bodyArc.sweepFlag,\n\t\t\t\tlargeArcFlag: info.bodyArc.largeArcFlag,\n\t\t\t})\n\n\tif (shape.props.text.trim()) {\n\t\tconst bodyBounds = bodyGeom.bounds\n\n\t\tconst { w, h } = editor.textMeasure.measureText(shape.props.text, {\n\t\t\t...TEXT_PROPS,\n\t\t\tfontFamily: FONT_FAMILIES[shape.props.font],\n\t\t\tfontSize: ARROW_LABEL_FONT_SIZES[shape.props.size],\n\t\t\tmaxWidth: null,\n\t\t})\n\n\t\twidth = w\n\t\theight = h\n\n\t\tif (bodyBounds.width > bodyBounds.height) {\n\t\t\twidth = Math.max(Math.min(w, 64), Math.min(bodyBounds.width - 64, w))\n\n\t\t\tconst { w: squishedWidth, h: squishedHeight } = editor.textMeasure.measureText(\n\t\t\t\tshape.props.text,\n\t\t\t\t{\n\t\t\t\t\t...TEXT_PROPS,\n\t\t\t\t\tfontFamily: FONT_FAMILIES[shape.props.font],\n\t\t\t\t\tfontSize: ARROW_LABEL_FONT_SIZES[shape.props.size],\n\t\t\t\t\tmaxWidth: width,\n\t\t\t\t}\n\t\t\t)\n\n\t\t\twidth = squishedWidth\n\t\t\theight = squishedHeight\n\t\t}\n\n\t\tif (width > 16 * ARROW_LABEL_FONT_SIZES[shape.props.size]) {\n\t\t\twidth = 16 * ARROW_LABEL_FONT_SIZES[shape.props.size]\n\n\t\t\tconst { w: squishedWidth, h: squishedHeight } = editor.textMeasure.measureText(\n\t\t\t\tshape.props.text,\n\t\t\t\t{\n\t\t\t\t\t...TEXT_PROPS,\n\t\t\t\t\tfontFamily: FONT_FAMILIES[shape.props.font],\n\t\t\t\t\tfontSize: ARROW_LABEL_FONT_SIZES[shape.props.size],\n\t\t\t\t\tmaxWidth: width,\n\t\t\t\t}\n\t\t\t)\n\n\t\t\twidth = squishedWidth\n\t\t\theight = squishedHeight\n\t\t}\n\t}\n\n\tconst size = new Vec(width, height).addScalar(ARROW_LABEL_PADDING * 2)\n\tlabelSizeCache.set(shape, size)\n\treturn size\n}\n\nfunction getLabelToArrowPadding(editor: Editor, shape: TLArrowShape) {\n\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\tconst labelToArrowPadding =\n\t\tLABEL_TO_ARROW_PADDING +\n\t\t(strokeWidth - STROKE_SIZES.s) * 2 +\n\t\t(strokeWidth === STROKE_SIZES.xl ? 20 : 0)\n\n\treturn labelToArrowPadding\n}\n\n/**\n * Return the range of possible label positions for a straight arrow. The full possible range is 0\n * to 1, but as the label itself takes up space the usable range is smaller.\n */\nfunction getStraightArrowLabelRange(\n\teditor: Editor,\n\tshape: TLArrowShape,\n\tinfo: Extract<TLArrowInfo, { isStraight: true }>\n): { start: number; end: number } {\n\tconst labelSize = getArrowLabelSize(editor, shape)\n\tconst labelToArrowPadding = getLabelToArrowPadding(editor, shape)\n\n\t// take the start and end points of the arrow, and nudge them in a bit to give some spare space:\n\tconst startOffset = Vec.Nudge(info.start.point, info.end.point, labelToArrowPadding)\n\tconst endOffset = Vec.Nudge(info.end.point, info.start.point, labelToArrowPadding)\n\n\t// assuming we just stick the label in the middle of the shape, where does the arrow intersect the label?\n\tconst intersectionPoints = intersectLineSegmentPolygon(\n\t\tstartOffset,\n\t\tendOffset,\n\t\tBox.FromCenter(info.middle, labelSize).corners\n\t)\n\tif (!intersectionPoints || intersectionPoints.length !== 2) {\n\t\treturn { start: 0.5, end: 0.5 }\n\t}\n\n\t// there should be two intersection points - one near the start, and one near the end\n\tlet [startIntersect, endIntersect] = intersectionPoints\n\tif (Vec.Dist2(startIntersect, startOffset) > Vec.Dist2(endIntersect, startOffset)) {\n\t\t;[endIntersect, startIntersect] = intersectionPoints\n\t}\n\n\t// take our nudged start and end points and scooch them in even further to give us the possible\n\t// range for the position of the _center_ of the label\n\tconst startConstrained = startOffset.add(Vec.Sub(info.middle, startIntersect))\n\tconst endConstrained = endOffset.add(Vec.Sub(info.middle, endIntersect))\n\n\t// now we can work out the range of possible label positions\n\tconst start = Vec.Dist(info.start.point, startConstrained) / info.length\n\tconst end = Vec.Dist(info.start.point, endConstrained) / info.length\n\treturn { start, end }\n}\n\n/**\n * Return the range of possible label positions for a curved arrow. The full possible range is 0\n * to 1, but as the label itself takes up space the usable range is smaller.\n */\nfunction getCurvedArrowLabelRange(\n\teditor: Editor,\n\tshape: TLArrowShape,\n\tinfo: Extract<TLArrowInfo, { isStraight: false }>\n): { start: number; end: number; dbg?: Geometry2d[] } {\n\tconst labelSize = getArrowLabelSize(editor, shape)\n\tconst labelToArrowPadding = getLabelToArrowPadding(editor, shape)\n\tconst direction = Math.sign(shape.props.bend)\n\n\t// take the start and end points of the arrow, and nudge them in a bit to give some spare space:\n\tconst labelToArrowPaddingRad = (labelToArrowPadding / info.handleArc.radius) * direction\n\tconst startOffsetAngle = Vec.Angle(info.bodyArc.center, info.start.point) - labelToArrowPaddingRad\n\tconst endOffsetAngle = Vec.Angle(info.bodyArc.center, info.end.point) + labelToArrowPaddingRad\n\tconst startOffset = getPointOnCircle(info.bodyArc.center, info.bodyArc.radius, startOffsetAngle)\n\tconst endOffset = getPointOnCircle(info.bodyArc.center, info.bodyArc.radius, endOffsetAngle)\n\n\tconst dbg: Geometry2d[] = []\n\n\t// unlike the straight arrow, we can't just stick the label in the middle of the shape when\n\t// we're working out the range. this is because as the label moves along the curve, the place\n\t// where the arrow intersects with label changes. instead, we have to stick the label center on\n\t// the `startOffset` (the start-most place where it can go), then find where it intersects with\n\t// the arc. because of the symmetry of the label rectangle, we can move the label to that new\n\t// center and take that as the start-most possible point.\n\tconst startIntersections = intersectArcPolygon(\n\t\tinfo.bodyArc.center,\n\t\tinfo.bodyArc.radius,\n\t\tstartOffsetAngle,\n\t\tendOffsetAngle,\n\t\tdirection,\n\t\tBox.FromCenter(startOffset, labelSize).corners\n\t)\n\n\tdbg.push(\n\t\tnew Polygon2d({\n\t\t\tpoints: Box.FromCenter(startOffset, labelSize).corners,\n\t\t\tdebugColor: 'lime',\n\t\t\tisFilled: false,\n\t\t\tignore: true,\n\t\t})\n\t)\n\n\tconst endIntersections = intersectArcPolygon(\n\t\tinfo.bodyArc.center,\n\t\tinfo.bodyArc.radius,\n\t\tstartOffsetAngle,\n\t\tendOffsetAngle,\n\t\tdirection,\n\t\tBox.FromCenter(endOffset, labelSize).corners\n\t)\n\n\tdbg.push(\n\t\tnew Polygon2d({\n\t\t\tpoints: Box.FromCenter(endOffset, labelSize).corners,\n\t\t\tdebugColor: 'lime',\n\t\t\tisFilled: false,\n\t\t\tignore: true,\n\t\t})\n\t)\n\tfor (const pt of [\n\t\t...(startIntersections ?? []),\n\t\t...(endIntersections ?? []),\n\t\tstartOffset,\n\t\tendOffset,\n\t]) {\n\t\tdbg.push(\n\t\t\tnew Circle2d({\n\t\t\t\tx: pt.x - 3,\n\t\t\t\ty: pt.y - 3,\n\t\t\t\tradius: 3,\n\t\t\t\tisFilled: false,\n\t\t\t\tdebugColor: 'magenta',\n\t\t\t\tignore: true,\n\t\t\t})\n\t\t)\n\t}\n\n\t// if we have one or more intersections (we shouldn't have more than two) then the one we need\n\t// is the one furthest from the arrow terminal\n\tconst startConstrained =\n\t\t(startIntersections && furthest(info.start.point, startIntersections)) ?? info.middle\n\tconst endConstrained =\n\t\t(endIntersections && furthest(info.end.point, endIntersections)) ?? info.middle\n\n\tconst startAngle = Vec.Angle(info.bodyArc.center, info.start.point)\n\tconst endAngle = Vec.Angle(info.bodyArc.center, info.end.point)\n\tconst constrainedStartAngle = Vec.Angle(info.bodyArc.center, startConstrained)\n\tconst constrainedEndAngle = Vec.Angle(info.bodyArc.center, endConstrained)\n\n\t// if the arc is small enough that there's no room for the label to move, we constrain it to the middle.\n\tif (\n\t\tangleDistance(startAngle, constrainedStartAngle, direction) >\n\t\tangleDistance(startAngle, constrainedEndAngle, direction)\n\t) {\n\t\treturn { start: 0.5, end: 0.5, dbg }\n\t}\n\n\t// now we can work out the range of possible label positions\n\tconst fullDistance = angleDistance(startAngle, endAngle, direction)\n\tconst start = angleDistance(startAngle, constrainedStartAngle, direction) / fullDistance\n\tconst end = angleDistance(startAngle, constrainedEndAngle, direction) / fullDistance\n\treturn { start, end, dbg }\n}\n\nexport function getArrowLabelPosition(editor: Editor, shape: TLArrowShape) {\n\tlet labelCenter\n\tconst debugGeom: Geometry2d[] = []\n\tconst info = editor.getArrowInfo(shape)!\n\n\tconst hasStartBinding = shape.props.start.type === 'binding'\n\tconst hasEndBinding = shape.props.end.type === 'binding'\n\tconst hasStartArrowhead = info.start.arrowhead !== 'none'\n\tconst hasEndArrowhead = info.end.arrowhead !== 'none'\n\tif (info.isStraight) {\n\t\tconst range = getStraightArrowLabelRange(editor, shape, info)\n\t\tlet clampedPosition = clamp(\n\t\t\tshape.props.labelPosition,\n\t\t\thasStartArrowhead || hasStartBinding ? range.start : 0,\n\t\t\thasEndArrowhead || hasEndBinding ? range.end : 1\n\t\t)\n\t\t// This makes the position snap in the middle.\n\t\tclampedPosition = clampedPosition >= 0.48 && clampedPosition <= 0.52 ? 0.5 : clampedPosition\n\t\tlabelCenter = Vec.Lrp(info.start.point, info.end.point, clampedPosition)\n\t} else {\n\t\tconst range = getCurvedArrowLabelRange(editor, shape, info)\n\t\tif (range.dbg) debugGeom.push(...range.dbg)\n\t\tlet clampedPosition = clamp(\n\t\t\tshape.props.labelPosition,\n\t\t\thasStartArrowhead || hasStartBinding ? range.start : 0,\n\t\t\thasEndArrowhead || hasEndBinding ? range.end : 1\n\t\t)\n\t\t// This makes the position snap in the middle.\n\t\tclampedPosition = clampedPosition >= 0.48 && clampedPosition <= 0.52 ? 0.5 : clampedPosition\n\t\tconst labelAngle = interpolateArcAngles(\n\t\t\tVec.Angle(info.bodyArc.center, info.start.point),\n\t\t\tVec.Angle(info.bodyArc.center, info.end.point),\n\t\t\tMath.sign(shape.props.bend),\n\t\t\tclampedPosition\n\t\t)\n\t\tlabelCenter = getPointOnCircle(info.bodyArc.center, info.bodyArc.radius, labelAngle)\n\t}\n\n\tconst labelSize = getArrowLabelSize(editor, shape)\n\n\treturn { box: Box.FromCenter(labelCenter, labelSize), debugGeom }\n}\n\nfunction intersectArcPolygon(\n\tcenter: VecLike,\n\tradius: number,\n\tangleStart: number,\n\tangleEnd: number,\n\tdirection: number,\n\tpolygon: VecLike[]\n) {\n\tconst intersections = intersectCirclePolygon(center, radius, polygon)\n\n\t// filter the circle intersections to just the ones from the arc\n\tconst fullArcDistance = angleDistance(angleStart, angleEnd, direction)\n\treturn intersections?.filter((pt) => {\n\t\tconst pDistance = angleDistance(angleStart, Vec.Angle(center, pt), direction)\n\t\treturn pDistance >= 0 && pDistance <= fullArcDistance\n\t})\n}\n\nfunction furthest(from: VecLike, candidates: VecLike[]): VecLike | null {\n\tlet furthest: VecLike | null = null\n\tlet furthestDist = -Infinity\n\n\tfor (const candidate of candidates) {\n\t\tconst dist = Vec.Dist2(from, candidate)\n\t\tif (dist > furthestDist) {\n\t\t\tfurthest = candidate\n\t\t\tfurthestDist = dist\n\t\t}\n\t}\n\n\treturn furthest\n}\n\n/**\n *\n * @param angleStart - The angle of the start of the arc\n * @param angleEnd - The angle of the end of the arc\n * @param direction - The direction of the arc (1 = counter-clockwise, -1 = clockwise)\n * @param t - A number between 0 and 1 representing the position along the arc\n * @returns\n */\nfunction interpolateArcAngles(angleStart: number, angleEnd: number, direction: number, t: number) {\n\tconst dist = angleDistance(angleStart, angleEnd, direction)\n\treturn angleStart + dist * t * direction * -1\n}\n", "import { HALF_PI, PI, TLArrowInfo, Vec, VecLike, intersectCircleCircle } from '@tldraw/editor'\n\ntype TLArrowPointsInfo = {\n\tpoint: VecLike\n\tint: VecLike\n}\n\nfunction getArrowPoints(\n\tinfo: TLArrowInfo,\n\tside: 'start' | 'end',\n\tstrokeWidth: number\n): TLArrowPointsInfo {\n\tconst PT = side === 'end' ? info.end.point : info.start.point\n\tconst PB = side === 'end' ? info.start.point : info.end.point\n\n\tconst compareLength = info.isStraight ? Vec.Dist(PB, PT) : Math.abs(info.bodyArc.length) // todo: arc length for curved arrows\n\n\tconst length = Math.max(Math.min(compareLength / 5, strokeWidth * 3), strokeWidth)\n\n\tlet P0: VecLike\n\n\tif (info.isStraight) {\n\t\tP0 = Vec.Nudge(PT, PB, length)\n\t} else {\n\t\tconst ints = intersectCircleCircle(PT, length, info.handleArc.center, info.handleArc.radius)\n\t\tP0 =\n\t\t\tside === 'end'\n\t\t\t\t? info.handleArc.sweepFlag\n\t\t\t\t\t? ints[0]\n\t\t\t\t\t: ints[1]\n\t\t\t\t: info.handleArc.sweepFlag\n\t\t\t\t\t? ints[1]\n\t\t\t\t\t: ints[0]\n\t}\n\n\tif (Vec.IsNaN(P0)) {\n\t\tP0 = info.start.point\n\t}\n\n\treturn {\n\t\tpoint: PT,\n\t\tint: P0,\n\t}\n}\n\nfunction getArrowhead({ point, int }: TLArrowPointsInfo) {\n\tconst PL = Vec.RotWith(int, point, PI / 6)\n\tconst PR = Vec.RotWith(int, point, -PI / 6)\n\n\treturn `M ${PL.x} ${PL.y} L ${point.x} ${point.y} L ${PR.x} ${PR.y}`\n}\n\nfunction getTriangleHead({ point, int }: TLArrowPointsInfo) {\n\tconst PL = Vec.RotWith(int, point, PI / 6)\n\tconst PR = Vec.RotWith(int, point, -PI / 6)\n\n\treturn `M ${PL.x} ${PL.y} L ${point.x} ${point.y} L ${PR.x} ${PR.y} Z`\n}\n\nfunction getInvertedTriangleHead({ point, int }: TLArrowPointsInfo) {\n\tconst d = Vec.Sub(int, point).div(2)\n\tconst PL = Vec.Add(point, Vec.Rot(d, HALF_PI))\n\tconst PR = Vec.Sub(point, Vec.Rot(d, HALF_PI))\n\n\treturn `M ${PL.x} ${PL.y} L ${int.x} ${int.y} L ${PR.x} ${PR.y} Z`\n}\n\nfunction getDotHead({ point, int }: TLArrowPointsInfo) {\n\tconst A = Vec.Lrp(point, int, 0.45)\n\tconst r = Vec.Dist(A, point)\n\n\treturn `M ${A.x - r},${A.y}\n  a ${r},${r} 0 1,0 ${r * 2},0\n  a ${r},${r} 0 1,0 -${r * 2},0 `\n}\n\nfunction getDiamondHead({ point, int }: TLArrowPointsInfo) {\n\tconst PB = Vec.Lrp(point, int, 0.75)\n\tconst PL = Vec.RotWith(PB, point, PI / 4)\n\tconst PR = Vec.RotWith(PB, point, -PI / 4)\n\n\tconst PQ = Vec.Lrp(PL, PR, 0.5)\n\tPQ.add(Vec.Sub(PQ, point))\n\n\treturn `M ${PQ.x} ${PQ.y} L ${PL.x} ${PL.y} ${point.x} ${point.y} L ${PR.x} ${PR.y} Z`\n}\n\nfunction getSquareHead({ int, point }: TLArrowPointsInfo) {\n\tconst PB = Vec.Lrp(point, int, 0.85)\n\tconst d = Vec.Sub(PB, point).div(2)\n\tconst PL1 = Vec.Add(point, Vec.Rot(d, HALF_PI))\n\tconst PR1 = Vec.Sub(point, Vec.Rot(d, HALF_PI))\n\tconst PL2 = Vec.Add(PB, Vec.Rot(d, HALF_PI))\n\tconst PR2 = Vec.Sub(PB, Vec.Rot(d, HALF_PI))\n\n\treturn `M ${PL1.x} ${PL1.y} L ${PL2.x} ${PL2.y} L ${PR2.x} ${PR2.y} L ${PR1.x} ${PR1.y} Z`\n}\n\nfunction getBarHead({ int, point }: TLArrowPointsInfo) {\n\tconst d = Vec.Sub(int, point).div(2)\n\n\tconst PL = Vec.Add(point, Vec.Rot(d, HALF_PI))\n\tconst PR = Vec.Sub(point, Vec.Rot(d, HALF_PI))\n\n\treturn `M ${PL.x} ${PL.y} L ${PR.x} ${PR.y}`\n}\n\n/** @public */\nexport function getArrowheadPathForType(\n\tinfo: TLArrowInfo,\n\tside: 'start' | 'end',\n\tstrokeWidth: number\n): string | undefined {\n\tconst type = side === 'end' ? info.end.arrowhead : info.start.arrowhead\n\tif (type === 'none') return\n\n\tconst points = getArrowPoints(info, side, strokeWidth)\n\tif (!points) return\n\n\tswitch (type) {\n\t\tcase 'bar':\n\t\t\treturn getBarHead(points)\n\t\tcase 'square':\n\t\t\treturn getSquareHead(points)\n\t\tcase 'diamond':\n\t\t\treturn getDiamondHead(points)\n\t\tcase 'dot':\n\t\t\treturn getDotHead(points)\n\t\tcase 'inverted':\n\t\t\treturn getInvertedTriangleHead(points)\n\t\tcase 'arrow':\n\t\t\treturn getArrowhead(points)\n\t\tcase 'triangle':\n\t\t\treturn getTriangleHead(points)\n\t}\n\n\treturn ''\n}\n", "import { TLArrowInfo, VecLike } from '@tldraw/editor'\n\n/* --------------------- Curved --------------------- */\n\n/**\n * Get a solid path for a curved arrow's handles.\n *\n * @param info - The arrow info.\n * @public\n */\nexport function getCurvedArrowHandlePath(info: TLArrowInfo & { isStraight: false }) {\n\tconst {\n\t\tstart,\n\t\tend,\n\t\thandleArc: { radius, largeArcFlag, sweepFlag },\n\t} = info\n\treturn `M${start.handle.x},${start.handle.y} A${radius} ${radius} 0 ${largeArcFlag} ${sweepFlag} ${end.handle.x},${end.handle.y}`\n}\n\n/**\n * Get a solid path for a curved arrow's body.\n *\n * @param info - The arrow info.\n * @public\n */\nexport function getSolidCurvedArrowPath(info: TLArrowInfo & { isStraight: false }) {\n\tconst {\n\t\tstart,\n\t\tend,\n\t\tbodyArc: { radius, largeArcFlag, sweepFlag },\n\t} = info\n\treturn `M${start.point.x},${start.point.y} A${radius} ${radius} 0 ${largeArcFlag} ${sweepFlag} ${end.point.x},${end.point.y}`\n}\n\n/* -------------------- Straight -------------------- */\n\nfunction getArrowPath(start: VecLike, end: VecLike) {\n\treturn `M${start.x},${start.y}L${end.x},${end.y}`\n}\n\n/** @public */\nexport function getStraightArrowHandlePath(info: TLArrowInfo & { isStraight: true }) {\n\treturn getArrowPath(info.start.handle, info.end.handle)\n}\n\n/** @public */\nexport function getSolidStraightArrowPath(info: TLArrowInfo & { isStraight: true }) {\n\treturn getArrowPath(info.start.point, info.end.point)\n}\n", "import { TLArrowShape, TLDefaultColorStyle, TLShapeId, VecLike } from '@tldraw/editor'\nimport * as React from 'react'\nimport { useDefaultColorTheme } from '../../shared/ShapeFill'\nimport { TextLabel } from '../../shared/TextLabel'\nimport { ARROW_LABEL_FONT_SIZES, TEXT_PROPS } from '../../shared/default-shape-constants'\n\nexport const ArrowTextLabel = React.memo(function ArrowTextLabel({\n\tid,\n\ttext,\n\tsize,\n\tfont,\n\tposition,\n\twidth,\n\tisSelected,\n\tlabelColor,\n}: {\n\tid: TLShapeId\n\tposition: VecLike\n\twidth?: number\n\tlabelColor: TLDefaultColorStyle\n\tisSelected: boolean\n} & Pick<TLArrowShape['props'], 'text' | 'size' | 'font'>) {\n\tconst theme = useDefaultColorTheme()\n\treturn (\n\t\t<TextLabel\n\t\t\tid={id}\n\t\t\tclassNamePrefix=\"tl-arrow\"\n\t\t\ttype=\"arrow\"\n\t\t\tfont={font}\n\t\t\tfontSize={ARROW_LABEL_FONT_SIZES[size]}\n\t\t\tlineHeight={TEXT_PROPS.lineHeight}\n\t\t\talign=\"middle\"\n\t\t\tverticalAlign=\"middle\"\n\t\t\ttext={text}\n\t\t\tlabelColor={theme[labelColor].solid}\n\t\t\ttextWidth={width}\n\t\t\tisSelected={isSelected}\n\t\t\tstyle={{\n\t\t\t\ttransform: `translate(${position.x}px, ${position.y}px)`,\n\t\t\t}}\n\t\t/>\n\t)\n})\n", "import {\n\tBox,\n\tTLDefaultFillStyle,\n\tTLDefaultFontStyle,\n\tTLDefaultHorizontalAlignStyle,\n\tTLDefaultVerticalAlignStyle,\n\tTLShapeId,\n} from '@tldraw/editor'\nimport React, { useEffect, useState } from 'react'\nimport { TextArea } from '../text/TextArea'\nimport { TextHelpers } from './TextHelpers'\nimport { isLegacyAlign } from './legacyProps'\nimport { useEditableText } from './useEditableText'\n\ntype TextLabelProps = {\n\tid: TLShapeId\n\ttype: string\n\tfont: TLDefaultFontStyle\n\tfontSize: number\n\tlineHeight: number\n\tfill?: TLDefaultFillStyle\n\talign: TLDefaultHorizontalAlignStyle\n\tverticalAlign: TLDefaultVerticalAlignStyle\n\twrap?: boolean\n\ttext: string\n\tlabelColor: string\n\tbounds?: Box\n\tisNote?: boolean\n\tisSelected: boolean\n\tonKeyDown?: (e: React.KeyboardEvent<HTMLTextAreaElement>) => void\n\tclassNamePrefix?: string\n\tstyle?: React.CSSProperties\n\ttextWidth?: number\n\ttextHeight?: number\n}\n\n/** @public */\nexport const TextLabel = React.memo(function TextLabel({\n\tid,\n\ttype,\n\ttext,\n\tlabelColor,\n\tfont,\n\tfontSize,\n\tlineHeight,\n\talign,\n\tverticalAlign,\n\twrap,\n\tisSelected,\n\tonKeyDown: handleKeyDownCustom,\n\tclassNamePrefix,\n\tstyle,\n\ttextWidth,\n\ttextHeight,\n}: TextLabelProps) {\n\tconst { rInput, isEmpty, isEditing, isEditingAnything, ...editableTextRest } = useEditableText(\n\t\tid,\n\t\ttype,\n\t\ttext\n\t)\n\n\tconst [initialText, setInitialText] = useState(text)\n\n\tuseEffect(() => {\n\t\tif (!isEditing) setInitialText(text)\n\t}, [isEditing, text])\n\n\tconst finalText = TextHelpers.normalizeTextForDom(text)\n\tconst hasText = finalText.length > 0\n\n\tconst legacyAlign = isLegacyAlign(align)\n\n\tif (!isEditing && !hasText) {\n\t\treturn null\n\t}\n\n\t// TODO: probably combine tl-text and tl-arrow eventually\n\tconst cssPrefix = classNamePrefix || 'tl-text'\n\treturn (\n\t\t<div\n\t\t\tclassName={`${cssPrefix}-label tl-text-wrapper`}\n\t\t\tdata-font={font}\n\t\t\tdata-align={align}\n\t\t\tdata-hastext={!isEmpty}\n\t\t\tdata-isediting={isEditing}\n\t\t\tdata-iseditinganything={isEditingAnything}\n\t\t\tdata-textwrap={!!wrap}\n\t\t\tdata-isselected={isSelected}\n\t\t\tstyle={{\n\t\t\t\tjustifyContent: align === 'middle' || legacyAlign ? 'center' : align,\n\t\t\t\talignItems: verticalAlign === 'middle' ? 'center' : verticalAlign,\n\t\t\t\t...style,\n\t\t\t}}\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName={`${cssPrefix}-label__inner tl-text-content__wrapper`}\n\t\t\t\tstyle={{\n\t\t\t\t\tfontSize,\n\t\t\t\t\tlineHeight: fontSize * lineHeight + 'px',\n\t\t\t\t\tminHeight: lineHeight + 32,\n\t\t\t\t\tminWidth: textWidth || 0,\n\t\t\t\t\tcolor: labelColor,\n\t\t\t\t\twidth: textWidth,\n\t\t\t\t\theight: textHeight,\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div className={`${cssPrefix} tl-text tl-text-content`} dir=\"ltr\">\n\t\t\t\t\t{finalText}\n\t\t\t\t</div>\n\t\t\t\t{(isEditingAnything || isSelected) && (\n\t\t\t\t\t<TextArea\n\t\t\t\t\t\tref={rInput}\n\t\t\t\t\t\t// We need to add the initial value as the key here because we need this component to\n\t\t\t\t\t\t// 'reset' when this state changes and grab the latest defaultValue.\n\t\t\t\t\t\tkey={initialText}\n\t\t\t\t\t\ttext={text}\n\t\t\t\t\t\tisEditing={isEditing}\n\t\t\t\t\t\t{...editableTextRest}\n\t\t\t\t\t\thandleKeyDown={handleKeyDownCustom ?? editableTextRest.handleKeyDown}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t)\n})\n", "import { preventDefault, stopEventPropagation } from '@tldraw/editor'\nimport { forwardRef } from 'react'\n\ntype TextAreaProps = {\n\tisEditing: boolean\n\ttext: string\n\thandleFocus: () => void\n\thandleBlur: () => void\n\thandleKeyDown: (e: React.KeyboardEvent<HTMLTextAreaElement>) => void\n\thandleChange: (e: React.ChangeEvent<HTMLTextAreaElement>) => void\n\thandleInputPointerDown: (e: React.PointerEvent<HTMLTextAreaElement>) => void\n\thandleDoubleClick: (e: any) => any\n}\n\nexport const TextArea = forwardRef<HTMLTextAreaElement, TextAreaProps>(function TextArea(\n\t{\n\t\tisEditing,\n\t\ttext,\n\t\thandleFocus,\n\t\thandleChange,\n\t\thandleKeyDown,\n\t\thandleBlur,\n\t\thandleInputPointerDown,\n\t\thandleDoubleClick,\n\t},\n\tref\n) {\n\treturn (\n\t\t<textarea\n\t\t\tref={ref}\n\t\t\tclassName=\"tl-text tl-text-input\"\n\t\t\tname=\"text\"\n\t\t\ttabIndex={-1}\n\t\t\treadOnly={!isEditing}\n\t\t\tautoComplete=\"off\"\n\t\t\tautoCapitalize=\"off\"\n\t\t\tautoCorrect=\"off\"\n\t\t\tautoSave=\"off\"\n\t\t\t// autoFocus\n\t\t\tplaceholder=\"\"\n\t\t\tspellCheck=\"true\"\n\t\t\twrap=\"off\"\n\t\t\tdir=\"auto\"\n\t\t\tdatatype=\"wysiwyg\"\n\t\t\tdefaultValue={text}\n\t\t\tonFocus={handleFocus}\n\t\t\tonChange={handleChange}\n\t\t\tonKeyDown={handleKeyDown}\n\t\t\tonBlur={handleBlur}\n\t\t\tonTouchEnd={stopEventPropagation}\n\t\t\tonContextMenu={isEditing ? stopEventPropagation : undefined}\n\t\t\tonPointerDown={handleInputPointerDown}\n\t\t\tonDoubleClick={handleDoubleClick}\n\t\t\t// On FF, there's a behavior where dragging a selection will grab that selection into\n\t\t\t// the drag event. However, once the drag is over, and you select away from the textarea,\n\t\t\t// starting a drag over the textarea will restart a selection drag instead of a shape drag.\n\t\t\t// This prevents that default behavior in FF.\n\t\t\tonDragStart={preventDefault}\n\t\t/>\n\t)\n})\n", "import {\n\tTLShapeId,\n\tTLUnknownShape,\n\tgetPointerInfo,\n\tstopEventPropagation,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\nimport React, { useCallback, useEffect, useRef } from 'react'\nimport { INDENT, TextHelpers } from './TextHelpers'\n\n/** @public */\nexport function useEditableText(id: TLShapeId, type: string, text: string) {\n\tconst editor = useEditor()\n\tconst rInput = useRef<HTMLTextAreaElement>(null)\n\tconst rSelectionRanges = useRef<Range[] | null>()\n\tconst isEditing = useValue('isEditing', () => editor.getEditingShapeId() === id, [editor])\n\tconst isEditingAnything = useValue('isEditingAnything', () => !!editor.getEditingShapeId(), [\n\t\teditor,\n\t])\n\n\tuseEffect(() => {\n\t\tfunction selectAllIfEditing({ shapeId }: { shapeId: TLShapeId }) {\n\t\t\t// We wait a tick, because on iOS, the keyboard will not show if we focus immediately.\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tif (shapeId === id) {\n\t\t\t\t\tconst elm = rInput.current\n\t\t\t\t\tif (elm) {\n\t\t\t\t\t\tif (document.activeElement !== elm) {\n\t\t\t\t\t\t\telm.focus()\n\t\t\t\t\t\t}\n\t\t\t\t\t\telm.select()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\teditor.on('select-all-text', selectAllIfEditing)\n\t\treturn () => {\n\t\t\teditor.off('select-all-text', selectAllIfEditing)\n\t\t}\n\t}, [editor, id])\n\n\tuseEffect(() => {\n\t\tif (!isEditing) return\n\n\t\tconst elm = rInput.current\n\t\tif (!elm) return\n\n\t\t// Focus if we're not already focused\n\t\tif (document.activeElement !== elm) {\n\t\t\telm.focus()\n\n\t\t\t// On mobile etc, just select all the text when we start focusing\n\t\t\tif (editor.getInstanceState().isCoarsePointer) {\n\t\t\t\telm.select()\n\t\t\t}\n\t\t} else {\n\t\t\t// This fixes iOS not showing the cursor sometimes. This \"shakes\" the cursor\n\t\t\t// awake.\n\t\t\tif (editor.environment.isSafari) {\n\t\t\t\telm.blur()\n\t\t\t\telm.focus()\n\t\t\t}\n\t\t}\n\n\t\t// When the selection changes, save the selection ranges\n\t\tfunction updateSelection() {\n\t\t\tconst selection = window.getSelection?.()\n\t\t\tif (selection && selection.type !== 'None') {\n\t\t\t\tconst ranges: Range[] = []\n\t\t\t\tfor (let i = 0; i < selection.rangeCount; i++) {\n\t\t\t\t\tranges.push(selection.getRangeAt?.(i))\n\t\t\t\t}\n\t\t\t\trSelectionRanges.current = ranges\n\t\t\t}\n\t\t}\n\n\t\tdocument.addEventListener('selectionchange', updateSelection)\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('selectionchange', updateSelection)\n\t\t}\n\t}, [editor, isEditing])\n\n\t// 2. Restore the selection changes (and focus) if the element blurs\n\t// When the label blurs, deselect all of the text and complete.\n\t// This makes it so that the canvas does not have to be focused\n\t// in order to exit the editing state and complete the editing state\n\tconst handleBlur = useCallback(() => {\n\t\tconst ranges = rSelectionRanges.current\n\n\t\trequestAnimationFrame(() => {\n\t\t\tconst elm = rInput.current\n\t\t\tconst editingShapeId = editor.getEditingShapeId()\n\n\t\t\t// Did we move to a different shape?\n\t\t\tif (editingShapeId) {\n\t\t\t\t// important! these ^v are two different things\n\t\t\t\t// is that shape OUR shape?\n\t\t\t\tif (elm && editingShapeId === id) {\n\t\t\t\t\telm.focus()\n\n\t\t\t\t\tif (ranges && ranges.length) {\n\t\t\t\t\t\tconst selection = window.getSelection()\n\t\t\t\t\t\tif (selection) {\n\t\t\t\t\t\t\tranges.forEach((range) => selection.addRange(range))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.getSelection()?.removeAllRanges()\n\t\t\t}\n\t\t})\n\t}, [editor, id])\n\n\t// When the user presses ctrl / meta enter, complete the editing state.\n\tconst handleKeyDown = useCallback(\n\t\t(e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n\t\t\tif (editor.getEditingShapeId() !== id) return\n\n\t\t\tswitch (e.key) {\n\t\t\t\tcase 'Enter': {\n\t\t\t\t\tif (e.ctrlKey || e.metaKey) {\n\t\t\t\t\t\teditor.complete()\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[editor, id]\n\t)\n\n\t// When the text changes, update the text value.\n\tconst handleChange = useCallback(\n\t\t(e: React.ChangeEvent<HTMLTextAreaElement>) => {\n\t\t\tif (editor.getEditingShapeId() !== id) return\n\n\t\t\tlet text = TextHelpers.normalizeText(e.currentTarget.value)\n\n\t\t\t// ------- Bug fix ------------\n\t\t\t// Replace tabs with spaces when pasting\n\t\t\tconst untabbedText = text.replace(/\\t/g, INDENT)\n\t\t\tif (untabbedText !== text) {\n\t\t\t\tconst selectionStart = e.currentTarget.selectionStart\n\t\t\t\te.currentTarget.value = untabbedText\n\t\t\t\te.currentTarget.selectionStart = selectionStart + (untabbedText.length - text.length)\n\t\t\t\te.currentTarget.selectionEnd = selectionStart + (untabbedText.length - text.length)\n\t\t\t\ttext = untabbedText\n\t\t\t}\n\t\t\t// ----------------------------\n\n\t\t\teditor.updateShape<TLUnknownShape & { props: { text: string } }>({\n\t\t\t\tid,\n\t\t\t\ttype,\n\t\t\t\tprops: { text },\n\t\t\t})\n\t\t},\n\t\t[editor, id, type]\n\t)\n\n\tconst handleInputPointerDown = useCallback(\n\t\t(e: React.PointerEvent) => {\n\t\t\t// N.B. We used to only do this only when isEditing to help\n\t\t\t// prevent an issue where you could drag a selected shape\n\t\t\t// behind another shape. That is addressed now by the CSS logic\n\t\t\t// looking at data-isselectinganything.\n\t\t\t//\n\t\t\t// We still need to follow this logic even if not isEditing\n\t\t\t// because otherwise there is some flakiness in selection.\n\t\t\t// When selecting text, it would sometimes select some text\n\t\t\t// partially if we didn't dispatch/stop below.\n\n\t\t\teditor.dispatch({\n\t\t\t\t...getPointerInfo(e),\n\t\t\t\ttype: 'pointer',\n\t\t\t\tname: 'pointer_down',\n\t\t\t\ttarget: 'shape',\n\t\t\t\tshape: editor.getShape(id)!,\n\t\t\t})\n\n\t\t\tstopEventPropagation(e) // we need to prevent blurring the input\n\t\t},\n\t\t[editor, id]\n\t)\n\n\treturn {\n\t\trInput,\n\t\thandleFocus: noop,\n\t\thandleBlur,\n\t\thandleKeyDown,\n\t\thandleChange,\n\t\thandleInputPointerDown,\n\t\thandleDoubleClick: stopEventPropagation,\n\t\tisEmpty: text.trim().length === 0,\n\t\tisEditing,\n\t\tisEditingAnything,\n\t}\n}\n\nfunction noop() {\n\treturn\n}\n", "import {\n\tAssetRecordType,\n\tBaseBoxShapeUtil,\n\tEditor,\n\tHTMLContainer,\n\tT,\n\tTLAssetId,\n\tTLBookmarkAsset,\n\tTLBookmarkShape,\n\tTLOnBeforeCreateHandler,\n\tTLOnBeforeUpdateHandler,\n\tbookmarkShapeMigrations,\n\tbookmarkShapeProps,\n\tdebounce,\n\tgetHashForString,\n\tstopEventPropagation,\n\ttoDomPrecision,\n} from '@tldraw/editor'\nimport { truncateStringWithEllipsis } from '../../utils/text/text'\nimport { HyperlinkButton } from '../shared/HyperlinkButton'\nimport { getRotatedBoxShadow } from '../shared/rotated-box-shadow'\n\n/** @public */\nexport class BookmarkShapeUtil extends BaseBoxShapeUtil<TLBookmarkShape> {\n\tstatic override type = 'bookmark' as const\n\tstatic override props = bookmarkShapeProps\n\tstatic override migrations = bookmarkShapeMigrations\n\n\toverride canResize = () => false\n\n\toverride hideSelectionBoundsFg = () => true\n\n\toverride getDefaultProps(): TLBookmarkShape['props'] {\n\t\treturn {\n\t\t\turl: '',\n\t\t\tw: 300,\n\t\t\th: 320,\n\t\t\tassetId: null,\n\t\t}\n\t}\n\n\toverride component(shape: TLBookmarkShape) {\n\t\tconst asset = (\n\t\t\tshape.props.assetId ? this.editor.getAsset(shape.props.assetId) : null\n\t\t) as TLBookmarkAsset\n\n\t\tconst pageRotation = this.editor.getShapePageTransform(shape)!.rotation()\n\n\t\tconst address = getHumanReadableAddress(shape)\n\n\t\treturn (\n\t\t\t<HTMLContainer>\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"tl-bookmark__container\"\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tboxShadow: getRotatedBoxShadow(pageRotation),\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"tl-bookmark__image_container\">\n\t\t\t\t\t\t{asset?.props.image ? (\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tclassName=\"tl-bookmark__image\"\n\t\t\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\t\t\tsrc={asset?.props.image}\n\t\t\t\t\t\t\t\talt={asset?.props.title || ''}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"tl-bookmark__placeholder\" />\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<HyperlinkButton url={shape.props.url} zoomLevel={this.editor.getZoomLevel()} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"tl-bookmark__copy_container\">\n\t\t\t\t\t\t{asset?.props.title && (\n\t\t\t\t\t\t\t<h2 className=\"tl-bookmark__heading\">\n\t\t\t\t\t\t\t\t{truncateStringWithEllipsis(asset?.props.title || '', 54)}\n\t\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{asset?.props.description && (\n\t\t\t\t\t\t\t<p className=\"tl-bookmark__description\">\n\t\t\t\t\t\t\t\t{truncateStringWithEllipsis(asset?.props.description || '', 128)}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tclassName=\"tl-bookmark__link\"\n\t\t\t\t\t\t\thref={shape.props.url || ''}\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\tonPointerDown={stopEventPropagation}\n\t\t\t\t\t\t\tonPointerUp={stopEventPropagation}\n\t\t\t\t\t\t\tonClick={stopEventPropagation}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{truncateStringWithEllipsis(address, 45)}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</HTMLContainer>\n\t\t)\n\t}\n\n\toverride indicator(shape: TLBookmarkShape) {\n\t\treturn (\n\t\t\t<rect\n\t\t\t\twidth={toDomPrecision(shape.props.w)}\n\t\t\t\theight={toDomPrecision(shape.props.h)}\n\t\t\t\trx=\"6\"\n\t\t\t\try=\"6\"\n\t\t\t/>\n\t\t)\n\t}\n\n\toverride onBeforeCreate?: TLOnBeforeCreateHandler<TLBookmarkShape> = (shape) => {\n\t\tupdateBookmarkAssetOnUrlChange(this.editor, shape)\n\t}\n\n\toverride onBeforeUpdate?: TLOnBeforeUpdateHandler<TLBookmarkShape> = (prev, shape) => {\n\t\tif (prev.props.url !== shape.props.url) {\n\t\t\tif (!T.linkUrl.isValid(shape.props.url)) {\n\t\t\t\treturn { ...shape, props: { ...shape.props, url: prev.props.url } }\n\t\t\t} else {\n\t\t\t\tupdateBookmarkAssetOnUrlChange(this.editor, shape)\n\t\t\t}\n\t\t}\n\t}\n}\n\n/** @internal */\nexport const getHumanReadableAddress = (shape: TLBookmarkShape) => {\n\ttry {\n\t\tconst url = new URL(shape.props.url)\n\t\tconst path = url.pathname.replace(/\\/*$/, '')\n\t\treturn `${url.hostname}${path}`\n\t} catch (e) {\n\t\treturn shape.props.url\n\t}\n}\n\nfunction updateBookmarkAssetOnUrlChange(editor: Editor, shape: TLBookmarkShape) {\n\tconst { url } = shape.props\n\n\t// Derive the asset id from the URL\n\tconst assetId: TLAssetId = AssetRecordType.createId(getHashForString(url))\n\n\tif (editor.getAsset(assetId)) {\n\t\t// Existing asset for this URL?\n\t\tif (shape.props.assetId !== assetId) {\n\t\t\teditor.updateShapes<TLBookmarkShape>([\n\t\t\t\t{\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: shape.type,\n\t\t\t\t\tprops: { assetId },\n\t\t\t\t},\n\t\t\t])\n\t\t}\n\t} else {\n\t\t// No asset for this URL?\n\n\t\t// First, clear out the existing asset reference\n\t\teditor.updateShapes<TLBookmarkShape>([\n\t\t\t{\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tprops: { assetId: null },\n\t\t\t},\n\t\t])\n\n\t\t// Then try to asyncronously create a new one\n\t\tcreateBookmarkAssetOnUrlChange(editor, shape)\n\t}\n}\n\nconst createBookmarkAssetOnUrlChange = debounce(async (editor: Editor, shape: TLBookmarkShape) => {\n\tconst { url } = shape.props\n\n\t// Create the asset using the external content manager's createAssetFromUrl method.\n\t// This may be overwritten by the user (for example, we overwrite it on tldraw.com)\n\tconst asset = await editor.getAssetForExternalContent({ type: 'url', url })\n\n\tif (!asset) {\n\t\t// No asset? Just leave the bookmark as a null assetId.\n\t\treturn\n\t}\n\n\teditor.batch(() => {\n\t\t// Create the new asset\n\t\teditor.createAssets([asset])\n\n\t\t// And update the shape\n\t\teditor.updateShapes<TLBookmarkShape>([\n\t\t\t{\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tprops: { assetId: asset.id },\n\t\t\t},\n\t\t])\n\t})\n}, 500)\n", "import { stopEventPropagation } from '@tldraw/editor'\nimport classNames from 'classnames'\n\nconst LINK_ICON =\n\t\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E\"\n\nexport function HyperlinkButton({ url, zoomLevel }: { url: string; zoomLevel: number }) {\n\treturn (\n\t\t<a\n\t\t\tclassName={classNames('tl-hyperlink-button', {\n\t\t\t\t'tl-hyperlink-button__hidden': zoomLevel < 0.32,\n\t\t\t})}\n\t\t\thref={url}\n\t\t\ttarget=\"_blank\"\n\t\t\trel=\"noopener noreferrer\"\n\t\t\tonPointerDown={stopEventPropagation}\n\t\t\tonPointerUp={stopEventPropagation}\n\t\t\ttitle={url}\n\t\t\tdraggable={false}\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName=\"tl-hyperlink-button__icon\"\n\t\t\t\tstyle={{\n\t\t\t\t\tmask: `url(\"${LINK_ICON}\") center 100% / 100% no-repeat`,\n\t\t\t\t\tWebkitMask: `url(\"${LINK_ICON}\") center 100% / 100% no-repeat`,\n\t\t\t\t}}\n\t\t\t/>\n\t\t</a>\n\t)\n}\n", "import { Vec } from '@tldraw/editor'\n\nconst ROTATING_BOX_SHADOWS = [\n\t{\n\t\toffsetX: 0,\n\t\toffsetY: 2,\n\t\tblur: 4,\n\t\tspread: 0,\n\t\tcolor: '#00000029',\n\t},\n\t{\n\t\toffsetX: 0,\n\t\toffsetY: 3,\n\t\tblur: 6,\n\t\tspread: 0,\n\t\tcolor: '#0000001f',\n\t},\n]\n\n/** @public */\nexport function getRotatedBoxShadow(rotation: number) {\n\tconst cssStrings = ROTATING_BOX_SHADOWS.map((shadow) => {\n\t\tconst { offsetX, offsetY, blur, spread, color } = shadow\n\t\tconst vec = new Vec(offsetX, offsetY)\n\t\tconst { x, y } = vec.rot(-rotation)\n\t\treturn `${x}px ${y}px ${blur}px ${spread}px ${color}`\n\t})\n\treturn cssStrings.join(', ')\n}\n", "/* eslint-disable react-hooks/rules-of-hooks */\nimport {\n\tBox,\n\tCircle2d,\n\tPolygon2d,\n\tPolyline2d,\n\tSVGContainer,\n\tShapeUtil,\n\tSvgExportContext,\n\tTLDrawShape,\n\tTLDrawShapeSegment,\n\tTLOnResizeHandler,\n\tTLShapeUtilCanvasSvgDef,\n\tVecLike,\n\tdrawShapeMigrations,\n\tdrawShapeProps,\n\tlast,\n\trng,\n\ttoFixed,\n} from '@tldraw/editor'\nimport { ShapeFill, useDefaultColorTheme } from '../shared/ShapeFill'\nimport { STROKE_SIZES } from '../shared/default-shape-constants'\nimport { getFillDefForCanvas, getFillDefForExport } from '../shared/defaultStyleDefs'\nimport { getStrokePoints } from '../shared/freehand/getStrokePoints'\nimport { getSvgPathFromStrokePoints } from '../shared/freehand/svg'\nimport { svgInk } from '../shared/freehand/svgInk'\nimport { useForceSolid } from '../shared/useForceSolid'\nimport { getDrawShapeStrokeDashArray, getFreehandOptions, getPointsFromSegments } from './getPath'\n\n/** @public */\nexport class DrawShapeUtil extends ShapeUtil<TLDrawShape> {\n\tstatic override type = 'draw' as const\n\tstatic override props = drawShapeProps\n\tstatic override migrations = drawShapeMigrations\n\n\toverride hideResizeHandles = (shape: TLDrawShape) => getIsDot(shape)\n\toverride hideRotateHandle = (shape: TLDrawShape) => getIsDot(shape)\n\toverride hideSelectionBoundsFg = (shape: TLDrawShape) => getIsDot(shape)\n\n\toverride getDefaultProps(): TLDrawShape['props'] {\n\t\treturn {\n\t\t\tsegments: [],\n\t\t\tcolor: 'black',\n\t\t\tfill: 'none',\n\t\t\tdash: 'draw',\n\t\t\tsize: 'm',\n\t\t\tisComplete: false,\n\t\t\tisClosed: false,\n\t\t\tisPen: false,\n\t\t}\n\t}\n\n\tgetGeometry(shape: TLDrawShape) {\n\t\tconst points = getPointsFromSegments(shape.props.segments)\n\t\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\n\t\t// A dot\n\t\tif (shape.props.segments.length === 1) {\n\t\t\tconst box = Box.FromPoints(points)\n\t\t\tif (box.width < strokeWidth * 2 && box.height < strokeWidth * 2) {\n\t\t\t\treturn new Circle2d({\n\t\t\t\t\tx: -strokeWidth,\n\t\t\t\t\ty: -strokeWidth,\n\t\t\t\t\tradius: strokeWidth,\n\t\t\t\t\tisFilled: true,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tconst strokePoints = getStrokePoints(\n\t\t\tpoints,\n\t\t\tgetFreehandOptions(shape.props, strokeWidth, true, true)\n\t\t).map((p) => p.point)\n\n\t\t// A closed draw stroke\n\t\tif (shape.props.isClosed) {\n\t\t\treturn new Polygon2d({\n\t\t\t\tpoints: strokePoints,\n\t\t\t\tisFilled: shape.props.fill !== 'none',\n\t\t\t})\n\t\t}\n\n\t\t// An open draw stroke\n\t\treturn new Polyline2d({\n\t\t\tpoints: strokePoints,\n\t\t})\n\t}\n\n\tcomponent(shape: TLDrawShape) {\n\t\treturn (\n\t\t\t<SVGContainer id={shape.id}>\n\t\t\t\t<DrawShapeSvg shape={shape} forceSolid={useForceSolid()} />\n\t\t\t</SVGContainer>\n\t\t)\n\t}\n\n\tindicator(shape: TLDrawShape) {\n\t\tconst forceSolid = useForceSolid()\n\t\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\t\tconst allPointsFromSegments = getPointsFromSegments(shape.props.segments)\n\n\t\tlet sw = strokeWidth\n\t\tif (\n\t\t\t!forceSolid &&\n\t\t\t!shape.props.isPen &&\n\t\t\tshape.props.dash === 'draw' &&\n\t\t\tallPointsFromSegments.length === 1\n\t\t) {\n\t\t\tsw += rng(shape.id)() * (strokeWidth / 6)\n\t\t}\n\n\t\tconst showAsComplete = shape.props.isComplete || last(shape.props.segments)?.type === 'straight'\n\t\tconst options = getFreehandOptions(shape.props, sw, showAsComplete, true)\n\t\tconst strokePoints = getStrokePoints(allPointsFromSegments, options)\n\t\tconst solidStrokePath =\n\t\t\tstrokePoints.length > 1\n\t\t\t\t? getSvgPathFromStrokePoints(strokePoints, shape.props.isClosed)\n\t\t\t\t: getDot(allPointsFromSegments[0], sw)\n\n\t\treturn <path d={solidStrokePath} />\n\t}\n\n\toverride toSvg(shape: TLDrawShape, ctx: SvgExportContext) {\n\t\tctx.addExportDef(getFillDefForExport(shape.props.fill))\n\t\treturn <DrawShapeSvg shape={shape} forceSolid={false} />\n\t}\n\n\toverride getCanvasSvgDefs(): TLShapeUtilCanvasSvgDef[] {\n\t\treturn [getFillDefForCanvas()]\n\t}\n\n\toverride onResize: TLOnResizeHandler<TLDrawShape> = (shape, info) => {\n\t\tconst { scaleX, scaleY } = info\n\n\t\tconst newSegments: TLDrawShapeSegment[] = []\n\n\t\tfor (const segment of shape.props.segments) {\n\t\t\tnewSegments.push({\n\t\t\t\t...segment,\n\t\t\t\tpoints: segment.points.map(({ x, y, z }) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tx: toFixed(scaleX * x),\n\t\t\t\t\t\ty: toFixed(scaleY * y),\n\t\t\t\t\t\tz,\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t})\n\t\t}\n\n\t\treturn {\n\t\t\tprops: {\n\t\t\t\tsegments: newSegments,\n\t\t\t},\n\t\t}\n\t}\n\n\toverride expandSelectionOutlinePx(shape: TLDrawShape): number {\n\t\tconst multiplier = shape.props.dash === 'draw' ? 1.6 : 1\n\t\treturn (STROKE_SIZES[shape.props.size] * multiplier) / 2\n\t}\n}\n\nfunction getDot(point: VecLike, sw: number) {\n\tconst r = (sw + 1) * 0.5\n\treturn `M ${point.x} ${point.y} m -${r}, 0 a ${r},${r} 0 1,0 ${r * 2},0 a ${r},${r} 0 1,0 -${\n\t\tr * 2\n\t},0`\n}\n\nfunction getIsDot(shape: TLDrawShape) {\n\treturn shape.props.segments.length === 1 && shape.props.segments[0].points.length < 2\n}\n\nfunction DrawShapeSvg({ shape, forceSolid }: { shape: TLDrawShape; forceSolid: boolean }) {\n\tconst theme = useDefaultColorTheme()\n\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\tconst allPointsFromSegments = getPointsFromSegments(shape.props.segments)\n\n\tconst showAsComplete = shape.props.isComplete || last(shape.props.segments)?.type === 'straight'\n\n\tlet sw = strokeWidth\n\tif (\n\t\t!forceSolid &&\n\t\t!shape.props.isPen &&\n\t\tshape.props.dash === 'draw' &&\n\t\tallPointsFromSegments.length === 1\n\t) {\n\t\tsw += rng(shape.id)() * (strokeWidth / 6)\n\t}\n\n\tconst options = getFreehandOptions(shape.props, sw, showAsComplete, forceSolid)\n\n\tif (!forceSolid && shape.props.dash === 'draw') {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{shape.props.isClosed && shape.props.fill && allPointsFromSegments.length > 1 ? (\n\t\t\t\t\t<ShapeFill\n\t\t\t\t\t\ttheme={theme}\n\t\t\t\t\t\tfill={shape.props.isClosed ? shape.props.fill : 'none'}\n\t\t\t\t\t\tcolor={shape.props.color}\n\t\t\t\t\t\td={getSvgPathFromStrokePoints(\n\t\t\t\t\t\t\tgetStrokePoints(allPointsFromSegments, options),\n\t\t\t\t\t\t\tshape.props.isClosed\n\t\t\t\t\t\t)}\n\t\t\t\t\t/>\n\t\t\t\t) : null}\n\t\t\t\t<path\n\t\t\t\t\td={svgInk(allPointsFromSegments, options)}\n\t\t\t\t\tstrokeLinecap=\"round\"\n\t\t\t\t\tfill={theme[shape.props.color].solid}\n\t\t\t\t/>\n\t\t\t</>\n\t\t)\n\t}\n\n\tconst strokePoints = getStrokePoints(allPointsFromSegments, options)\n\tconst isDot = strokePoints.length < 2\n\tconst solidStrokePath = isDot\n\t\t? getDot(allPointsFromSegments[0], 0)\n\t\t: getSvgPathFromStrokePoints(strokePoints, shape.props.isClosed)\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill\n\t\t\t\ttheme={theme}\n\t\t\t\tcolor={shape.props.color}\n\t\t\t\tfill={isDot || shape.props.isClosed ? shape.props.fill : 'none'}\n\t\t\t\td={solidStrokePath}\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td={solidStrokePath}\n\t\t\t\tstrokeLinecap=\"round\"\n\t\t\t\tfill={isDot ? theme[shape.props.color].solid : 'none'}\n\t\t\t\tstroke={theme[shape.props.color].solid}\n\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\tstrokeDasharray={isDot ? 'none' : getDrawShapeStrokeDashArray(shape, strokeWidth)}\n\t\t\t\tstrokeDashoffset=\"0\"\n\t\t\t/>\n\t\t</>\n\t)\n}\n", "import { average, precise } from '@tldraw/editor'\nimport { StrokePoint } from './types'\n\n/**\n * Turn an array of stroke points into a path of quadradic curves.\n *\n * @param points - The stroke points returned from perfect-freehand\n * @param closed - Whether the shape is closed\n */\nexport function getSvgPathFromStrokePoints(points: StrokePoint[], closed = false): string {\n\tconst len = points.length\n\n\tif (len < 2) {\n\t\treturn ''\n\t}\n\n\tlet a = points[0].point\n\tlet b = points[1].point\n\n\tif (len === 2) {\n\t\treturn `M${precise(a)}L${precise(b)}`\n\t}\n\n\tlet result = ''\n\n\tfor (let i = 2, max = len - 1; i < max; i++) {\n\t\ta = points[i].point\n\t\tb = points[i + 1].point\n\t\tresult += average(a, b)\n\t}\n\n\tif (closed) {\n\t\t// If closed, draw a curve from the last point to the first\n\t\treturn `M${average(points[0].point, points[1].point)}Q${precise(points[1].point)}${average(\n\t\t\tpoints[1].point,\n\t\t\tpoints[2].point\n\t\t)}T${result}${average(points[len - 1].point, points[0].point)}${average(\n\t\t\tpoints[0].point,\n\t\t\tpoints[1].point\n\t\t)}Z`\n\t} else {\n\t\t// If not closed, draw a curve starting at the first point and\n\t\t// ending at the midpoint of the last and second-last point, then\n\t\t// complete the curve with a line segment to the last point.\n\t\treturn `M${precise(points[0].point)}Q${precise(points[1].point)}${average(\n\t\t\tpoints[1].point,\n\t\t\tpoints[2].point\n\t\t)}${points.length > 3 ? 'T' : ''}${result}L${precise(points[len - 1].point)}`\n\t}\n}\n", "import { Vec, VecLike, assert, average, precise, toDomPrecision } from '@tldraw/editor'\nimport { getStrokeOutlineTracks } from './getStrokeOutlinePoints'\nimport { getStrokePoints } from './getStrokePoints'\nimport { setStrokePointRadii } from './setStrokePointRadii'\nimport { StrokeOptions, StrokePoint } from './types'\n\nexport function svgInk(rawInputPoints: VecLike[], options: StrokeOptions = {}) {\n\tconst { start = {}, end = {} } = options\n\tconst { cap: capStart = true } = start\n\tconst { cap: capEnd = true } = end\n\tassert(!start.taper && !end.taper, 'cap taper not supported here')\n\tassert(!start.easing && !end.easing, 'cap easing not supported here')\n\tassert(capStart && capEnd, 'cap must be true')\n\n\tconst points = getStrokePoints(rawInputPoints, options)\n\tsetStrokePointRadii(points, options)\n\tconst partitions = partitionAtElbows(points)\n\tlet svg = ''\n\tfor (const partition of partitions) {\n\t\tsvg += renderPartition(partition, options)\n\t}\n\n\treturn svg\n}\n\nfunction partitionAtElbows(points: StrokePoint[]): StrokePoint[][] {\n\tif (points.length <= 2) return [points]\n\n\tconst result: StrokePoint[][] = []\n\tlet currentPartition: StrokePoint[] = [points[0]]\n\tlet prevV = Vec.Sub(points[1].point, points[0].point).uni()\n\tlet nextV: Vec\n\tlet dpr: number\n\tlet prevPoint: StrokePoint, thisPoint: StrokePoint, nextPoint: StrokePoint\n\tfor (let i = 1, n = points.length; i < n - 1; i++) {\n\t\tprevPoint = points[i - 1]\n\t\tthisPoint = points[i]\n\t\tnextPoint = points[i + 1]\n\n\t\tnextV = Vec.Sub(nextPoint.point, thisPoint.point).uni()\n\t\tdpr = Vec.Dpr(prevV, nextV)\n\t\tprevV = nextV\n\n\t\tif (dpr < -0.8) {\n\t\t\t// always treat such acute angles as elbows\n\t\t\t// and use the extended .input point as the elbow point for swooshiness in fast zaggy lines\n\t\t\tconst elbowPoint = {\n\t\t\t\t...thisPoint,\n\t\t\t\tpoint: thisPoint.input,\n\t\t\t}\n\t\t\tcurrentPartition.push(elbowPoint)\n\t\t\tresult.push(cleanUpPartition(currentPartition))\n\t\t\tcurrentPartition = [elbowPoint]\n\t\t\tcontinue\n\t\t}\n\t\tcurrentPartition.push(thisPoint)\n\n\t\tif (dpr > 0.7) {\n\t\t\t// Not an elbow\n\t\t\tcontinue\n\t\t}\n\n\t\t// so now we have a reasonably acute angle but it might not be an elbow if it's far\n\t\t// away from it's neighbors, angular dist is a normalized representation of how far away the point is from it's neighbors\n\t\t// (normalized by the radius)\n\t\tif (\n\t\t\t(Vec.Dist2(prevPoint.point, thisPoint.point) + Vec.Dist2(thisPoint.point, nextPoint.point)) /\n\t\t\t\t((prevPoint.radius + thisPoint.radius + nextPoint.radius) / 3) ** 2 <\n\t\t\t1.5\n\t\t) {\n\t\t\t// if this point is kinda close to its neighbors and it has a reasonably\n\t\t\t// acute angle, it's probably a hard elbow\n\t\t\tcurrentPartition.push(thisPoint)\n\t\t\tresult.push(cleanUpPartition(currentPartition))\n\t\t\tcurrentPartition = [thisPoint]\n\t\t\tcontinue\n\t\t}\n\t}\n\tcurrentPartition.push(points[points.length - 1])\n\tresult.push(cleanUpPartition(currentPartition))\n\n\treturn result\n}\n\nfunction cleanUpPartition(partition: StrokePoint[]) {\n\t// clean up start of partition (remove points that are too close to the start)\n\tconst startPoint = partition[0]\n\tlet nextPoint: StrokePoint\n\twhile (partition.length > 2) {\n\t\tnextPoint = partition[1]\n\t\tif (\n\t\t\tVec.Dist2(startPoint.point, nextPoint.point) <\n\t\t\t(((startPoint.radius + nextPoint.radius) / 2) * 0.5) ** 2\n\t\t) {\n\t\t\tpartition.splice(1, 1)\n\t\t} else {\n\t\t\tbreak\n\t\t}\n\t}\n\t// clean up end of partition in the same fashion\n\tconst endPoint = partition[partition.length - 1]\n\tlet prevPoint: StrokePoint\n\twhile (partition.length > 2) {\n\t\tprevPoint = partition[partition.length - 2]\n\t\tif (\n\t\t\tVec.Dist2(endPoint.point, prevPoint.point) <\n\t\t\t(((endPoint.radius + prevPoint.radius) / 2) * 0.5) ** 2\n\t\t) {\n\t\t\tpartition.splice(partition.length - 2, 1)\n\t\t} else {\n\t\t\tbreak\n\t\t}\n\t}\n\t// now readjust the cap point vectors to point to their nearest neighbors\n\tif (partition.length > 1) {\n\t\tpartition[0] = {\n\t\t\t...partition[0],\n\t\t\tvector: Vec.Sub(partition[0].point, partition[1].point).uni(),\n\t\t}\n\t\tpartition[partition.length - 1] = {\n\t\t\t...partition[partition.length - 1],\n\t\t\tvector: Vec.Sub(\n\t\t\t\tpartition[partition.length - 2].point,\n\t\t\t\tpartition[partition.length - 1].point\n\t\t\t).uni(),\n\t\t}\n\t}\n\treturn partition\n}\n\nfunction circlePath(cx: number, cy: number, r: number) {\n\treturn (\n\t\t'M ' +\n\t\tcx +\n\t\t' ' +\n\t\tcy +\n\t\t' m -' +\n\t\tr +\n\t\t', 0 a ' +\n\t\tr +\n\t\t',' +\n\t\tr +\n\t\t' 0 1,1 ' +\n\t\tr * 2 +\n\t\t',0 a ' +\n\t\tr +\n\t\t',' +\n\t\tr +\n\t\t' 0 1,1 -' +\n\t\tr * 2 +\n\t\t',0'\n\t)\n}\n\nfunction renderPartition(strokePoints: StrokePoint[], options: StrokeOptions = {}): string {\n\tif (strokePoints.length === 0) return ''\n\tif (strokePoints.length === 1) {\n\t\treturn circlePath(strokePoints[0].point.x, strokePoints[0].point.y, strokePoints[0].radius)\n\t}\n\n\tconst { left, right } = getStrokeOutlineTracks(strokePoints, options)\n\tright.reverse()\n\tlet svg = `M${precise(left[0])}T`\n\n\t// draw left track\n\tfor (let i = 1; i < left.length; i++) {\n\t\tsvg += average(left[i - 1], left[i])\n\t}\n\t// draw end cap arc\n\t{\n\t\tconst point = strokePoints[strokePoints.length - 1]\n\t\tconst radius = point.radius\n\t\tconst direction = point.vector.clone().per().neg()\n\t\tconst arcStart = Vec.Add(point.point, Vec.Mul(direction, radius))\n\t\tconst arcEnd = Vec.Add(point.point, Vec.Mul(direction, -radius))\n\t\tsvg += `${precise(arcStart)}A${toDomPrecision(radius)},${toDomPrecision(\n\t\t\tradius\n\t\t)} 0 0 1 ${precise(arcEnd)}T`\n\t}\n\t// draw right track\n\tfor (let i = 1; i < right.length; i++) {\n\t\tsvg += average(right[i - 1], right[i])\n\t}\n\t// draw start cap arc\n\t{\n\t\tconst point = strokePoints[0]\n\t\tconst radius = point.radius\n\t\tconst direction = point.vector.clone().per()\n\t\tconst arcStart = Vec.Add(point.point, Vec.Mul(direction, radius))\n\t\tconst arcEnd = Vec.Add(point.point, Vec.Mul(direction, -radius))\n\t\tsvg += `${precise(arcStart)}A${toDomPrecision(radius)},${toDomPrecision(\n\t\t\tradius\n\t\t)} 0 0 1 ${precise(arcEnd)}Z`\n\t}\n\treturn svg\n}\n", "import { useEditor, useValue } from '@tldraw/editor'\n\nexport function useForceSolid() {\n\tconst editor = useEditor()\n\treturn useValue('zoom', () => editor.getZoomLevel() < 0.35, [editor])\n}\n", "import {\n\tEASINGS,\n\tPI,\n\tSIN,\n\tTLDefaultDashStyle,\n\tTLDrawShape,\n\tTLDrawShapeSegment,\n\tVec,\n} from '@tldraw/editor'\nimport { StrokeOptions } from '../shared/freehand/types'\n\nconst PEN_EASING = (t: number) => t * 0.65 + SIN((t * PI) / 2) * 0.35\n\nconst simulatePressureSettings = (strokeWidth: number): StrokeOptions => {\n\treturn {\n\t\tsize: 1 + strokeWidth,\n\t\tthinning: 0.5,\n\t\tstreamline: 0.62 + ((1 + strokeWidth) / 8) * 0.06,\n\t\tsmoothing: 0.62,\n\t\teasing: EASINGS.easeOutSine,\n\t\tsimulatePressure: true,\n\t}\n}\n\nconst realPressureSettings = (strokeWidth: number): StrokeOptions => {\n\treturn {\n\t\tsize: 1 + strokeWidth * 1.2,\n\t\tthinning: 0.62,\n\t\tstreamline: 0.62,\n\t\tsmoothing: 0.62,\n\t\tsimulatePressure: false,\n\t\teasing: PEN_EASING,\n\t}\n}\n\nconst solidSettings = (strokeWidth: number): StrokeOptions => {\n\treturn {\n\t\tsize: 1 + strokeWidth,\n\t\tthinning: 0,\n\t\tstreamline: 0.62 + ((1 + strokeWidth) / 8) * 0.06,\n\t\tsmoothing: 0.62,\n\t\tsimulatePressure: false,\n\t\teasing: EASINGS.linear,\n\t}\n}\n\nexport function getHighlightFreehandSettings({\n\tstrokeWidth,\n\tshowAsComplete,\n}: {\n\tstrokeWidth: number\n\tshowAsComplete: boolean\n}): StrokeOptions {\n\treturn {\n\t\tsize: 1 + strokeWidth,\n\t\tthinning: 0,\n\t\tstreamline: 0.5,\n\t\tsmoothing: 0.5,\n\t\tsimulatePressure: false,\n\t\teasing: EASINGS.easeOutSine,\n\t\tlast: showAsComplete,\n\t}\n}\n\nexport function getFreehandOptions(\n\tshapeProps: { dash: TLDefaultDashStyle; isPen: boolean; isComplete: boolean },\n\tstrokeWidth: number,\n\tforceComplete: boolean,\n\tforceSolid: boolean\n): StrokeOptions {\n\treturn {\n\t\t...(forceSolid\n\t\t\t? solidSettings(strokeWidth)\n\t\t\t: shapeProps.dash === 'draw'\n\t\t\t\t? shapeProps.isPen\n\t\t\t\t\t? realPressureSettings(strokeWidth)\n\t\t\t\t\t: simulatePressureSettings(strokeWidth)\n\t\t\t\t: solidSettings(strokeWidth)),\n\t\tlast: shapeProps.isComplete || forceComplete,\n\t}\n}\n\nexport function getPointsFromSegments(segments: TLDrawShapeSegment[]) {\n\tconst points: Vec[] = []\n\n\tfor (const segment of segments) {\n\t\tif (segment.type === 'free' || segment.points.length < 2) {\n\t\t\tpoints.push(...segment.points.map(Vec.Cast))\n\t\t} else {\n\t\t\tconst pointsToInterpolate = Math.max(\n\t\t\t\t4,\n\t\t\t\tMath.floor(Vec.Dist(segment.points[0], segment.points[1]) / 16)\n\t\t\t)\n\t\t\tpoints.push(...Vec.PointsBetween(segment.points[0], segment.points[1], pointsToInterpolate))\n\t\t}\n\t}\n\n\treturn points\n}\n\nexport function getDrawShapeStrokeDashArray(shape: TLDrawShape, strokeWidth: number) {\n\treturn {\n\t\tdraw: 'none',\n\t\tsolid: `none`,\n\t\tdotted: `0.1 ${strokeWidth * 2}`,\n\t\tdashed: `${strokeWidth * 2} ${strokeWidth * 2}`,\n\t}[shape.props.dash]\n}\n", "/* eslint-disable react-hooks/rules-of-hooks */\n\nimport {\n\tBaseBoxShapeUtil,\n\tHTMLContainer,\n\tTLEmbedShape,\n\tTLEmbedShapePermissions,\n\tTLOnResizeHandler,\n\tTLShapeUtilFlag,\n\tembedShapeMigrations,\n\tembedShapePermissionDefaults,\n\tembedShapeProps,\n\ttoDomPrecision,\n\tuseIsEditing,\n\tuseValue,\n} from '@tldraw/editor'\nimport { useMemo } from 'react'\nimport { getEmbedInfo, getEmbedInfoUnsafely } from '../../utils/embeds/embeds'\nimport { resizeBox } from '../shared/resizeBox'\nimport { getRotatedBoxShadow } from '../shared/rotated-box-shadow'\n\nconst getSandboxPermissions = (permissions: TLEmbedShapePermissions) => {\n\treturn Object.entries(permissions)\n\t\t.filter(([_perm, isEnabled]) => isEnabled)\n\t\t.map(([perm]) => perm)\n\t\t.join(' ')\n}\n\n/** @public */\nexport class EmbedShapeUtil extends BaseBoxShapeUtil<TLEmbedShape> {\n\tstatic override type = 'embed' as const\n\tstatic override props = embedShapeProps\n\tstatic override migrations = embedShapeMigrations\n\n\toverride hideSelectionBoundsFg: TLShapeUtilFlag<TLEmbedShape> = (shape) => !this.canResize(shape)\n\toverride canEdit: TLShapeUtilFlag<TLEmbedShape> = () => true\n\toverride canResize = (shape: TLEmbedShape) => {\n\t\treturn !!getEmbedInfo(shape.props.url)?.definition?.doesResize\n\t}\n\toverride canEditInReadOnly = () => true\n\n\toverride getDefaultProps(): TLEmbedShape['props'] {\n\t\treturn {\n\t\t\tw: 300,\n\t\t\th: 300,\n\t\t\turl: '',\n\t\t}\n\t}\n\n\toverride isAspectRatioLocked: TLShapeUtilFlag<TLEmbedShape> = (shape) => {\n\t\tconst embedInfo = getEmbedInfo(shape.props.url)\n\t\treturn embedInfo?.definition.isAspectRatioLocked ?? false\n\t}\n\n\toverride onResize: TLOnResizeHandler<TLEmbedShape> = (shape, info) => {\n\t\tconst isAspectRatioLocked = this.isAspectRatioLocked(shape)\n\t\tconst embedInfo = getEmbedInfo(shape.props.url)\n\t\tlet minWidth = embedInfo?.definition.minWidth ?? 200\n\t\tlet minHeight = embedInfo?.definition.minHeight ?? 200\n\t\tif (isAspectRatioLocked) {\n\t\t\t// Enforce aspect ratio\n\t\t\t// Neither the width or height can be less than 200\n\t\t\tconst aspectRatio = shape.props.w / shape.props.h\n\t\t\tif (aspectRatio > 1) {\n\t\t\t\t// Landscape\n\t\t\t\tminWidth *= aspectRatio\n\t\t\t} else {\n\t\t\t\t// Portrait\n\t\t\t\tminHeight /= aspectRatio\n\t\t\t}\n\t\t}\n\n\t\treturn resizeBox(shape, info, { minWidth, minHeight })\n\t}\n\n\toverride component(shape: TLEmbedShape) {\n\t\tconst { w, h, url } = shape.props\n\t\tconst isEditing = useIsEditing(shape.id)\n\t\tconst embedInfo = useMemo(() => getEmbedInfoUnsafely(url), [url])\n\n\t\tconst isHoveringWhileEditingSameShape = useValue(\n\t\t\t'is hovering',\n\t\t\t() => {\n\t\t\t\tconst { editingShapeId, hoveredShapeId } = this.editor.getCurrentPageState()\n\n\t\t\t\tif (editingShapeId && hoveredShapeId !== editingShapeId) {\n\t\t\t\t\tconst editingShape = this.editor.getShape(editingShapeId)\n\t\t\t\t\tif (editingShape && this.editor.isShapeOfType<TLEmbedShape>(editingShape, 'embed')) {\n\t\t\t\t\t\treturn true\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false\n\t\t\t},\n\t\t\t[]\n\t\t)\n\n\t\tconst pageRotation = this.editor.getShapePageTransform(shape)!.rotation()\n\n\t\tconst isInteractive = isEditing || isHoveringWhileEditingSameShape\n\n\t\tif (embedInfo?.definition.type === 'github_gist') {\n\t\t\tconst idFromGistUrl = embedInfo.url.split('/').pop()\n\t\t\tif (!idFromGistUrl) throw Error('No gist id!')\n\n\t\t\treturn (\n\t\t\t\t<HTMLContainer className=\"tl-embed-container\" id={shape.id}>\n\t\t\t\t\t<Gist\n\t\t\t\t\t\tid={idFromGistUrl}\n\t\t\t\t\t\twidth={toDomPrecision(w)!}\n\t\t\t\t\t\theight={toDomPrecision(h)!}\n\t\t\t\t\t\tisInteractive={isInteractive}\n\t\t\t\t\t\tpageRotation={pageRotation}\n\t\t\t\t\t/>\n\t\t\t\t</HTMLContainer>\n\t\t\t)\n\t\t}\n\n\t\tconst sandbox = getSandboxPermissions({\n\t\t\t...embedShapePermissionDefaults,\n\t\t\t...(embedInfo?.definition.overridePermissions ?? {}),\n\t\t})\n\n\t\treturn (\n\t\t\t<HTMLContainer className=\"tl-embed-container\" id={shape.id}>\n\t\t\t\t{embedInfo?.definition ? (\n\t\t\t\t\t<iframe\n\t\t\t\t\t\tclassName=\"tl-embed\"\n\t\t\t\t\t\tsandbox={sandbox}\n\t\t\t\t\t\tsrc={embedInfo.embedUrl}\n\t\t\t\t\t\twidth={toDomPrecision(w)}\n\t\t\t\t\t\theight={toDomPrecision(h)}\n\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\tframeBorder=\"0\"\n\t\t\t\t\t\treferrerPolicy=\"no-referrer-when-downgrade\"\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tborder: 0,\n\t\t\t\t\t\t\tpointerEvents: isInteractive ? 'auto' : 'none',\n\t\t\t\t\t\t\t// Fix for safari <https://stackoverflow.com/a/49150908>\n\t\t\t\t\t\t\tzIndex: isInteractive ? '' : '-1',\n\t\t\t\t\t\t\tboxShadow: getRotatedBoxShadow(pageRotation),\n\t\t\t\t\t\t\tborderRadius: embedInfo?.definition.overrideOutlineRadius ?? 8,\n\t\t\t\t\t\t\tbackground: embedInfo?.definition.backgroundColor,\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t) : null}\n\t\t\t</HTMLContainer>\n\t\t)\n\t}\n\n\toverride indicator(shape: TLEmbedShape) {\n\t\tconst embedInfo = useMemo(() => getEmbedInfo(shape.props.url), [shape.props.url])\n\t\treturn (\n\t\t\t<rect\n\t\t\t\twidth={toDomPrecision(shape.props.w)}\n\t\t\t\theight={toDomPrecision(shape.props.h)}\n\t\t\t\trx={embedInfo?.definition.overrideOutlineRadius ?? 8}\n\t\t\t\try={embedInfo?.definition.overrideOutlineRadius ?? 8}\n\t\t\t/>\n\t\t)\n\t}\n}\n\nfunction Gist({\n\tid,\n\tfile,\n\tisInteractive,\n\twidth,\n\theight,\n\tstyle,\n\tpageRotation,\n}: {\n\tid: string\n\tfile?: string\n\tisInteractive: boolean\n\twidth: number\n\theight: number\n\tpageRotation: number\n\tstyle?: React.CSSProperties\n}) {\n\treturn (\n\t\t<iframe\n\t\t\tclassName=\"tl-embed\"\n\t\t\tdraggable={false}\n\t\t\twidth={toDomPrecision(width)}\n\t\t\theight={toDomPrecision(height)}\n\t\t\tframeBorder=\"0\"\n\t\t\tscrolling=\"no\"\n\t\t\tseamless\n\t\t\treferrerPolicy=\"no-referrer-when-downgrade\"\n\t\t\tstyle={{\n\t\t\t\t...style,\n\t\t\t\tpointerEvents: isInteractive ? 'all' : 'none',\n\t\t\t\t// Fix for safari <https://stackoverflow.com/a/49150908>\n\t\t\t\tzIndex: isInteractive ? '' : '-1',\n\t\t\t\tboxShadow: getRotatedBoxShadow(pageRotation),\n\t\t\t}}\n\t\t\tsrcDoc={`\n\t\t\t<html>\n\t\t\t\t<head>\n\t\t\t\t\t<base target=\"_blank\">\n\t\t\t\t</head>\n\t\t\t\t<body>\n\t\t\t\t\t<script src=${`https://gist.github.com/${id}.js${file ? `?file=${file}` : ''}`}></script>\n\t\t\t\t\t<style type=\"text/css\">\n\t\t\t\t\t\t* { margin: 0px; }\n\t\t\t\t\t\ttable { height: 100%; background-color: red; }\n\t\t\t\t\t\t.gist { background-color: none; height: 100%;  }\n\t\t\t\t\t\t.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }\n\t\t\t\t\t</style>\n\t\t\t\t</body>\n\t\t\t</html>`}\n\t\t/>\n\t)\n}\n", "import { Box, TLBaseBoxShape, TLResizeHandle, TLResizeMode, Vec, VecModel } from '@tldraw/editor'\n\n/** @public */\nexport type ResizeBoxOptions = Partial<{\n\tminWidth: number\n\tmaxWidth: number\n\tminHeight: number\n\tmaxHeight: number\n}>\n\n/** @public */\nexport function resizeBox(\n\tshape: TLBaseBoxShape,\n\tinfo: {\n\t\tnewPoint: VecModel\n\t\thandle: TLResizeHandle\n\t\tmode: TLResizeMode\n\t\tscaleX: number\n\t\tscaleY: number\n\t\tinitialBounds: Box\n\t\tinitialShape: TLBaseBoxShape\n\t},\n\topts = {} as ResizeBoxOptions\n) {\n\tconst { newPoint, handle, scaleX, scaleY } = info\n\tconst { minWidth = 1, maxWidth = Infinity, minHeight = 1, maxHeight = Infinity } = opts\n\n\tlet w = shape.props.w * scaleX\n\tlet h = shape.props.h * scaleY\n\n\tconst offset = new Vec(0, 0)\n\n\tif (w > 0) {\n\t\tif (w < minWidth) {\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left':\n\t\t\t\tcase 'left':\n\t\t\t\tcase 'bottom_left': {\n\t\t\t\t\toffset.x = w - minWidth\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'top':\n\t\t\t\tcase 'bottom': {\n\t\t\t\t\toffset.x = (w - minWidth) / 2\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\toffset.x = 0\n\t\t\t\t}\n\t\t\t}\n\t\t\tw = minWidth\n\t\t}\n\t} else {\n\t\toffset.x = w\n\t\tw = -w\n\t\tif (w < minWidth) {\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left':\n\t\t\t\tcase 'left':\n\t\t\t\tcase 'bottom_left': {\n\t\t\t\t\toffset.x = -w\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\toffset.x = -minWidth\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tw = minWidth\n\t\t}\n\t}\n\n\tif (h > 0) {\n\t\tif (h < minHeight) {\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left':\n\t\t\t\tcase 'top':\n\t\t\t\tcase 'top_right': {\n\t\t\t\t\toffset.y = h - minHeight\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'right':\n\t\t\t\tcase 'left': {\n\t\t\t\t\toffset.y = (h - minHeight) / 2\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\toffset.y = 0\n\t\t\t\t}\n\t\t\t}\n\n\t\t\th = minHeight\n\t\t}\n\t} else {\n\t\toffset.y = h\n\t\th = -h\n\t\tif (h < minHeight) {\n\t\t\tswitch (handle) {\n\t\t\t\tcase 'top_left':\n\t\t\t\tcase 'top':\n\t\t\t\tcase 'top_right': {\n\t\t\t\t\toffset.y = -h\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\toffset.y = -minHeight\n\t\t\t\t}\n\t\t\t}\n\t\t\th = minHeight\n\t\t}\n\t}\n\n\tconst { x, y } = offset.rot(shape.rotation).add(newPoint)\n\n\treturn {\n\t\tx,\n\t\ty,\n\t\tprops: {\n\t\t\tw: Math.min(maxWidth, w),\n\t\t\th: Math.min(maxHeight, h),\n\t\t},\n\t}\n}\n", "import {\n\tBaseBoxShapeUtil,\n\tGeometry2d,\n\tRectangle2d,\n\tSVGContainer,\n\tSvgExportContext,\n\tTLFrameShape,\n\tTLGroupShape,\n\tTLOnResizeHandler,\n\tTLShape,\n\tcanonicalizeRotation,\n\tframeShapeMigrations,\n\tframeShapeProps,\n\tgetDefaultColorTheme,\n\tlast,\n\tresizeBox,\n\ttoDomPrecision,\n\tuseValue,\n} from '@tldraw/editor'\nimport classNames from 'classnames'\nimport { useDefaultColorTheme } from '../shared/ShapeFill'\nimport { createTextJsxFromSpans } from '../shared/createTextJsxFromSpans'\nimport { FrameHeading } from './components/FrameHeading'\n\nexport function defaultEmptyAs(str: string, dflt: string) {\n\tif (str.match(/^\\s*$/)) {\n\t\treturn dflt\n\t}\n\treturn str\n}\n\n/** @public */\nexport class FrameShapeUtil extends BaseBoxShapeUtil<TLFrameShape> {\n\tstatic override type = 'frame' as const\n\tstatic override props = frameShapeProps\n\tstatic override migrations = frameShapeMigrations\n\n\toverride canBind = () => true\n\n\toverride canEdit = () => true\n\n\toverride getDefaultProps(): TLFrameShape['props'] {\n\t\treturn { w: 160 * 2, h: 90 * 2, name: '' }\n\t}\n\n\toverride getGeometry(shape: TLFrameShape): Geometry2d {\n\t\treturn new Rectangle2d({\n\t\t\twidth: shape.props.w,\n\t\t\theight: shape.props.h,\n\t\t\tisFilled: false,\n\t\t})\n\t}\n\n\toverride component(shape: TLFrameShape) {\n\t\tconst bounds = this.editor.getShapeGeometry(shape).bounds\n\t\t// eslint-disable-next-line react-hooks/rules-of-hooks\n\t\tconst theme = useDefaultColorTheme()\n\n\t\t// eslint-disable-next-line react-hooks/rules-of-hooks\n\t\tconst isCreating = useValue(\n\t\t\t'is creating this shape',\n\t\t\t() => {\n\t\t\t\tconst resizingState = this.editor.getStateDescendant('select.resizing')\n\t\t\t\tif (!resizingState) return false\n\t\t\t\tif (!resizingState.getIsActive()) return false\n\t\t\t\tconst info = (resizingState as typeof resizingState & { info: { isCreating: boolean } })\n\t\t\t\t\t?.info\n\t\t\t\tif (!info) return false\n\t\t\t\treturn info.isCreating && this.editor.getOnlySelectedShapeId() === shape.id\n\t\t\t},\n\t\t\t[shape.id]\n\t\t)\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<SVGContainer>\n\t\t\t\t\t<rect\n\t\t\t\t\t\tclassName={classNames('tl-frame__body', { 'tl-frame__creating': isCreating })}\n\t\t\t\t\t\twidth={bounds.width}\n\t\t\t\t\t\theight={bounds.height}\n\t\t\t\t\t\tfill={theme.solid}\n\t\t\t\t\t\tstroke={theme.text}\n\t\t\t\t\t/>\n\t\t\t\t</SVGContainer>\n\t\t\t\t{isCreating ? null : (\n\t\t\t\t\t<FrameHeading\n\t\t\t\t\t\tid={shape.id}\n\t\t\t\t\t\tname={shape.props.name}\n\t\t\t\t\t\twidth={bounds.width}\n\t\t\t\t\t\theight={bounds.height}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</>\n\t\t)\n\t}\n\n\toverride toSvg(shape: TLFrameShape, ctx: SvgExportContext) {\n\t\tconst theme = getDefaultColorTheme({ isDarkMode: ctx.isDarkMode })\n\n\t\t// Text label\n\t\tconst pageRotation = canonicalizeRotation(\n\t\t\tthis.editor.getShapePageTransform(shape.id)!.rotation()\n\t\t)\n\t\t// rotate right 45 deg\n\t\tconst offsetRotation = pageRotation + Math.PI / 4\n\t\tconst scaledRotation = (offsetRotation * (2 / Math.PI) + 4) % 4\n\t\tconst labelSide = Math.floor(scaledRotation)\n\n\t\tlet labelTranslate: string\n\t\tswitch (labelSide) {\n\t\t\tcase 0: // top\n\t\t\t\tlabelTranslate = ``\n\t\t\t\tbreak\n\t\t\tcase 3: // right\n\t\t\t\tlabelTranslate = `translate(${toDomPrecision(shape.props.w)}, 0) rotate(90)`\n\t\t\t\tbreak\n\t\t\tcase 2: // bottom\n\t\t\t\tlabelTranslate = `translate(${toDomPrecision(shape.props.w)}, ${toDomPrecision(\n\t\t\t\t\tshape.props.h\n\t\t\t\t)}) rotate(180)`\n\t\t\t\tbreak\n\t\t\tcase 1: // left\n\t\t\t\tlabelTranslate = `translate(0, ${toDomPrecision(shape.props.h)}) rotate(270)`\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tthrow Error('labelSide out of bounds')\n\t\t}\n\n\t\t// Truncate with ellipsis\n\t\tconst opts = {\n\t\t\tfontSize: 12,\n\t\t\tfontFamily: 'Inter, sans-serif',\n\t\t\ttextAlign: 'start' as const,\n\t\t\twidth: shape.props.w,\n\t\t\theight: 32,\n\t\t\tpadding: 0,\n\t\t\tlineHeight: 1,\n\t\t\tfontStyle: 'normal',\n\t\t\tfontWeight: 'normal',\n\t\t\toverflow: 'truncate-ellipsis' as const,\n\t\t\tverticalTextAlign: 'middle' as const,\n\t\t}\n\n\t\tconst spans = this.editor.textMeasure.measureTextSpans(\n\t\t\tdefaultEmptyAs(shape.props.name, 'Frame') + String.fromCharCode(8203),\n\t\t\topts\n\t\t)\n\n\t\tconst firstSpan = spans[0]\n\t\tconst lastSpan = last(spans)!\n\t\tconst labelTextWidth = lastSpan.box.w + lastSpan.box.x - firstSpan.box.x\n\t\tconst text = createTextJsxFromSpans(this.editor, spans, {\n\t\t\toffsetY: -opts.height - 2,\n\t\t\t...opts,\n\t\t})\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<rect\n\t\t\t\t\twidth={shape.props.w}\n\t\t\t\t\theight={shape.props.h}\n\t\t\t\t\tfill={theme.solid}\n\t\t\t\t\tstroke={theme.black.solid}\n\t\t\t\t\tstrokeWidth={1}\n\t\t\t\t\trx={1}\n\t\t\t\t\try={1}\n\t\t\t\t/>\n\t\t\t\t<g transform={labelTranslate}>\n\t\t\t\t\t<rect\n\t\t\t\t\t\tx={-8}\n\t\t\t\t\t\ty={-opts.height - 4}\n\t\t\t\t\t\twidth={labelTextWidth + 16}\n\t\t\t\t\t\theight={opts.height}\n\t\t\t\t\t\tfill={theme.background}\n\t\t\t\t\t\trx={4}\n\t\t\t\t\t\try={4}\n\t\t\t\t\t/>\n\t\t\t\t\t{text}\n\t\t\t\t</g>\n\t\t\t</>\n\t\t)\n\t}\n\n\tindicator(shape: TLFrameShape) {\n\t\tconst bounds = this.editor.getShapeGeometry(shape).bounds\n\n\t\treturn (\n\t\t\t<rect\n\t\t\t\twidth={toDomPrecision(bounds.width)}\n\t\t\t\theight={toDomPrecision(bounds.height)}\n\t\t\t\tclassName={`tl-frame-indicator`}\n\t\t\t/>\n\t\t)\n\t}\n\n\toverride canReceiveNewChildrenOfType = (shape: TLShape, _type: TLShape['type']) => {\n\t\treturn !shape.isLocked\n\t}\n\n\toverride providesBackgroundForChildren(): boolean {\n\t\treturn true\n\t}\n\n\toverride canDropShapes = (shape: TLFrameShape, _shapes: TLShape[]): boolean => {\n\t\treturn !shape.isLocked\n\t}\n\n\toverride onDragShapesOver = (frame: TLFrameShape, shapes: TLShape[]) => {\n\t\tif (!shapes.every((child) => child.parentId === frame.id)) {\n\t\t\tthis.editor.reparentShapes(shapes, frame.id)\n\t\t}\n\t}\n\n\toverride onDragShapesOut = (_shape: TLFrameShape, shapes: TLShape[]): void => {\n\t\tconst parent = this.editor.getShape(_shape.parentId)\n\t\tconst isInGroup = parent && this.editor.isShapeOfType<TLGroupShape>(parent, 'group')\n\n\t\t// If frame is in a group, keep the shape\n\t\t// moved out in that group\n\n\t\tif (isInGroup) {\n\t\t\tthis.editor.reparentShapes(shapes, parent.id)\n\t\t} else {\n\t\t\tthis.editor.reparentShapes(shapes, this.editor.getCurrentPageId())\n\t\t}\n\t}\n\n\toverride onResize: TLOnResizeHandler<any> = (shape, info) => {\n\t\treturn resizeBox(shape, info)\n\t}\n}\n", "import {\n\tSelectionEdge,\n\tTLShapeId,\n\tcanonicalizeRotation,\n\tgetPointerInfo,\n\ttoDomPrecision,\n\tuseEditor,\n\tuseIsEditing,\n\tuseValue,\n} from '@tldraw/editor'\nimport { useCallback, useEffect, useRef } from 'react'\nimport { FrameLabelInput } from './FrameLabelInput'\n\nexport const FrameHeading = function FrameHeading({\n\tid,\n\tname,\n\twidth,\n\theight,\n}: {\n\tid: TLShapeId\n\tname: string\n\twidth: number\n\theight: number\n}) {\n\tconst editor = useEditor()\n\tconst pageRotation = useValue(\n\t\t'shape rotation',\n\t\t() => canonicalizeRotation(editor.getShapePageTransform(id)!.rotation()),\n\t\t[editor, id]\n\t)\n\n\tconst isEditing = useIsEditing(id)\n\n\tconst rInput = useRef<HTMLInputElement>(null)\n\n\tconst handlePointerDown = useCallback(\n\t\t(e: React.PointerEvent) => {\n\t\t\tconst event = getPointerInfo(e)\n\n\t\t\t// If we're editing the frame label, we shouldn't hijack the pointer event\n\t\t\tif (editor.getEditingShapeId() === id) return\n\n\t\t\teditor.dispatch({\n\t\t\t\ttype: 'pointer',\n\t\t\t\tname: 'pointer_down',\n\t\t\t\ttarget: 'shape',\n\t\t\t\tshape: editor.getShape(id)!,\n\t\t\t\t...event,\n\t\t\t})\n\t\t\te.preventDefault()\n\t\t},\n\t\t[editor, id]\n\t)\n\n\tuseEffect(() => {\n\t\tconst el = rInput.current\n\t\tif (el && isEditing) {\n\t\t\t// On iOS, we must focus here\n\t\t\tel.focus()\n\t\t\tel.select()\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\t// On desktop, the input may have lost focus, so try try try again!\n\t\t\t\tif (document.activeElement !== el) {\n\t\t\t\t\tel.focus()\n\t\t\t\t\tel.select()\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}, [rInput, isEditing])\n\n\t// rotate right 45 deg\n\tconst offsetRotation = pageRotation + Math.PI / 4\n\tconst scaledRotation = (offsetRotation * (2 / Math.PI) + 4) % 4\n\tconst labelSide: SelectionEdge = (['top', 'left', 'bottom', 'right'] as const)[\n\t\tMath.floor(scaledRotation)\n\t]\n\n\tlet labelTranslate: string\n\tswitch (labelSide) {\n\t\tcase 'top':\n\t\t\tlabelTranslate = ``\n\t\t\tbreak\n\t\tcase 'right':\n\t\t\tlabelTranslate = `translate(${toDomPrecision(width)}px, 0px) rotate(90deg)`\n\t\t\tbreak\n\t\tcase 'bottom':\n\t\t\tlabelTranslate = `translate(${toDomPrecision(width)}px, ${toDomPrecision(\n\t\t\t\theight\n\t\t\t)}px) rotate(180deg)`\n\t\t\tbreak\n\t\tcase 'left':\n\t\t\tlabelTranslate = `translate(0px, ${toDomPrecision(height)}px) rotate(270deg)`\n\t\t\tbreak\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName=\"tl-frame-heading\"\n\t\t\tstyle={{\n\t\t\t\toverflow: isEditing ? 'visible' : 'hidden',\n\t\t\t\tmaxWidth: `calc(var(--tl-zoom) * ${\n\t\t\t\t\tlabelSide === 'top' || labelSide === 'bottom' ? Math.ceil(width) : Math.ceil(height)\n\t\t\t\t}px + var(--space-5))`,\n\t\t\t\tbottom: '100%',\n\t\t\t\ttransform: `${labelTranslate} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`,\n\t\t\t}}\n\t\t\tonPointerDown={handlePointerDown}\n\t\t>\n\t\t\t<div className=\"tl-frame-heading-hit-area\">\n\t\t\t\t<FrameLabelInput ref={rInput} id={id} name={name} isEditing={isEditing} />\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n", "import { TLFrameShape, TLShapeId, stopEventPropagation, useEditor } from '@tldraw/editor'\nimport { forwardRef, useCallback } from 'react'\nimport { defaultEmptyAs } from '../FrameShapeUtil'\n\nexport const FrameLabelInput = forwardRef<\n\tHTMLInputElement,\n\t{ id: TLShapeId; name: string; isEditing: boolean }\n>(({ id, name, isEditing }, ref) => {\n\tconst editor = useEditor()\n\n\tconst handleKeyDown = useCallback(\n\t\t(e: React.KeyboardEvent<HTMLInputElement>) => {\n\t\t\tif (e.key === 'Enter' && !e.nativeEvent.isComposing) {\n\t\t\t\t// need to prevent the enter keydown making it's way up to the Idle state\n\t\t\t\t// and sending us back into edit mode\n\t\t\t\tstopEventPropagation(e)\n\t\t\t\te.currentTarget.blur()\n\t\t\t\teditor.setEditingShape(null)\n\t\t\t}\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst handleBlur = useCallback(\n\t\t(e: React.FocusEvent<HTMLInputElement>) => {\n\t\t\tconst shape = editor.getShape<TLFrameShape>(id)\n\t\t\tif (!shape) return\n\n\t\t\tconst name = shape.props.name\n\t\t\tconst value = e.currentTarget.value.trim()\n\t\t\tif (name === value) return\n\n\t\t\teditor.updateShapes(\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype: 'frame',\n\t\t\t\t\t\tprops: { name: value },\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t{ squashing: true }\n\t\t\t)\n\t\t},\n\t\t[id, editor]\n\t)\n\n\tconst handleChange = useCallback(\n\t\t(e: React.ChangeEvent<HTMLInputElement>) => {\n\t\t\tconst shape = editor.getShape<TLFrameShape>(id)\n\t\t\tif (!shape) return\n\n\t\t\tconst name = shape.props.name\n\t\t\tconst value = e.currentTarget.value\n\t\t\tif (name === value) return\n\n\t\t\teditor.updateShapes(\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype: 'frame',\n\t\t\t\t\t\tprops: { name: value },\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t{ squashing: true }\n\t\t\t)\n\t\t},\n\t\t[id, editor]\n\t)\n\n\treturn (\n\t\t<div className={`tl-frame-label ${isEditing ? 'tl-frame-label__editing' : ''}`}>\n\t\t\t<input\n\t\t\t\tclassName=\"tl-frame-name-input\"\n\t\t\t\tref={ref}\n\t\t\t\tstyle={{ display: isEditing ? undefined : 'none' }}\n\t\t\t\tvalue={name}\n\t\t\t\tautoFocus\n\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\tonBlur={handleBlur}\n\t\t\t\tonChange={handleChange}\n\t\t\t/>\n\t\t\t{defaultEmptyAs(name, 'Frame') + String.fromCharCode(8203)}\n\t\t</div>\n\t)\n})\n", "/* eslint-disable react-hooks/rules-of-hooks */\nimport {\n\tBaseBoxShapeUtil,\n\tEditor,\n\tEllipse2d,\n\tGeometry2d,\n\tGroup2d,\n\tHALF_PI,\n\tHTMLContainer,\n\tHandleSnapGeometry,\n\tPI2,\n\tPolygon2d,\n\tPolyline2d,\n\tRectangle2d,\n\tSVGContainer,\n\tStadium2d,\n\tSvgExportContext,\n\tTLGeoShape,\n\tTLOnEditEndHandler,\n\tTLOnResizeHandler,\n\tTLShapeUtilCanvasSvgDef,\n\tVec,\n\texhaustiveSwitchError,\n\tgeoShapeMigrations,\n\tgeoShapeProps,\n\tgetDefaultColorTheme,\n\tgetPolygonVertices,\n} from '@tldraw/editor'\n\nimport { HyperlinkButton } from '../shared/HyperlinkButton'\nimport { useDefaultColorTheme } from '../shared/ShapeFill'\nimport { SvgTextLabel } from '../shared/SvgTextLabel'\nimport { TextLabel } from '../shared/TextLabel'\nimport {\n\tFONT_FAMILIES,\n\tLABEL_FONT_SIZES,\n\tLABEL_PADDING,\n\tSTROKE_SIZES,\n\tTEXT_PROPS,\n} from '../shared/default-shape-constants'\nimport {\n\tgetFillDefForCanvas,\n\tgetFillDefForExport,\n\tgetFontDefForExport,\n} from '../shared/defaultStyleDefs'\nimport { getRoundedInkyPolygonPath, getRoundedPolygonPoints } from '../shared/polygon-helpers'\nimport { cloudOutline, cloudSvgPath } from './cloudOutline'\nimport { getEllipseIndicatorPath } from './components/DrawStyleEllipse'\nimport { GeoShapeBody } from './components/GeoShapeBody'\nimport { getOvalIndicatorPath } from './components/SolidStyleOval'\nimport { getLines } from './getLines'\n\nconst MIN_SIZE_WITH_LABEL = 17 * 3\n\n/** @public */\nexport class GeoShapeUtil extends BaseBoxShapeUtil<TLGeoShape> {\n\tstatic override type = 'geo' as const\n\tstatic override props = geoShapeProps\n\tstatic override migrations = geoShapeMigrations\n\n\toverride canEdit = () => true\n\n\toverride getDefaultProps(): TLGeoShape['props'] {\n\t\treturn {\n\t\t\tw: 100,\n\t\t\th: 100,\n\t\t\tgeo: 'rectangle',\n\t\t\tcolor: 'black',\n\t\t\tlabelColor: 'black',\n\t\t\tfill: 'none',\n\t\t\tdash: 'draw',\n\t\t\tsize: 'm',\n\t\t\tfont: 'draw',\n\t\t\ttext: '',\n\t\t\talign: 'middle',\n\t\t\tverticalAlign: 'middle',\n\t\t\tgrowY: 0,\n\t\t\turl: '',\n\t\t}\n\t}\n\n\toverride getGeometry(shape: TLGeoShape) {\n\t\tconst w = Math.max(1, shape.props.w)\n\t\tconst h = Math.max(1, shape.props.h + shape.props.growY)\n\t\tconst cx = w / 2\n\t\tconst cy = h / 2\n\n\t\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\t\tconst isFilled = shape.props.fill !== 'none' // || shape.props.text.trim().length > 0\n\n\t\tlet body: Geometry2d\n\n\t\tswitch (shape.props.geo) {\n\t\t\tcase 'cloud': {\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: cloudOutline(w, h, shape.id, shape.props.size),\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'triangle': {\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [new Vec(cx, 0), new Vec(w, h), new Vec(0, h)],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'diamond': {\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [new Vec(cx, 0), new Vec(w, cy), new Vec(cx, h), new Vec(0, cy)],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'pentagon': {\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: getPolygonVertices(w, h, 5),\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'hexagon': {\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: getPolygonVertices(w, h, 6),\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'octagon': {\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: getPolygonVertices(w, h, 8),\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'ellipse': {\n\t\t\t\tbody = new Ellipse2d({\n\t\t\t\t\twidth: w,\n\t\t\t\t\theight: h,\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'oval': {\n\t\t\t\tbody = new Stadium2d({\n\t\t\t\t\twidth: w,\n\t\t\t\t\theight: h,\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'star': {\n\t\t\t\t// Most of this code is to offset the center, a 5 point star\n\t\t\t\t// will need to be moved downward because from its center [0,0]\n\t\t\t\t// it will have a bigger minY than maxY. This is because it'll\n\t\t\t\t// have 2 points at the bottom.\n\t\t\t\tconst sides = 5\n\t\t\t\tconst step = PI2 / sides / 2\n\t\t\t\tconst rightMostIndex = Math.floor(sides / 4) * 2\n\t\t\t\tconst leftMostIndex = sides * 2 - rightMostIndex\n\t\t\t\tconst topMostIndex = 0\n\t\t\t\tconst bottomMostIndex = Math.floor(sides / 2) * 2\n\t\t\t\tconst maxX = (Math.cos(-HALF_PI + rightMostIndex * step) * w) / 2\n\t\t\t\tconst minX = (Math.cos(-HALF_PI + leftMostIndex * step) * w) / 2\n\n\t\t\t\tconst minY = (Math.sin(-HALF_PI + topMostIndex * step) * h) / 2\n\t\t\t\tconst maxY = (Math.sin(-HALF_PI + bottomMostIndex * step) * h) / 2\n\t\t\t\tconst diffX = w - Math.abs(maxX - minX)\n\t\t\t\tconst diffY = h - Math.abs(maxY - minY)\n\t\t\t\tconst offsetX = w / 2 + minX - (w / 2 - maxX)\n\t\t\t\tconst offsetY = h / 2 + minY - (h / 2 - maxY)\n\n\t\t\t\tconst ratio = 1\n\t\t\t\tconst cx = (w - offsetX) / 2\n\t\t\t\tconst cy = (h - offsetY) / 2\n\t\t\t\tconst ox = (w + diffX) / 2\n\t\t\t\tconst oy = (h + diffY) / 2\n\t\t\t\tconst ix = (ox * ratio) / 2\n\t\t\t\tconst iy = (oy * ratio) / 2\n\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: Array.from(Array(sides * 2)).map((_, i) => {\n\t\t\t\t\t\tconst theta = -HALF_PI + i * step\n\t\t\t\t\t\treturn new Vec(\n\t\t\t\t\t\t\tcx + (i % 2 ? ix : ox) * Math.cos(theta),\n\t\t\t\t\t\t\tcy + (i % 2 ? iy : oy) * Math.sin(theta)\n\t\t\t\t\t\t)\n\t\t\t\t\t}),\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'rhombus': {\n\t\t\t\tconst offset = Math.min(w * 0.38, h * 0.38)\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [new Vec(offset, 0), new Vec(w, 0), new Vec(w - offset, h), new Vec(0, h)],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'rhombus-2': {\n\t\t\t\tconst offset = Math.min(w * 0.38, h * 0.38)\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [new Vec(0, 0), new Vec(w - offset, 0), new Vec(w, h), new Vec(offset, h)],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'trapezoid': {\n\t\t\t\tconst offset = Math.min(w * 0.38, h * 0.38)\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [new Vec(offset, 0), new Vec(w - offset, 0), new Vec(w, h), new Vec(0, h)],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'arrow-right': {\n\t\t\t\tconst ox = Math.min(w, h) * 0.38\n\t\t\t\tconst oy = h * 0.16\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [\n\t\t\t\t\t\tnew Vec(0, oy),\n\t\t\t\t\t\tnew Vec(w - ox, oy),\n\t\t\t\t\t\tnew Vec(w - ox, 0),\n\t\t\t\t\t\tnew Vec(w, h / 2),\n\t\t\t\t\t\tnew Vec(w - ox, h),\n\t\t\t\t\t\tnew Vec(w - ox, h - oy),\n\t\t\t\t\t\tnew Vec(0, h - oy),\n\t\t\t\t\t],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'arrow-left': {\n\t\t\t\tconst ox = Math.min(w, h) * 0.38\n\t\t\t\tconst oy = h * 0.16\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [\n\t\t\t\t\t\tnew Vec(ox, 0),\n\t\t\t\t\t\tnew Vec(ox, oy),\n\t\t\t\t\t\tnew Vec(w, oy),\n\t\t\t\t\t\tnew Vec(w, h - oy),\n\t\t\t\t\t\tnew Vec(ox, h - oy),\n\t\t\t\t\t\tnew Vec(ox, h),\n\t\t\t\t\t\tnew Vec(0, h / 2),\n\t\t\t\t\t],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'arrow-up': {\n\t\t\t\tconst ox = w * 0.16\n\t\t\t\tconst oy = Math.min(w, h) * 0.38\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [\n\t\t\t\t\t\tnew Vec(w / 2, 0),\n\t\t\t\t\t\tnew Vec(w, oy),\n\t\t\t\t\t\tnew Vec(w - ox, oy),\n\t\t\t\t\t\tnew Vec(w - ox, h),\n\t\t\t\t\t\tnew Vec(ox, h),\n\t\t\t\t\t\tnew Vec(ox, oy),\n\t\t\t\t\t\tnew Vec(0, oy),\n\t\t\t\t\t],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'arrow-down': {\n\t\t\t\tconst ox = w * 0.16\n\t\t\t\tconst oy = Math.min(w, h) * 0.38\n\t\t\t\tbody = new Polygon2d({\n\t\t\t\t\tpoints: [\n\t\t\t\t\t\tnew Vec(ox, 0),\n\t\t\t\t\t\tnew Vec(w - ox, 0),\n\t\t\t\t\t\tnew Vec(w - ox, h - oy),\n\t\t\t\t\t\tnew Vec(w, h - oy),\n\t\t\t\t\t\tnew Vec(w / 2, h),\n\t\t\t\t\t\tnew Vec(0, h - oy),\n\t\t\t\t\t\tnew Vec(ox, h - oy),\n\t\t\t\t\t],\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'check-box':\n\t\t\tcase 'x-box':\n\t\t\tcase 'rectangle': {\n\t\t\t\tbody = new Rectangle2d({\n\t\t\t\t\twidth: w,\n\t\t\t\t\theight: h,\n\t\t\t\t\tisFilled,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tconst labelSize = getLabelSize(this.editor, shape)\n\t\tconst minWidth = Math.min(100, w / 2)\n\t\tconst labelWidth = Math.min(w, Math.max(labelSize.w, Math.min(minWidth, Math.max(1, w - 8))))\n\t\tconst minHeight = Math.min(\n\t\t\tLABEL_FONT_SIZES[shape.props.size] * TEXT_PROPS.lineHeight + LABEL_PADDING * 2,\n\t\t\th / 2\n\t\t)\n\t\tconst labelHeight = Math.min(h, Math.max(labelSize.h, Math.min(minHeight, Math.max(1, w - 8)))) // not sure if bug\n\n\t\tconst lines = getLines(shape.props, strokeWidth)\n\t\tconst edges = lines ? lines.map((line) => new Polyline2d({ points: line })) : []\n\n\t\t// todo: use centroid for label position\n\n\t\treturn new Group2d({\n\t\t\tchildren: [\n\t\t\t\tbody,\n\t\t\t\tnew Rectangle2d({\n\t\t\t\t\tx:\n\t\t\t\t\t\tshape.props.align === 'start'\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: shape.props.align === 'end'\n\t\t\t\t\t\t\t\t? w - labelWidth\n\t\t\t\t\t\t\t\t: (w - labelWidth) / 2,\n\t\t\t\t\ty:\n\t\t\t\t\t\tshape.props.verticalAlign === 'start'\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: shape.props.verticalAlign === 'end'\n\t\t\t\t\t\t\t\t? h - labelHeight\n\t\t\t\t\t\t\t\t: (h - labelHeight) / 2,\n\t\t\t\t\twidth: labelWidth,\n\t\t\t\t\theight: labelHeight,\n\t\t\t\t\tisFilled: true,\n\t\t\t\t\tisLabel: true,\n\t\t\t\t}),\n\t\t\t\t...edges,\n\t\t\t],\n\t\t})\n\t}\n\n\toverride getHandleSnapGeometry(shape: TLGeoShape): HandleSnapGeometry {\n\t\tconst geometry = this.getGeometry(shape)\n\t\t// we only want to snap handles to the outline of the shape - not to its label etc.\n\t\tconst outline = geometry.children[0]\n\t\tswitch (shape.props.geo) {\n\t\t\tcase 'arrow-down':\n\t\t\tcase 'arrow-left':\n\t\t\tcase 'arrow-right':\n\t\t\tcase 'arrow-up':\n\t\t\tcase 'check-box':\n\t\t\tcase 'diamond':\n\t\t\tcase 'hexagon':\n\t\t\tcase 'octagon':\n\t\t\tcase 'pentagon':\n\t\t\tcase 'rectangle':\n\t\t\tcase 'rhombus':\n\t\t\tcase 'rhombus-2':\n\t\t\tcase 'star':\n\t\t\tcase 'trapezoid':\n\t\t\tcase 'triangle':\n\t\t\tcase 'x-box':\n\t\t\t\t// poly-line type shapes hand snap points for each vertex & the center\n\t\t\t\treturn { outline: outline, points: [...outline.getVertices(), geometry.bounds.center] }\n\t\t\tcase 'cloud':\n\t\t\tcase 'ellipse':\n\t\t\tcase 'oval':\n\t\t\t\t// blobby shapes only have a snap point in their center\n\t\t\t\treturn { outline: outline, points: [geometry.bounds.center] }\n\t\t\tdefault:\n\t\t\t\texhaustiveSwitchError(shape.props.geo)\n\t\t}\n\t}\n\n\toverride onEditEnd: TLOnEditEndHandler<TLGeoShape> = (shape) => {\n\t\tconst {\n\t\t\tid,\n\t\t\ttype,\n\t\t\tprops: { text },\n\t\t} = shape\n\n\t\tif (text.trimEnd() !== shape.props.text) {\n\t\t\tthis.editor.updateShapes([\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\ttype,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttext: text.trimEnd(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\t\t}\n\t}\n\n\tcomponent(shape: TLGeoShape) {\n\t\tconst { id, type, props } = shape\n\t\tconst { fill, font, align, verticalAlign, size, text } = props\n\t\tconst isSelected = shape.id === this.editor.getOnlySelectedShapeId()\n\t\tconst theme = useDefaultColorTheme()\n\t\tconst isEditingAnything = this.editor.getEditingShapeId() !== null\n\t\tconst showHtmlContainer = isEditingAnything || shape.props.text\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<SVGContainer id={id}>\n\t\t\t\t\t<GeoShapeBody shape={shape} />\n\t\t\t\t</SVGContainer>\n\t\t\t\t{showHtmlContainer && (\n\t\t\t\t\t<HTMLContainer\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\twidth: shape.props.w,\n\t\t\t\t\t\t\theight: shape.props.h + props.growY,\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<TextLabel\n\t\t\t\t\t\t\tid={id}\n\t\t\t\t\t\t\ttype={type}\n\t\t\t\t\t\t\tfont={font}\n\t\t\t\t\t\t\tfontSize={LABEL_FONT_SIZES[size]}\n\t\t\t\t\t\t\tlineHeight={TEXT_PROPS.lineHeight}\n\t\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t\t\talign={align}\n\t\t\t\t\t\t\tverticalAlign={verticalAlign}\n\t\t\t\t\t\t\ttext={text}\n\t\t\t\t\t\t\tisSelected={isSelected}\n\t\t\t\t\t\t\tlabelColor={theme[props.labelColor].solid}\n\t\t\t\t\t\t\twrap\n\t\t\t\t\t\t/>\n\t\t\t\t\t</HTMLContainer>\n\t\t\t\t)}\n\t\t\t\t{shape.props.url && (\n\t\t\t\t\t<HyperlinkButton url={shape.props.url} zoomLevel={this.editor.getZoomLevel()} />\n\t\t\t\t)}\n\t\t\t</>\n\t\t)\n\t}\n\n\tindicator(shape: TLGeoShape) {\n\t\tconst { id, props } = shape\n\t\tconst { w, size } = props\n\t\tconst h = props.h + props.growY\n\n\t\tconst strokeWidth = STROKE_SIZES[size]\n\n\t\tswitch (props.geo) {\n\t\t\tcase 'ellipse': {\n\t\t\t\tif (props.dash === 'draw') {\n\t\t\t\t\treturn <path d={getEllipseIndicatorPath(id, w, h, strokeWidth)} />\n\t\t\t\t}\n\n\t\t\t\treturn <ellipse cx={w / 2} cy={h / 2} rx={w / 2} ry={h / 2} />\n\t\t\t}\n\t\t\tcase 'oval': {\n\t\t\t\treturn <path d={getOvalIndicatorPath(w, h)} />\n\t\t\t}\n\t\t\tcase 'cloud': {\n\t\t\t\treturn <path d={cloudSvgPath(w, h, id, size)} />\n\t\t\t}\n\n\t\t\tdefault: {\n\t\t\t\tconst geometry = this.editor.getShapeGeometry(shape)\n\t\t\t\tconst outline =\n\t\t\t\t\tgeometry instanceof Group2d ? geometry.children[0].vertices : geometry.vertices\n\t\t\t\tlet path: string\n\n\t\t\t\tif (props.dash === 'draw') {\n\t\t\t\t\tconst polygonPoints = getRoundedPolygonPoints(id, outline, 0, strokeWidth * 2, 1)\n\t\t\t\t\tpath = getRoundedInkyPolygonPath(polygonPoints)\n\t\t\t\t} else {\n\t\t\t\t\tpath = 'M' + outline[0] + 'L' + outline.slice(1) + 'Z'\n\t\t\t\t}\n\n\t\t\t\tconst lines = getLines(shape.props, strokeWidth)\n\n\t\t\t\tif (lines) {\n\t\t\t\t\tfor (const [A, B] of lines) {\n\t\t\t\t\t\tpath += `M${A.x},${A.y}L${B.x},${B.y}`\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn <path d={path} />\n\t\t\t}\n\t\t}\n\t}\n\n\toverride toSvg(shape: TLGeoShape, ctx: SvgExportContext) {\n\t\tconst { props } = shape\n\t\tctx.addExportDef(getFillDefForExport(shape.props.fill))\n\n\t\tlet textEl\n\t\tif (props.text) {\n\t\t\tctx.addExportDef(getFontDefForExport(shape.props.font))\n\t\t\tconst theme = getDefaultColorTheme(ctx)\n\n\t\t\tconst bounds = this.editor.getShapeGeometry(shape).bounds\n\t\t\ttextEl = (\n\t\t\t\t<SvgTextLabel\n\t\t\t\t\tfontSize={LABEL_FONT_SIZES[props.size]}\n\t\t\t\t\tfont={props.font}\n\t\t\t\t\talign={props.align}\n\t\t\t\t\tverticalAlign={props.verticalAlign}\n\t\t\t\t\ttext={props.text}\n\t\t\t\t\tlabelColor={theme[props.labelColor].solid}\n\t\t\t\t\tbounds={bounds}\n\t\t\t\t/>\n\t\t\t)\n\t\t}\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<GeoShapeBody shape={shape} />\n\t\t\t\t{textEl}\n\t\t\t</>\n\t\t)\n\t}\n\n\toverride getCanvasSvgDefs(): TLShapeUtilCanvasSvgDef[] {\n\t\treturn [getFillDefForCanvas()]\n\t}\n\n\toverride onResize: TLOnResizeHandler<TLGeoShape> = (\n\t\tshape,\n\t\t{ handle, newPoint, scaleX, scaleY, initialShape }\n\t) => {\n\t\t// use the w/h from props here instead of the initialBounds here,\n\t\t// since cloud shapes calculated bounds can differ from the props w/h.\n\t\tlet w = initialShape.props.w * scaleX\n\t\tlet h = (initialShape.props.h + initialShape.props.growY) * scaleY\n\t\tlet overShrinkX = 0\n\t\tlet overShrinkY = 0\n\n\t\tif (shape.props.text.trim()) {\n\t\t\tlet newW = Math.max(Math.abs(w), MIN_SIZE_WITH_LABEL)\n\t\t\tlet newH = Math.max(Math.abs(h), MIN_SIZE_WITH_LABEL)\n\n\t\t\tif (newW < MIN_SIZE_WITH_LABEL && newH === MIN_SIZE_WITH_LABEL) {\n\t\t\t\tnewW = MIN_SIZE_WITH_LABEL\n\t\t\t}\n\n\t\t\tif (newW === MIN_SIZE_WITH_LABEL && newH < MIN_SIZE_WITH_LABEL) {\n\t\t\t\tnewH = MIN_SIZE_WITH_LABEL\n\t\t\t}\n\n\t\t\tconst labelSize = getLabelSize(this.editor, {\n\t\t\t\t...shape,\n\t\t\t\tprops: {\n\t\t\t\t\t...shape.props,\n\t\t\t\t\tw: newW,\n\t\t\t\t\th: newH,\n\t\t\t\t},\n\t\t\t})\n\n\t\t\tconst nextW = Math.max(Math.abs(w), labelSize.w) * Math.sign(w)\n\t\t\tconst nextH = Math.max(Math.abs(h), labelSize.h) * Math.sign(h)\n\t\t\toverShrinkX = Math.abs(nextW) - Math.abs(w)\n\t\t\toverShrinkY = Math.abs(nextH) - Math.abs(h)\n\n\t\t\tw = nextW\n\t\t\th = nextH\n\t\t}\n\n\t\tconst offset = new Vec(0, 0)\n\n\t\t// x offsets\n\n\t\tif (scaleX < 0) {\n\t\t\toffset.x += w\n\t\t}\n\n\t\tif (handle === 'left' || handle === 'top_left' || handle === 'bottom_left') {\n\t\t\toffset.x += scaleX < 0 ? overShrinkX : -overShrinkX\n\t\t}\n\n\t\t// y offsets\n\n\t\tif (scaleY < 0) {\n\t\t\toffset.y += h\n\t\t}\n\n\t\tif (handle === 'top' || handle === 'top_left' || handle === 'top_right') {\n\t\t\toffset.y += scaleY < 0 ? overShrinkY : -overShrinkY\n\t\t}\n\n\t\tconst { x, y } = offset.rot(shape.rotation).add(newPoint)\n\n\t\treturn {\n\t\t\tx,\n\t\t\ty,\n\t\t\tprops: {\n\t\t\t\tw: Math.max(Math.abs(w), 1),\n\t\t\t\th: Math.max(Math.abs(h), 1),\n\t\t\t\tgrowY: 0,\n\t\t\t},\n\t\t}\n\t}\n\n\toverride onBeforeCreate = (shape: TLGeoShape) => {\n\t\tif (!shape.props.text) {\n\t\t\tif (shape.props.growY) {\n\t\t\t\t// No text / some growY, set growY to 0\n\t\t\t\treturn {\n\t\t\t\t\t...shape,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...shape.props,\n\t\t\t\t\t\tgrowY: 0,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// No text / no growY, nothing to change\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tconst prevHeight = shape.props.h\n\t\tconst nextHeight = getLabelSize(this.editor, shape).h\n\n\t\tlet growY: number | null = null\n\n\t\tif (nextHeight > prevHeight) {\n\t\t\tgrowY = nextHeight - prevHeight\n\t\t} else {\n\t\t\tif (shape.props.growY) {\n\t\t\t\tgrowY = 0\n\t\t\t}\n\t\t}\n\n\t\tif (growY !== null) {\n\t\t\treturn {\n\t\t\t\t...shape,\n\t\t\t\tprops: {\n\t\t\t\t\t...shape.props,\n\t\t\t\t\tgrowY,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onBeforeUpdate = (prev: TLGeoShape, next: TLGeoShape) => {\n\t\tconst prevText = prev.props.text\n\t\tconst nextText = next.props.text\n\n\t\tif (\n\t\t\tprevText === nextText &&\n\t\t\tprev.props.font === next.props.font &&\n\t\t\tprev.props.size === next.props.size\n\t\t) {\n\t\t\treturn\n\t\t}\n\n\t\tif (prevText && !nextText) {\n\t\t\treturn {\n\t\t\t\t...next,\n\t\t\t\tprops: {\n\t\t\t\t\t...next.props,\n\t\t\t\t\tgrowY: 0,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\n\t\tconst prevWidth = prev.props.w\n\t\tconst prevHeight = prev.props.h\n\t\tconst nextSize = getLabelSize(this.editor, next)\n\t\tconst nextWidth = nextSize.w\n\t\tconst nextHeight = nextSize.h\n\n\t\t// When entering the first character in a label (not pasting in multiple characters...)\n\t\tif (!prevText && nextText && nextText.length === 1) {\n\t\t\tlet w = Math.max(prevWidth, nextWidth)\n\t\t\tlet h = Math.max(prevHeight, nextHeight)\n\n\t\t\t// If both the width and height were less than the minimum size, make the shape square\n\t\t\tif (prev.props.w < MIN_SIZE_WITH_LABEL && prev.props.h < MIN_SIZE_WITH_LABEL) {\n\t\t\t\tw = Math.max(w, MIN_SIZE_WITH_LABEL)\n\t\t\t\th = Math.max(h, MIN_SIZE_WITH_LABEL)\n\t\t\t\tw = Math.max(w, h)\n\t\t\t\th = Math.max(w, h)\n\t\t\t}\n\n\t\t\t// Don't set a growY\u2014at least, not until we've implemented a growX property\n\t\t\treturn {\n\t\t\t\t...next,\n\t\t\t\tprops: {\n\t\t\t\t\t...next.props,\n\t\t\t\t\tw,\n\t\t\t\t\th,\n\t\t\t\t\tgrowY: 0,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\n\t\tlet growY: number | null = null\n\n\t\tif (nextHeight > prevHeight) {\n\t\t\tgrowY = nextHeight - prevHeight\n\t\t} else {\n\t\t\tif (prev.props.growY) {\n\t\t\t\tgrowY = 0\n\t\t\t}\n\t\t}\n\n\t\tif (growY !== null) {\n\t\t\treturn {\n\t\t\t\t...next,\n\t\t\t\tprops: {\n\t\t\t\t\t...next.props,\n\t\t\t\t\tgrowY,\n\t\t\t\t\tw: Math.max(next.props.w, nextWidth),\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\n\t\tif (nextWidth > prev.props.w) {\n\t\t\treturn {\n\t\t\t\t...next,\n\t\t\t\tprops: {\n\t\t\t\t\t...next.props,\n\t\t\t\t\tw: nextWidth,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onDoubleClick = (shape: TLGeoShape) => {\n\t\t// Little easter egg: double-clicking a rectangle / checkbox while\n\t\t// holding alt will toggle between check-box and rectangle\n\t\tif (this.editor.inputs.altKey) {\n\t\t\tswitch (shape.props.geo) {\n\t\t\t\tcase 'rectangle': {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...shape,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tgeo: 'check-box' as const,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcase 'check-box': {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...shape,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tgeo: 'rectangle' as const,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn\n\t}\n}\n\nfunction getLabelSize(editor: Editor, shape: TLGeoShape) {\n\tconst text = shape.props.text\n\n\tif (!text) {\n\t\treturn { w: 0, h: 0 }\n\t}\n\n\tconst minSize = editor.textMeasure.measureText('w', {\n\t\t...TEXT_PROPS,\n\t\tfontFamily: FONT_FAMILIES[shape.props.font],\n\t\tfontSize: LABEL_FONT_SIZES[shape.props.size],\n\t\tmaxWidth: 100,\n\t})\n\n\t// TODO: Can I get these from somewhere?\n\tconst sizes = {\n\t\ts: 2,\n\t\tm: 3.5,\n\t\tl: 5,\n\t\txl: 10,\n\t}\n\n\tconst size = editor.textMeasure.measureText(text, {\n\t\t...TEXT_PROPS,\n\t\tfontFamily: FONT_FAMILIES[shape.props.font],\n\t\tfontSize: LABEL_FONT_SIZES[shape.props.size],\n\t\tminWidth: minSize.w,\n\t\tmaxWidth: Math.max(\n\t\t\t// Guard because a DOM nodes can't be less 0\n\t\t\t0,\n\t\t\t// A 'w' width that we're setting as the min-width\n\t\t\tMath.ceil(minSize.w + sizes[shape.props.size]),\n\t\t\t// The actual text size\n\t\t\tMath.ceil(shape.props.w - LABEL_PADDING * 2)\n\t\t),\n\t})\n\n\treturn {\n\t\tw: size.w + LABEL_PADDING * 2,\n\t\th: size.h + LABEL_PADDING * 2,\n\t}\n}\n", "import { Vec, VecLike, toDomPrecision } from '@tldraw/editor'\n\nfunction precise(A: VecLike) {\n\treturn `${toDomPrecision(A.x)},${toDomPrecision(A.y)} `\n}\n\nfunction rng(seed = '') {\n\tlet x = 0\n\tlet y = 0\n\tlet z = 0\n\tlet w = 0\n\n\tfunction next() {\n\t\tconst t = x ^ (x << 11)\n\t\tx = y\n\t\ty = z\n\t\tz = w\n\t\tw ^= ((w >>> 19) ^ t ^ (t >>> 8)) >>> 0\n\t\treturn (w / 0x100000000) * 2\n\t}\n\n\tfor (let k = 0; k < seed.length + 64; k++) {\n\t\tx ^= seed.charCodeAt(k) | 0\n\t\tnext()\n\t}\n\n\treturn next\n}\n\n/** @public */\nexport function getRoundedInkyPolygonPath(points: VecLike[]) {\n\tlet polylineA = `M`\n\n\tconst len = points.length\n\n\tlet p0: VecLike\n\tlet p1: VecLike\n\tlet p2: VecLike\n\n\tfor (let i = 0, n = len; i < n; i += 3) {\n\t\tp0 = points[i]\n\t\tp1 = points[i + 1]\n\t\tp2 = points[i + 2]\n\n\t\tpolylineA += `${precise(p0)}L${precise(p1)}Q${precise(p2)}`\n\t}\n\n\tpolylineA += `${precise(points[0])}`\n\n\treturn polylineA\n}\n\n/** @public */\nexport function getRoundedPolygonPoints(\n\tid: string,\n\toutline: VecLike[],\n\toffset: number,\n\troundness: number,\n\tpasses: number\n) {\n\tconst results: VecLike[] = []\n\n\tconst random = rng(id)\n\tlet p0 = outline[0]\n\tlet p1: VecLike\n\n\tconst len = outline.length\n\n\tfor (let i = 0, n = len * passes; i < n; i++) {\n\t\tp1 = Vec.AddXY(outline[(i + 1) % len], random() * offset, random() * offset)\n\n\t\tconst delta = Vec.Sub(p1, p0)\n\t\tconst distance = Vec.Len(delta)\n\t\tconst vector = Vec.Div(delta, distance).mul(Math.min(distance / 4, roundness))\n\t\tresults.push(Vec.Add(p0, vector), Vec.Add(p1, vector.neg()), p1)\n\n\t\tp0 = p1\n\t}\n\n\treturn results\n}\n\n/** @public */\nexport function getDrawLinePathData(id: string, outline: VecLike[], strokeWidth: number) {\n\tlet innerPathData = `M ${precise(outline[0])}L`\n\tlet outerPathData2 = `M ${precise(outline[0])}L`\n\n\tconst offset = strokeWidth / 3\n\tconst roundness = strokeWidth * 2\n\n\tconst random = rng(id)\n\tlet p0 = outline[0]\n\tlet p1: VecLike\n\n\tlet s0 = outline[0]\n\tlet s1: VecLike\n\n\tconst len = outline.length\n\n\tfor (let i = 0, n = len - 1; i < n; i++) {\n\t\tp1 = outline[i + 1]\n\t\ts1 = Vec.AddXY(outline[i + 1], random() * offset, random() * offset)\n\n\t\tconst delta = Vec.Sub(p1, p0)\n\t\tconst distance = Vec.Len(delta)\n\t\tconst vector = Vec.Div(delta, distance).mul(Math.min(distance / 4, roundness))\n\n\t\tconst q0 = Vec.Add(p0, vector)\n\t\tconst q1 = Vec.Add(p1, vector.neg())\n\n\t\tconst sDelta = Vec.Sub(s1, s0)\n\t\tconst sDistance = Vec.Len(sDelta)\n\t\tconst sVector = Vec.Div(sDelta, sDistance).mul(Math.min(sDistance / 4, roundness))\n\n\t\tconst sq0 = Vec.Add(s0, sVector)\n\t\tconst sq1 = Vec.Add(s1, sVector.neg())\n\n\t\tif (i === n - 1) {\n\t\t\tinnerPathData += `${precise(q0)}L ${precise(p1)}`\n\t\t\touterPathData2 += `${precise(sq0)}L ${precise(s1)}`\n\t\t} else {\n\t\t\tinnerPathData += `${precise(q0)}L ${precise(q1)}Q ${precise(p1)}`\n\t\t\touterPathData2 += `${precise(sq0)}L ${precise(sq1)}Q ${precise(s1)}`\n\n\t\t\tp0 = p1\n\t\t\ts0 = s1\n\t\t}\n\t}\n\n\treturn [innerPathData, innerPathData + outerPathData2]\n}\n", "import {\n\tPI,\n\tTLDefaultSizeStyle,\n\tVec,\n\tVecModel,\n\tclockwiseAngleDist,\n\tgetPointOnCircle,\n\trng,\n\ttoDomPrecision,\n} from '@tldraw/editor'\n\nfunction getPillCircumference(width: number, height: number) {\n\tconst radius = Math.min(width, height) / 2\n\tconst longSide = Math.max(width, height) - radius * 2\n\n\treturn Math.PI * (radius * 2) + 2 * longSide\n}\n\ntype PillSection =\n\t| {\n\t\t\ttype: 'straight'\n\t\t\tstart: VecModel\n\t\t\tdelta: VecModel\n\t  }\n\t| {\n\t\t\ttype: 'arc'\n\t\t\tcenter: VecModel\n\t\t\tstartAngle: number\n\t  }\n\nfunction getPillPoints(width: number, height: number, numPoints: number) {\n\tconst radius = Math.min(width, height) / 2\n\tconst longSide = Math.max(width, height) - radius * 2\n\n\tconst circumference = Math.PI * (radius * 2) + 2 * longSide\n\n\tconst spacing = circumference / numPoints\n\n\tconst sections: PillSection[] =\n\t\twidth > height\n\t\t\t? [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'straight',\n\t\t\t\t\t\tstart: new Vec(radius, 0),\n\t\t\t\t\t\tdelta: new Vec(1, 0),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'arc',\n\t\t\t\t\t\tcenter: new Vec(width - radius, radius),\n\t\t\t\t\t\tstartAngle: -PI / 2,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'straight',\n\t\t\t\t\t\tstart: new Vec(width - radius, height),\n\t\t\t\t\t\tdelta: new Vec(-1, 0),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'arc',\n\t\t\t\t\t\tcenter: new Vec(radius, radius),\n\t\t\t\t\t\tstartAngle: PI / 2,\n\t\t\t\t\t},\n\t\t\t\t]\n\t\t\t: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'straight',\n\t\t\t\t\t\tstart: new Vec(width, radius),\n\t\t\t\t\t\tdelta: new Vec(0, 1),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'arc',\n\t\t\t\t\t\tcenter: new Vec(radius, height - radius),\n\t\t\t\t\t\tstartAngle: 0,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'straight',\n\t\t\t\t\t\tstart: new Vec(0, height - radius),\n\t\t\t\t\t\tdelta: new Vec(0, -1),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'arc',\n\t\t\t\t\t\tcenter: new Vec(radius, radius),\n\t\t\t\t\t\tstartAngle: PI,\n\t\t\t\t\t},\n\t\t\t\t]\n\n\tlet sectionOffset = 0\n\n\tconst points: Vec[] = []\n\tfor (let i = 0; i < numPoints; i++) {\n\t\tconst section = sections[0]\n\t\tif (section.type === 'straight') {\n\t\t\tpoints.push(Vec.Add(section.start, Vec.Mul(section.delta, sectionOffset)))\n\t\t} else {\n\t\t\tpoints.push(\n\t\t\t\tgetPointOnCircle(section.center, radius, section.startAngle + sectionOffset / radius)\n\t\t\t)\n\t\t}\n\t\tsectionOffset += spacing\n\t\tlet sectionLength = section.type === 'straight' ? longSide : PI * radius\n\t\twhile (sectionOffset > sectionLength) {\n\t\t\tsectionOffset -= sectionLength\n\t\t\tsections.push(sections.shift()!)\n\t\t\tsectionLength = sections[0].type === 'straight' ? longSide : PI * radius\n\t\t}\n\t}\n\n\treturn points\n}\n\nconst switchSize = <T>(size: TLDefaultSizeStyle, s: T, m: T, l: T, xl: T) => {\n\tswitch (size) {\n\t\tcase 's':\n\t\t\treturn s\n\t\tcase 'm':\n\t\t\treturn m\n\t\tcase 'l':\n\t\t\treturn l\n\t\tcase 'xl':\n\t\t\treturn xl\n\t}\n}\n\nexport function getCloudArcs(\n\twidth: number,\n\theight: number,\n\tseed: string,\n\tsize: TLDefaultSizeStyle\n) {\n\tconst getRandom = rng(seed)\n\tconst pillCircumference = getPillCircumference(width, height)\n\tconst numBumps = Math.max(\n\t\tMath.ceil(pillCircumference / switchSize(size, 50, 70, 100, 130)),\n\t\t6,\n\t\tMath.ceil(pillCircumference / Math.min(width, height))\n\t)\n\tconst targetBumpProtrusion = (pillCircumference / numBumps) * 0.2\n\n\t// if the aspect ratio is high, innerWidth should be smaller\n\tconst innerWidth = Math.max(width - targetBumpProtrusion * 2, 1)\n\tconst innerHeight = Math.max(height - targetBumpProtrusion * 2, 1)\n\tconst paddingX = (width - innerWidth) / 2\n\tconst paddingY = (height - innerHeight) / 2\n\n\tconst distanceBetweenPointsOnPerimeter = getPillCircumference(innerWidth, innerHeight) / numBumps\n\n\tconst bumpPoints = getPillPoints(innerWidth, innerHeight, numBumps).map((p) => {\n\t\treturn p.addXY(paddingX, paddingY)\n\t})\n\n\tconst maxWiggleX = width < 20 ? 0 : targetBumpProtrusion * 0.3\n\tconst maxWiggleY = height < 20 ? 0 : targetBumpProtrusion * 0.3\n\n\t// wiggle the points from either end so that the bumps 'pop'\n\t// in at the bottom-right and the top-left looks relatively stable\n\tconst wiggledPoints = bumpPoints.slice(0)\n\tfor (let i = 0; i < Math.floor(numBumps / 2); i++) {\n\t\twiggledPoints[i] = Vec.AddXY(\n\t\t\twiggledPoints[i],\n\t\t\tgetRandom() * maxWiggleX,\n\t\t\tgetRandom() * maxWiggleY\n\t\t)\n\t\twiggledPoints[numBumps - i - 1] = Vec.AddXY(\n\t\t\twiggledPoints[numBumps - i - 1],\n\t\t\tgetRandom() * maxWiggleX,\n\t\t\tgetRandom() * maxWiggleY\n\t\t)\n\t}\n\n\tconst arcs: Arc[] = []\n\n\tfor (let i = 0; i < wiggledPoints.length; i++) {\n\t\tconst j = i === wiggledPoints.length - 1 ? 0 : i + 1\n\t\tconst leftWigglePoint = wiggledPoints[i]\n\t\tconst rightWigglePoint = wiggledPoints[j]\n\t\tconst leftPoint = bumpPoints[i]\n\t\tconst rightPoint = bumpPoints[j]\n\n\t\tconst midPoint = Vec.Average([leftPoint, rightPoint])\n\t\tconst offsetAngle = Vec.Angle(leftPoint, rightPoint) - Math.PI / 2\n\t\t// when the points are on the curvy part of a pill, there is a natural arc that we need to extends past\n\t\t// otherwise it looks like the bumps get less bumpy on the curvy parts\n\t\tconst distanceBetweenOriginalPoints = Vec.Dist(leftPoint, rightPoint)\n\t\tconst curvatureOffset = distanceBetweenPointsOnPerimeter - distanceBetweenOriginalPoints\n\t\tconst distanceBetweenWigglePoints = Vec.Dist(leftWigglePoint, rightWigglePoint)\n\t\tconst relativeSize = distanceBetweenWigglePoints / distanceBetweenOriginalPoints\n\t\tconst finalDistance = (Math.max(paddingX, paddingY) + curvatureOffset) * relativeSize\n\n\t\tconst arcPoint = Vec.Add(midPoint, Vec.FromAngle(offsetAngle, finalDistance))\n\t\tif (arcPoint.x < 0) {\n\t\t\tarcPoint.x = 0\n\t\t} else if (arcPoint.x > width) {\n\t\t\tarcPoint.x = width\n\t\t}\n\t\tif (arcPoint.y < 0) {\n\t\t\tarcPoint.y = 0\n\t\t} else if (arcPoint.y > height) {\n\t\t\tarcPoint.y = height\n\t\t}\n\n\t\tconst center = getCenterOfCircleGivenThreePoints(leftWigglePoint, rightWigglePoint, arcPoint)\n\t\tconst radius = Vec.Dist(\n\t\t\tcenter ? center : Vec.Average([leftWigglePoint, rightWigglePoint]),\n\t\t\tleftWigglePoint\n\t\t)\n\n\t\tarcs.push({\n\t\t\tleftPoint: leftWigglePoint,\n\t\t\trightPoint: rightWigglePoint,\n\t\t\tarcPoint,\n\t\t\tcenter,\n\t\t\tradius,\n\t\t})\n\t}\n\n\treturn arcs\n}\n\ntype Arc = {\n\tleftPoint: Vec\n\trightPoint: Vec\n\tarcPoint: Vec\n\tcenter: Vec | null\n\tradius: number\n}\n\nfunction getCenterOfCircleGivenThreePoints(a: Vec, b: Vec, c: Vec) {\n\tconst A = a.x * (b.y - c.y) - a.y * (b.x - c.x) + b.x * c.y - c.x * b.y\n\tconst B =\n\t\t(a.x * a.x + a.y * a.y) * (c.y - b.y) +\n\t\t(b.x * b.x + b.y * b.y) * (a.y - c.y) +\n\t\t(c.x * c.x + c.y * c.y) * (b.y - a.y)\n\tconst C =\n\t\t(a.x * a.x + a.y * a.y) * (b.x - c.x) +\n\t\t(b.x * b.x + b.y * b.y) * (c.x - a.x) +\n\t\t(c.x * c.x + c.y * c.y) * (a.x - b.x)\n\n\tconst x = -B / (2 * A)\n\tconst y = -C / (2 * A)\n\n\t// handle situations where the points are colinear (this happens when the cloud is very small)\n\tif (!Number.isFinite(x) || !Number.isFinite(y)) {\n\t\treturn null\n\t}\n\n\treturn new Vec(x, y)\n}\n\nexport function cloudOutline(\n\twidth: number,\n\theight: number,\n\tseed: string,\n\tsize: TLDefaultSizeStyle\n) {\n\tconst path: Vec[] = []\n\n\tconst arcs = getCloudArcs(width, height, seed, size)\n\n\tfor (const { center, radius, leftPoint, rightPoint } of arcs) {\n\t\tpath.push(...pointsOnArc(leftPoint, rightPoint, center, radius, 10))\n\t}\n\n\treturn path\n}\n\nexport function cloudSvgPath(\n\twidth: number,\n\theight: number,\n\tseed: string,\n\tsize: TLDefaultSizeStyle\n) {\n\t// const points = cloudOutline(width, height, seed, size)\n\t// {\n\t// \tlet path = `M${toDomPrecision(points[0].x)},${toDomPrecision(points[0].y)}`\n\t// \tfor (const point of points.slice(1)) {\n\t// \t\tpath += ` L${toDomPrecision(point.x)},${toDomPrecision(point.y)}`\n\t// \t}\n\t// \treturn path\n\t// }\n\n\tconst arcs = getCloudArcs(width, height, seed, size)\n\tlet path = `M${toDomPrecision(arcs[0].leftPoint.x)},${toDomPrecision(arcs[0].leftPoint.y)}`\n\n\t// now draw arcs for each circle, starting where it intersects the previous circle, and ending where it intersects the next circle\n\tfor (const { leftPoint, rightPoint, radius, center } of arcs) {\n\t\tif (center === null) {\n\t\t\t// draw a line to rightPoint instead\n\t\t\tpath += ` L${toDomPrecision(rightPoint.x)},${toDomPrecision(rightPoint.y)}`\n\t\t\tcontinue\n\t\t}\n\t\t// use the large arc if the center of the circle is to the left of the line between the two points\n\t\tconst arc = isLeft(leftPoint, rightPoint, center) ? '0' : '1'\n\t\tpath += ` A${toDomPrecision(radius)},${toDomPrecision(radius)} 0 ${arc},1 ${toDomPrecision(\n\t\t\trightPoint.x\n\t\t)},${toDomPrecision(rightPoint.y)}`\n\t}\n\n\tpath += ' Z'\n\treturn path\n}\n\nexport function inkyCloudSvgPath(\n\twidth: number,\n\theight: number,\n\tseed: string,\n\tsize: TLDefaultSizeStyle\n) {\n\tconst getRandom = rng(seed)\n\tconst mutMultiplier = size === 's' ? 0.5 : size === 'm' ? 0.7 : size === 'l' ? 0.9 : 1.6\n\tconst mut = (n: number) => {\n\t\treturn n + getRandom() * mutMultiplier * 2\n\t}\n\tconst arcs = getCloudArcs(width, height, seed, size)\n\tconst avgArcLength =\n\t\tarcs.reduce((sum, arc) => sum + Vec.Dist2(arc.leftPoint, arc.rightPoint), 0) / arcs.length\n\tconst shouldMutatePoints = avgArcLength > (mutMultiplier * 15) ** 2\n\n\tconst mutPoint = shouldMutatePoints ? (p: Vec) => new Vec(mut(p.x), mut(p.y)) : (p: Vec) => p\n\tlet pathA = `M${toDomPrecision(arcs[0].leftPoint.x)},${toDomPrecision(arcs[0].leftPoint.y)}`\n\tlet leftMutPoint = mutPoint(arcs[0].leftPoint)\n\tlet pathB = `M${toDomPrecision(leftMutPoint.x)},${toDomPrecision(leftMutPoint.y)}`\n\n\tfor (const { leftPoint, center, rightPoint, radius, arcPoint } of arcs) {\n\t\tif (center === null) {\n\t\t\t// draw a line to rightPoint instead\n\t\t\tpathA += ` L${toDomPrecision(rightPoint.x)},${toDomPrecision(rightPoint.y)}`\n\t\t\tconst rightMutPoint = mutPoint(rightPoint)\n\t\t\tpathB += ` L${toDomPrecision(rightMutPoint.x)},${toDomPrecision(rightMutPoint.y)}`\n\t\t\tleftMutPoint = rightMutPoint\n\t\t\tcontinue\n\t\t}\n\t\tconst arc = isLeft(leftPoint, rightPoint, center) ? '0' : '1'\n\t\tpathA += ` A${toDomPrecision(radius)},${toDomPrecision(radius)} 0 ${arc},1 ${toDomPrecision(\n\t\t\trightPoint.x\n\t\t)},${toDomPrecision(rightPoint.y)}`\n\t\tconst rightMutPoint = mutPoint(rightPoint)\n\t\tconst mutArcPoint = mutPoint(arcPoint)\n\t\tconst mutCenter = getCenterOfCircleGivenThreePoints(leftMutPoint, rightMutPoint, mutArcPoint)\n\t\tif (!mutCenter) {\n\t\t\t// draw a line to rightMutPoint instead\n\t\t\tpathB += ` L${toDomPrecision(rightMutPoint.x)},${toDomPrecision(rightMutPoint.y)}`\n\t\t\tleftMutPoint = rightMutPoint\n\t\t\tcontinue\n\t\t}\n\t\tconst mutRadius = Math.abs(Vec.Dist(mutCenter, leftMutPoint))\n\n\t\tpathB += ` A${toDomPrecision(mutRadius)},${toDomPrecision(\n\t\t\tmutRadius\n\t\t)} 0 ${arc},1 ${toDomPrecision(rightMutPoint.x)},${toDomPrecision(rightMutPoint.y)}`\n\t\tleftMutPoint = rightMutPoint\n\t}\n\n\treturn pathA + pathB + ' Z'\n}\n\nfunction pointsOnArc(\n\tstartPoint: VecModel,\n\tendPoint: VecModel,\n\tcenter: VecModel | null,\n\tradius: number,\n\tnumPoints: number\n): Vec[] {\n\tif (center === null) {\n\t\treturn [Vec.From(startPoint), Vec.From(endPoint)]\n\t}\n\tconst results: Vec[] = []\n\n\tconst startAngle = Vec.Angle(center, startPoint)\n\tconst endAngle = Vec.Angle(center, endPoint)\n\n\tconst l = clockwiseAngleDist(startAngle, endAngle)\n\n\tfor (let i = 0; i < numPoints; i++) {\n\t\tconst t = i / (numPoints - 1)\n\t\tconst angle = startAngle + l * t\n\t\tconst point = getPointOnCircle(center, radius, angle)\n\t\tresults.push(point)\n\t}\n\n\treturn results\n}\n\nfunction isLeft(a: Vec, b: Vec, c: Vec) {\n\treturn (b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x) > 0\n}\n", "import { EASINGS, HALF_PI, PI2, Vec, perimeterOfEllipse, rng } from '@tldraw/editor'\nimport { getStrokePoints } from '../../shared/freehand/getStrokePoints'\nimport { getSvgPathFromStrokePoints } from '../../shared/freehand/svg'\n\nfunction getEllipseStrokeOptions(strokeWidth: number) {\n\treturn {\n\t\tsize: 1 + strokeWidth,\n\t\tthinning: 0.25,\n\t\tend: { taper: strokeWidth },\n\t\tstart: { taper: strokeWidth },\n\t\tstreamline: 0,\n\t\tsmoothing: 1,\n\t\tsimulatePressure: false,\n\t}\n}\n\nfunction getEllipseStrokePoints(id: string, width: number, height: number, strokeWidth: number) {\n\tconst getRandom = rng(id)\n\n\tconst rx = width / 2\n\tconst ry = height / 2\n\tconst perimeter = perimeterOfEllipse(rx, ry)\n\n\tconst points: Vec[] = []\n\n\tconst start = PI2 * getRandom()\n\tconst length = PI2 + HALF_PI / 2 + Math.abs(getRandom()) * HALF_PI\n\tconst count = Math.max(16, perimeter / 10)\n\n\tfor (let i = 0; i < count; i++) {\n\t\tconst t = i / (count - 1)\n\t\tconst r = start + t * length\n\t\tconst c = Math.cos(r)\n\t\tconst s = Math.sin(r)\n\t\tpoints.push(\n\t\t\tnew Vec(\n\t\t\t\trx * c + width * 0.5 + 0.05 * getRandom(),\n\t\t\t\try * s + height / 2 + 0.05 * getRandom(),\n\t\t\t\tMath.min(\n\t\t\t\t\t1,\n\t\t\t\t\t0.5 +\n\t\t\t\t\t\tMath.abs(0.5 - (getRandom() > 0 ? EASINGS.easeInOutSine(t) : EASINGS.easeInExpo(t))) / 2\n\t\t\t\t)\n\t\t\t)\n\t\t)\n\t}\n\n\treturn getStrokePoints(points, getEllipseStrokeOptions(strokeWidth))\n}\n\nexport function getEllipseIndicatorPath(\n\tid: string,\n\twidth: number,\n\theight: number,\n\tstrokeWidth: number\n) {\n\treturn getSvgPathFromStrokePoints(getEllipseStrokePoints(id, width, height, strokeWidth))\n}\n", "import { Group2d, TLGeoShape, useEditor } from '@tldraw/editor'\nimport { STROKE_SIZES } from '../../shared/default-shape-constants'\nimport { getLines } from '../getLines'\nimport { DashStyleCloud } from './DashStyleCloud'\nimport { DashStyleEllipse } from './DashStyleEllipse'\nimport { DashStyleOval } from './DashStyleOval'\nimport { DashStylePolygon } from './DashStylePolygon'\nimport { DrawStyleCloud } from './DrawStyleCloud'\nimport { DrawStylePolygon } from './DrawStylePolygon'\nimport { SolidStyleCloud } from './SolidStyleCloud'\nimport { SolidStyleEllipse } from './SolidStyleEllipse'\nimport { SolidStyleOval } from './SolidStyleOval'\nimport { SolidStylePolygon } from './SolidStylePolygon'\n\nexport function GeoShapeBody({ shape }: { shape: TLGeoShape }) {\n\tconst editor = useEditor()\n\tconst { id, props } = shape\n\tconst { w, color, fill, dash, growY, size } = props\n\tconst strokeWidth = STROKE_SIZES[size]\n\tconst h = props.h + growY\n\n\tswitch (props.geo) {\n\t\tcase 'cloud': {\n\t\t\tif (dash === 'solid') {\n\t\t\t\treturn (\n\t\t\t\t\t<SolidStyleCloud\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\tw={w}\n\t\t\t\t\t\th={h}\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\tsize={size}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t} else if (dash === 'dashed' || dash === 'dotted') {\n\t\t\t\treturn (\n\t\t\t\t\t<DashStyleCloud\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\tw={w}\n\t\t\t\t\t\th={h}\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\tsize={size}\n\t\t\t\t\t\tdash={dash}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t} else if (dash === 'draw') {\n\t\t\t\treturn (\n\t\t\t\t\t<DrawStyleCloud\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\tw={w}\n\t\t\t\t\t\th={h}\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\tsize={size}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t}\n\n\t\t\tbreak\n\t\t}\n\t\tcase 'ellipse': {\n\t\t\tif (dash === 'solid') {\n\t\t\t\treturn <SolidStyleEllipse strokeWidth={strokeWidth} w={w} h={h} color={color} fill={fill} />\n\t\t\t} else if (dash === 'dashed' || dash === 'dotted') {\n\t\t\t\treturn (\n\t\t\t\t\t<DashStyleEllipse\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\tw={w}\n\t\t\t\t\t\th={h}\n\t\t\t\t\t\tdash={dash}\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t} else if (dash === 'draw') {\n\t\t\t\treturn <SolidStyleEllipse strokeWidth={strokeWidth} w={w} h={h} color={color} fill={fill} />\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t\tcase 'oval': {\n\t\t\tif (dash === 'solid') {\n\t\t\t\treturn <SolidStyleOval strokeWidth={strokeWidth} w={w} h={h} color={color} fill={fill} />\n\t\t\t} else if (dash === 'dashed' || dash === 'dotted') {\n\t\t\t\treturn (\n\t\t\t\t\t<DashStyleOval\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\tw={w}\n\t\t\t\t\t\th={h}\n\t\t\t\t\t\tdash={dash}\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t} else if (dash === 'draw') {\n\t\t\t\treturn <SolidStyleOval strokeWidth={strokeWidth} w={w} h={h} color={color} fill={fill} />\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t\tdefault: {\n\t\t\tconst geometry = editor.getShapeGeometry(shape)\n\t\t\tconst outline =\n\t\t\t\tgeometry instanceof Group2d ? geometry.children[0].vertices : geometry.vertices\n\t\t\tconst lines = getLines(shape.props, strokeWidth)\n\n\t\t\tif (dash === 'solid') {\n\t\t\t\treturn (\n\t\t\t\t\t<SolidStylePolygon\n\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\toutline={outline}\n\t\t\t\t\t\tlines={lines}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t} else if (dash === 'dashed' || dash === 'dotted') {\n\t\t\t\treturn (\n\t\t\t\t\t<DashStylePolygon\n\t\t\t\t\t\tdash={dash}\n\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\toutline={outline}\n\t\t\t\t\t\tlines={lines}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t} else if (dash === 'draw') {\n\t\t\t\treturn (\n\t\t\t\t\t<DrawStylePolygon\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\tfill={fill}\n\t\t\t\t\t\tcolor={color}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\toutline={outline}\n\t\t\t\t\t\tlines={lines}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\t}\n}\n", "import { TLDefaultDashStyle, TLGeoShape, Vec } from '@tldraw/editor'\n\nexport function getLines(props: TLGeoShape['props'], sw: number) {\n\tswitch (props.geo) {\n\t\tcase 'x-box': {\n\t\t\treturn getXBoxLines(props.w, props.h, sw, props.dash)\n\t\t}\n\t\tcase 'check-box': {\n\t\t\treturn getCheckBoxLines(props.w, props.h)\n\t\t}\n\t\tdefault: {\n\t\t\treturn undefined\n\t\t}\n\t}\n}\nfunction getXBoxLines(w: number, h: number, sw: number, dash: TLDefaultDashStyle) {\n\tconst inset = dash === 'draw' ? 0.62 : 0\n\n\tif (dash === 'dashed') {\n\t\treturn [\n\t\t\t[new Vec(0, 0), new Vec(w / 2, h / 2)],\n\t\t\t[new Vec(w, h), new Vec(w / 2, h / 2)],\n\t\t\t[new Vec(0, h), new Vec(w / 2, h / 2)],\n\t\t\t[new Vec(w, 0), new Vec(w / 2, h / 2)],\n\t\t]\n\t}\n\n\tconst clampX = (x: number) => Math.max(0, Math.min(w, x))\n\tconst clampY = (y: number) => Math.max(0, Math.min(h, y))\n\n\treturn [\n\t\t[\n\t\t\tnew Vec(clampX(sw * inset), clampY(sw * inset)),\n\t\t\tnew Vec(clampX(w - sw * inset), clampY(h - sw * inset)),\n\t\t],\n\t\t[\n\t\t\tnew Vec(clampX(sw * inset), clampY(h - sw * inset)),\n\t\t\tnew Vec(clampX(w - sw * inset), clampY(sw * inset)),\n\t\t],\n\t]\n}\nfunction getCheckBoxLines(w: number, h: number) {\n\tconst size = Math.min(w, h) * 0.82\n\tconst ox = (w - size) / 2\n\tconst oy = (h - size) / 2\n\n\tconst clampX = (x: number) => Math.max(0, Math.min(w, x))\n\tconst clampY = (y: number) => Math.max(0, Math.min(h, y))\n\n\treturn [\n\t\t[\n\t\t\tnew Vec(clampX(ox + size * 0.25), clampY(oy + size * 0.52)),\n\t\t\tnew Vec(clampX(ox + size * 0.45), clampY(oy + size * 0.82)),\n\t\t],\n\t\t[\n\t\t\tnew Vec(clampX(ox + size * 0.45), clampY(oy + size * 0.82)),\n\t\t\tnew Vec(clampX(ox + size * 0.82), clampY(oy + size * 0.22)),\n\t\t],\n\t]\n}\n", "import { TLGeoShape, TLShapeId, Vec, canonicalizeRotation } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\nimport { getPerfectDashProps } from '../../shared/getPerfectDashProps'\nimport { cloudSvgPath, getCloudArcs } from '../cloudOutline'\n\nexport const DashStyleCloud = React.memo(function DashStylePolygon({\n\tdash,\n\tfill,\n\tcolor,\n\tstrokeWidth,\n\tw,\n\th,\n\tid,\n\tsize,\n}: Pick<TLGeoShape['props'], 'dash' | 'fill' | 'color' | 'w' | 'h' | 'size'> & {\n\tstrokeWidth: number\n\tid: TLShapeId\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst innerPath = cloudSvgPath(w, h, id, size)\n\tconst arcs = getCloudArcs(w, h, id, size)\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill theme={theme} d={innerPath} fill={fill} color={color} />\n\t\t\t<g strokeWidth={strokeWidth} stroke={theme[color].solid} fill=\"none\" pointerEvents=\"all\">\n\t\t\t\t{arcs.map(({ leftPoint, rightPoint, center, radius }, i) => {\n\t\t\t\t\tconst arcLength = center\n\t\t\t\t\t\t? radius *\n\t\t\t\t\t\t\tcanonicalizeRotation(\n\t\t\t\t\t\t\t\tcanonicalizeRotation(Vec.Angle(center, rightPoint)) -\n\t\t\t\t\t\t\t\t\tcanonicalizeRotation(Vec.Angle(center, leftPoint))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: Vec.Dist(leftPoint, rightPoint)\n\n\t\t\t\t\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(\n\t\t\t\t\t\tarcLength,\n\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstyle: dash,\n\t\t\t\t\t\t\tstart: 'outset',\n\t\t\t\t\t\t\tend: 'outset',\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\td={\n\t\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\t\t\t? `M${leftPoint.x},${leftPoint.y}A${radius},${radius},0,0,1,${rightPoint.x},${rightPoint.y}`\n\t\t\t\t\t\t\t\t\t: `M${leftPoint.x},${leftPoint.y}L${rightPoint.x},${rightPoint.y}`\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)\n\t\t\t\t})}\n\t\t\t</g>\n\t\t</>\n\t)\n})\n", "import { TLGeoShape, TLShapeId, perimeterOfEllipse, toDomPrecision } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\nimport { getPerfectDashProps } from '../../shared/getPerfectDashProps'\n\nexport const DashStyleEllipse = React.memo(function DashStyleEllipse({\n\tw,\n\th,\n\tstrokeWidth: sw,\n\tdash,\n\tcolor,\n\tfill,\n}: Pick<TLGeoShape['props'], 'w' | 'h' | 'dash' | 'color' | 'fill'> & {\n\tstrokeWidth: number\n\tid: TLShapeId\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst cx = w / 2\n\tconst cy = h / 2\n\tconst rx = Math.max(0, cx)\n\tconst ry = Math.max(0, cy)\n\n\tconst perimeter = perimeterOfEllipse(rx, ry)\n\n\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(\n\t\tperimeter < 64 ? perimeter * 2 : perimeter,\n\t\tsw,\n\t\t{\n\t\t\tstyle: dash,\n\t\t\tsnap: 4,\n\t\t\tclosed: true,\n\t\t}\n\t)\n\n\tconst d = `M${cx - rx},${cy}a${rx},${ry},0,1,1,${rx * 2},0a${rx},${ry},0,1,1,-${rx * 2},0`\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill theme={theme} d={d} color={color} fill={fill} />\n\t\t\t<path\n\t\t\t\td={d}\n\t\t\t\tstrokeWidth={sw}\n\t\t\t\twidth={toDomPrecision(w)}\n\t\t\t\theight={toDomPrecision(h)}\n\t\t\t\tfill=\"none\"\n\t\t\t\tstroke={theme[color].solid}\n\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\tpointerEvents=\"all\"\n\t\t\t/>\n\t\t</>\n\t)\n})\n", "import { TLGeoShape, TLShapeId, toDomPrecision } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\nimport { getPerfectDashProps } from '../../shared/getPerfectDashProps'\nimport { getOvalPerimeter, getOvalSolidPath } from '../helpers'\n\nexport const DashStyleOval = React.memo(function DashStyleOval({\n\tw,\n\th,\n\tstrokeWidth: sw,\n\tdash,\n\tcolor,\n\tfill,\n}: Pick<TLGeoShape['props'], 'w' | 'h' | 'dash' | 'color' | 'fill'> & {\n\tstrokeWidth: number\n\tid: TLShapeId\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst d = getOvalSolidPath(w, h)\n\tconst perimeter = getOvalPerimeter(w, h)\n\n\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(\n\t\tperimeter < 64 ? perimeter * 2 : perimeter,\n\t\tsw,\n\t\t{\n\t\t\tstyle: dash,\n\t\t\tsnap: 4,\n\t\t\tstart: 'outset',\n\t\t\tend: 'outset',\n\t\t\tclosed: true,\n\t\t}\n\t)\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill theme={theme} d={d} color={color} fill={fill} />\n\t\t\t<path\n\t\t\t\td={d}\n\t\t\t\tstrokeWidth={sw}\n\t\t\t\twidth={toDomPrecision(w)}\n\t\t\t\theight={toDomPrecision(h)}\n\t\t\t\tfill=\"none\"\n\t\t\t\tstroke={theme[color].solid}\n\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\tpointerEvents=\"all\"\n\t\t\t/>\n\t\t</>\n\t)\n})\n", "import { perimeterOfEllipse } from '@tldraw/editor'\n\nexport function getOvalSolidPath(w: number, h: number) {\n\tif (h > w) {\n\t\tconst offset = w / 2\n\n\t\treturn `\n    M0,${offset}\n    a${offset},${offset},0,1,1,${offset * 2},0\n    L${w},${h - offset}\n    a${offset},${offset},0,1,1,-${offset * 2},0\n    Z`\n\t}\n\n\tconst offset = h / 2\n\n\treturn `\n    M${offset},0\n    L${w - offset},0\n    a${offset},${offset},0,1,1,0,${offset * 2}\n    L${offset},${h}\n    a${offset},${offset},0,1,1,0,${-offset * 2}\n    Z`\n}\n\nexport function getOvalPerimeter(h: number, w: number) {\n\tif (h > w) {\n\t\tconst offset = w / 2\n\t\treturn perimeterOfEllipse(offset, offset) + (h - offset * 2) * 2\n\t}\n\n\tconst offset = h / 2\n\treturn perimeterOfEllipse(offset, offset) + (w - offset * 2) * 2\n}\n", "import { TLGeoShape, Vec, VecLike } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\nimport { getPerfectDashProps } from '../../shared/getPerfectDashProps'\n\nexport const DashStylePolygon = React.memo(function DashStylePolygon({\n\tdash,\n\tfill,\n\tcolor,\n\tstrokeWidth,\n\toutline,\n\tlines,\n}: Pick<TLGeoShape['props'], 'dash' | 'fill' | 'color'> & {\n\tstrokeWidth: number\n\toutline: VecLike[]\n\tlines?: VecLike[][]\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst innerPath = 'M' + outline[0] + 'L' + outline.slice(1) + 'Z'\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill theme={theme} d={innerPath} fill={fill} color={color} />\n\t\t\t<g strokeWidth={strokeWidth} stroke={theme[color].solid} fill=\"none\" pointerEvents=\"all\">\n\t\t\t\t{Array.from(Array(outline.length)).map((_, i) => {\n\t\t\t\t\tconst A = outline[i]\n\t\t\t\t\tconst B = outline[(i + 1) % outline.length]\n\n\t\t\t\t\tconst dist = Vec.Dist(A, B)\n\n\t\t\t\t\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(dist, strokeWidth, {\n\t\t\t\t\t\tstyle: dash,\n\t\t\t\t\t\tstart: 'outset',\n\t\t\t\t\t\tend: 'outset',\n\t\t\t\t\t})\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<line\n\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\tx1={A.x}\n\t\t\t\t\t\t\ty1={A.y}\n\t\t\t\t\t\t\tx2={B.x}\n\t\t\t\t\t\t\ty2={B.y}\n\t\t\t\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)\n\t\t\t\t})}\n\t\t\t\t{lines &&\n\t\t\t\t\tlines.map(([A, B], i) => {\n\t\t\t\t\t\tconst dist = Vec.Dist(A, B)\n\n\t\t\t\t\t\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(dist, strokeWidth, {\n\t\t\t\t\t\t\tstyle: dash,\n\t\t\t\t\t\t\tstart: 'skip',\n\t\t\t\t\t\t\tend: 'outset',\n\t\t\t\t\t\t\tsnap: dash === 'dotted' ? 4 : undefined,\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tkey={`line_fg_${i}`}\n\t\t\t\t\t\t\t\td={`M${A.x},${A.y}L${B.x},${B.y}`}\n\t\t\t\t\t\t\t\tstroke={theme[color].solid}\n\t\t\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\t\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)\n\t\t\t\t\t})}\n\t\t\t</g>\n\t\t</>\n\t)\n})\n", "import { TLGeoShape, TLShapeId } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\nimport { inkyCloudSvgPath } from '../cloudOutline'\n\nexport const DrawStyleCloud = React.memo(function StyleCloud({\n\tfill,\n\tcolor,\n\tstrokeWidth,\n\tw,\n\th,\n\tid,\n\tsize,\n}: Pick<TLGeoShape['props'], 'fill' | 'color' | 'w' | 'h' | 'size'> & {\n\tstrokeWidth: number\n\tid: TLShapeId\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst path = inkyCloudSvgPath(w, h, id, size)\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill theme={theme} d={path} fill={fill} color={color} />\n\t\t\t<path d={path} stroke={theme[color].solid} strokeWidth={strokeWidth} fill=\"none\" />\n\t\t</>\n\t)\n})\n", "import { TLGeoShape, VecLike } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\nimport { getRoundedInkyPolygonPath, getRoundedPolygonPoints } from '../../shared/polygon-helpers'\n\nexport const DrawStylePolygon = React.memo(function DrawStylePolygon({\n\tid,\n\toutline,\n\tlines,\n\tfill,\n\tcolor,\n\tstrokeWidth,\n}: Pick<TLGeoShape['props'], 'fill' | 'color'> & {\n\tid: TLGeoShape['id']\n\toutline: VecLike[]\n\tstrokeWidth: number\n\tlines?: VecLike[][]\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst polygonPoints = getRoundedPolygonPoints(id, outline, strokeWidth / 3, strokeWidth * 2, 2)\n\tlet strokePathData = getRoundedInkyPolygonPath(polygonPoints)\n\n\tif (lines) {\n\t\tfor (const [A, B] of lines) {\n\t\t\tstrokePathData += `M${A.x},${A.y}L${B.x},${B.y}`\n\t\t}\n\t}\n\n\tconst innerPolygonPoints = getRoundedPolygonPoints(id, outline, 0, strokeWidth * 2, 1)\n\tconst innerPathData = getRoundedInkyPolygonPath(innerPolygonPoints)\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill d={innerPathData} fill={fill} color={color} theme={theme} />\n\t\t\t<path d={strokePathData} stroke={theme[color].solid} strokeWidth={strokeWidth} fill=\"none\" />\n\t\t</>\n\t)\n})\n", "import { TLGeoShape, TLShapeId } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\nimport { cloudSvgPath } from '../cloudOutline'\n\nexport const SolidStyleCloud = React.memo(function SolidStyleCloud({\n\tfill,\n\tcolor,\n\tstrokeWidth,\n\tw,\n\th,\n\tid,\n\tsize,\n}: Pick<TLGeoShape['props'], 'fill' | 'color' | 'w' | 'h' | 'size'> & {\n\tstrokeWidth: number\n\tid: TLShapeId\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst path = cloudSvgPath(w, h, id, size)\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill theme={theme} d={path} fill={fill} color={color} />\n\t\t\t<path d={path} stroke={theme[color].solid} strokeWidth={strokeWidth} fill=\"none\" />\n\t\t</>\n\t)\n})\n", "import { TLGeoShape } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\n\nexport const SolidStyleEllipse = React.memo(function SolidStyleEllipse({\n\tw,\n\th,\n\tstrokeWidth: sw,\n\tfill,\n\tcolor,\n}: Pick<TLGeoShape['props'], 'w' | 'h' | 'fill' | 'color'> & { strokeWidth: number }) {\n\tconst theme = useDefaultColorTheme()\n\tconst cx = w / 2\n\tconst cy = h / 2\n\tconst rx = Math.max(0, cx)\n\tconst ry = Math.max(0, cy)\n\n\tconst d = `M${cx - rx},${cy}a${rx},${ry},0,1,1,${rx * 2},0a${rx},${ry},0,1,1,-${rx * 2},0`\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill d={d} color={color} fill={fill} theme={theme} />\n\t\t\t<path d={d} stroke={theme[color].solid} strokeWidth={sw} fill=\"none\" />\n\t\t</>\n\t)\n})\n", "import { TLGeoShape } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\n\nexport const SolidStyleOval = React.memo(function SolidStyleOval({\n\tw,\n\th,\n\tstrokeWidth: sw,\n\tfill,\n\tcolor,\n}: Pick<TLGeoShape['props'], 'w' | 'h' | 'fill' | 'color'> & {\n\tstrokeWidth: number\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst d = getOvalIndicatorPath(w, h)\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill d={d} color={color} fill={fill} theme={theme} />\n\t\t\t<path d={d} stroke={theme[color].solid} strokeWidth={sw} fill=\"none\" />\n\t\t</>\n\t)\n})\n\nexport function getOvalIndicatorPath(w: number, h: number) {\n\tlet d: string\n\n\tif (h > w) {\n\t\tconst offset = w / 2\n\t\td = `\n    M0,${offset}\n    a${offset},${offset},0,1,1,${offset * 2},0\n    L${w},${h - offset}\n    a${offset},${offset},0,1,1,-${offset * 2},0\n    Z`\n\t} else {\n\t\tconst offset = h / 2\n\t\td = `\n    M${offset},0\n    L${w - offset},0\n    a${offset},${offset},0,1,1,0,${offset * 2}\n    L${offset},${h}\n    a${offset},${offset},0,1,1,0,${-offset * 2}\n    Z`\n\t}\n\n\treturn d\n}\n", "import { TLGeoShape, VecLike } from '@tldraw/editor'\nimport * as React from 'react'\nimport { ShapeFill, useDefaultColorTheme } from '../../shared/ShapeFill'\n\nexport const SolidStylePolygon = React.memo(function SolidStylePolygon({\n\toutline,\n\tlines,\n\tfill,\n\tcolor,\n\tstrokeWidth,\n}: Pick<TLGeoShape['props'], 'fill' | 'color'> & {\n\toutline: VecLike[]\n\tlines?: VecLike[][]\n\tstrokeWidth: number\n}) {\n\tconst theme = useDefaultColorTheme()\n\tlet path = 'M' + outline[0] + 'L' + outline.slice(1) + 'Z'\n\n\tif (lines) {\n\t\tfor (const [A, B] of lines) {\n\t\t\tpath += `M${A.x},${A.y}L${B.x},${B.y}`\n\t\t}\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<ShapeFill d={path} fill={fill} color={color} theme={theme} />\n\t\t\t<path d={path} stroke={theme[color].solid} strokeWidth={strokeWidth} fill=\"none\" />\n\t\t</>\n\t)\n})\n", "/* eslint-disable react-hooks/rules-of-hooks */\nimport {\n\tCircle2d,\n\tPolygon2d,\n\tSVGContainer,\n\tShapeUtil,\n\tTLDrawShapeSegment,\n\tTLHighlightShape,\n\tTLOnResizeHandler,\n\tVecLike,\n\thighlightShapeMigrations,\n\thighlightShapeProps,\n\tlast,\n\trng,\n} from '@tldraw/editor'\nimport { getHighlightFreehandSettings, getPointsFromSegments } from '../draw/getPath'\nimport { useDefaultColorTheme } from '../shared/ShapeFill'\nimport { FONT_SIZES } from '../shared/default-shape-constants'\nimport { getStrokeOutlinePoints } from '../shared/freehand/getStrokeOutlinePoints'\nimport { getStrokePoints } from '../shared/freehand/getStrokePoints'\nimport { setStrokePointRadii } from '../shared/freehand/setStrokePointRadii'\nimport { getSvgPathFromStrokePoints } from '../shared/freehand/svg'\nimport { useColorSpace } from '../shared/useColorSpace'\nimport { useForceSolid } from '../shared/useForceSolid'\n\nconst OVERLAY_OPACITY = 0.35\nconst UNDERLAY_OPACITY = 0.82\n\n/** @public */\nexport class HighlightShapeUtil extends ShapeUtil<TLHighlightShape> {\n\tstatic override type = 'highlight' as const\n\tstatic override props = highlightShapeProps\n\tstatic override migrations = highlightShapeMigrations\n\n\toverride hideResizeHandles = (shape: TLHighlightShape) => getIsDot(shape)\n\toverride hideRotateHandle = (shape: TLHighlightShape) => getIsDot(shape)\n\toverride hideSelectionBoundsFg = (shape: TLHighlightShape) => getIsDot(shape)\n\n\toverride getDefaultProps(): TLHighlightShape['props'] {\n\t\treturn {\n\t\t\tsegments: [],\n\t\t\tcolor: 'black',\n\t\t\tsize: 'm',\n\t\t\tisComplete: false,\n\t\t\tisPen: false,\n\t\t}\n\t}\n\n\tgetGeometry(shape: TLHighlightShape) {\n\t\tconst strokeWidth = getStrokeWidth(shape)\n\t\tif (getIsDot(shape)) {\n\t\t\treturn new Circle2d({\n\t\t\t\tx: -strokeWidth / 2,\n\t\t\t\ty: -strokeWidth / 2,\n\t\t\t\tradius: strokeWidth / 2,\n\t\t\t\tisFilled: true,\n\t\t\t})\n\t\t}\n\n\t\tconst { strokePoints, sw } = getHighlightStrokePoints(shape, strokeWidth, true)\n\t\tconst opts = getHighlightFreehandSettings({ strokeWidth: sw, showAsComplete: true })\n\t\tsetStrokePointRadii(strokePoints, opts)\n\n\t\treturn new Polygon2d({\n\t\t\tpoints: getStrokeOutlinePoints(strokePoints, opts),\n\t\t\tisFilled: true,\n\t\t})\n\t}\n\n\tcomponent(shape: TLHighlightShape) {\n\t\treturn (\n\t\t\t<SVGContainer id={shape.id} style={{ opacity: OVERLAY_OPACITY }}>\n\t\t\t\t<HighlightRenderer strokeWidth={getStrokeWidth(shape)} shape={shape} />\n\t\t\t</SVGContainer>\n\t\t)\n\t}\n\n\toverride backgroundComponent(shape: TLHighlightShape) {\n\t\treturn (\n\t\t\t<SVGContainer id={shape.id} style={{ opacity: UNDERLAY_OPACITY }}>\n\t\t\t\t<HighlightRenderer strokeWidth={getStrokeWidth(shape)} shape={shape} />\n\t\t\t</SVGContainer>\n\t\t)\n\t}\n\n\tindicator(shape: TLHighlightShape) {\n\t\tconst forceSolid = useForceSolid()\n\t\tconst strokeWidth = getStrokeWidth(shape)\n\t\tconst allPointsFromSegments = getPointsFromSegments(shape.props.segments)\n\n\t\tlet sw = strokeWidth\n\t\tif (!forceSolid && !shape.props.isPen && allPointsFromSegments.length === 1) {\n\t\t\tsw += rng(shape.id)() * (strokeWidth / 6)\n\t\t}\n\n\t\tconst showAsComplete = shape.props.isComplete || last(shape.props.segments)?.type === 'straight'\n\t\tconst options = getHighlightFreehandSettings({\n\t\t\tstrokeWidth,\n\t\t\tshowAsComplete,\n\t\t})\n\t\tconst strokePoints = getStrokePoints(allPointsFromSegments, options)\n\n\t\tlet strokePath\n\t\tif (strokePoints.length < 2) {\n\t\t\tstrokePath = getIndicatorDot(allPointsFromSegments[0], sw)\n\t\t} else {\n\t\t\tstrokePath = getSvgPathFromStrokePoints(strokePoints, false)\n\t\t}\n\n\t\treturn <path d={strokePath} />\n\t}\n\n\toverride toSvg(shape: TLHighlightShape) {\n\t\treturn (\n\t\t\t<HighlightRenderer\n\t\t\t\tstrokeWidth={getStrokeWidth(shape)}\n\t\t\t\tshape={shape}\n\t\t\t\topacity={OVERLAY_OPACITY}\n\t\t\t/>\n\t\t)\n\t}\n\n\toverride toBackgroundSvg(shape: TLHighlightShape) {\n\t\treturn (\n\t\t\t<HighlightRenderer\n\t\t\t\tstrokeWidth={getStrokeWidth(shape)}\n\t\t\t\tshape={shape}\n\t\t\t\topacity={UNDERLAY_OPACITY}\n\t\t\t/>\n\t\t)\n\t}\n\n\toverride onResize: TLOnResizeHandler<TLHighlightShape> = (shape, info) => {\n\t\tconst { scaleX, scaleY } = info\n\n\t\tconst newSegments: TLDrawShapeSegment[] = []\n\n\t\tfor (const segment of shape.props.segments) {\n\t\t\tnewSegments.push({\n\t\t\t\t...segment,\n\t\t\t\tpoints: segment.points.map(({ x, y, z }) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tx: scaleX * x,\n\t\t\t\t\t\ty: scaleY * y,\n\t\t\t\t\t\tz,\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t})\n\t\t}\n\n\t\treturn {\n\t\t\tprops: {\n\t\t\t\tsegments: newSegments,\n\t\t\t},\n\t\t}\n\t}\n}\n\nfunction getShapeDot(point: VecLike) {\n\tconst r = 0.1\n\treturn `M ${point.x} ${point.y} m -${r}, 0 a ${r},${r} 0 1,0 ${r * 2},0 a ${r},${r} 0 1,0 -${\n\t\tr * 2\n\t},0`\n}\n\nfunction getIndicatorDot(point: VecLike, sw: number) {\n\tconst r = sw / 2\n\treturn `M ${point.x} ${point.y} m -${r}, 0 a ${r},${r} 0 1,0 ${r * 2},0 a ${r},${r} 0 1,0 -${\n\t\tr * 2\n\t},0`\n}\n\nfunction getHighlightStrokePoints(\n\tshape: TLHighlightShape,\n\tstrokeWidth: number,\n\tforceSolid: boolean\n) {\n\tconst allPointsFromSegments = getPointsFromSegments(shape.props.segments)\n\tconst showAsComplete = shape.props.isComplete || last(shape.props.segments)?.type === 'straight'\n\n\tlet sw = strokeWidth\n\tif (!forceSolid && !shape.props.isPen && allPointsFromSegments.length === 1) {\n\t\tsw += rng(shape.id)() * (strokeWidth / 6)\n\t}\n\n\tconst options = getHighlightFreehandSettings({\n\t\tstrokeWidth: sw,\n\t\tshowAsComplete,\n\t})\n\tconst strokePoints = getStrokePoints(allPointsFromSegments, options)\n\n\treturn { strokePoints, sw }\n}\n\nfunction getHighlightSvgPath(shape: TLHighlightShape, strokeWidth: number, forceSolid: boolean) {\n\tconst { strokePoints, sw } = getHighlightStrokePoints(shape, strokeWidth, forceSolid)\n\n\tconst solidStrokePath =\n\t\tstrokePoints.length > 1\n\t\t\t? getSvgPathFromStrokePoints(strokePoints, false)\n\t\t\t: getShapeDot(shape.props.segments[0].points[0])\n\n\treturn { solidStrokePath, sw }\n}\n\nfunction HighlightRenderer({\n\tstrokeWidth,\n\tshape,\n\topacity,\n}: {\n\tstrokeWidth: number\n\tshape: TLHighlightShape\n\topacity?: number\n}) {\n\tconst theme = useDefaultColorTheme()\n\tconst forceSolid = useForceSolid()\n\tconst { solidStrokePath, sw } = getHighlightSvgPath(shape, strokeWidth, forceSolid)\n\tconst colorSpace = useColorSpace()\n\tconst color = theme[shape.props.color].highlight[colorSpace]\n\n\treturn (\n\t\t<path\n\t\t\td={solidStrokePath}\n\t\t\tstrokeLinecap=\"round\"\n\t\t\tfill=\"none\"\n\t\t\tpointerEvents=\"all\"\n\t\t\tstroke={color}\n\t\t\tstrokeWidth={sw}\n\t\t\topacity={opacity}\n\t\t/>\n\t)\n}\n\nfunction getStrokeWidth(shape: TLHighlightShape) {\n\treturn FONT_SIZES[shape.props.size] * 1.12\n}\n\nfunction getIsDot(shape: TLHighlightShape) {\n\treturn shape.props.segments.length === 1 && shape.props.segments[0].points.length < 2\n}\n", "import { debugFlags, useValue } from '@tldraw/editor'\nimport { useEffect, useState } from 'react'\n\nexport function useColorSpace(): 'srgb' | 'p3' {\n\tconst [supportsP3, setSupportsP3] = useState(false)\n\n\tuseEffect(() => {\n\t\tconst supportsSyntax = CSS.supports('color', 'color(display-p3 1 1 1)')\n\t\tconst query = matchMedia('(color-gamut: p3)')\n\t\tsetSupportsP3(supportsSyntax && query.matches)\n\n\t\tconst onChange = () => setSupportsP3(supportsSyntax && query.matches)\n\n\t\tquery.addEventListener('change', onChange)\n\t\treturn () => query.removeEventListener('change', onChange)\n\t}, [])\n\n\tconst forceSrgb = useValue(debugFlags.forceSrgb)\n\n\treturn forceSrgb || !supportsP3 ? 'srgb' : 'p3'\n}\n", "/* eslint-disable react-hooks/rules-of-hooks */\nimport {\n\tBaseBoxShapeUtil,\n\tFileHelpers,\n\tHTMLContainer,\n\tTLImageShape,\n\tTLOnDoubleClickHandler,\n\tTLShapePartial,\n\tVec,\n\timageShapeMigrations,\n\timageShapeProps,\n\tstructuredClone,\n\ttoDomPrecision,\n} from '@tldraw/editor'\nimport { useEffect, useState } from 'react'\nimport { BrokenAssetIcon } from '../shared/BrokenAssetIcon'\nimport { HyperlinkButton } from '../shared/HyperlinkButton'\nimport { usePrefersReducedMotion } from '../shared/usePrefersReducedMotion'\n\nasync function getDataURIFromURL(url: string): Promise<string> {\n\tconst response = await fetch(url)\n\tconst blob = await response.blob()\n\treturn FileHelpers.blobToDataUrl(blob)\n}\n\n/** @public */\nexport class ImageShapeUtil extends BaseBoxShapeUtil<TLImageShape> {\n\tstatic override type = 'image' as const\n\tstatic override props = imageShapeProps\n\tstatic override migrations = imageShapeMigrations\n\n\toverride isAspectRatioLocked = () => true\n\toverride canCrop = () => true\n\n\toverride getDefaultProps(): TLImageShape['props'] {\n\t\treturn {\n\t\t\tw: 100,\n\t\t\th: 100,\n\t\t\tassetId: null,\n\t\t\tplaying: true,\n\t\t\turl: '',\n\t\t\tcrop: null,\n\t\t}\n\t}\n\n\tcomponent(shape: TLImageShape) {\n\t\tconst isCropping = this.editor.getCroppingShapeId() === shape.id\n\t\tconst prefersReducedMotion = usePrefersReducedMotion()\n\t\tconst [staticFrameSrc, setStaticFrameSrc] = useState('')\n\n\t\tconst asset = shape.props.assetId ? this.editor.getAsset(shape.props.assetId) : undefined\n\n\t\tconst isSelected = shape.id === this.editor.getOnlySelectedShapeId()\n\n\t\tuseEffect(() => {\n\t\t\tif (asset?.props.src && 'mimeType' in asset.props && asset?.props.mimeType === 'image/gif') {\n\t\t\t\tlet cancelled = false\n\t\t\t\tconst url = asset.props.src\n\t\t\t\tif (!url) return\n\n\t\t\t\tconst image = new Image()\n\t\t\t\timage.onload = () => {\n\t\t\t\t\tif (cancelled) return\n\n\t\t\t\t\tconst canvas = document.createElement('canvas')\n\t\t\t\t\tcanvas.width = image.width\n\t\t\t\t\tcanvas.height = image.height\n\n\t\t\t\t\tconst ctx = canvas.getContext('2d')\n\t\t\t\t\tif (!ctx) return\n\n\t\t\t\t\tctx.drawImage(image, 0, 0)\n\t\t\t\t\tsetStaticFrameSrc(canvas.toDataURL())\n\t\t\t\t}\n\t\t\t\timage.crossOrigin = 'anonymous'\n\t\t\t\timage.src = url\n\n\t\t\t\treturn () => {\n\t\t\t\t\tcancelled = true\n\t\t\t\t}\n\t\t\t}\n\t\t}, [prefersReducedMotion, asset?.props])\n\n\t\tif (asset?.type === 'bookmark') {\n\t\t\tthrow Error(\"Bookmark assets can't be rendered as images\")\n\t\t}\n\n\t\tconst showCropPreview =\n\t\t\tisSelected &&\n\t\t\tisCropping &&\n\t\t\tthis.editor.isInAny('select.crop', 'select.cropping', 'select.pointing_crop_handle')\n\n\t\t// We only want to reduce motion for mimeTypes that have motion\n\t\tconst reduceMotion =\n\t\t\tprefersReducedMotion &&\n\t\t\t(asset?.props.mimeType?.includes('video') || asset?.props.mimeType?.includes('gif'))\n\n\t\tconst containerStyle = getCroppedContainerStyle(shape)\n\n\t\tif (!asset?.props.src) {\n\t\t\treturn (\n\t\t\t\t<HTMLContainer\n\t\t\t\t\tid={shape.id}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\twidth: shape.props.w,\n\t\t\t\t\t\theight: shape.props.h,\n\t\t\t\t\t\tcolor: 'var(--color-text-3)',\n\t\t\t\t\t\tbackgroundColor: asset ? 'transparent' : 'var(--color-low)',\n\t\t\t\t\t\tborder: asset ? 'none' : '1px solid var(--color-low-border)',\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"tl-image-container\" style={containerStyle}>\n\t\t\t\t\t\t{asset ? null : <BrokenAssetIcon />}\n\t\t\t\t\t</div>\n\t\t\t\t\t)\n\t\t\t\t\t{'url' in shape.props && shape.props.url && (\n\t\t\t\t\t\t<HyperlinkButton url={shape.props.url} zoomLevel={this.editor.getZoomLevel()} />\n\t\t\t\t\t)}\n\t\t\t\t</HTMLContainer>\n\t\t\t)\n\t\t}\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{showCropPreview && (\n\t\t\t\t\t<div style={containerStyle}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"tl-image\"\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\topacity: 0.1,\n\t\t\t\t\t\t\t\tbackgroundImage: `url(${\n\t\t\t\t\t\t\t\t\t!shape.props.playing || reduceMotion ? staticFrameSrc : asset.props.src\n\t\t\t\t\t\t\t\t})`,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t<HTMLContainer\n\t\t\t\t\tid={shape.id}\n\t\t\t\t\tstyle={{ overflow: 'hidden', width: shape.props.w, height: shape.props.h }}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"tl-image-container\" style={containerStyle}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"tl-image\"\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tbackgroundImage: `url(${\n\t\t\t\t\t\t\t\t\t!shape.props.playing || reduceMotion ? staticFrameSrc : asset.props.src\n\t\t\t\t\t\t\t\t})`,\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{asset.props.isAnimated && !shape.props.playing && (\n\t\t\t\t\t\t\t<div className=\"tl-image__tg\">GIF</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t)\n\t\t\t\t\t{shape.props.url && (\n\t\t\t\t\t\t<HyperlinkButton url={shape.props.url} zoomLevel={this.editor.getZoomLevel()} />\n\t\t\t\t\t)}\n\t\t\t\t</HTMLContainer>\n\t\t\t</>\n\t\t)\n\t}\n\n\tindicator(shape: TLImageShape) {\n\t\tconst isCropping = this.editor.getCroppingShapeId() === shape.id\n\t\tif (isCropping) return null\n\t\treturn <rect width={toDomPrecision(shape.props.w)} height={toDomPrecision(shape.props.h)} />\n\t}\n\n\toverride async toSvg(shape: TLImageShape) {\n\t\tconst asset = shape.props.assetId ? this.editor.getAsset(shape.props.assetId) : null\n\n\t\tif (!asset) return null\n\n\t\tlet src = asset?.props.src || ''\n\t\tif (src.startsWith('http') || src.startsWith('/') || src.startsWith('./')) {\n\t\t\t// If it's a remote image, we need to fetch it and convert it to a data URI\n\t\t\tsrc = (await getDataURIFromURL(src)) || ''\n\t\t}\n\n\t\tconst containerStyle = getCroppedContainerStyle(shape)\n\t\tconst crop = shape.props.crop\n\t\tif (containerStyle.transform && crop) {\n\t\t\tconst { transform, width, height } = containerStyle\n\t\t\tconst croppedWidth = (crop.bottomRight.x - crop.topLeft.x) * width\n\t\t\tconst croppedHeight = (crop.bottomRight.y - crop.topLeft.y) * height\n\n\t\t\tconst points = [\n\t\t\t\tnew Vec(0, 0),\n\t\t\t\tnew Vec(croppedWidth, 0),\n\t\t\t\tnew Vec(croppedWidth, croppedHeight),\n\t\t\t\tnew Vec(0, croppedHeight),\n\t\t\t]\n\n\t\t\tconst cropClipId = `cropClipPath_${shape.id.replace(':', '_')}`\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<defs>\n\t\t\t\t\t\t<clipPath id={cropClipId}>\n\t\t\t\t\t\t\t<polygon points={points.map((p) => `${p.x},${p.y}`).join(' ')} />\n\t\t\t\t\t\t</clipPath>\n\t\t\t\t\t</defs>\n\t\t\t\t\t<g clipPath=\"url(#{cropClipId})\">\n\t\t\t\t\t\t<image href={src} width={width} height={height} style={{ transform }} />\n\t\t\t\t\t</g>\n\t\t\t\t</>\n\t\t\t)\n\t\t} else {\n\t\t\treturn <image href={src} width={shape.props.w} height={shape.props.h} />\n\t\t}\n\t}\n\n\toverride onDoubleClick = (shape: TLImageShape) => {\n\t\tconst asset = shape.props.assetId ? this.editor.getAsset(shape.props.assetId) : undefined\n\n\t\tif (!asset) return\n\n\t\tconst canPlay =\n\t\t\tasset.props.src && 'mimeType' in asset.props && asset.props.mimeType === 'image/gif'\n\n\t\tif (!canPlay) return\n\n\t\tthis.editor.updateShapes([\n\t\t\t{\n\t\t\t\ttype: 'image',\n\t\t\t\tid: shape.id,\n\t\t\t\tprops: {\n\t\t\t\t\tplaying: !shape.props.playing,\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\t}\n\n\toverride onDoubleClickEdge: TLOnDoubleClickHandler<TLImageShape> = (shape) => {\n\t\tconst props = shape.props\n\t\tif (!props) return\n\n\t\tif (this.editor.getCroppingShapeId() !== shape.id) {\n\t\t\treturn\n\t\t}\n\n\t\tconst crop = structuredClone(props.crop) || {\n\t\t\ttopLeft: { x: 0, y: 0 },\n\t\t\tbottomRight: { x: 1, y: 1 },\n\t\t}\n\n\t\t// The true asset dimensions\n\t\tconst w = (1 / (crop.bottomRight.x - crop.topLeft.x)) * shape.props.w\n\t\tconst h = (1 / (crop.bottomRight.y - crop.topLeft.y)) * shape.props.h\n\n\t\tconst pointDelta = new Vec(crop.topLeft.x * w, crop.topLeft.y * h).rot(shape.rotation)\n\n\t\tconst partial: TLShapePartial<TLImageShape> = {\n\t\t\tid: shape.id,\n\t\t\ttype: shape.type,\n\t\t\tx: shape.x - pointDelta.x,\n\t\t\ty: shape.y - pointDelta.y,\n\t\t\tprops: {\n\t\t\t\tcrop: {\n\t\t\t\t\ttopLeft: { x: 0, y: 0 },\n\t\t\t\t\tbottomRight: { x: 1, y: 1 },\n\t\t\t\t},\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t},\n\t\t}\n\n\t\tthis.editor.updateShapes([partial])\n\t}\n}\n\n/**\n * When an image is cropped we need to translate the image to show the portion withing the cropped\n * area. We do this by translating the image by the negative of the top left corner of the crop\n * area.\n *\n * @param shape - Shape The image shape for which to get the container style\n * @returns - Styles to apply to the image container\n */\nfunction getCroppedContainerStyle(shape: TLImageShape) {\n\tconst crop = shape.props.crop\n\tconst topLeft = crop?.topLeft\n\tif (!topLeft) {\n\t\treturn {\n\t\t\twidth: shape.props.w,\n\t\t\theight: shape.props.h,\n\t\t}\n\t}\n\n\tconst w = (1 / (crop.bottomRight.x - crop.topLeft.x)) * shape.props.w\n\tconst h = (1 / (crop.bottomRight.y - crop.topLeft.y)) * shape.props.h\n\n\tconst offsetX = -topLeft.x * w\n\tconst offsetY = -topLeft.y * h\n\treturn {\n\t\ttransform: `translate(${offsetX}px, ${offsetY}px)`,\n\t\twidth: w,\n\t\theight: h,\n\t}\n}\n", "export function BrokenAssetIcon() {\n\treturn (\n\t\t<svg\n\t\t\twidth=\"15\"\n\t\t\theight=\"15\"\n\t\t\tviewBox=\"0 0 30 30\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\tfill=\"none\"\n\t\t\tstroke=\"currentColor\"\n\t\t\tstrokeLinecap=\"round\"\n\t\t\tstrokeLinejoin=\"round\"\n\t\t>\n\t\t\t<path d=\"M3,11 L3,3 11,3\" strokeWidth=\"2\" />\n\t\t\t<path d=\"M19,27 L27,27 L27,19\" strokeWidth=\"2\" />\n\t\t\t<path d=\"M27,3 L3,27\" strokeWidth=\"2\" />\n\t\t</svg>\n\t)\n}\n", "import { useEffect, useState } from 'react'\n\n/** @public */\nexport function usePrefersReducedMotion() {\n\tconst [prefersReducedMotion, setPrefersReducedMotion] = useState(false)\n\n\tuseEffect(() => {\n\t\tconst mql = window.matchMedia('(prefers-reduced-motion: reduce)')\n\t\tconst handler = () => {\n\t\t\tsetPrefersReducedMotion(mql.matches)\n\t\t}\n\t\thandler()\n\t\tmql.addEventListener('change', handler)\n\t\treturn () => mql.removeEventListener('change', handler)\n\t}, [])\n\n\treturn prefersReducedMotion\n}\n", "import {\n\tCubicSpline2d,\n\tGroup2d,\n\tHandleSnapGeometry,\n\tPolyline2d,\n\tSVGContainer,\n\tShapeUtil,\n\tTLHandle,\n\tTLLineShape,\n\tTLOnHandleDragHandler,\n\tTLOnResizeHandler,\n\tVec,\n\tWeakMapCache,\n\tgetIndexBetween,\n\tgetIndices,\n\tlineShapeMigrations,\n\tlineShapeProps,\n\tmapObjectMapValues,\n\tsortByIndex,\n} from '@tldraw/editor'\n\nimport { ShapeFill, useDefaultColorTheme } from '../shared/ShapeFill'\nimport { STROKE_SIZES } from '../shared/default-shape-constants'\nimport { getPerfectDashProps } from '../shared/getPerfectDashProps'\nimport { getDrawLinePathData } from '../shared/polygon-helpers'\nimport { getLineDrawPath, getLineIndicatorPath } from './components/getLinePath'\nimport {\n\tgetSvgPathForBezierCurve,\n\tgetSvgPathForEdge,\n\tgetSvgPathForLineGeometry,\n} from './components/svg'\n\nconst handlesCache = new WeakMapCache<TLLineShape['props'], TLHandle[]>()\n\n/** @public */\nexport class LineShapeUtil extends ShapeUtil<TLLineShape> {\n\tstatic override type = 'line' as const\n\tstatic override props = lineShapeProps\n\tstatic override migrations = lineShapeMigrations\n\n\toverride hideResizeHandles = () => true\n\toverride hideRotateHandle = () => true\n\toverride hideSelectionBoundsFg = () => true\n\toverride hideSelectionBoundsBg = () => true\n\n\toverride getDefaultProps(): TLLineShape['props'] {\n\t\tconst [start, end] = getIndices(2)\n\t\treturn {\n\t\t\tdash: 'draw',\n\t\t\tsize: 'm',\n\t\t\tcolor: 'black',\n\t\t\tspline: 'line',\n\t\t\tpoints: {\n\t\t\t\t[start]: { id: start, index: start, x: 0, y: 0 },\n\t\t\t\t[end]: { id: end, index: end, x: 0.1, y: 0.1 },\n\t\t\t},\n\t\t}\n\t}\n\n\tgetGeometry(shape: TLLineShape) {\n\t\t// todo: should we have min size?\n\t\treturn getGeometryForLineShape(shape)\n\t}\n\n\toverride getHandles(shape: TLLineShape) {\n\t\treturn handlesCache.get(shape.props, () => {\n\t\t\tconst spline = getGeometryForLineShape(shape)\n\n\t\t\tconst points = linePointsToArray(shape)\n\t\t\tconst results: TLHandle[] = points.map((point) => ({\n\t\t\t\t...point,\n\t\t\t\tid: point.index,\n\t\t\t\ttype: 'vertex',\n\t\t\t\tcanSnap: true,\n\t\t\t}))\n\n\t\t\tfor (let i = 0; i < points.length - 1; i++) {\n\t\t\t\tconst index = getIndexBetween(points[i].index, points[i + 1].index)\n\t\t\t\tconst segment = spline.segments[i]\n\t\t\t\tconst point = segment.midPoint()\n\t\t\t\tresults.push({\n\t\t\t\t\tid: index,\n\t\t\t\t\ttype: 'create',\n\t\t\t\t\tindex,\n\t\t\t\t\tx: point.x,\n\t\t\t\t\ty: point.y,\n\t\t\t\t\tcanSnap: true,\n\t\t\t\t})\n\t\t\t}\n\n\t\t\treturn results.sort(sortByIndex)\n\t\t})\n\t}\n\n\t//   Events\n\n\toverride onResize: TLOnResizeHandler<TLLineShape> = (shape, info) => {\n\t\tconst { scaleX, scaleY } = info\n\n\t\treturn {\n\t\t\tprops: {\n\t\t\t\tpoints: mapObjectMapValues(shape.props.points, (_, { id, index, x, y }) => ({\n\t\t\t\t\tid,\n\t\t\t\t\tindex,\n\t\t\t\t\tx: x * scaleX,\n\t\t\t\t\ty: y * scaleY,\n\t\t\t\t})),\n\t\t\t},\n\t\t}\n\t}\n\n\toverride onHandleDrag: TLOnHandleDragHandler<TLLineShape> = (shape, { handle }) => {\n\t\t// we should only ever be dragging vertex handles\n\t\tif (handle.type !== 'vertex') return\n\n\t\treturn {\n\t\t\t...shape,\n\t\t\tprops: {\n\t\t\t\t...shape.props,\n\t\t\t\tpoints: {\n\t\t\t\t\t...shape.props.points,\n\t\t\t\t\t[handle.id]: { id: handle.id, index: handle.index, x: handle.x, y: handle.y },\n\t\t\t\t},\n\t\t\t},\n\t\t}\n\t}\n\n\tcomponent(shape: TLLineShape) {\n\t\treturn (\n\t\t\t<SVGContainer id={shape.id}>\n\t\t\t\t<LineShapeSvg shape={shape} />\n\t\t\t</SVGContainer>\n\t\t)\n\t}\n\n\tindicator(shape: TLLineShape) {\n\t\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\t\tconst spline = getGeometryForLineShape(shape)\n\t\tconst { dash } = shape.props\n\n\t\tlet path: string\n\n\t\tif (shape.props.spline === 'line') {\n\t\t\tconst outline = spline.points\n\t\t\tif (dash === 'solid' || dash === 'dotted' || dash === 'dashed') {\n\t\t\t\tpath = 'M' + outline[0] + 'L' + outline.slice(1)\n\t\t\t} else {\n\t\t\t\tconst [innerPathData] = getDrawLinePathData(shape.id, outline, strokeWidth)\n\t\t\t\tpath = innerPathData\n\t\t\t}\n\t\t} else {\n\t\t\tpath = getLineIndicatorPath(shape, spline, strokeWidth)\n\t\t}\n\n\t\treturn <path d={path} />\n\t}\n\n\toverride toSvg(shape: TLLineShape) {\n\t\treturn <LineShapeSvg shape={shape} />\n\t}\n\n\toverride getHandleSnapGeometry(shape: TLLineShape): HandleSnapGeometry {\n\t\tconst points = linePointsToArray(shape)\n\t\treturn {\n\t\t\tpoints,\n\t\t\tgetSelfSnapPoints: (handle) => {\n\t\t\t\tconst index = this.getHandles(shape)\n\t\t\t\t\t.filter((h) => h.type === 'vertex')\n\t\t\t\t\t.findIndex((h) => h.id === handle.id)!\n\n\t\t\t\t// We want to skip the current and adjacent handles\n\t\t\t\treturn points.filter((_, i) => Math.abs(i - index) > 1).map(Vec.From)\n\t\t\t},\n\t\t\tgetSelfSnapOutline: (handle) => {\n\t\t\t\t// We want to skip the segments that include the handle, so\n\t\t\t\t// find the index of the handle that shares the same index property\n\t\t\t\t// as the initial dragging handle; this catches a quirk of create handles\n\t\t\t\tconst index = this.getHandles(shape)\n\t\t\t\t\t.filter((h) => h.type === 'vertex')\n\t\t\t\t\t.findIndex((h) => h.id === handle.id)!\n\n\t\t\t\t// Get all the outline segments from the shape that don't include the handle\n\t\t\t\tconst segments = getGeometryForLineShape(shape).segments.filter(\n\t\t\t\t\t(_, i) => i !== index - 1 && i !== index\n\t\t\t\t)\n\n\t\t\t\tif (!segments.length) return null\n\t\t\t\treturn new Group2d({ children: segments })\n\t\t\t},\n\t\t}\n\t}\n}\n\nfunction linePointsToArray(shape: TLLineShape) {\n\treturn Object.values(shape.props.points).sort(sortByIndex)\n}\n\n/** @public */\nexport function getGeometryForLineShape(shape: TLLineShape): CubicSpline2d | Polyline2d {\n\tconst points = linePointsToArray(shape).map(Vec.From)\n\n\tswitch (shape.props.spline) {\n\t\tcase 'cubic': {\n\t\t\treturn new CubicSpline2d({ points })\n\t\t}\n\t\tcase 'line': {\n\t\t\treturn new Polyline2d({ points })\n\t\t}\n\t}\n}\n\nfunction LineShapeSvg({ shape }: { shape: TLLineShape }) {\n\tconst theme = useDefaultColorTheme()\n\tconst spline = getGeometryForLineShape(shape)\n\tconst strokeWidth = STROKE_SIZES[shape.props.size]\n\n\tconst { dash, color } = shape.props\n\n\t// Line style lines\n\tif (shape.props.spline === 'line') {\n\t\tif (dash === 'solid') {\n\t\t\tconst outline = spline.points\n\t\t\tconst pathData = 'M' + outline[0] + 'L' + outline.slice(1)\n\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<ShapeFill d={pathData} fill={'none'} color={color} theme={theme} />\n\t\t\t\t\t<path d={pathData} stroke={theme[color].solid} strokeWidth={strokeWidth} fill=\"none\" />\n\t\t\t\t</>\n\t\t\t)\n\t\t}\n\n\t\tif (dash === 'dashed' || dash === 'dotted') {\n\t\t\tconst outline = spline.points\n\t\t\tconst pathData = 'M' + outline[0] + 'L' + outline.slice(1)\n\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<ShapeFill d={pathData} fill={'none'} color={color} theme={theme} />\n\t\t\t\t\t<g stroke={theme[color].solid} strokeWidth={strokeWidth}>\n\t\t\t\t\t\t{spline.segments.map((segment, i) => {\n\t\t\t\t\t\t\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(\n\t\t\t\t\t\t\t\tsegment.length,\n\t\t\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstyle: dash,\n\t\t\t\t\t\t\t\t\tstart: i > 0 ? 'outset' : 'none',\n\t\t\t\t\t\t\t\t\tend: i < spline.segments.length - 1 ? 'outset' : 'none',\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\t\t\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\t\t\t\t\t\td={getSvgPathForEdge(segment as any, true)}\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})}\n\t\t\t\t\t</g>\n\t\t\t\t</>\n\t\t\t)\n\t\t}\n\n\t\tif (dash === 'draw') {\n\t\t\tconst outline = spline.points\n\t\t\tconst [innerPathData, outerPathData] = getDrawLinePathData(shape.id, outline, strokeWidth)\n\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<ShapeFill d={innerPathData} fill={'none'} color={color} theme={theme} />\n\t\t\t\t\t<path\n\t\t\t\t\t\td={outerPathData}\n\t\t\t\t\t\tstroke={theme[color].solid}\n\t\t\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)\n\t\t}\n\t}\n\t// Cubic style spline\n\tif (shape.props.spline === 'cubic') {\n\t\tconst splinePath = getSvgPathForLineGeometry(spline)\n\t\tif (dash === 'solid') {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<ShapeFill d={splinePath} fill={'none'} color={color} theme={theme} />\n\t\t\t\t\t<path strokeWidth={strokeWidth} stroke={theme[color].solid} fill=\"none\" d={splinePath} />\n\t\t\t\t</>\n\t\t\t)\n\t\t}\n\n\t\tif (dash === 'dashed' || dash === 'dotted') {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<ShapeFill d={splinePath} fill={'none'} color={color} theme={theme} />\n\t\t\t\t\t<g stroke={theme[color].solid} strokeWidth={strokeWidth}>\n\t\t\t\t\t\t{spline.segments.map((segment, i) => {\n\t\t\t\t\t\t\tconst { strokeDasharray, strokeDashoffset } = getPerfectDashProps(\n\t\t\t\t\t\t\t\tsegment.length,\n\t\t\t\t\t\t\t\tstrokeWidth,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstyle: dash,\n\t\t\t\t\t\t\t\t\tstart: i > 0 ? 'outset' : 'none',\n\t\t\t\t\t\t\t\t\tend: i < spline.segments.length - 1 ? 'outset' : 'none',\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\t\tstrokeDasharray={strokeDasharray}\n\t\t\t\t\t\t\t\t\tstrokeDashoffset={strokeDashoffset}\n\t\t\t\t\t\t\t\t\td={getSvgPathForBezierCurve(segment as any, true)}\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})}\n\t\t\t\t\t</g>\n\t\t\t\t</>\n\t\t\t)\n\t\t}\n\n\t\tif (dash === 'draw') {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<ShapeFill d={splinePath} fill={'none'} color={color} theme={theme} />\n\t\t\t\t\t<path\n\t\t\t\t\t\td={getLineDrawPath(shape, spline, strokeWidth)}\n\t\t\t\t\t\tstrokeWidth={1}\n\t\t\t\t\t\tstroke={theme[color].solid}\n\t\t\t\t\t\tfill={theme[color].solid}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)\n\t\t}\n\t}\n}\n", "import {\n\tCubicBezier2d,\n\tCubicSpline2d,\n\tEdge2d,\n\tPolyline2d,\n\tVec,\n\ttoDomPrecision,\n} from '@tldraw/editor'\n\nexport function getSvgPathForEdge(edge: Edge2d, first: boolean) {\n\tconst { start, end } = edge\n\tif (first) {\n\t\treturn `M${toDomPrecision(start.x)},${toDomPrecision(start.y)} L${toDomPrecision(\n\t\t\tend.x\n\t\t)},${toDomPrecision(end.y)} `\n\t}\n\treturn `${toDomPrecision(end.x)},${toDomPrecision(end.y)} `\n}\n\nexport function getSvgPathForBezierCurve(curve: CubicBezier2d, first: boolean) {\n\tconst { a, b, c, d } = curve\n\n\tif (Vec.Equals(a, d)) return ''\n\n\treturn `${first ? `M${toDomPrecision(a.x)},${toDomPrecision(a.y)}` : ``}C${toDomPrecision(\n\t\tb.x\n\t)},${toDomPrecision(b.y)} ${toDomPrecision(c.x)},${toDomPrecision(c.y)} ${toDomPrecision(\n\t\td.x\n\t)},${toDomPrecision(d.y)}`\n}\n\nfunction getSvgPathForCubicSpline(spline: CubicSpline2d, isClosed: boolean) {\n\tlet d = spline.segments.reduce((d, segment, i) => {\n\t\treturn d + getSvgPathForBezierCurve(segment, i === 0)\n\t}, '')\n\n\tif (isClosed) {\n\t\td += 'Z'\n\t}\n\n\treturn d\n}\n\nfunction getSvgPathForPolylineSpline(spline: Polyline2d, isClosed: boolean) {\n\tlet d = spline.segments.reduce((d, segment, i) => {\n\t\treturn d + getSvgPathForEdge(segment, i === 0)\n\t}, '')\n\n\tif (isClosed) {\n\t\td += 'Z'\n\t}\n\n\treturn d\n}\n\nexport function getSvgPathForLineGeometry(spline: CubicSpline2d | Polyline2d, isClosed = false) {\n\tif (spline instanceof Polyline2d) {\n\t\treturn getSvgPathForPolylineSpline(spline, isClosed)\n\t} else {\n\t\treturn getSvgPathForCubicSpline(spline, isClosed)\n\t}\n}\n", "import { CubicSpline2d, Polyline2d, TLLineShape, getSvgPathFromPoints } from '@tldraw/editor'\nimport { getStrokeOutlinePoints } from '../../shared/freehand/getStrokeOutlinePoints'\nimport { getStrokePoints } from '../../shared/freehand/getStrokePoints'\nimport { setStrokePointRadii } from '../../shared/freehand/setStrokePointRadii'\nimport { getSvgPathFromStrokePoints } from '../../shared/freehand/svg'\nimport { getSvgPathForLineGeometry } from './svg'\n\nfunction getLineDrawFreehandOptions(strokeWidth: number) {\n\treturn {\n\t\tsize: strokeWidth,\n\t\tthinning: 0.4,\n\t\tstreamline: 0,\n\t\tsmoothing: 0.5,\n\t\tsimulatePressure: true,\n\t\tlast: true,\n\t}\n}\n\nfunction getLineStrokePoints(\n\tshape: TLLineShape,\n\tspline: CubicSpline2d | Polyline2d,\n\tstrokeWidth: number\n) {\n\t// const points = getLinePoints(spline)\n\tconst points = spline.vertices\n\tconst options = getLineDrawFreehandOptions(strokeWidth)\n\treturn getStrokePoints(points, options)\n}\n\nfunction getLineDrawStrokeOutlinePoints(\n\tshape: TLLineShape,\n\tspline: CubicSpline2d | Polyline2d,\n\tstrokeWidth: number\n) {\n\tconst options = getLineDrawFreehandOptions(strokeWidth)\n\treturn getStrokeOutlinePoints(\n\t\tsetStrokePointRadii(getLineStrokePoints(shape, spline, strokeWidth), options),\n\t\toptions\n\t)\n}\n\nexport function getLineDrawPath(\n\tshape: TLLineShape,\n\tspline: CubicSpline2d | Polyline2d,\n\tstrokeWidth: number\n) {\n\tconst stroke = getLineDrawStrokeOutlinePoints(shape, spline, strokeWidth)\n\treturn getSvgPathFromPoints(stroke)\n}\n\nexport function getLineIndicatorPath(\n\tshape: TLLineShape,\n\tspline: CubicSpline2d | Polyline2d,\n\tstrokeWidth: number\n) {\n\tif (shape.props.dash === 'draw') {\n\t\tconst strokePoints = getLineStrokePoints(shape, spline, strokeWidth)\n\t\treturn getSvgPathFromStrokePoints(strokePoints)\n\t}\n\n\treturn getSvgPathForLineGeometry(spline)\n}\n", "import {\n\tEditor,\n\tGroup2d,\n\tIndexKey,\n\tRectangle2d,\n\tShapeUtil,\n\tSvgExportContext,\n\tTLHandle,\n\tTLNoteShape,\n\tTLOnEditEndHandler,\n\tTLShape,\n\tTLShapeId,\n\tVec,\n\tWeakMapCache,\n\tgetDefaultColorTheme,\n\tnoteShapeMigrations,\n\tnoteShapeProps,\n\trng,\n\ttoDomPrecision,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\nimport { useCallback } from 'react'\nimport { useCurrentTranslation } from '../../ui/hooks/useTranslation/useTranslation'\nimport { isRightToLeftLanguage } from '../../utils/text/text'\nimport { HyperlinkButton } from '../shared/HyperlinkButton'\nimport { useDefaultColorTheme } from '../shared/ShapeFill'\nimport { SvgTextLabel } from '../shared/SvgTextLabel'\nimport { TextLabel } from '../shared/TextLabel'\nimport {\n\tFONT_FAMILIES,\n\tLABEL_FONT_SIZES,\n\tLABEL_PADDING,\n\tTEXT_PROPS,\n} from '../shared/default-shape-constants'\nimport { getFontDefForExport } from '../shared/defaultStyleDefs'\n\nimport { startEditingShapeWithLabel } from '../../tools/SelectTool/selectHelpers'\nimport { useForceSolid } from '../shared/useForceSolid'\nimport {\n\tADJACENT_NOTE_MARGIN,\n\tCLONE_HANDLE_MARGIN,\n\tNOTE_CENTER_OFFSET,\n\tNOTE_SIZE,\n\tgetNoteShapeForAdjacentPosition,\n} from './noteHelpers'\n\n/** @public */\nexport class NoteShapeUtil extends ShapeUtil<TLNoteShape> {\n\tstatic override type = 'note' as const\n\tstatic override props = noteShapeProps\n\tstatic override migrations = noteShapeMigrations\n\n\toverride canEdit = () => true\n\toverride hideResizeHandles = () => true\n\toverride hideSelectionBoundsFg = () => false\n\n\tgetDefaultProps(): TLNoteShape['props'] {\n\t\treturn {\n\t\t\tcolor: 'black',\n\t\t\tsize: 'm',\n\t\t\ttext: '',\n\t\t\tfont: 'draw',\n\t\t\talign: 'middle',\n\t\t\tverticalAlign: 'middle',\n\t\t\tgrowY: 0,\n\t\t\tfontSizeAdjustment: 0,\n\t\t\turl: '',\n\t\t}\n\t}\n\n\tgetGeometry(shape: TLNoteShape) {\n\t\tconst noteHeight = getNoteHeight(shape)\n\t\tconst { labelHeight, labelWidth } = getLabelSize(this.editor, shape)\n\n\t\treturn new Group2d({\n\t\t\tchildren: [\n\t\t\t\tnew Rectangle2d({ width: NOTE_SIZE, height: noteHeight, isFilled: true }),\n\t\t\t\tnew Rectangle2d({\n\t\t\t\t\tx:\n\t\t\t\t\t\tshape.props.align === 'start'\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: shape.props.align === 'end'\n\t\t\t\t\t\t\t\t? NOTE_SIZE - labelWidth\n\t\t\t\t\t\t\t\t: (NOTE_SIZE - labelWidth) / 2,\n\t\t\t\t\ty:\n\t\t\t\t\t\tshape.props.verticalAlign === 'start'\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: shape.props.verticalAlign === 'end'\n\t\t\t\t\t\t\t\t? noteHeight - labelHeight\n\t\t\t\t\t\t\t\t: (noteHeight - labelHeight) / 2,\n\t\t\t\t\twidth: labelWidth,\n\t\t\t\t\theight: labelHeight,\n\t\t\t\t\tisFilled: true,\n\t\t\t\t\tisLabel: true,\n\t\t\t\t}),\n\t\t\t],\n\t\t})\n\t}\n\n\toverride getHandles(shape: TLNoteShape): TLHandle[] {\n\t\tconst zoom = this.editor.getZoomLevel()\n\t\tconst offset = CLONE_HANDLE_MARGIN / zoom\n\t\tconst noteHeight = getNoteHeight(shape)\n\t\tconst isCoarsePointer = this.editor.getInstanceState().isCoarsePointer\n\n\t\tif (zoom < 0.25 || isCoarsePointer) return []\n\n\t\tif (zoom < 0.5) {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: 'bottom',\n\t\t\t\t\tindex: 'a3' as IndexKey,\n\t\t\t\t\ttype: 'clone',\n\t\t\t\t\tx: NOTE_SIZE / 2,\n\t\t\t\t\ty: noteHeight + offset,\n\t\t\t\t},\n\t\t\t]\n\t\t}\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: 'top',\n\t\t\t\tindex: 'a1' as IndexKey,\n\t\t\t\ttype: 'clone',\n\t\t\t\tx: NOTE_SIZE / 2,\n\t\t\t\ty: -offset,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'right',\n\t\t\t\tindex: 'a2' as IndexKey,\n\t\t\t\ttype: 'clone',\n\t\t\t\tx: NOTE_SIZE + offset,\n\t\t\t\ty: noteHeight / 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'bottom',\n\t\t\t\tindex: 'a3' as IndexKey,\n\t\t\t\ttype: 'clone',\n\t\t\t\tx: NOTE_SIZE / 2,\n\t\t\t\ty: noteHeight + offset,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'left',\n\t\t\t\tindex: 'a4' as IndexKey,\n\t\t\t\ttype: 'clone',\n\t\t\t\tx: -offset,\n\t\t\t\ty: noteHeight / 2,\n\t\t\t},\n\t\t]\n\t}\n\n\tcomponent(shape: TLNoteShape) {\n\t\tconst {\n\t\t\tid,\n\t\t\ttype,\n\t\t\tprops: { color, font, size, align, text, verticalAlign, fontSizeAdjustment },\n\t\t} = shape\n\n\t\t// eslint-disable-next-line react-hooks/rules-of-hooks\n\t\tconst handleKeyDown = useNoteKeydownHandler(id)\n\n\t\t// eslint-disable-next-line react-hooks/rules-of-hooks\n\t\tconst theme = useDefaultColorTheme()\n\t\tconst noteHeight = getNoteHeight(shape)\n\n\t\t// eslint-disable-next-line react-hooks/rules-of-hooks\n\t\tconst rotation = useValue(\n\t\t\t'shape rotation',\n\t\t\t() => this.editor.getShapePageTransform(id)?.rotation() ?? 0,\n\t\t\t[this.editor]\n\t\t)\n\n\t\t// todo: consider hiding shadows on dark mode if they're invisible anyway\n\t\t// eslint-disable-next-line react-hooks/rules-of-hooks\n\t\tconst hideShadows = useForceSolid()\n\n\t\tconst isSelected = shape.id === this.editor.getOnlySelectedShapeId()\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<div\n\t\t\t\t\tid={id}\n\t\t\t\t\tclassName=\"tl-note__container\"\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\twidth: NOTE_SIZE,\n\t\t\t\t\t\theight: noteHeight,\n\t\t\t\t\t\tbackgroundColor: theme[color].note.fill,\n\t\t\t\t\t\tborderBottom: hideShadows ? `3px solid rgb(15, 23, 31, .2)` : `none`,\n\t\t\t\t\t\tboxShadow: hideShadows ? 'none' : getNoteShadow(shape.id, rotation),\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<TextLabel\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\ttype={type}\n\t\t\t\t\t\tfont={font}\n\t\t\t\t\t\tfontSize={fontSizeAdjustment || LABEL_FONT_SIZES[size]}\n\t\t\t\t\t\tlineHeight={TEXT_PROPS.lineHeight}\n\t\t\t\t\t\talign={align}\n\t\t\t\t\t\tverticalAlign={verticalAlign}\n\t\t\t\t\t\ttext={text}\n\t\t\t\t\t\tisNote\n\t\t\t\t\t\tisSelected={isSelected}\n\t\t\t\t\t\tlabelColor={theme[color].note.text}\n\t\t\t\t\t\twrap\n\t\t\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t{'url' in shape.props && shape.props.url && (\n\t\t\t\t\t<HyperlinkButton url={shape.props.url} zoomLevel={this.editor.getZoomLevel()} />\n\t\t\t\t)}\n\t\t\t</>\n\t\t)\n\t}\n\n\tindicator(shape: TLNoteShape) {\n\t\treturn (\n\t\t\t<rect\n\t\t\t\trx=\"1\"\n\t\t\t\twidth={toDomPrecision(NOTE_SIZE)}\n\t\t\t\theight={toDomPrecision(getNoteHeight(shape))}\n\t\t\t/>\n\t\t)\n\t}\n\n\toverride toSvg(shape: TLNoteShape, ctx: SvgExportContext) {\n\t\tctx.addExportDef(getFontDefForExport(shape.props.font))\n\t\tif (shape.props.text) ctx.addExportDef(getFontDefForExport(shape.props.font))\n\t\tconst theme = getDefaultColorTheme({ isDarkMode: ctx.isDarkMode })\n\t\tconst bounds = this.editor.getShapeGeometry(shape).bounds\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<rect x={5} y={5} rx={1} width={NOTE_SIZE - 10} height={bounds.h} fill=\"rgba(0,0,0,.1)\" />\n\t\t\t\t<rect\n\t\t\t\t\trx={1}\n\t\t\t\t\twidth={NOTE_SIZE}\n\t\t\t\t\theight={bounds.h}\n\t\t\t\t\tfill={theme[shape.props.color].note.fill}\n\t\t\t\t/>\n\t\t\t\t<SvgTextLabel\n\t\t\t\t\tfontSize={shape.props.fontSizeAdjustment || LABEL_FONT_SIZES[shape.props.size]}\n\t\t\t\t\tfont={shape.props.font}\n\t\t\t\t\talign={shape.props.align}\n\t\t\t\t\tverticalAlign={shape.props.verticalAlign}\n\t\t\t\t\ttext={shape.props.text}\n\t\t\t\t\tlabelColor={theme[shape.props.color].note.text}\n\t\t\t\t\tbounds={bounds}\n\t\t\t\t\tstroke={false}\n\t\t\t\t/>\n\t\t\t</>\n\t\t)\n\t}\n\n\toverride onBeforeCreate = (next: TLNoteShape) => {\n\t\treturn getNoteSizeAdjustments(this.editor, next)\n\t}\n\n\toverride onBeforeUpdate = (prev: TLNoteShape, next: TLNoteShape) => {\n\t\tif (\n\t\t\tprev.props.text === next.props.text &&\n\t\t\tprev.props.font === next.props.font &&\n\t\t\tprev.props.size === next.props.size\n\t\t) {\n\t\t\treturn\n\t\t}\n\n\t\treturn getNoteSizeAdjustments(this.editor, next)\n\t}\n\n\toverride onEditEnd: TLOnEditEndHandler<TLNoteShape> = (shape) => {\n\t\tconst {\n\t\t\tid,\n\t\t\ttype,\n\t\t\tprops: { text },\n\t\t} = shape\n\n\t\tif (text.trimEnd() !== shape.props.text) {\n\t\t\tthis.editor.updateShapes([\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\ttype,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttext: text.trimEnd(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t])\n\t\t}\n\t}\n}\n\n/**\n * Get the growY and fontSizeAdjustment for a shape.\n */\nfunction getNoteSizeAdjustments(editor: Editor, shape: TLNoteShape) {\n\tconst { labelHeight, fontSizeAdjustment } = getLabelSize(editor, shape)\n\t// When the label height is more than the height of the shape, we add extra height to it\n\tconst growY = Math.max(0, labelHeight - NOTE_SIZE)\n\n\tif (growY !== shape.props.growY || fontSizeAdjustment !== shape.props.fontSizeAdjustment) {\n\t\treturn {\n\t\t\t...shape,\n\t\t\tprops: {\n\t\t\t\t...shape.props,\n\t\t\t\tgrowY,\n\t\t\t\tfontSizeAdjustment,\n\t\t\t},\n\t\t}\n\t}\n}\n\n/**\n * Get the label size for a note.\n */\nfunction getNoteLabelSize(editor: Editor, shape: TLNoteShape) {\n\tconst text = shape.props.text\n\n\tif (!text) {\n\t\tconst minHeight = LABEL_FONT_SIZES[shape.props.size] * TEXT_PROPS.lineHeight + LABEL_PADDING * 2\n\t\treturn { labelHeight: minHeight, labelWidth: 100, fontSizeAdjustment: 0 }\n\t}\n\n\tconst unadjustedFontSize = LABEL_FONT_SIZES[shape.props.size]\n\n\tlet fontSizeAdjustment = 0\n\tlet iterations = 0\n\tlet labelHeight = NOTE_SIZE\n\tlet labelWidth = NOTE_SIZE\n\n\t// N.B. For some note shapes with text like 'hjhjhjhjhjhjhjhj', you'll run into\n\t// some text measurement fuzziness where the browser swears there's no overflow (scrollWidth === width)\n\t// but really there is when you enable overflow-wrap again. This helps account for that little bit\n\t// of give.\n\tconst FUZZ = 1\n\n\t// We slightly make the font smaller if the text is too big for the note, width-wise.\n\tdo {\n\t\tfontSizeAdjustment = Math.min(unadjustedFontSize, unadjustedFontSize - iterations)\n\t\tconst nextTextSize = editor.textMeasure.measureText(text, {\n\t\t\t...TEXT_PROPS,\n\t\t\tfontFamily: FONT_FAMILIES[shape.props.font],\n\t\t\tfontSize: fontSizeAdjustment,\n\t\t\tmaxWidth: NOTE_SIZE - LABEL_PADDING * 2 - FUZZ,\n\t\t\tdisableOverflowWrapBreaking: true,\n\t\t})\n\n\t\tlabelHeight = nextTextSize.h + LABEL_PADDING * 2\n\t\tlabelWidth = nextTextSize.w + LABEL_PADDING * 2\n\n\t\tif (fontSizeAdjustment <= 14) {\n\t\t\t// Too small, just rely now on CSS `overflow-wrap: break-word`\n\t\t\t// We need to recalculate the text measurement here with break-word enabled.\n\t\t\tconst nextTextSizeWithOverflowBreak = editor.textMeasure.measureText(text, {\n\t\t\t\t...TEXT_PROPS,\n\t\t\t\tfontFamily: FONT_FAMILIES[shape.props.font],\n\t\t\t\tfontSize: fontSizeAdjustment,\n\t\t\t\tmaxWidth: NOTE_SIZE - LABEL_PADDING * 2 - FUZZ,\n\t\t\t})\n\t\t\tlabelHeight = nextTextSizeWithOverflowBreak.h + LABEL_PADDING * 2\n\t\t\tlabelWidth = nextTextSizeWithOverflowBreak.w + LABEL_PADDING * 2\n\t\t\tbreak\n\t\t}\n\n\t\tif (nextTextSize.scrollWidth.toFixed(0) === nextTextSize.w.toFixed(0)) {\n\t\t\tbreak\n\t\t}\n\t} while (iterations++ < 50)\n\n\treturn {\n\t\tlabelHeight,\n\t\tlabelWidth,\n\t\tfontSizeAdjustment,\n\t}\n}\n\nconst labelSizesForNote = new WeakMapCache<TLShape, ReturnType<typeof getNoteLabelSize>>()\n\nfunction getLabelSize(editor: Editor, shape: TLNoteShape) {\n\treturn labelSizesForNote.get(shape, () => getNoteLabelSize(editor, shape))\n}\n\nfunction useNoteKeydownHandler(id: TLShapeId) {\n\tconst editor = useEditor()\n\tconst translation = useCurrentTranslation()\n\n\treturn useCallback(\n\t\t(e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n\t\t\tconst shape = editor.getShape<TLNoteShape>(id)\n\t\t\tif (!shape) return\n\n\t\t\tconst isTab = e.key === 'Tab'\n\t\t\tconst isCmdEnter = (e.metaKey || e.ctrlKey) && e.key === 'Enter'\n\t\t\tif (isTab || isCmdEnter) {\n\t\t\t\te.preventDefault()\n\n\t\t\t\tconst pageTransform = editor.getShapePageTransform(id)\n\t\t\t\tconst pageRotation = pageTransform.rotation()\n\n\t\t\t\t// Based on the inputs, calculate the offset to the next note\n\t\t\t\t// tab controls x axis (shift inverts direction set by RTL)\n\t\t\t\t// cmd enter is the y axis (shift inverts direction)\n\t\t\t\tconst isRTL = !!(translation.dir === 'rtl' || isRightToLeftLanguage(shape.props.text))\n\n\t\t\t\tconst offsetLength =\n\t\t\t\t\tNOTE_SIZE +\n\t\t\t\t\tADJACENT_NOTE_MARGIN +\n\t\t\t\t\t// If we're growing down, we need to account for the current shape's growY\n\t\t\t\t\t(isCmdEnter && !e.shiftKey ? shape.props.growY : 0)\n\n\t\t\t\tconst adjacentCenter = new Vec(\n\t\t\t\t\tisTab ? (e.shiftKey != isRTL ? -1 : 1) : 0,\n\t\t\t\t\tisCmdEnter ? (e.shiftKey ? -1 : 1) : 0\n\t\t\t\t)\n\t\t\t\t\t.mul(offsetLength)\n\t\t\t\t\t.add(NOTE_CENTER_OFFSET)\n\t\t\t\t\t.rot(pageRotation)\n\t\t\t\t\t.add(pageTransform.point())\n\n\t\t\t\tconst newNote = getNoteShapeForAdjacentPosition(editor, shape, adjacentCenter, pageRotation)\n\n\t\t\t\tif (newNote) {\n\t\t\t\t\teditor.mark('editing adjacent shape')\n\t\t\t\t\tstartEditingShapeWithLabel(editor, newNote, true /* selectAll */)\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[id, editor, translation.dir]\n\t)\n}\n\nfunction getNoteHeight(shape: TLNoteShape) {\n\treturn NOTE_SIZE + shape.props.growY\n}\n\nfunction getNoteShadow(id: string, rotation: number) {\n\tconst random = rng(id) // seeded based on id\n\tconst lift = Math.abs(random()) + 0.5 // 0 to 1.5\n\tconst oy = Math.cos(rotation)\n\treturn `0px ${5 - lift}px 5px -5px rgba(15, 23, 31, .6),\n\t0px ${(4 + lift * 7) * Math.max(0, oy)}px ${6 + lift * 7}px -${4 + lift * 6}px rgba(15, 23, 31, ${(0.3 + lift * 0.1).toFixed(2)}), \n\t0px 48px 10px -10px inset rgba(15, 23, 44, ${((0.022 + random() * 0.005) * ((1 + oy) / 2)).toFixed(2)})`\n}\n", "import { track, useEditor } from '@tldraw/editor'\nimport * as React from 'react'\nimport { useAssetUrls } from '../../context/asset-urls'\nimport { TLUiTranslationKey } from './TLUiTranslationKey'\nimport { DEFAULT_TRANSLATION } from './defaultTranslation'\nimport { TLUiTranslation, fetchTranslation } from './translations'\n\n/** @public */\nexport interface TLUiTranslationProviderProps {\n\tchildren: React.ReactNode\n\t/**\n\t * A collection of overrides different locales.\n\t *\n\t * @example\n\t *\n\t * ```ts\n\t * <TranslationProvider overrides={{ en: { 'style-panel.styles': 'Properties' } }} />\n\t * ```\n\t */\n\toverrides?: Record<string, Record<string, string>>\n}\n\n/** @public */\nexport type TLUiTranslationContextType = TLUiTranslation\n\nconst TranslationsContext = React.createContext<TLUiTranslationContextType>(\n\t{} as TLUiTranslationContextType\n)\n\n/** @public */\nexport const useCurrentTranslation = () => React.useContext(TranslationsContext)\n\n/**\n * Provides a translation context to the editor.\n *\n * @internal\n */\nexport const TranslationProvider = track(function TranslationProvider({\n\toverrides,\n\tchildren,\n}: TLUiTranslationProviderProps) {\n\tconst editor = useEditor()\n\tconst locale = editor.user.getLocale()\n\tconst getAssetUrl = useAssetUrls()\n\n\tconst [currentTranslation, setCurrentTranslation] = React.useState<TLUiTranslation>(() => {\n\t\tif (overrides && overrides['en']) {\n\t\t\treturn {\n\t\t\t\tlocale: 'en',\n\t\t\t\tlabel: 'English',\n\t\t\t\tdir: 'ltr',\n\t\t\t\tmessages: { ...DEFAULT_TRANSLATION, ...overrides['en'] },\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tlocale: 'en',\n\t\t\tlabel: 'English',\n\t\t\tdir: 'ltr',\n\t\t\tmessages: DEFAULT_TRANSLATION,\n\t\t}\n\t})\n\n\tReact.useEffect(() => {\n\t\tlet isCancelled = false\n\n\t\tasync function loadTranslation() {\n\t\t\tconst translation = await fetchTranslation(locale, getAssetUrl)\n\n\t\t\tif (translation && !isCancelled) {\n\t\t\t\tif (overrides && overrides[locale]) {\n\t\t\t\t\tsetCurrentTranslation({\n\t\t\t\t\t\t...translation,\n\t\t\t\t\t\tmessages: { ...translation.messages, ...overrides[locale] },\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tsetCurrentTranslation(translation)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tloadTranslation()\n\n\t\treturn () => {\n\t\t\tisCancelled = true\n\t\t}\n\t}, [getAssetUrl, locale, overrides])\n\n\treturn (\n\t\t<TranslationsContext.Provider value={currentTranslation}>\n\t\t\t{children}\n\t\t</TranslationsContext.Provider>\n\t)\n})\n\n/**\n * Returns a function to translate a translation key into a string based on the current translation.\n *\n * @example\n *\n * ```ts\n * const msg = useTranslation()\n * const label = msg('style-panel.styles')\n * ```\n *\n * @public\n */\nexport function useTranslation() {\n\tconst translation = useCurrentTranslation()\n\treturn React.useCallback(\n\t\tfunction msg(id?: Exclude<string, TLUiTranslationKey> | string) {\n\t\t\treturn translation.messages[id as TLUiTranslationKey] ?? id\n\t\t},\n\t\t[translation]\n\t)\n}\n\nexport function untranslated(string: string) {\n\treturn string as TLUiTranslationKey\n}\n", "import { createContext, useContext, useEffect } from 'react'\nimport { TLUiAssetUrls } from '../assetUrls'\n\n/** @internal */\ntype UiAssetUrlsContextType = TLUiAssetUrls | null\n\nconst AssetUrlsContext = createContext<UiAssetUrlsContextType>(null)\n\n/** @internal */\nexport function AssetUrlsProvider({\n\tassetUrls,\n\tchildren,\n}: {\n\tassetUrls: TLUiAssetUrls\n\tchildren: React.ReactNode\n}) {\n\tuseEffect(() => {\n\t\tfor (const src of Object.values(assetUrls.icons)) {\n\t\t\tconst image = new Image()\n\t\t\timage.src = src\n\t\t\timage.decode()\n\t\t}\n\t\tfor (const src of Object.values(assetUrls.embedIcons)) {\n\t\t\tconst image = new Image()\n\t\t\timage.src = src\n\t\t\timage.decode()\n\t\t}\n\t}, [assetUrls])\n\n\treturn <AssetUrlsContext.Provider value={assetUrls}>{children}</AssetUrlsContext.Provider>\n}\n\n/** @internal */\nexport function useAssetUrls() {\n\tconst assetUrls = useContext(AssetUrlsContext)\n\tif (!assetUrls) {\n\t\tthrow new Error('useAssetUrls must be used within an AssetUrlsProvider')\n\t}\n\n\treturn assetUrls\n}\n", "// This file is automatically generated by scripts/refresh-assets.ts.\n// Do not edit manually. Or do, I'm a comment, not a cop.\n\n/** @internal */\nexport const DEFAULT_TRANSLATION = {\n\t'action.convert-to-bookmark': 'Convert to Bookmark',\n\t'action.convert-to-embed': 'Convert to Embed',\n\t'action.open-embed-link': 'Open link',\n\t'action.align-bottom': 'Align bottom',\n\t'action.align-center-horizontal': 'Align horizontally',\n\t'action.align-center-vertical': 'Align vertically',\n\t'action.align-center-horizontal.short': 'Align H',\n\t'action.align-center-vertical.short': 'Align V',\n\t'action.align-left': 'Align left',\n\t'action.align-right': 'Align right',\n\t'action.align-top': 'Align top',\n\t'action.back-to-content': 'Back to content',\n\t'action.bring-forward': 'Bring forward',\n\t'action.bring-to-front': 'Bring to front',\n\t'action.copy-as-json.short': 'JSON',\n\t'action.copy-as-json': 'Copy as JSON',\n\t'action.copy-as-png.short': 'PNG',\n\t'action.copy-as-png': 'Copy as PNG',\n\t'action.copy-as-svg.short': 'SVG',\n\t'action.copy-as-svg': 'Copy as SVG',\n\t'action.copy': 'Copy',\n\t'action.cut': 'Cut',\n\t'action.delete': 'Delete',\n\t'action.unlock-all': 'Unlock all',\n\t'action.distribute-horizontal': 'Distribute horizontally',\n\t'action.distribute-vertical': 'Distribute vertically',\n\t'action.distribute-horizontal.short': 'Distribute H',\n\t'action.distribute-vertical.short': 'Distribute V',\n\t'action.duplicate': 'Duplicate',\n\t'action.edit-link': 'Edit link',\n\t'action.exit-pen-mode': 'Exit pen mode',\n\t'action.export-as-json.short': 'JSON',\n\t'action.export-as-json': 'Export as JSON',\n\t'action.export-as-png.short': 'PNG',\n\t'action.export-as-png': 'Export as PNG',\n\t'action.export-as-svg.short': 'SVG',\n\t'action.export-as-svg': 'Export as SVG',\n\t'action.export-all-as-json.short': 'JSON',\n\t'action.export-all-as-json': 'Export as JSON',\n\t'action.export-all-as-png.short': 'PNG',\n\t'action.export-all-as-png': 'Export as PNG',\n\t'action.export-all-as-svg.short': 'SVG',\n\t'action.export-all-as-svg': 'Export as SVG',\n\t'action.fit-frame-to-content': 'Fit to content',\n\t'action.flip-horizontal': 'Flip horizontally',\n\t'action.flip-vertical': 'Flip vertically',\n\t'action.flip-horizontal.short': 'Flip H',\n\t'action.flip-vertical.short': 'Flip V',\n\t'action.fork-project': 'Fork this project',\n\t'action.group': 'Group',\n\t'action.insert-embed': 'Insert embed',\n\t'action.insert-media': 'Upload media',\n\t'action.leave-shared-project': 'Leave shared project',\n\t'action.new-project': 'New project',\n\t'action.new-shared-project': 'New shared project',\n\t'action.open-cursor-chat': 'Cursor chat',\n\t'action.open-file': 'Open file',\n\t'action.pack': 'Pack',\n\t'action.paste': 'Paste',\n\t'action.print': 'Print',\n\t'action.redo': 'Redo',\n\t'action.remove-frame': 'Remove frame',\n\t'action.rename': 'Rename',\n\t'action.rotate-ccw': 'Rotate counterclockwise',\n\t'action.rotate-cw': 'Rotate clockwise',\n\t'action.save-copy': 'Save a copy',\n\t'action.select-all': 'Select all',\n\t'action.select-none': 'Select none',\n\t'action.send-backward': 'Send backward',\n\t'action.send-to-back': 'Send to back',\n\t'action.share-project': 'Share this project',\n\t'action.stack-horizontal': 'Stack horizontally',\n\t'action.stack-vertical': 'Stack vertically',\n\t'action.stack-horizontal.short': 'Stack H',\n\t'action.stack-vertical.short': 'Stack V',\n\t'action.stop-following': 'Stop following',\n\t'action.stretch-horizontal': 'Stretch horizontally',\n\t'action.stretch-vertical': 'Stretch vertically',\n\t'action.stretch-horizontal.short': 'Stretch H',\n\t'action.stretch-vertical.short': 'Stretch V',\n\t'action.toggle-auto-size': 'Toggle auto size',\n\t'action.toggle-dark-mode.menu': 'Dark mode',\n\t'action.toggle-dark-mode': 'Toggle dark mode',\n\t'action.toggle-wrap-mode.menu': 'Select on wrap',\n\t'action.toggle-wrap-mode': 'Toggle Select on wrap',\n\t'action.toggle-reduce-motion.menu': 'Reduce motion',\n\t'action.toggle-reduce-motion': 'Toggle reduce motion',\n\t'action.toggle-edge-scrolling.menu': 'Edge scrolling',\n\t'action.toggle-edge-scrolling': 'Toggle edge scrolling',\n\t'action.toggle-debug-mode.menu': 'Debug mode',\n\t'action.toggle-debug-mode': 'Toggle debug mode',\n\t'action.toggle-focus-mode.menu': 'Focus mode',\n\t'action.toggle-focus-mode': 'Toggle focus mode',\n\t'action.toggle-grid.menu': 'Show grid',\n\t'action.toggle-grid': 'Toggle grid',\n\t'action.toggle-lock': 'Toggle locked',\n\t'action.toggle-snap-mode.menu': 'Always snap',\n\t'action.toggle-snap-mode': 'Toggle always snap',\n\t'action.toggle-tool-lock.menu': 'Tool lock',\n\t'action.toggle-tool-lock': 'Toggle tool lock',\n\t'action.toggle-transparent.context-menu': 'Transparent',\n\t'action.toggle-transparent.menu': 'Transparent',\n\t'action.toggle-transparent': 'Toggle transparent background',\n\t'action.undo': 'Undo',\n\t'action.ungroup': 'Ungroup',\n\t'action.zoom-in': 'Zoom in',\n\t'action.zoom-out': 'Zoom out',\n\t'action.zoom-to-100': 'Zoom to 100%',\n\t'action.zoom-to-fit': 'Zoom to fit',\n\t'action.zoom-to-selection': 'Zoom to selection',\n\t'assets.files.upload-failed': 'Upload failed',\n\t'assets.url.failed': \"Couldn't load URL preview\",\n\t'color-style.white': 'White',\n\t'color-style.black': 'Black',\n\t'color-style.blue': 'Blue',\n\t'color-style.green': 'Green',\n\t'color-style.grey': 'Grey',\n\t'color-style.light-blue': 'Light blue',\n\t'color-style.light-green': 'Light green',\n\t'color-style.light-red': 'Light red',\n\t'color-style.light-violet': 'Light violet',\n\t'color-style.orange': 'Orange',\n\t'color-style.red': 'Red',\n\t'color-style.violet': 'Violet',\n\t'color-style.yellow': 'Yellow',\n\t'fill-style.none': 'None',\n\t'document.default-name': 'Untitled',\n\t'fill-style.semi': 'Semi',\n\t'fill-style.solid': 'Solid',\n\t'fill-style.pattern': 'Pattern',\n\t'dash-style.dashed': 'Dashed',\n\t'dash-style.dotted': 'Dotted',\n\t'dash-style.draw': 'Draw',\n\t'dash-style.solid': 'Solid',\n\t'size-style.s': 'Small',\n\t'size-style.m': 'Medium',\n\t'size-style.l': 'Large',\n\t'size-style.xl': 'Extra large',\n\t'opacity-style.0.1': '10%',\n\t'opacity-style.0.25': '25%',\n\t'opacity-style.0.5': '50%',\n\t'opacity-style.0.75': '75%',\n\t'opacity-style.1': '100%',\n\t'font-style.draw': 'Draw',\n\t'font-style.sans': 'Sans',\n\t'font-style.serif': 'Serif',\n\t'font-style.mono': 'Mono',\n\t'align-style.start': 'Start',\n\t'align-style.middle': 'Middle',\n\t'align-style.end': 'End',\n\t'align-style.justify': 'Justify',\n\t'verticalAlign-style.start': 'Top',\n\t'verticalAlign-style.middle': 'Middle',\n\t'verticalAlign-style.end': 'Bottom',\n\t'geo-style.arrow-down': 'Arrow down',\n\t'geo-style.arrow-left': 'Arrow left',\n\t'geo-style.arrow-right': 'Arrow right',\n\t'geo-style.arrow-up': 'Arrow up',\n\t'geo-style.diamond': 'Diamond',\n\t'geo-style.ellipse': 'Ellipse',\n\t'geo-style.hexagon': 'Hexagon',\n\t'geo-style.octagon': 'Octagon',\n\t'geo-style.oval': 'Oval',\n\t'geo-style.cloud': 'Cloud',\n\t'geo-style.pentagon': 'Pentagon',\n\t'geo-style.rectangle': 'Rectangle',\n\t'geo-style.rhombus-2': 'Rhombus 2',\n\t'geo-style.rhombus': 'Rhombus',\n\t'geo-style.star': 'Star',\n\t'geo-style.trapezoid': 'Trapezoid',\n\t'geo-style.triangle': 'Triangle',\n\t'geo-style.x-box': 'X box',\n\t'geo-style.check-box': 'Check box',\n\t'arrowheadStart-style.none': 'None',\n\t'arrowheadStart-style.arrow': 'Arrow',\n\t'arrowheadStart-style.bar': 'Bar',\n\t'arrowheadStart-style.diamond': 'Diamond',\n\t'arrowheadStart-style.dot': 'Dot',\n\t'arrowheadStart-style.inverted': 'Inverted',\n\t'arrowheadStart-style.pipe': 'Pipe',\n\t'arrowheadStart-style.square': 'Square',\n\t'arrowheadStart-style.triangle': 'Triangle',\n\t'arrowheadEnd-style.none': 'None',\n\t'arrowheadEnd-style.arrow': 'Arrow',\n\t'arrowheadEnd-style.bar': 'Bar',\n\t'arrowheadEnd-style.diamond': 'Diamond',\n\t'arrowheadEnd-style.dot': 'Dot',\n\t'arrowheadEnd-style.inverted': 'Inverted',\n\t'arrowheadEnd-style.pipe': 'Pipe',\n\t'arrowheadEnd-style.square': 'Square',\n\t'arrowheadEnd-style.triangle': 'Triangle',\n\t'spline-style.line': 'Line',\n\t'spline-style.cubic': 'Cubic',\n\t'tool.select': 'Select',\n\t'tool.hand': 'Hand',\n\t'tool.draw': 'Draw',\n\t'tool.eraser': 'Eraser',\n\t'tool.arrow-down': 'Arrow down',\n\t'tool.arrow-left': 'Arrow left',\n\t'tool.arrow-right': 'Arrow right',\n\t'tool.arrow-up': 'Arrow up',\n\t'tool.arrow': 'Arrow',\n\t'tool.cloud': 'Cloud',\n\t'tool.diamond': 'Diamond',\n\t'tool.ellipse': 'Ellipse',\n\t'tool.hexagon': 'Hexagon',\n\t'tool.highlight': 'Highlight',\n\t'tool.line': 'Line',\n\t'tool.octagon': 'Octagon',\n\t'tool.oval': 'Oval',\n\t'tool.pentagon': 'Pentagon',\n\t'tool.rectangle': 'Rectangle',\n\t'tool.rhombus': 'Rhombus',\n\t'tool.star': 'Star',\n\t'tool.trapezoid': 'Trapezoid',\n\t'tool.triangle': 'Triangle',\n\t'tool.x-box': 'X box',\n\t'tool.check-box': 'Check box',\n\t'tool.asset': 'Asset',\n\t'tool.frame': 'Frame',\n\t'tool.note': 'Note',\n\t'tool.laser': 'Laser',\n\t'tool.embed': 'Embed',\n\t'tool.text': 'Text',\n\t'menu.title': 'Menu',\n\t'menu.copy-as': 'Copy as',\n\t'menu.edit': 'Edit',\n\t'menu.export-as': 'Export as',\n\t'menu.file': 'File',\n\t'menu.language': 'Language',\n\t'menu.preferences': 'Preferences',\n\t'menu.view': 'View',\n\t'context-menu.arrange': 'Arrange',\n\t'context-menu.copy-as': 'Copy as',\n\t'context-menu.export-as': 'Export as',\n\t'context-menu.export-all-as': 'Export',\n\t'context-menu.move-to-page': 'Move to page',\n\t'context-menu.reorder': 'Reorder',\n\t'page-menu.title': 'Pages',\n\t'page-menu.create-new-page': 'Create new page',\n\t'page-menu.max-page-count-reached': 'Max pages reached',\n\t'page-menu.new-page-initial-name': 'Page 1',\n\t'page-menu.edit-start': 'Edit',\n\t'page-menu.edit-done': 'Done',\n\t'page-menu.go-to-page': 'Go to page',\n\t'page-menu.submenu.rename': 'Rename',\n\t'page-menu.submenu.duplicate-page': 'Duplicate',\n\t'page-menu.submenu.title': 'Menu',\n\t'page-menu.submenu.move-down': 'Move down',\n\t'page-menu.submenu.move-up': 'Move up',\n\t'page-menu.submenu.delete': 'Delete',\n\t'share-menu.title': 'Share',\n\t'share-menu.save-note': 'Download this project to your computer as a .tldr file.',\n\t'share-menu.fork-note': 'Create a new shared project based on this snapshot.',\n\t'share-menu.share-project': 'Share this project',\n\t'share-menu.default-project-name': 'Shared Project',\n\t'share-menu.copy-link': 'Copy share link',\n\t'share-menu.readonly-link': 'Read-only',\n\t'share-menu.create-snapshot-link': 'Copy snapshot link',\n\t'share-menu.snapshot-link-note': 'Capture and share this project as a read-only snapshot link.',\n\t'share-menu.copy-readonly-link': 'Copy read-only link',\n\t'share-menu.offline-note': 'Create a new shared project based on your current project.',\n\t'share-menu.copy-link-note': 'Anyone with the link will be able to view and edit this project.',\n\t'share-menu.copy-readonly-link-note':\n\t\t'Anyone with the link will be able to view (but not edit) this project.',\n\t'share-menu.project-too-large':\n\t\t\"Sorry, this project can't be shared because it's too large. We're working on it!\",\n\t'share-menu.upload-failed':\n\t\t\"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.\",\n\t'status.offline': 'Offline',\n\t'status.online': 'Online',\n\t'people-menu.title': 'People',\n\t'people-menu.change-name': 'Change name',\n\t'people-menu.change-color': 'Change color',\n\t'people-menu.follow': 'Following',\n\t'people-menu.following': 'Following',\n\t'people-menu.leading': 'Following You',\n\t'people-menu.user': '(You)',\n\t'people-menu.invite': 'Invite others',\n\t'help-menu.title': 'Help and resources',\n\t'help-menu.about': 'About',\n\t'help-menu.discord': 'Discord',\n\t'help-menu.github': 'GitHub',\n\t'help-menu.keyboard-shortcuts': 'Keyboard shortcuts',\n\t'help-menu.twitter': 'Twitter',\n\t'actions-menu.title': 'Actions',\n\t'edit-link-dialog.title': 'Edit link',\n\t'edit-link-dialog.invalid-url': 'A link must be a valid URL.',\n\t'edit-link-dialog.detail': 'Links will open in a new tab.',\n\t'edit-link-dialog.url': 'URL',\n\t'edit-link-dialog.clear': 'Clear',\n\t'edit-link-dialog.save': 'Continue',\n\t'edit-link-dialog.cancel': 'Cancel',\n\t'embed-dialog.title': 'Insert embed',\n\t'embed-dialog.back': 'Back',\n\t'embed-dialog.create': 'Create',\n\t'embed-dialog.cancel': 'Cancel',\n\t'embed-dialog.url': 'URL',\n\t'embed-dialog.instruction': \"Paste in the site's URL to create the embed.\",\n\t'embed-dialog.invalid-url': 'We could not create an embed from that URL.',\n\t'edit-pages-dialog.move-down': 'Move down',\n\t'edit-pages-dialog.move-up': 'Move up',\n\t'shortcuts-dialog.title': 'Keyboard shortcuts',\n\t'shortcuts-dialog.edit': 'Edit',\n\t'shortcuts-dialog.file': 'File',\n\t'shortcuts-dialog.preferences': 'Preferences',\n\t'shortcuts-dialog.tools': 'Tools',\n\t'shortcuts-dialog.transform': 'Transform',\n\t'shortcuts-dialog.view': 'View',\n\t'shortcuts-dialog.collaboration': 'Collaboration',\n\t'home-project-dialog.title': 'Home project',\n\t'home-project-dialog.description': \"This is your local home project. It's just for you!\",\n\t'rename-project-dialog.title': 'Rename project',\n\t'rename-project-dialog.cancel': 'Cancel',\n\t'rename-project-dialog.rename': 'Rename',\n\t'home-project-dialog.ok': 'Ok',\n\t'style-panel.title': 'Styles',\n\t'style-panel.align': 'Align',\n\t'style-panel.vertical-align': 'Vertical align',\n\t'style-panel.position': 'Position',\n\t'style-panel.arrowheads': 'Arrows',\n\t'style-panel.arrowhead-start': 'Start',\n\t'style-panel.arrowhead-end': 'End',\n\t'style-panel.color': 'Color',\n\t'style-panel.dash': 'Dash',\n\t'style-panel.fill': 'Fill',\n\t'style-panel.font': 'Font',\n\t'style-panel.geo': 'Shape',\n\t'style-panel.mixed': 'Mixed',\n\t'style-panel.opacity': 'Opacity',\n\t'style-panel.size': 'Size',\n\t'style-panel.spline': 'Spline',\n\t'tool-panel.drawing': 'Drawing',\n\t'tool-panel.shapes': 'Shapes',\n\t'tool-panel.more': 'More',\n\t'debug-panel.more': 'More',\n\t'navigation-zone.toggle-minimap': 'Toggle minimap',\n\t'navigation-zone.zoom': 'Zoom',\n\t'focus-mode.toggle-focus-mode': 'Toggle focus mode',\n\t'toast.close': 'Close',\n\t'file-system.file-open-error.title': 'Could not open file',\n\t'file-system.file-open-error.not-a-tldraw-file':\n\t\t\"The file you tried to open doesn't look like a tldraw file.\",\n\t'file-system.file-open-error.file-format-version-too-new':\n\t\t'The file you tried to open is from a newer version of tldraw. Please reload the page and try again.',\n\t'file-system.file-open-error.generic-corrupted-file': 'The file you tried to open is corrupted.',\n\t'file-system.confirm-open.title': 'Overwrite current project?',\n\t'file-system.confirm-open.description':\n\t\t'Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?',\n\t'file-system.confirm-open.cancel': 'Cancel',\n\t'file-system.confirm-open.open': 'Open file',\n\t'file-system.confirm-open.dont-show-again': \"Don't ask again\",\n\t'file-system.confirm-clear.title': 'Clear current project?',\n\t'file-system.confirm-clear.description':\n\t\t'Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?',\n\t'file-system.confirm-clear.cancel': 'Cancel',\n\t'file-system.confirm-clear.continue': 'Continue',\n\t'file-system.confirm-clear.dont-show-again': \"Don't ask again\",\n\t'file-system.shared-document-file-open-error.title': 'Could not open file',\n\t'file-system.shared-document-file-open-error.description':\n\t\t'Opening files from shared projects is not supported.',\n\t'sharing.confirm-leave.title': 'Leave current project?',\n\t'sharing.confirm-leave.description':\n\t\t'Are you sure you want to leave this shared project? You can return to it by navigating to its URL.',\n\t'sharing.confirm-leave.cancel': 'Cancel',\n\t'sharing.confirm-leave.leave': 'Leave',\n\t'sharing.confirm-leave.dont-show-again': \"Don't ask again\",\n\t'toast.error.export-fail.title': 'Failed export',\n\t'toast.error.export-fail.desc': 'Failed to export image',\n\t'toast.error.copy-fail.title': 'Failed copy',\n\t'toast.error.copy-fail.desc': 'Failed to copy image',\n\t'context.pages.new-page': 'New page',\n\t'vscode.file-open.desc':\n\t\t\"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.\",\n\t'vscode.file-open.open': 'Continue',\n\t'vscode.file-open.backup': 'Backup',\n\t'vscode.file-open.backup-saved': 'Backup saved',\n\t'vscode.file-open.backup-failed': 'Backup failed: this is not a .tldr file.',\n\t'vscode.file-open.dont-show-again': \"Don't ask again\",\n\t'cursor-chat.type-to-chat': 'Type to chat...',\n}\n", "import { LANGUAGES } from '@tldraw/editor'\nimport { TLUiAssetUrls } from '../../assetUrls'\nimport { TLUiTranslationKey } from './TLUiTranslationKey'\nimport { DEFAULT_TRANSLATION } from './defaultTranslation'\n\n// The default language (english) must have a value for every message.\n// Other languages may have missing messages. If the application finds\n// a missing message for the current language, it will use the english\n// translation instead.\n\n/* ----------------- (do not change) ---------------- */\n\nexport const RTL_LANGUAGES = new Set(['ar', 'fa', 'he', 'ur', 'ku'])\n\n/** @public */\nexport type TLUiTranslation = {\n\treadonly locale: string\n\treadonly label: string\n\treadonly messages: Record<TLUiTranslationKey, string>\n\treadonly dir: 'rtl' | 'ltr'\n}\n\nconst EN_TRANSLATION: TLUiTranslation = {\n\tlocale: 'en',\n\tlabel: 'English',\n\tmessages: DEFAULT_TRANSLATION as TLUiTranslation['messages'],\n\tdir: 'ltr',\n}\n\n/** @internal */\nexport async function fetchTranslation(\n\tlocale: TLUiTranslation['locale'],\n\tassetUrls: TLUiAssetUrls\n): Promise<TLUiTranslation> {\n\tconst mainRes = await fetch(assetUrls.translations.en)\n\n\tif (!mainRes.ok) {\n\t\tconsole.warn(`No main translations found.`)\n\t\treturn EN_TRANSLATION\n\t}\n\n\tif (locale === 'en') {\n\t\treturn EN_TRANSLATION\n\t}\n\n\tconst language = LANGUAGES.find((t) => t.locale === locale)\n\n\tif (!language) {\n\t\tconsole.warn(`No translation found for locale ${locale}`)\n\t\treturn EN_TRANSLATION\n\t}\n\n\tconst res = await fetch(assetUrls.translations[language.locale])\n\tconst messages: TLUiTranslation['messages'] = await res.json()\n\n\tif (!messages) {\n\t\tconsole.warn(`No messages found for locale ${locale}`)\n\t\treturn EN_TRANSLATION\n\t}\n\n\tconst missing: string[] = []\n\n\tfor (const key in EN_TRANSLATION.messages) {\n\t\tif (!messages[key as TLUiTranslationKey]) {\n\t\t\tmissing.push(key)\n\t\t}\n\t}\n\n\tif (missing.length > 0 && process.env.NODE_ENV === 'development') {\n\t\tconsole.warn(`Language ${locale}: missing messages for keys:\\n${missing.join('\\n')}`)\n\t}\n\n\treturn {\n\t\tlocale,\n\t\tlabel: language.label,\n\t\tdir: RTL_LANGUAGES.has(language.locale) ? 'rtl' : 'ltr',\n\t\tmessages: { ...EN_TRANSLATION.messages, ...messages },\n\t}\n}\n", "/* eslint-disable react-hooks/rules-of-hooks */\nimport {\n\tBox,\n\tEditor,\n\tRectangle2d,\n\tShapeUtil,\n\tSvgExportContext,\n\tTLOnEditEndHandler,\n\tTLOnResizeHandler,\n\tTLShapeId,\n\tTLShapeUtilFlag,\n\tTLTextShape,\n\tVec,\n\tWeakMapCache,\n\tgetDefaultColorTheme,\n\tpreventDefault,\n\ttextShapeMigrations,\n\ttextShapeProps,\n\ttoDomPrecision,\n\tuseEditor,\n} from '@tldraw/editor'\nimport { useCallback } from 'react'\nimport { useDefaultColorTheme } from '../shared/ShapeFill'\nimport { SvgTextLabel } from '../shared/SvgTextLabel'\nimport { TextHelpers } from '../shared/TextHelpers'\nimport { TextLabel } from '../shared/TextLabel'\nimport { FONT_FAMILIES, FONT_SIZES, TEXT_PROPS } from '../shared/default-shape-constants'\nimport { getFontDefForExport } from '../shared/defaultStyleDefs'\nimport { resizeScaled } from '../shared/resizeScaled'\n\nconst sizeCache = new WeakMapCache<TLTextShape['props'], { height: number; width: number }>()\n\n/** @public */\nexport class TextShapeUtil extends ShapeUtil<TLTextShape> {\n\tstatic override type = 'text' as const\n\tstatic override props = textShapeProps\n\tstatic override migrations = textShapeMigrations\n\n\tgetDefaultProps(): TLTextShape['props'] {\n\t\treturn {\n\t\t\tcolor: 'black',\n\t\t\tsize: 'm',\n\t\t\tw: 8,\n\t\t\ttext: '',\n\t\t\tfont: 'draw',\n\t\t\talign: 'middle',\n\t\t\tautoSize: true,\n\t\t\tscale: 1,\n\t\t}\n\t}\n\n\tgetMinDimensions(shape: TLTextShape) {\n\t\treturn sizeCache.get(shape.props, (props) => getTextSize(this.editor, props))\n\t}\n\n\tgetGeometry(shape: TLTextShape) {\n\t\tconst { scale } = shape.props\n\t\tconst { width, height } = this.getMinDimensions(shape)!\n\t\treturn new Rectangle2d({\n\t\t\twidth: width * scale,\n\t\t\theight: height * scale,\n\t\t\tisFilled: true,\n\t\t\tisLabel: true,\n\t\t})\n\t}\n\n\toverride canEdit = () => true\n\n\toverride isAspectRatioLocked: TLShapeUtilFlag<TLTextShape> = () => true\n\n\tcomponent(shape: TLTextShape) {\n\t\tconst {\n\t\t\tid,\n\t\t\tprops: { font, size, text, color, scale, align },\n\t\t} = shape\n\n\t\tconst { width, height } = this.getMinDimensions(shape)\n\t\tconst isSelected = shape.id === this.editor.getOnlySelectedShapeId()\n\t\tconst theme = useDefaultColorTheme()\n\t\tconst handleKeyDown = useTextShapeKeydownHandler(id)\n\n\t\treturn (\n\t\t\t<TextLabel\n\t\t\t\tid={id}\n\t\t\t\tclassNamePrefix=\"tl-text-shape\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tfont={font}\n\t\t\t\tfontSize={FONT_SIZES[size]}\n\t\t\t\tlineHeight={TEXT_PROPS.lineHeight}\n\t\t\t\talign={align}\n\t\t\t\tverticalAlign=\"middle\"\n\t\t\t\ttext={text}\n\t\t\t\tlabelColor={theme[color].solid}\n\t\t\t\tisSelected={isSelected}\n\t\t\t\ttextWidth={width}\n\t\t\t\ttextHeight={height}\n\t\t\t\tstyle={{\n\t\t\t\t\ttransform: `scale(${scale})`,\n\t\t\t\t\ttransformOrigin: 'top left',\n\t\t\t\t}}\n\t\t\t\twrap\n\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t/>\n\t\t)\n\t}\n\n\tindicator(shape: TLTextShape) {\n\t\tconst bounds = this.editor.getShapeGeometry(shape).bounds\n\t\tconst editor = useEditor()\n\t\tif (shape.props.autoSize && editor.getEditingShapeId() === shape.id) return null\n\t\treturn <rect width={toDomPrecision(bounds.width)} height={toDomPrecision(bounds.height)} />\n\t}\n\n\toverride toSvg(shape: TLTextShape, ctx: SvgExportContext) {\n\t\tctx.addExportDef(getFontDefForExport(shape.props.font))\n\t\tif (shape.props.text) ctx.addExportDef(getFontDefForExport(shape.props.font))\n\n\t\tconst bounds = this.editor.getShapeGeometry(shape).bounds\n\t\tconst width = bounds.width / (shape.props.scale ?? 1)\n\t\tconst height = bounds.height / (shape.props.scale ?? 1)\n\n\t\tconst theme = getDefaultColorTheme(ctx)\n\n\t\treturn (\n\t\t\t<SvgTextLabel\n\t\t\t\tfontSize={FONT_SIZES[shape.props.size]}\n\t\t\t\tfont={shape.props.font}\n\t\t\t\talign={shape.props.align}\n\t\t\t\tverticalAlign=\"middle\"\n\t\t\t\ttext={shape.props.text}\n\t\t\t\tlabelColor={theme[shape.props.color].solid}\n\t\t\t\tbounds={new Box(0, 0, width, height)}\n\t\t\t\tpadding={0}\n\t\t\t/>\n\t\t)\n\t}\n\n\toverride onResize: TLOnResizeHandler<TLTextShape> = (shape, info) => {\n\t\tconst { initialBounds, initialShape, scaleX, handle } = info\n\n\t\tif (info.mode === 'scale_shape' || (handle !== 'right' && handle !== 'left')) {\n\t\t\treturn {\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\t...resizeScaled(shape, info),\n\t\t\t}\n\t\t} else {\n\t\t\tconst prevWidth = initialBounds.width\n\t\t\tlet nextWidth = prevWidth * scaleX\n\n\t\t\tconst offset = new Vec(0, 0)\n\n\t\t\tnextWidth = Math.max(1, Math.abs(nextWidth))\n\n\t\t\tif (handle === 'left') {\n\t\t\t\toffset.x = prevWidth - nextWidth\n\t\t\t\tif (scaleX < 0) {\n\t\t\t\t\toffset.x += nextWidth\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (scaleX < 0) {\n\t\t\t\t\toffset.x -= nextWidth\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst { x, y } = offset.rot(shape.rotation).add(initialShape)\n\n\t\t\treturn {\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tprops: {\n\t\t\t\t\tw: nextWidth / initialShape.props.scale,\n\t\t\t\t\tautoSize: false,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onBeforeCreate = (shape: TLTextShape) => {\n\t\t// When a shape is created, center the text at the created point.\n\n\t\t// Only center if the shape is set to autosize.\n\t\tif (!shape.props.autoSize) return\n\n\t\t// Only center if the shape is empty when created.\n\t\tif (shape.props.text.trim()) return\n\n\t\tconst bounds = this.getMinDimensions(shape)\n\n\t\treturn {\n\t\t\t...shape,\n\t\t\tx: shape.x - bounds.width / 2,\n\t\t\ty: shape.y - bounds.height / 2,\n\t\t}\n\t}\n\n\toverride onEditEnd: TLOnEditEndHandler<TLTextShape> = (shape) => {\n\t\tconst {\n\t\t\tid,\n\t\t\ttype,\n\t\t\tprops: { text },\n\t\t} = shape\n\n\t\tconst trimmedText = shape.props.text.trimEnd()\n\n\t\tif (trimmedText.length === 0) {\n\t\t\tthis.editor.deleteShapes([shape.id])\n\t\t} else {\n\t\t\tif (trimmedText !== shape.props.text) {\n\t\t\t\tthis.editor.updateShapes([\n\t\t\t\t\t{\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\ttext: text.trimEnd(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onBeforeUpdate = (prev: TLTextShape, next: TLTextShape) => {\n\t\tif (!next.props.autoSize) return\n\n\t\tconst styleDidChange =\n\t\t\tprev.props.size !== next.props.size ||\n\t\t\tprev.props.align !== next.props.align ||\n\t\t\tprev.props.font !== next.props.font ||\n\t\t\t(prev.props.scale !== 1 && next.props.scale === 1)\n\n\t\tconst textDidChange = prev.props.text !== next.props.text\n\n\t\t// Only update position if either changed\n\t\tif (!styleDidChange && !textDidChange) return\n\n\t\t// Might return a cached value for the bounds\n\t\tconst boundsA = this.getMinDimensions(prev)\n\n\t\t// Will always be a fresh call to getTextSize\n\t\tconst boundsB = getTextSize(this.editor, next.props)\n\n\t\tconst wA = boundsA.width * prev.props.scale\n\t\tconst hA = boundsA.height * prev.props.scale\n\t\tconst wB = boundsB.width * next.props.scale\n\t\tconst hB = boundsB.height * next.props.scale\n\n\t\tlet delta: Vec | undefined\n\n\t\tswitch (next.props.align) {\n\t\t\tcase 'middle': {\n\t\t\t\tdelta = new Vec((wB - wA) / 2, textDidChange ? 0 : (hB - hA) / 2)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'end': {\n\t\t\t\tdelta = new Vec(wB - wA, textDidChange ? 0 : (hB - hA) / 2)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\tif (textDidChange) break\n\t\t\t\tdelta = new Vec(0, (hB - hA) / 2)\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tif (delta) {\n\t\t\t// account for shape rotation when writing text:\n\t\t\tdelta.rot(next.rotation)\n\t\t\tconst { x, y } = next\n\t\t\treturn {\n\t\t\t\t...next,\n\t\t\t\tx: x - delta.x,\n\t\t\t\ty: y - delta.y,\n\t\t\t\tprops: { ...next.props, w: wB },\n\t\t\t}\n\t\t} else {\n\t\t\treturn {\n\t\t\t\t...next,\n\t\t\t\tprops: { ...next.props, w: wB },\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onDoubleClickEdge = (shape: TLTextShape) => {\n\t\t// If the shape has a fixed width, set it to autoSize.\n\t\tif (!shape.props.autoSize) {\n\t\t\treturn {\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tprops: {\n\t\t\t\t\tautoSize: true,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\n\t\t// If the shape is scaled, reset the scale to 1.\n\t\tif (shape.props.scale !== 1) {\n\t\t\treturn {\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tprops: {\n\t\t\t\t\tscale: 1,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction getTextSize(editor: Editor, props: TLTextShape['props']) {\n\tconst { font, text, autoSize, size, w } = props\n\n\tconst minWidth = autoSize ? 16 : Math.max(16, w)\n\tconst fontSize = FONT_SIZES[size]\n\n\tconst cw = autoSize\n\t\t? null\n\t\t: // `measureText` floors the number so we need to do the same here to avoid issues.\n\t\t\tMath.floor(Math.max(minWidth, w))\n\n\tconst result = editor.textMeasure.measureText(text, {\n\t\t...TEXT_PROPS,\n\t\tfontFamily: FONT_FAMILIES[font],\n\t\tfontSize: fontSize,\n\t\tmaxWidth: cw,\n\t})\n\n\t// // If we're autosizing the measureText will essentially `Math.floor`\n\t// // the numbers so `19` rather than `19.3`, this means we must +1 to\n\t// // whatever we get to avoid wrapping.\n\tif (autoSize) {\n\t\tresult.w += 1\n\t}\n\n\treturn {\n\t\twidth: Math.max(minWidth, result.w),\n\t\theight: Math.max(fontSize, result.h),\n\t}\n}\n\nfunction useTextShapeKeydownHandler(id: TLShapeId) {\n\tconst editor = useEditor()\n\n\treturn useCallback(\n\t\t(e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n\t\t\tif (editor.getEditingShapeId() !== id) return\n\n\t\t\tswitch (e.key) {\n\t\t\t\tcase 'Enter': {\n\t\t\t\t\tif (e.ctrlKey || e.metaKey) {\n\t\t\t\t\t\teditor.complete()\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase 'Tab': {\n\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\t\tTextHelpers.unindent(e.currentTarget)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tTextHelpers.indent(e.currentTarget)\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[editor, id]\n\t)\n}\n", "import { Box, TLShape, Vec, VecModel } from '@tldraw/editor'\n\nexport function resizeScaled(\n\tshape: Extract<TLShape, { props: { scale: number } }>,\n\t{\n\t\tinitialBounds,\n\t\tscaleX,\n\t\tscaleY,\n\t\tnewPoint,\n\t}: {\n\t\tnewPoint: VecModel\n\t\tinitialBounds: Box\n\t\tscaleX: number\n\t\tscaleY: number\n\t}\n) {\n\t// Compute the new scale (to apply to the scale prop)\n\tconst scaleDelta = Math.max(0.01, Math.min(Math.abs(scaleX), Math.abs(scaleY)))\n\n\t// Compute the offset (if flipped X or flipped Y)\n\tconst offset = new Vec(0, 0)\n\n\tif (scaleX < 0) {\n\t\toffset.x = -(initialBounds.width * scaleDelta)\n\t}\n\tif (scaleY < 0) {\n\t\toffset.y = -(initialBounds.height * scaleDelta)\n\t}\n\n\t// Apply the offset to the new point\n\tconst { x, y } = Vec.Add(newPoint, offset.rot(shape.rotation))\n\n\treturn {\n\t\tx,\n\t\ty,\n\t\tprops: {\n\t\t\tscale: scaleDelta * shape.props.scale,\n\t\t},\n\t}\n}\n", "/* eslint-disable react-hooks/rules-of-hooks */\nimport {\n\tBaseBoxShapeUtil,\n\tHTMLContainer,\n\tTLVideoShape,\n\ttoDomPrecision,\n\tuseIsEditing,\n\tvideoShapeMigrations,\n\tvideoShapeProps,\n} from '@tldraw/editor'\nimport { ReactEventHandler, useCallback, useEffect, useRef, useState } from 'react'\nimport { BrokenAssetIcon } from '../shared/BrokenAssetIcon'\nimport { HyperlinkButton } from '../shared/HyperlinkButton'\nimport { usePrefersReducedMotion } from '../shared/usePrefersReducedMotion'\n\n/** @public */\nexport class VideoShapeUtil extends BaseBoxShapeUtil<TLVideoShape> {\n\tstatic override type = 'video' as const\n\tstatic override props = videoShapeProps\n\tstatic override migrations = videoShapeMigrations\n\n\toverride canEdit = () => true\n\toverride isAspectRatioLocked = () => true\n\n\toverride getDefaultProps(): TLVideoShape['props'] {\n\t\treturn {\n\t\t\tw: 100,\n\t\t\th: 100,\n\t\t\tassetId: null,\n\t\t\ttime: 0,\n\t\t\tplaying: true,\n\t\t\turl: '',\n\t\t}\n\t}\n\n\tcomponent(shape: TLVideoShape) {\n\t\tconst { editor } = this\n\t\tconst showControls = editor.getShapeGeometry(shape).bounds.w * editor.getZoomLevel() >= 110\n\t\tconst asset = shape.props.assetId ? editor.getAsset(shape.props.assetId) : null\n\t\tconst { time, playing } = shape.props\n\t\tconst isEditing = useIsEditing(shape.id)\n\t\tconst prefersReducedMotion = usePrefersReducedMotion()\n\n\t\tconst rVideo = useRef<HTMLVideoElement>(null!)\n\n\t\tconst handlePlay = useCallback<ReactEventHandler<HTMLVideoElement>>(\n\t\t\t(e) => {\n\t\t\t\tconst video = e.currentTarget\n\t\t\t\tif (!video) return\n\n\t\t\t\teditor.updateShapes([\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'video',\n\t\t\t\t\t\tid: shape.id,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tplaying: true,\n\t\t\t\t\t\t\ttime: video.currentTime,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t},\n\t\t\t[shape.id, editor]\n\t\t)\n\n\t\tconst handlePause = useCallback<ReactEventHandler<HTMLVideoElement>>(\n\t\t\t(e) => {\n\t\t\t\tconst video = e.currentTarget\n\t\t\t\tif (!video) return\n\n\t\t\t\teditor.updateShapes([\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'video',\n\t\t\t\t\t\tid: shape.id,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tplaying: false,\n\t\t\t\t\t\t\ttime: video.currentTime,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t},\n\t\t\t[shape.id, editor]\n\t\t)\n\n\t\tconst handleSetCurrentTime = useCallback<ReactEventHandler<HTMLVideoElement>>(\n\t\t\t(e) => {\n\t\t\t\tconst video = e.currentTarget\n\t\t\t\tif (!video) return\n\n\t\t\t\tif (isEditing) {\n\t\t\t\t\teditor.updateShapes([\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'video',\n\t\t\t\t\t\t\tid: shape.id,\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\ttime: video.currentTime,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t])\n\t\t\t\t}\n\t\t\t},\n\t\t\t[isEditing, shape.id, editor]\n\t\t)\n\n\t\tconst [isLoaded, setIsLoaded] = useState(false)\n\n\t\tconst handleLoadedData = useCallback<ReactEventHandler<HTMLVideoElement>>(\n\t\t\t(e) => {\n\t\t\t\tconst video = e.currentTarget\n\t\t\t\tif (!video) return\n\t\t\t\tif (time !== video.currentTime) {\n\t\t\t\t\tvideo.currentTime = time\n\t\t\t\t}\n\n\t\t\t\tif (!playing) {\n\t\t\t\t\tvideo.pause()\n\t\t\t\t}\n\n\t\t\t\tsetIsLoaded(true)\n\t\t\t},\n\t\t\t[playing, time]\n\t\t)\n\n\t\t// If the current time changes and we're not editing the video, update the video time\n\t\tuseEffect(() => {\n\t\t\tconst video = rVideo.current\n\t\t\tif (!video) return\n\n\t\t\tif (isLoaded && !isEditing && time !== video.currentTime) {\n\t\t\t\tvideo.currentTime = time\n\t\t\t}\n\n\t\t\tif (isEditing) {\n\t\t\t\tif (document.activeElement !== video) {\n\t\t\t\t\tvideo.focus()\n\t\t\t\t}\n\t\t\t}\n\t\t}, [isEditing, isLoaded, time])\n\n\t\tuseEffect(() => {\n\t\t\tif (prefersReducedMotion) {\n\t\t\t\tconst video = rVideo.current\n\t\t\t\tif (!video) return\n\t\t\t\tvideo.pause()\n\t\t\t\tvideo.currentTime = 0\n\t\t\t}\n\t\t}, [rVideo, prefersReducedMotion])\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<HTMLContainer\n\t\t\t\t\tid={shape.id}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tcolor: 'var(--color-text-3)',\n\t\t\t\t\t\tbackgroundColor: asset ? 'transparent' : 'var(--color-low)',\n\t\t\t\t\t\tborder: asset ? 'none' : '1px solid var(--color-low-border)',\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"tl-counter-scaled\">\n\t\t\t\t\t\t<div className=\"tl-video-container\">\n\t\t\t\t\t\t\t{asset?.props.src ? (\n\t\t\t\t\t\t\t\t<video\n\t\t\t\t\t\t\t\t\tref={rVideo}\n\t\t\t\t\t\t\t\t\tstyle={isEditing ? { pointerEvents: 'all' } : undefined}\n\t\t\t\t\t\t\t\t\tclassName={`tl-video tl-video-shape-${shape.id.split(':')[1]}`}\n\t\t\t\t\t\t\t\t\twidth=\"100%\"\n\t\t\t\t\t\t\t\t\theight=\"100%\"\n\t\t\t\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\t\t\t\tplaysInline\n\t\t\t\t\t\t\t\t\tautoPlay\n\t\t\t\t\t\t\t\t\tmuted\n\t\t\t\t\t\t\t\t\tloop\n\t\t\t\t\t\t\t\t\tdisableRemotePlayback\n\t\t\t\t\t\t\t\t\tdisablePictureInPicture\n\t\t\t\t\t\t\t\t\tcontrols={isEditing && showControls}\n\t\t\t\t\t\t\t\t\tonPlay={handlePlay}\n\t\t\t\t\t\t\t\t\tonPause={handlePause}\n\t\t\t\t\t\t\t\t\tonTimeUpdate={handleSetCurrentTime}\n\t\t\t\t\t\t\t\t\tonLoadedData={handleLoadedData}\n\t\t\t\t\t\t\t\t\thidden={!isLoaded}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<source src={asset.props.src} />\n\t\t\t\t\t\t\t\t</video>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<BrokenAssetIcon />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</HTMLContainer>\n\t\t\t\t{'url' in shape.props && shape.props.url && (\n\t\t\t\t\t<HyperlinkButton url={shape.props.url} zoomLevel={editor.getZoomLevel()} />\n\t\t\t\t)}\n\t\t\t</>\n\t\t)\n\t}\n\n\tindicator(shape: TLVideoShape) {\n\t\treturn <rect width={toDomPrecision(shape.props.w)} height={toDomPrecision(shape.props.h)} />\n\t}\n\n\toverride toSvg(shape: TLVideoShape) {\n\t\treturn <image href={serializeVideo(shape.id)} width={shape.props.w} height={shape.props.h} />\n\t}\n}\n\n// Function from v1, could be improved but explicitly using this.model.time (?)\nfunction serializeVideo(id: string): string {\n\tconst splitId = id.split(':')[1]\n\tconst video = document.querySelector(`.tl-video-shape-${splitId}`) as HTMLVideoElement\n\tif (video) {\n\t\tconst canvas = document.createElement('canvas')\n\t\tcanvas.width = video.videoWidth\n\t\tcanvas.height = video.videoHeight\n\t\tcanvas.getContext('2d')!.drawImage(video, 0, 0)\n\t\treturn canvas.toDataURL('image/png')\n\t} else throw new Error('Video with not found when attempting serialization.')\n}\n", "import { TLAnyShapeUtilConstructor } from '@tldraw/editor'\nimport { ArrowShapeUtil } from './shapes/arrow/ArrowShapeUtil'\nimport { BookmarkShapeUtil } from './shapes/bookmark/BookmarkShapeUtil'\nimport { DrawShapeUtil } from './shapes/draw/DrawShapeUtil'\nimport { EmbedShapeUtil } from './shapes/embed/EmbedShapeUtil'\nimport { FrameShapeUtil } from './shapes/frame/FrameShapeUtil'\nimport { GeoShapeUtil } from './shapes/geo/GeoShapeUtil'\nimport { HighlightShapeUtil } from './shapes/highlight/HighlightShapeUtil'\nimport { ImageShapeUtil } from './shapes/image/ImageShapeUtil'\nimport { LineShapeUtil } from './shapes/line/LineShapeUtil'\nimport { NoteShapeUtil } from './shapes/note/NoteShapeUtil'\nimport { TextShapeUtil } from './shapes/text/TextShapeUtil'\nimport { VideoShapeUtil } from './shapes/video/VideoShapeUtil'\n\n/** @public */\nexport const defaultShapeUtils: TLAnyShapeUtilConstructor[] = [\n\tTextShapeUtil,\n\tBookmarkShapeUtil,\n\tDrawShapeUtil,\n\tGeoShapeUtil,\n\tNoteShapeUtil,\n\tLineShapeUtil,\n\tFrameShapeUtil,\n\tArrowShapeUtil,\n\tHighlightShapeUtil,\n\tEmbedShapeUtil,\n\tImageShapeUtil,\n\tVideoShapeUtil,\n]\n", "import { Editor } from '@tldraw/editor'\n\nexport function registerDefaultSideEffects(editor: Editor) {\n\treturn [\n\t\teditor.sideEffects.registerAfterChangeHandler('instance', (prev, next) => {\n\t\t\tif (prev.isFocused !== next.isFocused) {\n\t\t\t\tif (next.isFocused) {\n\t\t\t\t\teditor.getContainer().focus()\n\t\t\t\t} else {\n\t\t\t\t\teditor.complete() // stop any interaction\n\t\t\t\t\teditor.getContainer().blur() // blur the container\n\t\t\t\t}\n\t\t\t}\n\t\t}),\n\t\teditor.sideEffects.registerAfterChangeHandler('instance_page_state', (prev, next) => {\n\t\t\tif (prev.croppingShapeId !== next.croppingShapeId) {\n\t\t\t\tconst isInCroppingState = editor.isInAny(\n\t\t\t\t\t'select.crop',\n\t\t\t\t\t'select.pointing_crop_handle',\n\t\t\t\t\t'select.cropping'\n\t\t\t\t)\n\t\t\t\tif (!prev.croppingShapeId && next.croppingShapeId) {\n\t\t\t\t\tif (!isInCroppingState) {\n\t\t\t\t\t\teditor.setCurrentTool('select.crop.idle')\n\t\t\t\t\t}\n\t\t\t\t} else if (prev.croppingShapeId && !next.croppingShapeId) {\n\t\t\t\t\tif (isInCroppingState) {\n\t\t\t\t\t\teditor.setCurrentTool('select.idle')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (prev.editingShapeId !== next.editingShapeId) {\n\t\t\t\tif (!prev.editingShapeId && next.editingShapeId) {\n\t\t\t\t\tif (!editor.isIn('select.editing_shape')) {\n\t\t\t\t\t\teditor.setCurrentTool('select.editing_shape')\n\t\t\t\t\t}\n\t\t\t\t} else if (prev.editingShapeId && !next.editingShapeId) {\n\t\t\t\t\tif (editor.isIn('select.editing_shape')) {\n\t\t\t\t\t\teditor.setCurrentTool('select.idle')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}),\n\t]\n}\n", "import {\n\tHIT_TEST_MARGIN,\n\tStateNode,\n\tTLEventHandlers,\n\tTLFrameShape,\n\tTLGroupShape,\n\tTLPointerEventInfo,\n\tTLShapeId,\n\tpointInPolygon,\n} from '@tldraw/editor'\n\nexport class Erasing extends StateNode {\n\tstatic override id = 'erasing'\n\n\tprivate info = {} as TLPointerEventInfo\n\tprivate scribbleId = 'id'\n\tprivate markId = ''\n\tprivate excludedShapeIds = new Set<TLShapeId>()\n\n\toverride onEnter = (info: TLPointerEventInfo) => {\n\t\tthis.markId = 'erase scribble begin'\n\t\tthis.editor.mark(this.markId)\n\t\tthis.info = info\n\n\t\tconst { originPagePoint } = this.editor.inputs\n\t\tthis.excludedShapeIds = new Set(\n\t\t\tthis.editor\n\t\t\t\t.getCurrentPageShapes()\n\t\t\t\t.filter((shape) => {\n\t\t\t\t\t//If the shape is locked, we shouldn't erase it\n\t\t\t\t\tif (this.editor.isShapeOrAncestorLocked(shape)) return true\n\t\t\t\t\t//If the shape is a group or frame, check we're inside it when we start erasing\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.editor.isShapeOfType<TLGroupShape>(shape, 'group') ||\n\t\t\t\t\t\tthis.editor.isShapeOfType<TLFrameShape>(shape, 'frame')\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst pointInShapeShape = this.editor.getPointInShapeSpace(shape, originPagePoint)\n\t\t\t\t\t\tconst geometry = this.editor.getShapeGeometry(shape)\n\t\t\t\t\t\treturn geometry.bounds.containsPoint(pointInShapeShape)\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false\n\t\t\t\t})\n\t\t\t\t.map((shape) => shape.id)\n\t\t)\n\n\t\tconst scribble = this.editor.scribbles.addScribble({\n\t\t\tcolor: 'muted-1',\n\t\t\tsize: 12,\n\t\t})\n\t\tthis.scribbleId = scribble.id\n\n\t\tthis.update()\n\t}\n\n\tprivate pushPointToScribble = () => {\n\t\tconst { x, y } = this.editor.inputs.currentPagePoint\n\t\tthis.editor.scribbles.addPoint(this.scribbleId, x, y)\n\t}\n\n\toverride onExit = () => {\n\t\tthis.editor.scribbles.stop(this.scribbleId)\n\t}\n\n\toverride onPointerMove = () => {\n\t\tthis.update()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\tupdate() {\n\t\tconst { editor, excludedShapeIds } = this\n\t\tconst erasingShapeIds = editor.getErasingShapeIds()\n\t\tconst zoomLevel = editor.getZoomLevel()\n\t\tconst currentPageShapes = editor.getCurrentPageShapes()\n\t\tconst {\n\t\t\tinputs: { currentPagePoint, previousPagePoint },\n\t\t} = editor\n\n\t\tthis.pushPointToScribble()\n\n\t\tconst erasing = new Set<TLShapeId>(erasingShapeIds)\n\t\tconst minDist = HIT_TEST_MARGIN / zoomLevel\n\n\t\tfor (const shape of currentPageShapes) {\n\t\t\tif (editor.isShapeOfType<TLGroupShape>(shape, 'group')) continue\n\n\t\t\t// Avoid testing masked shapes, unless the pointer is inside the mask\n\t\t\tconst pageMask = editor.getShapeMask(shape.id)\n\t\t\tif (pageMask && !pointInPolygon(currentPagePoint, pageMask)) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// Hit test the shape using a line segment\n\t\t\tconst geometry = editor.getShapeGeometry(shape)\n\t\t\tconst pageTransform = editor.getShapePageTransform(shape)\n\t\t\tif (!geometry || !pageTransform) continue\n\t\t\tconst pt = pageTransform.clone().invert()\n\t\t\tconst A = pt.applyToPoint(previousPagePoint)\n\t\t\tconst B = pt.applyToPoint(currentPagePoint)\n\n\t\t\t// If the line segment is entirely above / below / left / right of the shape's bounding box, skip the hit test\n\t\t\tconst { bounds } = geometry\n\t\t\tif (\n\t\t\t\tbounds.minX - minDist > Math.max(A.x, B.x) ||\n\t\t\t\tbounds.minY - minDist > Math.max(A.y, B.y) ||\n\t\t\t\tbounds.maxX + minDist < Math.min(A.x, B.x) ||\n\t\t\t\tbounds.maxY + minDist < Math.min(A.y, B.y)\n\t\t\t) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (geometry.hitTestLineSegment(A, B, minDist)) {\n\t\t\t\terasing.add(editor.getOutermostSelectableShape(shape).id)\n\t\t\t}\n\t\t}\n\n\t\t// Remove the hit shapes, except if they're in the list of excluded shapes\n\t\t// (these excluded shapes will be any frames or groups the pointer was inside of\n\t\t// when the user started erasing)\n\t\tthis.editor.setErasingShapes([...erasing].filter((id) => !excludedShapeIds.has(id)))\n\t}\n\n\tcomplete() {\n\t\tconst { editor } = this\n\t\teditor.deleteShapes(editor.getCurrentPageState().erasingShapeIds)\n\t\teditor.setErasingShapes([])\n\t\tthis.parent.transition('idle')\n\t}\n\n\tcancel() {\n\t\tconst { editor } = this\n\t\teditor.setErasingShapes([])\n\t\teditor.bailToMark(this.markId)\n\t\tthis.parent.transition('idle', this.info)\n\t}\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('pointing', info)\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n}\n", "import {\n\tHIT_TEST_MARGIN,\n\tStateNode,\n\tTLEventHandlers,\n\tTLFrameShape,\n\tTLGroupShape,\n\tTLPointerEventInfo,\n\tTLShapeId,\n} from '@tldraw/editor'\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\toverride onEnter = () => {\n\t\tconst zoomLevel = this.editor.getZoomLevel()\n\t\tconst currentPageShapesSorted = this.editor.getCurrentPageShapesSorted()\n\t\tconst {\n\t\t\tinputs: { currentPagePoint },\n\t\t} = this.editor\n\n\t\tconst erasing = new Set<TLShapeId>()\n\n\t\tconst initialSize = erasing.size\n\n\t\tfor (let n = currentPageShapesSorted.length, i = n - 1; i >= 0; i--) {\n\t\t\tconst shape = currentPageShapesSorted[i]\n\t\t\tif (\n\t\t\t\tthis.editor.isShapeOrAncestorLocked(shape) ||\n\t\t\t\tthis.editor.isShapeOfType<TLGroupShape>(shape, 'group')\n\t\t\t) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.editor.isPointInShape(shape, currentPagePoint, {\n\t\t\t\t\thitInside: false,\n\t\t\t\t\tmargin: HIT_TEST_MARGIN / zoomLevel,\n\t\t\t\t})\n\t\t\t) {\n\t\t\t\tconst hitShape = this.editor.getOutermostSelectableShape(shape)\n\t\t\t\t// If we've hit a frame after hitting any other shape, stop here\n\t\t\t\tif (\n\t\t\t\t\tthis.editor.isShapeOfType<TLFrameShape>(hitShape, 'frame') &&\n\t\t\t\t\terasing.size > initialSize\n\t\t\t\t) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\terasing.add(hitShape.id)\n\t\t\t}\n\t\t}\n\n\t\tthis.editor.setErasingShapes([...erasing])\n\t}\n\n\toverride onLongPress: TLEventHandlers['onLongPress'] = (info) => {\n\t\tthis.startErasing(info)\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.startErasing(info)\n\t\t}\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onInterrupt: TLEventHandlers['onInterrupt'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate startErasing(info: TLPointerEventInfo) {\n\t\tthis.parent.transition('erasing', info)\n\t}\n\n\tcomplete() {\n\t\tconst erasingShapeIds = this.editor.getErasingShapeIds()\n\n\t\tif (erasingShapeIds.length) {\n\t\t\tthis.editor.mark('erase end')\n\t\t\tthis.editor.deleteShapes(erasingShapeIds)\n\t\t}\n\n\t\tthis.editor.setErasingShapes([])\n\t\tthis.parent.transition('idle')\n\t}\n\n\tcancel() {\n\t\tthis.editor.setErasingShapes([])\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Erasing } from './childStates/Erasing'\nimport { Idle } from './childStates/Idle'\nimport { Pointing } from './childStates/Pointing'\n\n/** @public */\nexport class EraserTool extends StateNode {\n\tstatic override id = 'eraser'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Pointing, Erasing]\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n}\n", "import { CAMERA_SLIDE_FRICTION, StateNode, TLEventHandlers, Vec } from '@tldraw/editor'\n\nexport class Dragging extends StateNode {\n\tstatic override id = 'dragging'\n\n\tinitialCamera = new Vec()\n\n\toverride onEnter = () => {\n\t\tthis.initialCamera = Vec.From(this.editor.getCamera())\n\t\tthis.update()\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tthis.update()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.parent.transition('idle')\n\t}\n\n\toverride onComplete = () => {\n\t\tthis.complete()\n\t}\n\n\tprivate update() {\n\t\tconst { initialCamera, editor } = this\n\t\tconst { currentScreenPoint, originScreenPoint } = editor.inputs\n\n\t\tconst delta = Vec.Sub(currentScreenPoint, originScreenPoint).div(editor.getZoomLevel())\n\t\tif (delta.len2() === 0) return\n\t\teditor.setCamera(initialCamera.clone().add(delta))\n\t}\n\n\tprivate complete() {\n\t\tconst { editor } = this\n\t\tconst { pointerVelocity } = editor.inputs\n\n\t\tconst velocityAtPointerUp = Math.min(pointerVelocity.len(), 2)\n\n\t\tif (velocityAtPointerUp > 0.1) {\n\t\t\tthis.editor.slideCamera({\n\t\t\t\tspeed: velocityAtPointerUp,\n\t\t\t\tdirection: pointerVelocity,\n\t\t\t\tfriction: CAMERA_SLIDE_FRICTION,\n\t\t\t})\n\t\t}\n\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'grab', rotation: 0 })\n\t}\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('pointing', info)\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.editor.setCurrentTool('select')\n\t}\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\toverride onEnter = () => {\n\t\tthis.editor.stopCameraAnimation()\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'grabbing', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t}\n\n\toverride onLongPress: TLEventHandlers['onLongPress'] = () => {\n\t\tthis.startDragging()\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.startDragging()\n\t\t}\n\t}\n\n\tprivate startDragging() {\n\t\tthis.parent.transition('dragging')\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onInterrupt: TLEventHandlers['onInterrupt'] = () => {\n\t\tthis.complete()\n\t}\n\n\tprivate complete() {\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import { EASINGS, StateNode, TLClickEvent } from '@tldraw/editor'\nimport { Dragging } from './childStates/Dragging'\nimport { Idle } from './childStates/Idle'\nimport { Pointing } from './childStates/Pointing'\n\n/** @public */\nexport class HandTool extends StateNode {\n\tstatic override id = 'hand'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Pointing, Dragging]\n\n\toverride onDoubleClick: TLClickEvent = (info) => {\n\t\tif (info.phase === 'settle') {\n\t\t\tconst { currentScreenPoint } = this.editor.inputs\n\t\t\tthis.editor.zoomIn(currentScreenPoint, { duration: 220, easing: EASINGS.easeOutQuint })\n\t\t}\n\t}\n\n\toverride onTripleClick: TLClickEvent = (info) => {\n\t\tif (info.phase === 'settle') {\n\t\t\tconst { currentScreenPoint } = this.editor.inputs\n\t\t\tthis.editor.zoomOut(currentScreenPoint, { duration: 320, easing: EASINGS.easeOutQuint })\n\t\t}\n\t}\n\n\toverride onQuadrupleClick: TLClickEvent = (info) => {\n\t\tif (info.phase === 'settle') {\n\t\t\tconst zoomLevel = this.editor.getZoomLevel()\n\t\t\tconst {\n\t\t\t\tinputs: { currentScreenPoint },\n\t\t\t} = this.editor\n\n\t\t\tif (zoomLevel === 1) {\n\t\t\t\tthis.editor.zoomToFit({ duration: 400, easing: EASINGS.easeOutQuint })\n\t\t\t} else {\n\t\t\t\tthis.editor.resetZoom(currentScreenPoint, { duration: 320, easing: EASINGS.easeOutQuint })\n\t\t\t}\n\t\t}\n\t}\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.parent.transition('lasering', info)\n\t}\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\n\nexport class Lasering extends StateNode {\n\tstatic override id = 'lasering'\n\n\tscribbleId = 'id'\n\n\toverride onEnter = () => {\n\t\tconst scribble = this.editor.scribbles.addScribble({\n\t\t\tcolor: 'laser',\n\t\t\topacity: 0.7,\n\t\t\tsize: 4,\n\t\t\tdelay: 1200,\n\t\t\tshrink: 0.05,\n\t\t\ttaper: true,\n\t\t})\n\t\tthis.scribbleId = scribble.id\n\t\tthis.pushPointToScribble()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.editor.scribbles.stop(this.scribbleId)\n\t}\n\n\toverride onPointerMove = () => {\n\t\tthis.pushPointToScribble()\n\t}\n\n\toverride onPointerUp = () => {\n\t\tthis.complete()\n\t}\n\n\tprivate pushPointToScribble = () => {\n\t\tconst { x, y } = this.editor.inputs.currentPagePoint\n\t\tthis.editor.scribbles.addPoint(this.scribbleId, x, y)\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\tprivate complete() {\n\t\tthis.parent.transition('idle')\n\t}\n\n\tprivate cancel() {\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Idle } from './childStates/Idle'\nimport { Lasering } from './childStates/Lasering'\n\n/** @public */\nexport class LaserTool extends StateNode {\n\tstatic override id = 'laser'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, Lasering]\n\n\toverride onEnter = () => {\n\t\tthis.editor.setCursor({ type: 'cross', rotation: 0 })\n\t}\n}\n", "import {\n\tBox,\n\tMat,\n\tStateNode,\n\tTLCancelEvent,\n\tTLEventHandlers,\n\tTLFrameShape,\n\tTLGroupShape,\n\tTLInterruptEvent,\n\tTLKeyboardEvent,\n\tTLPageId,\n\tTLPointerEventInfo,\n\tTLShape,\n\tTLShapeId,\n\tVec,\n\tmoveCameraWhenCloseToEdge,\n\tpointInPolygon,\n\tpolygonsIntersect,\n} from '@tldraw/editor'\n\nexport class Brushing extends StateNode {\n\tstatic override id = 'brushing'\n\n\tinfo = {} as TLPointerEventInfo & { target: 'canvas' }\n\n\tinitialSelectedShapeIds: TLShapeId[] = []\n\texcludedShapeIds = new Set<TLShapeId>()\n\tisWrapMode = false\n\n\t// The shape that the brush started on\n\tinitialStartShape: TLShape | null = null\n\n\toverride onEnter = (info: TLPointerEventInfo & { target: 'canvas' }) => {\n\t\tconst { altKey, currentPagePoint } = this.editor.inputs\n\n\t\tthis.isWrapMode = this.editor.user.getIsWrapMode()\n\n\t\tif (altKey) {\n\t\t\tthis.parent.transition('scribble_brushing', info)\n\t\t\treturn\n\t\t}\n\n\t\tthis.excludedShapeIds = new Set(\n\t\t\tthis.editor\n\t\t\t\t.getCurrentPageShapes()\n\t\t\t\t.filter(\n\t\t\t\t\t(shape) =>\n\t\t\t\t\t\tthis.editor.isShapeOfType<TLGroupShape>(shape, 'group') ||\n\t\t\t\t\t\tthis.editor.isShapeOrAncestorLocked(shape)\n\t\t\t\t)\n\t\t\t\t.map((shape) => shape.id)\n\t\t)\n\n\t\tthis.info = info\n\t\tthis.initialSelectedShapeIds = this.editor.getSelectedShapeIds().slice()\n\t\tthis.initialStartShape = this.editor.getShapesAtPoint(currentPagePoint)[0]\n\t\tthis.hitTestShapes()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.initialSelectedShapeIds = []\n\t\tthis.editor.updateInstanceState({ brush: null })\n\t}\n\n\toverride onTick = () => {\n\t\tmoveCameraWhenCloseToEdge(this.editor)\n\t}\n\n\toverride onPointerMove = () => {\n\t\tthis.hitTestShapes()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel?: TLCancelEvent | undefined = (info) => {\n\t\tthis.editor.setSelectedShapes(this.initialSelectedShapeIds, { squashing: true })\n\t\tthis.parent.transition('idle', info)\n\t}\n\n\toverride onKeyDown: TLEventHandlers['onKeyDown'] = (info) => {\n\t\tif (this.editor.inputs.altKey) {\n\t\t\tthis.parent.transition('scribble_brushing', info)\n\t\t} else {\n\t\t\tthis.hitTestShapes()\n\t\t}\n\t}\n\n\toverride onKeyUp?: TLKeyboardEvent | undefined = () => {\n\t\tthis.hitTestShapes()\n\t}\n\n\tprivate complete() {\n\t\tthis.hitTestShapes()\n\t\tthis.parent.transition('idle')\n\t}\n\n\tprivate hitTestShapes() {\n\t\tconst { editor, excludedShapeIds, isWrapMode } = this\n\t\tconst {\n\t\t\tinputs: { originPagePoint, currentPagePoint, shiftKey, ctrlKey },\n\t\t} = editor\n\n\t\t// We'll be collecting shape ids of selected shapes; if we're holding shift key, we start from our initial shapes\n\t\tconst results = new Set(shiftKey ? this.initialSelectedShapeIds : [])\n\n\t\t// In wrap mode, we need to completely enclose a shape to select it\n\t\tconst isWrapping = isWrapMode ? !ctrlKey : ctrlKey\n\n\t\t// Set the brush to contain the current and origin points\n\t\tconst brush = Box.FromPoints([originPagePoint, currentPagePoint])\n\n\t\t// We'll be testing the corners of the brush against the shapes\n\t\tconst { corners } = brush\n\n\t\tlet A: Vec,\n\t\t\tB: Vec,\n\t\t\tshape: TLShape,\n\t\t\tpageBounds: Box | undefined,\n\t\t\tpageTransform: Mat | undefined,\n\t\t\tlocalCorners: Vec[]\n\n\t\tconst currentPageShapes = editor.getCurrentPageShapes()\n\t\tconst currentPageId = editor.getCurrentPageId()\n\n\t\ttestAllShapes: for (let i = 0, n = currentPageShapes.length; i < n; i++) {\n\t\t\tshape = currentPageShapes[i]\n\t\t\tif (excludedShapeIds.has(shape.id) || results.has(shape.id)) continue testAllShapes\n\n\t\t\tpageBounds = editor.getShapePageBounds(shape)\n\t\t\tif (!pageBounds) continue testAllShapes\n\n\t\t\t// If the brush fully wraps a shape, it's almost certainly a hit\n\t\t\tif (brush.contains(pageBounds)) {\n\t\t\t\tthis.handleHit(shape, currentPagePoint, currentPageId, results, corners)\n\t\t\t\tcontinue testAllShapes\n\t\t\t}\n\n\t\t\t// If we're in wrap mode and the brush did not fully encloses the shape, it's a miss\n\t\t\t// We also skip frames unless we've completely selected the frame.\n\t\t\tif (isWrapping || editor.isShapeOfType<TLFrameShape>(shape, 'frame')) {\n\t\t\t\tcontinue testAllShapes\n\t\t\t}\n\n\t\t\t// If the brush collides the page bounds, then do hit tests against\n\t\t\t// each of the brush's four sides.\n\t\t\tif (brush.collides(pageBounds)) {\n\t\t\t\t// Shapes expect to hit test line segments in their own coordinate system,\n\t\t\t\t// so we first need to get the brush corners in the shape's local space.\n\t\t\t\tpageTransform = editor.getShapePageTransform(shape)\n\t\t\t\tif (!pageTransform) continue testAllShapes\n\t\t\t\tlocalCorners = pageTransform.clone().invert().applyToPoints(corners)\n\t\t\t\t// See if any of the edges intersect the shape's geometry\n\t\t\t\tconst geometry = editor.getShapeGeometry(shape)\n\t\t\t\thitTestBrushEdges: for (let i = 0; i < 4; i++) {\n\t\t\t\t\tA = localCorners[i]\n\t\t\t\t\tB = localCorners[(i + 1) % 4]\n\t\t\t\t\tif (geometry.hitTestLineSegment(A, B, 0)) {\n\t\t\t\t\t\tthis.handleHit(shape, currentPagePoint, currentPageId, results, corners)\n\t\t\t\t\t\tbreak hitTestBrushEdges\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\teditor.getInstanceState().isCoarsePointer\n\n\t\tconst currentBrush = editor.getInstanceState().brush\n\t\tif (!currentBrush || !brush.equals(currentBrush)) {\n\t\t\teditor.updateInstanceState({ brush: { ...brush.toJson() } })\n\t\t}\n\n\t\tconst current = editor.getSelectedShapeIds()\n\t\tif (current.length !== results.size || current.some((id) => !results.has(id))) {\n\t\t\teditor.setSelectedShapes(Array.from(results), { squashing: true })\n\t\t}\n\t}\n\n\toverride onInterrupt: TLInterruptEvent = () => {\n\t\tthis.editor.updateInstanceState({ brush: null })\n\t}\n\n\tprivate handleHit(\n\t\tshape: TLShape,\n\t\tcurrentPagePoint: Vec,\n\t\tcurrentPageId: TLPageId,\n\t\tresults: Set<TLShapeId>,\n\t\tcorners: Vec[]\n\t) {\n\t\tif (shape.parentId === currentPageId) {\n\t\t\tresults.add(shape.id)\n\t\t\treturn\n\t\t}\n\n\t\t// Find the outermost selectable shape, check to see if it has a\n\t\t// page mask; and if so, check to see if the brush intersects it\n\t\tconst selectedShape = this.editor.getOutermostSelectableShape(shape)\n\t\tconst pageMask = this.editor.getShapeMask(selectedShape.id)\n\t\tif (\n\t\t\tpageMask &&\n\t\t\t!polygonsIntersect(pageMask, corners) &&\n\t\t\t!pointInPolygon(currentPagePoint, pageMask)\n\t\t) {\n\t\t\treturn\n\t\t}\n\t\tresults.add(selectedShape.id)\n\t}\n}\n", "import { Editor, HIT_TEST_MARGIN, TLShape } from '@tldraw/editor'\n\nexport function getHitShapeOnCanvasPointerDown(\n\teditor: Editor,\n\thitLabels = false\n): TLShape | undefined {\n\tconst zoomLevel = editor.getZoomLevel()\n\tconst {\n\t\tinputs: { currentPagePoint },\n\t} = editor\n\n\treturn (\n\t\t// hovered shape at point\n\t\teditor.getShapeAtPoint(currentPagePoint, {\n\t\t\thitInside: false,\n\t\t\thitLabels,\n\t\t\tmargin: HIT_TEST_MARGIN / zoomLevel,\n\t\t\trenderingOnly: true,\n\t\t}) ??\n\t\t// selected shape at point\n\t\teditor.getSelectedShapeAtPoint(currentPagePoint)\n\t)\n}\n", "import {\n\tEditor,\n\tTLBaseShape,\n\tTLImageShapeCrop,\n\tTLShapePartial,\n\tVec,\n\tstructuredClone,\n} from '@tldraw/editor'\n\nexport type ShapeWithCrop = TLBaseShape<string, { w: number; h: number; crop: TLImageShapeCrop }>\n\nexport function getTranslateCroppedImageChange(\n\teditor: Editor,\n\tshape: TLBaseShape<string, { w: number; h: number; crop: TLImageShapeCrop }>,\n\tdelta: Vec\n) {\n\tif (!shape) {\n\t\tthrow Error('Needs to translate a cropped shape!')\n\t}\n\n\tconst { crop: oldCrop } = shape.props\n\tif (!oldCrop) {\n\t\t// can't translate a shape that doesn't have an existing crop\n\t\treturn\n\t}\n\n\tconst flatten: 'x' | 'y' | null = editor.inputs.shiftKey\n\t\t? Math.abs(delta.x) < Math.abs(delta.y)\n\t\t\t? 'x'\n\t\t\t: 'y'\n\t\t: null\n\n\tif (flatten === 'x') {\n\t\tdelta.x = 0\n\t} else if (flatten === 'y') {\n\t\tdelta.y = 0\n\t}\n\n\tdelta.rot(-shape.rotation)\n\n\t// original (uncropped) width and height of shape\n\tconst w = (1 / (oldCrop.bottomRight.x - oldCrop.topLeft.x)) * shape.props.w\n\tconst h = (1 / (oldCrop.bottomRight.y - oldCrop.topLeft.y)) * shape.props.h\n\n\tconst yCrop = oldCrop.bottomRight.y - oldCrop.topLeft.y\n\tconst xCrop = oldCrop.bottomRight.x - oldCrop.topLeft.x\n\tconst newCrop = structuredClone(oldCrop)\n\n\tnewCrop.topLeft.x = Math.min(1 - xCrop, Math.max(0, newCrop.topLeft.x - delta.x / w))\n\tnewCrop.topLeft.y = Math.min(1 - yCrop, Math.max(0, newCrop.topLeft.y - delta.y / h))\n\n\tnewCrop.bottomRight.x = newCrop.topLeft.x + xCrop\n\tnewCrop.bottomRight.y = newCrop.topLeft.y + yCrop\n\n\tconst partial: TLShapePartial<typeof shape> = {\n\t\tid: shape.id,\n\t\ttype: shape.type,\n\t\tprops: {\n\t\t\tcrop: newCrop,\n\t\t},\n\t}\n\n\treturn partial\n}\n", "import { StateNode, TLEventHandlers, TLExitEventHandler, TLGroupShape, Vec } from '@tldraw/editor'\nimport { getHitShapeOnCanvasPointerDown } from '../../../../selection-logic/getHitShapeOnCanvasPointerDown'\nimport { ShapeWithCrop, getTranslateCroppedImageChange } from './crop_helpers'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onEnter = () => {\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\n\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\n\t\t// well this fucking sucks. what the fuck.\n\t\t// it's possible for a user to enter cropping, then undo\n\t\t// (which clears the cropping id) but still remain in this state.\n\t\tthis.editor.on('change-history', this.cleanupCroppingState)\n\n\t\tif (onlySelectedShape) {\n\t\t\tthis.editor.mark('crop')\n\t\t\tthis.editor.setCroppingShape(onlySelectedShape.id)\n\t\t}\n\t}\n\n\toverride onExit: TLExitEventHandler = () => {\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\n\t\tthis.editor.off('change-history', this.cleanupCroppingState)\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.editor.setCroppingShape(null)\n\t\tthis.editor.setCurrentTool('select.idle', {})\n\t}\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tif (this.editor.getIsMenuOpen()) return\n\n\t\tif (info.ctrlKey) {\n\t\t\tthis.cancel()\n\t\t\t// feed the event back into the statechart\n\t\t\tthis.editor.root.handleEvent(info)\n\t\t\treturn\n\t\t}\n\n\t\tswitch (info.target) {\n\t\t\tcase 'canvas': {\n\t\t\t\tconst hitShape = getHitShapeOnCanvasPointerDown(this.editor)\n\t\t\t\tif (hitShape && !this.editor.isShapeOfType<TLGroupShape>(hitShape, 'group')) {\n\t\t\t\t\tthis.onPointerDown({\n\t\t\t\t\t\t...info,\n\t\t\t\t\t\tshape: hitShape,\n\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tthis.cancel()\n\t\t\t\t// feed the event back into the statechart\n\t\t\t\tthis.editor.root.handleEvent(info)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'shape': {\n\t\t\t\tif (info.shape.id === this.editor.getCroppingShapeId()) {\n\t\t\t\t\tthis.editor.setCurrentTool('select.crop.pointing_crop', info)\n\t\t\t\t\treturn\n\t\t\t\t} else {\n\t\t\t\t\tif (this.editor.getShapeUtil(info.shape)?.canCrop(info.shape)) {\n\t\t\t\t\t\tthis.editor.setCroppingShape(info.shape.id)\n\t\t\t\t\t\tthis.editor.setSelectedShapes([info.shape.id])\n\t\t\t\t\t\tthis.editor.setCurrentTool('select.crop.pointing_crop', info)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cancel()\n\t\t\t\t\t\t// feed the event back into the statechart\n\t\t\t\t\t\tthis.editor.root.handleEvent(info)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'selection': {\n\t\t\t\tswitch (info.handle) {\n\t\t\t\t\tcase 'mobile_rotate':\n\t\t\t\t\tcase 'top_left_rotate':\n\t\t\t\t\tcase 'top_right_rotate':\n\t\t\t\t\tcase 'bottom_left_rotate':\n\t\t\t\t\tcase 'bottom_right_rotate': {\n\t\t\t\t\t\tthis.editor.setCurrentTool('select.pointing_rotate_handle', {\n\t\t\t\t\t\t\t...info,\n\t\t\t\t\t\t\tonInteractionEnd: 'select.crop',\n\t\t\t\t\t\t})\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'top':\n\t\t\t\t\tcase 'right':\n\t\t\t\t\tcase 'bottom':\n\t\t\t\t\tcase 'left': {\n\t\t\t\t\t\tthis.editor.setCurrentTool('select.pointing_crop_handle', {\n\t\t\t\t\t\t\t...info,\n\t\t\t\t\t\t\tonInteractionEnd: 'select.crop',\n\t\t\t\t\t\t})\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'top_left':\n\t\t\t\t\tcase 'top_right':\n\t\t\t\t\tcase 'bottom_left':\n\t\t\t\t\tcase 'bottom_right': {\n\t\t\t\t\t\tthis.editor.setCurrentTool('select.pointing_crop_handle', {\n\t\t\t\t\t\t\t...info,\n\t\t\t\t\t\t\tonInteractionEnd: 'select.crop',\n\t\t\t\t\t\t})\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\tthis.cancel()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onDoubleClick: TLEventHandlers['onDoubleClick'] = (info) => {\n\t\t// Without this, the double click's \"settle\" would trigger the reset\n\t\t// after the user double clicked the edge to begin cropping\n\t\tif (this.editor.inputs.shiftKey || info.phase !== 'up') return\n\n\t\tconst croppingShapeId = this.editor.getCroppingShapeId()\n\t\tif (!croppingShapeId) return\n\t\tconst shape = this.editor.getShape(croppingShapeId)\n\t\tif (!shape) return\n\n\t\tconst util = this.editor.getShapeUtil(shape)\n\t\tif (!util) return\n\n\t\tif (info.target === 'selection') {\n\t\t\tutil.onDoubleClickEdge?.(shape)\n\t\t}\n\t}\n\n\toverride onKeyDown: TLEventHandlers['onKeyDown'] = () => {\n\t\tthis.nudgeCroppingImage(false)\n\t}\n\n\toverride onKeyRepeat: TLEventHandlers['onKeyRepeat'] = () => {\n\t\tthis.nudgeCroppingImage(true)\n\t}\n\n\toverride onKeyUp: TLEventHandlers['onKeyUp'] = (info) => {\n\t\tswitch (info.code) {\n\t\t\tcase 'Enter': {\n\t\t\t\tthis.editor.setCroppingShape(null)\n\t\t\t\tthis.editor.setCurrentTool('select.idle', {})\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate cancel() {\n\t\tthis.editor.setCroppingShape(null)\n\t\tthis.editor.setCurrentTool('select.idle', {})\n\t}\n\n\tprivate cleanupCroppingState = () => {\n\t\tif (!this.editor.getCroppingShapeId()) {\n\t\t\tthis.editor.setCurrentTool('select.idle', {})\n\t\t}\n\t}\n\n\tprivate nudgeCroppingImage(ephemeral = false) {\n\t\tconst {\n\t\t\teditor: {\n\t\t\t\tinputs: { keys },\n\t\t\t},\n\t\t} = this\n\n\t\t// We want to use the \"actual\" shift key state,\n\t\t// not the one that's in the editor.inputs.shiftKey,\n\t\t// because that one uses a short timeout on release\n\t\tconst shiftKey = keys.has('ShiftLeft')\n\n\t\tconst delta = new Vec(0, 0)\n\n\t\tif (keys.has('ArrowLeft')) delta.x += 1\n\t\tif (keys.has('ArrowRight')) delta.x -= 1\n\t\tif (keys.has('ArrowUp')) delta.y += 1\n\t\tif (keys.has('ArrowDown')) delta.y -= 1\n\n\t\tif (delta.equals(new Vec(0, 0))) return\n\n\t\tif (shiftKey) delta.mul(10)\n\n\t\tconst shape = this.editor.getShape(this.editor.getCroppingShapeId()!) as ShapeWithCrop\n\t\tif (!shape) return\n\t\tconst partial = getTranslateCroppedImageChange(this.editor, shape, delta)\n\n\t\tif (partial) {\n\t\t\tif (!ephemeral) {\n\t\t\t\t// We don't want to create new marks if the user\n\t\t\t\t// is just holding down the arrow keys\n\t\t\t\tthis.editor.mark('translate crop')\n\t\t\t}\n\n\t\t\tthis.editor.updateShapes<ShapeWithCrop>([partial])\n\t\t}\n\t}\n}\n", "import { StateNode, TLEventHandlers, TLPointerEvent } from '@tldraw/editor'\n\nexport class PointingCrop extends StateNode {\n\tstatic override id = 'pointing_crop'\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.editor.setCurrentTool('select.crop.idle', {})\n\t}\n\n\toverride onPointerMove: TLPointerEvent = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.editor.setCurrentTool('select.crop.translating_crop', info)\n\t\t}\n\t}\n\n\toverride onPointerUp: TLPointerEvent = (info) => {\n\t\tthis.editor.setCurrentTool('select.crop.idle', info)\n\t}\n}\n", "import { StateNode, TLEventHandlers, TLPointerEventInfo } from '@tldraw/editor'\nimport { ShapeWithCrop, getTranslateCroppedImageChange } from './crop_helpers'\n\ntype Snapshot = ReturnType<TranslatingCrop['createSnapshot']>\n\nexport class TranslatingCrop extends StateNode {\n\tstatic override id = 'translating_crop'\n\n\tinfo = {} as TLPointerEventInfo & {\n\t\ttarget: 'shape'\n\t\tisCreating?: boolean\n\t\tonInteractionEnd?: string\n\t}\n\n\tmarkId = 'translating crop'\n\n\tprivate snapshot = {} as any as Snapshot\n\n\toverride onEnter = (\n\t\tinfo: TLPointerEventInfo & {\n\t\t\ttarget: 'shape'\n\t\t\tisCreating?: boolean\n\t\t\tonInteractionEnd?: string\n\t\t}\n\t) => {\n\t\tthis.info = info\n\t\tthis.snapshot = this.createSnapshot()\n\n\t\tthis.editor.mark(this.markId)\n\t\tthis.editor.setCursor({ type: 'move', rotation: 0 })\n\t\tthis.updateShapes()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t}\n\n\toverride onPointerMove = () => {\n\t\tthis.updateShapes()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onKeyDown: TLEventHandlers['onKeyDown'] = (info) => {\n\t\tswitch (info.key) {\n\t\t\tcase 'Alt':\n\t\t\tcase 'Shift': {\n\t\t\t\tthis.updateShapes()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onKeyUp: TLEventHandlers['onKeyUp'] = (info) => {\n\t\tswitch (info.key) {\n\t\t\tcase 'Enter': {\n\t\t\t\tthis.complete()\n\t\t\t\treturn\n\t\t\t}\n\t\t\tcase 'Alt':\n\t\t\tcase 'Shift': {\n\t\t\t\tthis.updateShapes()\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected complete() {\n\t\tthis.updateShapes()\n\t\tthis.editor.setCurrentTool('select.crop.idle', this.info)\n\t}\n\n\tprivate cancel() {\n\t\tthis.editor.bailToMark(this.markId)\n\t\tthis.editor.setCurrentTool('select.crop.idle', this.info)\n\t}\n\n\tprivate createSnapshot() {\n\t\tconst shape = this.editor.getOnlySelectedShape() as ShapeWithCrop\n\t\treturn { shape }\n\t}\n\n\tprotected updateShapes() {\n\t\tconst shape = this.snapshot.shape as ShapeWithCrop\n\n\t\tif (!shape) return\n\n\t\tconst { originPagePoint, currentPagePoint } = this.editor.inputs\n\t\tconst delta = currentPagePoint.clone().sub(originPagePoint)\n\t\tconst partial = getTranslateCroppedImageChange(this.editor, shape, delta)\n\n\t\tif (partial) {\n\t\t\tthis.editor.updateShapes([partial], { squashing: true })\n\t\t}\n\t}\n}\n", "import { StateNode } from '@tldraw/editor'\nimport { Idle } from './children/Idle'\nimport { PointingCrop } from './children/PointingCrop'\nimport { TranslatingCrop } from './children/TranslatingCrop'\n\nexport class Crop extends StateNode {\n\tstatic override id = 'crop'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, TranslatingCrop, PointingCrop]\n}\n", "/** @internal */\nexport const MIN_CROP_SIZE = 8\n", "import {\n\tStateNode,\n\tTLCursorType,\n\tTLEventHandlers,\n\tTLPointerEventInfo,\n\tTLSelectionHandle,\n} from '@tldraw/editor'\n\nexport const CursorTypeMap: Record<TLSelectionHandle, TLCursorType> = {\n\tbottom: 'ns-resize',\n\ttop: 'ns-resize',\n\tleft: 'ew-resize',\n\tright: 'ew-resize',\n\tbottom_left: 'nesw-resize',\n\tbottom_right: 'nwse-resize',\n\ttop_left: 'nwse-resize',\n\ttop_right: 'nesw-resize',\n\tbottom_left_rotate: 'swne-rotate',\n\tbottom_right_rotate: 'senw-rotate',\n\ttop_left_rotate: 'nwse-rotate',\n\ttop_right_rotate: 'nesw-rotate',\n\tmobile_rotate: 'grabbing',\n}\n\ntype PointingResizeHandleInfo = Extract<TLPointerEventInfo, { target: 'selection' }> & {\n\tonInteractionEnd?: string\n}\n\nexport class PointingResizeHandle extends StateNode {\n\tstatic override id = 'pointing_resize_handle'\n\n\tprivate info = {} as PointingResizeHandleInfo\n\n\tprivate updateCursor() {\n\t\tconst selected = this.editor.getSelectedShapes()\n\t\tconst cursorType = CursorTypeMap[this.info.handle!]\n\t\tthis.editor.updateInstanceState({\n\t\t\tcursor: {\n\t\t\t\ttype: cursorType,\n\t\t\t\trotation: selected.length === 1 ? this.editor.getSelectionRotation() : 0,\n\t\t\t},\n\t\t})\n\t}\n\n\toverride onEnter = (info: PointingResizeHandleInfo) => {\n\t\tthis.info = info\n\t\tthis.updateCursor()\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.startResizing()\n\t\t}\n\t}\n\n\toverride onLongPress: TLEventHandlers['onLongPress'] = () => {\n\t\tthis.startResizing()\n\t}\n\n\tprivate startResizing() {\n\t\tif (this.editor.getInstanceState().isReadonly) return\n\t\tthis.parent.transition('resizing', this.info)\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\t// override onPinchStart: TLEventHandlers['onPinchStart'] = (info) => {\n\t// \tthis.parent.transition('pinching', info)\n\t// }\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate complete() {\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, {})\n\t\t} else {\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n\n\tprivate cancel() {\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, {})\n\t\t} else {\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n}\n", "import {\n\tSelectionHandle,\n\tStateNode,\n\tTLBaseShape,\n\tTLEnterEventHandler,\n\tTLEventHandlers,\n\tTLImageShape,\n\tTLImageShapeCrop,\n\tTLPointerEventInfo,\n\tTLShapePartial,\n\tVec,\n\tstructuredClone,\n} from '@tldraw/editor'\nimport { kickoutOccludedShapes } from '../selectHelpers'\nimport { MIN_CROP_SIZE } from './Crop/crop-constants'\nimport { CursorTypeMap } from './PointingResizeHandle'\n\ntype Snapshot = ReturnType<Cropping['createSnapshot']>\n\nexport class Cropping extends StateNode {\n\tstatic override id = 'cropping'\n\n\tinfo = {} as TLPointerEventInfo & {\n\t\ttarget: 'selection'\n\t\thandle: SelectionHandle\n\t\tonInteractionEnd?: string\n\t}\n\n\tmarkId = ''\n\n\tprivate snapshot = {} as any as Snapshot\n\n\toverride onEnter: TLEnterEventHandler = (\n\t\tinfo: TLPointerEventInfo & {\n\t\t\ttarget: 'selection'\n\t\t\thandle: SelectionHandle\n\t\t\tonInteractionEnd?: string\n\t\t}\n\t) => {\n\t\tthis.info = info\n\t\tthis.markId = 'cropping'\n\t\tthis.editor.mark(this.markId)\n\t\tthis.snapshot = this.createSnapshot()\n\t\tthis.updateShapes()\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tthis.updateShapes()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate updateCursor() {\n\t\tconst selectedShape = this.editor.getSelectedShapes()[0]\n\t\tif (!selectedShape) return\n\n\t\tconst cursorType = CursorTypeMap[this.info.handle!]\n\t\tthis.editor.updateInstanceState({\n\t\t\tcursor: {\n\t\t\t\ttype: cursorType,\n\t\t\t\trotation: this.editor.getSelectionRotation(),\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate getDefaultCrop = (): TLImageShapeCrop => ({\n\t\ttopLeft: { x: 0, y: 0 },\n\t\tbottomRight: { x: 1, y: 1 },\n\t})\n\n\tprivate updateShapes() {\n\t\tconst { shape, cursorHandleOffset } = this.snapshot\n\n\t\tif (!shape) return\n\t\tconst util = this.editor.getShapeUtil<TLImageShape>('image')\n\t\tif (!util) return\n\n\t\tconst props = shape.props\n\n\t\tconst currentPagePoint = this.editor.inputs.currentPagePoint.clone().sub(cursorHandleOffset)\n\t\tconst originPagePoint = this.editor.inputs.originPagePoint.clone().sub(cursorHandleOffset)\n\n\t\tconst change = currentPagePoint.clone().sub(originPagePoint).rot(-shape.rotation)\n\n\t\tconst crop = props.crop ?? this.getDefaultCrop()\n\t\tconst newCrop = structuredClone(crop)\n\n\t\tconst newPoint = new Vec(shape.x, shape.y)\n\t\tconst pointDelta = new Vec(0, 0)\n\n\t\t// original (uncropped) width and height of shape\n\t\tconst w = (1 / (crop.bottomRight.x - crop.topLeft.x)) * props.w\n\t\tconst h = (1 / (crop.bottomRight.y - crop.topLeft.y)) * props.h\n\n\t\tlet hasCropChanged = false\n\n\t\t// Set y dimension\n\t\tswitch (this.info.handle) {\n\t\t\tcase 'top':\n\t\t\tcase 'top_left':\n\t\t\tcase 'top_right': {\n\t\t\t\tif (h < MIN_CROP_SIZE) break\n\t\t\t\thasCropChanged = true\n\t\t\t\t// top\n\t\t\t\tnewCrop.topLeft.y = newCrop.topLeft.y + change.y / h\n\t\t\t\tconst heightAfterCrop = h * (newCrop.bottomRight.y - newCrop.topLeft.y)\n\n\t\t\t\tif (heightAfterCrop < MIN_CROP_SIZE) {\n\t\t\t\t\tnewCrop.topLeft.y = newCrop.bottomRight.y - MIN_CROP_SIZE / h\n\t\t\t\t\tpointDelta.y = (newCrop.topLeft.y - crop.topLeft.y) * h\n\t\t\t\t} else {\n\t\t\t\t\tif (newCrop.topLeft.y <= 0) {\n\t\t\t\t\t\tnewCrop.topLeft.y = 0\n\t\t\t\t\t\tpointDelta.y = (newCrop.topLeft.y - crop.topLeft.y) * h\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpointDelta.y = change.y\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'bottom':\n\t\t\tcase 'bottom_left':\n\t\t\tcase 'bottom_right': {\n\t\t\t\tif (h < MIN_CROP_SIZE) break\n\t\t\t\thasCropChanged = true\n\t\t\t\t// bottom\n\t\t\t\tnewCrop.bottomRight.y = Math.min(1, newCrop.bottomRight.y + change.y / h)\n\t\t\t\tconst heightAfterCrop = h * (newCrop.bottomRight.y - newCrop.topLeft.y)\n\n\t\t\t\tif (heightAfterCrop < MIN_CROP_SIZE) {\n\t\t\t\t\tnewCrop.bottomRight.y = newCrop.topLeft.y + MIN_CROP_SIZE / h\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\t// Set x dimension\n\t\tswitch (this.info.handle) {\n\t\t\tcase 'left':\n\t\t\tcase 'top_left':\n\t\t\tcase 'bottom_left': {\n\t\t\t\tif (w < MIN_CROP_SIZE) break\n\t\t\t\thasCropChanged = true\n\t\t\t\t// left\n\t\t\t\tnewCrop.topLeft.x = newCrop.topLeft.x + change.x / w\n\t\t\t\tconst widthAfterCrop = w * (newCrop.bottomRight.x - newCrop.topLeft.x)\n\n\t\t\t\tif (widthAfterCrop < MIN_CROP_SIZE) {\n\t\t\t\t\tnewCrop.topLeft.x = newCrop.bottomRight.x - MIN_CROP_SIZE / w\n\t\t\t\t\tpointDelta.x = (newCrop.topLeft.x - crop.topLeft.x) * w\n\t\t\t\t} else {\n\t\t\t\t\tif (newCrop.topLeft.x <= 0) {\n\t\t\t\t\t\tnewCrop.topLeft.x = 0\n\t\t\t\t\t\tpointDelta.x = (newCrop.topLeft.x - crop.topLeft.x) * w\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpointDelta.x = change.x\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'right':\n\t\t\tcase 'top_right':\n\t\t\tcase 'bottom_right': {\n\t\t\t\tif (w < MIN_CROP_SIZE) break\n\t\t\t\thasCropChanged = true\n\t\t\t\t// right\n\t\t\t\tnewCrop.bottomRight.x = Math.min(1, newCrop.bottomRight.x + change.x / w)\n\t\t\t\tconst widthAfterCrop = w * (newCrop.bottomRight.x - newCrop.topLeft.x)\n\n\t\t\t\tif (widthAfterCrop < MIN_CROP_SIZE) {\n\t\t\t\t\tnewCrop.bottomRight.x = newCrop.topLeft.x + MIN_CROP_SIZE / w\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif (!hasCropChanged) return\n\n\t\tnewPoint.add(pointDelta.rot(shape.rotation))\n\n\t\tconst partial: TLShapePartial<\n\t\t\tTLBaseShape<string, { w: number; h: number; crop: TLImageShapeCrop }>\n\t\t> = {\n\t\t\tid: shape.id,\n\t\t\ttype: shape.type,\n\t\t\tx: newPoint.x,\n\t\t\ty: newPoint.y,\n\t\t\tprops: {\n\t\t\t\tcrop: newCrop,\n\t\t\t\tw: (newCrop.bottomRight.x - newCrop.topLeft.x) * w,\n\t\t\t\th: (newCrop.bottomRight.y - newCrop.topLeft.y) * h,\n\t\t\t},\n\t\t}\n\n\t\tthis.editor.updateShapes([partial], { squashing: true })\n\t\tthis.updateCursor()\n\t}\n\n\tprivate complete() {\n\t\tthis.updateShapes()\n\t\tkickoutOccludedShapes(this.editor, [this.snapshot.shape.id])\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, this.info)\n\t\t} else {\n\t\t\tthis.editor.setCroppingShape(null)\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n\n\tprivate cancel() {\n\t\tthis.editor.bailToMark(this.markId)\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, this.info)\n\t\t} else {\n\t\t\tthis.editor.setCroppingShape(null)\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n\n\tprivate createSnapshot() {\n\t\tconst selectionRotation = this.editor.getSelectionRotation()\n\t\tconst {\n\t\t\tinputs: { originPagePoint },\n\t\t} = this.editor\n\n\t\tconst shape = this.editor.getOnlySelectedShape() as TLImageShape\n\n\t\tconst selectionBounds = this.editor.getSelectionRotatedPageBounds()!\n\n\t\tconst dragHandlePoint = Vec.RotWith(\n\t\t\tselectionBounds.getHandlePoint(this.info.handle!),\n\t\t\tselectionBounds.point,\n\t\t\tselectionRotation\n\t\t)\n\n\t\tconst cursorHandleOffset = Vec.Sub(originPagePoint, dragHandlePoint)\n\n\t\treturn {\n\t\t\tshape,\n\t\t\tcursorHandleOffset,\n\t\t}\n\t}\n}\n", "import {\n\tStateNode,\n\tTLArrowShape,\n\tTLArrowShapeTerminal,\n\tTLCancelEvent,\n\tTLEnterEventHandler,\n\tTLEventHandlers,\n\tTLHandle,\n\tTLKeyboardEvent,\n\tTLLineShape,\n\tTLPointerEventInfo,\n\tTLShapeId,\n\tTLShapePartial,\n\tVec,\n\tsnapAngle,\n\tsortByIndex,\n\tstructuredClone,\n} from '@tldraw/editor'\nimport { kickoutOccludedShapes } from '../selectHelpers'\n\nexport class DraggingHandle extends StateNode {\n\tstatic override id = 'dragging_handle'\n\n\tshapeId = '' as TLShapeId\n\tinitialHandle = {} as TLHandle\n\tinitialAdjacentHandle = null as TLHandle | null\n\tinitialPagePoint = {} as Vec\n\n\tmarkId = ''\n\tinitialPageTransform: any\n\tinitialPageRotation: any\n\n\tinfo = {} as TLPointerEventInfo & {\n\t\tshape: TLArrowShape | TLLineShape\n\t\ttarget: 'handle'\n\t\tonInteractionEnd?: string\n\t\tisCreating: boolean\n\t}\n\n\tisPrecise = false\n\tisPreciseId = null as TLShapeId | null\n\tpointingId = null as TLShapeId | null\n\n\toverride onEnter: TLEnterEventHandler = (\n\t\tinfo: TLPointerEventInfo & {\n\t\t\tshape: TLArrowShape | TLLineShape\n\t\t\ttarget: 'handle'\n\t\t\tonInteractionEnd?: string\n\t\t\tisCreating: boolean\n\t\t}\n\t) => {\n\t\tconst { shape, isCreating, handle } = info\n\t\tthis.info = info\n\t\tthis.parent.setCurrentToolIdMask(info.onInteractionEnd)\n\t\tthis.shapeId = shape.id\n\t\tthis.markId = isCreating ? `creating:${shape.id}` : 'dragging handle'\n\t\tif (!isCreating) this.editor.mark(this.markId)\n\n\t\tthis.initialHandle = structuredClone(handle)\n\n\t\tif (this.editor.isShapeOfType<TLLineShape>(shape, 'line')) {\n\t\t\t// For line shapes, if we're dragging a \"create\" handle, then\n\t\t\t// create a new vertex handle at that point; and make this handle\n\t\t\t// the handle that we're dragging.\n\t\t\tif (this.initialHandle.type === 'create') {\n\t\t\t\tthis.editor.updateShape({\n\t\t\t\t\t...shape,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tpoints: {\n\t\t\t\t\t\t\t...shape.props.points,\n\t\t\t\t\t\t\t[handle.index]: { id: handle.index, index: handle.index, x: handle.x, y: handle.y },\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tconst handlesAfter = this.editor.getShapeHandles(shape)!\n\t\t\t\tconst handleAfter = handlesAfter.find((h) => h.index === handle.index)!\n\t\t\t\tthis.initialHandle = structuredClone(handleAfter)\n\t\t\t}\n\t\t}\n\n\t\tthis.initialPageTransform = this.editor.getShapePageTransform(shape)!\n\t\tthis.initialPageRotation = this.initialPageTransform.rotation()\n\t\tthis.initialPagePoint = this.editor.inputs.originPagePoint.clone()\n\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: isCreating ? 'cross' : 'grabbing', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\n\t\tconst handles = this.editor.getShapeHandles(shape)!.sort(sortByIndex)\n\t\tconst index = handles.findIndex((h) => h.id === info.handle.id)\n\n\t\t// Find the adjacent handle\n\t\tthis.initialAdjacentHandle = null\n\n\t\t// Start from the handle and work forward\n\t\tfor (let i = index + 1; i < handles.length; i++) {\n\t\t\tconst handle = handles[i]\n\t\t\tif (handle.type === 'vertex' && handle.id !== 'middle' && handle.id !== info.handle.id) {\n\t\t\t\tthis.initialAdjacentHandle = handle\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\t// If still no handle, start from the end and work backward\n\t\tif (!this.initialAdjacentHandle) {\n\t\t\tfor (let i = handles.length - 1; i >= 0; i--) {\n\t\t\t\tconst handle = handles[i]\n\t\t\t\tif (handle.type === 'vertex' && handle.id !== 'middle' && handle.id !== info.handle.id) {\n\t\t\t\t\tthis.initialAdjacentHandle = handle\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// <!-- Only relevant to arrows\n\t\tif (this.editor.isShapeOfType<TLArrowShape>(shape, 'arrow')) {\n\t\t\tconst initialTerminal = shape.props[info.handle.id as 'start' | 'end']\n\n\t\t\tthis.isPrecise = false\n\n\t\t\tif (initialTerminal?.type === 'binding') {\n\t\t\t\tthis.editor.setHintingShapes([initialTerminal.boundShapeId])\n\n\t\t\t\tthis.isPrecise = initialTerminal.isPrecise\n\t\t\t\tif (this.isPrecise) {\n\t\t\t\t\tthis.isPreciseId = initialTerminal.boundShapeId\n\t\t\t\t} else {\n\t\t\t\t\tthis.resetExactTimeout()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.editor.setHintingShapes([])\n\t\t\t}\n\t\t}\n\t\t// -->\n\n\t\tthis.update()\n\n\t\tthis.editor.select(this.shapeId)\n\t}\n\n\t// Only relevant to arrows\n\tprivate exactTimeout = -1 as any\n\n\t// Only relevant to arrows\n\tprivate resetExactTimeout() {\n\t\tif (this.exactTimeout !== -1) {\n\t\t\tthis.clearExactTimeout()\n\t\t}\n\n\t\tthis.exactTimeout = setTimeout(() => {\n\t\t\tif (this.getIsActive() && !this.isPrecise) {\n\t\t\t\tthis.isPrecise = true\n\t\t\t\tthis.isPreciseId = this.pointingId\n\t\t\t\tthis.update()\n\t\t\t}\n\t\t\tthis.exactTimeout = -1\n\t\t}, 750)\n\t}\n\n\t// Only relevant to arrows\n\tprivate clearExactTimeout() {\n\t\tif (this.exactTimeout !== -1) {\n\t\t\tclearTimeout(this.exactTimeout)\n\t\t\tthis.exactTimeout = -1\n\t\t}\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tthis.update()\n\t}\n\n\toverride onKeyDown: TLKeyboardEvent | undefined = () => {\n\t\tthis.update()\n\t}\n\n\toverride onKeyUp: TLKeyboardEvent | undefined = () => {\n\t\tthis.update()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.update()\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLCancelEvent = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\t\tthis.editor.setHintingShapes([])\n\t\tthis.editor.snaps.clearIndicators()\n\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t}\n\n\tprivate complete() {\n\t\tthis.editor.snaps.clearIndicators()\n\t\tkickoutOccludedShapes(this.editor, [this.shapeId])\n\n\t\tconst { onInteractionEnd } = this.info\n\t\tif (this.editor.getInstanceState().isToolLocked && onInteractionEnd) {\n\t\t\t// Return to the tool that was active before this one,\n\t\t\t// but only if tool lock is turned on!\n\t\t\tthis.editor.setCurrentTool(onInteractionEnd, { shapeId: this.shapeId })\n\t\t\treturn\n\t\t}\n\n\t\tthis.parent.transition('idle')\n\t}\n\n\tprivate cancel() {\n\t\tthis.editor.bailToMark(this.markId)\n\t\tthis.editor.snaps.clearIndicators()\n\n\t\tconst { onInteractionEnd } = this.info\n\t\tif (onInteractionEnd) {\n\t\t\t// Return to the tool that was active before this one,\n\t\t\t// whether tool lock is turned on or not!\n\t\t\tthis.editor.setCurrentTool(onInteractionEnd, { shapeId: this.shapeId })\n\t\t\treturn\n\t\t}\n\n\t\tthis.parent.transition('idle')\n\t}\n\n\tprivate update() {\n\t\tconst { editor, shapeId, initialPagePoint } = this\n\t\tconst { initialHandle, initialPageRotation, initialAdjacentHandle } = this\n\t\tconst hintingShapeIds = this.editor.getHintingShapeIds()\n\t\tconst isSnapMode = this.editor.user.getIsSnapMode()\n\t\tconst {\n\t\t\tsnaps,\n\t\t\tinputs: { currentPagePoint, shiftKey, ctrlKey, altKey, pointerVelocity },\n\t\t} = editor\n\n\t\tconst initial = this.info.shape\n\n\t\tconst shape = editor.getShape(shapeId)\n\t\tif (!shape) return\n\t\tconst util = editor.getShapeUtil(shape)\n\n\t\tlet point = currentPagePoint\n\t\t\t.clone()\n\t\t\t.sub(initialPagePoint)\n\t\t\t.rot(-initialPageRotation)\n\t\t\t.add(initialHandle)\n\n\t\tif (shiftKey && initialAdjacentHandle && initialHandle.id !== 'middle') {\n\t\t\tconst angle = Vec.Angle(initialAdjacentHandle, point)\n\t\t\tconst snappedAngle = snapAngle(angle, 24)\n\t\t\tconst angleDifference = snappedAngle - angle\n\t\t\tpoint = Vec.RotWith(point, initialAdjacentHandle, angleDifference)\n\t\t}\n\n\t\t// Clear any existing snaps\n\t\teditor.snaps.clearIndicators()\n\n\t\tlet nextHandle = { ...initialHandle, x: point.x, y: point.y }\n\n\t\tif (initialHandle.canSnap && (isSnapMode ? !ctrlKey : ctrlKey)) {\n\t\t\t// We're snapping\n\t\t\tconst pageTransform = editor.getShapePageTransform(shape.id)\n\t\t\tif (!pageTransform) throw Error('Expected a page transform')\n\n\t\t\tconst snap = snaps.handles.snapHandle({ currentShapeId: shapeId, handle: nextHandle })\n\n\t\t\tif (snap) {\n\t\t\t\tsnap.nudge.rot(-editor.getShapeParentTransform(shape)!.rotation())\n\t\t\t\tpoint.add(snap.nudge)\n\t\t\t\tnextHandle = { ...initialHandle, x: point.x, y: point.y }\n\t\t\t}\n\t\t}\n\n\t\tconst changes = util.onHandleDrag?.(shape, {\n\t\t\thandle: nextHandle,\n\t\t\tisPrecise: this.isPrecise || altKey,\n\t\t\tinitial: initial,\n\t\t})\n\n\t\tconst next: TLShapePartial<any> = { ...shape, ...changes }\n\n\t\t// Arrows\n\t\tif (initialHandle.canBind) {\n\t\t\tconst bindingAfter = (next.props as any)[initialHandle.id] as TLArrowShapeTerminal | undefined\n\n\t\t\tif (bindingAfter?.type === 'binding') {\n\t\t\t\tif (hintingShapeIds[0] !== bindingAfter.boundShapeId) {\n\t\t\t\t\teditor.setHintingShapes([bindingAfter.boundShapeId])\n\t\t\t\t\tthis.pointingId = bindingAfter.boundShapeId\n\t\t\t\t\tthis.isPrecise = pointerVelocity.len() < 0.5 || altKey\n\t\t\t\t\tthis.isPreciseId = this.isPrecise ? bindingAfter.boundShapeId : null\n\t\t\t\t\tthis.resetExactTimeout()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (hintingShapeIds.length > 0) {\n\t\t\t\t\teditor.setHintingShapes([])\n\t\t\t\t\tthis.pointingId = null\n\t\t\t\t\tthis.isPrecise = false\n\t\t\t\t\tthis.isPreciseId = null\n\t\t\t\t\tthis.resetExactTimeout()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (changes) {\n\t\t\teditor.updateShapes([next], { squashing: true })\n\t\t}\n\t}\n}\n", "import { Geometry2d, Group2d } from '@tldraw/editor'\n\n/**\n * Return all the text labels in a geometry.\n *\n * @param geometry - The geometry to get the text labels from.\n *\n * @public\n */\nexport function getTextLabels(geometry: Geometry2d) {\n\tif (geometry.isLabel) {\n\t\treturn [geometry]\n\t}\n\n\tif (geometry instanceof Group2d) {\n\t\treturn geometry.children.filter((child) => child.isLabel)\n\t}\n\n\treturn []\n}\n", "import { StateNode, TLEventHandlers, TLFrameShape, TLShape, TLTextShape } from '@tldraw/editor'\nimport { getTextLabels } from '../../../utils/shapes/shapes'\nimport { getHitShapeOnCanvasPointerDown } from '../../selection-logic/getHitShapeOnCanvasPointerDown'\nimport { updateHoveredId } from '../../selection-logic/updateHoveredId'\n\nexport class EditingShape extends StateNode {\n\tstatic override id = 'editing_shape'\n\n\thitShapeForPointerUp: TLShape | null = null\n\n\toverride onEnter = () => {\n\t\tconst editingShape = this.editor.getEditingShape()\n\t\tif (!editingShape) throw Error('Entered editing state without an editing shape')\n\t\tthis.hitShapeForPointerUp = null\n\t\tupdateHoveredId(this.editor)\n\t\tthis.editor.select(editingShape)\n\t}\n\n\toverride onExit = () => {\n\t\tconst { editingShapeId } = this.editor.getCurrentPageState()\n\t\tif (!editingShapeId) return\n\n\t\t// Clear the editing shape\n\t\tthis.editor.setEditingShape(null)\n\n\t\tconst shape = this.editor.getShape(editingShapeId)!\n\t\tconst util = this.editor.getShapeUtil(shape)\n\n\t\t// Check for changes on editing end\n\t\tutil.onEditEnd?.(shape)\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\t// In the case where on pointer down we hit a shape's label, we need to check if the user is dragging.\n\t\t// and if they are, we need to transition to translating instead.\n\t\tif (this.hitShapeForPointerUp && this.editor.inputs.isDragging) {\n\t\t\tif (this.editor.getInstanceState().isReadonly) return\n\t\t\tthis.editor.select(this.hitShapeForPointerUp)\n\t\t\tthis.parent.transition('translating', info)\n\t\t\tthis.hitShapeForPointerUp = null\n\t\t\treturn\n\t\t}\n\n\t\tswitch (info.target) {\n\t\t\tcase 'shape':\n\t\t\tcase 'canvas': {\n\t\t\t\tupdateHoveredId(this.editor)\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tthis.hitShapeForPointerUp = null\n\n\t\tswitch (info.target) {\n\t\t\tcase 'canvas': {\n\t\t\t\tconst hitShape = getHitShapeOnCanvasPointerDown(this.editor, true /* hitLabels */)\n\t\t\t\tif (hitShape) {\n\t\t\t\t\tthis.onPointerDown({\n\t\t\t\t\t\t...info,\n\t\t\t\t\t\tshape: hitShape,\n\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'shape': {\n\t\t\t\tconst { shape: selectingShape } = info\n\t\t\t\tconst editingShape = this.editor.getEditingShape()\n\n\t\t\t\tif (!editingShape) {\n\t\t\t\t\tthrow Error('Expected an editing shape!')\n\t\t\t\t}\n\n\t\t\t\t// for shapes with labels, check to see if the click was inside of the shape's label\n\t\t\t\tconst geometry = this.editor.getShapeUtil(selectingShape).getGeometry(selectingShape)\n\t\t\t\tconst textLabels = getTextLabels(geometry)\n\t\t\t\tconst textLabel = textLabels.length === 1 ? textLabels[0] : undefined\n\t\t\t\t// N.B. One nuance here is that we want empty text fields to be removed from the canvas when the user clicks away from them.\n\t\t\t\tconst isEmptyTextShape =\n\t\t\t\t\tthis.editor.isShapeOfType<TLTextShape>(editingShape, 'text') &&\n\t\t\t\t\teditingShape.props.text.trim() === ''\n\t\t\t\tif (textLabel && !isEmptyTextShape) {\n\t\t\t\t\tconst pointInShapeSpace = this.editor.getPointInShapeSpace(\n\t\t\t\t\t\tselectingShape,\n\t\t\t\t\t\tthis.editor.inputs.currentPagePoint\n\t\t\t\t\t)\n\t\t\t\t\tif (\n\t\t\t\t\t\ttextLabel.bounds.containsPoint(pointInShapeSpace, 0) &&\n\t\t\t\t\t\ttextLabel.hitTestPoint(pointInShapeSpace)\n\t\t\t\t\t) {\n\t\t\t\t\t\t// it's a hit to the label!\n\t\t\t\t\t\tif (selectingShape.id === editingShape.id) {\n\t\t\t\t\t\t\t// If we clicked on the editing geo / arrow shape's label, do nothing\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.hitShapeForPointerUp = selectingShape\n\n\t\t\t\t\t\t\tthis.editor.mark('editing on pointer up')\n\t\t\t\t\t\t\tthis.editor.select(selectingShape.id)\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (selectingShape.id === editingShape.id) {\n\t\t\t\t\t\t// If we clicked on a frame, while editing its heading, cancel editing\n\t\t\t\t\t\tif (this.editor.isShapeOfType<TLFrameShape>(selectingShape, 'frame')) {\n\t\t\t\t\t\t\tthis.editor.setEditingShape(null)\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If we clicked on the editing shape (which isn't a shape with a label), do nothing\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// But if we clicked on a different shape of the same type, transition to pointing_shape instead\n\t\t\t\t\t\tthis.parent.transition('pointing_shape', info)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\t// still here? Cancel editing and transition back to select idle\n\t\tthis.parent.transition('idle', info)\n\t\t// then feed the pointer down event back into the state chart as if it happened in that state\n\t\tthis.editor.root.handleEvent(info)\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = (info) => {\n\t\t// If we're not dragging, and it's a hit to the label, begin editing the shape.\n\t\tconst hitShape = this.hitShapeForPointerUp\n\t\tif (!hitShape) return\n\t\tthis.hitShapeForPointerUp = null\n\n\t\t// Stay in edit mode to maintain flow of editing.\n\t\tconst util = this.editor.getShapeUtil(hitShape)\n\t\tif (this.editor.getInstanceState().isReadonly) {\n\t\t\tif (!util.canEditInReadOnly(hitShape)) {\n\t\t\t\tthis.parent.transition('pointing_shape', info)\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tthis.editor.select(hitShape.id)\n\n\t\tthis.editor.setEditingShape(hitShape.id)\n\t\tupdateHoveredId(this.editor)\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = (info) => {\n\t\tthis.parent.transition('idle', info)\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = (info) => {\n\t\tthis.parent.transition('idle', info)\n\t}\n}\n", "import { Editor } from '@tldraw/editor'\n\nexport function getShouldEnterCropMode(editor: Editor): boolean {\n\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\treturn !!(\n\t\tonlySelectedShape &&\n\t\t!editor.isShapeOrAncestorLocked(onlySelectedShape) &&\n\t\teditor.getShapeUtil(onlySelectedShape).canCrop(onlySelectedShape)\n\t)\n}\n", "import { Editor, HIT_TEST_MARGIN, TLShape, isShapeId } from '@tldraw/editor'\n\nexport function selectOnCanvasPointerUp(editor: Editor) {\n\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\tconst { shiftKey, altKey, currentPagePoint } = editor.inputs\n\n\tconst hitShape = editor.getShapeAtPoint(currentPagePoint, {\n\t\thitInside: false,\n\t\tmargin: HIT_TEST_MARGIN / editor.getZoomLevel(),\n\t\thitLabels: true,\n\t\trenderingOnly: true,\n\t\tfilter: (shape) => !shape.isLocked,\n\t})\n\n\t// Note at the start: if we select a shape that is inside of a group,\n\t// the editor will automatically adjust the selection to the outermost\n\t// selectable shape (the group)\n\n\t// If the shape's outermost selected id (e.g. the group that contains\n\t// the shape) is not the same as the editor's only selected shape, then\n\t// we want to select the outermost selected shape instead of the shape\n\n\tif (hitShape) {\n\t\tconst outermostSelectableShape = editor.getOutermostSelectableShape(hitShape)\n\t\t// If the user is holding shift, they're either adding to or removing from\n\t\t// their selection.\n\t\tif (shiftKey && !altKey) {\n\t\t\teditor.cancelDoubleClick() // fuckin eh\n\n\t\t\tif (selectedShapeIds.includes(outermostSelectableShape.id)) {\n\t\t\t\t// Remove it from selected shapes\n\t\t\t\teditor.mark('deselecting shape')\n\t\t\t\teditor.deselect(outermostSelectableShape)\n\t\t\t} else {\n\t\t\t\t// Add it to selected shapes\n\t\t\t\teditor.mark('shift selecting shape')\n\t\t\t\teditor.setSelectedShapes([...selectedShapeIds, outermostSelectableShape.id])\n\t\t\t}\n\t\t} else {\n\t\t\tlet shapeToSelect: TLShape | undefined = undefined\n\n\t\t\tif (outermostSelectableShape === hitShape) {\n\t\t\t\t// There's no group around the shape, so we can select it.\n\t\t\t\tshapeToSelect = hitShape\n\t\t\t} else {\n\t\t\t\t// There's a group around the hit shape.\n\t\t\t\t// If the group is the current focus layer, OR if the group is\n\t\t\t\t// already selected, then we can select the shape inside the group.\n\t\t\t\t// Otherwise, if the group isn't selected and isn't our current\n\t\t\t\t// focus layer, then we need to select the group instead.\n\t\t\t\tif (\n\t\t\t\t\toutermostSelectableShape.id === editor.getFocusedGroupId() ||\n\t\t\t\t\tselectedShapeIds.includes(outermostSelectableShape.id)\n\t\t\t\t) {\n\t\t\t\t\tshapeToSelect = hitShape\n\t\t\t\t} else {\n\t\t\t\t\tshapeToSelect = outermostSelectableShape\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (shapeToSelect && !selectedShapeIds.includes(shapeToSelect.id)) {\n\t\t\t\teditor.mark('selecting shape')\n\t\t\t\teditor.select(shapeToSelect.id)\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// We didn't hit anything...\n\t\tif (shiftKey) {\n\t\t\t// If we were holding shift, then it's a noop. We keep the\n\t\t\t// current selection because we didn't add anything to it\n\t\t\treturn\n\t\t} else {\n\t\t\t// Otherwise, we clear the selction because the user selected\n\t\t\t// nothing instead of their current selection.\n\n\t\t\tif (selectedShapeIds.length > 0) {\n\t\t\t\teditor.mark('selecting none')\n\t\t\t\teditor.selectNone()\n\t\t\t}\n\n\t\t\t// If the click was inside of the current focused group, then\n\t\t\t// we keep that focused group; otherwise we clear the focused\n\t\t\t// group (reset it to the page)\n\t\t\tconst focusedGroupId = editor.getFocusedGroupId()\n\n\t\t\tif (isShapeId(focusedGroupId)) {\n\t\t\t\tconst groupShape = editor.getShape(focusedGroupId)!\n\t\t\t\tif (!editor.isPointInShape(groupShape, currentPagePoint, { margin: 0, hitInside: true })) {\n\t\t\t\t\teditor.setFocusedGroup(null)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n", "import {\n\tEditor,\n\tGroup2d,\n\tHIT_TEST_MARGIN,\n\tStateNode,\n\tTLArrowShape,\n\tTLClickEventInfo,\n\tTLEventHandlers,\n\tTLGroupShape,\n\tTLKeyboardEventInfo,\n\tTLShape,\n\tTLTextShape,\n\tVec,\n\tVecLike,\n\tcreateShapeId,\n\tdebugFlags,\n\tpointInPolygon,\n} from '@tldraw/editor'\nimport { getHitShapeOnCanvasPointerDown } from '../../selection-logic/getHitShapeOnCanvasPointerDown'\nimport { getShouldEnterCropMode } from '../../selection-logic/getShouldEnterCropModeOnPointerDown'\nimport { selectOnCanvasPointerUp } from '../../selection-logic/selectOnCanvasPointerUp'\nimport { updateHoveredId } from '../../selection-logic/updateHoveredId'\nimport { kickoutOccludedShapes, startEditingShapeWithLabel } from '../selectHelpers'\n\nconst SKIPPED_KEYS_FOR_AUTO_EDITING = [\n\t'Delete',\n\t'Backspace',\n\t'[',\n\t']',\n\t'Enter',\n\t' ',\n\t'Shift',\n\t'Tab',\n]\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\toverride onEnter = () => {\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\t\tupdateHoveredId(this.editor)\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tupdateHoveredId(this.editor)\n\t}\n\n\toverride onPointerDown: TLEventHandlers['onPointerDown'] = (info) => {\n\t\tif (this.editor.getIsMenuOpen()) return\n\n\t\tconst shouldEnterCropMode = info.ctrlKey && getShouldEnterCropMode(this.editor)\n\n\t\tif (info.ctrlKey && !shouldEnterCropMode) {\n\t\t\t// On Mac, you can right click using the Control keys + Click.\n\t\t\tif (info.target === 'shape' && this.isDarwin && this.editor.inputs.keys.has('ControlLeft')) {\n\t\t\t\tif (!this.editor.isShapeOrAncestorLocked(info.shape)) {\n\t\t\t\t\tthis.parent.transition('pointing_shape', info)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.parent.transition('brushing', info)\n\t\t\treturn\n\t\t}\n\n\t\tswitch (info.target) {\n\t\t\tcase 'canvas': {\n\t\t\t\t// Check to see if we hit any shape under the pointer; if so,\n\t\t\t\t// handle this as a pointer down on the shape instead of the canvas\n\t\t\t\tconst hitShape = getHitShapeOnCanvasPointerDown(this.editor)\n\t\t\t\tif (hitShape && !hitShape.isLocked) {\n\t\t\t\t\tthis.onPointerDown({\n\t\t\t\t\t\t...info,\n\t\t\t\t\t\tshape: hitShape,\n\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst selectedShapeIds = this.editor.getSelectedShapeIds()\n\t\t\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\t\t\t\tconst {\n\t\t\t\t\tinputs: { currentPagePoint },\n\t\t\t\t} = this.editor\n\n\t\t\t\tif (\n\t\t\t\t\tselectedShapeIds.length > 1 ||\n\t\t\t\t\t(onlySelectedShape &&\n\t\t\t\t\t\t!this.editor.getShapeUtil(onlySelectedShape).hideSelectionBoundsBg(onlySelectedShape))\n\t\t\t\t) {\n\t\t\t\t\tif (isPointInRotatedSelectionBounds(this.editor, currentPagePoint)) {\n\t\t\t\t\t\tthis.onPointerDown({\n\t\t\t\t\t\t\t...info,\n\t\t\t\t\t\t\ttarget: 'selection',\n\t\t\t\t\t\t})\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.parent.transition('pointing_canvas', info)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'shape': {\n\t\t\t\tconst { shape } = info\n\t\t\t\tif (this.isOverArrowLabelTest(shape)) {\n\t\t\t\t\t// We're moving the label on a shape.\n\t\t\t\t\tthis.parent.transition('pointing_arrow_label', info)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tif (this.editor.isShapeOrAncestorLocked(shape)) {\n\t\t\t\t\tthis.parent.transition('pointing_canvas', info)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tthis.parent.transition('pointing_shape', info)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'handle': {\n\t\t\t\tif (this.editor.getInstanceState().isReadonly) break\n\t\t\t\tif (this.editor.inputs.altKey) {\n\t\t\t\t\tthis.parent.transition('pointing_shape', info)\n\t\t\t\t} else {\n\t\t\t\t\tthis.parent.transition('pointing_handle', info)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'selection': {\n\t\t\t\tswitch (info.handle) {\n\t\t\t\t\tcase 'mobile_rotate':\n\t\t\t\t\tcase 'top_left_rotate':\n\t\t\t\t\tcase 'top_right_rotate':\n\t\t\t\t\tcase 'bottom_left_rotate':\n\t\t\t\t\tcase 'bottom_right_rotate': {\n\t\t\t\t\t\tthis.parent.transition('pointing_rotate_handle', info)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'top':\n\t\t\t\t\tcase 'right':\n\t\t\t\t\tcase 'bottom':\n\t\t\t\t\tcase 'left': {\n\t\t\t\t\t\tif (shouldEnterCropMode) {\n\t\t\t\t\t\t\tthis.parent.transition('pointing_crop_handle', info)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.parent.transition('pointing_resize_handle', info)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'top_left':\n\t\t\t\t\tcase 'top_right':\n\t\t\t\t\tcase 'bottom_left':\n\t\t\t\t\tcase 'bottom_right': {\n\t\t\t\t\t\tif (shouldEnterCropMode) {\n\t\t\t\t\t\t\tthis.parent.transition('pointing_crop_handle', info)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.parent.transition('pointing_resize_handle', info)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\tconst hoveredShape = this.editor.getHoveredShape()\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\thoveredShape &&\n\t\t\t\t\t\t\t!this.editor.getSelectedShapeIds().includes(hoveredShape.id) &&\n\t\t\t\t\t\t\t!hoveredShape.isLocked\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis.onPointerDown({\n\t\t\t\t\t\t\t\t...info,\n\t\t\t\t\t\t\t\tshape: hoveredShape,\n\t\t\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.parent.transition('pointing_selection', info)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onDoubleClick: TLEventHandlers['onDoubleClick'] = (info) => {\n\t\tif (this.editor.inputs.shiftKey || info.phase !== 'up') return\n\n\t\tswitch (info.target) {\n\t\t\tcase 'canvas': {\n\t\t\t\tconst hoveredShape = this.editor.getHoveredShape()\n\n\t\t\t\t// todo\n\t\t\t\t// double clicking on the middle of a hollow geo shape without a label, or\n\t\t\t\t// over the label of a hollwo shape that has a label, should start editing\n\t\t\t\t// that shape's label. We can't support \"double click anywhere inside\"\n\t\t\t\t// of the shape yet because that also creates text shapes, and can product\n\t\t\t\t// unexpected results when working \"inside of\" a hollow shape.\n\n\t\t\t\tconst hitShape =\n\t\t\t\t\thoveredShape && !this.editor.isShapeOfType<TLGroupShape>(hoveredShape, 'group')\n\t\t\t\t\t\t? hoveredShape\n\t\t\t\t\t\t: this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint) ??\n\t\t\t\t\t\t\tthis.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint, {\n\t\t\t\t\t\t\t\tmargin: HIT_TEST_MARGIN / this.editor.getZoomLevel(),\n\t\t\t\t\t\t\t\thitInside: false,\n\t\t\t\t\t\t\t})\n\n\t\t\t\tconst focusedGroupId = this.editor.getFocusedGroupId()\n\n\t\t\t\tif (hitShape) {\n\t\t\t\t\tif (this.editor.isShapeOfType<TLGroupShape>(hitShape, 'group')) {\n\t\t\t\t\t\t// Probably select the shape\n\t\t\t\t\t\tselectOnCanvasPointerUp(this.editor)\n\t\t\t\t\t\treturn\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst parent = this.editor.getShape(hitShape.parentId)\n\t\t\t\t\t\tif (parent && this.editor.isShapeOfType<TLGroupShape>(parent, 'group')) {\n\t\t\t\t\t\t\t// The shape is the direct child of a group. If the group is\n\t\t\t\t\t\t\t// selected, then we can select the shape. If the group is the\n\t\t\t\t\t\t\t// focus layer id, then we can double click into it as usual.\n\t\t\t\t\t\t\tif (focusedGroupId && parent.id === focusedGroupId) {\n\t\t\t\t\t\t\t\t// noop, double click on the shape as normal below\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// The shape is the child of some group other than our current\n\t\t\t\t\t\t\t\t// focus layer. We should probably select the group instead.\n\t\t\t\t\t\t\t\tselectOnCanvasPointerUp(this.editor)\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// double click on the shape. We'll start editing the\n\t\t\t\t\t// shape if it's editable or else do a double click on\n\t\t\t\t\t// the canvas.\n\t\t\t\t\tthis.onDoubleClick({\n\t\t\t\t\t\t...info,\n\t\t\t\t\t\tshape: hitShape,\n\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t})\n\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (!this.editor.inputs.shiftKey) {\n\t\t\t\t\tthis.handleDoubleClickOnCanvas(info)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'selection': {\n\t\t\t\tif (this.editor.getInstanceState().isReadonly) break\n\n\t\t\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\n\t\t\t\tif (onlySelectedShape) {\n\t\t\t\t\tconst util = this.editor.getShapeUtil(onlySelectedShape)\n\n\t\t\t\t\tif (!this.canInteractWithShapeInReadOnly(onlySelectedShape)) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\t// Test edges for an onDoubleClickEdge handler\n\t\t\t\t\tif (\n\t\t\t\t\t\tinfo.handle === 'right' ||\n\t\t\t\t\t\tinfo.handle === 'left' ||\n\t\t\t\t\t\tinfo.handle === 'top' ||\n\t\t\t\t\t\tinfo.handle === 'bottom'\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst change = util.onDoubleClickEdge?.(onlySelectedShape)\n\t\t\t\t\t\tif (change) {\n\t\t\t\t\t\t\tthis.editor.mark('double click edge')\n\t\t\t\t\t\t\tthis.editor.updateShapes([change])\n\t\t\t\t\t\t\tkickoutOccludedShapes(this.editor, [onlySelectedShape.id])\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// For corners OR edges\n\t\t\t\t\tif (\n\t\t\t\t\t\tutil.canCrop(onlySelectedShape) &&\n\t\t\t\t\t\t!this.editor.isShapeOrAncestorLocked(onlySelectedShape)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.parent.transition('crop', info)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.shouldStartEditingShape(onlySelectedShape)) {\n\t\t\t\t\t\tthis.startEditingShape(onlySelectedShape, info, true /* select all */)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'shape': {\n\t\t\t\tconst { shape } = info\n\t\t\t\tconst util = this.editor.getShapeUtil(shape)\n\n\t\t\t\t// Allow playing videos and embeds\n\t\t\t\tif (\n\t\t\t\t\tshape.type !== 'video' &&\n\t\t\t\t\tshape.type !== 'embed' &&\n\t\t\t\t\tthis.editor.getInstanceState().isReadonly\n\t\t\t\t)\n\t\t\t\t\tbreak\n\n\t\t\t\tif (util.onDoubleClick) {\n\t\t\t\t\t// Call the shape's double click handler\n\t\t\t\t\tconst change = util.onDoubleClick?.(shape)\n\t\t\t\t\tif (change) {\n\t\t\t\t\t\tthis.editor.updateShapes([change])\n\t\t\t\t\t\treturn\n\t\t\t\t\t} else if (util.canCrop(shape) && !this.editor.isShapeOrAncestorLocked(shape)) {\n\t\t\t\t\t\t// crop on double click\n\t\t\t\t\t\tthis.editor.mark('select and crop')\n\t\t\t\t\t\tthis.editor.select(info.shape?.id)\n\t\t\t\t\t\tthis.parent.transition('crop', info)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If the shape can edit, then begin editing\n\t\t\t\tif (this.shouldStartEditingShape(shape)) {\n\t\t\t\t\tthis.startEditingShape(shape, info, true /* select all */)\n\t\t\t\t} else {\n\t\t\t\t\t// If the shape's double click handler has not created a change,\n\t\t\t\t\t// and if the shape cannot edit, then create a text shape and\n\t\t\t\t\t// begin editing the text shape\n\t\t\t\t\tthis.handleDoubleClickOnCanvas(info)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'handle': {\n\t\t\t\tif (this.editor.getInstanceState().isReadonly) break\n\t\t\t\tconst { shape, handle } = info\n\n\t\t\t\tconst util = this.editor.getShapeUtil(shape)\n\t\t\t\tconst changes = util.onDoubleClickHandle?.(shape, handle)\n\n\t\t\t\tif (changes) {\n\t\t\t\t\tthis.editor.updateShapes([changes])\n\t\t\t\t} else {\n\t\t\t\t\t// If the shape's double click handler has not created a change,\n\t\t\t\t\t// and if the shape can edit, then begin editing the shape.\n\t\t\t\t\tif (this.shouldStartEditingShape(shape)) {\n\t\t\t\t\t\tthis.startEditingShape(shape, info, true /* select all */)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onRightClick: TLEventHandlers['onRightClick'] = (info) => {\n\t\tswitch (info.target) {\n\t\t\tcase 'canvas': {\n\t\t\t\tconst hoveredShape = this.editor.getHoveredShape()\n\t\t\t\tconst hitShape =\n\t\t\t\t\thoveredShape && !this.editor.isShapeOfType<TLGroupShape>(hoveredShape, 'group')\n\t\t\t\t\t\t? hoveredShape\n\t\t\t\t\t\t: this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint, {\n\t\t\t\t\t\t\t\tmargin: HIT_TEST_MARGIN / this.editor.getZoomLevel(),\n\t\t\t\t\t\t\t\thitInside: false,\n\t\t\t\t\t\t\t\thitLabels: true,\n\t\t\t\t\t\t\t\thitFrameInside: false,\n\t\t\t\t\t\t\t\trenderingOnly: true,\n\t\t\t\t\t\t\t})\n\n\t\t\t\tif (hitShape) {\n\t\t\t\t\tthis.onRightClick({\n\t\t\t\t\t\t...info,\n\t\t\t\t\t\tshape: hitShape,\n\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t})\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst selectedShapeIds = this.editor.getSelectedShapeIds()\n\t\t\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\t\t\t\tconst {\n\t\t\t\t\tinputs: { currentPagePoint },\n\t\t\t\t} = this.editor\n\n\t\t\t\tif (\n\t\t\t\t\tselectedShapeIds.length > 1 ||\n\t\t\t\t\t(onlySelectedShape &&\n\t\t\t\t\t\t!this.editor.getShapeUtil(onlySelectedShape).hideSelectionBoundsBg(onlySelectedShape))\n\t\t\t\t) {\n\t\t\t\t\tif (isPointInRotatedSelectionBounds(this.editor, currentPagePoint)) {\n\t\t\t\t\t\tthis.onRightClick({\n\t\t\t\t\t\t\t...info,\n\t\t\t\t\t\t\ttarget: 'selection',\n\t\t\t\t\t\t})\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.editor.selectNone()\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'shape': {\n\t\t\t\tconst { selectedShapeIds } = this.editor.getCurrentPageState()\n\t\t\t\tconst { shape } = info\n\n\t\t\t\tconst targetShape = this.editor.getOutermostSelectableShape(\n\t\t\t\t\tshape,\n\t\t\t\t\t(parent) => !selectedShapeIds.includes(parent.id)\n\t\t\t\t)\n\n\t\t\t\tif (!selectedShapeIds.includes(targetShape.id)) {\n\t\t\t\t\tthis.editor.mark('selecting shape')\n\t\t\t\t\tthis.editor.setSelectedShapes([targetShape.id])\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tif (\n\t\t\tthis.editor.getFocusedGroupId() !== this.editor.getCurrentPageId() &&\n\t\t\tthis.editor.getSelectedShapeIds().length > 0\n\t\t) {\n\t\t\tthis.editor.popFocusedGroupId()\n\t\t} else {\n\t\t\tthis.editor.mark('clearing selection')\n\t\t\tthis.editor.selectNone()\n\t\t}\n\t}\n\n\toverride onKeyDown: TLEventHandlers['onKeyDown'] = (info) => {\n\t\tswitch (info.code) {\n\t\t\tcase 'ArrowLeft':\n\t\t\tcase 'ArrowRight':\n\t\t\tcase 'ArrowUp':\n\t\t\tcase 'ArrowDown': {\n\t\t\t\tthis.nudgeSelectedShapes(false)\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tif (debugFlags['editOnType'].get()) {\n\t\t\t// This feature flag lets us start editing a note shape's label when a key is pressed.\n\t\t\t// We exclude certain keys to avoid conflicting with modifiers, but there are conflicts\n\t\t\t// with other action kbds, hence why this is kept behind a feature flag.\n\t\t\tif (!SKIPPED_KEYS_FOR_AUTO_EDITING.includes(info.key) && !info.altKey && !info.ctrlKey) {\n\t\t\t\t// If the only selected shape is editable, then begin editing it\n\t\t\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\t\t\t\tif (\n\t\t\t\t\tonlySelectedShape &&\n\t\t\t\t\t// If it's a note shape, then edit on type\n\t\t\t\t\tthis.editor.isShapeOfType(onlySelectedShape, 'note') &&\n\t\t\t\t\t// If it's not locked or anything\n\t\t\t\t\tthis.shouldStartEditingShape(onlySelectedShape)\n\t\t\t\t) {\n\t\t\t\t\tthis.startEditingShape(\n\t\t\t\t\t\tonlySelectedShape,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t...info,\n\t\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t\t\tshape: onlySelectedShape,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue /* select all */\n\t\t\t\t\t)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onKeyRepeat: TLEventHandlers['onKeyDown'] = (info) => {\n\t\tswitch (info.code) {\n\t\t\tcase 'ArrowLeft':\n\t\t\tcase 'ArrowRight':\n\t\t\tcase 'ArrowUp':\n\t\t\tcase 'ArrowDown': {\n\t\t\t\tthis.nudgeSelectedShapes(true)\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onKeyUp = (info: TLKeyboardEventInfo) => {\n\t\tswitch (info.code) {\n\t\t\tcase 'Enter': {\n\t\t\t\tconst selectedShapes = this.editor.getSelectedShapes()\n\n\t\t\t\t// On enter, if every selected shape is a group, then select all of the children of the groups\n\t\t\t\tif (\n\t\t\t\t\tselectedShapes.every((shape) => this.editor.isShapeOfType<TLGroupShape>(shape, 'group'))\n\t\t\t\t) {\n\t\t\t\t\tthis.editor.setSelectedShapes(\n\t\t\t\t\t\tselectedShapes.flatMap((shape) => this.editor.getSortedChildIdsForParent(shape.id))\n\t\t\t\t\t)\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// If the only selected shape is editable, then begin editing it\n\t\t\t\tconst onlySelectedShape = this.editor.getOnlySelectedShape()\n\t\t\t\tif (onlySelectedShape && this.shouldStartEditingShape(onlySelectedShape)) {\n\t\t\t\t\tthis.startEditingShape(\n\t\t\t\t\t\tonlySelectedShape,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t...info,\n\t\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t\t\tshape: onlySelectedShape,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue /* select all */\n\t\t\t\t\t)\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// If the only selected shape is croppable, then begin cropping it\n\t\t\t\tif (getShouldEnterCropMode(this.editor)) {\n\t\t\t\t\tthis.parent.transition('crop', info)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate shouldStartEditingShape(\n\t\tshape: TLShape | null = this.editor.getOnlySelectedShape()\n\t): boolean {\n\t\tif (!shape) return false\n\t\tif (this.editor.isShapeOrAncestorLocked(shape) && shape.type !== 'embed') return false\n\t\tif (!this.canInteractWithShapeInReadOnly(shape)) return false\n\t\treturn this.editor.getShapeUtil(shape).canEdit(shape)\n\t}\n\n\tprivate startEditingShape(\n\t\tshape: TLShape,\n\t\tinfo: TLClickEventInfo | TLKeyboardEventInfo,\n\t\tshouldSelectAll?: boolean\n\t) {\n\t\tif (this.editor.isShapeOrAncestorLocked(shape) && shape.type !== 'embed') return\n\t\tthis.editor.mark('editing shape')\n\t\tstartEditingShapeWithLabel(this.editor, shape, shouldSelectAll)\n\t\tthis.parent.transition('editing_shape', info)\n\t}\n\n\tisDarwin = window.navigator.userAgent.toLowerCase().indexOf('mac') > -1\n\n\tisOverArrowLabelTest(shape: TLShape | undefined) {\n\t\tif (!shape) return false\n\n\t\tconst pointInShapeSpace = this.editor.getPointInShapeSpace(\n\t\t\tshape,\n\t\t\tthis.editor.inputs.currentPagePoint\n\t\t)\n\n\t\t// todo: Extract into general hit test for arrows\n\t\tif (this.editor.isShapeOfType<TLArrowShape>(shape, 'arrow')) {\n\t\t\t// How should we handle multiple labels? Do shapes ever have multiple labels?\n\t\t\tconst labelGeometry = this.editor.getShapeGeometry<Group2d>(shape).children[1]\n\t\t\t// Knowing what we know about arrows... if the shape has no text in its label,\n\t\t\t// then the label geometry should not be there.\n\t\t\tif (labelGeometry && pointInPolygon(pointInShapeSpace, labelGeometry.vertices)) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\n\t\treturn false\n\t}\n\n\thandleDoubleClickOnCanvas(info: TLClickEventInfo) {\n\t\t// Create text shape and transition to editing_shape\n\t\tif (this.editor.getInstanceState().isReadonly) return\n\n\t\tthis.editor.mark('creating text shape')\n\n\t\tconst id = createShapeId()\n\n\t\tconst { x, y } = this.editor.inputs.currentPagePoint\n\n\t\tthis.editor.createShapes<TLTextShape>([\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\ttype: 'text',\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tprops: {\n\t\t\t\t\ttext: '',\n\t\t\t\t\tautoSize: true,\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\n\t\tconst shape = this.editor.getShape(id)\n\t\tif (!shape) return\n\n\t\tconst util = this.editor.getShapeUtil(shape)\n\t\tif (this.editor.getInstanceState().isReadonly) {\n\t\t\tif (!util.canEditInReadOnly(shape)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tthis.editor.setEditingShape(id)\n\t\tthis.editor.select(id)\n\t\tthis.parent.transition('editing_shape', info)\n\t}\n\n\tprivate nudgeSelectedShapes(ephemeral = false) {\n\t\tconst {\n\t\t\teditor: {\n\t\t\t\tinputs: { keys },\n\t\t\t},\n\t\t} = this\n\n\t\t// We want to use the \"actual\" shift key state,\n\t\t// not the one that's in the editor.inputs.shiftKey,\n\t\t// because that one uses a short timeout on release\n\t\tconst shiftKey = keys.has('ShiftLeft')\n\n\t\tconst delta = new Vec(0, 0)\n\n\t\tif (keys.has('ArrowLeft')) delta.x -= 1\n\t\tif (keys.has('ArrowRight')) delta.x += 1\n\t\tif (keys.has('ArrowUp')) delta.y -= 1\n\t\tif (keys.has('ArrowDown')) delta.y += 1\n\n\t\tif (delta.equals(new Vec(0, 0))) return\n\n\t\tif (!ephemeral) this.editor.mark('nudge shapes')\n\n\t\tconst { gridSize } = this.editor.getDocumentSettings()\n\n\t\tconst step = this.editor.getInstanceState().isGridMode\n\t\t\t? shiftKey\n\t\t\t\t? gridSize * GRID_INCREMENT\n\t\t\t\t: gridSize\n\t\t\t: shiftKey\n\t\t\t\t? MAJOR_NUDGE_FACTOR\n\t\t\t\t: MINOR_NUDGE_FACTOR\n\n\t\tconst selectedShapeIds = this.editor.getSelectedShapeIds()\n\t\tthis.editor.nudgeShapes(selectedShapeIds, delta.mul(step))\n\t\tkickoutOccludedShapes(this.editor, selectedShapeIds)\n\t}\n\n\tprivate canInteractWithShapeInReadOnly(shape: TLShape) {\n\t\tif (!this.editor.getInstanceState().isReadonly) return true\n\t\tconst util = this.editor.getShapeUtil(shape)\n\t\tif (util.canEditInReadOnly(shape)) return true\n\t\treturn false\n\t}\n}\n\nexport const MAJOR_NUDGE_FACTOR = 10\nexport const MINOR_NUDGE_FACTOR = 1\nexport const GRID_INCREMENT = 5\n\nfunction isPointInRotatedSelectionBounds(editor: Editor, point: VecLike) {\n\tconst selectionBounds = editor.getSelectionRotatedPageBounds()\n\tif (!selectionBounds) return false\n\n\tconst selectionRotation = editor.getSelectionRotation()\n\tif (!selectionRotation) return selectionBounds.containsPoint(point)\n\n\treturn pointInPolygon(\n\t\tpoint,\n\t\tselectionBounds.corners.map((c) => Vec.RotWith(c, selectionBounds.point, selectionRotation))\n\t)\n}\n", "import {\n\tArc2d,\n\tGeometry2d,\n\tGroup2d,\n\tStateNode,\n\tTLArrowShape,\n\tTLEventHandlers,\n\tTLPointerEventInfo,\n\tTLShapeId,\n\tVec,\n\tgetPointInArcT,\n} from '@tldraw/editor'\n\nexport class PointingArrowLabel extends StateNode {\n\tstatic override id = 'pointing_arrow_label'\n\n\tshapeId = '' as TLShapeId\n\tmarkId = ''\n\twasAlreadySelected = false\n\tdidDrag = false\n\n\tprivate info = {} as TLPointerEventInfo & {\n\t\tshape: TLArrowShape\n\t\tonInteractionEnd?: string\n\t\tisCreating: boolean\n\t}\n\n\tprivate updateCursor() {\n\t\tthis.editor.setCursor({ type: 'grabbing', rotation: 0 })\n\t}\n\n\toverride onEnter = (\n\t\tinfo: TLPointerEventInfo & {\n\t\t\tshape: TLArrowShape\n\t\t\tonInteractionEnd?: string\n\t\t\tisCreating: boolean\n\t\t}\n\t) => {\n\t\tconst { shape } = info\n\t\tthis.parent.setCurrentToolIdMask(info.onInteractionEnd)\n\t\tthis.info = info\n\t\tthis.shapeId = shape.id\n\t\tthis.didDrag = false\n\t\tthis.wasAlreadySelected = this.editor.getOnlySelectedShapeId() === shape.id\n\t\tthis.updateCursor()\n\n\t\tconst geometry = this.editor.getShapeGeometry<Group2d>(shape)\n\t\tconst labelGeometry = geometry.children[1]\n\t\tif (!labelGeometry) {\n\t\t\tthrow Error(`Expected to find an arrow label geometry for shape: ${shape.id}`)\n\t\t}\n\t\tconst { currentPagePoint } = this.editor.inputs\n\t\tconst pointInShapeSpace = this.editor.getPointInShapeSpace(shape, currentPagePoint)\n\n\t\tthis._labelDragOffset = Vec.Sub(labelGeometry.center, pointInShapeSpace)\n\n\t\tthis.markId = 'label-drag start'\n\t\tthis.editor.mark(this.markId)\n\t\tthis.editor.setSelectedShapes([this.shapeId])\n\t}\n\n\toverride onExit = () => {\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t}\n\n\tprivate _labelDragOffset = new Vec(0, 0)\n\n\toverride onPointerMove = () => {\n\t\tconst { isDragging } = this.editor.inputs\n\t\tif (!isDragging) return\n\n\t\tconst shape = this.editor.getShape<TLArrowShape>(this.shapeId)\n\t\tif (!shape) return\n\n\t\tconst info = this.editor.getArrowInfo(shape)!\n\n\t\tconst groupGeometry = this.editor.getShapeGeometry<Group2d>(shape)\n\t\tconst bodyGeometry = groupGeometry.children[0] as Geometry2d\n\t\tconst pointInShapeSpace = this.editor.getPointInShapeSpace(\n\t\t\tshape,\n\t\t\tthis.editor.inputs.currentPagePoint\n\t\t)\n\t\tconst nearestPoint = bodyGeometry.nearestPoint(\n\t\t\tVec.Add(pointInShapeSpace, this._labelDragOffset)\n\t\t)\n\n\t\tlet nextLabelPosition\n\t\tif (info.isStraight) {\n\t\t\t// straight arrows\n\t\t\tconst lineLength = Vec.Dist(info.start.point, info.end.point)\n\t\t\tconst segmentLength = Vec.Dist(info.end.point, nearestPoint)\n\t\t\tnextLabelPosition = 1 - segmentLength / lineLength\n\t\t} else {\n\t\t\tconst { _center, measure, angleEnd, angleStart } = groupGeometry.children[0] as Arc2d\n\t\t\tnextLabelPosition = getPointInArcT(measure, angleStart, angleEnd, _center.angle(nearestPoint))\n\t\t}\n\n\t\tif (isNaN(nextLabelPosition)) {\n\t\t\tnextLabelPosition = 0.5\n\t\t}\n\n\t\tthis.didDrag = true\n\t\tthis.editor.updateShape<TLArrowShape>(\n\t\t\t{ id: shape.id, type: shape.type, props: { labelPosition: nextLabelPosition } },\n\t\t\t{ squashing: true }\n\t\t)\n\t}\n\n\toverride onPointerUp = () => {\n\t\tconst shape = this.editor.getShape<TLArrowShape>(this.shapeId)\n\t\tif (!shape) return\n\n\t\tif (this.didDrag || !this.wasAlreadySelected) {\n\t\t\tthis.complete()\n\t\t} else {\n\t\t\t// Go into edit mode.\n\t\t\tthis.editor.setEditingShape(shape.id)\n\t\t\tthis.editor.setCurrentTool('select.editing_shape')\n\t\t}\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate complete() {\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, {})\n\t\t} else {\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n\n\tprivate cancel() {\n\t\tthis.editor.bailToMark(this.markId)\n\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, {})\n\t\t} else {\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n}\n", "import { StateNode, TLEventHandlers } from '@tldraw/editor'\nimport { selectOnCanvasPointerUp } from '../../selection-logic/selectOnCanvasPointerUp'\n\nexport class PointingCanvas extends StateNode {\n\tstatic override id = 'pointing_canvas'\n\n\toverride onEnter = () => {\n\t\tconst { inputs } = this.editor\n\n\t\tif (!inputs.shiftKey) {\n\t\t\tif (this.editor.getSelectedShapeIds().length > 0) {\n\t\t\t\tthis.editor.mark('selecting none')\n\t\t\t\tthis.editor.selectNone()\n\t\t\t}\n\t\t}\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.parent.transition('brushing', info)\n\t\t}\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\t// todo: also make this deselect\n\t\tselectOnCanvasPointerUp(this.editor)\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.parent.transition('idle')\n\t}\n\n\tprivate complete() {\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import { StateNode, TLEventHandlers, TLPointerEventInfo } from '@tldraw/editor'\nimport { CursorTypeMap } from './PointingResizeHandle'\n\ntype TLPointingCropHandleInfo = TLPointerEventInfo & {\n\ttarget: 'selection'\n} & {\n\tonInteractionEnd?: string\n}\n\nexport class PointingCropHandle extends StateNode {\n\tstatic override id = 'pointing_crop_handle'\n\n\tprivate info = {} as TLPointingCropHandleInfo\n\n\toverride onEnter = (info: TLPointingCropHandleInfo) => {\n\t\tthis.info = info\n\t\tthis.parent.setCurrentToolIdMask(info.onInteractionEnd)\n\t\tconst selectedShape = this.editor.getSelectedShapes()[0]\n\t\tif (!selectedShape) return\n\n\t\tconst cursorType = CursorTypeMap[this.info.handle!]\n\t\tthis.editor.updateInstanceState({\n\t\t\tcursor: {\n\t\t\t\ttype: cursorType,\n\t\t\t\trotation: this.editor.getSelectionRotation(),\n\t\t\t},\n\t\t})\n\t\tthis.editor.setCroppingShape(selectedShape.id)\n\t}\n\n\toverride onExit = () => {\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.startCropping()\n\t\t}\n\t}\n\n\toverride onLongPress: TLEventHandlers['onLongPress'] = () => {\n\t\tthis.startCropping()\n\t}\n\n\tprivate startCropping() {\n\t\tif (this.editor.getInstanceState().isReadonly) return\n\t\tthis.parent.transition('cropping', {\n\t\t\t...this.info,\n\t\t\tonInteractionEnd: this.info.onInteractionEnd,\n\t\t})\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, this.info)\n\t\t} else {\n\t\t\tthis.editor.setCroppingShape(null)\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate cancel() {\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, this.info)\n\t\t} else {\n\t\t\tthis.editor.setCroppingShape(null)\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n}\n", "import {\n\tEditor,\n\tStateNode,\n\tTLArrowShape,\n\tTLEventHandlers,\n\tTLHandle,\n\tTLNoteShape,\n\tTLPointerEventInfo,\n\tVec,\n} from '@tldraw/editor'\nimport {\n\tNOTE_CENTER_OFFSET,\n\tgetNoteAdjacentPositions,\n\tgetNoteShapeForAdjacentPosition,\n} from '../../../shapes/note/noteHelpers'\nimport { startEditingShapeWithLabel } from '../selectHelpers'\n\nexport class PointingHandle extends StateNode {\n\tstatic override id = 'pointing_handle'\n\n\tinfo = {} as TLPointerEventInfo & { target: 'handle' }\n\n\toverride onEnter = (info: TLPointerEventInfo & { target: 'handle' }) => {\n\t\tthis.info = info\n\n\t\tconst { shape } = info\n\t\tif (this.editor.isShapeOfType<TLArrowShape>(shape, 'arrow')) {\n\t\t\tconst initialTerminal = shape.props[info.handle.id as 'start' | 'end']\n\n\t\t\tif (initialTerminal?.type === 'binding') {\n\t\t\t\tthis.editor.setHintingShapes([initialTerminal.boundShapeId])\n\t\t\t}\n\t\t}\n\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'grabbing', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t}\n\n\toverride onExit = () => {\n\t\tthis.editor.setHintingShapes([])\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tconst { shape, handle } = this.info\n\n\t\tif (this.editor.isShapeOfType<TLNoteShape>(shape, 'note')) {\n\t\t\tconst { editor } = this\n\t\t\tconst nextNote = getNoteForPit(editor, shape, handle, false)\n\t\t\tif (nextNote) {\n\t\t\t\tstartEditingShapeWithLabel(editor, nextNote, true /* selectAll */)\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tthis.parent.transition('idle', this.info)\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tconst { editor } = this\n\t\tif (editor.inputs.isDragging) {\n\t\t\tthis.startDraggingHandle()\n\t\t}\n\t}\n\n\toverride onLongPress: TLEventHandlers['onLongPress'] = () => {\n\t\tthis.startDraggingHandle()\n\t}\n\n\tprivate startDraggingHandle() {\n\t\tconst { editor } = this\n\t\tif (editor.getInstanceState().isReadonly) return\n\t\tconst { shape, handle } = this.info\n\n\t\tif (editor.isShapeOfType<TLNoteShape>(shape, 'note')) {\n\t\t\tconst nextNote = getNoteForPit(editor, shape, handle, true)\n\t\t\tif (nextNote) {\n\t\t\t\t// Center the shape on the current pointer\n\t\t\t\tconst centeredOnPointer = editor\n\t\t\t\t\t.getPointInParentSpace(nextNote, editor.inputs.originPagePoint)\n\t\t\t\t\t.sub(Vec.Rot(NOTE_CENTER_OFFSET, nextNote.rotation))\n\t\t\t\teditor.updateShape({ ...nextNote, x: centeredOnPointer.x, y: centeredOnPointer.y })\n\n\t\t\t\t// Then select and begin translating the shape\n\t\t\t\teditor\n\t\t\t\t\t.setHoveredShape(nextNote.id) // important!\n\t\t\t\t\t.select(nextNote.id)\n\t\t\t\t\t.setCurrentTool('select.translating', {\n\t\t\t\t\t\t...this.info,\n\t\t\t\t\t\ttarget: 'shape',\n\t\t\t\t\t\tshape: editor.getShape(nextNote),\n\t\t\t\t\t\tonInteractionEnd: 'note',\n\t\t\t\t\t\tisCreating: true,\n\t\t\t\t\t\tonCreate: () => {\n\t\t\t\t\t\t\t// When we're done, start editing it\n\t\t\t\t\t\t\tstartEditingShapeWithLabel(editor, nextNote, true /* selectAll */)\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tthis.parent.transition('dragging_handle', this.info)\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate cancel() {\n\t\tthis.parent.transition('idle')\n\t}\n}\n\nfunction getNoteForPit(editor: Editor, shape: TLNoteShape, handle: TLHandle, forceNew: boolean) {\n\tconst pageTransform = editor.getShapePageTransform(shape.id)!\n\tconst pagePoint = pageTransform.point()\n\tconst pageRotation = pageTransform.rotation()\n\tconst pits = getNoteAdjacentPositions(pagePoint, pageRotation, shape.props.growY, 0)\n\tconst pit = pits[handle.index]\n\tif (pit) {\n\t\treturn getNoteShapeForAdjacentPosition(editor, shape, pit, pageRotation, forceNew)\n\t}\n}\n", "import { RotateCorner, StateNode, TLEventHandlers, TLPointerEventInfo } from '@tldraw/editor'\nimport { CursorTypeMap } from './PointingResizeHandle'\n\ntype PointingRotateHandleInfo = Extract<TLPointerEventInfo, { target: 'selection' }> & {\n\tonInteractionEnd?: string\n}\n\nexport class PointingRotateHandle extends StateNode {\n\tstatic override id = 'pointing_rotate_handle'\n\n\tprivate info = {} as PointingRotateHandleInfo\n\n\tprivate updateCursor() {\n\t\tthis.editor.updateInstanceState({\n\t\t\tcursor: {\n\t\t\t\ttype: CursorTypeMap[this.info.handle as RotateCorner],\n\t\t\t\trotation: this.editor.getSelectionRotation(),\n\t\t\t},\n\t\t})\n\t}\n\n\toverride onEnter = (info: PointingRotateHandleInfo) => {\n\t\tthis.parent.setCurrentToolIdMask(info.onInteractionEnd)\n\t\tthis.info = info\n\t\tthis.updateCursor()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.startRotating()\n\t\t}\n\t}\n\n\toverride onLongPress: TLEventHandlers['onLongPress'] = () => {\n\t\tthis.startRotating()\n\t}\n\n\tprivate startRotating() {\n\t\tif (this.editor.getInstanceState().isReadonly) return\n\t\tthis.parent.transition('rotating', this.info)\n\t}\n\n\toverride onPointerUp = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate complete() {\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, {})\n\t\t} else {\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n\n\tprivate cancel() {\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, {})\n\t\t} else {\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n}\n", "import {\n\tStateNode,\n\tTLClickEvent,\n\tTLEventHandlers,\n\tTLGroupShape,\n\tTLPointerEventInfo,\n} from '@tldraw/editor'\nimport { selectOnCanvasPointerUp } from '../../selection-logic/selectOnCanvasPointerUp'\n\nexport class PointingSelection extends StateNode {\n\tstatic override id = 'pointing_selection'\n\n\tinfo = {} as TLPointerEventInfo & {\n\t\ttarget: 'selection'\n\t}\n\n\toverride onEnter = (info: TLPointerEventInfo & { target: 'selection' }) => {\n\t\tthis.info = info\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = (info) => {\n\t\tselectOnCanvasPointerUp(this.editor)\n\t\tthis.parent.transition('idle', info)\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.startTranslating(info)\n\t\t}\n\t}\n\n\toverride onLongPress: TLEventHandlers['onLongPress'] = (info) => {\n\t\tthis.startTranslating(info)\n\t}\n\n\tprivate startTranslating(info: TLPointerEventInfo) {\n\t\tif (this.editor.getInstanceState().isReadonly) return\n\t\tthis.parent.transition('translating', info)\n\t}\n\n\toverride onDoubleClick?: TLClickEvent | undefined = (info) => {\n\t\tconst hoveredShape = this.editor.getHoveredShape()\n\t\tconst hitShape =\n\t\t\thoveredShape && !this.editor.isShapeOfType<TLGroupShape>(hoveredShape, 'group')\n\t\t\t\t? hoveredShape\n\t\t\t\t: this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint, {\n\t\t\t\t\t\thitInside: true,\n\t\t\t\t\t\tmargin: 0,\n\t\t\t\t\t\trenderingOnly: true,\n\t\t\t\t\t})\n\n\t\tif (hitShape) {\n\t\t\t// todo: extract the double click shape logic from idle so that we can share it here\n\t\t\tthis.parent.transition('idle')\n\t\t\tthis.parent.onDoubleClick?.({\n\t\t\t\t...info,\n\t\t\t\ttarget: 'shape',\n\t\t\t\tshape: this.editor.getShape(hitShape)!,\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate cancel() {\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import {\n\tHIT_TEST_MARGIN,\n\tStateNode,\n\tTLEventHandlers,\n\tTLPointerEventInfo,\n\tTLShape,\n} from '@tldraw/editor'\nimport { getTextLabels } from '../../../utils/shapes/shapes'\n\nexport class PointingShape extends StateNode {\n\tstatic override id = 'pointing_shape'\n\n\thitShape = {} as TLShape\n\thitShapeForPointerUp = {} as TLShape\n\tisDoubleClick = false\n\n\tdidSelectOnEnter = false\n\n\toverride onEnter = (info: TLPointerEventInfo & { target: 'shape' }) => {\n\t\tconst selectedShapeIds = this.editor.getSelectedShapeIds()\n\t\tconst selectionBounds = this.editor.getSelectionRotatedPageBounds()\n\t\tconst focusedGroupId = this.editor.getFocusedGroupId()\n\t\tconst {\n\t\t\tinputs: { currentPagePoint, shiftKey, altKey },\n\t\t} = this.editor\n\n\t\tthis.hitShape = info.shape\n\t\tthis.isDoubleClick = false\n\t\tconst outermostSelectingShape = this.editor.getOutermostSelectableShape(info.shape)\n\t\tconst selectedAncestor = this.editor.findShapeAncestor(outermostSelectingShape, (parent) =>\n\t\t\tselectedShapeIds.includes(parent.id)\n\t\t)\n\n\t\tif (\n\t\t\t// If the shape has an onClick handler\n\t\t\tthis.editor.getShapeUtil(info.shape).onClick ||\n\t\t\t// ...or if the shape is the focused layer (e.g. group)\n\t\t\toutermostSelectingShape.id === focusedGroupId ||\n\t\t\t// ...or if the shape is within the selection\n\t\t\tselectedShapeIds.includes(outermostSelectingShape.id) ||\n\t\t\t// ...or if an ancestor of the shape is selected\n\t\t\tselectedAncestor ||\n\t\t\t// ...or if the current point is NOT within the selection bounds\n\t\t\t(selectedShapeIds.length > 1 && selectionBounds?.containsPoint(currentPagePoint))\n\t\t) {\n\t\t\t// We won't select the shape on enter, though we might select it on pointer up!\n\t\t\tthis.didSelectOnEnter = false\n\t\t\tthis.hitShapeForPointerUp = outermostSelectingShape\n\t\t\treturn\n\t\t}\n\n\t\tthis.didSelectOnEnter = true\n\n\t\tif (shiftKey && !altKey) {\n\t\t\tthis.editor.cancelDoubleClick()\n\t\t\tif (!selectedShapeIds.includes(outermostSelectingShape.id)) {\n\t\t\t\tthis.editor.mark('shift selecting shape')\n\t\t\t\tthis.editor.setSelectedShapes([...selectedShapeIds, outermostSelectingShape.id])\n\t\t\t}\n\t\t} else {\n\t\t\tthis.editor.mark('selecting shape')\n\t\t\tthis.editor.setSelectedShapes([outermostSelectingShape.id])\n\t\t}\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = (info) => {\n\t\tconst selectedShapeIds = this.editor.getSelectedShapeIds()\n\t\tconst focusedGroupId = this.editor.getFocusedGroupId()\n\t\tconst zoomLevel = this.editor.getZoomLevel()\n\t\tconst {\n\t\t\tinputs: { currentPagePoint, shiftKey },\n\t\t} = this.editor\n\n\t\tconst hitShape =\n\t\t\tthis.editor.getShapeAtPoint(currentPagePoint, {\n\t\t\t\tmargin: HIT_TEST_MARGIN / zoomLevel,\n\t\t\t\thitInside: true,\n\t\t\t\trenderingOnly: true,\n\t\t\t}) ?? this.hitShape\n\n\t\tconst selectingShape = hitShape\n\t\t\t? this.editor.getOutermostSelectableShape(hitShape)\n\t\t\t: this.hitShapeForPointerUp\n\n\t\tif (selectingShape) {\n\t\t\t// If the selecting shape has a click handler, call it instead of selecting the shape\n\t\t\tconst util = this.editor.getShapeUtil(selectingShape)\n\t\t\tif (util.onClick) {\n\t\t\t\tconst change = util.onClick?.(selectingShape)\n\t\t\t\tif (change) {\n\t\t\t\t\tthis.editor.mark('shape on click')\n\t\t\t\t\tthis.editor.updateShapes([change])\n\t\t\t\t\tthis.parent.transition('idle', info)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (selectingShape.id === focusedGroupId) {\n\t\t\t\tif (selectedShapeIds.length > 0) {\n\t\t\t\t\tthis.editor.mark('clearing shape ids')\n\t\t\t\t\tthis.editor.setSelectedShapes([])\n\t\t\t\t} else {\n\t\t\t\t\tthis.editor.popFocusedGroupId()\n\t\t\t\t}\n\t\t\t\tthis.parent.transition('idle', info)\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tif (!this.didSelectOnEnter) {\n\t\t\t// if the shape has an ancestor which is a focusable layer and it is not focused but it is selected\n\t\t\t// then we should focus the layer and select the shape\n\n\t\t\tconst outermostSelectableShape = this.editor.getOutermostSelectableShape(\n\t\t\t\thitShape,\n\t\t\t\t// if a group is selected, we want to stop before reaching that group\n\t\t\t\t// so we can drill down into the group\n\t\t\t\t(parent) => !selectedShapeIds.includes(parent.id)\n\t\t\t)\n\n\t\t\t// If the outermost shape is selected, then either select or deselect the SELECTING shape\n\t\t\tif (selectedShapeIds.includes(outermostSelectableShape.id)) {\n\t\t\t\t// same shape, so deselect it if shift is pressed, otherwise deselect all others\n\t\t\t\tif (shiftKey) {\n\t\t\t\t\tthis.editor.mark('deselecting on pointer up')\n\t\t\t\t\tthis.editor.deselect(selectingShape)\n\t\t\t\t} else {\n\t\t\t\t\tif (selectedShapeIds.includes(selectingShape.id)) {\n\t\t\t\t\t\t// todo\n\t\t\t\t\t\t// if the shape is editable and we're inside of an editable part of that shape, e.g. the label of a geo shape,\n\t\t\t\t\t\t// then we would want to begin editing the shape. At the moment we're relying on the shape label's onPointerUp\n\t\t\t\t\t\t// handler to do this logic, and prevent the regular pointer up event, so we won't be here in that case.\n\n\t\t\t\t\t\t// if the shape has a text label, and we're inside of the label, then we want to begin editing the label.\n\t\t\t\t\t\tif (selectedShapeIds.length === 1) {\n\t\t\t\t\t\t\tconst geometry = this.editor.getShapeUtil(selectingShape).getGeometry(selectingShape)\n\t\t\t\t\t\t\tconst textLabels = getTextLabels(geometry)\n\t\t\t\t\t\t\tconst textLabel = textLabels.length === 1 ? textLabels[0] : undefined\n\t\t\t\t\t\t\t// N.B. we're only interested if there is exactly one text label. We don't handle the\n\t\t\t\t\t\t\t// case if there's potentially more than one text label at the moment.\n\t\t\t\t\t\t\tif (textLabel) {\n\t\t\t\t\t\t\t\tconst pointInShapeSpace = this.editor.getPointInShapeSpace(\n\t\t\t\t\t\t\t\t\tselectingShape,\n\t\t\t\t\t\t\t\t\tcurrentPagePoint\n\t\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\ttextLabel.bounds.containsPoint(pointInShapeSpace, 0) &&\n\t\t\t\t\t\t\t\t\ttextLabel.hitTestPoint(pointInShapeSpace)\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tthis.editor.batch(() => {\n\t\t\t\t\t\t\t\t\t\tthis.editor.mark('editing on pointer up')\n\t\t\t\t\t\t\t\t\t\tthis.editor.select(selectingShape.id)\n\n\t\t\t\t\t\t\t\t\t\tconst util = this.editor.getShapeUtil(selectingShape)\n\t\t\t\t\t\t\t\t\t\tif (this.editor.getInstanceState().isReadonly) {\n\t\t\t\t\t\t\t\t\t\t\tif (!util.canEditInReadOnly(selectingShape)) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tthis.editor.setEditingShape(selectingShape.id)\n\t\t\t\t\t\t\t\t\t\tthis.editor.setCurrentTool('select.editing_shape')\n\n\t\t\t\t\t\t\t\t\t\tif (this.isDoubleClick) {\n\t\t\t\t\t\t\t\t\t\t\tthis.editor.emit('select-all-text', { shapeId: selectingShape.id })\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// We just want to select the single shape from the selection\n\t\t\t\t\t\tthis.editor.mark('selecting on pointer up')\n\t\t\t\t\t\tthis.editor.select(selectingShape.id)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.editor.mark('selecting on pointer up')\n\t\t\t\t\t\tthis.editor.select(selectingShape)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (shiftKey) {\n\t\t\t\t// Different shape, so we are drilling down into a group with shift key held.\n\t\t\t\t// Deselect any ancestors and add the target shape to the selection\n\t\t\t\tconst ancestors = this.editor.getShapeAncestors(outermostSelectableShape)\n\n\t\t\t\tthis.editor.mark('shift deselecting on pointer up')\n\t\t\t\tthis.editor.setSelectedShapes([\n\t\t\t\t\t...this.editor.getSelectedShapeIds().filter((id) => !ancestors.find((a) => a.id === id)),\n\t\t\t\t\toutermostSelectableShape.id,\n\t\t\t\t])\n\t\t\t} else {\n\t\t\t\tthis.editor.mark('selecting on pointer up')\n\t\t\t\t// different shape and we are drilling down, but no shift held so just select it straight up\n\t\t\t\tthis.editor.setSelectedShapes([outermostSelectableShape.id])\n\t\t\t}\n\t\t}\n\n\t\tthis.parent.transition('idle', info)\n\t}\n\n\toverride onDoubleClick: TLEventHandlers['onDoubleClick'] = () => {\n\t\tthis.isDoubleClick = true\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = (info) => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.startTranslating(info)\n\t\t}\n\t}\n\n\toverride onLongPress: TLEventHandlers['onLongPress'] = (info) => {\n\t\tthis.startTranslating(info)\n\t}\n\n\tprivate startTranslating(info: TLPointerEventInfo) {\n\t\tif (this.editor.getInstanceState().isReadonly) return\n\n\t\t// Re-focus the editor, just in case the text label of the shape has stolen focus\n\t\tthis.editor.getContainer().focus()\n\t\tthis.parent.transition('translating', info)\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onInterrupt = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate cancel() {\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import {\n\tHALF_PI,\n\tMat,\n\tPI,\n\tPI2,\n\tSelectionCorner,\n\tSelectionEdge,\n\tStateNode,\n\tTLEnterEventHandler,\n\tTLEventHandlers,\n\tTLFrameShape,\n\tTLPointerEventInfo,\n\tTLShape,\n\tTLShapeId,\n\tTLShapePartial,\n\tVec,\n\tVecLike,\n\tareAnglesCompatible,\n\tcompact,\n\tmoveCameraWhenCloseToEdge,\n} from '@tldraw/editor'\nimport { kickoutOccludedShapes } from '../selectHelpers'\n\ntype ResizingInfo = TLPointerEventInfo & {\n\ttarget: 'selection'\n\thandle: SelectionEdge | SelectionCorner\n\tisCreating?: boolean\n\tonCreate?: (shape: TLShape | null) => void\n\tcreationCursorOffset?: VecLike\n\tonInteractionEnd?: string\n}\n\nexport class Resizing extends StateNode {\n\tstatic override id = 'resizing'\n\n\tinfo = {} as ResizingInfo\n\n\tmarkId = ''\n\n\t// A switch to detect when the user is holding ctrl\n\tprivate didHoldCommand = false\n\n\t// we transition into the resizing state from the geo pointing state, which starts with a shape of size w: 1, h: 1,\n\t// so if the user drags x: +50, y: +50 after mouseDown, the shape will be w: 51, h: 51, which is too many pixels, alas\n\t// so we allow passing a further offset into this state to negate such issues\n\tcreationCursorOffset = { x: 0, y: 0 } as VecLike\n\n\tprivate snapshot = {} as any as Snapshot\n\n\toverride onEnter: TLEnterEventHandler = (info: ResizingInfo) => {\n\t\tconst { isCreating = false, creationCursorOffset = { x: 0, y: 0 } } = info\n\n\t\tthis.info = info\n\t\tthis.didHoldCommand = false\n\n\t\tthis.parent.setCurrentToolIdMask(info.onInteractionEnd)\n\t\tthis.creationCursorOffset = creationCursorOffset\n\n\t\tthis.snapshot = this._createSnapshot()\n\n\t\tif (isCreating) {\n\t\t\tthis.markId = `creating:${this.editor.getOnlySelectedShape()!.id}`\n\n\t\t\tthis.editor.updateInstanceState(\n\t\t\t\t{ cursor: { type: 'cross', rotation: 0 } },\n\t\t\t\t{ ephemeral: true }\n\t\t\t)\n\t\t} else {\n\t\t\tthis.markId = 'starting resizing'\n\t\t\tthis.editor.mark(this.markId)\n\t\t}\n\n\t\tthis.handleResizeStart()\n\t\tthis.updateShapes()\n\t}\n\n\toverride onTick = () => {\n\t\tmoveCameraWhenCloseToEdge(this.editor)\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerMove'] = () => {\n\t\tthis.updateShapes()\n\t}\n\n\toverride onKeyDown: TLEventHandlers['onKeyDown'] = () => {\n\t\tthis.updateShapes()\n\t}\n\toverride onKeyUp: TLEventHandlers['onKeyUp'] = () => {\n\t\tthis.updateShapes()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate cancel() {\n\t\t// Restore initial models\n\t\tthis.editor.bailToMark(this.markId)\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, {})\n\t\t} else {\n\t\t\tthis.parent.transition('idle')\n\t\t}\n\t}\n\n\tprivate complete() {\n\t\tkickoutOccludedShapes(this.editor, this.snapshot.selectedShapeIds)\n\n\t\tthis.handleResizeEnd()\n\n\t\tif (this.info.isCreating && this.info.onCreate) {\n\t\t\tthis.info.onCreate?.(this.editor.getOnlySelectedShape())\n\t\t\treturn\n\t\t}\n\n\t\tif (this.editor.getInstanceState().isToolLocked && this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, {})\n\t\t\treturn\n\t\t}\n\n\t\tthis.parent.transition('idle')\n\t}\n\n\tprivate handleResizeStart() {\n\t\tconst { shapeSnapshots } = this.snapshot\n\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tshapeSnapshots.forEach(({ shape }) => {\n\t\t\tconst util = this.editor.getShapeUtil(shape)\n\t\t\tconst change = util.onResizeStart?.(shape)\n\t\t\tif (change) {\n\t\t\t\tchanges.push(change)\n\t\t\t}\n\t\t})\n\n\t\tif (changes.length > 0) {\n\t\t\tthis.editor.updateShapes(changes)\n\t\t}\n\t}\n\n\tprivate handleResizeEnd() {\n\t\tconst { shapeSnapshots } = this.snapshot\n\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tshapeSnapshots.forEach(({ shape }) => {\n\t\t\tconst current = this.editor.getShape(shape.id)!\n\t\t\tconst util = this.editor.getShapeUtil(shape)\n\t\t\tconst change = util.onResizeEnd?.(shape, current)\n\t\t\tif (change) {\n\t\t\t\tchanges.push(change)\n\t\t\t}\n\t\t})\n\n\t\tif (changes.length > 0) {\n\t\t\tthis.editor.updateShapes(changes)\n\t\t}\n\t}\n\n\tprivate updateShapes() {\n\t\tconst { altKey, shiftKey } = this.editor.inputs\n\t\tconst {\n\t\t\tframes,\n\t\t\tshapeSnapshots,\n\t\t\tselectionBounds,\n\t\t\tcursorHandleOffset,\n\t\t\tselectedShapeIds,\n\t\t\tselectionRotation,\n\t\t\tcanShapesDeform,\n\t\t} = this.snapshot\n\n\t\tconst isAspectRatioLocked = shiftKey || !canShapesDeform\n\n\t\t// first negate the 'cursor handle offset'\n\t\t// we need to do this because we do grid snapping based on the page point of the handle\n\t\t// rather than the page point of the cursor, so it's easier to pretend that the cursor\n\t\t// is really where the handle actually is\n\t\t//\n\t\t// *** Massively zoomed-in diagram of the initial mouseDown ***\n\t\t//\n\t\t//\n\t\t//                         \u2502\n\t\t//                         \u2502\n\t\t//                         \u2502\n\t\t//                         \u2502\n\t\t//                         \u2502\n\t\t//                         \u2502\n\t\t//                         \u2502\n\t\t//                         \u2502corner handle\n\t\t//                     \u250C\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510\n\t\t//   selection         \u2502       \u2502\n\t\t//  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   x\u25C4\u2500\u2500\u253C\u2500\u2500\u2500\u2500 drag handle point   \u25B2\n\t\t//                     \u2502       \u2502                         \u2502\n\t\t//                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u251C\u2500 cursorHandleOffset.y\n\t\t//                                                       \u2502\n\t\t//        originPagePoint\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25BAx\u2500\u2510                     \u25BC\n\t\t//                               \u2502 \u2514\u2500\u2510\n\t\t//                               \u2502   \u2514\u2500\u2510\n\t\t//                               \u2502     \u2502 mouse (sorry)\n\t\t//                               \u2514\u2500\u2500\u2510 \u250C\u2518\n\t\t//                                  \u2502 \u2502\n\t\t//                                  \u2514\u2500\u2518\n\t\t//                         \u25C4\u2500\u2500\u252C\u2500\u2500\u25BA\n\t\t//                            \u2502\n\t\t//                   cursorHandleOffset.x\n\n\t\tconst { ctrlKey } = this.editor.inputs\n\n\t\tconst currentPagePoint = this.editor.inputs.currentPagePoint\n\t\t\t.clone()\n\t\t\t.sub(cursorHandleOffset)\n\t\t\t.sub(this.creationCursorOffset)\n\t\tconst originPagePoint = this.editor.inputs.originPagePoint.clone().sub(cursorHandleOffset)\n\n\t\tif (this.editor.getInstanceState().isGridMode && !ctrlKey) {\n\t\t\tconst { gridSize } = this.editor.getDocumentSettings()\n\t\t\tcurrentPagePoint.snapToGrid(gridSize)\n\t\t}\n\n\t\tconst dragHandle = this.info.handle as SelectionCorner | SelectionEdge\n\t\tconst scaleOriginHandle = rotateSelectionHandle(dragHandle, Math.PI)\n\n\t\tthis.editor.snaps.clearIndicators()\n\n\t\tconst shouldSnap = this.editor.user.getIsSnapMode() ? !ctrlKey : ctrlKey\n\n\t\tif (shouldSnap && selectionRotation % HALF_PI === 0) {\n\t\t\tconst { nudge } = this.editor.snaps.shapeBounds.snapResizeShapes({\n\t\t\t\tdragDelta: Vec.Sub(currentPagePoint, originPagePoint),\n\t\t\t\tinitialSelectionPageBounds: this.snapshot.initialSelectionPageBounds,\n\t\t\t\thandle: rotateSelectionHandle(dragHandle, selectionRotation),\n\t\t\t\tisAspectRatioLocked,\n\t\t\t\tisResizingFromCenter: altKey,\n\t\t\t})\n\n\t\t\tcurrentPagePoint.add(nudge)\n\t\t}\n\n\t\t// get the page point of the selection handle opposite to the drag handle\n\t\t// or the center of the selection box if altKey is pressed\n\t\tconst scaleOriginPage = Vec.RotWith(\n\t\t\taltKey ? selectionBounds.center : selectionBounds.getHandlePoint(scaleOriginHandle),\n\t\t\tselectionBounds.point,\n\t\t\tselectionRotation\n\t\t)\n\n\t\t// calculate the scale by measuring the current distance between the drag handle and the scale origin\n\t\t// and dividing by the original distance between the drag handle and the scale origin\n\n\t\tconst distanceFromScaleOriginNow = Vec.Sub(currentPagePoint, scaleOriginPage).rot(\n\t\t\t-selectionRotation\n\t\t)\n\n\t\tconst distanceFromScaleOriginAtStart = Vec.Sub(originPagePoint, scaleOriginPage).rot(\n\t\t\t-selectionRotation\n\t\t)\n\n\t\tconst scale = Vec.DivV(distanceFromScaleOriginNow, distanceFromScaleOriginAtStart)\n\n\t\tif (!Number.isFinite(scale.x)) scale.x = 1\n\t\tif (!Number.isFinite(scale.y)) scale.y = 1\n\n\t\tconst isXLocked = dragHandle === 'top' || dragHandle === 'bottom'\n\t\tconst isYLocked = dragHandle === 'left' || dragHandle === 'right'\n\n\t\t// lock an axis if required\n\t\tif (isAspectRatioLocked) {\n\t\t\tif (isYLocked) {\n\t\t\t\t// holding shift and dragging either the left or the right edge\n\t\t\t\tscale.y = Math.abs(scale.x)\n\t\t\t} else if (isXLocked) {\n\t\t\t\t// holding shift and dragging either the top or the bottom edge\n\t\t\t\tscale.x = Math.abs(scale.y)\n\t\t\t} else if (Math.abs(scale.x) > Math.abs(scale.y)) {\n\t\t\t\t// holding shift and the drag has moved further in the x dimension\n\t\t\t\tscale.y = Math.abs(scale.x) * (scale.y < 0 ? -1 : 1)\n\t\t\t} else {\n\t\t\t\t// holding shift and the drag has moved further in the y dimension\n\t\t\t\tscale.x = Math.abs(scale.y) * (scale.x < 0 ? -1 : 1)\n\t\t\t}\n\t\t} else {\n\t\t\t// not holding shift, but still need to lock axes if dragging an edge\n\t\t\tif (isXLocked) {\n\t\t\t\tscale.x = 1\n\t\t\t}\n\t\t\tif (isYLocked) {\n\t\t\t\tscale.y = 1\n\t\t\t}\n\t\t}\n\n\t\tif (!this.info.isCreating) {\n\t\t\tthis.updateCursor({\n\t\t\t\tdragHandle,\n\t\t\t\tisFlippedX: scale.x < 0,\n\t\t\t\tisFlippedY: scale.y < 0,\n\t\t\t\trotation: selectionRotation,\n\t\t\t})\n\t\t}\n\n\t\tfor (const id of shapeSnapshots.keys()) {\n\t\t\tconst snapshot = shapeSnapshots.get(id)!\n\n\t\t\tthis.editor.resizeShape(id, scale, {\n\t\t\t\tinitialShape: snapshot.shape,\n\t\t\t\tinitialBounds: snapshot.bounds,\n\t\t\t\tinitialPageTransform: snapshot.pageTransform,\n\t\t\t\tdragHandle,\n\t\t\t\tmode:\n\t\t\t\t\tselectedShapeIds.length === 1 && id === selectedShapeIds[0]\n\t\t\t\t\t\t? 'resize_bounds'\n\t\t\t\t\t\t: 'scale_shape',\n\t\t\t\tscaleOrigin: scaleOriginPage,\n\t\t\t\tscaleAxisRotation: selectionRotation,\n\t\t\t})\n\t\t}\n\n\t\tif (this.editor.inputs.ctrlKey) {\n\t\t\tthis.didHoldCommand = true\n\n\t\t\tfor (const { id, children } of frames) {\n\t\t\t\tif (!children.length) continue\n\t\t\t\tconst initial = shapeSnapshots.get(id)!.shape\n\t\t\t\tconst current = this.editor.getShape(id)!\n\t\t\t\tif (!(initial && current)) continue\n\n\t\t\t\t// If the user is holding ctrl, then preseve the position of the frame's children\n\t\t\t\tconst dx = current.x - initial.x\n\t\t\t\tconst dy = current.y - initial.y\n\n\t\t\t\tconst delta = new Vec(dx, dy).rot(-initial.rotation)\n\n\t\t\t\tif (delta.x !== 0 || delta.y !== 0) {\n\t\t\t\t\tfor (const child of children) {\n\t\t\t\t\t\tthis.editor.updateShape({\n\t\t\t\t\t\t\tid: child.id,\n\t\t\t\t\t\t\ttype: child.type,\n\t\t\t\t\t\t\tx: child.x - delta.x,\n\t\t\t\t\t\t\ty: child.y - delta.y,\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.didHoldCommand) {\n\t\t\tthis.didHoldCommand = false\n\n\t\t\tfor (const { children } of frames) {\n\t\t\t\tif (!children.length) continue\n\t\t\t\tfor (const child of children) {\n\t\t\t\t\tthis.editor.updateShape({\n\t\t\t\t\t\tid: child.id,\n\t\t\t\t\t\ttype: child.type,\n\t\t\t\t\t\tx: child.x,\n\t\t\t\t\t\ty: child.y,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// ---\n\n\tprivate updateCursor({\n\t\tdragHandle,\n\t\tisFlippedX,\n\t\tisFlippedY,\n\t\trotation,\n\t}: {\n\t\tdragHandle: SelectionCorner | SelectionEdge\n\t\tisFlippedX: boolean\n\t\tisFlippedY: boolean\n\t\trotation: number\n\t}) {\n\t\tconst nextCursor = { ...this.editor.getInstanceState().cursor }\n\n\t\tswitch (dragHandle) {\n\t\t\tcase 'top_left':\n\t\t\tcase 'bottom_right': {\n\t\t\t\tnextCursor.type = 'nwse-resize'\n\t\t\t\tif (isFlippedX !== isFlippedY) {\n\t\t\t\t\tnextCursor.type = 'nesw-resize'\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'top_right':\n\t\t\tcase 'bottom_left': {\n\t\t\t\tnextCursor.type = 'nesw-resize'\n\t\t\t\tif (isFlippedX !== isFlippedY) {\n\t\t\t\t\tnextCursor.type = 'nwse-resize'\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tnextCursor.rotation = rotation\n\n\t\tthis.editor.setCursor(nextCursor)\n\t}\n\n\toverride onExit = () => {\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t\tthis.editor.snaps.clearIndicators()\n\t}\n\n\t_createSnapshot = () => {\n\t\tconst selectedShapeIds = this.editor.getSelectedShapeIds()\n\t\tconst selectionRotation = this.editor.getSelectionRotation()\n\t\tconst {\n\t\t\tinputs: { originPagePoint },\n\t\t} = this.editor\n\n\t\tconst selectionBounds = this.editor.getSelectionRotatedPageBounds()!\n\n\t\tconst dragHandlePoint = Vec.RotWith(\n\t\t\tselectionBounds.getHandlePoint(this.info.handle!),\n\t\t\tselectionBounds.point,\n\t\t\tselectionRotation\n\t\t)\n\n\t\tconst cursorHandleOffset = Vec.Sub(originPagePoint, dragHandlePoint)\n\n\t\tconst shapeSnapshots = new Map<TLShapeId, ShapeSnapshot>()\n\n\t\tconst frames: { id: TLShapeId; children: TLShape[] }[] = []\n\n\t\tselectedShapeIds.forEach((id) => {\n\t\t\tconst shape = this.editor.getShape(id)\n\t\t\tif (shape) {\n\t\t\t\tif (shape.type === 'frame') {\n\t\t\t\t\tframes.push({\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tchildren: compact(\n\t\t\t\t\t\t\tthis.editor.getSortedChildIdsForParent(shape).map((id) => this.editor.getShape(id))\n\t\t\t\t\t\t),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tshapeSnapshots.set(shape.id, this._createShapeSnapshot(shape))\n\t\t\t\tif (\n\t\t\t\t\tthis.editor.isShapeOfType<TLFrameShape>(shape, 'frame') &&\n\t\t\t\t\tselectedShapeIds.length === 1\n\t\t\t\t)\n\t\t\t\t\treturn\n\t\t\t\tthis.editor.visitDescendants(shape.id, (descendantId) => {\n\t\t\t\t\tconst descendent = this.editor.getShape(descendantId)\n\t\t\t\t\tif (descendent) {\n\t\t\t\t\t\tshapeSnapshots.set(descendent.id, this._createShapeSnapshot(descendent))\n\t\t\t\t\t\tif (this.editor.isShapeOfType<TLFrameShape>(descendent, 'frame')) {\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\n\t\tconst canShapesDeform = ![...shapeSnapshots.values()].some(\n\t\t\t(shape) =>\n\t\t\t\t!areAnglesCompatible(shape.pageRotation, selectionRotation) || shape.isAspectRatioLocked\n\t\t)\n\n\t\treturn {\n\t\t\tshapeSnapshots,\n\t\t\tselectionBounds,\n\t\t\tcursorHandleOffset,\n\t\t\tselectionRotation,\n\t\t\tselectedShapeIds,\n\t\t\tcanShapesDeform,\n\t\t\tinitialSelectionPageBounds: this.editor.getSelectionPageBounds()!,\n\t\t\tframes,\n\t\t}\n\t}\n\n\t_createShapeSnapshot = (shape: TLShape) => {\n\t\tconst pageTransform = this.editor.getShapePageTransform(shape)!\n\t\tconst util = this.editor.getShapeUtil(shape)\n\n\t\treturn {\n\t\t\tshape,\n\t\t\tbounds: this.editor.getShapeGeometry(shape).bounds,\n\t\t\tpageTransform,\n\t\t\tpageRotation: Mat.Decompose(pageTransform!).rotation,\n\t\t\tisAspectRatioLocked: util.isAspectRatioLocked(shape),\n\t\t}\n\t}\n}\n\ntype Snapshot = ReturnType<Resizing['_createSnapshot']>\ntype ShapeSnapshot = ReturnType<Resizing['_createShapeSnapshot']>\n\nconst ORDERED_SELECTION_HANDLES: (SelectionEdge | SelectionCorner)[] = [\n\t'top',\n\t'top_right',\n\t'right',\n\t'bottom_right',\n\t'bottom',\n\t'bottom_left',\n\t'left',\n\t'top_left',\n]\n\nexport function rotateSelectionHandle(handle: SelectionEdge | SelectionCorner, rotation: number) {\n\t// first find out how many tau we need to rotate by\n\trotation = rotation % PI2\n\tconst numSteps = Math.round(rotation / (PI / 4))\n\n\tconst currentIndex = ORDERED_SELECTION_HANDLES.indexOf(handle)\n\treturn ORDERED_SELECTION_HANDLES[(currentIndex + numSteps) % ORDERED_SELECTION_HANDLES.length]\n}\n", "import {\n\tRotateCorner,\n\tStateNode,\n\tTLEventHandlers,\n\tTLPointerEventInfo,\n\tTLRotationSnapshot,\n\tapplyRotationToSnapshotShapes,\n\tdegreesToRadians,\n\tgetRotationSnapshot,\n\tshortAngleDist,\n\tsnapAngle,\n} from '@tldraw/editor'\nimport { kickoutOccludedShapes } from '../selectHelpers'\nimport { CursorTypeMap } from './PointingResizeHandle'\n\nconst ONE_DEGREE = Math.PI / 180\n\nexport class Rotating extends StateNode {\n\tstatic override id = 'rotating'\n\n\tsnapshot = {} as TLRotationSnapshot\n\n\tinfo = {} as Extract<TLPointerEventInfo, { target: 'selection' }> & { onInteractionEnd?: string }\n\n\tmarkId = ''\n\n\toverride onEnter = (\n\t\tinfo: TLPointerEventInfo & { target: 'selection'; onInteractionEnd?: string }\n\t) => {\n\t\t// Store the event information\n\t\tthis.info = info\n\t\tthis.parent.setCurrentToolIdMask(info.onInteractionEnd)\n\n\t\tthis.markId = 'rotate start'\n\t\tthis.editor.mark(this.markId)\n\n\t\tconst snapshot = getRotationSnapshot({ editor: this.editor })\n\t\tif (!snapshot) return this.parent.transition('idle', this.info)\n\t\tthis.snapshot = snapshot\n\n\t\t// Trigger a pointer move\n\t\tconst newSelectionRotation = this._getRotationFromPointerPosition({\n\t\t\tsnapToNearestDegree: false,\n\t\t})\n\n\t\tapplyRotationToSnapshotShapes({\n\t\t\teditor: this.editor,\n\t\t\tdelta: this._getRotationFromPointerPosition({ snapToNearestDegree: false }),\n\t\t\tsnapshot: this.snapshot,\n\t\t\tstage: 'start',\n\t\t})\n\n\t\t// Update cursor\n\t\tthis.editor.updateInstanceState({\n\t\t\tcursor: {\n\t\t\t\ttype: CursorTypeMap[this.info.handle as RotateCorner],\n\t\t\t\trotation: newSelectionRotation + this.snapshot.initialSelectionRotation,\n\t\t\t},\n\t\t})\n\t}\n\n\toverride onExit = () => {\n\t\tthis.editor.setCursor({ type: 'default', rotation: 0 })\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\n\t\tthis.snapshot = {} as TLRotationSnapshot\n\t}\n\n\toverride onPointerMove = () => {\n\t\tthis.update()\n\t}\n\n\toverride onKeyDown = () => {\n\t\tthis.update()\n\t}\n\n\toverride onKeyUp = () => {\n\t\tthis.update()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel = () => {\n\t\tthis.cancel()\n\t}\n\n\t// ---\n\n\tprivate update = () => {\n\t\tconst newSelectionRotation = this._getRotationFromPointerPosition({\n\t\t\tsnapToNearestDegree: false,\n\t\t})\n\n\t\tapplyRotationToSnapshotShapes({\n\t\t\teditor: this.editor,\n\t\t\tdelta: newSelectionRotation,\n\t\t\tsnapshot: this.snapshot,\n\t\t\tstage: 'update',\n\t\t})\n\n\t\t// Update cursor\n\t\tthis.editor.updateInstanceState({\n\t\t\tcursor: {\n\t\t\t\ttype: CursorTypeMap[this.info.handle as RotateCorner],\n\t\t\t\trotation: newSelectionRotation + this.snapshot.initialSelectionRotation,\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate cancel = () => {\n\t\tthis.editor.bailToMark(this.markId)\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, this.info)\n\t\t} else {\n\t\t\tthis.parent.transition('idle', this.info)\n\t\t}\n\t}\n\n\tprivate complete = () => {\n\t\tapplyRotationToSnapshotShapes({\n\t\t\teditor: this.editor,\n\t\t\tdelta: this._getRotationFromPointerPosition({ snapToNearestDegree: true }),\n\t\t\tsnapshot: this.snapshot,\n\t\t\tstage: 'end',\n\t\t})\n\t\tkickoutOccludedShapes(\n\t\t\tthis.editor,\n\t\t\tthis.snapshot.shapeSnapshots.map((s) => s.shape.id)\n\t\t)\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, this.info)\n\t\t} else {\n\t\t\tthis.parent.transition('idle', this.info)\n\t\t}\n\t}\n\n\t_getRotationFromPointerPosition({ snapToNearestDegree }: { snapToNearestDegree: boolean }) {\n\t\tconst selectionRotation = this.editor.getSelectionRotation()\n\t\tconst selectionBounds = this.editor.getSelectionRotatedPageBounds()\n\t\tconst {\n\t\t\tinputs: { shiftKey, currentPagePoint },\n\t\t} = this.editor\n\t\tconst { initialCursorAngle, initialSelectionRotation } = this.snapshot\n\n\t\tif (!selectionBounds) return initialSelectionRotation\n\n\t\tconst selectionPageCenter = selectionBounds.center\n\t\t\t.clone()\n\t\t\t.rotWith(selectionBounds.point, selectionRotation)\n\n\t\t// The delta is the difference between the current angle and the initial angle\n\t\tconst preSnapRotationDelta = selectionPageCenter.angle(currentPagePoint) - initialCursorAngle\n\t\tlet newSelectionRotation = initialSelectionRotation + preSnapRotationDelta\n\n\t\tif (shiftKey) {\n\t\t\tnewSelectionRotation = snapAngle(newSelectionRotation, 24)\n\t\t} else if (snapToNearestDegree) {\n\t\t\tnewSelectionRotation = Math.round(newSelectionRotation / ONE_DEGREE) * ONE_DEGREE\n\n\t\t\tif (this.editor.getInstanceState().isCoarsePointer) {\n\t\t\t\tconst snappedToRightAngle = snapAngle(newSelectionRotation, 4)\n\t\t\t\tconst angleToRightAngle = shortAngleDist(newSelectionRotation, snappedToRightAngle)\n\t\t\t\tif (Math.abs(angleToRightAngle) < degreesToRadians(5)) {\n\t\t\t\t\tnewSelectionRotation = snappedToRightAngle\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn newSelectionRotation - initialSelectionRotation\n\t}\n}\n", "import {\n\tGeometry2d,\n\tStateNode,\n\tTLEventHandlers,\n\tTLFrameShape,\n\tTLGroupShape,\n\tTLShape,\n\tTLShapeId,\n\tVec,\n\tintersectLineSegmentPolygon,\n\tpointInPolygon,\n} from '@tldraw/editor'\n\nexport class ScribbleBrushing extends StateNode {\n\tstatic override id = 'scribble_brushing'\n\n\thits = new Set<TLShapeId>()\n\n\tsize = 0\n\n\tscribbleId = 'id'\n\n\tinitialSelectedShapeIds = new Set<TLShapeId>()\n\tnewlySelectedShapeIds = new Set<TLShapeId>()\n\n\toverride onEnter = () => {\n\t\tthis.initialSelectedShapeIds = new Set<TLShapeId>(\n\t\t\tthis.editor.inputs.shiftKey ? this.editor.getSelectedShapeIds() : []\n\t\t)\n\t\tthis.newlySelectedShapeIds = new Set<TLShapeId>()\n\t\tthis.size = 0\n\t\tthis.hits.clear()\n\n\t\tconst scribbleItem = this.editor.scribbles.addScribble({\n\t\t\tcolor: 'selection-stroke',\n\t\t\topacity: 0.32,\n\t\t\tsize: 12,\n\t\t})\n\n\t\tthis.scribbleId = scribbleItem.id\n\n\t\tthis.updateScribbleSelection(true)\n\n\t\tthis.editor.updateInstanceState({ brush: null })\n\t}\n\n\toverride onExit = () => {\n\t\tthis.editor.scribbles.stop(this.scribbleId)\n\t}\n\n\toverride onPointerMove = () => {\n\t\tthis.updateScribbleSelection(true)\n\t}\n\n\toverride onPointerUp = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onKeyDown = () => {\n\t\tthis.updateScribbleSelection(false)\n\t}\n\n\toverride onKeyUp = () => {\n\t\tif (!this.editor.inputs.altKey) {\n\t\t\tthis.parent.transition('brushing')\n\t\t} else {\n\t\t\tthis.updateScribbleSelection(false)\n\t\t}\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\tprivate pushPointToScribble = () => {\n\t\tconst { x, y } = this.editor.inputs.currentPagePoint\n\t\tthis.editor.scribbles.addPoint(this.scribbleId, x, y)\n\t}\n\n\tprivate updateScribbleSelection(addPoint: boolean) {\n\t\tconst { editor } = this\n\t\t// const zoomLevel = this.editor.getZoomLevel()\n\t\tconst currentPageShapes = this.editor.getCurrentPageShapes()\n\t\tconst {\n\t\t\tinputs: { shiftKey, originPagePoint, previousPagePoint, currentPagePoint },\n\t\t} = this.editor\n\n\t\tconst { newlySelectedShapeIds, initialSelectedShapeIds } = this\n\n\t\tif (addPoint) {\n\t\t\tthis.pushPointToScribble()\n\t\t}\n\n\t\tconst shapes = currentPageShapes\n\t\tlet shape: TLShape, geometry: Geometry2d, A: Vec, B: Vec\n\n\t\tconst minDist = 0 // HIT_TEST_MARGIN / zoomLevel\n\n\t\tfor (let i = 0, n = shapes.length; i < n; i++) {\n\t\t\tshape = shapes[i]\n\n\t\t\t// If the shape is a group or is already selected or locked, don't select it\n\t\t\tif (\n\t\t\t\teditor.isShapeOfType<TLGroupShape>(shape, 'group') ||\n\t\t\t\tnewlySelectedShapeIds.has(shape.id) ||\n\t\t\t\teditor.isShapeOrAncestorLocked(shape)\n\t\t\t) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tgeometry = editor.getShapeGeometry(shape)\n\n\t\t\t// If the scribble started inside of the frame, don't select it\n\t\t\tif (\n\t\t\t\teditor.isShapeOfType<TLFrameShape>(shape, 'frame') &&\n\t\t\t\tgeometry.bounds.containsPoint(editor.getPointInShapeSpace(shape, originPagePoint))\n\t\t\t) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// Hit test the shape using a line segment\n\t\t\tconst pageTransform = editor.getShapePageTransform(shape)\n\t\t\tif (!geometry || !pageTransform) continue\n\t\t\tconst pt = pageTransform.clone().invert()\n\t\t\tA = pt.applyToPoint(previousPagePoint)\n\t\t\tB = pt.applyToPoint(currentPagePoint)\n\n\t\t\t// If the line segment is entirely above / below / left / right of the shape's bounding box, skip the hit test\n\t\t\tconst { bounds } = geometry\n\t\t\tif (\n\t\t\t\tbounds.minX - minDist > Math.max(A.x, B.x) ||\n\t\t\t\tbounds.minY - minDist > Math.max(A.y, B.y) ||\n\t\t\t\tbounds.maxX + minDist < Math.min(A.x, B.x) ||\n\t\t\t\tbounds.maxY + minDist < Math.min(A.y, B.y)\n\t\t\t) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (geometry.hitTestLineSegment(A, B, minDist)) {\n\t\t\t\tconst outermostShape = this.editor.getOutermostSelectableShape(shape)\n\t\t\t\tconst pageMask = this.editor.getShapeMask(outermostShape.id)\n\t\t\t\tif (pageMask) {\n\t\t\t\t\tconst intersection = intersectLineSegmentPolygon(\n\t\t\t\t\t\tpreviousPagePoint,\n\t\t\t\t\t\tcurrentPagePoint,\n\t\t\t\t\t\tpageMask\n\t\t\t\t\t)\n\t\t\t\t\tif (intersection !== null) {\n\t\t\t\t\t\tconst isInMask = pointInPolygon(currentPagePoint, pageMask)\n\t\t\t\t\t\tif (!isInMask) continue\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnewlySelectedShapeIds.add(outermostShape.id)\n\t\t\t}\n\t\t}\n\n\t\tconst current = editor.getSelectedShapeIds()\n\t\tconst next = new Set<TLShapeId>(\n\t\t\tshiftKey ? [...newlySelectedShapeIds, ...initialSelectedShapeIds] : [...newlySelectedShapeIds]\n\t\t)\n\t\tif (current.length !== next.size || current.some((id) => !next.has(id))) {\n\t\t\tthis.editor.setSelectedShapes(Array.from(next), { squashing: true })\n\t\t}\n\t}\n\n\tprivate complete() {\n\t\tthis.updateScribbleSelection(true)\n\t\tthis.parent.transition('idle')\n\t}\n\n\tprivate cancel() {\n\t\tthis.editor.setSelectedShapes([...this.initialSelectedShapeIds], { squashing: true })\n\t\tthis.parent.transition('idle')\n\t}\n}\n", "import { Editor, TLShape, TLShapeId, Vec, compact } from '@tldraw/editor'\nimport { getOccludedChildren } from './selectHelpers'\n\nconst INITIAL_POINTER_LAG_DURATION = 20\nconst FAST_POINTER_LAG_DURATION = 100\n\n/** @public */\nexport class DragAndDropManager {\n\tconstructor(public editor: Editor) {\n\t\teditor.disposables.add(this.dispose)\n\t}\n\n\tprevDroppingShapeId: TLShapeId | null = null\n\n\tdroppingNodeTimer: ReturnType<typeof setTimeout> | null = null\n\n\tfirst = true\n\n\tupdateDroppingNode(movingShapes: TLShape[], cb: () => void) {\n\t\tif (this.first) {\n\t\t\tthis.editor.setHintingShapes(\n\t\t\t\tmovingShapes\n\t\t\t\t\t.map((s) => this.editor.findShapeAncestor(s, (v) => v.type !== 'group'))\n\t\t\t\t\t.filter((s) => s) as TLShape[]\n\t\t\t)\n\n\t\t\tthis.prevDroppingShapeId =\n\t\t\t\tthis.editor.getDroppingOverShape(this.editor.inputs.originPagePoint, movingShapes)?.id ??\n\t\t\t\tnull\n\t\t\tthis.first = false\n\t\t}\n\n\t\tif (this.droppingNodeTimer === null) {\n\t\t\tthis.setDragTimer(movingShapes, INITIAL_POINTER_LAG_DURATION, cb)\n\t\t} else if (this.editor.inputs.pointerVelocity.len() > 0.5) {\n\t\t\tclearInterval(this.droppingNodeTimer)\n\t\t\tthis.setDragTimer(movingShapes, FAST_POINTER_LAG_DURATION, cb)\n\t\t}\n\t}\n\n\tprivate setDragTimer(movingShapes: TLShape[], duration: number, cb: () => void) {\n\t\tthis.droppingNodeTimer = setTimeout(() => {\n\t\t\tthis.editor.batch(() => {\n\t\t\t\tthis.handleDrag(this.editor.inputs.currentPagePoint, movingShapes, cb)\n\t\t\t})\n\t\t\tthis.droppingNodeTimer = null\n\t\t}, duration)\n\t}\n\n\tprivate handleDrag(point: Vec, movingShapes: TLShape[], cb?: () => void) {\n\t\tmovingShapes = compact(movingShapes.map((shape) => this.editor.getShape(shape.id)))\n\n\t\tconst nextDroppingShapeId = this.editor.getDroppingOverShape(point, movingShapes)?.id ?? null\n\n\t\t// is the next dropping shape id different than the last one?\n\t\tif (nextDroppingShapeId === this.prevDroppingShapeId) {\n\t\t\tthis.hintParents(movingShapes)\n\t\t\treturn\n\t\t}\n\n\t\t// the old previous one\n\t\tconst { prevDroppingShapeId } = this\n\n\t\tconst prevDroppingShape = prevDroppingShapeId && this.editor.getShape(prevDroppingShapeId)\n\t\tconst nextDroppingShape = nextDroppingShapeId && this.editor.getShape(nextDroppingShapeId)\n\n\t\t// Even if we don't have a next dropping shape id (i.e. if we're dropping\n\t\t// onto the page) set the prev to the current, to avoid repeat calls to\n\t\t// the previous parent's onDragShapesOut\n\n\t\tif (prevDroppingShape) {\n\t\t\tthis.editor.getShapeUtil(prevDroppingShape).onDragShapesOut?.(prevDroppingShape, movingShapes)\n\t\t}\n\n\t\tif (nextDroppingShape) {\n\t\t\tthis.editor\n\t\t\t\t.getShapeUtil(nextDroppingShape)\n\t\t\t\t.onDragShapesOver?.(nextDroppingShape, movingShapes)\n\t\t}\n\n\t\tthis.hintParents(movingShapes)\n\t\tcb?.()\n\n\t\t// next -> curr\n\t\tthis.prevDroppingShapeId = nextDroppingShapeId\n\t}\n\n\thintParents(movingShapes: TLShape[]) {\n\t\t// Group moving shapes by their ancestor\n\t\tconst shapesGroupedByAncestor = new Map<TLShapeId, TLShapeId[]>()\n\t\tfor (const shape of movingShapes) {\n\t\t\tconst ancestor = this.editor.findShapeAncestor(shape, (v) => v.type !== 'group')\n\t\t\tif (!ancestor) continue\n\t\t\tif (!shapesGroupedByAncestor.has(ancestor.id)) {\n\t\t\t\tshapesGroupedByAncestor.set(ancestor.id, [])\n\t\t\t}\n\t\t\tshapesGroupedByAncestor.get(ancestor.id)!.push(shape.id)\n\t\t}\n\n\t\t// Only hint an ancestor if some shapes will drop into it on pointer up\n\t\tconst hintingShapes = []\n\t\tfor (const [ancestorId, shapeIds] of shapesGroupedByAncestor) {\n\t\t\tconst ancestor = this.editor.getShape(ancestorId)\n\t\t\tif (!ancestor) continue\n\t\t\t// If all of the ancestor's children would be occluded, then don't hint it\n\t\t\t// 1. get the number of fully occluded children\n\t\t\t// 2. if that number is less than the number of moving shapes, hint the ancestor\n\t\t\tif (getOccludedChildren(this.editor, ancestor).length < shapeIds.length) {\n\t\t\t\thintingShapes.push(ancestor.id)\n\t\t\t}\n\t\t}\n\n\t\tthis.editor.setHintingShapes(hintingShapes)\n\t}\n\n\tdropShapes(shapes: TLShape[]) {\n\t\tconst { prevDroppingShapeId } = this\n\n\t\tthis.handleDrag(this.editor.inputs.currentPagePoint, shapes)\n\n\t\tif (prevDroppingShapeId) {\n\t\t\tconst shape = this.editor.getShape(prevDroppingShapeId)\n\t\t\tif (!shape) return\n\t\t\tthis.editor.getShapeUtil(shape).onDropShapesOver?.(shape, shapes)\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis.prevDroppingShapeId = null\n\n\t\tif (this.droppingNodeTimer !== null) {\n\t\t\tclearInterval(this.droppingNodeTimer)\n\t\t}\n\n\t\tthis.droppingNodeTimer = null\n\t\tthis.editor.setHintingShapes([])\n\t\tthis.first = true\n\t}\n\n\tdispose = () => {\n\t\tthis.clear()\n\t}\n}\n", "import {\n\tBoundsSnapPoint,\n\tEditor,\n\tMat,\n\tMatModel,\n\tPageRecordType,\n\tStateNode,\n\tTLEventHandlers,\n\tTLNoteShape,\n\tTLPointerEventInfo,\n\tTLShape,\n\tTLShapePartial,\n\tVec,\n\tcompact,\n\tisPageId,\n\tmoveCameraWhenCloseToEdge,\n} from '@tldraw/editor'\nimport {\n\tNOTE_PIT_RADIUS,\n\tNOTE_SIZE,\n\tgetAvailableNoteAdjacentPositions,\n} from '../../../shapes/note/noteHelpers'\nimport { DragAndDropManager } from '../DragAndDropManager'\nimport { kickoutOccludedShapes } from '../selectHelpers'\n\nexport class Translating extends StateNode {\n\tstatic override id = 'translating'\n\n\tinfo = {} as TLPointerEventInfo & {\n\t\ttarget: 'shape'\n\t\tisCreating?: boolean\n\t\tonCreate?: () => void\n\t\tdidStartInPit?: boolean\n\t\tonInteractionEnd?: string\n\t}\n\n\tselectionSnapshot: TranslatingSnapshot = {} as any\n\n\tsnapshot: TranslatingSnapshot = {} as any\n\n\tmarkId = ''\n\n\tisCloning = false\n\tisCreating = false\n\tonCreate: (shape: TLShape | null) => void = () => void null\n\n\tdragAndDropManager = new DragAndDropManager(this.editor)\n\n\toverride onEnter = (\n\t\tinfo: TLPointerEventInfo & {\n\t\t\ttarget: 'shape'\n\t\t\tisCreating?: boolean\n\t\t\tonCreate?: () => void\n\t\t\tonInteractionEnd?: string\n\t\t}\n\t) => {\n\t\tconst { isCreating = false, onCreate = () => void null } = info\n\n\t\tthis.info = info\n\t\tthis.parent.setCurrentToolIdMask(info.onInteractionEnd)\n\t\tthis.isCreating = isCreating\n\t\tthis.onCreate = onCreate\n\n\t\tif (isCreating) {\n\t\t\tthis.markId = `creating:${this.editor.getOnlySelectedShape()!.id}`\n\t\t} else {\n\t\t\tthis.markId = 'translating'\n\t\t\tthis.editor.mark(this.markId)\n\t\t}\n\n\t\tthis.isCloning = false\n\t\tthis.info = info\n\n\t\tthis.editor.setCursor({ type: 'move', rotation: 0 })\n\t\tthis.selectionSnapshot = getTranslatingSnapshot(this.editor)\n\n\t\t// Don't clone on create; otherwise clone on altKey\n\t\tif (!this.isCreating) {\n\t\t\tif (this.editor.inputs.altKey) {\n\t\t\t\tthis.startCloning()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\tthis.snapshot = this.selectionSnapshot\n\t\tthis.handleStart()\n\t\tthis.updateShapes()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\t\tthis.selectionSnapshot = {} as any\n\t\tthis.snapshot = {} as any\n\t\tthis.editor.snaps.clearIndicators()\n\t\tthis.editor.setCursor({ type: 'default', rotation: 0 })\n\t\tthis.dragAndDropManager.clear()\n\t}\n\n\toverride onTick = () => {\n\t\tthis.dragAndDropManager.updateDroppingNode(\n\t\t\tthis.snapshot.movingShapes,\n\t\t\tthis.updateParentTransforms\n\t\t)\n\t\tmoveCameraWhenCloseToEdge(this.editor)\n\t}\n\n\toverride onPointerMove = () => {\n\t\tthis.updateShapes()\n\t}\n\n\toverride onKeyDown = () => {\n\t\tif (this.editor.inputs.altKey && !this.isCloning) {\n\t\t\tthis.startCloning()\n\t\t\treturn\n\t\t}\n\n\t\t// need to update in case user pressed a different modifier key\n\t\tthis.updateShapes()\n\t}\n\n\toverride onKeyUp: TLEventHandlers['onKeyUp'] = () => {\n\t\tif (!this.editor.inputs.altKey && this.isCloning) {\n\t\t\tthis.stopCloning()\n\t\t\treturn\n\t\t}\n\n\t\t// need to update in case user pressed a different modifier key\n\t\tthis.updateShapes()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onComplete: TLEventHandlers['onComplete'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tprotected startCloning() {\n\t\tif (this.isCreating) return\n\n\t\tthis.isCloning = true\n\t\tthis.reset()\n\t\tthis.markId = 'translating'\n\t\tthis.editor.mark(this.markId)\n\n\t\tthis.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds()))\n\n\t\tthis.snapshot = getTranslatingSnapshot(this.editor)\n\t\tthis.handleStart()\n\t\tthis.updateShapes()\n\t}\n\n\tprotected stopCloning() {\n\t\tthis.isCloning = false\n\t\tthis.snapshot = this.selectionSnapshot\n\t\tthis.reset()\n\t\tthis.markId = 'translating'\n\t\tthis.editor.mark(this.markId)\n\t\tthis.updateShapes()\n\t}\n\n\treset() {\n\t\tthis.editor.bailToMark(this.markId)\n\t}\n\n\tprotected complete() {\n\t\tthis.updateShapes()\n\t\tthis.dragAndDropManager.dropShapes(this.snapshot.movingShapes)\n\t\tkickoutOccludedShapes(\n\t\t\tthis.editor,\n\t\t\tthis.snapshot.movingShapes.map((s) => s.id)\n\t\t)\n\t\tthis.handleEnd()\n\n\t\tif (this.editor.getInstanceState().isToolLocked && this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd)\n\t\t} else {\n\t\t\tif (this.isCreating) {\n\t\t\t\tthis.onCreate?.(this.editor.getOnlySelectedShape())\n\t\t\t} else {\n\t\t\t\tthis.parent.transition('idle')\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate cancel() {\n\t\tthis.reset()\n\t\tif (this.info.onInteractionEnd) {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd)\n\t\t} else {\n\t\t\tthis.parent.transition('idle', this.info)\n\t\t}\n\t}\n\n\tprotected handleStart() {\n\t\tconst { movingShapes } = this.snapshot\n\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tmovingShapes.forEach((shape) => {\n\t\t\tconst util = this.editor.getShapeUtil(shape)\n\t\t\tconst change = util.onTranslateStart?.(shape)\n\t\t\tif (change) {\n\t\t\t\tchanges.push(change)\n\t\t\t}\n\t\t})\n\n\t\tif (changes.length > 0) {\n\t\t\tthis.editor.updateShapes(changes)\n\t\t}\n\n\t\tthis.editor.setHoveredShape(null)\n\t}\n\n\tprotected handleEnd() {\n\t\tconst { movingShapes } = this.snapshot\n\n\t\tif (this.isCloning && movingShapes.length > 0) {\n\t\t\tconst currentAveragePagePoint = Vec.Average(\n\t\t\t\tmovingShapes.map((s) => this.editor.getShapePageTransform(s.id)!.point())\n\t\t\t)\n\t\t\tconst offset = Vec.Sub(currentAveragePagePoint, this.selectionSnapshot.averagePagePoint)\n\t\t\tif (!Vec.IsNaN(offset)) {\n\t\t\t\tthis.editor.updateInstanceState({\n\t\t\t\t\tduplicateProps: {\n\t\t\t\t\t\tshapeIds: movingShapes.map((s) => s.id),\n\t\t\t\t\t\toffset: { x: offset.x, y: offset.y },\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tmovingShapes.forEach((shape) => {\n\t\t\tconst current = this.editor.getShape(shape.id)!\n\t\t\tconst util = this.editor.getShapeUtil(shape)\n\t\t\tconst change = util.onTranslateEnd?.(shape, current)\n\t\t\tif (change) {\n\t\t\t\tchanges.push(change)\n\t\t\t}\n\t\t})\n\n\t\tif (changes.length > 0) {\n\t\t\tthis.editor.updateShapes(changes)\n\t\t}\n\t}\n\n\tprotected handleChange() {\n\t\tconst { movingShapes } = this.snapshot\n\n\t\tconst changes: TLShapePartial[] = []\n\n\t\tmovingShapes.forEach((shape) => {\n\t\t\tconst current = this.editor.getShape(shape.id)!\n\t\t\tconst util = this.editor.getShapeUtil(shape)\n\t\t\tconst change = util.onTranslate?.(shape, current)\n\t\t\tif (change) {\n\t\t\t\tchanges.push(change)\n\t\t\t}\n\t\t})\n\n\t\tif (changes.length > 0) {\n\t\t\tthis.editor.updateShapes(changes)\n\t\t}\n\t}\n\n\tprotected updateShapes() {\n\t\tconst { snapshot } = this\n\t\tthis.dragAndDropManager.updateDroppingNode(snapshot.movingShapes, this.updateParentTransforms)\n\n\t\tmoveShapesToPoint({\n\t\t\teditor: this.editor,\n\t\t\tsnapshot,\n\t\t})\n\n\t\tthis.handleChange()\n\t}\n\n\tprotected updateParentTransforms = () => {\n\t\tconst {\n\t\t\teditor,\n\t\t\tsnapshot: { shapeSnapshots },\n\t\t} = this\n\t\tconst movingShapes: TLShape[] = []\n\n\t\tshapeSnapshots.forEach((shapeSnapshot) => {\n\t\t\tconst shape = editor.getShape(shapeSnapshot.shape.id)\n\t\t\tif (!shape) return null\n\t\t\tmovingShapes.push(shape)\n\n\t\t\tconst parentTransform = isPageId(shape.parentId)\n\t\t\t\t? null\n\t\t\t\t: Mat.Inverse(editor.getShapePageTransform(shape.parentId)!)\n\n\t\t\tshapeSnapshot.parentTransform = parentTransform\n\t\t})\n\t}\n}\n\nfunction getTranslatingSnapshot(editor: Editor) {\n\tconst movingShapes: TLShape[] = []\n\tconst pagePoints: Vec[] = []\n\n\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\tconst shapeSnapshots = compact(\n\t\tselectedShapeIds.map((id): null | MovingShapeSnapshot => {\n\t\t\tconst shape = editor.getShape(id)\n\t\t\tif (!shape) return null\n\t\t\tmovingShapes.push(shape)\n\n\t\t\tconst pageTransform = editor.getShapePageTransform(id)\n\t\t\tconst pagePoint = pageTransform.point()\n\t\t\tconst pageRotation = pageTransform.rotation()\n\n\t\t\tpagePoints.push(pagePoint)\n\n\t\t\tconst parentTransform = PageRecordType.isId(shape.parentId)\n\t\t\t\t? null\n\t\t\t\t: Mat.Inverse(editor.getShapePageTransform(shape.parentId)!)\n\n\t\t\treturn {\n\t\t\t\tshape,\n\t\t\t\tpagePoint,\n\t\t\t\tpageRotation,\n\t\t\t\tparentTransform,\n\t\t\t}\n\t\t})\n\t)\n\n\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\n\tlet initialSnapPoints: BoundsSnapPoint[] = []\n\n\tif (onlySelectedShape) {\n\t\tinitialSnapPoints = editor.snaps.shapeBounds.getSnapPoints(onlySelectedShape.id)!\n\t} else {\n\t\tconst selectionPageBounds = editor.getSelectionPageBounds()\n\t\tif (selectionPageBounds) {\n\t\t\tinitialSnapPoints = selectionPageBounds.cornersAndCenter.map((p, i) => ({\n\t\t\t\tid: 'selection:' + i,\n\t\t\t\tx: p.x,\n\t\t\t\ty: p.y,\n\t\t\t}))\n\t\t}\n\t}\n\n\tlet noteAdjacentPositions: Vec[] | undefined\n\tlet noteSnapshot: MovingShapeSnapshot | undefined\n\n\tconst { originPagePoint } = editor.inputs\n\n\tconst allHoveredNotes = shapeSnapshots.filter(\n\t\t(s) =>\n\t\t\teditor.isShapeOfType<TLNoteShape>(s.shape, 'note') &&\n\t\t\teditor.isPointInShape(s.shape, originPagePoint)\n\t)\n\n\tif (allHoveredNotes.length === 0) {\n\t\t// noop\n\t} else if (allHoveredNotes.length === 1) {\n\t\t// just one, easy\n\t\tnoteSnapshot = allHoveredNotes[0]\n\t} else {\n\t\t// More than one under the cursor, so we need to find the highest shape in z-order\n\t\tconst allShapesSorted = editor.getCurrentPageShapesSorted()\n\t\tnoteSnapshot = allHoveredNotes\n\t\t\t.map((s) => ({\n\t\t\t\tsnapshot: s,\n\t\t\t\tindex: allShapesSorted.findIndex((shape) => shape.id === s.shape.id),\n\t\t\t}))\n\t\t\t.sort((a, b) => b.index - a.index)[0]?.snapshot // highest up first\n\t}\n\n\tif (noteSnapshot) {\n\t\tnoteAdjacentPositions = getAvailableNoteAdjacentPositions(\n\t\t\teditor,\n\t\t\tnoteSnapshot.pageRotation,\n\t\t\t(noteSnapshot.shape as TLNoteShape).props.growY ?? 0\n\t\t)\n\t}\n\n\treturn {\n\t\taveragePagePoint: Vec.Average(pagePoints),\n\t\tmovingShapes,\n\t\tshapeSnapshots,\n\t\tinitialPageBounds: editor.getSelectionPageBounds()!,\n\t\tinitialSnapPoints,\n\t\tnoteAdjacentPositions,\n\t\tnoteSnapshot,\n\t}\n}\n\nexport type TranslatingSnapshot = ReturnType<typeof getTranslatingSnapshot>\n\nexport interface MovingShapeSnapshot {\n\tshape: TLShape\n\tpagePoint: Vec\n\tpageRotation: number\n\tparentTransform: MatModel | null\n}\n\nexport function moveShapesToPoint({\n\teditor,\n\tsnapshot,\n}: {\n\teditor: Editor\n\tsnapshot: TranslatingSnapshot\n}) {\n\tconst { inputs } = editor\n\n\tconst {\n\t\tnoteSnapshot,\n\t\tnoteAdjacentPositions,\n\t\tinitialPageBounds,\n\t\tinitialSnapPoints,\n\t\tshapeSnapshots,\n\t\taveragePagePoint,\n\t} = snapshot\n\n\tconst isGridMode = editor.getInstanceState().isGridMode\n\n\tconst gridSize = editor.getDocumentSettings().gridSize\n\n\tconst delta = Vec.Sub(inputs.currentPagePoint, inputs.originPagePoint)\n\n\tconst flatten: 'x' | 'y' | null = editor.inputs.shiftKey\n\t\t? Math.abs(delta.x) < Math.abs(delta.y)\n\t\t\t? 'x'\n\t\t\t: 'y'\n\t\t: null\n\n\tif (flatten === 'x') {\n\t\tdelta.x = 0\n\t} else if (flatten === 'y') {\n\t\tdelta.y = 0\n\t}\n\n\t// Provisional snapping\n\teditor.snaps.clearIndicators()\n\n\t// If the user isn't moving super quick\n\tconst isSnapping = editor.user.getIsSnapMode() ? !inputs.ctrlKey : inputs.ctrlKey\n\tif (isSnapping && editor.inputs.pointerVelocity.len() < 0.5) {\n\t\t// snapping\n\t\tconst { nudge } = editor.snaps.shapeBounds.snapTranslateShapes({\n\t\t\tdragDelta: delta,\n\t\t\tinitialSelectionPageBounds: initialPageBounds,\n\t\t\tlockedAxis: flatten,\n\t\t\tinitialSelectionSnapPoints: initialSnapPoints,\n\t\t})\n\n\t\tdelta.add(nudge)\n\t} else {\n\t\t// for sticky notes, snap to grid position next to other notes\n\t\tif (noteSnapshot && noteAdjacentPositions) {\n\t\t\tlet min = NOTE_PIT_RADIUS / editor.getZoomLevel() // in screen space\n\t\t\tlet offset = new Vec(0, 0)\n\n\t\t\tconst pageCenter = Vec.Add(\n\t\t\t\tVec.Add(noteSnapshot.pagePoint, delta),\n\t\t\t\tnew Vec(NOTE_SIZE / 2, NOTE_SIZE / 2).rot(noteSnapshot.pageRotation)\n\t\t\t)\n\n\t\t\tfor (const pit of noteAdjacentPositions) {\n\t\t\t\t// We've already filtered pits with the same page rotation\n\t\t\t\tconst deltaToPit = Vec.Sub(pageCenter, pit)\n\t\t\t\tconst dist = deltaToPit.len()\n\t\t\t\tif (dist < min) {\n\t\t\t\t\tmin = dist\n\t\t\t\t\toffset = deltaToPit\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdelta.sub(offset)\n\t\t}\n\t}\n\n\tconst averageSnappedPoint = Vec.Add(averagePagePoint, delta)\n\n\tif (isGridMode && !inputs.ctrlKey) {\n\t\taverageSnappedPoint.snapToGrid(gridSize)\n\t}\n\n\tconst averageSnap = Vec.Sub(averageSnappedPoint, averagePagePoint)\n\n\teditor.updateShapes(\n\t\tcompact(\n\t\t\tshapeSnapshots.map(({ shape, pagePoint, parentTransform }): TLShapePartial | null => {\n\t\t\t\tconst newPagePoint = Vec.Add(pagePoint, averageSnap)\n\n\t\t\t\tconst newLocalPoint = parentTransform\n\t\t\t\t\t? Mat.applyToPoint(parentTransform, newPagePoint)\n\t\t\t\t\t: newPagePoint\n\n\t\t\t\treturn {\n\t\t\t\t\tid: shape.id,\n\t\t\t\t\ttype: shape.type,\n\t\t\t\t\tx: newLocalPoint.x,\n\t\t\t\t\ty: newLocalPoint.y,\n\t\t\t\t}\n\t\t\t})\n\t\t),\n\t\t{ squashing: true }\n\t)\n}\n", "import { StateNode, react } from '@tldraw/editor'\nimport { Brushing } from './childStates/Brushing'\nimport { Crop } from './childStates/Crop/Crop'\nimport { Cropping } from './childStates/Cropping'\nimport { DraggingHandle } from './childStates/DraggingHandle'\nimport { EditingShape } from './childStates/EditingShape'\nimport { Idle } from './childStates/Idle'\nimport { PointingArrowLabel } from './childStates/PointingArrowLabel'\nimport { PointingCanvas } from './childStates/PointingCanvas'\nimport { PointingCropHandle } from './childStates/PointingCropHandle'\nimport { PointingHandle } from './childStates/PointingHandle'\nimport { PointingResizeHandle } from './childStates/PointingResizeHandle'\nimport { PointingRotateHandle } from './childStates/PointingRotateHandle'\nimport { PointingSelection } from './childStates/PointingSelection'\nimport { PointingShape } from './childStates/PointingShape'\nimport { Resizing } from './childStates/Resizing'\nimport { Rotating } from './childStates/Rotating'\nimport { ScribbleBrushing } from './childStates/ScribbleBrushing'\nimport { Translating } from './childStates/Translating'\n\n/** @public */\nexport class SelectTool extends StateNode {\n\tstatic override id = 'select'\n\tstatic override initial = 'idle'\n\treactor: undefined | (() => void) = undefined\n\n\tstatic override children = () => [\n\t\tCrop,\n\t\tCropping,\n\t\tIdle,\n\t\tPointingCanvas,\n\t\tPointingShape,\n\t\tTranslating,\n\t\tBrushing,\n\t\tScribbleBrushing,\n\t\tPointingCropHandle,\n\t\tPointingSelection,\n\t\tPointingResizeHandle,\n\t\tEditingShape,\n\t\tResizing,\n\t\tRotating,\n\t\tPointingRotateHandle,\n\t\tPointingArrowLabel,\n\t\tPointingHandle,\n\t\tDraggingHandle,\n\t]\n\n\t// We want to clean up the duplicate props when the selection changes\n\tprivate cleanUpDuplicateProps = () => {\n\t\tconst selectedShapeIds = this.editor.getSelectedShapeIds()\n\t\tconst instance = this.editor.getInstanceState()\n\t\tif (!instance.duplicateProps) return\n\t\tconst duplicatedShapes = new Set(instance.duplicateProps.shapeIds)\n\t\tif (\n\t\t\tselectedShapeIds.length === duplicatedShapes.size &&\n\t\t\tselectedShapeIds.every((shapeId) => duplicatedShapes.has(shapeId))\n\t\t) {\n\t\t\treturn\n\t\t}\n\t\tthis.editor.updateInstanceState({\n\t\t\tduplicateProps: null,\n\t\t})\n\t}\n\n\toverride onEnter = () => {\n\t\tthis.reactor = react('clean duplicate props', () => {\n\t\t\ttry {\n\t\t\t\tthis.cleanUpDuplicateProps()\n\t\t\t} catch (e) {\n\t\t\t\tif (typeof process !== 'undefined' && process.env.NODE_ENV === 'test') {\n\t\t\t\t\t// ignore errors at test time\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(e)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\toverride onExit = () => {\n\t\tthis.reactor?.()\n\t\tif (this.editor.getCurrentPageState().editingShapeId) {\n\t\t\tthis.editor.setEditingShape(null)\n\t\t}\n\t}\n}\n", "import { StateNode, TLEventHandlers, TLPointerEventInfo } from '@tldraw/editor'\n\nexport class Idle extends StateNode {\n\tstatic override id = 'idle'\n\n\tinfo = {} as TLPointerEventInfo & { onInteractionEnd?: string }\n\n\toverride onEnter = (info: TLPointerEventInfo & { onInteractionEnd: string }) => {\n\t\tthis.info = info\n\t}\n\n\toverride onPointerDown: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.parent.transition('pointing', this.info)\n\t}\n}\n", "import { StateNode, TLEventHandlers, TLPointerEventInfo } from '@tldraw/editor'\n\nexport class Pointing extends StateNode {\n\tstatic override id = 'pointing'\n\n\tinfo = {} as TLPointerEventInfo & { onInteractionEnd?: string }\n\n\toverride onEnter = (info: TLPointerEventInfo & { onInteractionEnd: string }) => {\n\t\tthis.info = info\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onPointerMove: TLEventHandlers['onPointerUp'] = () => {\n\t\tif (this.editor.inputs.isDragging) {\n\t\t\tthis.parent.transition('zoom_brushing', this.info)\n\t\t}\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate complete() {\n\t\tconst { currentScreenPoint } = this.editor.inputs\n\t\tif (this.editor.inputs.altKey) {\n\t\t\tthis.editor.zoomOut(currentScreenPoint, { duration: 220 })\n\t\t} else {\n\t\t\tthis.editor.zoomIn(currentScreenPoint, { duration: 220 })\n\t\t}\n\t\tthis.parent.transition('idle', this.info)\n\t}\n\n\tprivate cancel() {\n\t\tthis.parent.transition('idle', this.info)\n\t}\n}\n", "import { Box, StateNode, TLEventHandlers, TLPointerEventInfo } from '@tldraw/editor'\n\nexport class ZoomBrushing extends StateNode {\n\tstatic override id = 'zoom_brushing'\n\n\tinfo = {} as TLPointerEventInfo & { onInteractionEnd?: string }\n\n\tzoomBrush = new Box()\n\n\toverride onEnter = (info: TLPointerEventInfo & { onInteractionEnd: string }) => {\n\t\tthis.info = info\n\t\tthis.update()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.editor.updateInstanceState({ zoomBrush: null })\n\t}\n\n\toverride onPointerMove = () => {\n\t\tthis.update()\n\t}\n\n\toverride onPointerUp: TLEventHandlers['onPointerUp'] = () => {\n\t\tthis.complete()\n\t}\n\n\toverride onCancel: TLEventHandlers['onCancel'] = () => {\n\t\tthis.cancel()\n\t}\n\n\tprivate update() {\n\t\tconst {\n\t\t\tinputs: { originPagePoint, currentPagePoint },\n\t\t} = this.editor\n\n\t\tthis.zoomBrush.setTo(Box.FromPoints([originPagePoint, currentPagePoint]))\n\t\tthis.editor.updateInstanceState({ zoomBrush: this.zoomBrush.toJson() })\n\t}\n\n\tprivate cancel() {\n\t\tthis.parent.transition('idle', this.info)\n\t}\n\n\tprivate complete() {\n\t\tconst { zoomBrush } = this\n\t\tconst threshold = 8 / this.editor.getZoomLevel()\n\t\t// If the selected area is small then treat it as a click\n\t\tif (zoomBrush.width < threshold && zoomBrush.height < threshold) {\n\t\t\tconst point = this.editor.inputs.currentScreenPoint\n\t\t\tif (this.editor.inputs.altKey) {\n\t\t\t\tthis.editor.zoomOut(point, { duration: 220 })\n\t\t\t} else {\n\t\t\t\tthis.editor.zoomIn(point, { duration: 220 })\n\t\t\t}\n\t\t} else {\n\t\t\tconst targetZoom = this.editor.inputs.altKey ? this.editor.getZoomLevel() / 2 : undefined\n\t\t\tthis.editor.zoomToBounds(zoomBrush, { targetZoom, duration: 220 })\n\t\t}\n\n\t\tthis.parent.transition('idle', this.info)\n\t}\n}\n", "import { StateNode, TLInterruptEvent, TLKeyboardEvent, TLPointerEventInfo } from '@tldraw/editor'\nimport { Idle } from './childStates/Idle'\nimport { Pointing } from './childStates/Pointing'\nimport { ZoomBrushing } from './childStates/ZoomBrushing'\n\n/** @public */\nexport class ZoomTool extends StateNode {\n\tstatic override id = 'zoom'\n\tstatic override initial = 'idle'\n\tstatic override children = () => [Idle, ZoomBrushing, Pointing]\n\n\tinfo = {} as TLPointerEventInfo & { onInteractionEnd?: string }\n\n\toverride onEnter = (info: TLPointerEventInfo & { onInteractionEnd: string }) => {\n\t\tthis.info = info\n\t\tthis.parent.setCurrentToolIdMask(info.onInteractionEnd)\n\t\tthis.updateCursor()\n\t}\n\n\toverride onExit = () => {\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\t\tthis.editor.updateInstanceState(\n\t\t\t{ zoomBrush: null, cursor: { type: 'default', rotation: 0 } },\n\t\t\t{ ephemeral: true }\n\t\t)\n\t\tthis.parent.setCurrentToolIdMask(undefined)\n\t}\n\n\toverride onKeyDown: TLKeyboardEvent | undefined = () => {\n\t\tthis.updateCursor()\n\t}\n\n\toverride onKeyUp: TLKeyboardEvent = (info) => {\n\t\tthis.updateCursor()\n\n\t\tif (info.code === 'KeyZ') {\n\t\t\tthis.complete()\n\t\t}\n\t}\n\n\toverride onInterrupt: TLInterruptEvent = () => {\n\t\tthis.complete()\n\t}\n\n\tprivate complete() {\n\t\t// Go back to the previous tool. If we are already in select we want to transition to idle\n\t\tif (this.info.onInteractionEnd && this.info.onInteractionEnd !== 'select') {\n\t\t\tthis.editor.setCurrentTool(this.info.onInteractionEnd, this.info)\n\t\t} else {\n\t\t\tthis.parent.transition('select')\n\t\t}\n\t}\n\n\tprivate updateCursor() {\n\t\tif (this.editor.inputs.altKey) {\n\t\t\tthis.editor.updateInstanceState(\n\t\t\t\t{ cursor: { type: 'zoom-out', rotation: 0 } },\n\t\t\t\t{ ephemeral: true }\n\t\t\t)\n\t\t} else {\n\t\t\tthis.editor.updateInstanceState(\n\t\t\t\t{ cursor: { type: 'zoom-in', rotation: 0 } },\n\t\t\t\t{ ephemeral: true }\n\t\t\t)\n\t\t}\n\t}\n}\n", "import { EraserTool } from './tools/EraserTool/EraserTool'\nimport { HandTool } from './tools/HandTool/HandTool'\nimport { LaserTool } from './tools/LaserTool/LaserTool'\nimport { SelectTool } from './tools/SelectTool/SelectTool'\nimport { ZoomTool } from './tools/ZoomTool/ZoomTool'\n\n/** @public */\nexport const defaultTools = [EraserTool, HandTool, LaserTool, ZoomTool, SelectTool]\n", "import { ToastProvider } from '@radix-ui/react-toast'\nimport { Expand, useEditor, useValue } from '@tldraw/editor'\nimport classNames from 'classnames'\nimport React, { ReactNode } from 'react'\nimport { TLUiAssetUrlOverrides } from './assetUrls'\nimport { Dialogs } from './components/Dialogs'\nimport { FollowingIndicator } from './components/FollowingIndicator'\nimport { ToastViewport, Toasts } from './components/Toasts'\nimport { TldrawUiButton } from './components/primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from './components/primitives/Button/TldrawUiButtonIcon'\nimport { PORTRAIT_BREAKPOINT } from './constants'\nimport {\n\tTldrawUiContextProvider,\n\tTldrawUiContextProviderProps,\n} from './context/TldrawUiContextProvider'\nimport { useActions } from './context/actions'\nimport { useBreakpoint } from './context/breakpoints'\nimport { TLUiComponents, useTldrawUiComponents } from './context/components'\nimport { useNativeClipboardEvents } from './hooks/useClipboardEvents'\nimport { useEditorEvents } from './hooks/useEditorEvents'\nimport { useKeyboardShortcuts } from './hooks/useKeyboardShortcuts'\nimport { useReadonly } from './hooks/useReadonly'\nimport { useTranslation } from './hooks/useTranslation/useTranslation'\n\n/**\n * Base props for the {@link tldraw#Tldraw} and {@link TldrawUi} components.\n *\n * @public\n */\nexport interface TldrawUiBaseProps {\n\t/**\n\t * The component's children.\n\t */\n\tchildren?: ReactNode\n\n\t/**\n\t * Whether to hide the user interface and only display the canvas.\n\t */\n\thideUi?: boolean\n\n\t/**\n\t * Overrides for the UI components.\n\t */\n\tcomponents?: TLUiComponents\n\n\t/**\n\t * Additional items to add to the debug menu (will be deprecated)\n\t */\n\trenderDebugMenuItems?: () => React.ReactNode\n\n\t/** Asset URL override. */\n\tassetUrls?: TLUiAssetUrlOverrides\n}\n\n/**\n * Props for the {@link tldraw#Tldraw} and {@link TldrawUi} components.\n *\n * @public\n */\nexport type TldrawUiProps = Expand<TldrawUiBaseProps & TldrawUiContextProviderProps>\n\n/**\n * @public\n */\nexport const TldrawUi = React.memo(function TldrawUi({\n\trenderDebugMenuItems,\n\tchildren,\n\thideUi,\n\tcomponents,\n\t...rest\n}: TldrawUiProps) {\n\treturn (\n\t\t<TldrawUiContextProvider {...rest} components={components}>\n\t\t\t<TldrawUiInner hideUi={hideUi} renderDebugMenuItems={renderDebugMenuItems}>\n\t\t\t\t{children}\n\t\t\t</TldrawUiInner>\n\t\t</TldrawUiContextProvider>\n\t)\n})\n\ntype TldrawUiContentProps = {\n\thideUi?: boolean\n\tshareZone?: ReactNode\n\ttopZone?: ReactNode\n\trenderDebugMenuItems?: () => React.ReactNode\n}\n\nconst TldrawUiInner = React.memo(function TldrawUiInner({\n\tchildren,\n\thideUi,\n\t...rest\n}: TldrawUiContentProps & { children: ReactNode }) {\n\t// The hideUi prop should prevent the UI from mounting.\n\t// If we ever need want the UI to mount and preserve state, then\n\t// we should change this behavior and hide the UI via CSS instead.\n\n\treturn (\n\t\t<>\n\t\t\t{children}\n\t\t\t{hideUi ? null : <TldrawUiContent {...rest} />}\n\t\t</>\n\t)\n})\n\nconst TldrawUiContent = React.memo(function TldrawUI() {\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\tconst breakpoint = useBreakpoint()\n\tconst isReadonlyMode = useReadonly()\n\tconst isFocusMode = useValue('focus', () => editor.getInstanceState().isFocusMode, [editor])\n\tconst isDebugMode = useValue('debug', () => editor.getInstanceState().isDebugMode, [editor])\n\n\tconst {\n\t\tSharePanel,\n\t\tTopPanel,\n\t\tMenuPanel,\n\t\tStylePanel,\n\t\tToolbar,\n\t\tHelpMenu,\n\t\tNavigationPanel,\n\t\tHelperButtons,\n\t\tDebugPanel,\n\t} = useTldrawUiComponents()\n\n\tuseKeyboardShortcuts()\n\tuseNativeClipboardEvents()\n\tuseEditorEvents()\n\n\tconst { 'toggle-focus-mode': toggleFocus } = useActions()\n\n\treturn (\n\t\t<ToastProvider>\n\t\t\t<div\n\t\t\t\tclassName={classNames('tlui-layout', {\n\t\t\t\t\t'tlui-layout__mobile': breakpoint < PORTRAIT_BREAKPOINT.TABLET_SM,\n\t\t\t\t})}\n\t\t\t\tdata-breakpoint={breakpoint}\n\t\t\t>\n\t\t\t\t{isFocusMode ? (\n\t\t\t\t\t<div className=\"tlui-layout__top\">\n\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\tclassName=\"tlui-focus-button\"\n\t\t\t\t\t\t\ttitle={msg('focus-mode.toggle-focus-mode')}\n\t\t\t\t\t\t\tonClick={() => toggleFocus.onSelect('menu')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"dot\" />\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<div className=\"tlui-layout__top\">\n\t\t\t\t\t\t\t<div className=\"tlui-layout__top__left\">\n\t\t\t\t\t\t\t\t{MenuPanel && <MenuPanel />}\n\t\t\t\t\t\t\t\t{HelperButtons && <HelperButtons />}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"tlui-layout__top__center\">{TopPanel && <TopPanel />}</div>\n\t\t\t\t\t\t\t<div className=\"tlui-layout__top__right\">\n\t\t\t\t\t\t\t\t{SharePanel && <SharePanel />}\n\t\t\t\t\t\t\t\t{StylePanel && breakpoint >= PORTRAIT_BREAKPOINT.TABLET_SM && !isReadonlyMode && (\n\t\t\t\t\t\t\t\t\t<StylePanel />\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"tlui-layout__bottom\">\n\t\t\t\t\t\t\t<div className=\"tlui-layout__bottom__main\">\n\t\t\t\t\t\t\t\t{NavigationPanel && <NavigationPanel />}\n\t\t\t\t\t\t\t\t{Toolbar && <Toolbar />}\n\t\t\t\t\t\t\t\t{HelpMenu && <HelpMenu />}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{isDebugMode && DebugPanel && <DebugPanel />}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t\t<Toasts />\n\t\t\t\t<Dialogs />\n\t\t\t\t<ToastViewport />\n\t\t\t\t<FollowingIndicator />\n\t\t\t</div>\n\t\t</ToastProvider>\n\t)\n})\n", "export { composeEventHandlers } from './primitive';\n", "function composeEventHandlers<E>(\n  originalEventHandler?: (event: E) => void,\n  ourEventHandler?: (event: E) => void,\n  { checkForDefaultPrevented = true } = {}\n) {\n  return function handleEvent(event: E) {\n    originalEventHandler?.(event);\n\n    if (checkForDefaultPrevented === false || !((event as unknown) as Event).defaultPrevented) {\n      return ourEventHandler?.(event);\n    }\n  };\n}\n\nexport { composeEventHandlers };\n", "export { composeRefs, useComposedRefs } from './composeRefs';\n", "import * as React from 'react';\n\ntype PossibleRef<T> = React.Ref<T> | undefined;\n\n/**\n * Set a given ref to a given value\n * This utility takes care of different types of refs: callback refs and RefObject(s)\n */\nfunction setRef<T>(ref: PossibleRef<T>, value: T) {\n  if (typeof ref === 'function') {\n    ref(value);\n  } else if (ref !== null && ref !== undefined) {\n    (ref as React.MutableRefObject<T>).current = value;\n  }\n}\n\n/**\n * A utility to compose multiple refs together\n * Accepts callback refs and RefObject(s)\n */\nfunction composeRefs<T>(...refs: PossibleRef<T>[]) {\n  return (node: T) => refs.forEach((ref) => setRef(ref, node));\n}\n\n/**\n * A custom hook that composes multiple refs\n * Accepts callback refs and RefObject(s)\n */\nfunction useComposedRefs<T>(...refs: PossibleRef<T>[]) {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return React.useCallback(composeRefs(...refs), refs);\n}\n\nexport { composeRefs, useComposedRefs };\n", "export { createContext, createContextScope } from './createContext';\nexport type { CreateScope, Scope } from './createContext';\n", "import * as React from 'react';\n\nfunction createContext<ContextValueType extends object | null>(\n  rootComponentName: string,\n  defaultContext?: ContextValueType\n) {\n  const Context = React.createContext<ContextValueType | undefined>(defaultContext);\n\n  function Provider(props: ContextValueType & { children: React.ReactNode }) {\n    const { children, ...context } = props;\n    // Only re-memoize when prop values change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    const value = React.useMemo(() => context, Object.values(context)) as ContextValueType;\n    return <Context.Provider value={value}>{children}</Context.Provider>;\n  }\n\n  function useContext(consumerName: string) {\n    const context = React.useContext(Context);\n    if (context) return context;\n    if (defaultContext !== undefined) return defaultContext;\n    // if a defaultContext wasn't specified, it's a required context.\n    throw new Error(`\\`${consumerName}\\` must be used within \\`${rootComponentName}\\``);\n  }\n\n  Provider.displayName = rootComponentName + 'Provider';\n  return [Provider, useContext] as const;\n}\n\n/* -------------------------------------------------------------------------------------------------\n * createContextScope\n * -----------------------------------------------------------------------------------------------*/\n\ntype Scope<C = any> = { [scopeName: string]: React.Context<C>[] } | undefined;\ntype ScopeHook = (scope: Scope) => { [__scopeProp: string]: Scope };\ninterface CreateScope {\n  scopeName: string;\n  (): ScopeHook;\n}\n\nfunction createContextScope(scopeName: string, createContextScopeDeps: CreateScope[] = []) {\n  let defaultContexts: any[] = [];\n\n  /* -----------------------------------------------------------------------------------------------\n   * createContext\n   * ---------------------------------------------------------------------------------------------*/\n\n  function createContext<ContextValueType extends object | null>(\n    rootComponentName: string,\n    defaultContext?: ContextValueType\n  ) {\n    const BaseContext = React.createContext<ContextValueType | undefined>(defaultContext);\n    const index = defaultContexts.length;\n    defaultContexts = [...defaultContexts, defaultContext];\n\n    function Provider(\n      props: ContextValueType & { scope: Scope<ContextValueType>; children: React.ReactNode }\n    ) {\n      const { scope, children, ...context } = props;\n      const Context = scope?.[scopeName][index] || BaseContext;\n      // Only re-memoize when prop values change\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      const value = React.useMemo(() => context, Object.values(context)) as ContextValueType;\n      return <Context.Provider value={value}>{children}</Context.Provider>;\n    }\n\n    function useContext(consumerName: string, scope: Scope<ContextValueType | undefined>) {\n      const Context = scope?.[scopeName][index] || BaseContext;\n      const context = React.useContext(Context);\n      if (context) return context;\n      if (defaultContext !== undefined) return defaultContext;\n      // if a defaultContext wasn't specified, it's a required context.\n      throw new Error(`\\`${consumerName}\\` must be used within \\`${rootComponentName}\\``);\n    }\n\n    Provider.displayName = rootComponentName + 'Provider';\n    return [Provider, useContext] as const;\n  }\n\n  /* -----------------------------------------------------------------------------------------------\n   * createScope\n   * ---------------------------------------------------------------------------------------------*/\n\n  const createScope: CreateScope = () => {\n    const scopeContexts = defaultContexts.map((defaultContext) => {\n      return React.createContext(defaultContext);\n    });\n    return function useScope(scope: Scope) {\n      const contexts = scope?.[scopeName] || scopeContexts;\n      return React.useMemo(\n        () => ({ [`__scope${scopeName}`]: { ...scope, [scopeName]: contexts } }),\n        [scope, contexts]\n      );\n    };\n  };\n\n  createScope.scopeName = scopeName;\n  return [createContext, composeContextScopes(createScope, ...createContextScopeDeps)] as const;\n}\n\n/* -------------------------------------------------------------------------------------------------\n * composeContextScopes\n * -----------------------------------------------------------------------------------------------*/\n\nfunction composeContextScopes(...scopes: CreateScope[]) {\n  const baseScope = scopes[0];\n  if (scopes.length === 1) return baseScope;\n\n  const createScope: CreateScope = () => {\n    const scopeHooks = scopes.map((createScope) => ({\n      useScope: createScope(),\n      scopeName: createScope.scopeName,\n    }));\n\n    return function useComposedScopes(overrideScopes) {\n      const nextScopes = scopeHooks.reduce((nextScopes, { useScope, scopeName }) => {\n        // We are calling a hook inside a callback which React warns against to avoid inconsistent\n        // renders, however, scoping doesn't have render side effects so we ignore the rule.\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        const scopeProps = useScope(overrideScopes);\n        const currentScope = scopeProps[`__scope${scopeName}`];\n        return { ...nextScopes, ...currentScope };\n      }, {});\n\n      return React.useMemo(() => ({ [`__scope${baseScope.scopeName}`]: nextScopes }), [nextScopes]);\n    };\n  };\n\n  createScope.scopeName = baseScope.scopeName;\n  return createScope;\n}\n\n/* -----------------------------------------------------------------------------------------------*/\n\nexport { createContext, createContextScope };\nexport type { CreateScope, Scope };\n", "export {\n  Slot,\n  Slottable,\n  //\n  Root,\n} from './Slot';\nexport type { SlotProps } from './Slot';\n", "import * as React from 'react';\nimport { composeRefs } from '@radix-ui/react-compose-refs';\n\n/* -------------------------------------------------------------------------------------------------\n * Slot\n * -----------------------------------------------------------------------------------------------*/\n\ninterface SlotProps extends React.HTMLAttributes<HTMLElement> {\n  children?: React.ReactNode;\n}\n\nconst Slot = React.forwardRef<HTMLElement, SlotProps>((props, forwardedRef) => {\n  const { children, ...slotProps } = props;\n  const childrenArray = React.Children.toArray(children);\n  const slottable = childrenArray.find(isSlottable);\n\n  if (slottable) {\n    // the new element to render is the one passed as a child of `Slottable`\n    const newElement = slottable.props.children as React.ReactNode;\n\n    const newChildren = childrenArray.map((child) => {\n      if (child === slottable) {\n        // because the new element will be the one rendered, we are only interested\n        // in grabbing its children (`newElement.props.children`)\n        if (React.Children.count(newElement) > 1) return React.Children.only(null);\n        return React.isValidElement(newElement)\n          ? (newElement.props.children as React.ReactNode)\n          : null;\n      } else {\n        return child;\n      }\n    });\n\n    return (\n      <SlotClone {...slotProps} ref={forwardedRef}>\n        {React.isValidElement(newElement)\n          ? React.cloneElement(newElement, undefined, newChildren)\n          : null}\n      </SlotClone>\n    );\n  }\n\n  return (\n    <SlotClone {...slotProps} ref={forwardedRef}>\n      {children}\n    </SlotClone>\n  );\n});\n\nSlot.displayName = 'Slot';\n\n/* -------------------------------------------------------------------------------------------------\n * SlotClone\n * -----------------------------------------------------------------------------------------------*/\n\ninterface SlotCloneProps {\n  children: React.ReactNode;\n}\n\nconst SlotClone = React.forwardRef<any, SlotCloneProps>((props, forwardedRef) => {\n  const { children, ...slotProps } = props;\n\n  if (React.isValidElement(children)) {\n    return React.cloneElement(children, {\n      ...mergeProps(slotProps, children.props),\n      ref: forwardedRef ? composeRefs(forwardedRef, (children as any).ref) : (children as any).ref,\n    });\n  }\n\n  return React.Children.count(children) > 1 ? React.Children.only(null) : null;\n});\n\nSlotClone.displayName = 'SlotClone';\n\n/* -------------------------------------------------------------------------------------------------\n * Slottable\n * -----------------------------------------------------------------------------------------------*/\n\nconst Slottable = ({ children }: { children: React.ReactNode }) => {\n  return <>{children}</>;\n};\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype AnyProps = Record<string, any>;\n\nfunction isSlottable(child: React.ReactNode): child is React.ReactElement {\n  return React.isValidElement(child) && child.type === Slottable;\n}\n\nfunction mergeProps(slotProps: AnyProps, childProps: AnyProps) {\n  // all child props should override\n  const overrideProps = { ...childProps };\n\n  for (const propName in childProps) {\n    const slotPropValue = slotProps[propName];\n    const childPropValue = childProps[propName];\n\n    const isHandler = /^on[A-Z]/.test(propName);\n    if (isHandler) {\n      // if the handler exists on both, we compose them\n      if (slotPropValue && childPropValue) {\n        overrideProps[propName] = (...args: unknown[]) => {\n          childPropValue(...args);\n          slotPropValue(...args);\n        };\n      }\n      // but if it exists only on the slot, we use only this one\n      else if (slotPropValue) {\n        overrideProps[propName] = slotPropValue;\n      }\n    }\n    // if it's `style`, we merge them\n    else if (propName === 'style') {\n      overrideProps[propName] = { ...slotPropValue, ...childPropValue };\n    } else if (propName === 'className') {\n      overrideProps[propName] = [slotPropValue, childPropValue].filter(Boolean).join(' ');\n    }\n  }\n\n  return { ...slotProps, ...overrideProps };\n}\n\nconst Root = Slot;\n\nexport {\n  Slot,\n  Slottable,\n  //\n  Root,\n};\nexport type { SlotProps };\n", "export { createCollection } from './Collection';\nexport type { CollectionProps } from './Collection';\n", "import React from 'react';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { Slot } from '@radix-ui/react-slot';\n\nimport type * as Radix from '@radix-ui/react-primitive';\n\ntype SlotProps = Radix.ComponentPropsWithoutRef<typeof Slot>;\ntype CollectionElement = HTMLElement;\ninterface CollectionProps extends SlotProps {\n  scope: any;\n}\n\n// We have resorted to returning slots directly rather than exposing primitives that can then\n// be slotted like `<CollectionItem as={Slot}>…</CollectionItem>`.\n// This is because we encountered issues with generic types that cannot be statically analysed\n// due to creating them dynamically via createCollection.\n\nfunction createCollection<ItemElement extends HTMLElement, ItemData = {}>(name: string) {\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionProvider\n   * ---------------------------------------------------------------------------------------------*/\n\n  const PROVIDER_NAME = name + 'CollectionProvider';\n  const [createCollectionContext, createCollectionScope] = createContextScope(PROVIDER_NAME);\n\n  type ContextValue = {\n    collectionRef: React.RefObject<CollectionElement>;\n    itemMap: Map<React.RefObject<ItemElement>, { ref: React.RefObject<ItemElement> } & ItemData>;\n  };\n\n  const [CollectionProviderImpl, useCollectionContext] = createCollectionContext<ContextValue>(\n    PROVIDER_NAME,\n    { collectionRef: { current: null }, itemMap: new Map() }\n  );\n\n  const CollectionProvider: React.FC<{ children?: React.ReactNode; scope: any }> = (props) => {\n    const { scope, children } = props;\n    const ref = React.useRef<CollectionElement>(null);\n    const itemMap = React.useRef<ContextValue['itemMap']>(new Map()).current;\n    return (\n      <CollectionProviderImpl scope={scope} itemMap={itemMap} collectionRef={ref}>\n        {children}\n      </CollectionProviderImpl>\n    );\n  };\n\n  CollectionProvider.displayName = PROVIDER_NAME;\n\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionSlot\n   * ---------------------------------------------------------------------------------------------*/\n\n  const COLLECTION_SLOT_NAME = name + 'CollectionSlot';\n\n  const CollectionSlot = React.forwardRef<CollectionElement, CollectionProps>(\n    (props, forwardedRef) => {\n      const { scope, children } = props;\n      const context = useCollectionContext(COLLECTION_SLOT_NAME, scope);\n      const composedRefs = useComposedRefs(forwardedRef, context.collectionRef);\n      return <Slot ref={composedRefs}>{children}</Slot>;\n    }\n  );\n\n  CollectionSlot.displayName = COLLECTION_SLOT_NAME;\n\n  /* -----------------------------------------------------------------------------------------------\n   * CollectionItem\n   * ---------------------------------------------------------------------------------------------*/\n\n  const ITEM_SLOT_NAME = name + 'CollectionItemSlot';\n  const ITEM_DATA_ATTR = 'data-radix-collection-item';\n\n  type CollectionItemSlotProps = ItemData & {\n    children: React.ReactNode;\n    scope: any;\n  };\n\n  const CollectionItemSlot = React.forwardRef<ItemElement, CollectionItemSlotProps>(\n    (props, forwardedRef) => {\n      const { scope, children, ...itemData } = props;\n      const ref = React.useRef<ItemElement>(null);\n      const composedRefs = useComposedRefs(forwardedRef, ref);\n      const context = useCollectionContext(ITEM_SLOT_NAME, scope);\n\n      React.useEffect(() => {\n        context.itemMap.set(ref, { ref, ...(itemData as unknown as ItemData) });\n        return () => void context.itemMap.delete(ref);\n      });\n\n      return (\n        <Slot {...{ [ITEM_DATA_ATTR]: '' }} ref={composedRefs}>\n          {children}\n        </Slot>\n      );\n    }\n  );\n\n  CollectionItemSlot.displayName = ITEM_SLOT_NAME;\n\n  /* -----------------------------------------------------------------------------------------------\n   * useCollection\n   * ---------------------------------------------------------------------------------------------*/\n\n  function useCollection(scope: any) {\n    const context = useCollectionContext(name + 'CollectionConsumer', scope);\n\n    const getItems = React.useCallback(() => {\n      const collectionNode = context.collectionRef.current;\n      if (!collectionNode) return [];\n      const orderedNodes = Array.from(collectionNode.querySelectorAll(`[${ITEM_DATA_ATTR}]`));\n      const items = Array.from(context.itemMap.values());\n      const orderedItems = items.sort(\n        (a, b) => orderedNodes.indexOf(a.ref.current!) - orderedNodes.indexOf(b.ref.current!)\n      );\n      return orderedItems;\n    }, [context.collectionRef, context.itemMap]);\n\n    return getItems;\n  }\n\n  return [\n    { Provider: CollectionProvider, Slot: CollectionSlot, ItemSlot: CollectionItemSlot },\n    useCollection,\n    createCollectionScope,\n  ] as const;\n}\n\nexport { createCollection };\nexport type { CollectionProps };\n", "export {\n  Primitive,\n  //\n  Root,\n  //\n  dispatchDiscreteCustomEvent,\n} from './Primitive';\nexport type { ComponentPropsWithoutRef, PrimitivePropsWithRef } from './Primitive';\n", "import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { Slot } from '@radix-ui/react-slot';\n\nconst NODES = [\n  'a',\n  'button',\n  'div',\n  'form',\n  'h2',\n  'h3',\n  'img',\n  'input',\n  'label',\n  'li',\n  'nav',\n  'ol',\n  'p',\n  'span',\n  'svg',\n  'ul',\n] as const;\n\n// Temporary while we await merge of this fix:\n// https://github.com/DefinitelyTyped/DefinitelyTyped/pull/55396\n// prettier-ignore\ntype PropsWithoutRef<P> = P extends any ? ('ref' extends keyof P ? Pick<P, Exclude<keyof P, 'ref'>> : P) : P;\ntype ComponentPropsWithoutRef<T extends React.ElementType> = PropsWithoutRef<\n  React.ComponentProps<T>\n>;\n\ntype Primitives = { [E in typeof NODES[number]]: PrimitiveForwardRefComponent<E> };\ntype PrimitivePropsWithRef<E extends React.ElementType> = React.ComponentPropsWithRef<E> & {\n  asChild?: boolean;\n};\n\ninterface PrimitiveForwardRefComponent<E extends React.ElementType>\n  extends React.ForwardRefExoticComponent<PrimitivePropsWithRef<E>> {}\n\n/* -------------------------------------------------------------------------------------------------\n * Primitive\n * -----------------------------------------------------------------------------------------------*/\n\nconst Primitive = NODES.reduce((primitive, node) => {\n  const Node = React.forwardRef((props: PrimitivePropsWithRef<typeof node>, forwardedRef: any) => {\n    const { asChild, ...primitiveProps } = props;\n    const Comp: any = asChild ? Slot : node;\n\n    React.useEffect(() => {\n      (window as any)[Symbol.for('radix-ui')] = true;\n    }, []);\n\n    return <Comp {...primitiveProps} ref={forwardedRef} />;\n  });\n\n  Node.displayName = `Primitive.${node}`;\n\n  return { ...primitive, [node]: Node };\n}, {} as Primitives);\n\n/* -------------------------------------------------------------------------------------------------\n * Utils\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * Flush custom event dispatch\n * https://github.com/radix-ui/primitives/pull/1378\n *\n * React batches *all* event handlers since version 18, this introduces certain considerations when using custom event types.\n *\n * Internally, React prioritises events in the following order:\n *  - discrete\n *  - continuous\n *  - default\n *\n * https://github.com/facebook/react/blob/a8a4742f1c54493df00da648a3f9d26e3db9c8b5/packages/react-dom/src/events/ReactDOMEventListener.js#L294-L350\n *\n * `discrete` is an  important distinction as updates within these events are applied immediately.\n * React however, is not able to infer the priority of custom event types due to how they are detected internally.\n * Because of this, it's possible for updates from custom events to be unexpectedly batched when\n * dispatched by another `discrete` event.\n *\n * In order to ensure that updates from custom events are applied predictably, we need to manually flush the batch.\n * This utility should be used when dispatching a custom event from within another `discrete` event, this utility\n * is not nessesary when dispatching known event types, or if dispatching a custom type inside a non-discrete event.\n * For example:\n *\n * dispatching a known click 👎\n * target.dispatchEvent(new Event(‘click’))\n *\n * dispatching a custom type within a non-discrete event 👎\n * onScroll={(event) => event.target.dispatchEvent(new CustomEvent(‘customType’))}\n *\n * dispatching a custom type within a `discrete` event 👍\n * onPointerDown={(event) => dispatchDiscreteCustomEvent(event.target, new CustomEvent(‘customType’))}\n *\n * Note: though React classifies `focus`, `focusin` and `focusout` events as `discrete`, it's  not recommended to use\n * this utility with them. This is because it's possible for those handlers to be called implicitly during render\n * e.g. when focus is within a component as it is unmounted, or when managing focus on mount.\n */\n\nfunction dispatchDiscreteCustomEvent<E extends CustomEvent>(target: E['target'], event: E) {\n  if (target) ReactDOM.flushSync(() => target.dispatchEvent(event));\n}\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = Primitive;\n\nexport {\n  Primitive,\n  //\n  Root,\n  //\n  dispatchDiscreteCustomEvent,\n};\nexport type { ComponentPropsWithoutRef, PrimitivePropsWithRef };\n", "export { useCallbackRef } from './useCallbackRef';\n", "import * as React from 'react';\n\n/**\n * A custom hook that converts a callback to a ref to avoid triggering re-renders when passed as a\n * prop or avoid re-executing effects when passed as a dependency\n */\nfunction useCallbackRef<T extends (...args: any[]) => any>(callback: T | undefined): T {\n  const callbackRef = React.useRef(callback);\n\n  React.useEffect(() => {\n    callbackRef.current = callback;\n  });\n\n  // https://github.com/facebook/react/issues/19240\n  return React.useMemo(() => ((...args) => callbackRef.current?.(...args)) as T, []);\n}\n\nexport { useCallbackRef };\n", "export { useEscapeKeydown } from './useEscapeKeydown';\n", "import * as React from 'react';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\n\n/**\n * Listens for when the escape key is down\n */\nfunction useEscapeKeydown(\n  onEscapeKeyDownProp?: (event: KeyboardEvent) => void,\n  ownerDocument: Document = globalThis?.document\n) {\n  const onEscapeKeyDown = useCallbackRef(onEscapeKeyDownProp);\n\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onEscapeKeyDown(event);\n      }\n    };\n    ownerDocument.addEventListener('keydown', handleKeyDown);\n    return () => ownerDocument.removeEventListener('keydown', handleKeyDown);\n  }, [onEscapeKeyDown, ownerDocument]);\n}\n\nexport { useEscapeKeydown };\n", "export {\n  DismissableLayer,\n  DismissableLayerBranch,\n  //\n  Root,\n  Branch,\n} from './DismissableLayer';\nexport type { DismissableLayerProps } from './DismissableLayer';\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { Primitive, dispatchDiscreteCustomEvent } from '@radix-ui/react-primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useEscapeKeydown } from '@radix-ui/react-use-escape-keydown';\n\nimport type * as Radix from '@radix-ui/react-primitive';\n\n/* -------------------------------------------------------------------------------------------------\n * DismissableLayer\n * -----------------------------------------------------------------------------------------------*/\n\nconst DISMISSABLE_LAYER_NAME = 'DismissableLayer';\nconst CONTEXT_UPDATE = 'dismissableLayer.update';\nconst POINTER_DOWN_OUTSIDE = 'dismissableLayer.pointerDownOutside';\nconst FOCUS_OUTSIDE = 'dismissableLayer.focusOutside';\n\nlet originalBodyPointerEvents: string;\n\nconst DismissableLayerContext = React.createContext({\n  layers: new Set<DismissableLayerElement>(),\n  layersWithOutsidePointerEventsDisabled: new Set<DismissableLayerElement>(),\n  branches: new Set<DismissableLayerBranchElement>(),\n});\n\ntype DismissableLayerElement = React.ElementRef<typeof Primitive.div>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface DismissableLayerProps extends PrimitiveDivProps {\n  /**\n   * When `true`, hover/focus/click interactions will be disabled on elements outside\n   * the `DismissableLayer`. Users will need to click twice on outside elements to\n   * interact with them: once to close the `DismissableLayer`, and again to trigger the element.\n   */\n  disableOutsidePointerEvents?: boolean;\n  /**\n   * Event handler called when the escape key is down.\n   * Can be prevented.\n   */\n  onEscapeKeyDown?: (event: KeyboardEvent) => void;\n  /**\n   * Event handler called when the a `pointerdown` event happens outside of the `DismissableLayer`.\n   * Can be prevented.\n   */\n  onPointerDownOutside?: (event: PointerDownOutsideEvent) => void;\n  /**\n   * Event handler called when the focus moves outside of the `DismissableLayer`.\n   * Can be prevented.\n   */\n  onFocusOutside?: (event: FocusOutsideEvent) => void;\n  /**\n   * Event handler called when an interaction happens outside the `DismissableLayer`.\n   * Specifically, when a `pointerdown` event happens outside or focus moves outside of it.\n   * Can be prevented.\n   */\n  onInteractOutside?: (event: PointerDownOutsideEvent | FocusOutsideEvent) => void;\n  /**\n   * Handler called when the `DismissableLayer` should be dismissed\n   */\n  onDismiss?: () => void;\n}\n\nconst DismissableLayer = React.forwardRef<DismissableLayerElement, DismissableLayerProps>(\n  (props, forwardedRef) => {\n    const {\n      disableOutsidePointerEvents = false,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      onFocusOutside,\n      onInteractOutside,\n      onDismiss,\n      ...layerProps\n    } = props;\n    const context = React.useContext(DismissableLayerContext);\n    const [node, setNode] = React.useState<DismissableLayerElement | null>(null);\n    const ownerDocument = node?.ownerDocument ?? globalThis?.document;\n    const [, force] = React.useState({});\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setNode(node));\n    const layers = Array.from(context.layers);\n    const [highestLayerWithOutsidePointerEventsDisabled] = [...context.layersWithOutsidePointerEventsDisabled].slice(-1); // prettier-ignore\n    const highestLayerWithOutsidePointerEventsDisabledIndex = layers.indexOf(highestLayerWithOutsidePointerEventsDisabled); // prettier-ignore\n    const index = node ? layers.indexOf(node) : -1;\n    const isBodyPointerEventsDisabled = context.layersWithOutsidePointerEventsDisabled.size > 0;\n    const isPointerEventsEnabled = index >= highestLayerWithOutsidePointerEventsDisabledIndex;\n\n    const pointerDownOutside = usePointerDownOutside((event) => {\n      const target = event.target as HTMLElement;\n      const isPointerDownOnBranch = [...context.branches].some((branch) => branch.contains(target));\n      if (!isPointerEventsEnabled || isPointerDownOnBranch) return;\n      onPointerDownOutside?.(event);\n      onInteractOutside?.(event);\n      if (!event.defaultPrevented) onDismiss?.();\n    }, ownerDocument);\n\n    const focusOutside = useFocusOutside((event) => {\n      const target = event.target as HTMLElement;\n      const isFocusInBranch = [...context.branches].some((branch) => branch.contains(target));\n      if (isFocusInBranch) return;\n      onFocusOutside?.(event);\n      onInteractOutside?.(event);\n      if (!event.defaultPrevented) onDismiss?.();\n    }, ownerDocument);\n\n    useEscapeKeydown((event) => {\n      const isHighestLayer = index === context.layers.size - 1;\n      if (!isHighestLayer) return;\n      onEscapeKeyDown?.(event);\n      if (!event.defaultPrevented && onDismiss) {\n        event.preventDefault();\n        onDismiss();\n      }\n    }, ownerDocument);\n\n    React.useEffect(() => {\n      if (!node) return;\n      if (disableOutsidePointerEvents) {\n        if (context.layersWithOutsidePointerEventsDisabled.size === 0) {\n          originalBodyPointerEvents = ownerDocument.body.style.pointerEvents;\n          ownerDocument.body.style.pointerEvents = 'none';\n        }\n        context.layersWithOutsidePointerEventsDisabled.add(node);\n      }\n      context.layers.add(node);\n      dispatchUpdate();\n      return () => {\n        if (\n          disableOutsidePointerEvents &&\n          context.layersWithOutsidePointerEventsDisabled.size === 1\n        ) {\n          ownerDocument.body.style.pointerEvents = originalBodyPointerEvents;\n        }\n      };\n    }, [node, ownerDocument, disableOutsidePointerEvents, context]);\n\n    /**\n     * We purposefully prevent combining this effect with the `disableOutsidePointerEvents` effect\n     * because a change to `disableOutsidePointerEvents` would remove this layer from the stack\n     * and add it to the end again so the layering order wouldn't be _creation order_.\n     * We only want them to be removed from context stacks when unmounted.\n     */\n    React.useEffect(() => {\n      return () => {\n        if (!node) return;\n        context.layers.delete(node);\n        context.layersWithOutsidePointerEventsDisabled.delete(node);\n        dispatchUpdate();\n      };\n    }, [node, context]);\n\n    React.useEffect(() => {\n      const handleUpdate = () => force({});\n      document.addEventListener(CONTEXT_UPDATE, handleUpdate);\n      return () => document.removeEventListener(CONTEXT_UPDATE, handleUpdate);\n    }, []);\n\n    return (\n      <Primitive.div\n        {...layerProps}\n        ref={composedRefs}\n        style={{\n          pointerEvents: isBodyPointerEventsDisabled\n            ? isPointerEventsEnabled\n              ? 'auto'\n              : 'none'\n            : undefined,\n          ...props.style,\n        }}\n        onFocusCapture={composeEventHandlers(props.onFocusCapture, focusOutside.onFocusCapture)}\n        onBlurCapture={composeEventHandlers(props.onBlurCapture, focusOutside.onBlurCapture)}\n        onPointerDownCapture={composeEventHandlers(\n          props.onPointerDownCapture,\n          pointerDownOutside.onPointerDownCapture\n        )}\n      />\n    );\n  }\n);\n\nDismissableLayer.displayName = DISMISSABLE_LAYER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DismissableLayerBranch\n * -----------------------------------------------------------------------------------------------*/\n\nconst BRANCH_NAME = 'DismissableLayerBranch';\n\ntype DismissableLayerBranchElement = React.ElementRef<typeof Primitive.div>;\ninterface DismissableLayerBranchProps extends PrimitiveDivProps {}\n\nconst DismissableLayerBranch = React.forwardRef<\n  DismissableLayerBranchElement,\n  DismissableLayerBranchProps\n>((props, forwardedRef) => {\n  const context = React.useContext(DismissableLayerContext);\n  const ref = React.useRef<DismissableLayerBranchElement>(null);\n  const composedRefs = useComposedRefs(forwardedRef, ref);\n\n  React.useEffect(() => {\n    const node = ref.current;\n    if (node) {\n      context.branches.add(node);\n      return () => {\n        context.branches.delete(node);\n      };\n    }\n  }, [context.branches]);\n\n  return <Primitive.div {...props} ref={composedRefs} />;\n});\n\nDismissableLayerBranch.displayName = BRANCH_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype PointerDownOutsideEvent = CustomEvent<{ originalEvent: PointerEvent }>;\ntype FocusOutsideEvent = CustomEvent<{ originalEvent: FocusEvent }>;\n\n/**\n * Listens for `pointerdown` outside a react subtree. We use `pointerdown` rather than `pointerup`\n * to mimic layer dismissing behaviour present in OS.\n * Returns props to pass to the node we want to check for outside events.\n */\nfunction usePointerDownOutside(\n  onPointerDownOutside?: (event: PointerDownOutsideEvent) => void,\n  ownerDocument: Document = globalThis?.document\n) {\n  const handlePointerDownOutside = useCallbackRef(onPointerDownOutside) as EventListener;\n  const isPointerInsideReactTreeRef = React.useRef(false);\n  const handleClickRef = React.useRef(() => {});\n\n  React.useEffect(() => {\n    const handlePointerDown = (event: PointerEvent) => {\n      if (event.target && !isPointerInsideReactTreeRef.current) {\n        const eventDetail = { originalEvent: event };\n\n        function handleAndDispatchPointerDownOutsideEvent() {\n          handleAndDispatchCustomEvent(\n            POINTER_DOWN_OUTSIDE,\n            handlePointerDownOutside,\n            eventDetail,\n            { discrete: true }\n          );\n        }\n\n        /**\n         * On touch devices, we need to wait for a click event because browsers implement\n         * a ~350ms delay between the time the user stops touching the display and when the\n         * browser executres events. We need to ensure we don't reactivate pointer-events within\n         * this timeframe otherwise the browser may execute events that should have been prevented.\n         *\n         * Additionally, this also lets us deal automatically with cancellations when a click event\n         * isn't raised because the page was considered scrolled/drag-scrolled, long-pressed, etc.\n         *\n         * This is why we also continuously remove the previous listener, because we cannot be\n         * certain that it was raised, and therefore cleaned-up.\n         */\n        if (event.pointerType === 'touch') {\n          ownerDocument.removeEventListener('click', handleClickRef.current);\n          handleClickRef.current = handleAndDispatchPointerDownOutsideEvent;\n          ownerDocument.addEventListener('click', handleClickRef.current, { once: true });\n        } else {\n          handleAndDispatchPointerDownOutsideEvent();\n        }\n      } else {\n        // We need to remove the event listener in case the outside click has been canceled.\n        // See: https://github.com/radix-ui/primitives/issues/2171\n        ownerDocument.removeEventListener('click', handleClickRef.current);\n      }\n      isPointerInsideReactTreeRef.current = false;\n    };\n    /**\n     * if this hook executes in a component that mounts via a `pointerdown` event, the event\n     * would bubble up to the document and trigger a `pointerDownOutside` event. We avoid\n     * this by delaying the event listener registration on the document.\n     * This is not React specific, but rather how the DOM works, ie:\n     * ```\n     * button.addEventListener('pointerdown', () => {\n     *   console.log('I will log');\n     *   document.addEventListener('pointerdown', () => {\n     *     console.log('I will also log');\n     *   })\n     * });\n     */\n    const timerId = window.setTimeout(() => {\n      ownerDocument.addEventListener('pointerdown', handlePointerDown);\n    }, 0);\n    return () => {\n      window.clearTimeout(timerId);\n      ownerDocument.removeEventListener('pointerdown', handlePointerDown);\n      ownerDocument.removeEventListener('click', handleClickRef.current);\n    };\n  }, [ownerDocument, handlePointerDownOutside]);\n\n  return {\n    // ensures we check React component tree (not just DOM tree)\n    onPointerDownCapture: () => (isPointerInsideReactTreeRef.current = true),\n  };\n}\n\n/**\n * Listens for when focus happens outside a react subtree.\n * Returns props to pass to the root (node) of the subtree we want to check.\n */\nfunction useFocusOutside(\n  onFocusOutside?: (event: FocusOutsideEvent) => void,\n  ownerDocument: Document = globalThis?.document\n) {\n  const handleFocusOutside = useCallbackRef(onFocusOutside) as EventListener;\n  const isFocusInsideReactTreeRef = React.useRef(false);\n\n  React.useEffect(() => {\n    const handleFocus = (event: FocusEvent) => {\n      if (event.target && !isFocusInsideReactTreeRef.current) {\n        const eventDetail = { originalEvent: event };\n        handleAndDispatchCustomEvent(FOCUS_OUTSIDE, handleFocusOutside, eventDetail, {\n          discrete: false,\n        });\n      }\n    };\n    ownerDocument.addEventListener('focusin', handleFocus);\n    return () => ownerDocument.removeEventListener('focusin', handleFocus);\n  }, [ownerDocument, handleFocusOutside]);\n\n  return {\n    onFocusCapture: () => (isFocusInsideReactTreeRef.current = true),\n    onBlurCapture: () => (isFocusInsideReactTreeRef.current = false),\n  };\n}\n\nfunction dispatchUpdate() {\n  const event = new CustomEvent(CONTEXT_UPDATE);\n  document.dispatchEvent(event);\n}\n\nfunction handleAndDispatchCustomEvent<E extends CustomEvent, OriginalEvent extends Event>(\n  name: string,\n  handler: ((event: E) => void) | undefined,\n  detail: { originalEvent: OriginalEvent } & (E extends CustomEvent<infer D> ? D : never),\n  { discrete }: { discrete: boolean }\n) {\n  const target = detail.originalEvent.target;\n  const event = new CustomEvent(name, { bubbles: false, cancelable: true, detail });\n  if (handler) target.addEventListener(name, handler as EventListener, { once: true });\n\n  if (discrete) {\n    dispatchDiscreteCustomEvent(target, event);\n  } else {\n    target.dispatchEvent(event);\n  }\n}\n\nconst Root = DismissableLayer;\nconst Branch = DismissableLayerBranch;\n\nexport {\n  DismissableLayer,\n  DismissableLayerBranch,\n  //\n  Root,\n  Branch,\n};\nexport type { DismissableLayerProps };\n", "export {\n  Portal,\n  //\n  Root,\n} from './Portal';\nexport type { PortalProps } from './Portal';\n", "import * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Primitive } from '@radix-ui/react-primitive';\n\nimport type * as Radix from '@radix-ui/react-primitive';\n\n/* -------------------------------------------------------------------------------------------------\n * Portal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'Portal';\n\ntype PortalElement = React.ElementRef<typeof Primitive.div>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface PortalProps extends PrimitiveDivProps {\n  /**\n   * An optional container where the portaled content should be appended.\n   */\n  container?: HTMLElement | null;\n}\n\nconst Portal = React.forwardRef<PortalElement, PortalProps>((props, forwardedRef) => {\n  const { container = globalThis?.document?.body, ...portalProps } = props;\n  return container\n    ? ReactDOM.createPortal(<Primitive.div {...portalProps} ref={forwardedRef} />, container)\n    : null;\n});\n\nPortal.displayName = PORTAL_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = Portal;\n\nexport {\n  Portal,\n  //\n  Root,\n};\nexport type { PortalProps };\n", "export { useLayoutEffect } from './useLayoutEffect';\n", "import * as React from 'react';\n\n/**\n * On the server, React emits a warning when calling `useLayoutEffect`.\n * This is because neither `useLayoutEffect` nor `useEffect` run on the server.\n * We use this safe version which suppresses the warning by replacing it with a noop on the server.\n *\n * See: https://reactjs.org/docs/hooks-reference.html#uselayouteffect\n */\nconst useLayoutEffect = Boolean(globalThis?.document) ? React.useLayoutEffect : () => {};\n\nexport { useLayoutEffect };\n", "export { Presence } from './Presence';\nexport type { PresenceProps } from './Presence';\n", "import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\nimport { useStateMachine } from './useStateMachine';\n\ninterface PresenceProps {\n  children: React.ReactElement | ((props: { present: boolean }) => React.ReactElement);\n  present: boolean;\n}\n\nconst Presence: React.FC<PresenceProps> = (props) => {\n  const { present, children } = props;\n  const presence = usePresence(present);\n\n  const child = (\n    typeof children === 'function'\n      ? children({ present: presence.isPresent })\n      : React.Children.only(children)\n  ) as React.ReactElement;\n\n  const ref = useComposedRefs(presence.ref, (child as any).ref);\n  const forceMount = typeof children === 'function';\n  return forceMount || presence.isPresent ? React.cloneElement(child, { ref }) : null;\n};\n\nPresence.displayName = 'Presence';\n\n/* -------------------------------------------------------------------------------------------------\n * usePresence\n * -----------------------------------------------------------------------------------------------*/\n\nfunction usePresence(present: boolean) {\n  const [node, setNode] = React.useState<HTMLElement>();\n  const stylesRef = React.useRef<CSSStyleDeclaration>({} as any);\n  const prevPresentRef = React.useRef(present);\n  const prevAnimationNameRef = React.useRef<string>('none');\n  const initialState = present ? 'mounted' : 'unmounted';\n  const [state, send] = useStateMachine(initialState, {\n    mounted: {\n      UNMOUNT: 'unmounted',\n      ANIMATION_OUT: 'unmountSuspended',\n    },\n    unmountSuspended: {\n      MOUNT: 'mounted',\n      ANIMATION_END: 'unmounted',\n    },\n    unmounted: {\n      MOUNT: 'mounted',\n    },\n  });\n\n  React.useEffect(() => {\n    const currentAnimationName = getAnimationName(stylesRef.current);\n    prevAnimationNameRef.current = state === 'mounted' ? currentAnimationName : 'none';\n  }, [state]);\n\n  useLayoutEffect(() => {\n    const styles = stylesRef.current;\n    const wasPresent = prevPresentRef.current;\n    const hasPresentChanged = wasPresent !== present;\n\n    if (hasPresentChanged) {\n      const prevAnimationName = prevAnimationNameRef.current;\n      const currentAnimationName = getAnimationName(styles);\n\n      if (present) {\n        send('MOUNT');\n      } else if (currentAnimationName === 'none' || styles?.display === 'none') {\n        // If there is no exit animation or the element is hidden, animations won't run\n        // so we unmount instantly\n        send('UNMOUNT');\n      } else {\n        /**\n         * When `present` changes to `false`, we check changes to animation-name to\n         * determine whether an animation has started. We chose this approach (reading\n         * computed styles) because there is no `animationrun` event and `animationstart`\n         * fires after `animation-delay` has expired which would be too late.\n         */\n        const isAnimating = prevAnimationName !== currentAnimationName;\n\n        if (wasPresent && isAnimating) {\n          send('ANIMATION_OUT');\n        } else {\n          send('UNMOUNT');\n        }\n      }\n\n      prevPresentRef.current = present;\n    }\n  }, [present, send]);\n\n  useLayoutEffect(() => {\n    if (node) {\n      /**\n       * Triggering an ANIMATION_OUT during an ANIMATION_IN will fire an `animationcancel`\n       * event for ANIMATION_IN after we have entered `unmountSuspended` state. So, we\n       * make sure we only trigger ANIMATION_END for the currently active animation.\n       */\n      const handleAnimationEnd = (event: AnimationEvent) => {\n        const currentAnimationName = getAnimationName(stylesRef.current);\n        const isCurrentAnimation = currentAnimationName.includes(event.animationName);\n        if (event.target === node && isCurrentAnimation) {\n          // With React 18 concurrency this update is applied\n          // a frame after the animation ends, creating a flash of visible content.\n          // By manually flushing we ensure they sync within a frame, removing the flash.\n          ReactDOM.flushSync(() => send('ANIMATION_END'));\n        }\n      };\n      const handleAnimationStart = (event: AnimationEvent) => {\n        if (event.target === node) {\n          // if animation occurred, store its name as the previous animation.\n          prevAnimationNameRef.current = getAnimationName(stylesRef.current);\n        }\n      };\n      node.addEventListener('animationstart', handleAnimationStart);\n      node.addEventListener('animationcancel', handleAnimationEnd);\n      node.addEventListener('animationend', handleAnimationEnd);\n      return () => {\n        node.removeEventListener('animationstart', handleAnimationStart);\n        node.removeEventListener('animationcancel', handleAnimationEnd);\n        node.removeEventListener('animationend', handleAnimationEnd);\n      };\n    } else {\n      // Transition to the unmounted state if the node is removed prematurely.\n      // We avoid doing so during cleanup as the node may change but still exist.\n      send('ANIMATION_END');\n    }\n  }, [node, send]);\n\n  return {\n    isPresent: ['mounted', 'unmountSuspended'].includes(state),\n    ref: React.useCallback((node: HTMLElement) => {\n      if (node) stylesRef.current = getComputedStyle(node);\n      setNode(node);\n    }, []),\n  };\n}\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction getAnimationName(styles?: CSSStyleDeclaration) {\n  return styles?.animationName || 'none';\n}\n\nexport { Presence };\nexport type { PresenceProps };\n", "import * as React from 'react';\n\ntype Machine<S> = { [k: string]: { [k: string]: S } };\ntype MachineState<T> = keyof T;\ntype MachineEvent<T> = keyof UnionToIntersection<T[keyof T]>;\n\n// 🤯 https://fettblog.eu/typescript-union-to-intersection/\ntype UnionToIntersection<T> = (T extends any ? (x: T) => any : never) extends (x: infer R) => any\n  ? R\n  : never;\n\nexport function useStateMachine<M>(\n  initialState: MachineState<M>,\n  machine: M & Machine<MachineState<M>>\n) {\n  return React.useReducer((state: MachineState<M>, event: MachineEvent<M>): MachineState<M> => {\n    const nextState = (machine[state] as any)[event];\n    return nextState ?? state;\n  }, initialState);\n}\n", "export { useControllableState } from './useControllableState';\n", "import * as React from 'react';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\n\ntype UseControllableStateParams<T> = {\n  prop?: T | undefined;\n  defaultProp?: T | undefined;\n  onChange?: (state: T) => void;\n};\n\ntype SetStateFn<T> = (prevState?: T) => T;\n\nfunction useControllableState<T>({\n  prop,\n  defaultProp,\n  onChange = () => {},\n}: UseControllableStateParams<T>) {\n  const [uncontrolledProp, setUncontrolledProp] = useUncontrolledState({ defaultProp, onChange });\n  const isControlled = prop !== undefined;\n  const value = isControlled ? prop : uncontrolledProp;\n  const handleChange = useCallbackRef(onChange);\n\n  const setValue: React.Dispatch<React.SetStateAction<T | undefined>> = React.useCallback(\n    (nextValue) => {\n      if (isControlled) {\n        const setter = nextValue as SetStateFn<T>;\n        const value = typeof nextValue === 'function' ? setter(prop) : nextValue;\n        if (value !== prop) handleChange(value as T);\n      } else {\n        setUncontrolledProp(nextValue);\n      }\n    },\n    [isControlled, prop, setUncontrolledProp, handleChange]\n  );\n\n  return [value, setValue] as const;\n}\n\nfunction useUncontrolledState<T>({\n  defaultProp,\n  onChange,\n}: Omit<UseControllableStateParams<T>, 'prop'>) {\n  const uncontrolledState = React.useState<T | undefined>(defaultProp);\n  const [value] = uncontrolledState;\n  const prevValueRef = React.useRef(value);\n  const handleChange = useCallbackRef(onChange);\n\n  React.useEffect(() => {\n    if (prevValueRef.current !== value) {\n      handleChange(value as T);\n      prevValueRef.current = value;\n    }\n  }, [value, prevValueRef, handleChange]);\n\n  return uncontrolledState;\n}\n\nexport { useControllableState };\n", "export {\n  VisuallyHidden,\n  //\n  Root,\n} from './VisuallyHidden';\nexport type { VisuallyHiddenProps } from './VisuallyHidden';\n", "import * as React from 'react';\nimport { Primitive } from '@radix-ui/react-primitive';\n\nimport type * as Radix from '@radix-ui/react-primitive';\n\n/* -------------------------------------------------------------------------------------------------\n * VisuallyHidden\n * -----------------------------------------------------------------------------------------------*/\n\nconst NAME = 'VisuallyHidden';\n\ntype VisuallyHiddenElement = React.ElementRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = Radix.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface VisuallyHiddenProps extends PrimitiveSpanProps {}\n\nconst VisuallyHidden = React.forwardRef<VisuallyHiddenElement, VisuallyHiddenProps>(\n  (props, forwardedRef) => {\n    return (\n      <Primitive.span\n        {...props}\n        ref={forwardedRef}\n        style={{\n          // See: https://github.com/twbs/bootstrap/blob/master/scss/mixins/_screen-reader.scss\n          position: 'absolute',\n          border: 0,\n          width: 1,\n          height: 1,\n          padding: 0,\n          margin: -1,\n          overflow: 'hidden',\n          clip: 'rect(0, 0, 0, 0)',\n          whiteSpace: 'nowrap',\n          wordWrap: 'normal',\n          ...props.style,\n        }}\n      />\n    );\n  }\n);\n\nVisuallyHidden.displayName = NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = VisuallyHidden;\n\nexport {\n  VisuallyHidden,\n  //\n  Root,\n};\nexport type { VisuallyHiddenProps };\n", "export {\n  createToastScope,\n  //\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastAction,\n  ToastClose,\n  //\n  Provider,\n  Viewport,\n  Root,\n  Title,\n  Description,\n  Action,\n  Close,\n} from './Toast';\nexport type {\n  ToastProviderProps,\n  ToastViewportProps,\n  ToastProps,\n  ToastTitleProps,\n  ToastDescriptionProps,\n  ToastActionProps,\n  ToastCloseProps,\n} from './Toast';\n", "import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createCollection } from '@radix-ui/react-collection';\nimport { createContextScope } from '@radix-ui/react-context';\nimport * as DismissableLayer from '@radix-ui/react-dismissable-layer';\nimport { Portal } from '@radix-ui/react-portal';\nimport { Presence } from '@radix-ui/react-presence';\nimport { Primitive, dispatchDiscreteCustomEvent } from '@radix-ui/react-primitive';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\nimport { VisuallyHidden } from '@radix-ui/react-visually-hidden';\n\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\n\n/* -------------------------------------------------------------------------------------------------\n * ToastProvider\n * -----------------------------------------------------------------------------------------------*/\n\nconst PROVIDER_NAME = 'ToastProvider';\n\nconst [Collection, useCollection, createCollectionScope] = createCollection<ToastElement>('Toast');\n\ntype SwipeDirection = 'up' | 'down' | 'left' | 'right';\ntype ToastProviderContextValue = {\n  label: string;\n  duration: number;\n  swipeDirection: SwipeDirection;\n  swipeThreshold: number;\n  toastCount: number;\n  viewport: ToastViewportElement | null;\n  onViewportChange(viewport: ToastViewportElement): void;\n  onToastAdd(): void;\n  onToastRemove(): void;\n  isFocusedToastEscapeKeyDownRef: React.MutableRefObject<boolean>;\n  isClosePausedRef: React.MutableRefObject<boolean>;\n};\n\ntype ScopedProps<P> = P & { __scopeToast?: Scope };\nconst [createToastContext, createToastScope] = createContextScope('Toast', [createCollectionScope]);\nconst [ToastProviderProvider, useToastProviderContext] =\n  createToastContext<ToastProviderContextValue>(PROVIDER_NAME);\n\ninterface ToastProviderProps {\n  children?: React.ReactNode;\n  /**\n   * An author-localized label for each toast. Used to help screen reader users\n   * associate the interruption with a toast.\n   * @defaultValue 'Notification'\n   */\n  label?: string;\n  /**\n   * Time in milliseconds that each toast should remain visible for.\n   * @defaultValue 5000\n   */\n  duration?: number;\n  /**\n   * Direction of pointer swipe that should close the toast.\n   * @defaultValue 'right'\n   */\n  swipeDirection?: SwipeDirection;\n  /**\n   * Distance in pixels that the swipe must pass before a close is triggered.\n   * @defaultValue 50\n   */\n  swipeThreshold?: number;\n}\n\nconst ToastProvider: React.FC<ToastProviderProps> = (props: ScopedProps<ToastProviderProps>) => {\n  const {\n    __scopeToast,\n    label = 'Notification',\n    duration = 5000,\n    swipeDirection = 'right',\n    swipeThreshold = 50,\n    children,\n  } = props;\n  const [viewport, setViewport] = React.useState<ToastViewportElement | null>(null);\n  const [toastCount, setToastCount] = React.useState(0);\n  const isFocusedToastEscapeKeyDownRef = React.useRef(false);\n  const isClosePausedRef = React.useRef(false);\n  return (\n    <Collection.Provider scope={__scopeToast}>\n      <ToastProviderProvider\n        scope={__scopeToast}\n        label={label}\n        duration={duration}\n        swipeDirection={swipeDirection}\n        swipeThreshold={swipeThreshold}\n        toastCount={toastCount}\n        viewport={viewport}\n        onViewportChange={setViewport}\n        onToastAdd={React.useCallback(() => setToastCount((prevCount) => prevCount + 1), [])}\n        onToastRemove={React.useCallback(() => setToastCount((prevCount) => prevCount - 1), [])}\n        isFocusedToastEscapeKeyDownRef={isFocusedToastEscapeKeyDownRef}\n        isClosePausedRef={isClosePausedRef}\n      >\n        {children}\n      </ToastProviderProvider>\n    </Collection.Provider>\n  );\n};\n\nToastProvider.propTypes = {\n  label(props) {\n    if (props.label && typeof props.label === 'string' && !props.label.trim()) {\n      const error = `Invalid prop \\`label\\` supplied to \\`${PROVIDER_NAME}\\`. Expected non-empty \\`string\\`.`;\n      return new Error(error);\n    }\n    return null;\n  },\n};\n\nToastProvider.displayName = PROVIDER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ToastViewport\n * -----------------------------------------------------------------------------------------------*/\n\nconst VIEWPORT_NAME = 'ToastViewport';\nconst VIEWPORT_DEFAULT_HOTKEY = ['F8'];\nconst VIEWPORT_PAUSE = 'toast.viewportPause';\nconst VIEWPORT_RESUME = 'toast.viewportResume';\n\ntype ToastViewportElement = React.ElementRef<typeof Primitive.ol>;\ntype PrimitiveOrderedListProps = Radix.ComponentPropsWithoutRef<typeof Primitive.ol>;\ninterface ToastViewportProps extends PrimitiveOrderedListProps {\n  /**\n   * The keys to use as the keyboard shortcut that will move focus to the toast viewport.\n   * @defaultValue ['F8']\n   */\n  hotkey?: string[];\n  /**\n   * An author-localized label for the toast viewport to provide context for screen reader users\n   * when navigating page landmarks. The available `{hotkey}` placeholder will be replaced for you.\n   * @defaultValue 'Notifications ({hotkey})'\n   */\n  label?: string;\n}\n\nconst ToastViewport = React.forwardRef<ToastViewportElement, ToastViewportProps>(\n  (props: ScopedProps<ToastViewportProps>, forwardedRef) => {\n    const {\n      __scopeToast,\n      hotkey = VIEWPORT_DEFAULT_HOTKEY,\n      label = 'Notifications ({hotkey})',\n      ...viewportProps\n    } = props;\n    const context = useToastProviderContext(VIEWPORT_NAME, __scopeToast);\n    const getItems = useCollection(__scopeToast);\n    const wrapperRef = React.useRef<HTMLDivElement>(null);\n    const headFocusProxyRef = React.useRef<FocusProxyElement>(null);\n    const tailFocusProxyRef = React.useRef<FocusProxyElement>(null);\n    const ref = React.useRef<ToastViewportElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref, context.onViewportChange);\n    const hotkeyLabel = hotkey.join('+').replace(/Key/g, '').replace(/Digit/g, '');\n    const hasToasts = context.toastCount > 0;\n\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        // we use `event.code` as it is consistent regardless of meta keys that were pressed.\n        // for example, `event.key` for `Control+Alt+t` is `†` and `t !== †`\n        const isHotkeyPressed = hotkey.every((key) => (event as any)[key] || event.code === key);\n        if (isHotkeyPressed) ref.current?.focus();\n      };\n      document.addEventListener('keydown', handleKeyDown);\n      return () => document.removeEventListener('keydown', handleKeyDown);\n    }, [hotkey]);\n\n    React.useEffect(() => {\n      const wrapper = wrapperRef.current;\n      const viewport = ref.current;\n      if (hasToasts && wrapper && viewport) {\n        const handlePause = () => {\n          if (!context.isClosePausedRef.current) {\n            const pauseEvent = new CustomEvent(VIEWPORT_PAUSE);\n            viewport.dispatchEvent(pauseEvent);\n            context.isClosePausedRef.current = true;\n          }\n        };\n\n        const handleResume = () => {\n          if (context.isClosePausedRef.current) {\n            const resumeEvent = new CustomEvent(VIEWPORT_RESUME);\n            viewport.dispatchEvent(resumeEvent);\n            context.isClosePausedRef.current = false;\n          }\n        };\n\n        const handleFocusOutResume = (event: FocusEvent) => {\n          const isFocusMovingOutside = !wrapper.contains(event.relatedTarget as HTMLElement);\n          if (isFocusMovingOutside) handleResume();\n        };\n\n        const handlePointerLeaveResume = () => {\n          const isFocusInside = wrapper.contains(document.activeElement);\n          if (!isFocusInside) handleResume();\n        };\n\n        // Toasts are not in the viewport React tree so we need to bind DOM events\n        wrapper.addEventListener('focusin', handlePause);\n        wrapper.addEventListener('focusout', handleFocusOutResume);\n        wrapper.addEventListener('pointermove', handlePause);\n        wrapper.addEventListener('pointerleave', handlePointerLeaveResume);\n        window.addEventListener('blur', handlePause);\n        window.addEventListener('focus', handleResume);\n        return () => {\n          wrapper.removeEventListener('focusin', handlePause);\n          wrapper.removeEventListener('focusout', handleFocusOutResume);\n          wrapper.removeEventListener('pointermove', handlePause);\n          wrapper.removeEventListener('pointerleave', handlePointerLeaveResume);\n          window.removeEventListener('blur', handlePause);\n          window.removeEventListener('focus', handleResume);\n        };\n      }\n    }, [hasToasts, context.isClosePausedRef]);\n\n    const getSortedTabbableCandidates = React.useCallback(\n      ({ tabbingDirection }: { tabbingDirection: 'forwards' | 'backwards' }) => {\n        const toastItems = getItems();\n        const tabbableCandidates = toastItems.map((toastItem) => {\n          const toastNode = toastItem.ref.current!;\n          const toastTabbableCandidates = [toastNode, ...getTabbableCandidates(toastNode)];\n          return tabbingDirection === 'forwards'\n            ? toastTabbableCandidates\n            : toastTabbableCandidates.reverse();\n        });\n        return (\n          tabbingDirection === 'forwards' ? tabbableCandidates.reverse() : tabbableCandidates\n        ).flat();\n      },\n      [getItems]\n    );\n\n    React.useEffect(() => {\n      const viewport = ref.current;\n      // We programmatically manage tabbing as we are unable to influence\n      // the source order with portals, this allows us to reverse the\n      // tab order so that it runs from most recent toast to least\n      if (viewport) {\n        const handleKeyDown = (event: KeyboardEvent) => {\n          const isMetaKey = event.altKey || event.ctrlKey || event.metaKey;\n          const isTabKey = event.key === 'Tab' && !isMetaKey;\n\n          if (isTabKey) {\n            const focusedElement = document.activeElement;\n            const isTabbingBackwards = event.shiftKey;\n            const targetIsViewport = event.target === viewport;\n\n            // If we're back tabbing after jumping to the viewport then we simply\n            // proxy focus out to the preceding document\n            if (targetIsViewport && isTabbingBackwards) {\n              headFocusProxyRef.current?.focus();\n              return;\n            }\n\n            const tabbingDirection = isTabbingBackwards ? 'backwards' : 'forwards';\n            const sortedCandidates = getSortedTabbableCandidates({ tabbingDirection });\n            const index = sortedCandidates.findIndex((candidate) => candidate === focusedElement);\n            if (focusFirst(sortedCandidates.slice(index + 1))) {\n              event.preventDefault();\n            } else {\n              // If we can't focus that means we're at the edges so we\n              // proxy to the corresponding exit point and let the browser handle\n              // tab/shift+tab keypress and implicitly pass focus to the next valid element in the document\n              isTabbingBackwards\n                ? headFocusProxyRef.current?.focus()\n                : tailFocusProxyRef.current?.focus();\n            }\n          }\n        };\n\n        // Toasts are not in the viewport React tree so we need to bind DOM events\n        viewport.addEventListener('keydown', handleKeyDown);\n        return () => viewport.removeEventListener('keydown', handleKeyDown);\n      }\n    }, [getItems, getSortedTabbableCandidates]);\n\n    return (\n      <DismissableLayer.Branch\n        ref={wrapperRef}\n        role=\"region\"\n        aria-label={label.replace('{hotkey}', hotkeyLabel)}\n        // Ensure virtual cursor from landmarks menus triggers focus/blur for pause/resume\n        tabIndex={-1}\n        // incase list has size when empty (e.g. padding), we remove pointer events so\n        // it doesn't prevent interactions with page elements that it overlays\n        style={{ pointerEvents: hasToasts ? undefined : 'none' }}\n      >\n        {hasToasts && (\n          <FocusProxy\n            ref={headFocusProxyRef}\n            onFocusFromOutsideViewport={() => {\n              const tabbableCandidates = getSortedTabbableCandidates({\n                tabbingDirection: 'forwards',\n              });\n              focusFirst(tabbableCandidates);\n            }}\n          />\n        )}\n        {/**\n         * tabindex on the the list so that it can be focused when items are removed. we focus\n         * the list instead of the viewport so it announces number of items remaining.\n         */}\n        <Collection.Slot scope={__scopeToast}>\n          <Primitive.ol tabIndex={-1} {...viewportProps} ref={composedRefs} />\n        </Collection.Slot>\n        {hasToasts && (\n          <FocusProxy\n            ref={tailFocusProxyRef}\n            onFocusFromOutsideViewport={() => {\n              const tabbableCandidates = getSortedTabbableCandidates({\n                tabbingDirection: 'backwards',\n              });\n              focusFirst(tabbableCandidates);\n            }}\n          />\n        )}\n      </DismissableLayer.Branch>\n    );\n  }\n);\n\nToastViewport.displayName = VIEWPORT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst FOCUS_PROXY_NAME = 'ToastFocusProxy';\n\ntype FocusProxyElement = React.ElementRef<typeof VisuallyHidden>;\ntype VisuallyHiddenProps = Radix.ComponentPropsWithoutRef<typeof VisuallyHidden>;\ninterface FocusProxyProps extends VisuallyHiddenProps {\n  onFocusFromOutsideViewport(): void;\n}\n\nconst FocusProxy = React.forwardRef<FocusProxyElement, ScopedProps<FocusProxyProps>>(\n  (props, forwardedRef) => {\n    const { __scopeToast, onFocusFromOutsideViewport, ...proxyProps } = props;\n    const context = useToastProviderContext(FOCUS_PROXY_NAME, __scopeToast);\n\n    return (\n      <VisuallyHidden\n        aria-hidden\n        tabIndex={0}\n        {...proxyProps}\n        ref={forwardedRef}\n        // Avoid page scrolling when focus is on the focus proxy\n        style={{ position: 'fixed' }}\n        onFocus={(event) => {\n          const prevFocusedElement = event.relatedTarget as HTMLElement | null;\n          const isFocusFromOutsideViewport = !context.viewport?.contains(prevFocusedElement);\n          if (isFocusFromOutsideViewport) onFocusFromOutsideViewport();\n        }}\n      />\n    );\n  }\n);\n\nFocusProxy.displayName = FOCUS_PROXY_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * Toast\n * -----------------------------------------------------------------------------------------------*/\n\nconst TOAST_NAME = 'Toast';\nconst TOAST_SWIPE_START = 'toast.swipeStart';\nconst TOAST_SWIPE_MOVE = 'toast.swipeMove';\nconst TOAST_SWIPE_CANCEL = 'toast.swipeCancel';\nconst TOAST_SWIPE_END = 'toast.swipeEnd';\n\ntype ToastElement = ToastImplElement;\ninterface ToastProps extends Omit<ToastImplProps, keyof ToastImplPrivateProps> {\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst Toast = React.forwardRef<ToastElement, ToastProps>(\n  (props: ScopedProps<ToastProps>, forwardedRef) => {\n    const { forceMount, open: openProp, defaultOpen, onOpenChange, ...toastProps } = props;\n    const [open = true, setOpen] = useControllableState({\n      prop: openProp,\n      defaultProp: defaultOpen,\n      onChange: onOpenChange,\n    });\n    return (\n      <Presence present={forceMount || open}>\n        <ToastImpl\n          open={open}\n          {...toastProps}\n          ref={forwardedRef}\n          onClose={() => setOpen(false)}\n          onPause={useCallbackRef(props.onPause)}\n          onResume={useCallbackRef(props.onResume)}\n          onSwipeStart={composeEventHandlers(props.onSwipeStart, (event) => {\n            event.currentTarget.setAttribute('data-swipe', 'start');\n          })}\n          onSwipeMove={composeEventHandlers(props.onSwipeMove, (event) => {\n            const { x, y } = event.detail.delta;\n            event.currentTarget.setAttribute('data-swipe', 'move');\n            event.currentTarget.style.setProperty('--radix-toast-swipe-move-x', `${x}px`);\n            event.currentTarget.style.setProperty('--radix-toast-swipe-move-y', `${y}px`);\n          })}\n          onSwipeCancel={composeEventHandlers(props.onSwipeCancel, (event) => {\n            event.currentTarget.setAttribute('data-swipe', 'cancel');\n            event.currentTarget.style.removeProperty('--radix-toast-swipe-move-x');\n            event.currentTarget.style.removeProperty('--radix-toast-swipe-move-y');\n            event.currentTarget.style.removeProperty('--radix-toast-swipe-end-x');\n            event.currentTarget.style.removeProperty('--radix-toast-swipe-end-y');\n          })}\n          onSwipeEnd={composeEventHandlers(props.onSwipeEnd, (event) => {\n            const { x, y } = event.detail.delta;\n            event.currentTarget.setAttribute('data-swipe', 'end');\n            event.currentTarget.style.removeProperty('--radix-toast-swipe-move-x');\n            event.currentTarget.style.removeProperty('--radix-toast-swipe-move-y');\n            event.currentTarget.style.setProperty('--radix-toast-swipe-end-x', `${x}px`);\n            event.currentTarget.style.setProperty('--radix-toast-swipe-end-y', `${y}px`);\n            setOpen(false);\n          })}\n        />\n      </Presence>\n    );\n  }\n);\n\nToast.displayName = TOAST_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype SwipeEvent = { currentTarget: EventTarget & ToastElement } & Omit<\n  CustomEvent<{ originalEvent: React.PointerEvent; delta: { x: number; y: number } }>,\n  'currentTarget'\n>;\n\nconst [ToastInteractiveProvider, useToastInteractiveContext] = createToastContext(TOAST_NAME, {\n  onClose() {},\n});\n\ntype ToastImplElement = React.ElementRef<typeof Primitive.li>;\ntype DismissableLayerProps = Radix.ComponentPropsWithoutRef<typeof DismissableLayer.Root>;\ntype ToastImplPrivateProps = { open: boolean; onClose(): void };\ntype PrimitiveListItemProps = Radix.ComponentPropsWithoutRef<typeof Primitive.li>;\ninterface ToastImplProps extends ToastImplPrivateProps, PrimitiveListItemProps {\n  type?: 'foreground' | 'background';\n  /**\n   * Time in milliseconds that toast should remain visible for. Overrides value\n   * given to `ToastProvider`.\n   */\n  duration?: number;\n  onEscapeKeyDown?: DismissableLayerProps['onEscapeKeyDown'];\n  onPause?(): void;\n  onResume?(): void;\n  onSwipeStart?(event: SwipeEvent): void;\n  onSwipeMove?(event: SwipeEvent): void;\n  onSwipeCancel?(event: SwipeEvent): void;\n  onSwipeEnd?(event: SwipeEvent): void;\n}\n\nconst ToastImpl = React.forwardRef<ToastImplElement, ToastImplProps>(\n  (props: ScopedProps<ToastImplProps>, forwardedRef) => {\n    const {\n      __scopeToast,\n      type = 'foreground',\n      duration: durationProp,\n      open,\n      onClose,\n      onEscapeKeyDown,\n      onPause,\n      onResume,\n      onSwipeStart,\n      onSwipeMove,\n      onSwipeCancel,\n      onSwipeEnd,\n      ...toastProps\n    } = props;\n    const context = useToastProviderContext(TOAST_NAME, __scopeToast);\n    const [node, setNode] = React.useState<ToastImplElement | null>(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setNode(node));\n    const pointerStartRef = React.useRef<{ x: number; y: number } | null>(null);\n    const swipeDeltaRef = React.useRef<{ x: number; y: number } | null>(null);\n    const duration = durationProp || context.duration;\n    const closeTimerStartTimeRef = React.useRef(0);\n    const closeTimerRemainingTimeRef = React.useRef(duration);\n    const closeTimerRef = React.useRef(0);\n    const { onToastAdd, onToastRemove } = context;\n    const handleClose = useCallbackRef(() => {\n      // focus viewport if focus is within toast to read the remaining toast\n      // count to SR users and ensure focus isn't lost\n      const isFocusInToast = node?.contains(document.activeElement);\n      if (isFocusInToast) context.viewport?.focus();\n      onClose();\n    });\n\n    const startTimer = React.useCallback(\n      (duration: number) => {\n        if (!duration || duration === Infinity) return;\n        window.clearTimeout(closeTimerRef.current);\n        closeTimerStartTimeRef.current = new Date().getTime();\n        closeTimerRef.current = window.setTimeout(handleClose, duration);\n      },\n      [handleClose]\n    );\n\n    React.useEffect(() => {\n      const viewport = context.viewport;\n      if (viewport) {\n        const handleResume = () => {\n          startTimer(closeTimerRemainingTimeRef.current);\n          onResume?.();\n        };\n        const handlePause = () => {\n          const elapsedTime = new Date().getTime() - closeTimerStartTimeRef.current;\n          closeTimerRemainingTimeRef.current = closeTimerRemainingTimeRef.current - elapsedTime;\n          window.clearTimeout(closeTimerRef.current);\n          onPause?.();\n        };\n        viewport.addEventListener(VIEWPORT_PAUSE, handlePause);\n        viewport.addEventListener(VIEWPORT_RESUME, handleResume);\n        return () => {\n          viewport.removeEventListener(VIEWPORT_PAUSE, handlePause);\n          viewport.removeEventListener(VIEWPORT_RESUME, handleResume);\n        };\n      }\n    }, [context.viewport, duration, onPause, onResume, startTimer]);\n\n    // start timer when toast opens or duration changes.\n    // we include `open` in deps because closed !== unmounted when animating\n    // so it could reopen before being completely unmounted\n    React.useEffect(() => {\n      if (open && !context.isClosePausedRef.current) startTimer(duration);\n    }, [open, duration, context.isClosePausedRef, startTimer]);\n\n    React.useEffect(() => {\n      onToastAdd();\n      return () => onToastRemove();\n    }, [onToastAdd, onToastRemove]);\n\n    const announceTextContent = React.useMemo(() => {\n      return node ? getAnnounceTextContent(node) : null;\n    }, [node]);\n\n    if (!context.viewport) return null;\n\n    return (\n      <>\n        {announceTextContent && (\n          <ToastAnnounce\n            __scopeToast={__scopeToast}\n            // Toasts are always role=status to avoid stuttering issues with role=alert in SRs.\n            role=\"status\"\n            aria-live={type === 'foreground' ? 'assertive' : 'polite'}\n            aria-atomic\n          >\n            {announceTextContent}\n          </ToastAnnounce>\n        )}\n\n        <ToastInteractiveProvider scope={__scopeToast} onClose={handleClose}>\n          {ReactDOM.createPortal(\n            <Collection.ItemSlot scope={__scopeToast}>\n              <DismissableLayer.Root\n                asChild\n                onEscapeKeyDown={composeEventHandlers(onEscapeKeyDown, () => {\n                  if (!context.isFocusedToastEscapeKeyDownRef.current) handleClose();\n                  context.isFocusedToastEscapeKeyDownRef.current = false;\n                })}\n              >\n                <Primitive.li\n                  // Ensure toasts are announced as status list or status when focused\n                  role=\"status\"\n                  aria-live=\"off\"\n                  aria-atomic\n                  tabIndex={0}\n                  data-state={open ? 'open' : 'closed'}\n                  data-swipe-direction={context.swipeDirection}\n                  {...toastProps}\n                  ref={composedRefs}\n                  style={{ userSelect: 'none', touchAction: 'none', ...props.style }}\n                  onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n                    if (event.key !== 'Escape') return;\n                    onEscapeKeyDown?.(event.nativeEvent);\n                    if (!event.nativeEvent.defaultPrevented) {\n                      context.isFocusedToastEscapeKeyDownRef.current = true;\n                      handleClose();\n                    }\n                  })}\n                  onPointerDown={composeEventHandlers(props.onPointerDown, (event) => {\n                    if (event.button !== 0) return;\n                    pointerStartRef.current = { x: event.clientX, y: event.clientY };\n                  })}\n                  onPointerMove={composeEventHandlers(props.onPointerMove, (event) => {\n                    if (!pointerStartRef.current) return;\n                    const x = event.clientX - pointerStartRef.current.x;\n                    const y = event.clientY - pointerStartRef.current.y;\n                    const hasSwipeMoveStarted = Boolean(swipeDeltaRef.current);\n                    const isHorizontalSwipe = ['left', 'right'].includes(context.swipeDirection);\n                    const clamp = ['left', 'up'].includes(context.swipeDirection)\n                      ? Math.min\n                      : Math.max;\n                    const clampedX = isHorizontalSwipe ? clamp(0, x) : 0;\n                    const clampedY = !isHorizontalSwipe ? clamp(0, y) : 0;\n                    const moveStartBuffer = event.pointerType === 'touch' ? 10 : 2;\n                    const delta = { x: clampedX, y: clampedY };\n                    const eventDetail = { originalEvent: event, delta };\n                    if (hasSwipeMoveStarted) {\n                      swipeDeltaRef.current = delta;\n                      handleAndDispatchCustomEvent(TOAST_SWIPE_MOVE, onSwipeMove, eventDetail, {\n                        discrete: false,\n                      });\n                    } else if (isDeltaInDirection(delta, context.swipeDirection, moveStartBuffer)) {\n                      swipeDeltaRef.current = delta;\n                      handleAndDispatchCustomEvent(TOAST_SWIPE_START, onSwipeStart, eventDetail, {\n                        discrete: false,\n                      });\n                      (event.target as HTMLElement).setPointerCapture(event.pointerId);\n                    } else if (Math.abs(x) > moveStartBuffer || Math.abs(y) > moveStartBuffer) {\n                      // User is swiping in wrong direction so we disable swipe gesture\n                      // for the current pointer down interaction\n                      pointerStartRef.current = null;\n                    }\n                  })}\n                  onPointerUp={composeEventHandlers(props.onPointerUp, (event) => {\n                    const delta = swipeDeltaRef.current;\n                    const target = event.target as HTMLElement;\n                    if (target.hasPointerCapture(event.pointerId)) {\n                      target.releasePointerCapture(event.pointerId);\n                    }\n                    swipeDeltaRef.current = null;\n                    pointerStartRef.current = null;\n                    if (delta) {\n                      const toast = event.currentTarget;\n                      const eventDetail = { originalEvent: event, delta };\n                      if (\n                        isDeltaInDirection(delta, context.swipeDirection, context.swipeThreshold)\n                      ) {\n                        handleAndDispatchCustomEvent(TOAST_SWIPE_END, onSwipeEnd, eventDetail, {\n                          discrete: true,\n                        });\n                      } else {\n                        handleAndDispatchCustomEvent(\n                          TOAST_SWIPE_CANCEL,\n                          onSwipeCancel,\n                          eventDetail,\n                          {\n                            discrete: true,\n                          }\n                        );\n                      }\n                      // Prevent click event from triggering on items within the toast when\n                      // pointer up is part of a swipe gesture\n                      toast.addEventListener('click', (event) => event.preventDefault(), {\n                        once: true,\n                      });\n                    }\n                  })}\n                />\n              </DismissableLayer.Root>\n            </Collection.ItemSlot>,\n            context.viewport\n          )}\n        </ToastInteractiveProvider>\n      </>\n    );\n  }\n);\n\nToastImpl.propTypes = {\n  type(props) {\n    if (props.type && !['foreground', 'background'].includes(props.type)) {\n      const error = `Invalid prop \\`type\\` supplied to \\`${TOAST_NAME}\\`. Expected \\`foreground | background\\`.`;\n      return new Error(error);\n    }\n    return null;\n  },\n};\n\n/* -----------------------------------------------------------------------------------------------*/\n\ninterface ToastAnnounceProps\n  extends Omit<React.ComponentPropsWithoutRef<'div'>, 'children'>,\n    ScopedProps<{ children: string[] }> {}\n\nconst ToastAnnounce: React.FC<ToastAnnounceProps> = (props: ScopedProps<ToastAnnounceProps>) => {\n  const { __scopeToast, children, ...announceProps } = props;\n  const context = useToastProviderContext(TOAST_NAME, __scopeToast);\n  const [renderAnnounceText, setRenderAnnounceText] = React.useState(false);\n  const [isAnnounced, setIsAnnounced] = React.useState(false);\n\n  // render text content in the next frame to ensure toast is announced in NVDA\n  useNextFrame(() => setRenderAnnounceText(true));\n\n  // cleanup after announcing\n  React.useEffect(() => {\n    const timer = window.setTimeout(() => setIsAnnounced(true), 1000);\n    return () => window.clearTimeout(timer);\n  }, []);\n\n  return isAnnounced ? null : (\n    <Portal asChild>\n      <VisuallyHidden {...announceProps}>\n        {renderAnnounceText && (\n          <>\n            {context.label} {children}\n          </>\n        )}\n      </VisuallyHidden>\n    </Portal>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * ToastTitle\n * -----------------------------------------------------------------------------------------------*/\n\nconst TITLE_NAME = 'ToastTitle';\n\ntype ToastTitleElement = React.ElementRef<typeof Primitive.div>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface ToastTitleProps extends PrimitiveDivProps {}\n\nconst ToastTitle = React.forwardRef<ToastTitleElement, ToastTitleProps>(\n  (props: ScopedProps<ToastTitleProps>, forwardedRef) => {\n    const { __scopeToast, ...titleProps } = props;\n    return <Primitive.div {...titleProps} ref={forwardedRef} />;\n  }\n);\n\nToastTitle.displayName = TITLE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ToastDescription\n * -----------------------------------------------------------------------------------------------*/\n\nconst DESCRIPTION_NAME = 'ToastDescription';\n\ntype ToastDescriptionElement = React.ElementRef<typeof Primitive.div>;\ninterface ToastDescriptionProps extends PrimitiveDivProps {}\n\nconst ToastDescription = React.forwardRef<ToastDescriptionElement, ToastDescriptionProps>(\n  (props: ScopedProps<ToastDescriptionProps>, forwardedRef) => {\n    const { __scopeToast, ...descriptionProps } = props;\n    return <Primitive.div {...descriptionProps} ref={forwardedRef} />;\n  }\n);\n\nToastDescription.displayName = DESCRIPTION_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ToastAction\n * -----------------------------------------------------------------------------------------------*/\n\nconst ACTION_NAME = 'ToastAction';\n\ntype ToastActionElement = ToastCloseElement;\ninterface ToastActionProps extends ToastCloseProps {\n  /**\n   * A short description for an alternate way to carry out the action. For screen reader users\n   * who will not be able to navigate to the button easily/quickly.\n   * @example <ToastAction altText=\"Goto account settings to upgrade\">Upgrade</ToastAction>\n   * @example <ToastAction altText=\"Undo (Alt+U)\">Undo</ToastAction>\n   */\n  altText: string;\n}\n\nconst ToastAction = React.forwardRef<ToastActionElement, ToastActionProps>(\n  (props: ScopedProps<ToastActionProps>, forwardedRef) => {\n    const { altText, ...actionProps } = props;\n    if (!altText) return null;\n    return (\n      <ToastAnnounceExclude altText={altText} asChild>\n        <ToastClose {...actionProps} ref={forwardedRef} />\n      </ToastAnnounceExclude>\n    );\n  }\n);\n\nToastAction.propTypes = {\n  altText(props) {\n    if (!props.altText) {\n      return new Error(`Missing prop \\`altText\\` expected on \\`${ACTION_NAME}\\``);\n    }\n    return null;\n  },\n};\n\nToastAction.displayName = ACTION_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ToastClose\n * -----------------------------------------------------------------------------------------------*/\n\nconst CLOSE_NAME = 'ToastClose';\n\ntype ToastCloseElement = React.ElementRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = Radix.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface ToastCloseProps extends PrimitiveButtonProps {}\n\nconst ToastClose = React.forwardRef<ToastCloseElement, ToastCloseProps>(\n  (props: ScopedProps<ToastCloseProps>, forwardedRef) => {\n    const { __scopeToast, ...closeProps } = props;\n    const interactiveContext = useToastInteractiveContext(CLOSE_NAME, __scopeToast);\n\n    return (\n      <ToastAnnounceExclude asChild>\n        <Primitive.button\n          type=\"button\"\n          {...closeProps}\n          ref={forwardedRef}\n          onClick={composeEventHandlers(props.onClick, interactiveContext.onClose)}\n        />\n      </ToastAnnounceExclude>\n    );\n  }\n);\n\nToastClose.displayName = CLOSE_NAME;\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype ToastAnnounceExcludeElement = React.ElementRef<typeof Primitive.div>;\ninterface ToastAnnounceExcludeProps extends PrimitiveDivProps {\n  altText?: string;\n}\n\nconst ToastAnnounceExclude = React.forwardRef<\n  ToastAnnounceExcludeElement,\n  ToastAnnounceExcludeProps\n>((props: ScopedProps<ToastAnnounceExcludeProps>, forwardedRef) => {\n  const { __scopeToast, altText, ...announceExcludeProps } = props;\n\n  return (\n    <Primitive.div\n      data-radix-toast-announce-exclude=\"\"\n      data-radix-toast-announce-alt={altText || undefined}\n      {...announceExcludeProps}\n      ref={forwardedRef}\n    />\n  );\n});\n\nfunction getAnnounceTextContent(container: HTMLElement) {\n  const textContent: string[] = [];\n  const childNodes = Array.from(container.childNodes);\n\n  childNodes.forEach((node) => {\n    if (node.nodeType === node.TEXT_NODE && node.textContent) textContent.push(node.textContent);\n    if (isHTMLElement(node)) {\n      const isHidden = node.ariaHidden || node.hidden || node.style.display === 'none';\n      const isExcluded = node.dataset.radixToastAnnounceExclude === '';\n\n      if (!isHidden) {\n        if (isExcluded) {\n          const altText = node.dataset.radixToastAnnounceAlt;\n          if (altText) textContent.push(altText);\n        } else {\n          textContent.push(...getAnnounceTextContent(node));\n        }\n      }\n    }\n  });\n\n  // We return a collection of text rather than a single concatenated string.\n  // This allows SR VO to naturally pause break between nodes while announcing.\n  return textContent;\n}\n\n/* ---------------------------------------------------------------------------------------------- */\n\nfunction handleAndDispatchCustomEvent<\n  E extends CustomEvent,\n  ReactEvent extends React.SyntheticEvent\n>(\n  name: string,\n  handler: ((event: E) => void) | undefined,\n  detail: { originalEvent: ReactEvent } & (E extends CustomEvent<infer D> ? D : never),\n  { discrete }: { discrete: boolean }\n) {\n  const currentTarget = detail.originalEvent.currentTarget as HTMLElement;\n  const event = new CustomEvent(name, { bubbles: true, cancelable: true, detail });\n  if (handler) currentTarget.addEventListener(name, handler as EventListener, { once: true });\n\n  if (discrete) {\n    dispatchDiscreteCustomEvent(currentTarget, event);\n  } else {\n    currentTarget.dispatchEvent(event);\n  }\n}\n\nconst isDeltaInDirection = (\n  delta: { x: number; y: number },\n  direction: SwipeDirection,\n  threshold = 0\n) => {\n  const deltaX = Math.abs(delta.x);\n  const deltaY = Math.abs(delta.y);\n  const isDeltaX = deltaX > deltaY;\n  if (direction === 'left' || direction === 'right') {\n    return isDeltaX && deltaX > threshold;\n  } else {\n    return !isDeltaX && deltaY > threshold;\n  }\n};\n\nfunction useNextFrame(callback = () => {}) {\n  const fn = useCallbackRef(callback);\n  useLayoutEffect(() => {\n    let raf1 = 0;\n    let raf2 = 0;\n    raf1 = window.requestAnimationFrame(() => (raf2 = window.requestAnimationFrame(fn)));\n    return () => {\n      window.cancelAnimationFrame(raf1);\n      window.cancelAnimationFrame(raf2);\n    };\n  }, [fn]);\n}\n\nfunction isHTMLElement(node: any): node is HTMLElement {\n  return node.nodeType === node.ELEMENT_NODE;\n}\n\n/**\n * Returns a list of potential tabbable candidates.\n *\n * NOTE: This is only a close approximation. For example it doesn't take into account cases like when\n * elements are not visible. This cannot be worked out easily by just reading a property, but rather\n * necessitate runtime knowledge (computed styles, etc). We deal with these cases separately.\n *\n * See: https://developer.mozilla.org/en-US/docs/Web/API/TreeWalker\n * Credit: https://github.com/discord/focus-layers/blob/master/src/util/wrapFocus.tsx#L1\n */\nfunction getTabbableCandidates(container: HTMLElement) {\n  const nodes: HTMLElement[] = [];\n  const walker = document.createTreeWalker(container, NodeFilter.SHOW_ELEMENT, {\n    acceptNode: (node: any) => {\n      const isHiddenInput = node.tagName === 'INPUT' && node.type === 'hidden';\n      if (node.disabled || node.hidden || isHiddenInput) return NodeFilter.FILTER_SKIP;\n      // `.tabIndex` is not the same as the `tabindex` attribute. It works on the\n      // runtime's understanding of tabbability, so this automatically accounts\n      // for any kind of element that could be tabbed to.\n      return node.tabIndex >= 0 ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n    },\n  });\n  while (walker.nextNode()) nodes.push(walker.currentNode as HTMLElement);\n  // we do not take into account the order of nodes with positive `tabIndex` as it\n  // hinders accessibility to have tab order different from visual order.\n  return nodes;\n}\n\nfunction focusFirst(candidates: HTMLElement[]) {\n  const previouslyFocusedElement = document.activeElement;\n  return candidates.some((candidate) => {\n    // if focus is already where we want to go, we don't want to keep going through the candidates\n    if (candidate === previouslyFocusedElement) return true;\n    candidate.focus();\n    return document.activeElement !== previouslyFocusedElement;\n  });\n}\n\nconst Provider = ToastProvider;\nconst Viewport = ToastViewport;\nconst Root = Toast;\nconst Title = ToastTitle;\nconst Description = ToastDescription;\nconst Action = ToastAction;\nconst Close = ToastClose;\n\nexport {\n  createToastScope,\n  //\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastAction,\n  ToastClose,\n  //\n  Provider,\n  Viewport,\n  Root,\n  Title,\n  Description,\n  Action,\n  Close,\n};\nexport type {\n  ToastProviderProps,\n  ToastViewportProps,\n  ToastProps,\n  ToastTitleProps,\n  ToastDescriptionProps,\n  ToastActionProps,\n  ToastCloseProps,\n};\n", "import * as _Dialog from '@radix-ui/react-dialog'\nimport { useContainer } from '@tldraw/editor'\nimport React, { useCallback } from 'react'\nimport { TLUiDialog, useDialogs } from '../context/dialogs'\n\nconst Dialog = ({ id, component: ModalContent, onClose }: TLUiDialog) => {\n\tconst { removeDialog } = useDialogs()\n\n\tconst container = useContainer()\n\n\tconst handleOpenChange = useCallback(\n\t\t(isOpen: boolean) => {\n\t\t\tif (!isOpen) {\n\t\t\t\tif (onClose) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tonClose()\n\t\t\t\t\t} catch (err: any) {\n\t\t\t\t\t\tconsole.warn(err)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tremoveDialog(id)\n\t\t\t}\n\t\t},\n\t\t[id, onClose, removeDialog]\n\t)\n\n\treturn (\n\t\t<_Dialog.Root onOpenChange={handleOpenChange} defaultOpen>\n\t\t\t<_Dialog.Portal container={container}>\n\t\t\t\t<_Dialog.Overlay\n\t\t\t\t\tdir=\"ltr\"\n\t\t\t\t\tclassName=\"tlui-dialog__overlay\"\n\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t// only close if the click is on the overlay itself, ignore bubbling clicks\n\t\t\t\t\t\tif (e.target === e.currentTarget) handleOpenChange(false)\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<_Dialog.Content dir=\"ltr\" className=\"tlui-dialog__content\">\n\t\t\t\t\t\t<ModalContent onClose={() => handleOpenChange(false)} />\n\t\t\t\t\t</_Dialog.Content>\n\t\t\t\t</_Dialog.Overlay>\n\t\t\t</_Dialog.Portal>\n\t\t</_Dialog.Root>\n\t)\n}\n\nfunction _Dialogs() {\n\tconst { dialogs } = useDialogs()\n\n\treturn (\n\t\t<>\n\t\t\t{dialogs.map((dialog: TLUiDialog) => (\n\t\t\t\t<Dialog key={dialog.id} {...dialog} />\n\t\t\t))}\n\t\t</>\n\t)\n}\n\nexport const Dialogs = React.memo(_Dialogs)\n", "export { useId } from './id';\n", "import * as React from 'react';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\n\n// We `toString()` to prevent bundlers from trying to `import { useId } from 'react';`\nconst useReactId = (React as any)['useId'.toString()] || (() => undefined);\nlet count = 0;\n\nfunction useId(deterministicId?: string): string {\n  const [id, setId] = React.useState<string | undefined>(useReactId());\n  // React versions older than 18 will have client-side ids only.\n  useLayoutEffect(() => {\n    if (!deterministicId) setId((reactId) => reactId ?? String(count++));\n  }, [deterministicId]);\n  return deterministicId || (id ? `radix-${id}` : '');\n}\n\nexport { useId };\n", "export {\n  FocusScope,\n  //\n  Root,\n} from './FocusScope';\nexport type { FocusScopeProps } from './FocusScope';\n", "import * as React from 'react';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\n\nimport type * as Radix from '@radix-ui/react-primitive';\n\nconst AUTOFOCUS_ON_MOUNT = 'focusScope.autoFocusOnMount';\nconst AUTOFOCUS_ON_UNMOUNT = 'focusScope.autoFocusOnUnmount';\nconst EVENT_OPTIONS = { bubbles: false, cancelable: true };\n\ntype FocusableTarget = HTMLElement | { focus(): void };\n\n/* -------------------------------------------------------------------------------------------------\n * FocusScope\n * -----------------------------------------------------------------------------------------------*/\n\nconst FOCUS_SCOPE_NAME = 'FocusScope';\n\ntype FocusScopeElement = React.ElementRef<typeof Primitive.div>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface FocusScopeProps extends PrimitiveDivProps {\n  /**\n   * When `true`, tabbing from last item will focus first tabbable\n   * and shift+tab from first item will focus last tababble.\n   * @defaultValue false\n   */\n  loop?: boolean;\n\n  /**\n   * When `true`, focus cannot escape the focus scope via keyboard,\n   * pointer, or a programmatic focus.\n   * @defaultValue false\n   */\n  trapped?: boolean;\n\n  /**\n   * Event handler called when auto-focusing on mount.\n   * Can be prevented.\n   */\n  onMountAutoFocus?: (event: Event) => void;\n\n  /**\n   * Event handler called when auto-focusing on unmount.\n   * Can be prevented.\n   */\n  onUnmountAutoFocus?: (event: Event) => void;\n}\n\nconst FocusScope = React.forwardRef<FocusScopeElement, FocusScopeProps>((props, forwardedRef) => {\n  const {\n    loop = false,\n    trapped = false,\n    onMountAutoFocus: onMountAutoFocusProp,\n    onUnmountAutoFocus: onUnmountAutoFocusProp,\n    ...scopeProps\n  } = props;\n  const [container, setContainer] = React.useState<HTMLElement | null>(null);\n  const onMountAutoFocus = useCallbackRef(onMountAutoFocusProp);\n  const onUnmountAutoFocus = useCallbackRef(onUnmountAutoFocusProp);\n  const lastFocusedElementRef = React.useRef<HTMLElement | null>(null);\n  const composedRefs = useComposedRefs(forwardedRef, (node) => setContainer(node));\n\n  const focusScope = React.useRef({\n    paused: false,\n    pause() {\n      this.paused = true;\n    },\n    resume() {\n      this.paused = false;\n    },\n  }).current;\n\n  // Takes care of trapping focus if focus is moved outside programmatically for example\n  React.useEffect(() => {\n    if (trapped) {\n      function handleFocusIn(event: FocusEvent) {\n        if (focusScope.paused || !container) return;\n        const target = event.target as HTMLElement | null;\n        if (container.contains(target)) {\n          lastFocusedElementRef.current = target;\n        } else {\n          focus(lastFocusedElementRef.current, { select: true });\n        }\n      }\n\n      function handleFocusOut(event: FocusEvent) {\n        if (focusScope.paused || !container) return;\n        const relatedTarget = event.relatedTarget as HTMLElement | null;\n\n        // A `focusout` event with a `null` `relatedTarget` will happen in at least two cases:\n        //\n        // 1. When the user switches app/tabs/windows/the browser itself loses focus.\n        // 2. In Google Chrome, when the focused element is removed from the DOM.\n        //\n        // We let the browser do its thing here because:\n        //\n        // 1. The browser already keeps a memory of what's focused for when the page gets refocused.\n        // 2. In Google Chrome, if we try to focus the deleted focused element (as per below), it\n        //    throws the CPU to 100%, so we avoid doing anything for this reason here too.\n        if (relatedTarget === null) return;\n\n        // If the focus has moved to an actual legitimate element (`relatedTarget !== null`)\n        // that is outside the container, we move focus to the last valid focused element inside.\n        if (!container.contains(relatedTarget)) {\n          focus(lastFocusedElementRef.current, { select: true });\n        }\n      }\n\n      // When the focused element gets removed from the DOM, browsers move focus\n      // back to the document.body. In this case, we move focus to the container\n      // to keep focus trapped correctly.\n      function handleMutations(mutations: MutationRecord[]) {\n        const focusedElement = document.activeElement as HTMLElement | null;\n        if (focusedElement !== document.body) return;\n        for (const mutation of mutations) {\n          if (mutation.removedNodes.length > 0) focus(container);\n        }\n      }\n\n      document.addEventListener('focusin', handleFocusIn);\n      document.addEventListener('focusout', handleFocusOut);\n      const mutationObserver = new MutationObserver(handleMutations);\n      if (container) mutationObserver.observe(container, { childList: true, subtree: true });\n\n      return () => {\n        document.removeEventListener('focusin', handleFocusIn);\n        document.removeEventListener('focusout', handleFocusOut);\n        mutationObserver.disconnect();\n      };\n    }\n  }, [trapped, container, focusScope.paused]);\n\n  React.useEffect(() => {\n    if (container) {\n      focusScopesStack.add(focusScope);\n      const previouslyFocusedElement = document.activeElement as HTMLElement | null;\n      const hasFocusedCandidate = container.contains(previouslyFocusedElement);\n\n      if (!hasFocusedCandidate) {\n        const mountEvent = new CustomEvent(AUTOFOCUS_ON_MOUNT, EVENT_OPTIONS);\n        container.addEventListener(AUTOFOCUS_ON_MOUNT, onMountAutoFocus);\n        container.dispatchEvent(mountEvent);\n        if (!mountEvent.defaultPrevented) {\n          focusFirst(removeLinks(getTabbableCandidates(container)), { select: true });\n          if (document.activeElement === previouslyFocusedElement) {\n            focus(container);\n          }\n        }\n      }\n\n      return () => {\n        container.removeEventListener(AUTOFOCUS_ON_MOUNT, onMountAutoFocus);\n\n        // We hit a react bug (fixed in v17) with focusing in unmount.\n        // We need to delay the focus a little to get around it for now.\n        // See: https://github.com/facebook/react/issues/17894\n        setTimeout(() => {\n          const unmountEvent = new CustomEvent(AUTOFOCUS_ON_UNMOUNT, EVENT_OPTIONS);\n          container.addEventListener(AUTOFOCUS_ON_UNMOUNT, onUnmountAutoFocus);\n          container.dispatchEvent(unmountEvent);\n          if (!unmountEvent.defaultPrevented) {\n            focus(previouslyFocusedElement ?? document.body, { select: true });\n          }\n          // we need to remove the listener after we `dispatchEvent`\n          container.removeEventListener(AUTOFOCUS_ON_UNMOUNT, onUnmountAutoFocus);\n\n          focusScopesStack.remove(focusScope);\n        }, 0);\n      };\n    }\n  }, [container, onMountAutoFocus, onUnmountAutoFocus, focusScope]);\n\n  // Takes care of looping focus (when tabbing whilst at the edges)\n  const handleKeyDown = React.useCallback(\n    (event: React.KeyboardEvent) => {\n      if (!loop && !trapped) return;\n      if (focusScope.paused) return;\n\n      const isTabKey = event.key === 'Tab' && !event.altKey && !event.ctrlKey && !event.metaKey;\n      const focusedElement = document.activeElement as HTMLElement | null;\n\n      if (isTabKey && focusedElement) {\n        const container = event.currentTarget as HTMLElement;\n        const [first, last] = getTabbableEdges(container);\n        const hasTabbableElementsInside = first && last;\n\n        // we can only wrap focus if we have tabbable edges\n        if (!hasTabbableElementsInside) {\n          if (focusedElement === container) event.preventDefault();\n        } else {\n          if (!event.shiftKey && focusedElement === last) {\n            event.preventDefault();\n            if (loop) focus(first, { select: true });\n          } else if (event.shiftKey && focusedElement === first) {\n            event.preventDefault();\n            if (loop) focus(last, { select: true });\n          }\n        }\n      }\n    },\n    [loop, trapped, focusScope.paused]\n  );\n\n  return (\n    <Primitive.div tabIndex={-1} {...scopeProps} ref={composedRefs} onKeyDown={handleKeyDown} />\n  );\n});\n\nFocusScope.displayName = FOCUS_SCOPE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * Utils\n * -----------------------------------------------------------------------------------------------*/\n\n/**\n * Attempts focusing the first element in a list of candidates.\n * Stops when focus has actually moved.\n */\nfunction focusFirst(candidates: HTMLElement[], { select = false } = {}) {\n  const previouslyFocusedElement = document.activeElement;\n  for (const candidate of candidates) {\n    focus(candidate, { select });\n    if (document.activeElement !== previouslyFocusedElement) return;\n  }\n}\n\n/**\n * Returns the first and last tabbable elements inside a container.\n */\nfunction getTabbableEdges(container: HTMLElement) {\n  const candidates = getTabbableCandidates(container);\n  const first = findVisible(candidates, container);\n  const last = findVisible(candidates.reverse(), container);\n  return [first, last] as const;\n}\n\n/**\n * Returns a list of potential tabbable candidates.\n *\n * NOTE: This is only a close approximation. For example it doesn't take into account cases like when\n * elements are not visible. This cannot be worked out easily by just reading a property, but rather\n * necessitate runtime knowledge (computed styles, etc). We deal with these cases separately.\n *\n * See: https://developer.mozilla.org/en-US/docs/Web/API/TreeWalker\n * Credit: https://github.com/discord/focus-layers/blob/master/src/util/wrapFocus.tsx#L1\n */\nfunction getTabbableCandidates(container: HTMLElement) {\n  const nodes: HTMLElement[] = [];\n  const walker = document.createTreeWalker(container, NodeFilter.SHOW_ELEMENT, {\n    acceptNode: (node: any) => {\n      const isHiddenInput = node.tagName === 'INPUT' && node.type === 'hidden';\n      if (node.disabled || node.hidden || isHiddenInput) return NodeFilter.FILTER_SKIP;\n      // `.tabIndex` is not the same as the `tabindex` attribute. It works on the\n      // runtime's understanding of tabbability, so this automatically accounts\n      // for any kind of element that could be tabbed to.\n      return node.tabIndex >= 0 ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n    },\n  });\n  while (walker.nextNode()) nodes.push(walker.currentNode as HTMLElement);\n  // we do not take into account the order of nodes with positive `tabIndex` as it\n  // hinders accessibility to have tab order different from visual order.\n  return nodes;\n}\n\n/**\n * Returns the first visible element in a list.\n * NOTE: Only checks visibility up to the `container`.\n */\nfunction findVisible(elements: HTMLElement[], container: HTMLElement) {\n  for (const element of elements) {\n    // we stop checking if it's hidden at the `container` level (excluding)\n    if (!isHidden(element, { upTo: container })) return element;\n  }\n}\n\nfunction isHidden(node: HTMLElement, { upTo }: { upTo?: HTMLElement }) {\n  if (getComputedStyle(node).visibility === 'hidden') return true;\n  while (node) {\n    // we stop at `upTo` (excluding it)\n    if (upTo !== undefined && node === upTo) return false;\n    if (getComputedStyle(node).display === 'none') return true;\n    node = node.parentElement as HTMLElement;\n  }\n  return false;\n}\n\nfunction isSelectableInput(element: any): element is FocusableTarget & { select: () => void } {\n  return element instanceof HTMLInputElement && 'select' in element;\n}\n\nfunction focus(element?: FocusableTarget | null, { select = false } = {}) {\n  // only focus if that element is focusable\n  if (element && element.focus) {\n    const previouslyFocusedElement = document.activeElement;\n    // NOTE: we prevent scrolling on focus, to minimize jarring transitions for users\n    element.focus({ preventScroll: true });\n    // only select if its not the same element, it supports selection and we need to select\n    if (element !== previouslyFocusedElement && isSelectableInput(element) && select)\n      element.select();\n  }\n}\n\n/* -------------------------------------------------------------------------------------------------\n * FocusScope stack\n * -----------------------------------------------------------------------------------------------*/\n\ntype FocusScopeAPI = { paused: boolean; pause(): void; resume(): void };\nconst focusScopesStack = createFocusScopesStack();\n\nfunction createFocusScopesStack() {\n  /** A stack of focus scopes, with the active one at the top */\n  let stack: FocusScopeAPI[] = [];\n\n  return {\n    add(focusScope: FocusScopeAPI) {\n      // pause the currently active focus scope (at the top of the stack)\n      const activeFocusScope = stack[0];\n      if (focusScope !== activeFocusScope) {\n        activeFocusScope?.pause();\n      }\n      // remove in case it already exists (because we'll re-add it at the top of the stack)\n      stack = arrayRemove(stack, focusScope);\n      stack.unshift(focusScope);\n    },\n\n    remove(focusScope: FocusScopeAPI) {\n      stack = arrayRemove(stack, focusScope);\n      stack[0]?.resume();\n    },\n  };\n}\n\nfunction arrayRemove<T>(array: T[], item: T) {\n  const updatedArray = [...array];\n  const index = updatedArray.indexOf(item);\n  if (index !== -1) {\n    updatedArray.splice(index, 1);\n  }\n  return updatedArray;\n}\n\nfunction removeLinks(items: HTMLElement[]) {\n  return items.filter((item) => item.tagName !== 'A');\n}\n\nconst Root = FocusScope;\n\nexport {\n  FocusScope,\n  //\n  Root,\n};\nexport type { FocusScopeProps };\n", "export {\n  FocusGuards,\n  //\n  Root,\n  //\n  useFocusGuards,\n} from './FocusGuards';\n", "import * as React from 'react';\n\n/** Number of components which have requested interest to have focus guards */\nlet count = 0;\n\nfunction FocusGuards(props: any) {\n  useFocusGuards();\n  return props.children;\n}\n\n/**\n * Injects a pair of focus guards at the edges of the whole DOM tree\n * to ensure `focusin` & `focusout` events can be caught consistently.\n */\nfunction useFocusGuards() {\n  React.useEffect(() => {\n    const edgeGuards = document.querySelectorAll('[data-radix-focus-guard]');\n    document.body.insertAdjacentElement('afterbegin', edgeGuards[0] ?? createFocusGuard());\n    document.body.insertAdjacentElement('beforeend', edgeGuards[1] ?? createFocusGuard());\n    count++;\n\n    return () => {\n      if (count === 1) {\n        document.querySelectorAll('[data-radix-focus-guard]').forEach((node) => node.remove());\n      }\n      count--;\n    };\n  }, []);\n}\n\nfunction createFocusGuard() {\n  const element = document.createElement('span');\n  element.setAttribute('data-radix-focus-guard', '');\n  element.tabIndex = 0;\n  element.style.cssText = 'outline: none; opacity: 0; position: fixed; pointer-events: none';\n  return element;\n}\n\nconst Root = FocusGuards;\n\nexport {\n  FocusGuards,\n  //\n  Root,\n  //\n  useFocusGuards,\n};\n", "/******************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function(d, b) {\n  extendStatics = Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n      function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n  return extendStatics(d, b);\n};\n\nexport function __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null)\n      throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() { this.constructor = d; }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nexport var __assign = function() {\n  __assign = Object.assign || function __assign(t) {\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n      return t;\n  }\n  return __assign.apply(this, arguments);\n}\n\nexport function __rest(s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n      t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n              t[p[i]] = s[p[i]];\n      }\n  return t;\n}\n\nexport function __decorate(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n  else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nexport function __param(paramIndex, decorator) {\n  return function (target, key) { decorator(target, key, paramIndex); }\n}\n\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\n  function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\n  var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\n  var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\n  var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\n  var _, done = false;\n  for (var i = decorators.length - 1; i >= 0; i--) {\n      var context = {};\n      for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\n      for (var p in contextIn.access) context.access[p] = contextIn.access[p];\n      context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\n      var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\n      if (kind === \"accessor\") {\n          if (result === void 0) continue;\n          if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\n          if (_ = accept(result.get)) descriptor.get = _;\n          if (_ = accept(result.set)) descriptor.set = _;\n          if (_ = accept(result.init)) initializers.unshift(_);\n      }\n      else if (_ = accept(result)) {\n          if (kind === \"field\") initializers.unshift(_);\n          else descriptor[key] = _;\n      }\n  }\n  if (target) Object.defineProperty(target, contextIn.name, descriptor);\n  done = true;\n};\n\nexport function __runInitializers(thisArg, initializers, value) {\n  var useValue = arguments.length > 2;\n  for (var i = 0; i < initializers.length; i++) {\n      value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\n  }\n  return useValue ? value : void 0;\n};\n\nexport function __propKey(x) {\n  return typeof x === \"symbol\" ? x : \"\".concat(x);\n};\n\nexport function __setFunctionName(f, name, prefix) {\n  if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\n  return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\n};\n\nexport function __metadata(metadataKey, metadataValue) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\n}\n\nexport function __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n  return new (P || (P = Promise))(function (resolve, reject) {\n      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n      function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nexport function __generator(thisArg, body) {\n  var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n  return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n  function verb(n) { return function (v) { return step([n, v]); }; }\n  function step(op) {\n      if (f) throw new TypeError(\"Generator is already executing.\");\n      while (g && (g = 0, op[0] && (_ = 0)), _) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n              case 0: case 1: t = op; break;\n              case 4: _.label++; return { value: op[1], done: false };\n              case 5: _.label++; y = op[1]; op = [0]; continue;\n              case 7: op = _.ops.pop(); _.trys.pop(); continue;\n              default:\n                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                  if (t[2]) _.ops.pop();\n                  _.trys.pop(); continue;\n          }\n          op = body.call(thisArg, _);\n      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n  }\n}\n\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n  }\n  Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nexport function __exportStar(m, o) {\n  for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\n}\n\nexport function __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n      next: function () {\n          if (o && i >= o.length) o = void 0;\n          return { value: o && o[i++], done: !o };\n      }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\n\nexport function __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o), r, ar = [], e;\n  try {\n      while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  }\n  catch (error) { e = { error: error }; }\n  finally {\n      try {\n          if (r && !r.done && (m = i[\"return\"])) m.call(i);\n      }\n      finally { if (e) throw e.error; }\n  }\n  return ar;\n}\n\n/** @deprecated */\nexport function __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++)\n      ar = ar.concat(__read(arguments[i]));\n  return ar;\n}\n\n/** @deprecated */\nexport function __spreadArrays() {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n  for (var r = Array(s), k = 0, i = 0; i < il; i++)\n      for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n  return r;\n}\n\nexport function __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n      if (ar || !(i in from)) {\n          if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n          ar[i] = from[i];\n      }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\n\nexport function __await(v) {\n  return this instanceof __await ? (this.v = v, this) : new __await(v);\n}\n\nexport function __asyncGenerator(thisArg, _arguments, generator) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var g = generator.apply(thisArg, _arguments || []), i, q = [];\n  return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n  function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n  function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n  function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n  function fulfill(value) { resume(\"next\", value); }\n  function reject(value) { resume(\"throw\", value); }\n  function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n}\n\nexport function __asyncDelegator(o) {\n  var i, p;\n  return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\n  function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\n}\n\nexport function __asyncValues(o) {\n  if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n  var m = o[Symbol.asyncIterator], i;\n  return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n  function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n  function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n}\n\nexport function __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n  return cooked;\n};\n\nvar __setModuleDefault = Object.create ? (function(o, v) {\n  Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n  o[\"default\"] = v;\n};\n\nexport function __importStar(mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n}\n\nexport function __importDefault(mod) {\n  return (mod && mod.__esModule) ? mod : { default: mod };\n}\n\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n}\n\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n}\n\nexport function __classPrivateFieldIn(state, receiver) {\n  if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\n  return typeof state === \"function\" ? receiver === state : state.has(receiver);\n}\n\nexport function __addDisposableResource(env, value, async) {\n  if (value !== null && value !== void 0) {\n    if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\n    var dispose;\n    if (async) {\n        if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\n        dispose = value[Symbol.asyncDispose];\n    }\n    if (dispose === void 0) {\n        if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\n        dispose = value[Symbol.dispose];\n    }\n    if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\n    env.stack.push({ value: value, dispose: dispose, async: async });\n  }\n  else if (async) {\n    env.stack.push({ async: true });\n  }\n  return value;\n}\n\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nexport function __disposeResources(env) {\n  function fail(e) {\n    env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\n    env.hasError = true;\n  }\n  function next() {\n    while (env.stack.length) {\n      var rec = env.stack.pop();\n      try {\n        var result = rec.dispose && rec.dispose.call(rec.value);\n        if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\n      }\n      catch (e) {\n          fail(e);\n      }\n    }\n    if (env.hasError) throw env.error;\n  }\n  return next();\n}\n\nexport default {\n  __extends,\n  __assign,\n  __rest,\n  __decorate,\n  __param,\n  __metadata,\n  __awaiter,\n  __generator,\n  __createBinding,\n  __exportStar,\n  __values,\n  __read,\n  __spread,\n  __spreadArrays,\n  __spreadArray,\n  __await,\n  __asyncGenerator,\n  __asyncDelegator,\n  __asyncValues,\n  __makeTemplateObject,\n  __importStar,\n  __importDefault,\n  __classPrivateFieldGet,\n  __classPrivateFieldSet,\n  __classPrivateFieldIn,\n  __addDisposableResource,\n  __disposeResources,\n};\n", "import { __assign } from \"tslib\";\nimport * as React from 'react';\nimport { RemoveScroll } from './UI';\nimport SideCar from './sidecar';\nvar ReactRemoveScroll = React.forwardRef(function (props, ref) { return (React.createElement(RemoveScroll, __assign({}, props, { ref: ref, sideCar: SideCar }))); });\nReactRemoveScroll.classNames = RemoveScroll.classNames;\nexport default ReactRemoveScroll;\n", "import { __assign, __rest } from \"tslib\";\nimport * as React from 'react';\nimport { fullWidthClassName, zeroRightClassName } from 'react-remove-scroll-bar/constants';\nimport { useMergeRefs } from 'use-callback-ref';\nimport { effectCar } from './medium';\nvar nothing = function () {\n    return;\n};\n/**\n * Removes scrollbar from the page and contain the scroll within the Lock\n */\nvar RemoveScroll = React.forwardRef(function (props, parentRef) {\n    var ref = React.useRef(null);\n    var _a = React.useState({\n        onScrollCapture: nothing,\n        onWheelCapture: nothing,\n        onTouchMoveCapture: nothing,\n    }), callbacks = _a[0], setCallbacks = _a[1];\n    var forwardProps = props.forwardProps, children = props.children, className = props.className, removeScrollBar = props.removeScrollBar, enabled = props.enabled, shards = props.shards, sideCar = props.sideCar, noIsolation = props.noIsolation, inert = props.inert, allowPinchZoom = props.allowPinchZoom, _b = props.as, Container = _b === void 0 ? 'div' : _b, rest = __rest(props, [\"forwardProps\", \"children\", \"className\", \"removeScrollBar\", \"enabled\", \"shards\", \"sideCar\", \"noIsolation\", \"inert\", \"allowPinchZoom\", \"as\"]);\n    var SideCar = sideCar;\n    var containerRef = useMergeRefs([ref, parentRef]);\n    var containerProps = __assign(__assign({}, rest), callbacks);\n    return (React.createElement(React.Fragment, null,\n        enabled && (React.createElement(SideCar, { sideCar: effectCar, removeScrollBar: removeScrollBar, shards: shards, noIsolation: noIsolation, inert: inert, setCallbacks: setCallbacks, allowPinchZoom: !!allowPinchZoom, lockRef: ref })),\n        forwardProps ? (React.cloneElement(React.Children.only(children), __assign(__assign({}, containerProps), { ref: containerRef }))) : (React.createElement(Container, __assign({}, containerProps, { className: className, ref: containerRef }), children))));\n});\nRemoveScroll.defaultProps = {\n    enabled: true,\n    removeScrollBar: true,\n    inert: false,\n};\nRemoveScroll.classNames = {\n    fullWidth: fullWidthClassName,\n    zeroRight: zeroRightClassName,\n};\nexport { RemoveScroll };\n", "export var zeroRightClassName = 'right-scroll-bar-position';\nexport var fullWidthClassName = 'width-before-scroll-bar';\nexport var noScrollbarsClassName = 'with-scroll-bars-hidden';\n/**\n * Name of a CSS variable containing the amount of \"hidden\" scrollbar\n * ! might be undefined ! use will fallback!\n */\nexport var removedBarSizeVariable = '--removed-body-scroll-bar-size';\n", "/**\n * Assigns a value for a given ref, no matter of the ref format\n * @param {RefObject} ref - a callback function or ref object\n * @param value - a new value\n *\n * @see https://github.com/theKashey/use-callback-ref#assignref\n * @example\n * const refObject = useRef();\n * const refFn = (ref) => {....}\n *\n * assignRef(refObject, \"refValue\");\n * assignRef(refFn, \"refValue\");\n */\nexport function assignRef(ref, value) {\n    if (typeof ref === 'function') {\n        ref(value);\n    }\n    else if (ref) {\n        ref.current = value;\n    }\n    return ref;\n}\n", "import { useState } from 'react';\n/**\n * creates a MutableRef with ref change callback\n * @param initialValue - initial ref value\n * @param {Function} callback - a callback to run when value changes\n *\n * @example\n * const ref = useCallbackRef(0, (newValue, oldValue) => console.log(oldValue, '->', newValue);\n * ref.current = 1;\n * // prints 0 -> 1\n *\n * @see https://reactjs.org/docs/hooks-reference.html#useref\n * @see https://github.com/theKashey/use-callback-ref#usecallbackref---to-replace-reactuseref\n * @returns {MutableRefObject}\n */\nexport function useCallbackRef(initialValue, callback) {\n    var ref = useState(function () { return ({\n        // value\n        value: initialValue,\n        // last callback\n        callback: callback,\n        // \"memoized\" public interface\n        facade: {\n            get current() {\n                return ref.value;\n            },\n            set current(value) {\n                var last = ref.value;\n                if (last !== value) {\n                    ref.value = value;\n                    ref.callback(value, last);\n                }\n            },\n        },\n    }); })[0];\n    // update callback\n    ref.callback = callback;\n    return ref.facade;\n}\n", "import * as React from 'react';\nimport { assignRef } from './assignRef';\nimport { useCallbackRef } from './useRef';\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\nvar currentValues = new WeakMap();\n/**\n * Merges two or more refs together providing a single interface to set their value\n * @param {RefObject|Ref} refs\n * @returns {MutableRefObject} - a new ref, which translates all changes to {refs}\n *\n * @see {@link mergeRefs} a version without buit-in memoization\n * @see https://github.com/theKashey/use-callback-ref#usemergerefs\n * @example\n * const Component = React.forwardRef((props, ref) => {\n *   const ownRef = useRef();\n *   const domRef = useMergeRefs([ref, ownRef]); // 👈 merge together\n *   return <div ref={domRef}>...</div>\n * }\n */\nexport function useMergeRefs(refs, defaultValue) {\n    var callbackRef = useCallbackRef(defaultValue || null, function (newValue) {\n        return refs.forEach(function (ref) { return assignRef(ref, newValue); });\n    });\n    // handle refs changes - added or removed\n    useIsomorphicLayoutEffect(function () {\n        var oldValue = currentValues.get(callbackRef);\n        if (oldValue) {\n            var prevRefs_1 = new Set(oldValue);\n            var nextRefs_1 = new Set(refs);\n            var current_1 = callbackRef.current;\n            prevRefs_1.forEach(function (ref) {\n                if (!nextRefs_1.has(ref)) {\n                    assignRef(ref, null);\n                }\n            });\n            nextRefs_1.forEach(function (ref) {\n                if (!prevRefs_1.has(ref)) {\n                    assignRef(ref, current_1);\n                }\n            });\n        }\n        currentValues.set(callbackRef, refs);\n    }, [refs]);\n    return callbackRef;\n}\n", "import { __assign } from \"tslib\";\nimport * as React from 'react';\nimport { useSidecar } from './hook';\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function sidecar(importer, errorComponent) {\n    var ErrorCase = function () { return errorComponent; };\n    return function Sidecar(props) {\n        var _a = useSidecar(importer, props.sideCar), Car = _a[0], error = _a[1];\n        if (error && errorComponent) {\n            return ErrorCase;\n        }\n        // @ts-expect-error type shenanigans\n        return Car ? React.createElement(Car, __assign({}, props)) : null;\n    };\n}\n", "import { useState, useEffect } from 'react';\nimport { env } from './env';\nvar cache = new WeakMap();\nvar NO_OPTIONS = {};\nexport function useSidecar(importer, effect) {\n    var options = (effect && effect.options) || NO_OPTIONS;\n    if (env.isNode && !options.ssr) {\n        return [null, null];\n    }\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    return useRealSidecar(importer, effect);\n}\nfunction useRealSidecar(importer, effect) {\n    var options = (effect && effect.options) || NO_OPTIONS;\n    var couldUseCache = env.forceCache || (env.isNode && !!options.ssr) || !options.async;\n    var _a = useState(couldUseCache ? function () { return cache.get(importer); } : undefined), Car = _a[0], setCar = _a[1];\n    var _b = useState(null), error = _b[0], setError = _b[1];\n    useEffect(function () {\n        if (!Car) {\n            importer().then(function (car) {\n                var resolved = effect ? effect.read() : car.default || car;\n                if (!resolved) {\n                    console.error('Sidecar error: with importer', importer);\n                    var error_1;\n                    if (effect) {\n                        console.error('Sidecar error: with medium', effect);\n                        error_1 = new Error('Sidecar medium was not found');\n                    }\n                    else {\n                        error_1 = new Error('Sidecar was not found in exports');\n                    }\n                    setError(function () { return error_1; });\n                    throw error_1;\n                }\n                cache.set(importer, resolved);\n                setCar(function () { return resolved; });\n            }, function (e) { return setError(function () { return e; }); });\n        }\n    }, []);\n    return [Car, error];\n}\n", "import { __assign } from \"tslib\";\nfunction ItoI(a) {\n    return a;\n}\nfunction innerCreateMedium(defaults, middleware) {\n    if (middleware === void 0) { middleware = ItoI; }\n    var buffer = [];\n    var assigned = false;\n    var medium = {\n        read: function () {\n            if (assigned) {\n                throw new Error('Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.');\n            }\n            if (buffer.length) {\n                return buffer[buffer.length - 1];\n            }\n            return defaults;\n        },\n        useMedium: function (data) {\n            var item = middleware(data, assigned);\n            buffer.push(item);\n            return function () {\n                buffer = buffer.filter(function (x) { return x !== item; });\n            };\n        },\n        assignSyncMedium: function (cb) {\n            assigned = true;\n            while (buffer.length) {\n                var cbs = buffer;\n                buffer = [];\n                cbs.forEach(cb);\n            }\n            buffer = {\n                push: function (x) { return cb(x); },\n                filter: function () { return buffer; },\n            };\n        },\n        assignMedium: function (cb) {\n            assigned = true;\n            var pendingQueue = [];\n            if (buffer.length) {\n                var cbs = buffer;\n                buffer = [];\n                cbs.forEach(cb);\n                pendingQueue = buffer;\n            }\n            var executeQueue = function () {\n                var cbs = pendingQueue;\n                pendingQueue = [];\n                cbs.forEach(cb);\n            };\n            var cycle = function () { return Promise.resolve().then(executeQueue); };\n            cycle();\n            buffer = {\n                push: function (x) {\n                    pendingQueue.push(x);\n                    cycle();\n                },\n                filter: function (filter) {\n                    pendingQueue = pendingQueue.filter(filter);\n                    return buffer;\n                },\n            };\n        },\n    };\n    return medium;\n}\nexport function createMedium(defaults, middleware) {\n    if (middleware === void 0) { middleware = ItoI; }\n    return innerCreateMedium(defaults, middleware);\n}\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function createSidecarMedium(options) {\n    if (options === void 0) { options = {}; }\n    var medium = innerCreateMedium(null);\n    medium.options = __assign({ async: true, ssr: false }, options);\n    return medium;\n}\n", "import { __assign } from \"tslib\";\nimport * as React from 'react';\nimport { useState, useCallback, useEffect, useLayoutEffect } from 'react';\nexport function renderCar(WrappedComponent, defaults) {\n    function State(_a) {\n        var stateRef = _a.stateRef, props = _a.props;\n        var renderTarget = useCallback(function SideTarget() {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            useLayoutEffect(function () {\n                stateRef.current(args);\n            });\n            return null;\n        }, []);\n        // @ts-ignore\n        return React.createElement(WrappedComponent, __assign({}, props, { children: renderTarget }));\n    }\n    var Children = React.memo(function (_a) {\n        var stateRef = _a.stateRef, defaultState = _a.defaultState, children = _a.children;\n        var _b = useState(defaultState.current), state = _b[0], setState = _b[1];\n        useEffect(function () {\n            stateRef.current = setState;\n        }, []);\n        return children.apply(void 0, state);\n    }, function () { return true; });\n    return function Combiner(props) {\n        var defaultState = React.useRef(defaults(props));\n        var ref = React.useRef(function (state) { return (defaultState.current = state); });\n        return (React.createElement(React.Fragment, null,\n            React.createElement(State, { stateRef: ref, props: props }),\n            React.createElement(Children, { stateRef: ref, defaultState: defaultState, children: props.children })));\n    };\n}\n", "import { __assign, __rest } from \"tslib\";\nimport * as React from 'react';\nvar SideCar = function (_a) {\n    var sideCar = _a.sideCar, rest = __rest(_a, [\"sideCar\"]);\n    if (!sideCar) {\n        throw new Error('Sidecar: please provide `sideCar` property to import the right car');\n    }\n    var Target = sideCar.read();\n    if (!Target) {\n        throw new Error('Sidecar medium not found');\n    }\n    return React.createElement(Target, __assign({}, rest));\n};\nSideCar.isSideCarExport = true;\nexport function exportSidecar(medium, exported) {\n    medium.useMedium(exported);\n    return SideCar;\n}\n", "import { createSidecarMedium } from 'use-sidecar';\nexport var effectCar = createSidecarMedium();\n", "import { __spreadArray } from \"tslib\";\nimport * as React from 'react';\nimport { RemoveScrollBar } from 'react-remove-scroll-bar';\nimport { styleSingleton } from 'react-style-singleton';\nimport { nonPassive } from './aggresiveCapture';\nimport { handleScroll, locationCouldBeScrolled } from './handleScroll';\nexport var getTouchXY = function (event) {\n    return 'changedTouches' in event ? [event.changedTouches[0].clientX, event.changedTouches[0].clientY] : [0, 0];\n};\nexport var getDeltaXY = function (event) { return [event.deltaX, event.deltaY]; };\nvar extractRef = function (ref) {\n    return ref && 'current' in ref ? ref.current : ref;\n};\nvar deltaCompare = function (x, y) { return x[0] === y[0] && x[1] === y[1]; };\nvar generateStyle = function (id) { return \"\\n  .block-interactivity-\".concat(id, \" {pointer-events: none;}\\n  .allow-interactivity-\").concat(id, \" {pointer-events: all;}\\n\"); };\nvar idCounter = 0;\nvar lockStack = [];\nexport function RemoveScrollSideCar(props) {\n    var shouldPreventQueue = React.useRef([]);\n    var touchStartRef = React.useRef([0, 0]);\n    var activeAxis = React.useRef();\n    var id = React.useState(idCounter++)[0];\n    var Style = React.useState(function () { return styleSingleton(); })[0];\n    var lastProps = React.useRef(props);\n    React.useEffect(function () {\n        lastProps.current = props;\n    }, [props]);\n    React.useEffect(function () {\n        if (props.inert) {\n            document.body.classList.add(\"block-interactivity-\".concat(id));\n            var allow_1 = __spreadArray([props.lockRef.current], (props.shards || []).map(extractRef), true).filter(Boolean);\n            allow_1.forEach(function (el) { return el.classList.add(\"allow-interactivity-\".concat(id)); });\n            return function () {\n                document.body.classList.remove(\"block-interactivity-\".concat(id));\n                allow_1.forEach(function (el) { return el.classList.remove(\"allow-interactivity-\".concat(id)); });\n            };\n        }\n        return;\n    }, [props.inert, props.lockRef.current, props.shards]);\n    var shouldCancelEvent = React.useCallback(function (event, parent) {\n        if ('touches' in event && event.touches.length === 2) {\n            return !lastProps.current.allowPinchZoom;\n        }\n        var touch = getTouchXY(event);\n        var touchStart = touchStartRef.current;\n        var deltaX = 'deltaX' in event ? event.deltaX : touchStart[0] - touch[0];\n        var deltaY = 'deltaY' in event ? event.deltaY : touchStart[1] - touch[1];\n        var currentAxis;\n        var target = event.target;\n        var moveDirection = Math.abs(deltaX) > Math.abs(deltaY) ? 'h' : 'v';\n        // allow horizontal touch move on Range inputs. They will not cause any scroll\n        if ('touches' in event && moveDirection === 'h' && target.type === 'range') {\n            return false;\n        }\n        var canBeScrolledInMainDirection = locationCouldBeScrolled(moveDirection, target);\n        if (!canBeScrolledInMainDirection) {\n            return true;\n        }\n        if (canBeScrolledInMainDirection) {\n            currentAxis = moveDirection;\n        }\n        else {\n            currentAxis = moveDirection === 'v' ? 'h' : 'v';\n            canBeScrolledInMainDirection = locationCouldBeScrolled(moveDirection, target);\n            // other axis might be not scrollable\n        }\n        if (!canBeScrolledInMainDirection) {\n            return false;\n        }\n        if (!activeAxis.current && 'changedTouches' in event && (deltaX || deltaY)) {\n            activeAxis.current = currentAxis;\n        }\n        if (!currentAxis) {\n            return true;\n        }\n        var cancelingAxis = activeAxis.current || currentAxis;\n        return handleScroll(cancelingAxis, parent, event, cancelingAxis === 'h' ? deltaX : deltaY, true);\n    }, []);\n    var shouldPrevent = React.useCallback(function (_event) {\n        var event = _event;\n        if (!lockStack.length || lockStack[lockStack.length - 1] !== Style) {\n            // not the last active\n            return;\n        }\n        var delta = 'deltaY' in event ? getDeltaXY(event) : getTouchXY(event);\n        var sourceEvent = shouldPreventQueue.current.filter(function (e) { return e.name === event.type && e.target === event.target && deltaCompare(e.delta, delta); })[0];\n        // self event, and should be canceled\n        if (sourceEvent && sourceEvent.should) {\n            if (event.cancelable) {\n                event.preventDefault();\n            }\n            return;\n        }\n        // outside or shard event\n        if (!sourceEvent) {\n            var shardNodes = (lastProps.current.shards || [])\n                .map(extractRef)\n                .filter(Boolean)\n                .filter(function (node) { return node.contains(event.target); });\n            var shouldStop = shardNodes.length > 0 ? shouldCancelEvent(event, shardNodes[0]) : !lastProps.current.noIsolation;\n            if (shouldStop) {\n                if (event.cancelable) {\n                    event.preventDefault();\n                }\n            }\n        }\n    }, []);\n    var shouldCancel = React.useCallback(function (name, delta, target, should) {\n        var event = { name: name, delta: delta, target: target, should: should };\n        shouldPreventQueue.current.push(event);\n        setTimeout(function () {\n            shouldPreventQueue.current = shouldPreventQueue.current.filter(function (e) { return e !== event; });\n        }, 1);\n    }, []);\n    var scrollTouchStart = React.useCallback(function (event) {\n        touchStartRef.current = getTouchXY(event);\n        activeAxis.current = undefined;\n    }, []);\n    var scrollWheel = React.useCallback(function (event) {\n        shouldCancel(event.type, getDeltaXY(event), event.target, shouldCancelEvent(event, props.lockRef.current));\n    }, []);\n    var scrollTouchMove = React.useCallback(function (event) {\n        shouldCancel(event.type, getTouchXY(event), event.target, shouldCancelEvent(event, props.lockRef.current));\n    }, []);\n    React.useEffect(function () {\n        lockStack.push(Style);\n        props.setCallbacks({\n            onScrollCapture: scrollWheel,\n            onWheelCapture: scrollWheel,\n            onTouchMoveCapture: scrollTouchMove,\n        });\n        document.addEventListener('wheel', shouldPrevent, nonPassive);\n        document.addEventListener('touchmove', shouldPrevent, nonPassive);\n        document.addEventListener('touchstart', scrollTouchStart, nonPassive);\n        return function () {\n            lockStack = lockStack.filter(function (inst) { return inst !== Style; });\n            document.removeEventListener('wheel', shouldPrevent, nonPassive);\n            document.removeEventListener('touchmove', shouldPrevent, nonPassive);\n            document.removeEventListener('touchstart', scrollTouchStart, nonPassive);\n        };\n    }, []);\n    var removeScrollBar = props.removeScrollBar, inert = props.inert;\n    return (React.createElement(React.Fragment, null,\n        inert ? React.createElement(Style, { styles: generateStyle(id) }) : null,\n        removeScrollBar ? React.createElement(RemoveScrollBar, { gapMode: \"margin\" }) : null));\n}\n", "import * as React from 'react';\nimport { styleSingleton } from 'react-style-singleton';\nimport { fullWidthClassName, zeroRightClassName, noScrollbarsClassName, removedBarSizeVariable } from './constants';\nimport { getGapWidth } from './utils';\nvar Style = styleSingleton();\nexport var lockAttribute = 'data-scroll-locked';\n// important tip - once we measure scrollBar width and remove them\n// we could not repeat this operation\n// thus we are using style-singleton - only the first \"yet correct\" style will be applied.\nvar getStyles = function (_a, allowRelative, gapMode, important) {\n    var left = _a.left, top = _a.top, right = _a.right, gap = _a.gap;\n    if (gapMode === void 0) { gapMode = 'margin'; }\n    return \"\\n  .\".concat(noScrollbarsClassName, \" {\\n   overflow: hidden \").concat(important, \";\\n   padding-right: \").concat(gap, \"px \").concat(important, \";\\n  }\\n  body[\").concat(lockAttribute, \"] {\\n    overflow: hidden \").concat(important, \";\\n    overscroll-behavior: contain;\\n    \").concat([\n        allowRelative && \"position: relative \".concat(important, \";\"),\n        gapMode === 'margin' &&\n            \"\\n    padding-left: \".concat(left, \"px;\\n    padding-top: \").concat(top, \"px;\\n    padding-right: \").concat(right, \"px;\\n    margin-left:0;\\n    margin-top:0;\\n    margin-right: \").concat(gap, \"px \").concat(important, \";\\n    \"),\n        gapMode === 'padding' && \"padding-right: \".concat(gap, \"px \").concat(important, \";\"),\n    ]\n        .filter(Boolean)\n        .join(''), \"\\n  }\\n  \\n  .\").concat(zeroRightClassName, \" {\\n    right: \").concat(gap, \"px \").concat(important, \";\\n  }\\n  \\n  .\").concat(fullWidthClassName, \" {\\n    margin-right: \").concat(gap, \"px \").concat(important, \";\\n  }\\n  \\n  .\").concat(zeroRightClassName, \" .\").concat(zeroRightClassName, \" {\\n    right: 0 \").concat(important, \";\\n  }\\n  \\n  .\").concat(fullWidthClassName, \" .\").concat(fullWidthClassName, \" {\\n    margin-right: 0 \").concat(important, \";\\n  }\\n  \\n  body[\").concat(lockAttribute, \"] {\\n    \").concat(removedBarSizeVariable, \": \").concat(gap, \"px;\\n  }\\n\");\n};\nvar getCurrentUseCounter = function () {\n    var counter = parseInt(document.body.getAttribute(lockAttribute) || '0', 10);\n    return isFinite(counter) ? counter : 0;\n};\nexport var useLockAttribute = function () {\n    React.useEffect(function () {\n        document.body.setAttribute(lockAttribute, (getCurrentUseCounter() + 1).toString());\n        return function () {\n            var newCounter = getCurrentUseCounter() - 1;\n            if (newCounter <= 0) {\n                document.body.removeAttribute(lockAttribute);\n            }\n            else {\n                document.body.setAttribute(lockAttribute, newCounter.toString());\n            }\n        };\n    }, []);\n};\n/**\n * Removes page scrollbar and blocks page scroll when mounted\n */\nexport var RemoveScrollBar = function (_a) {\n    var noRelative = _a.noRelative, noImportant = _a.noImportant, _b = _a.gapMode, gapMode = _b === void 0 ? 'margin' : _b;\n    useLockAttribute();\n    /*\n     gap will be measured on every component mount\n     however it will be used only by the \"first\" invocation\n     due to singleton nature of <Style\n     */\n    var gap = React.useMemo(function () { return getGapWidth(gapMode); }, [gapMode]);\n    return React.createElement(Style, { styles: getStyles(gap, !noRelative, gapMode, !noImportant ? '!important' : '') });\n};\n", "import * as React from 'react';\nimport { stylesheetSingleton } from './singleton';\n/**\n * creates a hook to control style singleton\n * @see {@link styleSingleton} for a safer component version\n * @example\n * ```tsx\n * const useStyle = styleHookSingleton();\n * ///\n * useStyle('body { overflow: hidden}');\n */\nexport var styleHookSingleton = function () {\n    var sheet = stylesheetSingleton();\n    return function (styles, isDynamic) {\n        React.useEffect(function () {\n            sheet.add(styles);\n            return function () {\n                sheet.remove();\n            };\n        }, [styles && isDynamic]);\n    };\n};\n", "var currentNonce;\nexport var setNonce = function (nonce) {\n    currentNonce = nonce;\n};\nexport var getNonce = function () {\n    if (currentNonce) {\n        return currentNonce;\n    }\n    if (typeof __webpack_nonce__ !== 'undefined') {\n        return __webpack_nonce__;\n    }\n    return undefined;\n};\n", "import { getNonce } from 'get-nonce';\nfunction makeStyleTag() {\n    if (!document)\n        return null;\n    var tag = document.createElement('style');\n    tag.type = 'text/css';\n    var nonce = getNonce();\n    if (nonce) {\n        tag.setAttribute('nonce', nonce);\n    }\n    return tag;\n}\nfunction injectStyles(tag, css) {\n    // @ts-ignore\n    if (tag.styleSheet) {\n        // @ts-ignore\n        tag.styleSheet.cssText = css;\n    }\n    else {\n        tag.appendChild(document.createTextNode(css));\n    }\n}\nfunction insertStyleTag(tag) {\n    var head = document.head || document.getElementsByTagName('head')[0];\n    head.appendChild(tag);\n}\nexport var stylesheetSingleton = function () {\n    var counter = 0;\n    var stylesheet = null;\n    return {\n        add: function (style) {\n            if (counter == 0) {\n                if ((stylesheet = makeStyleTag())) {\n                    injectStyles(stylesheet, style);\n                    insertStyleTag(stylesheet);\n                }\n            }\n            counter++;\n        },\n        remove: function () {\n            counter--;\n            if (!counter && stylesheet) {\n                stylesheet.parentNode && stylesheet.parentNode.removeChild(stylesheet);\n                stylesheet = null;\n            }\n        },\n    };\n};\n", "import { styleHookSingleton } from './hook';\n/**\n * create a Component to add styles on demand\n * - styles are added when first instance is mounted\n * - styles are removed when the last instance is unmounted\n * - changing styles in runtime does nothing unless dynamic is set. But with multiple components that can lead to the undefined behavior\n */\nexport var styleSingleton = function () {\n    var useStyle = styleHookSingleton();\n    var Sheet = function (_a) {\n        var styles = _a.styles, dynamic = _a.dynamic;\n        useStyle(styles, dynamic);\n        return null;\n    };\n    return Sheet;\n};\n", "export var zeroGap = {\n    left: 0,\n    top: 0,\n    right: 0,\n    gap: 0,\n};\nvar parse = function (x) { return parseInt(x || '', 10) || 0; };\nvar getOffset = function (gapMode) {\n    var cs = window.getComputedStyle(document.body);\n    var left = cs[gapMode === 'padding' ? 'paddingLeft' : 'marginLeft'];\n    var top = cs[gapMode === 'padding' ? 'paddingTop' : 'marginTop'];\n    var right = cs[gapMode === 'padding' ? 'paddingRight' : 'marginRight'];\n    return [parse(left), parse(top), parse(right)];\n};\nexport var getGapWidth = function (gapMode) {\n    if (gapMode === void 0) { gapMode = 'margin'; }\n    if (typeof window === 'undefined') {\n        return zeroGap;\n    }\n    var offsets = getOffset(gapMode);\n    var documentWidth = document.documentElement.clientWidth;\n    var windowWidth = window.innerWidth;\n    return {\n        left: offsets[0],\n        top: offsets[1],\n        right: offsets[2],\n        gap: Math.max(0, windowWidth - documentWidth + offsets[2] - offsets[0]),\n    };\n};\n", "var passiveSupported = false;\nif (typeof window !== 'undefined') {\n    try {\n        var options = Object.defineProperty({}, 'passive', {\n            get: function () {\n                passiveSupported = true;\n                return true;\n            },\n        });\n        // @ts-ignore\n        window.addEventListener('test', options, options);\n        // @ts-ignore\n        window.removeEventListener('test', options, options);\n    }\n    catch (err) {\n        passiveSupported = false;\n    }\n}\nexport var nonPassive = passiveSupported ? { passive: false } : false;\n", "var alwaysContainsScroll = function (node) {\n    // textarea will always _contain_ scroll inside self. It only can be hidden\n    return node.tagName === 'TEXTAREA';\n};\nvar elementCanBeScrolled = function (node, overflow) {\n    var styles = window.getComputedStyle(node);\n    return (\n    // not-not-scrollable\n    styles[overflow] !== 'hidden' &&\n        // contains scroll inside self\n        !(styles.overflowY === styles.overflowX && !alwaysContainsScroll(node) && styles[overflow] === 'visible'));\n};\nvar elementCouldBeVScrolled = function (node) { return elementCanBeScrolled(node, 'overflowY'); };\nvar elementCouldBeHScrolled = function (node) { return elementCanBeScrolled(node, 'overflowX'); };\nexport var locationCouldBeScrolled = function (axis, node) {\n    var current = node;\n    do {\n        // Skip over shadow root\n        if (typeof ShadowRoot !== 'undefined' && current instanceof ShadowRoot) {\n            current = current.host;\n        }\n        var isScrollable = elementCouldBeScrolled(axis, current);\n        if (isScrollable) {\n            var _a = getScrollVariables(axis, current), s = _a[1], d = _a[2];\n            if (s > d) {\n                return true;\n            }\n        }\n        current = current.parentNode;\n    } while (current && current !== document.body);\n    return false;\n};\nvar getVScrollVariables = function (_a) {\n    var scrollTop = _a.scrollTop, scrollHeight = _a.scrollHeight, clientHeight = _a.clientHeight;\n    return [\n        scrollTop,\n        scrollHeight,\n        clientHeight,\n    ];\n};\nvar getHScrollVariables = function (_a) {\n    var scrollLeft = _a.scrollLeft, scrollWidth = _a.scrollWidth, clientWidth = _a.clientWidth;\n    return [\n        scrollLeft,\n        scrollWidth,\n        clientWidth,\n    ];\n};\nvar elementCouldBeScrolled = function (axis, node) {\n    return axis === 'v' ? elementCouldBeVScrolled(node) : elementCouldBeHScrolled(node);\n};\nvar getScrollVariables = function (axis, node) {\n    return axis === 'v' ? getVScrollVariables(node) : getHScrollVariables(node);\n};\nvar getDirectionFactor = function (axis, direction) {\n    /**\n     * If the element's direction is rtl (right-to-left), then scrollLeft is 0 when the scrollbar is at its rightmost position,\n     * and then increasingly negative as you scroll towards the end of the content.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollLeft\n     */\n    return axis === 'h' && direction === 'rtl' ? -1 : 1;\n};\nexport var handleScroll = function (axis, endTarget, event, sourceDelta, noOverscroll) {\n    var directionFactor = getDirectionFactor(axis, window.getComputedStyle(endTarget).direction);\n    var delta = directionFactor * sourceDelta;\n    // find scrollable target\n    var target = event.target;\n    var targetInLock = endTarget.contains(target);\n    var shouldCancelScroll = false;\n    var isDeltaPositive = delta > 0;\n    var availableScroll = 0;\n    var availableScrollTop = 0;\n    do {\n        var _a = getScrollVariables(axis, target), position = _a[0], scroll_1 = _a[1], capacity = _a[2];\n        var elementScroll = scroll_1 - capacity - directionFactor * position;\n        if (position || elementScroll) {\n            if (elementCouldBeScrolled(axis, target)) {\n                availableScroll += elementScroll;\n                availableScrollTop += position;\n            }\n        }\n        target = target.parentNode;\n    } while (\n    // portaled content\n    (!targetInLock && target !== document.body) ||\n        // self content\n        (targetInLock && (endTarget.contains(target) || endTarget === target)));\n    if (isDeltaPositive && ((noOverscroll && availableScroll === 0) || (!noOverscroll && delta > availableScroll))) {\n        shouldCancelScroll = true;\n    }\n    else if (!isDeltaPositive &&\n        ((noOverscroll && availableScrollTop === 0) || (!noOverscroll && -delta > availableScrollTop))) {\n        shouldCancelScroll = true;\n    }\n    return shouldCancelScroll;\n};\n", "import { exportSidecar } from 'use-sidecar';\nimport { RemoveScrollSideCar } from './SideEffect';\nimport { effectCar } from './medium';\nexport default exportSidecar(effectCar, RemoveScrollSideCar);\n", "var getDefaultParent = function (originalTarget) {\n    if (typeof document === 'undefined') {\n        return null;\n    }\n    var sampleTarget = Array.isArray(originalTarget) ? originalTarget[0] : originalTarget;\n    return sampleTarget.ownerDocument.body;\n};\nvar counterMap = new WeakMap();\nvar uncontrolledNodes = new WeakMap();\nvar markerMap = {};\nvar lockCount = 0;\nvar unwrapHost = function (node) {\n    return node && (node.host || unwrapHost(node.parentNode));\n};\nvar correctTargets = function (parent, targets) {\n    return targets\n        .map(function (target) {\n        if (parent.contains(target)) {\n            return target;\n        }\n        var correctedTarget = unwrapHost(target);\n        if (correctedTarget && parent.contains(correctedTarget)) {\n            return correctedTarget;\n        }\n        console.error('aria-hidden', target, 'in not contained inside', parent, '. Doing nothing');\n        return null;\n    })\n        .filter(function (x) { return Boolean(x); });\n};\n/**\n * Marks everything except given node(or nodes) as aria-hidden\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @param {String} [controlAttribute] - html Attribute to control\n * @return {Undo} undo command\n */\nvar applyAttributeToOthers = function (originalTarget, parentNode, markerName, controlAttribute) {\n    var targets = correctTargets(parentNode, Array.isArray(originalTarget) ? originalTarget : [originalTarget]);\n    if (!markerMap[markerName]) {\n        markerMap[markerName] = new WeakMap();\n    }\n    var markerCounter = markerMap[markerName];\n    var hiddenNodes = [];\n    var elementsToKeep = new Set();\n    var elementsToStop = new Set(targets);\n    var keep = function (el) {\n        if (!el || elementsToKeep.has(el)) {\n            return;\n        }\n        elementsToKeep.add(el);\n        keep(el.parentNode);\n    };\n    targets.forEach(keep);\n    var deep = function (parent) {\n        if (!parent || elementsToStop.has(parent)) {\n            return;\n        }\n        Array.prototype.forEach.call(parent.children, function (node) {\n            if (elementsToKeep.has(node)) {\n                deep(node);\n            }\n            else {\n                try {\n                    var attr = node.getAttribute(controlAttribute);\n                    var alreadyHidden = attr !== null && attr !== 'false';\n                    var counterValue = (counterMap.get(node) || 0) + 1;\n                    var markerValue = (markerCounter.get(node) || 0) + 1;\n                    counterMap.set(node, counterValue);\n                    markerCounter.set(node, markerValue);\n                    hiddenNodes.push(node);\n                    if (counterValue === 1 && alreadyHidden) {\n                        uncontrolledNodes.set(node, true);\n                    }\n                    if (markerValue === 1) {\n                        node.setAttribute(markerName, 'true');\n                    }\n                    if (!alreadyHidden) {\n                        node.setAttribute(controlAttribute, 'true');\n                    }\n                }\n                catch (e) {\n                    console.error('aria-hidden: cannot operate on ', node, e);\n                }\n            }\n        });\n    };\n    deep(parentNode);\n    elementsToKeep.clear();\n    lockCount++;\n    return function () {\n        hiddenNodes.forEach(function (node) {\n            var counterValue = counterMap.get(node) - 1;\n            var markerValue = markerCounter.get(node) - 1;\n            counterMap.set(node, counterValue);\n            markerCounter.set(node, markerValue);\n            if (!counterValue) {\n                if (!uncontrolledNodes.has(node)) {\n                    node.removeAttribute(controlAttribute);\n                }\n                uncontrolledNodes.delete(node);\n            }\n            if (!markerValue) {\n                node.removeAttribute(markerName);\n            }\n        });\n        lockCount--;\n        if (!lockCount) {\n            // clear\n            counterMap = new WeakMap();\n            counterMap = new WeakMap();\n            uncontrolledNodes = new WeakMap();\n            markerMap = {};\n        }\n    };\n};\n/**\n * Marks everything except given node(or nodes) as aria-hidden\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport var hideOthers = function (originalTarget, parentNode, markerName) {\n    if (markerName === void 0) { markerName = 'data-aria-hidden'; }\n    var targets = Array.from(Array.isArray(originalTarget) ? originalTarget : [originalTarget]);\n    var activeParentNode = parentNode || getDefaultParent(originalTarget);\n    if (!activeParentNode) {\n        return function () { return null; };\n    }\n    // we should not hide ariaLive elements - https://github.com/theKashey/aria-hidden/issues/10\n    targets.push.apply(targets, Array.from(activeParentNode.querySelectorAll('[aria-live]')));\n    return applyAttributeToOthers(targets, activeParentNode, markerName, 'aria-hidden');\n};\n/**\n * Marks everything except given node(or nodes) as inert\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport var inertOthers = function (originalTarget, parentNode, markerName) {\n    if (markerName === void 0) { markerName = 'data-inert-ed'; }\n    var activeParentNode = parentNode || getDefaultParent(originalTarget);\n    if (!activeParentNode) {\n        return function () { return null; };\n    }\n    return applyAttributeToOthers(originalTarget, activeParentNode, markerName, 'inert');\n};\n/**\n * @returns if current browser supports inert\n */\nexport var supportsInert = function () {\n    return typeof HTMLElement !== 'undefined' && HTMLElement.prototype.hasOwnProperty('inert');\n};\n/**\n * Automatic function to \"suppress\" DOM elements - _hide_ or _inert_ in the best possible way\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport var suppressOthers = function (originalTarget, parentNode, markerName) {\n    if (markerName === void 0) { markerName = 'data-suppressed'; }\n    return (supportsInert() ? inertOthers : hideOthers)(originalTarget, parentNode, markerName);\n};\n", "export {\n  createDialogScope,\n  //\n  Dialog,\n  DialogTrigger,\n  DialogPortal,\n  DialogOverlay,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n  DialogClose,\n  //\n  Root,\n  Trigger,\n  Portal,\n  Overlay,\n  Content,\n  Title,\n  Description,\n  Close,\n  //\n  WarningProvider,\n} from './Dialog';\nexport type {\n  DialogProps,\n  DialogTriggerProps,\n  DialogPortalProps,\n  DialogOverlayProps,\n  DialogContentProps,\n  DialogTitleProps,\n  DialogDescriptionProps,\n  DialogCloseProps,\n} from './Dialog';\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContext, createContextScope } from '@radix-ui/react-context';\nimport { useId } from '@radix-ui/react-id';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { DismissableLayer } from '@radix-ui/react-dismissable-layer';\nimport { FocusScope } from '@radix-ui/react-focus-scope';\nimport { Portal as PortalPrimitive } from '@radix-ui/react-portal';\nimport { Presence } from '@radix-ui/react-presence';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useFocusGuards } from '@radix-ui/react-focus-guards';\nimport { RemoveScroll } from 'react-remove-scroll';\nimport { hideOthers } from 'aria-hidden';\nimport { Slot } from '@radix-ui/react-slot';\n\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\n\n/* -------------------------------------------------------------------------------------------------\n * Dialog\n * -----------------------------------------------------------------------------------------------*/\n\nconst DIALOG_NAME = 'Dialog';\n\ntype ScopedProps<P> = P & { __scopeDialog?: Scope };\nconst [createDialogContext, createDialogScope] = createContextScope(DIALOG_NAME);\n\ntype DialogContextValue = {\n  triggerRef: React.RefObject<HTMLButtonElement>;\n  contentRef: React.RefObject<DialogContentElement>;\n  contentId: string;\n  titleId: string;\n  descriptionId: string;\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  onOpenToggle(): void;\n  modal: boolean;\n};\n\nconst [DialogProvider, useDialogContext] = createDialogContext<DialogContextValue>(DIALOG_NAME);\n\ninterface DialogProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n  modal?: boolean;\n}\n\nconst Dialog: React.FC<DialogProps> = (props: ScopedProps<DialogProps>) => {\n  const {\n    __scopeDialog,\n    children,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    modal = true,\n  } = props;\n  const triggerRef = React.useRef<HTMLButtonElement>(null);\n  const contentRef = React.useRef<DialogContentElement>(null);\n  const [open = false, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen,\n    onChange: onOpenChange,\n  });\n\n  return (\n    <DialogProvider\n      scope={__scopeDialog}\n      triggerRef={triggerRef}\n      contentRef={contentRef}\n      contentId={useId()}\n      titleId={useId()}\n      descriptionId={useId()}\n      open={open}\n      onOpenChange={setOpen}\n      onOpenToggle={React.useCallback(() => setOpen((prevOpen) => !prevOpen), [setOpen])}\n      modal={modal}\n    >\n      {children}\n    </DialogProvider>\n  );\n};\n\nDialog.displayName = DIALOG_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'DialogTrigger';\n\ntype DialogTriggerElement = React.ElementRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = Radix.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface DialogTriggerProps extends PrimitiveButtonProps {}\n\nconst DialogTrigger = React.forwardRef<DialogTriggerElement, DialogTriggerProps>(\n  (props: ScopedProps<DialogTriggerProps>, forwardedRef) => {\n    const { __scopeDialog, ...triggerProps } = props;\n    const context = useDialogContext(TRIGGER_NAME, __scopeDialog);\n    const composedTriggerRef = useComposedRefs(forwardedRef, context.triggerRef);\n    return (\n      <Primitive.button\n        type=\"button\"\n        aria-haspopup=\"dialog\"\n        aria-expanded={context.open}\n        aria-controls={context.contentId}\n        data-state={getState(context.open)}\n        {...triggerProps}\n        ref={composedTriggerRef}\n        onClick={composeEventHandlers(props.onClick, context.onOpenToggle)}\n      />\n    );\n  }\n);\n\nDialogTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'DialogPortal';\n\ntype PortalContextValue = { forceMount?: true };\nconst [PortalProvider, usePortalContext] = createDialogContext<PortalContextValue>(PORTAL_NAME, {\n  forceMount: undefined,\n});\n\ntype PortalProps = React.ComponentPropsWithoutRef<typeof PortalPrimitive>;\ninterface DialogPortalProps {\n  children?: React.ReactNode;\n  /**\n   * Specify a container element to portal the content into.\n   */\n  container?: PortalProps['container'];\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst DialogPortal: React.FC<DialogPortalProps> = (props: ScopedProps<DialogPortalProps>) => {\n  const { __scopeDialog, forceMount, children, container } = props;\n  const context = useDialogContext(PORTAL_NAME, __scopeDialog);\n  return (\n    <PortalProvider scope={__scopeDialog} forceMount={forceMount}>\n      {React.Children.map(children, (child) => (\n        <Presence present={forceMount || context.open}>\n          <PortalPrimitive asChild container={container}>\n            {child}\n          </PortalPrimitive>\n        </Presence>\n      ))}\n    </PortalProvider>\n  );\n};\n\nDialogPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogOverlay\n * -----------------------------------------------------------------------------------------------*/\n\nconst OVERLAY_NAME = 'DialogOverlay';\n\ntype DialogOverlayElement = DialogOverlayImplElement;\ninterface DialogOverlayProps extends DialogOverlayImplProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst DialogOverlay = React.forwardRef<DialogOverlayElement, DialogOverlayProps>(\n  (props: ScopedProps<DialogOverlayProps>, forwardedRef) => {\n    const portalContext = usePortalContext(OVERLAY_NAME, props.__scopeDialog);\n    const { forceMount = portalContext.forceMount, ...overlayProps } = props;\n    const context = useDialogContext(OVERLAY_NAME, props.__scopeDialog);\n    return context.modal ? (\n      <Presence present={forceMount || context.open}>\n        <DialogOverlayImpl {...overlayProps} ref={forwardedRef} />\n      </Presence>\n    ) : null;\n  }\n);\n\nDialogOverlay.displayName = OVERLAY_NAME;\n\ntype DialogOverlayImplElement = React.ElementRef<typeof Primitive.div>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface DialogOverlayImplProps extends PrimitiveDivProps {}\n\nconst DialogOverlayImpl = React.forwardRef<DialogOverlayImplElement, DialogOverlayImplProps>(\n  (props: ScopedProps<DialogOverlayImplProps>, forwardedRef) => {\n    const { __scopeDialog, ...overlayProps } = props;\n    const context = useDialogContext(OVERLAY_NAME, __scopeDialog);\n    return (\n      // Make sure `Content` is scrollable even when it doesn't live inside `RemoveScroll`\n      // ie. when `Overlay` and `Content` are siblings\n      <RemoveScroll as={Slot} allowPinchZoom shards={[context.contentRef]}>\n        <Primitive.div\n          data-state={getState(context.open)}\n          {...overlayProps}\n          ref={forwardedRef}\n          // We re-enable pointer-events prevented by `Dialog.Content` to allow scrolling the overlay.\n          style={{ pointerEvents: 'auto', ...overlayProps.style }}\n        />\n      </RemoveScroll>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * DialogContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'DialogContent';\n\ntype DialogContentElement = DialogContentTypeElement;\ninterface DialogContentProps extends DialogContentTypeProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst DialogContent = React.forwardRef<DialogContentElement, DialogContentProps>(\n  (props: ScopedProps<DialogContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeDialog);\n    const { forceMount = portalContext.forceMount, ...contentProps } = props;\n    const context = useDialogContext(CONTENT_NAME, props.__scopeDialog);\n    return (\n      <Presence present={forceMount || context.open}>\n        {context.modal ? (\n          <DialogContentModal {...contentProps} ref={forwardedRef} />\n        ) : (\n          <DialogContentNonModal {...contentProps} ref={forwardedRef} />\n        )}\n      </Presence>\n    );\n  }\n);\n\nDialogContent.displayName = CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype DialogContentTypeElement = DialogContentImplElement;\ninterface DialogContentTypeProps\n  extends Omit<DialogContentImplProps, 'trapFocus' | 'disableOutsidePointerEvents'> {}\n\nconst DialogContentModal = React.forwardRef<DialogContentTypeElement, DialogContentTypeProps>(\n  (props: ScopedProps<DialogContentTypeProps>, forwardedRef) => {\n    const context = useDialogContext(CONTENT_NAME, props.__scopeDialog);\n    const contentRef = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, context.contentRef, contentRef);\n\n    // aria-hide everything except the content (better supported equivalent to setting aria-modal)\n    React.useEffect(() => {\n      const content = contentRef.current;\n      if (content) return hideOthers(content);\n    }, []);\n\n    return (\n      <DialogContentImpl\n        {...props}\n        ref={composedRefs}\n        // we make sure focus isn't trapped once `DialogContent` has been closed\n        // (closed !== unmounted when animating out)\n        trapFocus={context.open}\n        disableOutsidePointerEvents\n        onCloseAutoFocus={composeEventHandlers(props.onCloseAutoFocus, (event) => {\n          event.preventDefault();\n          context.triggerRef.current?.focus();\n        })}\n        onPointerDownOutside={composeEventHandlers(props.onPointerDownOutside, (event) => {\n          const originalEvent = event.detail.originalEvent;\n          const ctrlLeftClick = originalEvent.button === 0 && originalEvent.ctrlKey === true;\n          const isRightClick = originalEvent.button === 2 || ctrlLeftClick;\n\n          // If the event is a right-click, we shouldn't close because\n          // it is effectively as if we right-clicked the `Overlay`.\n          if (isRightClick) event.preventDefault();\n        })}\n        // When focus is trapped, a `focusout` event may still happen.\n        // We make sure we don't trigger our `onDismiss` in such case.\n        onFocusOutside={composeEventHandlers(props.onFocusOutside, (event) =>\n          event.preventDefault()\n        )}\n      />\n    );\n  }\n);\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst DialogContentNonModal = React.forwardRef<DialogContentTypeElement, DialogContentTypeProps>(\n  (props: ScopedProps<DialogContentTypeProps>, forwardedRef) => {\n    const context = useDialogContext(CONTENT_NAME, props.__scopeDialog);\n    const hasInteractedOutsideRef = React.useRef(false);\n    const hasPointerDownOutsideRef = React.useRef(false);\n\n    return (\n      <DialogContentImpl\n        {...props}\n        ref={forwardedRef}\n        trapFocus={false}\n        disableOutsidePointerEvents={false}\n        onCloseAutoFocus={(event) => {\n          props.onCloseAutoFocus?.(event);\n\n          if (!event.defaultPrevented) {\n            if (!hasInteractedOutsideRef.current) context.triggerRef.current?.focus();\n            // Always prevent auto focus because we either focus manually or want user agent focus\n            event.preventDefault();\n          }\n\n          hasInteractedOutsideRef.current = false;\n          hasPointerDownOutsideRef.current = false;\n        }}\n        onInteractOutside={(event) => {\n          props.onInteractOutside?.(event);\n\n          if (!event.defaultPrevented) {\n            hasInteractedOutsideRef.current = true;\n            if (event.detail.originalEvent.type === 'pointerdown') {\n              hasPointerDownOutsideRef.current = true;\n            }\n          }\n\n          // Prevent dismissing when clicking the trigger.\n          // As the trigger is already setup to close, without doing so would\n          // cause it to close and immediately open.\n          const target = event.target as HTMLElement;\n          const targetIsTrigger = context.triggerRef.current?.contains(target);\n          if (targetIsTrigger) event.preventDefault();\n\n          // On Safari if the trigger is inside a container with tabIndex={0}, when clicked\n          // we will get the pointer down outside event on the trigger, but then a subsequent\n          // focus outside event on the container, we ignore any focus outside event when we've\n          // already had a pointer down outside event.\n          if (event.detail.originalEvent.type === 'focusin' && hasPointerDownOutsideRef.current) {\n            event.preventDefault();\n          }\n        }}\n      />\n    );\n  }\n);\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype DialogContentImplElement = React.ElementRef<typeof DismissableLayer>;\ntype DismissableLayerProps = Radix.ComponentPropsWithoutRef<typeof DismissableLayer>;\ntype FocusScopeProps = Radix.ComponentPropsWithoutRef<typeof FocusScope>;\ninterface DialogContentImplProps extends Omit<DismissableLayerProps, 'onDismiss'> {\n  /**\n   * When `true`, focus cannot escape the `Content` via keyboard,\n   * pointer, or a programmatic focus.\n   * @defaultValue false\n   */\n  trapFocus?: FocusScopeProps['trapped'];\n\n  /**\n   * Event handler called when auto-focusing on open.\n   * Can be prevented.\n   */\n  onOpenAutoFocus?: FocusScopeProps['onMountAutoFocus'];\n\n  /**\n   * Event handler called when auto-focusing on close.\n   * Can be prevented.\n   */\n  onCloseAutoFocus?: FocusScopeProps['onUnmountAutoFocus'];\n}\n\nconst DialogContentImpl = React.forwardRef<DialogContentImplElement, DialogContentImplProps>(\n  (props: ScopedProps<DialogContentImplProps>, forwardedRef) => {\n    const { __scopeDialog, trapFocus, onOpenAutoFocus, onCloseAutoFocus, ...contentProps } = props;\n    const context = useDialogContext(CONTENT_NAME, __scopeDialog);\n    const contentRef = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef);\n\n    // Make sure the whole tree has focus guards as our `Dialog` will be\n    // the last element in the DOM (beacuse of the `Portal`)\n    useFocusGuards();\n\n    return (\n      <>\n        <FocusScope\n          asChild\n          loop\n          trapped={trapFocus}\n          onMountAutoFocus={onOpenAutoFocus}\n          onUnmountAutoFocus={onCloseAutoFocus}\n        >\n          <DismissableLayer\n            role=\"dialog\"\n            id={context.contentId}\n            aria-describedby={context.descriptionId}\n            aria-labelledby={context.titleId}\n            data-state={getState(context.open)}\n            {...contentProps}\n            ref={composedRefs}\n            onDismiss={() => context.onOpenChange(false)}\n          />\n        </FocusScope>\n        {process.env.NODE_ENV !== 'production' && (\n          <>\n            <TitleWarning titleId={context.titleId} />\n            <DescriptionWarning contentRef={contentRef} descriptionId={context.descriptionId} />\n          </>\n        )}\n      </>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * DialogTitle\n * -----------------------------------------------------------------------------------------------*/\n\nconst TITLE_NAME = 'DialogTitle';\n\ntype DialogTitleElement = React.ElementRef<typeof Primitive.h2>;\ntype PrimitiveHeading2Props = Radix.ComponentPropsWithoutRef<typeof Primitive.h2>;\ninterface DialogTitleProps extends PrimitiveHeading2Props {}\n\nconst DialogTitle = React.forwardRef<DialogTitleElement, DialogTitleProps>(\n  (props: ScopedProps<DialogTitleProps>, forwardedRef) => {\n    const { __scopeDialog, ...titleProps } = props;\n    const context = useDialogContext(TITLE_NAME, __scopeDialog);\n    return <Primitive.h2 id={context.titleId} {...titleProps} ref={forwardedRef} />;\n  }\n);\n\nDialogTitle.displayName = TITLE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogDescription\n * -----------------------------------------------------------------------------------------------*/\n\nconst DESCRIPTION_NAME = 'DialogDescription';\n\ntype DialogDescriptionElement = React.ElementRef<typeof Primitive.p>;\ntype PrimitiveParagraphProps = Radix.ComponentPropsWithoutRef<typeof Primitive.p>;\ninterface DialogDescriptionProps extends PrimitiveParagraphProps {}\n\nconst DialogDescription = React.forwardRef<DialogDescriptionElement, DialogDescriptionProps>(\n  (props: ScopedProps<DialogDescriptionProps>, forwardedRef) => {\n    const { __scopeDialog, ...descriptionProps } = props;\n    const context = useDialogContext(DESCRIPTION_NAME, __scopeDialog);\n    return <Primitive.p id={context.descriptionId} {...descriptionProps} ref={forwardedRef} />;\n  }\n);\n\nDialogDescription.displayName = DESCRIPTION_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DialogClose\n * -----------------------------------------------------------------------------------------------*/\n\nconst CLOSE_NAME = 'DialogClose';\n\ntype DialogCloseElement = React.ElementRef<typeof Primitive.button>;\ninterface DialogCloseProps extends PrimitiveButtonProps {}\n\nconst DialogClose = React.forwardRef<DialogCloseElement, DialogCloseProps>(\n  (props: ScopedProps<DialogCloseProps>, forwardedRef) => {\n    const { __scopeDialog, ...closeProps } = props;\n    const context = useDialogContext(CLOSE_NAME, __scopeDialog);\n    return (\n      <Primitive.button\n        type=\"button\"\n        {...closeProps}\n        ref={forwardedRef}\n        onClick={composeEventHandlers(props.onClick, () => context.onOpenChange(false))}\n      />\n    );\n  }\n);\n\nDialogClose.displayName = CLOSE_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction getState(open: boolean) {\n  return open ? 'open' : 'closed';\n}\n\nconst TITLE_WARNING_NAME = 'DialogTitleWarning';\n\nconst [WarningProvider, useWarningContext] = createContext(TITLE_WARNING_NAME, {\n  contentName: CONTENT_NAME,\n  titleName: TITLE_NAME,\n  docsSlug: 'dialog',\n});\n\ntype TitleWarningProps = { titleId?: string };\n\nconst TitleWarning: React.FC<TitleWarningProps> = ({ titleId }) => {\n  const titleWarningContext = useWarningContext(TITLE_WARNING_NAME);\n\n  const MESSAGE = `\\`${titleWarningContext.contentName}\\` requires a \\`${titleWarningContext.titleName}\\` for the component to be accessible for screen reader users.\n\nIf you want to hide the \\`${titleWarningContext.titleName}\\`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/${titleWarningContext.docsSlug}`;\n\n  React.useEffect(() => {\n    if (titleId) {\n      const hasTitle = document.getElementById(titleId);\n      if (!hasTitle) throw new Error(MESSAGE);\n    }\n  }, [MESSAGE, titleId]);\n\n  return null;\n};\n\nconst DESCRIPTION_WARNING_NAME = 'DialogDescriptionWarning';\n\ntype DescriptionWarningProps = {\n  contentRef: React.RefObject<DialogContentElement>;\n  descriptionId?: string;\n};\n\nconst DescriptionWarning: React.FC<DescriptionWarningProps> = ({ contentRef, descriptionId }) => {\n  const descriptionWarningContext = useWarningContext(DESCRIPTION_WARNING_NAME);\n  const MESSAGE = `Warning: Missing \\`Description\\` or \\`aria-describedby={undefined}\\` for {${descriptionWarningContext.contentName}}.`;\n\n  React.useEffect(() => {\n    const describedById = contentRef.current?.getAttribute('aria-describedby');\n    // if we have an id and the user hasn't set aria-describedby={undefined}\n    if (descriptionId && describedById) {\n      const hasDescription = document.getElementById(descriptionId);\n      if (!hasDescription) console.warn(MESSAGE);\n    }\n  }, [MESSAGE, contentRef, descriptionId]);\n\n  return null;\n};\n\nconst Root = Dialog;\nconst Trigger = DialogTrigger;\nconst Portal = DialogPortal;\nconst Overlay = DialogOverlay;\nconst Content = DialogContent;\nconst Title = DialogTitle;\nconst Description = DialogDescription;\nconst Close = DialogClose;\n\nexport {\n  createDialogScope,\n  //\n  Dialog,\n  DialogTrigger,\n  DialogPortal,\n  DialogOverlay,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n  DialogClose,\n  //\n  Root,\n  Trigger,\n  Portal,\n  Overlay,\n  Content,\n  Title,\n  Description,\n  Close,\n  //\n  WarningProvider,\n};\nexport type {\n  DialogProps,\n  DialogTriggerProps,\n  DialogPortalProps,\n  DialogOverlayProps,\n  DialogContentProps,\n  DialogTitleProps,\n  DialogDescriptionProps,\n  DialogCloseProps,\n};\n", "import { Editor, uniqueId, useEditor } from '@tldraw/editor'\nimport { ComponentType, ReactNode, createContext, useCallback, useContext, useState } from 'react'\nimport { useUiEvents } from './events'\n\n/** @public */\nexport interface TLUiDialogProps {\n\tonClose: () => void\n}\n\n/** @public */\nexport interface TLUiDialog {\n\tid: string\n\tonClose?: () => void\n\tcomponent: ComponentType<TLUiDialogProps>\n}\n\n/** @public */\nexport type TLUiDialogsContextType = {\n\taddDialog: (dialog: Omit<TLUiDialog, 'id'> & { id?: string }) => string\n\tremoveDialog: (id: string) => string\n\tupdateDialog: (id: string, newDialogData: Partial<TLUiDialog>) => string\n\tclearDialogs: () => void\n\tdialogs: TLUiDialog[]\n}\n\n/** @internal */\nexport const DialogsContext = createContext({} as TLUiDialogsContextType)\n\n/** @internal */\nexport type DialogsProviderProps = {\n\toverrides?: (editor: Editor) => TLUiDialogsContextType\n\tchildren: ReactNode\n}\n\n/** @internal */\nexport function DialogsProvider({ children }: DialogsProviderProps) {\n\tconst editor = useEditor()\n\tconst trackEvent = useUiEvents()\n\n\tconst [dialogs, setDialogs] = useState<TLUiDialog[]>([])\n\n\tconst addDialog = useCallback(\n\t\t(dialog: Omit<TLUiDialog, 'id'> & { id?: string }) => {\n\t\t\tconst id = dialog.id ?? uniqueId()\n\t\t\tsetDialogs((d) => {\n\t\t\t\treturn [...d.filter((m) => m.id !== dialog.id), { ...dialog, id }]\n\t\t\t})\n\n\t\t\ttrackEvent('open-menu', { source: 'dialog', id })\n\t\t\teditor.addOpenMenu(id)\n\n\t\t\treturn id\n\t\t},\n\t\t[editor, trackEvent]\n\t)\n\n\tconst updateDialog = useCallback(\n\t\t(id: string, newDialogData: Partial<TLUiDialog>) => {\n\t\t\tsetDialogs((d) =>\n\t\t\t\td.map((m) => {\n\t\t\t\t\tif (m.id === id) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...m,\n\t\t\t\t\t\t\t...newDialogData,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn m\n\t\t\t\t})\n\t\t\t)\n\n\t\t\ttrackEvent('open-menu', { source: 'dialog', id })\n\t\t\teditor.addOpenMenu(id)\n\n\t\t\treturn id\n\t\t},\n\t\t[editor, trackEvent]\n\t)\n\n\tconst removeDialog = useCallback(\n\t\t(id: string) => {\n\t\t\tsetDialogs((d) =>\n\t\t\t\td.filter((m) => {\n\t\t\t\t\tif (m.id === id) {\n\t\t\t\t\t\tm.onClose?.()\n\t\t\t\t\t\treturn false\n\t\t\t\t\t}\n\t\t\t\t\treturn true\n\t\t\t\t})\n\t\t\t)\n\n\t\t\ttrackEvent('close-menu', { source: 'dialog', id })\n\t\t\teditor.deleteOpenMenu(id)\n\n\t\t\treturn id\n\t\t},\n\t\t[editor, trackEvent]\n\t)\n\n\tconst clearDialogs = useCallback(() => {\n\t\tsetDialogs((d) => {\n\t\t\td.forEach((m) => {\n\t\t\t\tm.onClose?.()\n\t\t\t\ttrackEvent('close-menu', { source: 'dialog', id: m.id })\n\t\t\t\teditor.deleteOpenMenu(m.id)\n\t\t\t})\n\t\t\treturn []\n\t\t})\n\t}, [editor, trackEvent])\n\n\treturn (\n\t\t<DialogsContext.Provider\n\t\t\tvalue={{ dialogs, addDialog, removeDialog, clearDialogs, updateDialog }}\n\t\t>\n\t\t\t{children}\n\t\t</DialogsContext.Provider>\n\t)\n}\n\n/** @public */\nexport function useDialogs() {\n\tconst ctx = useContext(DialogsContext)\n\n\tif (!ctx) {\n\t\tthrow new Error('useDialogs must be used within a DialogsProvider')\n\t}\n\n\treturn ctx\n}\n", "import * as React from 'react'\n\n/** @public */\nexport type TLUiEventSource =\n\t| 'menu'\n\t| 'main-menu'\n\t| 'context-menu'\n\t| 'zoom-menu'\n\t| 'document-name'\n\t| 'navigation-zone'\n\t| 'quick-actions'\n\t| 'actions-menu'\n\t| 'kbd'\n\t| 'debug-panel'\n\t| 'page-menu'\n\t| 'share-menu'\n\t| 'export-menu'\n\t| 'toolbar'\n\t| 'people-menu'\n\t| 'dialog'\n\t| 'help-menu'\n\t| 'helper-buttons'\n\t| 'style-panel'\n\t| 'unknown'\n\n/** @public */\nexport interface TLUiEventMap {\n\t// Actions\n\tundo: null\n\tredo: null\n\t'change-language': { locale: string }\n\t'new-page': null\n\t'move-to-page': null\n\t'group-shapes': null\n\t'ungroup-shapes': null\n\t'remove-frame': null\n\t'fit-frame-to-content': null\n\t'convert-to-embed': null\n\t'convert-to-bookmark': null\n\t'open-embed-link': null\n\t'toggle-auto-size': null\n\t'copy-as': { format: 'svg' | 'png' | 'json' }\n\t'export-as': { format: 'svg' | 'png' | 'json' }\n\t'export-all-as': { format: 'svg' | 'png' | 'json' }\n\t'edit-link': null\n\t'insert-embed': null\n\t'insert-media': null\n\t'align-shapes': {\n\t\toperation: 'left' | 'center-horizontal' | 'right' | 'top' | 'center-vertical' | 'bottom'\n\t}\n\t'duplicate-shapes': null\n\t'pack-shapes': null\n\t'stack-shapes': { operation: 'horizontal' | 'vertical' }\n\t'flip-shapes': { operation: 'horizontal' | 'vertical' }\n\t'distribute-shapes': { operation: 'horizontal' | 'vertical' }\n\t'stretch-shapes': { operation: 'horizontal' | 'vertical' }\n\t'reorder-shapes': {\n\t\toperation: 'toBack' | 'toFront' | 'forward' | 'backward'\n\t}\n\t'delete-shapes': null\n\t'select-all-shapes': null\n\t'select-none-shapes': null\n\t'rotate-ccw': null\n\t'rotate-cw': null\n\t'zoom-in': null\n\t'zoom-out': null\n\t'zoom-to-fit': null\n\t'zoom-to-selection': null\n\t'reset-zoom': null\n\t'zoom-into-view': null\n\t'zoom-to-content': null\n\t'open-menu': { id: string }\n\t'close-menu': { id: string }\n\t'create-new-project': null\n\t'save-project-to-file': null\n\t'open-file': null\n\t'select-tool': { id: string }\n\tprint: null\n\tcopy: null\n\tpaste: null\n\tcut: null\n\t'set-style': { id: string; value: string | number }\n\t'toggle-transparent': null\n\t'toggle-snap-mode': null\n\t'toggle-tool-lock': null\n\t'toggle-grid-mode': null\n\t'toggle-dark-mode': null\n\t'toggle-wrap-mode': null\n\t'toggle-focus-mode': null\n\t'toggle-debug-mode': null\n\t'toggle-lock': null\n\t'toggle-reduce-motion': null\n\t'toggle-edge-scrolling': null\n\t'exit-pen-mode': null\n\t'stop-following': null\n\t'open-cursor-chat': null\n\t'zoom-tool': null\n\t'unlock-all': null\n}\n\ntype Join<T, K> = K extends null\n\t? { [R in keyof T]: T[R] }\n\t: { [R in keyof T]: T[R] } & { [R in keyof K]: K[R] }\n\n/** @public */\nexport type TLUiEventHandler<T extends keyof TLUiEventMap = keyof TLUiEventMap> = (\n\tname: T,\n\tdata: Join<{ source: TLUiEventSource }, TLUiEventMap[T]>\n) => void\n\n/** @internal */\nconst defaultEventHandler: TLUiEventHandler = () => void null\n\n/** @public */\nexport type TLUiEventContextType = TLUiEventHandler<keyof TLUiEventMap>\n\n/** @internal */\nexport const EventsContext = React.createContext<TLUiEventContextType>({} as TLUiEventContextType)\n\n/** @public */\nexport type EventsProviderProps = {\n\tonEvent?: TLUiEventHandler\n\tchildren: React.ReactNode\n}\n\n/** @public */\nexport function UiEventsProvider({ onEvent, children }: EventsProviderProps) {\n\treturn (\n\t\t<EventsContext.Provider value={onEvent ?? defaultEventHandler}>\n\t\t\t{children}\n\t\t</EventsContext.Provider>\n\t)\n}\n\n/** @public */\nexport function useUiEvents() {\n\tconst eventHandler = React.useContext(EventsContext)\n\treturn eventHandler ?? defaultEventHandler\n}\n", "import { useEditor, usePresence, useValue } from '@tldraw/editor'\n\nexport function FollowingIndicator() {\n\tconst editor = useEditor()\n\tconst followingUserId = useValue('follow', () => editor.getInstanceState().followingUserId, [\n\t\teditor,\n\t])\n\tif (!followingUserId) return null\n\treturn <FollowingIndicatorInner userId={followingUserId} />\n}\n\nfunction FollowingIndicatorInner({ userId }: { userId: string }) {\n\tconst presence = usePresence(userId)\n\tif (!presence) return null\n\treturn <div className=\"tlui-following-indicator\" style={{ borderColor: presence.color }} />\n}\n", "import * as T from '@radix-ui/react-toast'\nimport * as React from 'react'\nimport { AlertSeverity, TLUiToast, useToasts } from '../context/toasts'\nimport { useTranslation } from '../hooks/useTranslation/useTranslation'\nimport { TLUiIconType } from '../icon-types'\nimport { TldrawUiButton } from './primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonLabel } from './primitives/Button/TldrawUiButtonLabel'\nimport { TldrawUiIcon } from './primitives/TldrawUiIcon'\n\nconst SEVERITY_TO_ICON: { [msg in AlertSeverity]: TLUiIconType } = {\n\tsuccess: 'check-circle',\n\twarning: 'warning-triangle',\n\terror: 'cross-circle',\n\tinfo: 'info-circle',\n}\n\nfunction Toast({ toast }: { toast: TLUiToast }) {\n\tconst { removeToast } = useToasts()\n\tconst msg = useTranslation()\n\n\tconst onOpenChange = (isOpen: boolean) => {\n\t\tif (!isOpen) {\n\t\t\tremoveToast(toast.id)\n\t\t}\n\t}\n\n\tconst hasActions = toast.actions && toast.actions.length > 0\n\n\tconst icon = toast.icon || (toast.severity && SEVERITY_TO_ICON[toast.severity])\n\n\treturn (\n\t\t<T.Root\n\t\t\tonOpenChange={onOpenChange}\n\t\t\tclassName=\"tlui-toast__container\"\n\t\t\tduration={toast.keepOpen ? Infinity : 5000}\n\t\t\tdata-severity={toast.severity}\n\t\t>\n\t\t\t{icon && (\n\t\t\t\t<div className=\"tlui-toast__icon\">\n\t\t\t\t\t<TldrawUiIcon icon={icon} />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t\t<div className=\"tlui-toast__main\">\n\t\t\t\t<div className=\"tlui-toast__content\">\n\t\t\t\t\t{toast.title && <T.Title className=\"tlui-toast__title\">{toast.title}</T.Title>}\n\t\t\t\t\t{toast.description && (\n\t\t\t\t\t\t<T.Description className=\"tlui-toast__description\">{toast.description}</T.Description>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t{toast.actions && (\n\t\t\t\t\t<div className=\"tlui-toast__actions\">\n\t\t\t\t\t\t{toast.actions.map((action, i) => (\n\t\t\t\t\t\t\t<T.Action key={i} altText={action.label} asChild onClick={action.onClick}>\n\t\t\t\t\t\t\t\t<TldrawUiButton type={action.type}>\n\t\t\t\t\t\t\t\t\t<TldrawUiButtonLabel>{action.label}</TldrawUiButtonLabel>\n\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t</T.Action>\n\t\t\t\t\t\t))}\n\t\t\t\t\t\t<T.Close asChild>\n\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\ttype=\"normal\"\n\t\t\t\t\t\t\t\tclassName=\"tlui-toast__close\"\n\t\t\t\t\t\t\t\tstyle={{ marginLeft: 'auto' }}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TldrawUiButtonLabel>{toast.closeLabel ?? msg('toast.close')}</TldrawUiButtonLabel>\n\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t</T.Close>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t\t{!hasActions && (\n\t\t\t\t<T.Close asChild>\n\t\t\t\t\t<TldrawUiButton type=\"normal\" className=\"tlui-toast__close\">\n\t\t\t\t\t\t<TldrawUiButtonLabel>{toast.closeLabel ?? msg('toast.close')}</TldrawUiButtonLabel>\n\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t</T.Close>\n\t\t\t)}\n\t\t</T.Root>\n\t)\n}\n\nfunction _Toasts() {\n\tconst { toasts } = useToasts()\n\n\treturn (\n\t\t<>\n\t\t\t{toasts.map((toast) => (\n\t\t\t\t<Toast key={toast.id} toast={toast} />\n\t\t\t))}\n\t\t</>\n\t)\n}\n\nexport const Toasts = React.memo(_Toasts)\n\nexport function ToastViewport() {\n\tconst { toasts } = useToasts()\n\n\tconst [hasToasts, setHasToasts] = React.useState(false)\n\n\tReact.useEffect(() => {\n\t\tlet cancelled = false\n\t\tif (toasts.length) {\n\t\t\tsetHasToasts(true)\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!cancelled) {\n\t\t\t\t\tsetHasToasts(false)\n\t\t\t\t}\n\t\t\t}, 1000)\n\t\t}\n\n\t\treturn () => {\n\t\t\tcancelled = true\n\t\t}\n\t}, [toasts.length, setHasToasts])\n\n\tif (!hasToasts) return null\n\n\treturn <T.ToastViewport className=\"tlui-toast__viewport\" />\n}\n", "import { Editor, uniqueId } from '@tldraw/editor'\nimport { ReactNode, createContext, useCallback, useContext, useState } from 'react'\nimport { TLUiIconType } from '../icon-types'\n\n/** @public */\nexport type AlertSeverity = 'success' | 'info' | 'warning' | 'error'\n\n/** @public */\nexport interface TLUiToast {\n\tid: string\n\ticon?: TLUiIconType\n\tseverity?: AlertSeverity\n\ttitle?: string\n\tdescription?: string\n\tactions?: TLUiToastAction[]\n\tkeepOpen?: boolean\n\tcloseLabel?: string\n}\n\n/** @public */\nexport interface TLUiToastAction {\n\ttype: 'primary' | 'danger' | 'normal'\n\tlabel: string\n\tonClick: () => void\n}\n\n/** @public */\nexport type TLUiToastsContextType = {\n\taddToast: (toast: Omit<TLUiToast, 'id'> & { id?: string }) => string\n\tremoveToast: (id: TLUiToast['id']) => string\n\tclearToasts: () => void\n\ttoasts: TLUiToast[]\n}\n\n/** @internal */\nexport const ToastsContext = createContext({} as TLUiToastsContextType)\n\n/** @internal */\nexport type ToastsProviderProps = {\n\toverrides?: (editor: Editor) => TLUiToastsContextType\n\tchildren: ReactNode\n}\n\n/** @internal */\nexport function ToastsProvider({ children }: ToastsProviderProps) {\n\tconst [toasts, setToasts] = useState<TLUiToast[]>([])\n\n\tconst addToast = useCallback((toast: Omit<TLUiToast, 'id'> & { id?: string }) => {\n\t\tconst id = toast.id ?? uniqueId()\n\t\tsetToasts((d) => [...d.filter((m) => m.id !== toast.id), { ...toast, id }])\n\t\treturn id\n\t}, [])\n\n\tconst removeToast = useCallback((id: string) => {\n\t\tsetToasts((d) => d.filter((m) => m.id !== id))\n\t\treturn id\n\t}, [])\n\n\tconst clearToasts = useCallback(() => {\n\t\tsetToasts(() => [])\n\t}, [])\n\n\treturn (\n\t\t<ToastsContext.Provider value={{ toasts, addToast, removeToast, clearToasts }}>\n\t\t\t{children}\n\t\t</ToastsContext.Provider>\n\t)\n}\n\n/** @public */\nexport function useToasts() {\n\tconst ctx = useContext(ToastsContext)\n\n\tif (!ctx) {\n\t\tthrow new Error('useToasts must be used within a ToastsProvider')\n\t}\n\n\treturn ctx\n}\n", "import { useEditor } from '@tldraw/editor'\nimport classnames from 'classnames'\nimport * as React from 'react'\n\n/** @public */\nexport interface TLUiButtonProps extends React.HTMLAttributes<HTMLButtonElement> {\n\tdisabled?: boolean\n\ttype: 'normal' | 'primary' | 'danger' | 'low' | 'icon' | 'tool' | 'menu' | 'help'\n}\n\n/** @public */\nexport const TldrawUiButton = React.forwardRef<HTMLButtonElement, TLUiButtonProps>(\n\tfunction TldrawUiButton({ children, disabled, type, ...props }, ref) {\n\t\tconst editor = useEditor()\n\n\t\t// If the button is getting disabled while it's focused, move focus to the editor\n\t\t// so that the user can continue using keyboard shortcuts\n\t\tconst current = (ref as React.MutableRefObject<HTMLButtonElement | null>)?.current\n\t\tif (disabled && current === document.activeElement) {\n\t\t\teditor.getContainer().focus()\n\t\t}\n\n\t\treturn (\n\t\t\t<button\n\t\t\t\tref={ref}\n\t\t\t\ttype=\"button\"\n\t\t\t\tdraggable={false}\n\t\t\t\tdisabled={disabled}\n\t\t\t\t{...props}\n\t\t\t\tclassName={classnames('tlui-button', `tlui-button__${type}`, props.className)}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</button>\n\t\t)\n\t}\n)\n", "import { ReactNode } from 'react'\n\n/** @public */\nexport type TLUiButtonLabelProps = { children?: ReactNode }\n\n/** @public */\nexport function TldrawUiButtonLabel({ children }: TLUiButtonLabelProps) {\n\treturn <span className=\"tlui-button__label\">{children}</span>\n}\n", "import classNames from 'classnames'\nimport { memo, useLayoutEffect, useRef } from 'react'\nimport { useAssetUrls } from '../../context/asset-urls'\nimport { TLUiIconType } from '../../icon-types'\n\n/** @public */\nexport interface TLUiIconProps extends React.HTMLProps<HTMLDivElement> {\n\ticon: TLUiIconType | Exclude<string, TLUiIconType>\n\tsmall?: boolean\n\tcolor?: string\n\tchildren?: undefined\n\tinvertIcon?: boolean\n\tcrossOrigin?: 'anonymous' | 'use-credentials'\n}\n\n/** @public */\nexport const TldrawUiIcon = memo(function TldrawUi({\n\tsmall,\n\tinvertIcon,\n\ticon,\n\tcolor,\n\tclassName,\n\t...props\n}: TLUiIconProps) {\n\tconst assetUrls = useAssetUrls()\n\tconst asset = assetUrls.icons[icon as TLUiIconType] ?? assetUrls.icons['question-mark-circle']\n\tconst ref = useRef<HTMLDivElement>(null)\n\n\tuseLayoutEffect(() => {\n\t\tif (!asset) {\n\t\t\tconsole.error(`Icon not found: ${icon}. Add it to the assetUrls.icons object.`)\n\t\t}\n\n\t\tif (ref?.current) {\n\t\t\t// HACK: Fix for <https://linear.app/tldraw/issue/TLD-1700/dragging-around-with-the-handtool-makes-lots-of-requests-for-icons>\n\t\t\t// It seems that passing `WebkitMask` to react will cause a render on each call, no idea why... but this appears to be the fix.\n\t\t\t// @ts-ignore\n\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\tref.current.style.webkitMask = `url(${asset}) center 100% / 100% no-repeat`\n\t\t}\n\t}, [ref, asset, icon])\n\n\treturn (\n\t\t<div\n\t\t\t{...props}\n\t\t\tref={ref}\n\t\t\tclassName={classNames('tlui-icon', { 'tlui-icon__small': small }, className)}\n\t\t\tstyle={{\n\t\t\t\tcolor,\n\t\t\t\tmask: `url(${asset}) center 100% / 100% no-repeat`,\n\t\t\t\ttransform: invertIcon ? 'scale(-1, 1)' : undefined,\n\t\t\t}}\n\t\t/>\n\t)\n})\n", "import { TldrawUiIcon } from '../TldrawUiIcon'\n\n/** @public */\nexport type TLUiButtonIconProps = {\n\ticon: string\n\tsmall?: boolean\n\tinvertIcon?: boolean\n}\n\n/** @public */\nexport function TldrawUiButtonIcon({ icon, small, invertIcon }: TLUiButtonIconProps) {\n\treturn (\n\t\t<TldrawUiIcon className=\"tlui-button__icon\" icon={icon} small={small} invertIcon={invertIcon} />\n\t)\n}\n", "// Breakpoints for portrait, keep in sync with PORTRAIT_BREAKPOINT enum below!\nexport const PORTRAIT_BREAKPOINTS = [0, 390, 428, 468, 580, 640, 840, 1023]\n\n// Mapping for above array -- needs to be kept in sync!\n/** @public */\nexport enum PORTRAIT_BREAKPOINT {\n\tZERO = 0,\n\tMOBILE_XXS = 1,\n\tMOBILE_XS = 2,\n\tMOBILE_SM = 3,\n\tMOBILE = 4,\n\tTABLET_SM = 5,\n\tTABLET = 6,\n\tDESKTOP = 7,\n}\n", "import { RecursivePartial } from '@tldraw/editor'\nimport { ReactNode } from 'react'\nimport { TLUiAssetUrls, useDefaultUiAssetUrlsWithOverrides } from '../assetUrls'\nimport { ToolsProvider } from '../hooks/useTools'\nimport { TranslationProvider } from '../hooks/useTranslation/useTranslation'\nimport { TLUiOverrides, useMergedOverrides, useMergedTranslationOverrides } from '../overrides'\nimport { ActionsProvider } from './actions'\nimport { AssetUrlsProvider } from './asset-urls'\nimport { BreakPointProvider } from './breakpoints'\nimport { TLUiComponents, TldrawUiComponentsProvider } from './components'\nimport { DialogsProvider } from './dialogs'\nimport { TLUiEventHandler, UiEventsProvider } from './events'\nimport { ToastsProvider } from './toasts'\n\n/**\n * Props for the {@link tldraw#Tldraw} and {@link TldrawUi} components.\n *\n * @public\n **/\nexport interface TldrawUiContextProviderProps {\n\t/**\n\t * Urls for where to find fonts and other assets for the UI.\n\t */\n\tassetUrls?: RecursivePartial<TLUiAssetUrls>\n\n\t/**\n\t * Overrides for the UI.\n\t */\n\toverrides?: TLUiOverrides | TLUiOverrides[]\n\n\t/**\n\t * Overrides for the UI components.\n\t */\n\tcomponents?: TLUiComponents\n\n\t/**\n\t * Callback for when an event occurs in the UI.\n\t */\n\tonUiEvent?: TLUiEventHandler\n\n\t/**\n\t * Whether to always should the mobile breakpoints.\n\t */\n\tforceMobile?: boolean\n\n\t/**\n\t * The component's children.\n\t */\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport function TldrawUiContextProvider({\n\toverrides,\n\tcomponents,\n\tassetUrls,\n\tonUiEvent,\n\tforceMobile,\n\tchildren,\n}: TldrawUiContextProviderProps) {\n\treturn (\n\t\t<AssetUrlsProvider assetUrls={useDefaultUiAssetUrlsWithOverrides(assetUrls)}>\n\t\t\t<TranslationProvider overrides={useMergedTranslationOverrides(overrides)}>\n\t\t\t\t<UiEventsProvider onEvent={onUiEvent}>\n\t\t\t\t\t<ToastsProvider>\n\t\t\t\t\t\t<DialogsProvider>\n\t\t\t\t\t\t\t<BreakPointProvider forceMobile={forceMobile}>\n\t\t\t\t\t\t\t\t<TldrawUiComponentsProvider overrides={components}>\n\t\t\t\t\t\t\t\t\t<InternalProviders overrides={overrides}>{children}</InternalProviders>\n\t\t\t\t\t\t\t\t</TldrawUiComponentsProvider>\n\t\t\t\t\t\t\t</BreakPointProvider>\n\t\t\t\t\t\t</DialogsProvider>\n\t\t\t\t\t</ToastsProvider>\n\t\t\t\t</UiEventsProvider>\n\t\t\t</TranslationProvider>\n\t\t</AssetUrlsProvider>\n\t)\n}\n\nfunction InternalProviders({\n\toverrides,\n\tchildren,\n}: Omit<TldrawUiContextProviderProps, 'assetBaseUrl'>) {\n\tconst mergedOverrides = useMergedOverrides(overrides)\n\treturn (\n\t\t<ActionsProvider overrides={mergedOverrides.actions}>\n\t\t\t<ToolsProvider overrides={mergedOverrides.tools}>{children}</ToolsProvider>\n\t\t</ActionsProvider>\n\t)\n}\n", "// This file is automatically generated by scripts/refresh-assets.ts.\n// Do not edit manually. Or do, I'm a comment, not a cop.\n\nexport const version = '2.1.4'\n", "import { RecursivePartial } from '@tldraw/editor'\nimport { useMemo } from 'react'\nimport { version } from '../../ui/version'\n\n/** @public */\nexport type TLEditorAssetUrls = {\n\tfonts: {\n\t\tmonospace: string\n\t\tserif: string\n\t\tsansSerif: string\n\t\tdraw: string\n\t}\n}\n\n/** @public */\nexport let defaultEditorAssetUrls: TLEditorAssetUrls = {\n\tfonts: {\n\t\tdraw: `https://unpkg.com/@tldraw/assets@${version}/fonts/Shantell_Sans-Tldrawish.woff2`,\n\t\tserif: `https://unpkg.com/@tldraw/assets@${version}/fonts/IBMPlexSerif-Medium.woff2`,\n\t\tsansSerif: `https://unpkg.com/@tldraw/assets@${version}/fonts/IBMPlexSans-Medium.woff2`,\n\t\tmonospace: `https://unpkg.com/@tldraw/assets@${version}/fonts/IBMPlexMono-Medium.woff2`,\n\t},\n}\n\n/** @public */\nexport function setDefaultEditorAssetUrls(assetUrls: TLEditorAssetUrls) {\n\tdefaultEditorAssetUrls = assetUrls\n}\n\n/** @internal */\nexport function useDefaultEditorAssetsWithOverrides(\n\toverrides?: RecursivePartial<TLEditorAssetUrls>\n): TLEditorAssetUrls {\n\treturn useMemo(() => {\n\t\tif (!overrides) return defaultEditorAssetUrls\n\n\t\treturn {\n\t\t\tfonts: { ...defaultEditorAssetUrls.fonts, ...overrides?.fonts },\n\t\t}\n\t}, [overrides])\n}\n", "// This file is automatically generated by scripts/refresh-assets.ts.\n// Do not edit manually. Or do, I'm a comment, not a cop.\n\n/** @public */\nexport type TLUiIconType =\n\t| 'align-bottom-center'\n\t| 'align-bottom-left'\n\t| 'align-bottom-right'\n\t| 'align-bottom'\n\t| 'align-center-center'\n\t| 'align-center-horizontal'\n\t| 'align-center-left'\n\t| 'align-center-right'\n\t| 'align-center-vertical'\n\t| 'align-left'\n\t| 'align-right'\n\t| 'align-top-center'\n\t| 'align-top-left'\n\t| 'align-top-right'\n\t| 'align-top'\n\t| 'arrow-left'\n\t| 'arrowhead-arrow'\n\t| 'arrowhead-bar'\n\t| 'arrowhead-diamond'\n\t| 'arrowhead-dot'\n\t| 'arrowhead-none'\n\t| 'arrowhead-square'\n\t| 'arrowhead-triangle-inverted'\n\t| 'arrowhead-triangle'\n\t| 'aspect-ratio'\n\t| 'avatar'\n\t| 'blob'\n\t| 'bring-forward'\n\t| 'bring-to-front'\n\t| 'check-circle'\n\t| 'check'\n\t| 'checkbox-checked'\n\t| 'checkbox-empty'\n\t| 'chevron-down'\n\t| 'chevron-left'\n\t| 'chevron-right'\n\t| 'chevron-up'\n\t| 'chevrons-ne'\n\t| 'chevrons-sw'\n\t| 'clipboard-copied'\n\t| 'clipboard-copy'\n\t| 'code'\n\t| 'collab'\n\t| 'color'\n\t| 'comment'\n\t| 'cross-2'\n\t| 'cross-circle'\n\t| 'cross'\n\t| 'dash-dashed'\n\t| 'dash-dotted'\n\t| 'dash-draw'\n\t| 'dash-solid'\n\t| 'discord'\n\t| 'distribute-horizontal'\n\t| 'distribute-vertical'\n\t| 'dot'\n\t| 'dots-horizontal'\n\t| 'dots-vertical'\n\t| 'drag-handle-dots'\n\t| 'duplicate'\n\t| 'edit'\n\t| 'error'\n\t| 'external-link'\n\t| 'file'\n\t| 'fill-none'\n\t| 'fill-pattern'\n\t| 'fill-semi'\n\t| 'fill-solid'\n\t| 'follow'\n\t| 'following'\n\t| 'font-draw'\n\t| 'font-mono'\n\t| 'font-sans'\n\t| 'font-serif'\n\t| 'geo-arrow-down'\n\t| 'geo-arrow-left'\n\t| 'geo-arrow-right'\n\t| 'geo-arrow-up'\n\t| 'geo-check-box'\n\t| 'geo-cloud'\n\t| 'geo-diamond'\n\t| 'geo-ellipse'\n\t| 'geo-hexagon'\n\t| 'geo-octagon'\n\t| 'geo-oval'\n\t| 'geo-pentagon'\n\t| 'geo-rectangle'\n\t| 'geo-rhombus-2'\n\t| 'geo-rhombus'\n\t| 'geo-star'\n\t| 'geo-trapezoid'\n\t| 'geo-triangle'\n\t| 'geo-x-box'\n\t| 'github'\n\t| 'group'\n\t| 'hidden'\n\t| 'image'\n\t| 'info-circle'\n\t| 'leading'\n\t| 'link'\n\t| 'lock-small'\n\t| 'lock'\n\t| 'menu'\n\t| 'minus'\n\t| 'mixed'\n\t| 'pack'\n\t| 'page'\n\t| 'plus'\n\t| 'question-mark-circle'\n\t| 'question-mark'\n\t| 'redo'\n\t| 'reset-zoom'\n\t| 'rotate-ccw'\n\t| 'rotate-cw'\n\t| 'ruler'\n\t| 'search'\n\t| 'send-backward'\n\t| 'send-to-back'\n\t| 'settings-horizontal'\n\t| 'settings-vertical-1'\n\t| 'settings-vertical'\n\t| 'share-1'\n\t| 'share-2'\n\t| 'size-extra-large'\n\t| 'size-large'\n\t| 'size-medium'\n\t| 'size-small'\n\t| 'spline-cubic'\n\t| 'spline-line'\n\t| 'stack-horizontal'\n\t| 'stack-vertical'\n\t| 'status-offline'\n\t| 'status-online'\n\t| 'stretch-horizontal'\n\t| 'stretch-vertical'\n\t| 'text-align-center'\n\t| 'text-align-justify'\n\t| 'text-align-left'\n\t| 'text-align-right'\n\t| 'tool-arrow'\n\t| 'tool-embed'\n\t| 'tool-eraser'\n\t| 'tool-frame'\n\t| 'tool-hand'\n\t| 'tool-highlight'\n\t| 'tool-laser'\n\t| 'tool-line'\n\t| 'tool-media'\n\t| 'tool-note'\n\t| 'tool-pencil'\n\t| 'tool-pointer'\n\t| 'tool-text'\n\t| 'trash'\n\t| 'triangle-down'\n\t| 'triangle-up'\n\t| 'twitter'\n\t| 'undo'\n\t| 'ungroup'\n\t| 'unlock-small'\n\t| 'unlock'\n\t| 'vertical-align-center'\n\t| 'vertical-align-end'\n\t| 'vertical-align-start'\n\t| 'visible'\n\t| 'warning-triangle'\n\t| 'zoom-in'\n\t| 'zoom-out'\n\n/** @public */\nexport const iconTypes = [\n\t'align-bottom-center',\n\t'align-bottom-left',\n\t'align-bottom-right',\n\t'align-bottom',\n\t'align-center-center',\n\t'align-center-horizontal',\n\t'align-center-left',\n\t'align-center-right',\n\t'align-center-vertical',\n\t'align-left',\n\t'align-right',\n\t'align-top-center',\n\t'align-top-left',\n\t'align-top-right',\n\t'align-top',\n\t'arrow-left',\n\t'arrowhead-arrow',\n\t'arrowhead-bar',\n\t'arrowhead-diamond',\n\t'arrowhead-dot',\n\t'arrowhead-none',\n\t'arrowhead-square',\n\t'arrowhead-triangle-inverted',\n\t'arrowhead-triangle',\n\t'aspect-ratio',\n\t'avatar',\n\t'blob',\n\t'bring-forward',\n\t'bring-to-front',\n\t'check-circle',\n\t'check',\n\t'checkbox-checked',\n\t'checkbox-empty',\n\t'chevron-down',\n\t'chevron-left',\n\t'chevron-right',\n\t'chevron-up',\n\t'chevrons-ne',\n\t'chevrons-sw',\n\t'clipboard-copied',\n\t'clipboard-copy',\n\t'code',\n\t'collab',\n\t'color',\n\t'comment',\n\t'cross-2',\n\t'cross-circle',\n\t'cross',\n\t'dash-dashed',\n\t'dash-dotted',\n\t'dash-draw',\n\t'dash-solid',\n\t'discord',\n\t'distribute-horizontal',\n\t'distribute-vertical',\n\t'dot',\n\t'dots-horizontal',\n\t'dots-vertical',\n\t'drag-handle-dots',\n\t'duplicate',\n\t'edit',\n\t'error',\n\t'external-link',\n\t'file',\n\t'fill-none',\n\t'fill-pattern',\n\t'fill-semi',\n\t'fill-solid',\n\t'follow',\n\t'following',\n\t'font-draw',\n\t'font-mono',\n\t'font-sans',\n\t'font-serif',\n\t'geo-arrow-down',\n\t'geo-arrow-left',\n\t'geo-arrow-right',\n\t'geo-arrow-up',\n\t'geo-check-box',\n\t'geo-cloud',\n\t'geo-diamond',\n\t'geo-ellipse',\n\t'geo-hexagon',\n\t'geo-octagon',\n\t'geo-oval',\n\t'geo-pentagon',\n\t'geo-rectangle',\n\t'geo-rhombus-2',\n\t'geo-rhombus',\n\t'geo-star',\n\t'geo-trapezoid',\n\t'geo-triangle',\n\t'geo-x-box',\n\t'github',\n\t'group',\n\t'hidden',\n\t'image',\n\t'info-circle',\n\t'leading',\n\t'link',\n\t'lock-small',\n\t'lock',\n\t'menu',\n\t'minus',\n\t'mixed',\n\t'pack',\n\t'page',\n\t'plus',\n\t'question-mark-circle',\n\t'question-mark',\n\t'redo',\n\t'reset-zoom',\n\t'rotate-ccw',\n\t'rotate-cw',\n\t'ruler',\n\t'search',\n\t'send-backward',\n\t'send-to-back',\n\t'settings-horizontal',\n\t'settings-vertical-1',\n\t'settings-vertical',\n\t'share-1',\n\t'share-2',\n\t'size-extra-large',\n\t'size-large',\n\t'size-medium',\n\t'size-small',\n\t'spline-cubic',\n\t'spline-line',\n\t'stack-horizontal',\n\t'stack-vertical',\n\t'status-offline',\n\t'status-online',\n\t'stretch-horizontal',\n\t'stretch-vertical',\n\t'text-align-center',\n\t'text-align-justify',\n\t'text-align-left',\n\t'text-align-right',\n\t'tool-arrow',\n\t'tool-embed',\n\t'tool-eraser',\n\t'tool-frame',\n\t'tool-hand',\n\t'tool-highlight',\n\t'tool-laser',\n\t'tool-line',\n\t'tool-media',\n\t'tool-note',\n\t'tool-pencil',\n\t'tool-pointer',\n\t'tool-text',\n\t'trash',\n\t'triangle-down',\n\t'triangle-up',\n\t'twitter',\n\t'undo',\n\t'ungroup',\n\t'unlock-small',\n\t'unlock',\n\t'vertical-align-center',\n\t'vertical-align-end',\n\t'vertical-align-start',\n\t'visible',\n\t'warning-triangle',\n\t'zoom-in',\n\t'zoom-out',\n] as const\n", "import { EMBED_DEFINITIONS, LANGUAGES, RecursivePartial } from '@tldraw/editor'\nimport { version } from '../ui/version'\nimport { TLEditorAssetUrls, defaultEditorAssetUrls } from '../utils/static-assets/assetUrls'\nimport { TLUiIconType, iconTypes } from './icon-types'\n\nexport type TLUiAssetUrls = TLEditorAssetUrls & {\n\ticons: Record<TLUiIconType | Exclude<string, TLUiIconType>, string>\n\ttranslations: Record<(typeof LANGUAGES)[number]['locale'], string>\n\tembedIcons: Record<(typeof EMBED_DEFINITIONS)[number]['type'], string>\n}\n\n/** @public */\nexport type TLUiAssetUrlOverrides = RecursivePartial<TLUiAssetUrls>\n\nexport let defaultUiAssetUrls: TLUiAssetUrls = {\n\t...defaultEditorAssetUrls,\n\ticons: Object.fromEntries(\n\t\ticonTypes.map((name) => [\n\t\t\tname,\n\t\t\t`https://unpkg.com/@tldraw/assets@${version}/icons/icon/${name}.svg`,\n\t\t])\n\t) as Record<TLUiIconType, string>,\n\ttranslations: Object.fromEntries(\n\t\tLANGUAGES.map((lang) => [\n\t\t\tlang.locale,\n\t\t\t`https://unpkg.com/@tldraw/assets@${version}/translations/${lang.locale}.json`,\n\t\t])\n\t) as Record<(typeof LANGUAGES)[number]['locale'], string>,\n\tembedIcons: Object.fromEntries(\n\t\tEMBED_DEFINITIONS.map((def) => [\n\t\t\tdef.type,\n\t\t\t`https://unpkg.com/@tldraw/assets@${version}/embed-icons/${def.type}.png`,\n\t\t])\n\t) as Record<(typeof EMBED_DEFINITIONS)[number]['type'], string>,\n}\n\n/** @internal */\nexport function setDefaultUiAssetUrls(urls: TLUiAssetUrls) {\n\tdefaultUiAssetUrls = urls\n}\n\n/** @internal */\nexport function useDefaultUiAssetUrlsWithOverrides(\n\toverrides?: RecursivePartial<TLUiAssetUrls>\n): TLUiAssetUrls {\n\tif (!overrides) return defaultUiAssetUrls\n\n\treturn {\n\t\tfonts: Object.assign({ ...defaultUiAssetUrls.fonts }, { ...overrides?.fonts }),\n\t\ticons: Object.assign({ ...defaultUiAssetUrls.icons }, { ...overrides?.icons }),\n\t\tembedIcons: Object.assign({ ...defaultUiAssetUrls.embedIcons }, { ...overrides?.embedIcons }),\n\t\ttranslations: Object.assign(\n\t\t\t{ ...defaultUiAssetUrls.translations },\n\t\t\t{ ...overrides?.translations }\n\t\t),\n\t}\n}\n", "import { Editor, GeoShapeGeoStyle, useEditor } from '@tldraw/editor'\nimport * as React from 'react'\nimport { EmbedDialog } from '../components/EmbedDialog'\nimport { useDialogs } from '../context/dialogs'\nimport { TLUiEventSource, useUiEvents } from '../context/events'\nimport { TLUiIconType } from '../icon-types'\nimport { useInsertMedia } from './useInsertMedia'\nimport { TLUiTranslationKey } from './useTranslation/TLUiTranslationKey'\n\n/** @public */\nexport interface TLUiToolItem<\n\tTranslationKey extends string = string,\n\tIconType extends string = string,\n> {\n\tid: string\n\tlabel: TranslationKey\n\tshortcutsLabel?: TranslationKey\n\ticon: IconType\n\tonSelect: (source: TLUiEventSource) => void\n\tkbd?: string\n\treadonlyOk?: boolean\n\tmeta?: {\n\t\t[key: string]: any\n\t}\n}\n\n/** @public */\nexport type TLUiToolsContextType = Record<string, TLUiToolItem>\n\n/** @internal */\nexport const ToolsContext = React.createContext({} as TLUiToolsContextType)\n\n/** @public */\nexport type TLUiToolsProviderProps = {\n\toverrides?: (\n\t\teditor: Editor,\n\t\ttools: TLUiToolsContextType,\n\t\thelpers: { insertMedia: () => void }\n\t) => TLUiToolsContextType\n\tchildren: React.ReactNode\n}\n\n/** @internal */\nexport function ToolsProvider({ overrides, children }: TLUiToolsProviderProps) {\n\tconst editor = useEditor()\n\tconst trackEvent = useUiEvents()\n\n\tconst { addDialog } = useDialogs()\n\tconst insertMedia = useInsertMedia()\n\n\tconst tools = React.useMemo<TLUiToolsContextType>(() => {\n\t\tconst toolsArray: TLUiToolItem<TLUiTranslationKey, TLUiIconType>[] = [\n\t\t\t{\n\t\t\t\tid: 'select',\n\t\t\t\tlabel: 'tool.select',\n\t\t\t\ticon: 'tool-pointer',\n\t\t\t\tkbd: 'v',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('select')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'select' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'hand',\n\t\t\t\tlabel: 'tool.hand',\n\t\t\t\ticon: 'tool-hand',\n\t\t\t\tkbd: 'h',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('hand')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'hand' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'eraser',\n\t\t\t\tlabel: 'tool.eraser',\n\t\t\t\ticon: 'tool-eraser',\n\t\t\t\tkbd: 'e',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('eraser')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'eraser' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'draw',\n\t\t\t\tlabel: 'tool.draw',\n\t\t\t\ticon: 'tool-pencil',\n\t\t\t\tkbd: 'd,b,x',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('draw')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'draw' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t...[...GeoShapeGeoStyle.values].map((id) => ({\n\t\t\t\tid,\n\t\t\t\tlabel: `tool.${id}` as TLUiTranslationKey,\n\t\t\t\tmeta: {\n\t\t\t\t\tgeo: id,\n\t\t\t\t},\n\t\t\t\tkbd: id === 'rectangle' ? 'r' : id === 'ellipse' ? 'o' : undefined,\n\t\t\t\ticon: ('geo-' + id) as TLUiIconType,\n\t\t\t\tonSelect(source: TLUiEventSource) {\n\t\t\t\t\teditor.batch(() => {\n\t\t\t\t\t\teditor.updateInstanceState(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tstylesForNextShape: {\n\t\t\t\t\t\t\t\t\t...editor.getInstanceState().stylesForNextShape,\n\t\t\t\t\t\t\t\t\t[GeoShapeGeoStyle.id]: id,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{ ephemeral: true }\n\t\t\t\t\t\t)\n\t\t\t\t\t\teditor.setCurrentTool('geo')\n\t\t\t\t\t\ttrackEvent('select-tool', { source, id: `geo-${id}` })\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t})),\n\t\t\t{\n\t\t\t\tid: 'arrow',\n\t\t\t\tlabel: 'tool.arrow',\n\t\t\t\ticon: 'tool-arrow',\n\t\t\t\tkbd: 'a',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('arrow')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'arrow' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'line',\n\t\t\t\tlabel: 'tool.line',\n\t\t\t\ticon: 'tool-line',\n\t\t\t\tkbd: 'l',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('line')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'line' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'frame',\n\t\t\t\tlabel: 'tool.frame',\n\t\t\t\ticon: 'tool-frame',\n\t\t\t\tkbd: 'f',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('frame')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'frame' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'text',\n\t\t\t\tlabel: 'tool.text',\n\t\t\t\ticon: 'tool-text',\n\t\t\t\tkbd: 't',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('text')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'text' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'asset',\n\t\t\t\tlabel: 'tool.asset',\n\t\t\t\ticon: 'tool-media',\n\t\t\t\tkbd: '$u',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tinsertMedia()\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'media' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'note',\n\t\t\t\tlabel: 'tool.note',\n\t\t\t\ticon: 'tool-note',\n\t\t\t\tkbd: 'n',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('note')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'note' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'laser',\n\t\t\t\tlabel: 'tool.laser',\n\t\t\t\treadonlyOk: true,\n\t\t\t\ticon: 'tool-laser',\n\t\t\t\tkbd: 'k',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('laser')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'laser' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'embed',\n\t\t\t\tlabel: 'tool.embed',\n\t\t\t\ticon: 'tool-embed',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\taddDialog({ component: EmbedDialog })\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'embed' })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'highlight',\n\t\t\t\tlabel: 'tool.highlight',\n\t\t\t\ticon: 'tool-highlight',\n\t\t\t\t// TODO: pick a better shortcut\n\t\t\t\tkbd: '!d',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.setCurrentTool('highlight')\n\t\t\t\t\ttrackEvent('select-tool', { source, id: 'highlight' })\n\t\t\t\t},\n\t\t\t},\n\t\t]\n\n\t\ttoolsArray.push()\n\n\t\tconst tools = Object.fromEntries(toolsArray.map((t) => [t.id, t]))\n\n\t\tif (overrides) {\n\t\t\treturn overrides(editor, tools, { insertMedia })\n\t\t}\n\n\t\treturn tools\n\t}, [overrides, editor, trackEvent, insertMedia, addDialog])\n\n\treturn <ToolsContext.Provider value={tools}>{children}</ToolsContext.Provider>\n}\n\n/** @public */\nexport function useTools() {\n\tconst ctx = React.useContext(ToolsContext)\n\n\tif (!ctx) {\n\t\tthrow new Error('useTools must be used within a ToolProvider')\n\t}\n\n\treturn ctx\n}\n", "import { EMBED_DEFINITIONS, EmbedDefinition, track, useEditor } from '@tldraw/editor'\nimport { useRef, useState } from 'react'\nimport { TLEmbedResult, getEmbedInfo } from '../../utils/embeds/embeds'\nimport { useAssetUrls } from '../context/asset-urls'\nimport { TLUiDialogProps } from '../context/dialogs'\nimport { untranslated, useTranslation } from '../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from './primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonLabel } from './primitives/Button/TldrawUiButtonLabel'\nimport {\n\tTldrawUiDialogBody,\n\tTldrawUiDialogCloseButton,\n\tTldrawUiDialogFooter,\n\tTldrawUiDialogHeader,\n\tTldrawUiDialogTitle,\n} from './primitives/TldrawUiDialog'\nimport { TldrawUiIcon } from './primitives/TldrawUiIcon'\nimport { TldrawUiInput } from './primitives/TldrawUiInput'\n\nexport const EmbedDialog = track(function EmbedDialog({ onClose }: TLUiDialogProps) {\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\tconst assetUrls = useAssetUrls()\n\n\t// The embed definition for the user's selected embed (set by the user clicking on an embed in stage 1)\n\tconst [embedDefinition, setEmbedDefinition] = useState<null | EmbedDefinition>(null)\n\n\t// The URL that the user has typed into (in stage 2)\n\tconst [url, setUrl] = useState<string>('')\n\n\t// The embed info for the user's selected embed (based on the URL they've entered in stage 2)\n\tconst [embedInfoForUrl, setEmbedInfoForUrl] = useState<null | TLEmbedResult>(null)\n\n\t// Should we show the \"invalid URL\" error message?\n\tconst [showError, setShowError] = useState(false)\n\tconst rShowErrorTimeout = useRef<any>(-1)\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiDialogHeader>\n\t\t\t\t<TldrawUiDialogTitle>\n\t\t\t\t\t{embedDefinition\n\t\t\t\t\t\t? `${msg('embed-dialog.title')} \u2014 ${embedDefinition.title}`\n\t\t\t\t\t\t: msg('embed-dialog.title')}\n\t\t\t\t</TldrawUiDialogTitle>\n\t\t\t\t<TldrawUiDialogCloseButton />\n\t\t\t</TldrawUiDialogHeader>\n\t\t\t{embedDefinition ? (\n\t\t\t\t<>\n\t\t\t\t\t<TldrawUiDialogBody className=\"tlui-embed-dialog__enter\">\n\t\t\t\t\t\t<TldrawUiInput\n\t\t\t\t\t\t\tclassName=\"tlui-embed-dialog__input\"\n\t\t\t\t\t\t\tlabel=\"embed-dialog.url\"\n\t\t\t\t\t\t\tplaceholder=\"http://example.com\"\n\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\tonValueChange={(value) => {\n\t\t\t\t\t\t\t\t// Set the url that the user has typed into the input\n\t\t\t\t\t\t\t\tsetUrl(value)\n\n\t\t\t\t\t\t\t\t// Set the embed info to either the embed info for the URL (if\n\t\t\t\t\t\t\t\t// that embed info can be found and of a type that matches the\n\t\t\t\t\t\t\t\t// user's selected definition type)\n\t\t\t\t\t\t\t\tconst embedInfo = getEmbedInfo(value)\n\t\t\t\t\t\t\t\tsetEmbedInfoForUrl(\n\t\t\t\t\t\t\t\t\tembedInfo && embedInfo.definition.type === embedDefinition.type ? embedInfo : null\n\t\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\t\t// We want to hide the error when the user enters text,\n\t\t\t\t\t\t\t\t// and then show an error after a short delay if the user\n\t\t\t\t\t\t\t\t// has not yet entered a valid URL.\n\t\t\t\t\t\t\t\tsetShowError(false)\n\t\t\t\t\t\t\t\tclearTimeout(rShowErrorTimeout.current)\n\t\t\t\t\t\t\t\trShowErrorTimeout.current = setTimeout(() => setShowError(!embedInfo), 320)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{url === '' ? (\n\t\t\t\t\t\t\t<div className=\"tlui-embed-dialog__instruction\">\n\t\t\t\t\t\t\t\t<span>{msg('embed-dialog.instruction')}</span>{' '}\n\t\t\t\t\t\t\t\t{embedDefinition.instructionLink && (\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t\t\t\t\thref={embedDefinition.instructionLink}\n\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-embed-dialog__instruction__link\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tLearn more.\n\t\t\t\t\t\t\t\t\t\t<TldrawUiIcon icon=\"external-link\" small />\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"tlui-embed-dialog__warning\">\n\t\t\t\t\t\t\t\t{showError ? msg('embed-dialog.invalid-url') : '\\xa0'}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</TldrawUiDialogBody>\n\t\t\t\t\t<TldrawUiDialogFooter className=\"tlui-dialog__footer__actions\">\n\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\ttype=\"normal\"\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tsetEmbedDefinition(null)\n\t\t\t\t\t\t\t\tsetEmbedInfoForUrl(null)\n\t\t\t\t\t\t\t\tsetUrl('')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TldrawUiButtonLabel>{msg('embed-dialog.back')}</TldrawUiButtonLabel>\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t<div className=\"tlui-embed__spacer\" />\n\t\t\t\t\t\t<TldrawUiButton type=\"normal\" onClick={onClose}>\n\t\t\t\t\t\t\t<TldrawUiButtonLabel>{msg('embed-dialog.cancel')}</TldrawUiButtonLabel>\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\t\tdisabled={!embedInfoForUrl}\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tif (!embedInfoForUrl) return\n\n\t\t\t\t\t\t\t\teditor.putExternalContent({\n\t\t\t\t\t\t\t\t\ttype: 'embed',\n\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\tpoint: editor.getViewportPageCenter(),\n\t\t\t\t\t\t\t\t\tembed: embedInfoForUrl.definition,\n\t\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\t\tonClose()\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TldrawUiButtonLabel>{msg('embed-dialog.create')}</TldrawUiButtonLabel>\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t</TldrawUiDialogFooter>\n\t\t\t\t</>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t<TldrawUiDialogBody className=\"tlui-embed-dialog__list\">\n\t\t\t\t\t\t{EMBED_DEFINITIONS.map((def) => {\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<TldrawUiButton type=\"menu\" key={def.type} onClick={() => setEmbedDefinition(def)}>\n\t\t\t\t\t\t\t\t\t<TldrawUiButtonLabel>{untranslated(def.title)}</TldrawUiButtonLabel>\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-embed-dialog__item__image\"\n\t\t\t\t\t\t\t\t\t\tstyle={{ backgroundImage: `url(${assetUrls.embedIcons[def.type]})` }}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})}\n\t\t\t\t\t</TldrawUiDialogBody>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</>\n\t)\n})\n", "import * as _Dialog from '@radix-ui/react-dialog'\nimport classNames from 'classnames'\nimport { ReactNode } from 'react'\nimport { TldrawUiButton } from './Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from './Button/TldrawUiButtonIcon'\n\n/** @public */\nexport type TLUiDialogHeaderProps = {\n\tclassName?: string\n\tchildren: ReactNode\n}\n\n/** @public */\nexport function TldrawUiDialogHeader({ className, children }: TLUiDialogHeaderProps) {\n\treturn <div className={classNames('tlui-dialog__header', className)}>{children}</div>\n}\n\n/** @public */\nexport type TLUiDialogTitleProps = {\n\tclassName?: string\n\tchildren: ReactNode\n}\n\n/** @public */\nexport function TldrawUiDialogTitle({ className, children }: TLUiDialogTitleProps) {\n\treturn (\n\t\t<_Dialog.DialogTitle dir=\"ltr\" className={classNames('tlui-dialog__header__title', className)}>\n\t\t\t{children}\n\t\t</_Dialog.DialogTitle>\n\t)\n}\n\n/** @public */\nexport function TldrawUiDialogCloseButton() {\n\treturn (\n\t\t<div className=\"tlui-dialog__header__close\">\n\t\t\t<_Dialog.DialogClose data-testid=\"dialog.close\" dir=\"ltr\" asChild>\n\t\t\t\t<TldrawUiButton\n\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\taria-label=\"Close\"\n\t\t\t\t\tonTouchEnd={(e) => (e.target as HTMLButtonElement).click()}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiButtonIcon small icon=\"cross-2\" />\n\t\t\t\t</TldrawUiButton>\n\t\t\t</_Dialog.DialogClose>\n\t\t</div>\n\t)\n}\n\n/** @public */\nexport type TLUiDialogBodyProps = {\n\tclassName?: string\n\tchildren: ReactNode\n\tstyle?: React.CSSProperties\n}\n\n/** @public */\nexport function TldrawUiDialogBody({ className, children, style }: TLUiDialogBodyProps) {\n\treturn (\n\t\t<div className={classNames('tlui-dialog__body', className)} style={style}>\n\t\t\t{children}\n\t\t</div>\n\t)\n}\n\n/** @public */\nexport type TLUiDialogFooterProps = {\n\tclassName?: string\n\tchildren: ReactNode\n}\n\n/** @public */\nexport function TldrawUiDialogFooter({ className, children }: TLUiDialogFooterProps) {\n\treturn <div className={classNames('tlui-dialog__footer', className)}>{children}</div>\n}\n", "import { stopEventPropagation, useEditor } from '@tldraw/editor'\nimport classNames from 'classnames'\nimport * as React from 'react'\nimport { TLUiTranslationKey } from '../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TLUiIconType } from '../../icon-types'\nimport { TldrawUiIcon } from './TldrawUiIcon'\n\n/** @public */\nexport interface TLUiInputProps {\n\tdisabled?: boolean\n\tlabel?: TLUiTranslationKey | Exclude<string, TLUiTranslationKey>\n\ticon?: TLUiIconType | Exclude<string, TLUiIconType>\n\ticonLeft?: TLUiIconType | Exclude<string, TLUiIconType>\n\tautofocus?: boolean\n\tautoselect?: boolean\n\tchildren?: React.ReactNode\n\tdefaultValue?: string\n\tplaceholder?: string\n\tonComplete?: (value: string) => void\n\tonValueChange?: (value: string) => void\n\tonCancel?: (value: string) => void\n\tonBlur?: (value: string) => void\n\tclassName?: string\n\t/**\n\t * Usually on iOS when you focus an input, the browser will adjust the viewport to bring the input\n\t * into view. Sometimes this doesn't work properly though - for example, if the input is newly\n\t * created, iOS seems to have a hard time adjusting the viewport for it. This prop allows you to\n\t * opt-in to some extra code to manually bring the input into view when the visual viewport of the\n\t * browser changes, but we don't want to use it everywhere because generally the native behavior\n\t * looks nicer in scenarios where it's sufficient.\n\t */\n\tshouldManuallyMaintainScrollPositionWhenFocused?: boolean\n\tvalue?: string\n}\n\n/** @public */\nexport const TldrawUiInput = React.forwardRef<HTMLInputElement, TLUiInputProps>(\n\tfunction TldrawUiInput(\n\t\t{\n\t\t\tclassName,\n\t\t\tlabel,\n\t\t\ticon,\n\t\t\ticonLeft,\n\t\t\tautoselect = false,\n\t\t\tautofocus = false,\n\t\t\tdefaultValue,\n\t\t\tplaceholder,\n\t\t\tonComplete,\n\t\t\tonValueChange,\n\t\t\tonCancel,\n\t\t\tonBlur,\n\t\t\tshouldManuallyMaintainScrollPositionWhenFocused = false,\n\t\t\tchildren,\n\t\t\tvalue,\n\t\t},\n\t\tref\n\t) {\n\t\tconst editor = useEditor()\n\t\tconst rInputRef = React.useRef<HTMLInputElement>(null)\n\n\t\t// combine rInputRef and ref\n\t\tReact.useImperativeHandle(ref, () => rInputRef.current as HTMLInputElement)\n\n\t\tconst msg = useTranslation()\n\t\tconst rInitialValue = React.useRef<string>(defaultValue ?? '')\n\t\tconst rCurrentValue = React.useRef<string>(defaultValue ?? '')\n\n\t\tconst [isFocused, setIsFocused] = React.useState(false)\n\t\tconst handleFocus = React.useCallback(\n\t\t\t(e: React.FocusEvent<HTMLInputElement>) => {\n\t\t\t\tsetIsFocused(true)\n\t\t\t\tconst elm = e.currentTarget as HTMLInputElement\n\t\t\t\trCurrentValue.current = elm.value\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tif (autoselect) {\n\t\t\t\t\t\telm.select()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t[autoselect]\n\t\t)\n\n\t\tconst handleChange = React.useCallback(\n\t\t\t(e: React.ChangeEvent<HTMLInputElement>) => {\n\t\t\t\tconst value = e.currentTarget.value\n\t\t\t\trCurrentValue.current = value\n\t\t\t\tonValueChange?.(value)\n\t\t\t},\n\t\t\t[onValueChange]\n\t\t)\n\n\t\tconst handleKeyUp = React.useCallback(\n\t\t\t(e: React.KeyboardEvent<HTMLInputElement>) => {\n\t\t\t\tswitch (e.key) {\n\t\t\t\t\tcase 'Enter': {\n\t\t\t\t\t\te.currentTarget.blur()\n\t\t\t\t\t\tstopEventPropagation(e)\n\t\t\t\t\t\tonComplete?.(e.currentTarget.value)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase 'Escape': {\n\t\t\t\t\t\te.currentTarget.value = rInitialValue.current\n\t\t\t\t\t\te.currentTarget.blur()\n\t\t\t\t\t\tstopEventPropagation(e)\n\t\t\t\t\t\tonCancel?.(e.currentTarget.value)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t[onComplete, onCancel]\n\t\t)\n\n\t\tconst handleBlur = React.useCallback(\n\t\t\t(e: React.FocusEvent<HTMLInputElement>) => {\n\t\t\t\tsetIsFocused(false)\n\t\t\t\tconst value = e.currentTarget.value\n\t\t\t\tonBlur?.(value)\n\t\t\t},\n\t\t\t[onBlur]\n\t\t)\n\n\t\tReact.useEffect(() => {\n\t\t\tif (!editor.environment.isIos) return\n\n\t\t\tconst visualViewport = window.visualViewport\n\t\t\tif (isFocused && shouldManuallyMaintainScrollPositionWhenFocused && visualViewport) {\n\t\t\t\tconst onViewportChange = () => {\n\t\t\t\t\trInputRef.current?.scrollIntoView({ block: 'center' })\n\t\t\t\t}\n\t\t\t\tvisualViewport.addEventListener('resize', onViewportChange)\n\t\t\t\tvisualViewport.addEventListener('scroll', onViewportChange)\n\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\trInputRef.current?.scrollIntoView({ block: 'center' })\n\t\t\t\t})\n\n\t\t\t\treturn () => {\n\t\t\t\t\tvisualViewport.removeEventListener('resize', onViewportChange)\n\t\t\t\t\tvisualViewport.removeEventListener('scroll', onViewportChange)\n\t\t\t\t}\n\t\t\t}\n\t\t}, [editor, isFocused, shouldManuallyMaintainScrollPositionWhenFocused])\n\n\t\treturn (\n\t\t\t<div draggable={false} className=\"tlui-input__wrapper\">\n\t\t\t\t{children}\n\t\t\t\t{label && <label>{msg(label)}</label>}\n\t\t\t\t{iconLeft && <TldrawUiIcon icon={iconLeft} className=\"tlui-icon-left\" small />}\n\t\t\t\t<input\n\t\t\t\t\tref={rInputRef}\n\t\t\t\t\tclassName={classNames('tlui-input', className)}\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tdefaultValue={defaultValue}\n\t\t\t\t\tonKeyUp={handleKeyUp}\n\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\tonFocus={handleFocus}\n\t\t\t\t\tonBlur={handleBlur}\n\t\t\t\t\tautoFocus={autofocus}\n\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\tvalue={value}\n\t\t\t\t/>\n\t\t\t\t{icon && <TldrawUiIcon icon={icon} small={!!label} />}\n\t\t\t</div>\n\t\t)\n\t}\n)\n", "import { useEditor } from '@tldraw/editor'\nimport { useCallback, useEffect, useRef } from 'react'\n\nexport function useInsertMedia() {\n\tconst editor = useEditor()\n\tconst inputRef = useRef<HTMLInputElement>()\n\n\tuseEffect(() => {\n\t\tconst input = window.document.createElement('input')\n\t\tinput.type = 'file'\n\t\tinput.accept = 'image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime'\n\t\tinput.multiple = true\n\t\tinputRef.current = input\n\t\tasync function onchange(e: Event) {\n\t\t\tconst fileList = (e.target as HTMLInputElement).files\n\t\t\tif (!fileList || fileList.length === 0) return\n\t\t\tawait editor.putExternalContent({\n\t\t\t\ttype: 'files',\n\t\t\t\tfiles: Array.from(fileList),\n\t\t\t\tpoint: editor.getViewportPageBounds().center,\n\t\t\t\tignoreParent: false,\n\t\t\t})\n\t\t\tinput.value = ''\n\t\t}\n\t\tinput.addEventListener('change', onchange)\n\t\treturn () => {\n\t\t\tinputRef.current = undefined\n\t\t\tinput.removeEventListener('change', onchange)\n\t\t}\n\t}, [editor])\n\n\treturn useCallback(() => {\n\t\tinputRef.current?.click()\n\t}, [inputRef])\n}\n", "import { Editor, objectMapEntries } from '@tldraw/editor'\nimport { useMemo } from 'react'\nimport { PORTRAIT_BREAKPOINT } from './constants'\nimport { ActionsProviderProps } from './context/actions'\nimport { useBreakpoint } from './context/breakpoints'\nimport { useDialogs } from './context/dialogs'\nimport { useToasts } from './context/toasts'\nimport { TLUiToolsProviderProps } from './hooks/useTools'\nimport { TLUiTranslationProviderProps, useTranslation } from './hooks/useTranslation/useTranslation'\n\n/** @public */\nexport function useDefaultHelpers() {\n\tconst { addToast, removeToast, clearToasts } = useToasts()\n\tconst { addDialog, clearDialogs, removeDialog, updateDialog } = useDialogs()\n\tconst breakpoint = useBreakpoint()\n\tconst isMobile = breakpoint < PORTRAIT_BREAKPOINT.TABLET_SM\n\tconst msg = useTranslation()\n\treturn useMemo(\n\t\t() => ({\n\t\t\taddToast,\n\t\t\tremoveToast,\n\t\t\tclearToasts,\n\t\t\taddDialog,\n\t\t\tclearDialogs,\n\t\t\tremoveDialog,\n\t\t\tupdateDialog,\n\t\t\tmsg,\n\t\t\tisMobile,\n\t\t}),\n\t\t[\n\t\t\taddDialog,\n\t\t\taddToast,\n\t\t\tclearDialogs,\n\t\t\tclearToasts,\n\t\t\tmsg,\n\t\t\tremoveDialog,\n\t\t\tremoveToast,\n\t\t\tupdateDialog,\n\t\t\tisMobile,\n\t\t]\n\t)\n}\n\ntype DefaultHelpers = ReturnType<typeof useDefaultHelpers>\n\nexport type TLUiOverride<Type, Helpers> = (editor: Editor, schema: Type, helpers: Helpers) => Type\n\ntype WithDefaultHelpers<T extends TLUiOverride<any, any>> =\n\tT extends TLUiOverride<infer Type, infer Helpers>\n\t\t? TLUiOverride<Type, Helpers extends undefined ? DefaultHelpers : Helpers & DefaultHelpers>\n\t\t: never\n\n/** @public */\nexport type TLUiOverrides = Partial<{\n\tactions: WithDefaultHelpers<NonNullable<ActionsProviderProps['overrides']>>\n\ttools: WithDefaultHelpers<NonNullable<TLUiToolsProviderProps['overrides']>>\n\ttranslations: TLUiTranslationProviderProps['overrides']\n}>\n\nexport type TLUiOverridesWithoutDefaults = Partial<{\n\tactions: ActionsProviderProps['overrides']\n\ttools: TLUiToolsProviderProps['overrides']\n\ttranslations: TLUiTranslationProviderProps['overrides']\n}>\n\nexport function mergeOverrides(\n\toverrides: TLUiOverrides[],\n\tdefaultHelpers: DefaultHelpers\n): TLUiOverridesWithoutDefaults {\n\tconst mergedTranslations: TLUiTranslationProviderProps['overrides'] = {}\n\tfor (const override of overrides) {\n\t\tif (override.translations) {\n\t\t\tfor (const [key, value] of objectMapEntries(override.translations)) {\n\t\t\t\tlet strings = mergedTranslations[key]\n\t\t\t\tif (!strings) {\n\t\t\t\t\tstrings = mergedTranslations[key] = {}\n\t\t\t\t}\n\t\t\t\tObject.assign(strings, value)\n\t\t\t}\n\t\t}\n\t}\n\treturn {\n\t\tactions: (editor, schema) => {\n\t\t\tfor (const override of overrides) {\n\t\t\t\tif (override.actions) {\n\t\t\t\t\tschema = override.actions(editor, schema, defaultHelpers)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn schema\n\t\t},\n\t\ttools: (editor, schema, helpers) => {\n\t\t\tfor (const override of overrides) {\n\t\t\t\tif (override.tools) {\n\t\t\t\t\tschema = override.tools(editor, schema, { ...defaultHelpers, ...helpers })\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn schema\n\t\t},\n\t\ttranslations: mergedTranslations,\n\t}\n}\n\nfunction useShallowArrayEquality<T extends unknown[]>(array: T): T {\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\treturn useMemo(() => array, array)\n}\n\nexport function useMergedTranslationOverrides(\n\toverrides?: TLUiOverrides[] | TLUiOverrides\n): NonNullable<TLUiTranslationProviderProps['overrides']> {\n\tconst overridesArray = useShallowArrayEquality(\n\t\toverrides == null ? [] : Array.isArray(overrides) ? overrides : [overrides]\n\t)\n\treturn useMemo(() => {\n\t\tconst mergedTranslations: TLUiTranslationProviderProps['overrides'] = {}\n\t\tfor (const override of overridesArray) {\n\t\t\tif (override.translations) {\n\t\t\t\tfor (const [key, value] of objectMapEntries(override.translations)) {\n\t\t\t\t\tlet strings = mergedTranslations[key]\n\t\t\t\t\tif (!strings) {\n\t\t\t\t\t\tstrings = mergedTranslations[key] = {}\n\t\t\t\t\t}\n\t\t\t\t\tObject.assign(strings, value)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn mergedTranslations\n\t}, [overridesArray])\n}\n\nexport function useMergedOverrides(\n\toverrides?: TLUiOverrides[] | TLUiOverrides\n): TLUiOverridesWithoutDefaults {\n\tconst defaultHelpers = useDefaultHelpers()\n\tconst overridesArray = useShallowArrayEquality(\n\t\toverrides == null ? [] : Array.isArray(overrides) ? overrides : [overrides]\n\t)\n\treturn useMemo(\n\t\t() => mergeOverrides(overridesArray, defaultHelpers),\n\t\t[overridesArray, defaultHelpers]\n\t)\n}\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport React, { ReactNode, useContext } from 'react'\nimport { PORTRAIT_BREAKPOINT, PORTRAIT_BREAKPOINTS } from '../constants'\n\nconst BreakpointContext = React.createContext(0)\n\n/** @public */\nexport function BreakPointProvider({\n\tforceMobile = false,\n\tchildren,\n}: {\n\tforceMobile?: boolean\n\tchildren: ReactNode\n}) {\n\tconst editor = useEditor()\n\n\tconst breakpoint = useValue(\n\t\t'breakpoint',\n\t\t() => {\n\t\t\t// This will recompute the viewport screen bounds changes...\n\t\t\tconst { width } = editor.getViewportScreenBounds()\n\n\t\t\tconst maxBreakpoint = forceMobile\n\t\t\t\t? PORTRAIT_BREAKPOINT.MOBILE_SM\n\t\t\t\t: PORTRAIT_BREAKPOINTS.length - 1\n\n\t\t\tfor (let i = 0; i < maxBreakpoint; i++) {\n\t\t\t\tif (width > PORTRAIT_BREAKPOINTS[i] && width <= PORTRAIT_BREAKPOINTS[i + 1]) {\n\t\t\t\t\treturn i\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn maxBreakpoint\n\t\t},\n\t\t[editor]\n\t)\n\n\treturn <BreakpointContext.Provider value={breakpoint}>{children}</BreakpointContext.Provider>\n}\n\n/** @public */\nexport function useBreakpoint() {\n\treturn useContext(BreakpointContext)\n}\n", "import {\n\tANIMATION_MEDIUM_MS,\n\tBox,\n\tDefaultColorStyle,\n\tEditor,\n\tHALF_PI,\n\tPageRecordType,\n\tTLBookmarkShape,\n\tTLEmbedShape,\n\tTLFrameShape,\n\tTLGroupShape,\n\tTLShapeId,\n\tTLShapePartial,\n\tTLTextShape,\n\tVec,\n\tapproximately,\n\tcompact,\n\tcreateShapeId,\n\topenWindow,\n\tuseEditor,\n} from '@tldraw/editor'\nimport * as React from 'react'\nimport { kickoutOccludedShapes } from '../../tools/SelectTool/selectHelpers'\nimport { getEmbedInfo } from '../../utils/embeds/embeds'\nimport { fitFrameToContent, removeFrame } from '../../utils/frames/frames'\nimport { EditLinkDialog } from '../components/EditLinkDialog'\nimport { EmbedDialog } from '../components/EmbedDialog'\nimport { useMenuClipboardEvents } from '../hooks/useClipboardEvents'\nimport { useCopyAs } from '../hooks/useCopyAs'\nimport { useExportAs } from '../hooks/useExportAs'\nimport { useInsertMedia } from '../hooks/useInsertMedia'\nimport { usePrint } from '../hooks/usePrint'\nimport { TLUiTranslationKey } from '../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../hooks/useTranslation/useTranslation'\nimport { TLUiIconType } from '../icon-types'\nimport { useDialogs } from './dialogs'\nimport { TLUiEventSource, useUiEvents } from './events'\nimport { useToasts } from './toasts'\n\n/** @public */\nexport interface TLUiActionItem<\n\tTransationKey extends string = string,\n\tIconType extends string = string,\n> {\n\ticon?: IconType\n\tid: string\n\tkbd?: string\n\tlabel?: TransationKey | { [key: string]: TransationKey }\n\treadonlyOk?: boolean\n\tcheckbox?: boolean\n\tonSelect: (source: TLUiEventSource) => Promise<void> | void\n}\n\n/** @public */\nexport type TLUiActionsContextType = Record<string, TLUiActionItem>\n\n/** @internal */\nexport const ActionsContext = React.createContext<TLUiActionsContextType>({})\n\n/** @public */\nexport type ActionsProviderProps = {\n\toverrides?: (\n\t\teditor: Editor,\n\t\tactions: TLUiActionsContextType,\n\t\thelpers: undefined\n\t) => TLUiActionsContextType\n\tchildren: React.ReactNode\n}\n\nfunction makeActions(actions: TLUiActionItem[]) {\n\treturn Object.fromEntries(actions.map((action) => [action.id, action])) as TLUiActionsContextType\n}\n\nfunction getExportName(editor: Editor, defaultName: string) {\n\tconst selectedShapes = editor.getSelectedShapes()\n\t// When we don't have any shapes selected, we want to use the document name\n\tif (selectedShapes.length === 0) {\n\t\treturn editor.getDocumentSettings().name || defaultName\n\t}\n\treturn undefined\n}\n\n/** @internal */\nexport function ActionsProvider({ overrides, children }: ActionsProviderProps) {\n\tconst editor = useEditor()\n\n\tconst { addDialog, clearDialogs } = useDialogs()\n\tconst { clearToasts } = useToasts()\n\tconst msg = useTranslation()\n\n\tconst insertMedia = useInsertMedia()\n\tconst printSelectionOrPages = usePrint()\n\tconst { cut, copy, paste } = useMenuClipboardEvents()\n\tconst copyAs = useCopyAs()\n\tconst exportAs = useExportAs()\n\tconst defaultDocumentName = msg('document.default-name')\n\n\tconst trackEvent = useUiEvents()\n\n\t// should this be a useMemo? looks like it doesn't actually deref any reactive values\n\tconst actions = React.useMemo<TLUiActionsContextType>(() => {\n\t\tfunction mustGoBackToSelectToolFirst() {\n\t\t\tif (!editor.isIn('select')) {\n\t\t\t\teditor.complete()\n\t\t\t\teditor.setCurrentTool('select')\n\t\t\t\treturn false // false will still let the action happen, true will stop it\n\t\t\t\t// todo: remove this return value once we're suuuuure\n\t\t\t}\n\n\t\t\treturn false\n\t\t}\n\n\t\tfunction canApplySelectionAction() {\n\t\t\treturn editor.isIn('select') && editor.getSelectedShapeIds().length > 0\n\t\t}\n\n\t\tconst actionItems: TLUiActionItem<TLUiTranslationKey, TLUiIconType>[] = [\n\t\t\t{\n\t\t\t\tid: 'edit-link',\n\t\t\t\tlabel: 'action.edit-link',\n\t\t\t\ticon: 'link',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('edit-link', { source })\n\t\t\t\t\teditor.mark('edit-link')\n\t\t\t\t\taddDialog({ component: EditLinkDialog })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'insert-embed',\n\t\t\t\tlabel: 'action.insert-embed',\n\t\t\t\tkbd: '$i',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('insert-embed', { source })\n\t\t\t\t\taddDialog({ component: EmbedDialog })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'insert-media',\n\t\t\t\tlabel: 'action.insert-media',\n\t\t\t\tkbd: '$u',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('insert-media', { source })\n\t\t\t\t\tinsertMedia()\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'undo',\n\t\t\t\tlabel: 'action.undo',\n\t\t\t\ticon: 'undo',\n\t\t\t\tkbd: '$z',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('undo', { source })\n\t\t\t\t\teditor.undo()\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'redo',\n\t\t\t\tlabel: 'action.redo',\n\t\t\t\ticon: 'redo',\n\t\t\t\tkbd: '$!z',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('redo', { source })\n\t\t\t\t\teditor.redo()\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'export-as-svg',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.export-as-svg',\n\t\t\t\t\tmenu: 'action.export-as-svg.short',\n\t\t\t\t\t['context-menu']: 'action.export-as-svg.short',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tlet ids = editor.getSelectedShapeIds()\n\t\t\t\t\tif (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('export-as', { format: 'svg', source })\n\t\t\t\t\texportAs(ids, 'svg', getExportName(editor, defaultDocumentName))\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'export-as-png',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.export-as-png',\n\t\t\t\t\tmenu: 'action.export-as-png.short',\n\t\t\t\t\t['context-menu']: 'action.export-as-png.short',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tlet ids = editor.getSelectedShapeIds()\n\t\t\t\t\tif (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('export-as', { format: 'png', source })\n\t\t\t\t\texportAs(ids, 'png', getExportName(editor, defaultDocumentName))\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'export-as-json',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.export-as-json',\n\t\t\t\t\tmenu: 'action.export-as-json.short',\n\t\t\t\t\t['context-menu']: 'action.export-as-json.short',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tlet ids = editor.getSelectedShapeIds()\n\t\t\t\t\tif (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('export-as', { format: 'json', source })\n\t\t\t\t\texportAs(ids, 'json', getExportName(editor, defaultDocumentName))\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'export-all-as-svg',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.export-all-as-svg',\n\t\t\t\t\tmenu: 'action.export-all-as-svg.short',\n\t\t\t\t\t['context-menu']: 'action.export-all-as-svg.short',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tlet ids = editor.getSelectedShapeIds()\n\t\t\t\t\tif (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('export-all-as', { format: 'svg', source })\n\t\t\t\t\texportAs(\n\t\t\t\t\t\tArray.from(editor.getCurrentPageShapeIds()),\n\t\t\t\t\t\t'svg',\n\t\t\t\t\t\tgetExportName(editor, defaultDocumentName)\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'export-all-as-png',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.export-all-as-png',\n\t\t\t\t\tmenu: 'action.export-all-as-png.short',\n\t\t\t\t\t['context-menu']: 'action.export-all-as-png.short',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tconst ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('export-all-as', { format: 'png', source })\n\t\t\t\t\texportAs(ids, 'png', getExportName(editor, defaultDocumentName))\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'export-all-as-json',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.export-all-as-json',\n\t\t\t\t\tmenu: 'action.export-all-as-json.short',\n\t\t\t\t\t['context-menu']: 'action.export-all-as-json.short',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tconst ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('export-all-as', { format: 'json', source })\n\t\t\t\t\texportAs(ids, 'json', getExportName(editor, defaultDocumentName))\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'copy-as-svg',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.copy-as-svg',\n\t\t\t\t\tmenu: 'action.copy-as-svg.short',\n\t\t\t\t\t['context-menu']: 'action.copy-as-svg.short',\n\t\t\t\t},\n\t\t\t\tkbd: '$!c',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tlet ids = editor.getSelectedShapeIds()\n\t\t\t\t\tif (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('copy-as', { format: 'svg', source })\n\t\t\t\t\tcopyAs(ids, 'svg')\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'copy-as-png',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.copy-as-png',\n\t\t\t\t\tmenu: 'action.copy-as-png.short',\n\t\t\t\t\t['context-menu']: 'action.copy-as-png.short',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tlet ids = editor.getSelectedShapeIds()\n\t\t\t\t\tif (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('copy-as', { format: 'png', source })\n\t\t\t\t\tcopyAs(ids, 'png')\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'copy-as-json',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.copy-as-json',\n\t\t\t\t\tmenu: 'action.copy-as-json.short',\n\t\t\t\t\t['context-menu']: 'action.copy-as-json.short',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tlet ids = editor.getSelectedShapeIds()\n\t\t\t\t\tif (ids.length === 0) ids = Array.from(editor.getCurrentPageShapeIds().values())\n\t\t\t\t\tif (ids.length === 0) return\n\t\t\t\t\ttrackEvent('copy-as', { format: 'json', source })\n\t\t\t\t\tcopyAs(ids, 'json')\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-auto-size',\n\t\t\t\tlabel: 'action.toggle-auto-size',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('toggle-auto-size', { source })\n\t\t\t\t\teditor.mark('toggling auto size')\n\t\t\t\t\tconst shapes = editor\n\t\t\t\t\t\t.getSelectedShapes()\n\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t(shape): shape is TLTextShape =>\n\t\t\t\t\t\t\t\teditor.isShapeOfType<TLTextShape>(shape, 'text') && shape.props.autoSize === false\n\t\t\t\t\t\t)\n\t\t\t\t\teditor.updateShapes(\n\t\t\t\t\t\tshapes.map((shape) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: shape.id,\n\t\t\t\t\t\t\t\ttype: shape.type,\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t...shape.props,\n\t\t\t\t\t\t\t\t\tw: 8,\n\t\t\t\t\t\t\t\t\tautoSize: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\t\tkickoutOccludedShapes(\n\t\t\t\t\t\teditor,\n\t\t\t\t\t\tshapes.map((shape) => shape.id)\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'open-embed-link',\n\t\t\t\tlabel: 'action.open-embed-link',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('open-embed-link', { source })\n\t\t\t\t\tconst ids = editor.getSelectedShapeIds()\n\t\t\t\t\tconst warnMsg = 'No embed shapes selected'\n\t\t\t\t\tif (ids.length !== 1) {\n\t\t\t\t\t\tconsole.error(warnMsg)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tconst shape = editor.getShape(ids[0])\n\t\t\t\t\tif (!shape || !editor.isShapeOfType<TLEmbedShape>(shape, 'embed')) {\n\t\t\t\t\t\tconsole.error(warnMsg)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\topenWindow(shape.props.url, '_blank')\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'select-zoom-tool',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tkbd: 'z',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (editor.root.getCurrent()?.id === 'zoom') return\n\n\t\t\t\t\ttrackEvent('zoom-tool', { source })\n\t\t\t\t\tif (!(editor.inputs.shiftKey || editor.inputs.ctrlKey)) {\n\t\t\t\t\t\tconst currentTool = editor.root.getCurrent()\n\t\t\t\t\t\tif (currentTool && currentTool.getCurrent()?.id === 'idle') {\n\t\t\t\t\t\t\teditor.setCurrentTool('zoom', { onInteractionEnd: currentTool.id, maskAs: 'zoom' })\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'convert-to-bookmark',\n\t\t\t\tlabel: 'action.convert-to-bookmark',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\teditor.batch(() => {\n\t\t\t\t\t\ttrackEvent('convert-to-bookmark', { source })\n\t\t\t\t\t\tconst shapes = editor.getSelectedShapes()\n\n\t\t\t\t\t\tconst createList: TLShapePartial[] = []\n\t\t\t\t\t\tconst deleteList: TLShapeId[] = []\n\t\t\t\t\t\tfor (const shape of shapes) {\n\t\t\t\t\t\t\tif (!shape || !editor.isShapeOfType<TLEmbedShape>(shape, 'embed') || !shape.props.url)\n\t\t\t\t\t\t\t\tcontinue\n\n\t\t\t\t\t\t\tconst newPos = new Vec(shape.x, shape.y)\n\t\t\t\t\t\t\tnewPos.rot(-shape.rotation)\n\t\t\t\t\t\t\tnewPos.add(new Vec(shape.props.w / 2 - 300 / 2, shape.props.h / 2 - 320 / 2)) // see bookmark shape util\n\t\t\t\t\t\t\tnewPos.rot(shape.rotation)\n\t\t\t\t\t\t\tconst partial: TLShapePartial<TLBookmarkShape> = {\n\t\t\t\t\t\t\t\tid: createShapeId(),\n\t\t\t\t\t\t\t\ttype: 'bookmark',\n\t\t\t\t\t\t\t\trotation: shape.rotation,\n\t\t\t\t\t\t\t\tx: newPos.x,\n\t\t\t\t\t\t\t\ty: newPos.y,\n\t\t\t\t\t\t\t\topacity: 1,\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\turl: shape.props.url,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcreateList.push(partial)\n\t\t\t\t\t\t\tdeleteList.push(shape.id)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.mark('convert shapes to bookmark')\n\t\t\t\t\t\teditor.deleteShapes(deleteList)\n\t\t\t\t\t\teditor.createShapes(createList)\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'convert-to-embed',\n\t\t\t\tlabel: 'action.convert-to-embed',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('convert-to-embed', { source })\n\n\t\t\t\t\teditor.batch(() => {\n\t\t\t\t\t\tconst ids = editor.getSelectedShapeIds()\n\t\t\t\t\t\tconst shapes = compact(ids.map((id) => editor.getShape(id)))\n\n\t\t\t\t\t\tconst createList: TLShapePartial[] = []\n\t\t\t\t\t\tconst deleteList: TLShapeId[] = []\n\t\t\t\t\t\tfor (const shape of shapes) {\n\t\t\t\t\t\t\tif (!editor.isShapeOfType<TLBookmarkShape>(shape, 'bookmark')) continue\n\n\t\t\t\t\t\t\tconst { url } = shape.props\n\n\t\t\t\t\t\t\tconst embedInfo = getEmbedInfo(shape.props.url)\n\n\t\t\t\t\t\t\tif (!embedInfo) continue\n\t\t\t\t\t\t\tif (!embedInfo.definition) continue\n\n\t\t\t\t\t\t\tconst { width, height } = embedInfo.definition\n\n\t\t\t\t\t\t\tconst newPos = new Vec(shape.x, shape.y)\n\t\t\t\t\t\t\tnewPos.rot(-shape.rotation)\n\t\t\t\t\t\t\tnewPos.add(new Vec(shape.props.w / 2 - width / 2, shape.props.h / 2 - height / 2))\n\t\t\t\t\t\t\tnewPos.rot(shape.rotation)\n\n\t\t\t\t\t\t\tconst shapeToCreate: TLShapePartial<TLEmbedShape> = {\n\t\t\t\t\t\t\t\tid: createShapeId(),\n\t\t\t\t\t\t\t\ttype: 'embed',\n\t\t\t\t\t\t\t\tx: newPos.x,\n\t\t\t\t\t\t\t\ty: newPos.y,\n\t\t\t\t\t\t\t\trotation: shape.rotation,\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\t\tw: width,\n\t\t\t\t\t\t\t\t\th: height,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcreateList.push(shapeToCreate)\n\t\t\t\t\t\t\tdeleteList.push(shape.id)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.mark('convert shapes to embed')\n\t\t\t\t\t\teditor.deleteShapes(deleteList)\n\t\t\t\t\t\teditor.createShapes(createList)\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'duplicate',\n\t\t\t\tkbd: '$d',\n\t\t\t\tlabel: 'action.duplicate',\n\t\t\t\ticon: 'duplicate',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('duplicate-shapes', { source })\n\t\t\t\t\tconst instanceState = editor.getInstanceState()\n\t\t\t\t\tlet ids: TLShapeId[]\n\t\t\t\t\tlet offset: { x: number; y: number }\n\n\t\t\t\t\tif (instanceState.duplicateProps) {\n\t\t\t\t\t\tids = instanceState.duplicateProps.shapeIds\n\t\t\t\t\t\toffset = instanceState.duplicateProps.offset\n\t\t\t\t\t} else {\n\t\t\t\t\t\tids = editor.getSelectedShapeIds()\n\t\t\t\t\t\tconst commonBounds = Box.Common(compact(ids.map((id) => editor.getShapePageBounds(id))))\n\t\t\t\t\t\toffset = instanceState.canMoveCamera\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tx: commonBounds.width + 20,\n\t\t\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\t\t// same as the adjacent note margin\n\t\t\t\t\t\t\t\t\tx: 20,\n\t\t\t\t\t\t\t\t\ty: 20,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.mark('duplicate shapes')\n\t\t\t\t\teditor.duplicateShapes(ids, offset)\n\n\t\t\t\t\tif (instanceState.duplicateProps) {\n\t\t\t\t\t\t// If we are using duplicate props then we update the shape ids to the\n\t\t\t\t\t\t// ids of the newly created shapes to keep the duplication going\n\t\t\t\t\t\teditor.updateInstanceState({\n\t\t\t\t\t\t\tduplicateProps: {\n\t\t\t\t\t\t\t\t...instanceState.duplicateProps,\n\t\t\t\t\t\t\t\tshapeIds: editor.getSelectedShapeIds(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'ungroup',\n\t\t\t\tlabel: 'action.ungroup',\n\t\t\t\tkbd: '$!g',\n\t\t\t\ticon: 'ungroup',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('ungroup-shapes', { source })\n\t\t\t\t\teditor.mark('ungroup')\n\t\t\t\t\teditor.ungroupShapes(editor.getSelectedShapeIds())\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'group',\n\t\t\t\tlabel: 'action.group',\n\t\t\t\tkbd: '$g',\n\t\t\t\ticon: 'group',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('group-shapes', { source })\n\t\t\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\t\t\t\tif (onlySelectedShape && editor.isShapeOfType<TLGroupShape>(onlySelectedShape, 'group')) {\n\t\t\t\t\t\teditor.mark('ungroup')\n\t\t\t\t\t\teditor.ungroupShapes(editor.getSelectedShapeIds())\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.mark('group')\n\t\t\t\t\t\teditor.groupShapes(editor.getSelectedShapeIds())\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'remove-frame',\n\t\t\t\tlabel: 'action.remove-frame',\n\t\t\t\tkbd: '$!f',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\n\t\t\t\t\ttrackEvent('remove-frame', { source })\n\t\t\t\t\tconst selectedShapes = editor.getSelectedShapes()\n\t\t\t\t\tif (\n\t\t\t\t\t\tselectedShapes.length > 0 &&\n\t\t\t\t\t\tselectedShapes.every((shape) => editor.isShapeOfType<TLFrameShape>(shape, 'frame'))\n\t\t\t\t\t) {\n\t\t\t\t\t\teditor.mark('remove-frame')\n\t\t\t\t\t\tremoveFrame(\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\tselectedShapes.map((shape) => shape.id)\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'fit-frame-to-content',\n\t\t\t\tlabel: 'action.fit-frame-to-content',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\n\t\t\t\t\ttrackEvent('fit-frame-to-content', { source })\n\t\t\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\t\t\t\tif (onlySelectedShape && editor.isShapeOfType<TLFrameShape>(onlySelectedShape, 'frame')) {\n\t\t\t\t\t\teditor.mark('fit-frame-to-content')\n\t\t\t\t\t\tfitFrameToContent(editor, onlySelectedShape.id)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'align-left',\n\t\t\t\tlabel: 'action.align-left',\n\t\t\t\tkbd: '?A',\n\t\t\t\ticon: 'align-left',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('align-shapes', { operation: 'left', source })\n\t\t\t\t\teditor.mark('align left')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.alignShapes(selectedShapeIds, 'left')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'align-center-horizontal',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.align-center-horizontal',\n\t\t\t\t\t['context-menu']: 'action.align-center-horizontal.short',\n\t\t\t\t},\n\t\t\t\tkbd: '?H',\n\t\t\t\ticon: 'align-center-horizontal',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('align-shapes', { operation: 'center-horizontal', source })\n\t\t\t\t\teditor.mark('align center horizontal')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.alignShapes(selectedShapeIds, 'center-horizontal')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'align-right',\n\t\t\t\tlabel: 'action.align-right',\n\t\t\t\tkbd: '?D',\n\t\t\t\ticon: 'align-right',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('align-shapes', { operation: 'right', source })\n\t\t\t\t\teditor.mark('align right')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.alignShapes(selectedShapeIds, 'right')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'align-center-vertical',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.align-center-vertical',\n\t\t\t\t\t['context-menu']: 'action.align-center-vertical.short',\n\t\t\t\t},\n\t\t\t\tkbd: '?V',\n\t\t\t\ticon: 'align-center-vertical',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('align-shapes', { operation: 'center-vertical', source })\n\t\t\t\t\teditor.mark('align center vertical')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.alignShapes(selectedShapeIds, 'center-vertical')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'align-top',\n\t\t\t\tlabel: 'action.align-top',\n\t\t\t\ticon: 'align-top',\n\t\t\t\tkbd: '?W',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('align-shapes', { operation: 'top', source })\n\t\t\t\t\teditor.mark('align top')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.alignShapes(selectedShapeIds, 'top')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'align-bottom',\n\t\t\t\tlabel: 'action.align-bottom',\n\t\t\t\ticon: 'align-bottom',\n\t\t\t\tkbd: '?S',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('align-shapes', { operation: 'bottom', source })\n\t\t\t\t\teditor.mark('align bottom')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.alignShapes(selectedShapeIds, 'bottom')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'distribute-horizontal',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.distribute-horizontal',\n\t\t\t\t\t['context-menu']: 'action.distribute-horizontal.short',\n\t\t\t\t},\n\t\t\t\ticon: 'distribute-horizontal',\n\t\t\t\tkbd: '?!h',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('distribute-shapes', { operation: 'horizontal', source })\n\t\t\t\t\teditor.mark('distribute horizontal')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.distributeShapes(selectedShapeIds, 'horizontal')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'distribute-vertical',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.distribute-vertical',\n\t\t\t\t\t['context-menu']: 'action.distribute-vertical.short',\n\t\t\t\t},\n\t\t\t\ticon: 'distribute-vertical',\n\t\t\t\tkbd: '?!V',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('distribute-shapes', { operation: 'vertical', source })\n\t\t\t\t\teditor.mark('distribute vertical')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.distributeShapes(selectedShapeIds, 'vertical')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'stretch-horizontal',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.stretch-horizontal',\n\t\t\t\t\t['context-menu']: 'action.stretch-horizontal.short',\n\t\t\t\t},\n\t\t\t\ticon: 'stretch-horizontal',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('stretch-shapes', { operation: 'horizontal', source })\n\t\t\t\t\teditor.mark('stretch horizontal')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.stretchShapes(selectedShapeIds, 'horizontal')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'stretch-vertical',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.stretch-vertical',\n\t\t\t\t\t['context-menu']: 'action.stretch-vertical.short',\n\t\t\t\t},\n\t\t\t\ticon: 'stretch-vertical',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('stretch-shapes', { operation: 'vertical', source })\n\t\t\t\t\teditor.mark('stretch vertical')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.stretchShapes(selectedShapeIds, 'vertical')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'flip-horizontal',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.flip-horizontal',\n\t\t\t\t\t['context-menu']: 'action.flip-horizontal.short',\n\t\t\t\t},\n\t\t\t\tkbd: '!h',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('flip-shapes', { operation: 'horizontal', source })\n\t\t\t\t\teditor.mark('flip horizontal')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.flipShapes(selectedShapeIds, 'horizontal')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'flip-vertical',\n\t\t\t\tlabel: { default: 'action.flip-vertical', ['context-menu']: 'action.flip-vertical.short' },\n\t\t\t\tkbd: '!v',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('flip-shapes', { operation: 'vertical', source })\n\t\t\t\t\teditor.mark('flip vertical')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.flipShapes(selectedShapeIds, 'vertical')\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'pack',\n\t\t\t\tlabel: 'action.pack',\n\t\t\t\ticon: 'pack',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('pack-shapes', { source })\n\t\t\t\t\teditor.mark('pack')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.packShapes(selectedShapeIds, 16)\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'stack-vertical',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.stack-vertical',\n\t\t\t\t\t['context-menu']: 'action.stack-vertical.short',\n\t\t\t\t},\n\t\t\t\ticon: 'stack-vertical',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('stack-shapes', { operation: 'vertical', source })\n\t\t\t\t\teditor.mark('stack-vertical')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.stackShapes(selectedShapeIds, 'vertical', 16)\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'stack-horizontal',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.stack-horizontal',\n\t\t\t\t\t['context-menu']: 'action.stack-horizontal.short',\n\t\t\t\t},\n\t\t\t\ticon: 'stack-horizontal',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('stack-shapes', { operation: 'horizontal', source })\n\t\t\t\t\teditor.mark('stack-horizontal')\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.stackShapes(selectedShapeIds, 'horizontal', 16)\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'bring-to-front',\n\t\t\t\tlabel: 'action.bring-to-front',\n\t\t\t\tkbd: ']',\n\t\t\t\ticon: 'bring-to-front',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('reorder-shapes', { operation: 'toFront', source })\n\t\t\t\t\teditor.mark('bring to front')\n\t\t\t\t\teditor.bringToFront(editor.getSelectedShapeIds())\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'bring-forward',\n\t\t\t\tlabel: 'action.bring-forward',\n\t\t\t\ticon: 'bring-forward',\n\t\t\t\tkbd: '?]',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('reorder-shapes', { operation: 'forward', source })\n\t\t\t\t\teditor.mark('bring forward')\n\t\t\t\t\teditor.bringForward(editor.getSelectedShapeIds())\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'send-backward',\n\t\t\t\tlabel: 'action.send-backward',\n\t\t\t\ticon: 'send-backward',\n\t\t\t\tkbd: '?[',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('reorder-shapes', { operation: 'backward', source })\n\t\t\t\t\teditor.mark('send backward')\n\t\t\t\t\teditor.sendBackward(editor.getSelectedShapeIds())\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'send-to-back',\n\t\t\t\tlabel: 'action.send-to-back',\n\t\t\t\ticon: 'send-to-back',\n\t\t\t\tkbd: '[',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('reorder-shapes', { operation: 'toBack', source })\n\t\t\t\t\teditor.mark('send to back')\n\t\t\t\t\teditor.sendToBack(editor.getSelectedShapeIds())\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'cut',\n\t\t\t\tlabel: 'action.cut',\n\t\t\t\tkbd: '$x',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\teditor.mark('cut')\n\t\t\t\t\tcut(source)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'copy',\n\t\t\t\tlabel: 'action.copy',\n\t\t\t\tkbd: '$c',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\tcopy(source)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'paste',\n\t\t\t\tlabel: 'action.paste',\n\t\t\t\tkbd: '$v',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tnavigator.clipboard?.read().then((clipboardItems) => {\n\t\t\t\t\t\tpaste(\n\t\t\t\t\t\t\tclipboardItems,\n\t\t\t\t\t\t\tsource,\n\t\t\t\t\t\t\tsource === 'context-menu' ? editor.inputs.currentPagePoint : undefined\n\t\t\t\t\t\t)\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'select-all',\n\t\t\t\tlabel: 'action.select-all',\n\t\t\t\tkbd: '$a',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.batch(() => {\n\t\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\t\ttrackEvent('select-all-shapes', { source })\n\n\t\t\t\t\t\teditor.mark('select all kbd')\n\t\t\t\t\t\teditor.selectAll()\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'select-none',\n\t\t\t\tlabel: 'action.select-none',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('select-none-shapes', { source })\n\t\t\t\t\teditor.mark('select none')\n\t\t\t\t\teditor.selectNone()\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'delete',\n\t\t\t\tlabel: 'action.delete',\n\t\t\t\tkbd: '\u232B,del,backspace',\n\t\t\t\ticon: 'trash',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('delete-shapes', { source })\n\t\t\t\t\teditor.mark('delete')\n\t\t\t\t\teditor.deleteShapes(editor.getSelectedShapeIds())\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'rotate-cw',\n\t\t\t\tlabel: 'action.rotate-cw',\n\t\t\t\ticon: 'rotate-cw',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('rotate-cw', { source })\n\t\t\t\t\teditor.mark('rotate-cw')\n\t\t\t\t\tconst offset = editor.getSelectionRotation() % (HALF_PI / 2)\n\t\t\t\t\tconst dontUseOffset = approximately(offset, 0) || approximately(offset, HALF_PI / 2)\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.rotateShapesBy(selectedShapeIds, HALF_PI / 2 - (dontUseOffset ? 0 : offset))\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'rotate-ccw',\n\t\t\t\tlabel: 'action.rotate-ccw',\n\t\t\t\ticon: 'rotate-ccw',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('rotate-ccw', { source })\n\t\t\t\t\teditor.mark('rotate-ccw')\n\t\t\t\t\tconst offset = editor.getSelectionRotation() % (HALF_PI / 2)\n\t\t\t\t\tconst offsetCloseToZero = approximately(offset, 0)\n\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.rotateShapesBy(selectedShapeIds, offsetCloseToZero ? -(HALF_PI / 2) : -offset)\n\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'zoom-in',\n\t\t\t\tlabel: 'action.zoom-in',\n\t\t\t\tkbd: '$=,=',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('zoom-in', { source })\n\t\t\t\t\teditor.zoomIn(editor.getViewportScreenCenter(), { duration: ANIMATION_MEDIUM_MS })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'zoom-out',\n\t\t\t\tlabel: 'action.zoom-out',\n\t\t\t\tkbd: '$-,-',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('zoom-out', { source })\n\t\t\t\t\teditor.zoomOut(editor.getViewportScreenCenter(), { duration: ANIMATION_MEDIUM_MS })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'zoom-to-100',\n\t\t\t\tlabel: 'action.zoom-to-100',\n\t\t\t\ticon: 'reset-zoom',\n\t\t\t\tkbd: '!0',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('reset-zoom', { source })\n\t\t\t\t\teditor.resetZoom(editor.getViewportScreenCenter(), { duration: ANIMATION_MEDIUM_MS })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'zoom-to-fit',\n\t\t\t\tlabel: 'action.zoom-to-fit',\n\t\t\t\tkbd: '!1',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('zoom-to-fit', { source })\n\t\t\t\t\teditor.zoomToFit({ duration: ANIMATION_MEDIUM_MS })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'zoom-to-selection',\n\t\t\t\tlabel: 'action.zoom-to-selection',\n\t\t\t\tkbd: '!2',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tif (!canApplySelectionAction()) return\n\t\t\t\t\tif (mustGoBackToSelectToolFirst()) return\n\n\t\t\t\t\ttrackEvent('zoom-to-selection', { source })\n\t\t\t\t\teditor.zoomToSelection({ duration: ANIMATION_MEDIUM_MS })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-snap-mode',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-snap-mode',\n\t\t\t\t\tmenu: 'action.toggle-snap-mode.menu',\n\t\t\t\t},\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-snap-mode', { source })\n\t\t\t\t\teditor.user.updateUserPreferences({ isSnapMode: !editor.user.getIsSnapMode() })\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-dark-mode',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-dark-mode',\n\t\t\t\t\tmenu: 'action.toggle-dark-mode.menu',\n\t\t\t\t},\n\t\t\t\tkbd: '$/',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-dark-mode', { source })\n\t\t\t\t\teditor.user.updateUserPreferences({ isDarkMode: !editor.user.getIsDarkMode() })\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-wrap-mode',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-wrap-mode',\n\t\t\t\t\tmenu: 'action.toggle-wrap-mode.menu',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-wrap-mode', { source })\n\t\t\t\t\teditor.user.updateUserPreferences({\n\t\t\t\t\t\tisWrapMode: !editor.user.getIsWrapMode(),\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-reduce-motion',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-reduce-motion',\n\t\t\t\t\tmenu: 'action.toggle-reduce-motion.menu',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-reduce-motion', { source })\n\t\t\t\t\teditor.user.updateUserPreferences({\n\t\t\t\t\t\tanimationSpeed: editor.user.getAnimationSpeed() === 0 ? 1 : 0,\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-edge-scrolling',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-edge-scrolling',\n\t\t\t\t\tmenu: 'action.toggle-edge-scrolling.menu',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-edge-scrolling', { source })\n\t\t\t\t\teditor.user.updateUserPreferences({\n\t\t\t\t\t\tedgeScrollSpeed: editor.user.getEdgeScrollSpeed() === 0 ? 1 : 0,\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-transparent',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-transparent',\n\t\t\t\t\tmenu: 'action.toggle-transparent.menu',\n\t\t\t\t\t['context-menu']: 'action.toggle-transparent.context-menu',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-transparent', { source })\n\t\t\t\t\teditor.updateInstanceState(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\texportBackground: !editor.getInstanceState().exportBackground,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ ephemeral: true }\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-tool-lock',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-tool-lock',\n\t\t\t\t\tmenu: 'action.toggle-tool-lock.menu',\n\t\t\t\t},\n\t\t\t\tkbd: 'q',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-tool-lock', { source })\n\t\t\t\t\teditor.updateInstanceState({ isToolLocked: !editor.getInstanceState().isToolLocked })\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'unlock-all',\n\t\t\t\tlabel: 'action.unlock-all',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('unlock-all', { source })\n\t\t\t\t\tconst updates = [] as TLShapePartial[]\n\t\t\t\t\tfor (const shape of editor.getCurrentPageShapes()) {\n\t\t\t\t\t\tif (shape.isLocked) {\n\t\t\t\t\t\t\tupdates.push({ id: shape.id, type: shape.type, isLocked: false })\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (updates.length > 0) {\n\t\t\t\t\t\teditor.updateShapes(updates)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-focus-mode',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-focus-mode',\n\t\t\t\t\tmenu: 'action.toggle-focus-mode.menu',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tkbd: '$.',\n\t\t\t\tcheckbox: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\t// this needs to be deferred because it causes the menu\n\t\t\t\t\t// UI to unmount which puts us in a dodgy state\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\teditor.batch(() => {\n\t\t\t\t\t\t\ttrackEvent('toggle-focus-mode', { source })\n\t\t\t\t\t\t\tclearDialogs()\n\t\t\t\t\t\t\tclearToasts()\n\t\t\t\t\t\t\teditor.updateInstanceState({ isFocusMode: !editor.getInstanceState().isFocusMode })\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-grid',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-grid',\n\t\t\t\t\tmenu: 'action.toggle-grid.menu',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tkbd: \"$'\",\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-grid-mode', { source })\n\t\t\t\t\teditor.updateInstanceState({ isGridMode: !editor.getInstanceState().isGridMode })\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-debug-mode',\n\t\t\t\tlabel: {\n\t\t\t\t\tdefault: 'action.toggle-debug-mode',\n\t\t\t\t\tmenu: 'action.toggle-debug-mode.menu',\n\t\t\t\t},\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('toggle-debug-mode', { source })\n\t\t\t\t\teditor.updateInstanceState({\n\t\t\t\t\t\tisDebugMode: !editor.getInstanceState().isDebugMode,\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tcheckbox: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'print',\n\t\t\t\tlabel: 'action.print',\n\t\t\t\tkbd: '$p',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('print', { source })\n\t\t\t\t\tprintSelectionOrPages()\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'exit-pen-mode',\n\t\t\t\tlabel: 'action.exit-pen-mode',\n\t\t\t\ticon: 'cross-2',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('exit-pen-mode', { source })\n\t\t\t\t\teditor.updateInstanceState({ isPenMode: false })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'stop-following',\n\t\t\t\tlabel: 'action.stop-following',\n\t\t\t\ticon: 'cross-2',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('stop-following', { source })\n\t\t\t\t\teditor.stopFollowingUser()\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'back-to-content',\n\t\t\t\tlabel: 'action.back-to-content',\n\t\t\t\ticon: 'arrow-left',\n\t\t\t\treadonlyOk: true,\n\t\t\t\tonSelect(source) {\n\t\t\t\t\ttrackEvent('zoom-to-content', { source })\n\t\t\t\t\teditor.zoomToContent()\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'toggle-lock',\n\t\t\t\tlabel: 'action.toggle-lock',\n\t\t\t\tkbd: '!l',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\teditor.mark('locking')\n\t\t\t\t\ttrackEvent('toggle-lock', { source })\n\t\t\t\t\teditor.toggleLock(editor.getSelectedShapeIds())\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'new-page',\n\t\t\t\tlabel: 'context.pages.new-page',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tconst newPageId = PageRecordType.createId()\n\t\t\t\t\tconst ids = editor.getSelectedShapeIds()\n\t\t\t\t\teditor.batch(() => {\n\t\t\t\t\t\teditor.mark('move_shapes_to_page')\n\t\t\t\t\t\teditor.createPage({ name: msg('page-menu.new-page-initial-name'), id: newPageId })\n\t\t\t\t\t\teditor.moveShapesToPage(ids, newPageId)\n\t\t\t\t\t})\n\t\t\t\t\ttrackEvent('new-page', { source })\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'select-white-color',\n\t\t\t\tlabel: 'color-style.white',\n\t\t\t\tkbd: '?t',\n\t\t\t\tonSelect(source) {\n\t\t\t\t\tconst style = DefaultColorStyle\n\t\t\t\t\teditor.batch(() => {\n\t\t\t\t\t\teditor.mark('change-color')\n\t\t\t\t\t\tif (editor.isIn('select')) {\n\t\t\t\t\t\t\teditor.setStyleForSelectedShapes(style, 'white', { squashing: false })\n\t\t\t\t\t\t}\n\t\t\t\t\t\teditor.setStyleForNextShapes(style, 'white', { squashing: false })\n\t\t\t\t\t\teditor.updateInstanceState({ isChangingStyle: true }, { ephemeral: true })\n\t\t\t\t\t})\n\t\t\t\t\ttrackEvent('set-style', { source, id: style.id, value: 'white' })\n\t\t\t\t},\n\t\t\t},\n\t\t]\n\n\t\tconst actions = makeActions(actionItems)\n\n\t\tif (overrides) {\n\t\t\treturn overrides(editor, actions, undefined)\n\t\t}\n\n\t\treturn actions\n\t}, [\n\t\teditor,\n\t\ttrackEvent,\n\t\toverrides,\n\t\taddDialog,\n\t\tinsertMedia,\n\t\texportAs,\n\t\tcopyAs,\n\t\tcut,\n\t\tcopy,\n\t\tpaste,\n\t\tclearDialogs,\n\t\tclearToasts,\n\t\tprintSelectionOrPages,\n\t\tmsg,\n\t\tdefaultDocumentName,\n\t])\n\n\treturn <ActionsContext.Provider value={asActions(actions)}>{children}</ActionsContext.Provider>\n}\n\n/** @public */\nexport function useActions() {\n\tconst ctx = React.useContext(ActionsContext)\n\n\tif (!ctx) {\n\t\tthrow new Error('useTools must be used within a ToolProvider')\n\t}\n\n\treturn ctx\n}\n\nfunction asActions<T extends Record<string, TLUiActionItem>>(actions: T) {\n\treturn actions as Record<keyof typeof actions, TLUiActionItem>\n}\n\n/** @public */\nexport function unwrapLabel(label?: TLUiActionItem['label'], menuType?: string) {\n\treturn label\n\t\t? typeof label === 'string'\n\t\t\t? label\n\t\t\t: menuType\n\t\t\t\t? label[menuType] ?? label['default']\n\t\t\t\t: undefined\n\t\t: undefined\n}\n", "import { Box, Editor, TLFrameShape, TLShapeId, TLShapePartial, Vec, compact } from '@tldraw/editor'\n\n/**\n * Remove a frame.\n *\n * @param editor - tldraw editor instance.\n * @param ids - Ids of the frames you wish to remove.\n *\n * @public\n */\nexport function removeFrame(editor: Editor, ids: TLShapeId[]) {\n\tconst frames = compact(\n\t\tids\n\t\t\t.map((id) => editor.getShape<TLFrameShape>(id))\n\t\t\t.filter((f) => f && editor.isShapeOfType<TLFrameShape>(f, 'frame'))\n\t)\n\tif (!frames.length) return\n\n\tconst allChildren: TLShapeId[] = []\n\teditor.batch(() => {\n\t\tframes.map((frame) => {\n\t\t\tconst children = editor.getSortedChildIdsForParent(frame.id)\n\t\t\tif (children.length) {\n\t\t\t\teditor.reparentShapes(children, frame.parentId, frame.index)\n\t\t\t\tallChildren.push(...children)\n\t\t\t}\n\t\t})\n\t\teditor.setSelectedShapes(allChildren)\n\t\teditor.deleteShapes(ids)\n\t})\n}\n\n/** @internal */\nexport const DEFAULT_FRAME_PADDING = 50\n\n/**\n * Fit a frame to its content.\n *\n * @param id - Id of the frame you wish to fit to content.\n * @param editor - tlraw editor instance.\n * @param opts - Options for fitting the frame.\n *\n * @public\n */\nexport function fitFrameToContent(editor: Editor, id: TLShapeId, opts = {} as { padding: number }) {\n\tconst frame = editor.getShape<TLFrameShape>(id)\n\tif (!frame) return\n\n\tconst childIds = editor.getSortedChildIdsForParent(frame.id)\n\tconst children = compact(childIds.map((id) => editor.getShape(id)))\n\tif (!children.length) return\n\n\tconst bounds = Box.FromPoints(\n\t\tchildren.flatMap((shape) => {\n\t\t\tconst geometry = editor.getShapeGeometry(shape.id)\n\t\t\treturn editor.getShapeLocalTransform(shape)!.applyToPoints(geometry.vertices)\n\t\t})\n\t)\n\n\tconst { padding = DEFAULT_FRAME_PADDING } = opts\n\tconst w = bounds.w + 2 * padding\n\tconst h = bounds.h + 2 * padding\n\tconst dx = padding - bounds.minX\n\tconst dy = padding - bounds.minY\n\t// The shapes already perfectly fit the frame.\n\tif (dx === 0 && dy === 0 && frame.props.w === w && frame.props.h === h) return\n\n\tconst diff = new Vec(dx, dy).rot(frame.rotation)\n\teditor.batch(() => {\n\t\tconst changes: TLShapePartial[] = childIds.map((child) => {\n\t\t\tconst shape = editor.getShape(child)!\n\t\t\treturn {\n\t\t\t\tid: shape.id,\n\t\t\t\ttype: shape.type,\n\t\t\t\tx: shape.x + dx,\n\t\t\t\ty: shape.y + dy,\n\t\t\t}\n\t\t})\n\n\t\tchanges.push({\n\t\t\tid: frame.id,\n\t\t\ttype: frame.type,\n\t\t\tx: frame.x - diff.x,\n\t\t\ty: frame.y - diff.y,\n\t\t\tprops: {\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t},\n\t\t})\n\n\t\teditor.updateShapes(changes)\n\t})\n}\n", "import { T, TLBaseShape, track, useEditor } from '@tldraw/editor'\nimport { useCallback, useEffect, useRef, useState } from 'react'\nimport { TLUiDialogProps } from '../context/dialogs'\nimport { useTranslation } from '../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from './primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonLabel } from './primitives/Button/TldrawUiButtonLabel'\nimport {\n\tTldrawUiDialogBody,\n\tTldrawUiDialogCloseButton,\n\tTldrawUiDialogFooter,\n\tTldrawUiDialogHeader,\n\tTldrawUiDialogTitle,\n} from './primitives/TldrawUiDialog'\nimport { TldrawUiInput } from './primitives/TldrawUiInput'\n\n// A url can either be invalid, or valid with a protocol, or valid without a protocol.\n// For example, \"aol.com\" would be valid with a protocol ()\nfunction validateUrl(url: string) {\n\tif (T.linkUrl.isValid(url)) {\n\t\treturn { isValid: true, hasProtocol: true }\n\t}\n\tif (T.linkUrl.isValid('https://' + url)) {\n\t\treturn { isValid: true, hasProtocol: false }\n\t}\n\treturn { isValid: false, hasProtocol: false }\n}\n\ntype ShapeWithUrl = TLBaseShape<string, { url: string }>\n\nexport const EditLinkDialog = track(function EditLinkDialog({ onClose }: TLUiDialogProps) {\n\tconst editor = useEditor()\n\n\tconst selectedShape = editor.getOnlySelectedShape()\n\n\tif (\n\t\t!(selectedShape && 'url' in selectedShape.props && typeof selectedShape.props.url === 'string')\n\t) {\n\t\treturn null\n\t}\n\n\treturn <EditLinkDialogInner onClose={onClose} selectedShape={selectedShape as ShapeWithUrl} />\n})\n\nexport const EditLinkDialogInner = track(function EditLinkDialogInner({\n\tonClose,\n\tselectedShape,\n}: TLUiDialogProps & { selectedShape: ShapeWithUrl }) {\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\n\tconst rInput = useRef<HTMLInputElement>(null)\n\n\tuseEffect(() => {\n\t\trequestAnimationFrame(() => rInput.current?.focus())\n\t}, [])\n\n\tconst rInitialValue = useRef(selectedShape.props.url)\n\n\tconst [urlInputState, setUrlInputState] = useState(() => {\n\t\tconst urlValidResult = validateUrl(selectedShape.props.url)\n\n\t\tconst initialValue =\n\t\t\turlValidResult.isValid === true\n\t\t\t\t? urlValidResult.hasProtocol\n\t\t\t\t\t? selectedShape.props.url\n\t\t\t\t\t: 'https://' + selectedShape.props.url\n\t\t\t\t: 'https://'\n\n\t\treturn {\n\t\t\tactual: initialValue,\n\t\t\tsafe: initialValue,\n\t\t\tvalid: true,\n\t\t}\n\t})\n\n\tconst handleChange = useCallback((rawValue: string) => {\n\t\t// Just auto-correct double https:// from a bad paste.\n\t\tconst fixedRawValue = rawValue.replace(/https?:\\/\\/(https?:\\/\\/)/, (_match, arg1) => {\n\t\t\treturn arg1\n\t\t})\n\n\t\tconst urlValidResult = validateUrl(fixedRawValue)\n\n\t\tconst safeValue =\n\t\t\turlValidResult.isValid === true\n\t\t\t\t? urlValidResult.hasProtocol\n\t\t\t\t\t? fixedRawValue\n\t\t\t\t\t: 'https://' + fixedRawValue\n\t\t\t\t: 'https://'\n\n\t\tsetUrlInputState({\n\t\t\tactual: fixedRawValue,\n\t\t\tsafe: safeValue,\n\t\t\tvalid: urlValidResult.isValid,\n\t\t})\n\t}, [])\n\n\tconst handleClear = useCallback(() => {\n\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\tif (!onlySelectedShape) return\n\t\teditor.updateShapes([\n\t\t\t{ id: onlySelectedShape.id, type: onlySelectedShape.type, props: { url: '' } },\n\t\t])\n\t\tonClose()\n\t}, [editor, onClose])\n\n\tconst handleComplete = useCallback(() => {\n\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\n\t\tif (!onlySelectedShape) return\n\n\t\t// ? URL is a magic value\n\t\tif (onlySelectedShape && 'url' in onlySelectedShape.props) {\n\t\t\t// Here would be a good place to validate the next shape\u2014would setting the empty\n\t\t\tif (onlySelectedShape.props.url !== urlInputState.safe) {\n\t\t\t\teditor.updateShapes([\n\t\t\t\t\t{\n\t\t\t\t\t\tid: onlySelectedShape.id,\n\t\t\t\t\t\ttype: onlySelectedShape.type,\n\t\t\t\t\t\tprops: { url: urlInputState.safe },\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t}\n\t\t}\n\t\tonClose()\n\t}, [editor, onClose, urlInputState])\n\n\tconst handleCancel = useCallback(() => {\n\t\tonClose()\n\t}, [onClose])\n\n\tif (!selectedShape) {\n\t\t// dismiss modal\n\t\tonClose()\n\t\treturn null\n\t}\n\n\t// Are we going from a valid state to an invalid state?\n\tconst isRemoving = rInitialValue.current && !urlInputState.valid\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiDialogHeader>\n\t\t\t\t<TldrawUiDialogTitle>{msg('edit-link-dialog.title')}</TldrawUiDialogTitle>\n\t\t\t\t<TldrawUiDialogCloseButton />\n\t\t\t</TldrawUiDialogHeader>\n\t\t\t<TldrawUiDialogBody>\n\t\t\t\t<div className=\"tlui-edit-link-dialog\">\n\t\t\t\t\t<TldrawUiInput\n\t\t\t\t\t\tref={rInput}\n\t\t\t\t\t\tclassName=\"tlui-edit-link-dialog__input\"\n\t\t\t\t\t\tlabel=\"edit-link-dialog.url\"\n\t\t\t\t\t\tautofocus\n\t\t\t\t\t\tvalue={urlInputState.actual}\n\t\t\t\t\t\tonValueChange={handleChange}\n\t\t\t\t\t\tonComplete={handleComplete}\n\t\t\t\t\t\tonCancel={handleCancel}\n\t\t\t\t\t/>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{urlInputState.valid\n\t\t\t\t\t\t\t? msg('edit-link-dialog.detail')\n\t\t\t\t\t\t\t: msg('edit-link-dialog.invalid-url')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</TldrawUiDialogBody>\n\t\t\t<TldrawUiDialogFooter className=\"tlui-dialog__footer__actions\">\n\t\t\t\t<TldrawUiButton type=\"normal\" onClick={handleCancel} onTouchEnd={handleCancel}>\n\t\t\t\t\t<TldrawUiButtonLabel>{msg('edit-link-dialog.cancel')}</TldrawUiButtonLabel>\n\t\t\t\t</TldrawUiButton>\n\t\t\t\t{isRemoving ? (\n\t\t\t\t\t<TldrawUiButton type={'danger'} onTouchEnd={handleClear} onClick={handleClear}>\n\t\t\t\t\t\t<TldrawUiButtonLabel>{msg('edit-link-dialog.clear')}</TldrawUiButtonLabel>\n\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t) : (\n\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\tdisabled={!urlInputState.valid}\n\t\t\t\t\t\tonTouchEnd={handleComplete}\n\t\t\t\t\t\tonClick={handleComplete}\n\t\t\t\t\t>\n\t\t\t\t\t\t<TldrawUiButtonLabel>{msg('edit-link-dialog.save')}</TldrawUiButtonLabel>\n\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t)}\n\t\t\t</TldrawUiDialogFooter>\n\t\t</>\n\t)\n})\n", "import {\n\tEditor,\n\tFileHelpers,\n\tTLArrowShape,\n\tTLBookmarkShape,\n\tTLEmbedShape,\n\tTLExternalContentSource,\n\tTLGeoShape,\n\tTLTextShape,\n\tVecLike,\n\tisNonNull,\n\tpreventDefault,\n\tstopEventPropagation,\n\tuniq,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\nimport { compressToBase64, decompressFromBase64 } from 'lz-string'\nimport { useCallback, useEffect } from 'react'\nimport { TLUiEventSource, useUiEvents } from '../context/events'\nimport { pasteExcalidrawContent } from './clipboard/pasteExcalidrawContent'\nimport { pasteFiles } from './clipboard/pasteFiles'\nimport { pasteTldrawContent } from './clipboard/pasteTldrawContent'\nimport { pasteUrl } from './clipboard/pasteUrl'\n\n/**\n * Strip HTML tags from a string.\n * @param html - The HTML to strip.\n * @internal\n */\nfunction stripHtml(html: string) {\n\t// See <https://github.com/developit/preact-markup/blob/4788b8d61b4e24f83688710746ee36e7464f7bbc/src/parse-markup.js#L60-L69>\n\tconst doc = document.implementation.createHTMLDocument('')\n\tdoc.documentElement.innerHTML = html.trim()\n\treturn doc.body.textContent || doc.body.innerText || ''\n}\n\n/** @public */\nexport const isValidHttpURL = (url: string) => {\n\ttry {\n\t\tconst u = new URL(url)\n\t\treturn u.protocol === 'http:' || u.protocol === 'https:'\n\t} catch (e) {\n\t\treturn false\n\t}\n}\n\n/** @public */\nconst getValidHttpURLList = (url: string) => {\n\tconst urls = url.split(/[\\n\\s]/)\n\tfor (const url of urls) {\n\t\ttry {\n\t\t\tconst u = new URL(url)\n\t\t\tif (!(u.protocol === 'http:' || u.protocol === 'https:')) {\n\t\t\t\treturn\n\t\t\t}\n\t\t} catch (e) {\n\t\t\treturn\n\t\t}\n\t}\n\treturn uniq(urls)\n}\n\n/** @public */\nconst isSvgText = (text: string) => {\n\treturn /^<svg/.test(text)\n}\n\nconst INPUTS = ['input', 'select', 'textarea']\n\n/**\n * Get whether to disallow clipboard events.\n *\n * @param editor - The editor instance.\n * @internal\n */\nfunction disallowClipboardEvents(editor: Editor) {\n\tconst { activeElement } = document\n\treturn (\n\t\teditor.getIsMenuOpen() ||\n\t\t(activeElement &&\n\t\t\t(activeElement.getAttribute('contenteditable') ||\n\t\t\t\tINPUTS.indexOf(activeElement.tagName.toLowerCase()) > -1))\n\t)\n}\n\n/**\n * Whether a ClipboardItem is a file.\n * @param item - The ClipboardItem to check.\n * @internal\n */\nconst isFile = (item: ClipboardItem) => {\n\treturn item.types.find((i) => i.match(/^image\\//))\n}\n\n/**\n * Handle text pasted into the editor.\n * @param editor - The editor instance.\n * @param data - The text to paste.\n * @param point - The point at which to paste the text.\n * @internal\n */\nconst handleText = (\n\teditor: Editor,\n\tdata: string,\n\tpoint?: VecLike,\n\tsources?: TLExternalContentSource[]\n) => {\n\tconst validUrlList = getValidHttpURLList(data)\n\tif (validUrlList) {\n\t\tfor (const url of validUrlList) {\n\t\t\tpasteUrl(editor, url, point)\n\t\t}\n\t} else if (isValidHttpURL(data)) {\n\t\tpasteUrl(editor, data, point)\n\t} else if (isSvgText(data)) {\n\t\teditor.mark('paste')\n\t\teditor.putExternalContent({\n\t\t\ttype: 'svg-text',\n\t\t\ttext: data,\n\t\t\tpoint,\n\t\t\tsources,\n\t\t})\n\t} else {\n\t\teditor.mark('paste')\n\t\teditor.putExternalContent({\n\t\t\ttype: 'text',\n\t\t\ttext: data,\n\t\t\tpoint,\n\t\t\tsources,\n\t\t})\n\t}\n}\n\n/**\n * Something found on the clipboard, either through the event's clipboard data or the browser's clipboard API.\n * @internal\n */\ntype ClipboardThing =\n\t| {\n\t\t\ttype: 'file'\n\t\t\tsource: Promise<File | null>\n\t  }\n\t| {\n\t\t\ttype: 'blob'\n\t\t\tsource: Promise<Blob | null>\n\t  }\n\t| {\n\t\t\ttype: 'url'\n\t\t\tsource: Promise<string>\n\t  }\n\t| {\n\t\t\ttype: 'html'\n\t\t\tsource: Promise<string>\n\t  }\n\t| {\n\t\t\ttype: 'text'\n\t\t\tsource: Promise<string>\n\t  }\n\t| {\n\t\t\ttype: string\n\t\t\tsource: Promise<string>\n\t  }\n\n/**\n * Handle a paste using event clipboard data. This is the \"original\"\n * paste method that uses the clipboard data from the paste event.\n * https://developer.mozilla.org/en-US/docs/Web/API/ClipboardEvent/clipboardData\n *\n * @param editor - The editor\n * @param clipboardData - The clipboard data\n * @param point - The point to paste at\n * @internal\n */\nconst handlePasteFromEventClipboardData = async (\n\teditor: Editor,\n\tclipboardData: DataTransfer,\n\tpoint?: VecLike\n) => {\n\t// Do not paste while in any editing state\n\tif (editor.getEditingShapeId() !== null) return\n\n\tif (!clipboardData) {\n\t\tthrow Error('No clipboard data')\n\t}\n\n\tconst things: ClipboardThing[] = []\n\n\tfor (const item of Object.values(clipboardData.items)) {\n\t\tswitch (item.kind) {\n\t\t\tcase 'file': {\n\t\t\t\t// files are always blobs\n\t\t\t\tthings.push({\n\t\t\t\t\ttype: 'file',\n\t\t\t\t\tsource: new Promise((r) => r(item.getAsFile())) as Promise<File | null>,\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'string': {\n\t\t\t\t// strings can be text or html\n\t\t\t\tif (item.type === 'text/html') {\n\t\t\t\t\tthings.push({\n\t\t\t\t\t\ttype: 'html',\n\t\t\t\t\t\tsource: new Promise((r) => item.getAsString(r)) as Promise<string>,\n\t\t\t\t\t})\n\t\t\t\t} else if (item.type === 'text/plain') {\n\t\t\t\t\tthings.push({\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\tsource: new Promise((r) => item.getAsString(r)) as Promise<string>,\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tthings.push({ type: item.type, source: new Promise((r) => item.getAsString(r)) })\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\thandleClipboardThings(editor, things, point)\n}\n\n/**\n * Handle a paste using items retrieved from the Clipboard API.\n * https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem\n *\n * @param editor - The editor\n * @param clipboardItems - The clipboard items to handle\n * @param point - The point to paste at\n * @internal\n */\nconst handlePasteFromClipboardApi = async (\n\teditor: Editor,\n\tclipboardItems: ClipboardItem[],\n\tpoint?: VecLike\n) => {\n\t// We need to populate the array of clipboard things\n\t// based on the ClipboardItems from the Clipboard API.\n\t// This is done in a different way than when using\n\t// the clipboard data from the paste event.\n\n\tconst things: ClipboardThing[] = []\n\n\tfor (const item of clipboardItems) {\n\t\tif (isFile(item)) {\n\t\t\tfor (const type of item.types) {\n\t\t\t\tif (type.match(/^image\\//)) {\n\t\t\t\t\tthings.push({ type: 'blob', source: item.getType(type) })\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (item.types.includes('text/html')) {\n\t\t\tthings.push({\n\t\t\t\ttype: 'html',\n\t\t\t\tsource: (async () => {\n\t\t\t\t\tconst blob = await item.getType('text/html')\n\t\t\t\t\treturn await FileHelpers.blobToText(blob)\n\t\t\t\t})(),\n\t\t\t})\n\t\t}\n\n\t\tif (item.types.includes('text/uri-list')) {\n\t\t\tthings.push({\n\t\t\t\ttype: 'url',\n\t\t\t\tsource: (async () => {\n\t\t\t\t\tconst blob = await item.getType('text/uri-list')\n\t\t\t\t\treturn await FileHelpers.blobToText(blob)\n\t\t\t\t})(),\n\t\t\t})\n\t\t}\n\n\t\tif (item.types.includes('text/plain')) {\n\t\t\tthings.push({\n\t\t\t\ttype: 'text',\n\t\t\t\tsource: (async () => {\n\t\t\t\t\tconst blob = await item.getType('text/plain')\n\t\t\t\t\treturn await FileHelpers.blobToText(blob)\n\t\t\t\t})(),\n\t\t\t})\n\t\t}\n\t}\n\n\treturn await handleClipboardThings(editor, things, point)\n}\n\nasync function handleClipboardThings(editor: Editor, things: ClipboardThing[], point?: VecLike) {\n\t// 1. Handle files\n\t//\n\t// We need to handle files separately because if we want them to\n\t// be placed next to each other, we need to create them all at once.\n\n\tconst files = things.filter(\n\t\t(t) => (t.type === 'file' || t.type === 'blob') && t.source !== null\n\t) as Extract<ClipboardThing, { type: 'file' } | { type: 'blob' }>[]\n\n\t// Just paste the files, nothing else\n\tif (files.length) {\n\t\tconst fileBlobs = await Promise.all(files.map((t) => t.source!))\n\t\tconst urls = (fileBlobs.filter(Boolean) as (File | Blob)[]).map((blob) =>\n\t\t\tURL.createObjectURL(blob)\n\t\t)\n\t\treturn await pasteFiles(editor, urls, point)\n\t}\n\n\t// 2. Generate clipboard results for non-file things\n\t//\n\t// Getting the source from the items is async, however they must be accessed syncronously;\n\t// we can't await them in a loop. So we'll map them to promises and await them all at once,\n\t// then make decisions based on what we find.\n\n\tconst results = await Promise.all<TLExternalContentSource>(\n\t\tthings\n\t\t\t.filter((t) => t.type !== 'file')\n\t\t\t.map(\n\t\t\t\t(t) =>\n\t\t\t\t\tnew Promise((r) => {\n\t\t\t\t\t\tconst thing = t as Exclude<ClipboardThing, { type: 'file' } | { type: 'blob' }>\n\n\t\t\t\t\t\tif (thing.type === 'file') {\n\t\t\t\t\t\t\tr({ type: 'error', data: null, reason: 'unexpected file' })\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthing.source.then((text) => {\n\t\t\t\t\t\t\t// first, see if we can find tldraw content, which is JSON inside of an html comment\n\t\t\t\t\t\t\tconst tldrawHtmlComment = text.match(/<tldraw[^>]*>(.*)<\\/tldraw>/)?.[1]\n\n\t\t\t\t\t\t\tif (tldrawHtmlComment) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t// If we've found tldraw content in the html string, use that as JSON\n\t\t\t\t\t\t\t\t\tconst jsonComment = decompressFromBase64(tldrawHtmlComment)\n\t\t\t\t\t\t\t\t\tif (jsonComment === null) {\n\t\t\t\t\t\t\t\t\t\tr({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\t\t\t\tdata: jsonComment,\n\t\t\t\t\t\t\t\t\t\t\treason: `found tldraw data comment but could not parse base64`,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconst json = JSON.parse(jsonComment)\n\t\t\t\t\t\t\t\t\t\tif (json.type !== 'application/tldraw') {\n\t\t\t\t\t\t\t\t\t\t\tr({\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\t\t\t\t\tdata: json,\n\t\t\t\t\t\t\t\t\t\t\t\treason: `found tldraw data comment but JSON was of a different type: ${json.type}`,\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (typeof json.data === 'string') {\n\t\t\t\t\t\t\t\t\t\t\tr({\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\t\t\t\t\tdata: json,\n\t\t\t\t\t\t\t\t\t\t\t\treason:\n\t\t\t\t\t\t\t\t\t\t\t\t\t'found tldraw json but data was a string instead of a TLClipboardModel object',\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tr({ type: 'tldraw', data: json.data })\n\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (e: any) {\n\t\t\t\t\t\t\t\t\tr({\n\t\t\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\t\t\tdata: tldrawHtmlComment,\n\t\t\t\t\t\t\t\t\t\treason:\n\t\t\t\t\t\t\t\t\t\t\t'found tldraw json but data was a string instead of a TLClipboardModel object',\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (thing.type === 'html') {\n\t\t\t\t\t\t\t\t\tr({ type: 'text', data: text, subtype: 'html' })\n\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (thing.type === 'url') {\n\t\t\t\t\t\t\t\t\tr({ type: 'text', data: text, subtype: 'url' })\n\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// if we have not found a tldraw comment, Otherwise, try to parse the text as JSON directly.\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst json = JSON.parse(text)\n\t\t\t\t\t\t\t\t\tif (json.type === 'excalidraw/clipboard') {\n\t\t\t\t\t\t\t\t\t\t// If the clipboard contains content copied from excalidraw, then paste that\n\t\t\t\t\t\t\t\t\t\tr({ type: 'excalidraw', data: json })\n\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tr({ type: 'text', data: text, subtype: 'json' })\n\t\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t// If we could not parse the text as JSON, then it's just text\n\t\t\t\t\t\t\t\t\tr({ type: 'text', data: text, subtype: 'text' })\n\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tr({ type: 'error', data: text, reason: 'unhandled case' })\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t)\n\t)\n\n\t// 3.\n\t//\n\t// Now that we know what kind of stuff we're dealing with, we can actual create some content.\n\t// There are priorities here, so order matters: we've already handled images and files, which\n\t// take first priority; then we want to handle tldraw content, then excalidraw content, then\n\t// html content, then links, and finally text content.\n\n\t// Try to paste tldraw content\n\tfor (const result of results) {\n\t\tif (result.type === 'tldraw') {\n\t\t\tpasteTldrawContent(editor, result.data, point)\n\t\t\treturn\n\t\t}\n\t}\n\n\t// Try to paste excalidraw content\n\tfor (const result of results) {\n\t\tif (result.type === 'excalidraw') {\n\t\t\tpasteExcalidrawContent(editor, result.data, point)\n\t\t\treturn\n\t\t}\n\t}\n\n\t// Try to paste html content\n\tfor (const result of results) {\n\t\tif (result.type === 'text' && result.subtype === 'html') {\n\t\t\t// try to find a link\n\t\t\tconst rootNode = new DOMParser().parseFromString(result.data, 'text/html')\n\t\t\tconst bodyNode = rootNode.querySelector('body')\n\n\t\t\t// Edge on Windows 11 home appears to paste a link as a single <a/> in\n\t\t\t// the HTML document. If we're pasting a single like tag we'll just\n\t\t\t// assume the user meant to paste the URL.\n\t\t\tconst isHtmlSingleLink =\n\t\t\t\tbodyNode &&\n\t\t\t\tArray.from(bodyNode.children).filter((el) => el.nodeType === 1).length === 1 &&\n\t\t\t\tbodyNode.firstElementChild &&\n\t\t\t\tbodyNode.firstElementChild.tagName === 'A' &&\n\t\t\t\tbodyNode.firstElementChild.hasAttribute('href') &&\n\t\t\t\tbodyNode.firstElementChild.getAttribute('href') !== ''\n\n\t\t\tif (isHtmlSingleLink) {\n\t\t\t\tconst href = bodyNode.firstElementChild.getAttribute('href')!\n\t\t\t\thandleText(editor, href, point, results)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// If the html is NOT a link, and we have NO OTHER texty content, then paste the html as text\n\t\t\tif (!results.some((r) => r.type === 'text' && r.subtype !== 'html') && result.data.trim()) {\n\t\t\t\thandleText(editor, stripHtml(result.data), point, results)\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n\n\t// Try to paste a link\n\tfor (const result of results) {\n\t\tif (result.type === 'text' && result.subtype === 'url') {\n\t\t\tpasteUrl(editor, result.data, point, results)\n\t\t\treturn\n\t\t}\n\t}\n\n\t// Finally, if we haven't bailed on anything yet, we can paste text content\n\tfor (const result of results) {\n\t\tif (result.type === 'text' && result.subtype === 'text' && result.data.trim()) {\n\t\t\t// The clipboard may include multiple text items, but we only want to paste the first one\n\t\t\thandleText(editor, result.data, point, results)\n\t\t\treturn\n\t\t}\n\t}\n}\n\n/**\n * When the user copies, write the contents to local storage and to the clipboard\n *\n * @param editor - The editor instance.\n * @public\n */\nconst handleNativeOrMenuCopy = (editor: Editor) => {\n\tconst content = editor.getContentFromCurrentPage(editor.getSelectedShapeIds())\n\tif (!content) {\n\t\tif (navigator && navigator.clipboard) {\n\t\t\tnavigator.clipboard.writeText('')\n\t\t}\n\t\treturn\n\t}\n\n\tconst stringifiedClipboard = compressToBase64(\n\t\tJSON.stringify({\n\t\t\ttype: 'application/tldraw',\n\t\t\tkind: 'content',\n\t\t\tdata: content,\n\t\t})\n\t)\n\n\tif (typeof navigator === 'undefined') {\n\t\treturn\n\t} else {\n\t\t// Extract the text from the clipboard\n\t\tconst textItems = content.shapes\n\t\t\t.map((shape) => {\n\t\t\t\tif (\n\t\t\t\t\teditor.isShapeOfType<TLTextShape>(shape, 'text') ||\n\t\t\t\t\teditor.isShapeOfType<TLGeoShape>(shape, 'geo') ||\n\t\t\t\t\teditor.isShapeOfType<TLArrowShape>(shape, 'arrow')\n\t\t\t\t) {\n\t\t\t\t\treturn shape.props.text\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\teditor.isShapeOfType<TLBookmarkShape>(shape, 'bookmark') ||\n\t\t\t\t\teditor.isShapeOfType<TLEmbedShape>(shape, 'embed')\n\t\t\t\t) {\n\t\t\t\t\treturn shape.props.url\n\t\t\t\t}\n\t\t\t\treturn null\n\t\t\t})\n\t\t\t.filter(isNonNull)\n\n\t\tif (navigator.clipboard?.write) {\n\t\t\tconst htmlBlob = new Blob([`<tldraw>${stringifiedClipboard}</tldraw>`], {\n\t\t\t\ttype: 'text/html',\n\t\t\t})\n\n\t\t\tlet textContent = textItems.join(' ')\n\n\t\t\t// This is a bug in chrome android where it won't paste content if\n\t\t\t// the text/plain content is \"\" so we need to always add an empty\n\t\t\t// space \uD83E\uDD2C\n\t\t\tif (textContent === '') {\n\t\t\t\ttextContent = ' '\n\t\t\t}\n\n\t\t\tnavigator.clipboard.write([\n\t\t\t\tnew ClipboardItem({\n\t\t\t\t\t'text/html': htmlBlob,\n\t\t\t\t\t// What is this second blob used for?\n\t\t\t\t\t'text/plain': new Blob([textContent], { type: 'text/plain' }),\n\t\t\t\t}),\n\t\t\t])\n\t\t} else if (navigator.clipboard.writeText) {\n\t\t\tnavigator.clipboard.writeText(`<tldraw>${stringifiedClipboard}</tldraw>`)\n\t\t}\n\t}\n}\n\n/** @public */\nexport function useMenuClipboardEvents() {\n\tconst editor = useEditor()\n\tconst trackEvent = useUiEvents()\n\n\tconst copy = useCallback(\n\t\tfunction onCopy(source: TLUiEventSource) {\n\t\t\tif (editor.getSelectedShapeIds().length === 0) return\n\n\t\t\thandleNativeOrMenuCopy(editor)\n\t\t\ttrackEvent('copy', { source })\n\t\t},\n\t\t[editor, trackEvent]\n\t)\n\n\tconst cut = useCallback(\n\t\tfunction onCut(source: TLUiEventSource) {\n\t\t\tif (editor.getSelectedShapeIds().length === 0) return\n\n\t\t\thandleNativeOrMenuCopy(editor)\n\t\t\teditor.deleteShapes(editor.getSelectedShapeIds())\n\t\t\ttrackEvent('cut', { source })\n\t\t},\n\t\t[editor, trackEvent]\n\t)\n\n\tconst paste = useCallback(\n\t\tasync function onPaste(\n\t\t\tdata: DataTransfer | ClipboardItem[],\n\t\t\tsource: TLUiEventSource,\n\t\t\tpoint?: VecLike\n\t\t) {\n\t\t\t// If we're editing a shape, or we are focusing an editable input, then\n\t\t\t// we would want the user's paste interaction to go to that element or\n\t\t\t// input instead; e.g. when pasting text into a text shape's content\n\t\t\tif (editor.getEditingShapeId() !== null || disallowClipboardEvents(editor)) return\n\n\t\t\tif (Array.isArray(data) && data[0] instanceof ClipboardItem) {\n\t\t\t\thandlePasteFromClipboardApi(editor, data, point)\n\t\t\t\ttrackEvent('paste', { source: 'menu' })\n\t\t\t} else {\n\t\t\t\t// Read it first and then recurse, kind of weird\n\t\t\t\tnavigator.clipboard.read().then((clipboardItems) => {\n\t\t\t\t\tpaste(clipboardItems, source, point)\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t[editor, trackEvent]\n\t)\n\n\treturn {\n\t\tcopy,\n\t\tcut,\n\t\tpaste,\n\t}\n}\n\n/** @public */\nexport function useNativeClipboardEvents() {\n\tconst editor = useEditor()\n\tconst trackEvent = useUiEvents()\n\n\tconst appIsFocused = useValue('editor.isFocused', () => editor.getInstanceState().isFocused, [\n\t\teditor,\n\t])\n\n\tuseEffect(() => {\n\t\tif (!appIsFocused) return\n\t\tconst copy = (e: ClipboardEvent) => {\n\t\t\tif (\n\t\t\t\teditor.getSelectedShapeIds().length === 0 ||\n\t\t\t\teditor.getEditingShapeId() !== null ||\n\t\t\t\tdisallowClipboardEvents(editor)\n\t\t\t) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tpreventDefault(e)\n\t\t\thandleNativeOrMenuCopy(editor)\n\t\t\ttrackEvent('copy', { source: 'kbd' })\n\t\t}\n\n\t\tfunction cut(e: ClipboardEvent) {\n\t\t\tif (\n\t\t\t\teditor.getSelectedShapeIds().length === 0 ||\n\t\t\t\teditor.getEditingShapeId() !== null ||\n\t\t\t\tdisallowClipboardEvents(editor)\n\t\t\t) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tpreventDefault(e)\n\t\t\thandleNativeOrMenuCopy(editor)\n\t\t\teditor.deleteShapes(editor.getSelectedShapeIds())\n\t\t\ttrackEvent('cut', { source: 'kbd' })\n\t\t}\n\n\t\tlet disablingMiddleClickPaste = false\n\t\tconst pointerUpHandler = (e: PointerEvent) => {\n\t\t\tif (e.button === 1) {\n\t\t\t\tdisablingMiddleClickPaste = true\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tdisablingMiddleClickPaste = false\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tconst paste = (e: ClipboardEvent) => {\n\t\t\tif (disablingMiddleClickPaste) {\n\t\t\t\tstopEventPropagation(e)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// If we're editing a shape, or we are focusing an editable input, then\n\t\t\t// we would want the user's paste interaction to go to that element or\n\t\t\t// input instead; e.g. when pasting text into a text shape's content\n\t\t\tif (editor.getEditingShapeId() !== null || disallowClipboardEvents(editor)) return\n\n\t\t\t// First try to use the clipboard data on the event\n\t\t\tif (e.clipboardData && !editor.inputs.shiftKey) {\n\t\t\t\thandlePasteFromEventClipboardData(editor, e.clipboardData)\n\t\t\t} else {\n\t\t\t\t// Or else use the clipboard API\n\t\t\t\tnavigator.clipboard.read().then((clipboardItems) => {\n\t\t\t\t\tif (Array.isArray(clipboardItems) && clipboardItems[0] instanceof ClipboardItem) {\n\t\t\t\t\t\thandlePasteFromClipboardApi(editor, clipboardItems, editor.inputs.currentPagePoint)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tpreventDefault(e)\n\t\t\ttrackEvent('paste', { source: 'kbd' })\n\t\t}\n\n\t\tdocument.addEventListener('copy', copy)\n\t\tdocument.addEventListener('cut', cut)\n\t\tdocument.addEventListener('paste', paste)\n\t\tdocument.addEventListener('pointerup', pointerUpHandler)\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('copy', copy)\n\t\t\tdocument.removeEventListener('cut', cut)\n\t\t\tdocument.removeEventListener('paste', paste)\n\t\t\tdocument.removeEventListener('pointerup', pointerUpHandler)\n\t\t}\n\t}, [editor, trackEvent, appIsFocused])\n}\n", "import {\n\tAssetRecordType,\n\tBox,\n\tEditor,\n\tTLArrowShapeArrowheadStyle,\n\tTLAssetId,\n\tTLContent,\n\tTLDefaultColorStyle,\n\tTLDefaultDashStyle,\n\tTLDefaultFillStyle,\n\tTLDefaultFontStyle,\n\tTLDefaultHorizontalAlignStyle,\n\tTLDefaultSizeStyle,\n\tTLOpacityType,\n\tTLShapeId,\n\tVec,\n\tVecLike,\n\tZERO_INDEX_KEY,\n\tcompact,\n\tcreateShapeId,\n\tgetIndexAbove,\n\tgetIndices,\n\tisShapeId,\n\tuniqueId,\n} from '@tldraw/editor'\n\n/**\n * When the clipboard has excalidraw content, paste it into the scene.\n *\n * @param editor - The editor instance.\n * @param clipboard - The clipboard model.\n * @param point - The point at which to paste the text.\n * @internal\n */\nexport async function pasteExcalidrawContent(editor: Editor, clipboard: any, point?: VecLike) {\n\tconst { elements, files } = clipboard\n\n\tconst tldrawContent: TLContent = {\n\t\tshapes: [],\n\t\trootShapeIds: [],\n\t\tassets: [],\n\t\tschema: editor.store.schema.serialize(),\n\t}\n\n\tconst groupShapeIdToChildren = new Map<string, TLShapeId[]>()\n\tconst rotatedElements = new Map<TLShapeId, number>()\n\n\tconst currentPageId = editor.getCurrentPageId()\n\n\tconst excElementIdsToTldrawShapeIds = new Map<string, TLShapeId>()\n\tconst rootShapeIds: TLShapeId[] = []\n\n\tconst skipIds = new Set<string>()\n\n\telements.forEach((element: any) => {\n\t\texcElementIdsToTldrawShapeIds.set(element.id, createShapeId())\n\n\t\tif (element.boundElements !== null) {\n\t\t\tfor (const boundElement of element.boundElements) {\n\t\t\t\tif (boundElement.type === 'text') {\n\t\t\t\t\tskipIds.add(boundElement.id)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n\n\tlet index = ZERO_INDEX_KEY\n\n\tfor (const element of elements) {\n\t\tif (skipIds.has(element.id)) {\n\t\t\tcontinue\n\t\t}\n\n\t\tconst id = excElementIdsToTldrawShapeIds.get(element.id)!\n\n\t\tconst base = {\n\t\t\tid,\n\t\t\ttypeName: 'shape',\n\t\t\tparentId: currentPageId,\n\t\t\tindex,\n\t\t\tx: element.x,\n\t\t\ty: element.y,\n\t\t\trotation: 0,\n\t\t\tisLocked: element.locked,\n\t\t\topacity: getOpacity(element.opacity),\n\t\t\tmeta: {},\n\t\t} as const\n\n\t\tif (element.angle !== 0) {\n\t\t\trotatedElements.set(id, element.angle)\n\t\t}\n\n\t\tif (element.groupIds && element.groupIds.length > 0) {\n\t\t\tif (groupShapeIdToChildren.has(element.groupIds[0])) {\n\t\t\t\tgroupShapeIdToChildren.get(element.groupIds[0])?.push(id)\n\t\t\t} else {\n\t\t\t\tgroupShapeIdToChildren.set(element.groupIds[0], [id])\n\t\t\t}\n\t\t} else {\n\t\t\trootShapeIds.push(id)\n\t\t}\n\n\t\tswitch (element.type) {\n\t\t\tcase 'rectangle':\n\t\t\tcase 'ellipse':\n\t\t\tcase 'diamond': {\n\t\t\t\tlet text = ''\n\t\t\t\tlet align: TLDefaultHorizontalAlignStyle = 'middle'\n\n\t\t\t\tif (element.boundElements !== null) {\n\t\t\t\t\tfor (const boundElement of element.boundElements) {\n\t\t\t\t\t\tif (boundElement.type === 'text') {\n\t\t\t\t\t\t\tconst labelElement = elements.find((elm: any) => elm.id === boundElement.id)\n\t\t\t\t\t\t\tif (labelElement) {\n\t\t\t\t\t\t\t\ttext = labelElement.text\n\t\t\t\t\t\t\t\talign = textAlignToAlignTypes[labelElement.textAlign]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst colorToUse =\n\t\t\t\t\telement.backgroundColor === 'transparent' ? element.strokeColor : element.backgroundColor\n\n\t\t\t\ttldrawContent.shapes.push({\n\t\t\t\t\t...base,\n\t\t\t\t\ttype: 'geo',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tgeo: element.type,\n\t\t\t\t\t\turl: element.link ?? '',\n\t\t\t\t\t\tw: element.width,\n\t\t\t\t\t\th: element.height,\n\t\t\t\t\t\tsize: strokeWidthsToSizes[element.strokeWidth] ?? 'draw',\n\t\t\t\t\t\tcolor: colorsToColors[colorToUse] ?? 'black',\n\t\t\t\t\t\ttext,\n\t\t\t\t\t\talign,\n\t\t\t\t\t\tdash: getDash(element),\n\t\t\t\t\t\tfill: getFill(element),\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'freedraw': {\n\t\t\t\ttldrawContent.shapes.push({\n\t\t\t\t\t...base,\n\t\t\t\t\ttype: 'draw',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tdash: getDash(element),\n\t\t\t\t\t\tsize: strokeWidthsToSizes[element.strokeWidth],\n\t\t\t\t\t\tcolor: colorsToColors[element.strokeColor] ?? 'black',\n\t\t\t\t\t\tsegments: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'free',\n\t\t\t\t\t\t\t\tpoints: element.points.map(([x, y, z = 0.5]: number[]) => ({\n\t\t\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\t\t\ty,\n\t\t\t\t\t\t\t\t\tz,\n\t\t\t\t\t\t\t\t})),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'line': {\n\t\t\t\tconst start = element.points[0]\n\t\t\t\tconst end = element.points[element.points.length - 1]\n\t\t\t\tconst indices = getIndices(element.points.length)\n\n\t\t\t\ttldrawContent.shapes.push({\n\t\t\t\t\t...base,\n\t\t\t\t\ttype: 'line',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tdash: getDash(element),\n\t\t\t\t\t\tsize: strokeWidthsToSizes[element.strokeWidth],\n\t\t\t\t\t\tcolor: colorsToColors[element.strokeColor] ?? 'black',\n\t\t\t\t\t\tspline: element.roundness ? 'cubic' : 'line',\n\t\t\t\t\t\thandles: {\n\t\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\t\tid: 'start',\n\t\t\t\t\t\t\t\ttype: 'vertex',\n\t\t\t\t\t\t\t\tindex: indices[0],\n\t\t\t\t\t\t\t\tx: start[0],\n\t\t\t\t\t\t\t\ty: start[1],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\tid: 'end',\n\t\t\t\t\t\t\t\ttype: 'vertex',\n\t\t\t\t\t\t\t\tindex: indices[indices.length - 1],\n\t\t\t\t\t\t\t\tx: end[0],\n\t\t\t\t\t\t\t\ty: end[1],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t...Object.fromEntries(\n\t\t\t\t\t\t\t\telement.points.slice(1, -1).map(([x, y]: number[], i: number) => {\n\t\t\t\t\t\t\t\t\tconst id = uniqueId()\n\t\t\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\t\t\ttype: 'vertex',\n\t\t\t\t\t\t\t\t\t\t\tindex: indices[i + 1],\n\t\t\t\t\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\t\t\t\t\ty,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'arrow': {\n\t\t\t\tlet text = ''\n\n\t\t\t\tif (element.boundElements !== null) {\n\t\t\t\t\tfor (const boundElement of element.boundElements) {\n\t\t\t\t\t\tif (boundElement.type === 'text') {\n\t\t\t\t\t\t\tconst labelElement = elements.find((elm: any) => elm.id === boundElement.id)\n\t\t\t\t\t\t\tif (labelElement) {\n\t\t\t\t\t\t\t\ttext = labelElement.text\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst start = element.points[0]\n\t\t\t\tconst end = element.points[element.points.length - 1]\n\n\t\t\t\tconst startTargetId = excElementIdsToTldrawShapeIds.get(element.startBinding?.elementId)\n\t\t\t\tconst endTargetId = excElementIdsToTldrawShapeIds.get(element.endBinding?.elementId)\n\n\t\t\t\ttldrawContent.shapes.push({\n\t\t\t\t\t...base,\n\t\t\t\t\ttype: 'arrow',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttext,\n\t\t\t\t\t\tbend: getBend(element, start, end),\n\t\t\t\t\t\tdash: getDash(element),\n\t\t\t\t\t\tsize: strokeWidthsToSizes[element.strokeWidth] ?? 'm',\n\t\t\t\t\t\tcolor: colorsToColors[element.strokeColor] ?? 'black',\n\t\t\t\t\t\tstart: startTargetId\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\ttype: 'binding',\n\t\t\t\t\t\t\t\t\tboundShapeId: startTargetId,\n\t\t\t\t\t\t\t\t\tnormalizedAnchor: { x: 0.5, y: 0.5 },\n\t\t\t\t\t\t\t\t\tisPrecise: false,\n\t\t\t\t\t\t\t\t\tisExact: false,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\t\tx: start[0],\n\t\t\t\t\t\t\t\t\ty: start[1],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\tend: endTargetId\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\ttype: 'binding',\n\t\t\t\t\t\t\t\t\tboundShapeId: endTargetId,\n\t\t\t\t\t\t\t\t\tnormalizedAnchor: { x: 0.5, y: 0.5 },\n\t\t\t\t\t\t\t\t\tisPrecise: false,\n\t\t\t\t\t\t\t\t\tisExact: false,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\t\tx: end[0],\n\t\t\t\t\t\t\t\t\ty: end[1],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\tarrowheadEnd: arrowheadsToArrowheadTypes[element.endArrowhead] ?? 'none',\n\t\t\t\t\t\tarrowheadStart: arrowheadsToArrowheadTypes[element.startArrowhead] ?? 'none',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'text': {\n\t\t\t\tconst { size, scale } = getFontSizeAndScale(element.fontSize)\n\n\t\t\t\ttldrawContent.shapes.push({\n\t\t\t\t\t...base,\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tsize,\n\t\t\t\t\t\tscale,\n\t\t\t\t\t\tfont: fontFamilyToFontType[element.fontFamily] ?? 'draw',\n\t\t\t\t\t\tcolor: colorsToColors[element.strokeColor] ?? 'black',\n\t\t\t\t\t\ttext: element.text,\n\t\t\t\t\t\talign: textAlignToAlignTypes[element.textAlign],\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcase 'image': {\n\t\t\t\tconst file = files[element.fileId]\n\t\t\t\tif (!file) break\n\n\t\t\t\tconst assetId: TLAssetId = AssetRecordType.createId()\n\t\t\t\ttldrawContent.assets.push({\n\t\t\t\t\tid: assetId,\n\t\t\t\t\ttypeName: 'asset',\n\t\t\t\t\ttype: 'image',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tw: element.width,\n\t\t\t\t\t\th: element.height,\n\t\t\t\t\t\tname: element.id ?? 'Untitled',\n\t\t\t\t\t\tisAnimated: false,\n\t\t\t\t\t\tmimeType: file.mimeType,\n\t\t\t\t\t\tsrc: file.dataURL,\n\t\t\t\t\t},\n\t\t\t\t\tmeta: {},\n\t\t\t\t})\n\n\t\t\t\ttldrawContent.shapes.push({\n\t\t\t\t\t...base,\n\t\t\t\t\ttype: 'image',\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tw: element.width,\n\t\t\t\t\t\th: element.height,\n\t\t\t\t\t\tassetId,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tindex = getIndexAbove(index)\n\t}\n\n\tconst p = point ?? (editor.inputs.shiftKey ? editor.inputs.currentPagePoint : undefined)\n\n\teditor.mark('paste')\n\n\teditor.putContentOntoCurrentPage(tldrawContent, {\n\t\tpoint: p,\n\t\tselect: false,\n\t\tpreserveIds: true,\n\t})\n\tfor (const groupedShapeIds of groupShapeIdToChildren.values()) {\n\t\tif (groupedShapeIds.length > 1) {\n\t\t\teditor.groupShapes(groupedShapeIds)\n\t\t\tconst groupShape = editor.getShape(groupedShapeIds[0])\n\t\t\tif (groupShape?.parentId && isShapeId(groupShape.parentId)) {\n\t\t\t\trootShapeIds.push(groupShape.parentId)\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const [id, angle] of rotatedElements) {\n\t\teditor.select(id)\n\t\teditor.rotateShapesBy([id], angle)\n\t}\n\n\tconst rootShapes = compact(rootShapeIds.map((id) => editor.getShape(id)))\n\tconst bounds = Box.Common(rootShapes.map((s) => editor.getShapePageBounds(s)!))\n\tconst viewPortCenter = editor.getViewportPageBounds().center\n\teditor.updateShapes(\n\t\trootShapes.map((s) => {\n\t\t\tconst delta = {\n\t\t\t\tx: (s.x ?? 0) - (bounds.x + bounds.w / 2),\n\t\t\t\ty: (s.y ?? 0) - (bounds.y + bounds.h / 2),\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: s.id,\n\t\t\t\ttype: s.type,\n\t\t\t\tx: viewPortCenter.x + delta.x,\n\t\t\t\ty: viewPortCenter.y + delta.y,\n\t\t\t}\n\t\t})\n\t)\n\teditor.setSelectedShapes(rootShapeIds)\n}\n\n/* --------------- Translating Helpers --------_------ */\n\nconst getOpacity = (opacity: number): TLOpacityType => {\n\tconst t = opacity / 100\n\tif (t < 0.2) {\n\t\treturn 0.1\n\t} else if (t < 0.4) {\n\t\treturn 0.25\n\t} else if (t < 0.6) {\n\t\treturn 0.5\n\t} else if (t < 0.8) {\n\t\treturn 0.75\n\t}\n\n\treturn 1\n}\n\nconst strokeWidthsToSizes: Record<number, TLDefaultSizeStyle> = {\n\t1: 's',\n\t2: 'm',\n\t3: 'l',\n\t4: 'xl',\n}\n\nconst fontSizesToSizes: Record<number, TLDefaultSizeStyle> = {\n\t16: 's',\n\t20: 'm',\n\t28: 'l',\n\t36: 'xl',\n}\n\nfunction getFontSizeAndScale(fontSize: number): { size: TLDefaultSizeStyle; scale: number } {\n\tconst size = fontSizesToSizes[fontSize]\n\tif (size) {\n\t\treturn { size, scale: 1 }\n\t}\n\tif (fontSize < 16) {\n\t\treturn { size: 's', scale: fontSize / 16 }\n\t}\n\tif (fontSize > 36) {\n\t\treturn { size: 'xl', scale: fontSize / 36 }\n\t}\n\treturn { size: 'm', scale: 1 }\n}\n\nconst fontFamilyToFontType: Record<number, TLDefaultFontStyle> = {\n\t1: 'draw',\n\t2: 'sans',\n\t3: 'mono',\n}\n\nconst colorsToColors: Record<string, TLDefaultColorStyle> = {\n\t'#ffffff': 'grey',\n\t// Strokes\n\t'#000000': 'black',\n\t'#343a40': 'black',\n\t'#495057': 'grey',\n\t'#c92a2a': 'red',\n\t'#a61e4d': 'light-red',\n\t'#862e9c': 'violet',\n\t'#5f3dc4': 'light-violet',\n\t'#364fc7': 'blue',\n\t'#1864ab': 'light-blue',\n\t'#0b7285': 'light-green',\n\t'#087f5b': 'light-green',\n\t'#2b8a3e': 'green',\n\t'#5c940d': 'light-green',\n\t'#e67700': 'yellow',\n\t'#d9480f': 'orange',\n\t// Backgrounds\n\t'#ced4da': 'grey',\n\t'#868e96': 'grey',\n\t'#fa5252': 'light-red',\n\t'#e64980': 'red',\n\t'#be4bdb': 'light-violet',\n\t'#7950f2': 'violet',\n\t'#4c6ef5': 'blue',\n\t'#228be6': 'light-blue',\n\t'#15aabf': 'light-green',\n\t'#12b886': 'green',\n\t'#40c057': 'green',\n\t'#82c91e': 'light-green',\n\t'#fab005': 'yellow',\n\t'#fd7e14': 'orange',\n\t'#212529': 'grey',\n}\n\nconst strokeStylesToStrokeTypes: Record<string, TLDefaultDashStyle> = {\n\tsolid: 'draw',\n\tdashed: 'dashed',\n\tdotted: 'dotted',\n}\n\nconst fillStylesToFillType: Record<string, TLDefaultFillStyle> = {\n\t'cross-hatch': 'pattern',\n\thachure: 'pattern',\n\tsolid: 'solid',\n}\n\nconst textAlignToAlignTypes: Record<string, TLDefaultHorizontalAlignStyle> = {\n\tleft: 'start',\n\tcenter: 'middle',\n\tright: 'end',\n}\n\nconst arrowheadsToArrowheadTypes: Record<string, TLArrowShapeArrowheadStyle> = {\n\tarrow: 'arrow',\n\tdot: 'dot',\n\ttriangle: 'triangle',\n\tbar: 'pipe',\n}\n\nfunction getBend(element: any, startPoint: any, endPoint: any) {\n\tlet bend = 0\n\tif (element.points.length > 2) {\n\t\tconst start = new Vec(startPoint[0], startPoint[1])\n\t\tconst end = new Vec(endPoint[0], endPoint[1])\n\t\tconst handle = new Vec(element.points[1][0], element.points[1][1])\n\t\tconst delta = Vec.Sub(end, start)\n\t\tconst v = Vec.Per(delta)\n\n\t\tconst med = Vec.Med(end, start)\n\t\tconst A = Vec.Sub(med, v)\n\t\tconst B = Vec.Add(med, v)\n\n\t\tconst point = Vec.NearestPointOnLineSegment(A, B, handle, false)\n\t\tbend = Vec.Dist(point, med)\n\t\tif (Vec.Clockwise(point, end, med)) bend *= -1\n\t}\n\treturn bend\n}\n\nconst getDash = (element: any): TLDefaultDashStyle => {\n\tlet dash: TLDefaultDashStyle = strokeStylesToStrokeTypes[element.strokeStyle] ?? 'draw'\n\tif (dash === 'draw' && element.roughness === 0) {\n\t\tdash = 'solid'\n\t}\n\treturn dash\n}\n\nconst getFill = (element: any): TLDefaultFillStyle => {\n\tif (element.backgroundColor === 'transparent') {\n\t\treturn 'none'\n\t}\n\treturn fillStylesToFillType[element.fillStyle] ?? 'solid'\n}\n", "import { Editor, TLExternalContentSource, VecLike } from '@tldraw/editor'\n\n/**\n * When the clipboard has a file, create an image shape from the file and paste it into the scene\n *\n * @param editor - The editor instance.\n * @param urls - The file urls.\n * @param point - The point at which to paste the file.\n * @internal\n */\nexport async function pasteFiles(\n\teditor: Editor,\n\turls: string[],\n\tpoint?: VecLike,\n\tsources?: TLExternalContentSource[]\n) {\n\tconst blobs = await Promise.all(urls.map(async (url) => await (await fetch(url)).blob()))\n\tconst files = blobs.map((blob) => new File([blob], 'tldrawFile', { type: blob.type }))\n\n\teditor.mark('paste')\n\n\tawait editor.putExternalContent({\n\t\ttype: 'files',\n\t\tfiles,\n\t\tpoint,\n\t\tignoreParent: false,\n\t\tsources,\n\t})\n\n\turls.forEach((url) => URL.revokeObjectURL(url))\n}\n", "import { Editor, TLContent, VecLike } from '@tldraw/editor'\n\n/**\n * When the clipboard has tldraw content, paste it into the scene.\n *\n * @param editor - The editor instance.\n * @param clipboard - The clipboard model.\n * @param point - The point at which to paste the text.\n * @internal\n */\nexport function pasteTldrawContent(editor: Editor, clipboard: TLContent, point?: VecLike) {\n\tconst p = point ?? (editor.inputs.shiftKey ? editor.inputs.currentPagePoint : undefined)\n\n\tconst seletionBoundsBefore = editor.getSelectionPageBounds()\n\teditor.mark('paste')\n\teditor.putContentOntoCurrentPage(clipboard, {\n\t\tpoint: p,\n\t\tselect: true,\n\t})\n\tconst selectedBoundsAfter = editor.getSelectionPageBounds()\n\tif (\n\t\tseletionBoundsBefore &&\n\t\tselectedBoundsAfter &&\n\t\tseletionBoundsBefore?.collides(selectedBoundsAfter)\n\t) {\n\t\t// Creates a 'puff' to show a paste has happened.\n\t\teditor.updateInstanceState({ isChangingStyle: true }, { ephemeral: true })\n\t\tsetTimeout(() => {\n\t\t\teditor.updateInstanceState({ isChangingStyle: false }, { ephemeral: true })\n\t\t}, 150)\n\t}\n}\n", "import { Editor, TLExternalContentSource, VecLike } from '@tldraw/editor'\nimport { pasteFiles } from './pasteFiles'\n\n/**\n * When the clipboard has plain text that is a valid URL, create a bookmark shape and insert it into\n * the scene\n *\n * @param editor - The editor instance.\n * @param url - The URL to paste.\n * @param point - The point at which to paste the file.\n * @internal\n */\nexport async function pasteUrl(\n\teditor: Editor,\n\turl: string,\n\tpoint?: VecLike,\n\tsources?: TLExternalContentSource[]\n) {\n\t// Lets see if its an image and we have CORs\n\ttry {\n\t\t// skip this step if the url doesn't contain an image extension, treat it as a regular bookmark\n\t\tif (new URL(url).pathname.match(/\\.(png|jpe?g|gif|svg|webp)$/i)) {\n\t\t\tconst resp = await fetch(url, { method: 'HEAD' })\n\t\t\tif (resp.headers.get('content-type')?.match(/^image\\//)) {\n\t\t\t\teditor.mark('paste')\n\t\t\t\tpasteFiles(editor, [url])\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t} catch (err: any) {\n\t\tif (err.message !== 'Failed to fetch') {\n\t\t\tconsole.error(err)\n\t\t}\n\t}\n\n\teditor.mark('paste')\n\n\treturn await editor.putExternalContent({\n\t\ttype: 'url',\n\t\tpoint,\n\t\turl,\n\t\tsources,\n\t})\n}\n", "import { TLShapeId, useEditor } from '@tldraw/editor'\nimport { useCallback } from 'react'\nimport { TLCopyType, copyAs } from '../../utils/export/copyAs'\nimport { useToasts } from '../context/toasts'\nimport { useTranslation } from './useTranslation/useTranslation'\n\n/** @public */\nexport function useCopyAs() {\n\tconst editor = useEditor()\n\tconst { addToast } = useToasts()\n\tconst msg = useTranslation()\n\n\treturn useCallback(\n\t\t(ids: TLShapeId[], format: TLCopyType = 'svg') => {\n\t\t\tcopyAs(editor, ids, format).catch(() => {\n\t\t\t\taddToast({\n\t\t\t\t\tid: 'copy-fail',\n\t\t\t\t\tseverity: 'warning',\n\t\t\t\t\ttitle: msg('toast.error.copy-fail.title'),\n\t\t\t\t\tdescription: msg('toast.error.copy-fail.desc'),\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\t\t[editor, addToast, msg]\n\t)\n}\n", "import {\n\tEditor,\n\tPngHelpers,\n\tTLShapeId,\n\tTLSvgOptions,\n\tdebugFlags,\n\texhaustiveSwitchError,\n} from '@tldraw/editor'\nimport { clampToBrowserMaxCanvasSize } from '../../shapes/shared/getBrowserCanvasMaxSize'\n\n/** @public */\nexport async function getSvgAsImage(\n\tsvgString: string,\n\tisSafari: boolean,\n\toptions: {\n\t\ttype: 'png' | 'jpeg' | 'webp'\n\t\tquality: number\n\t\tscale: number\n\t\twidth: number\n\t\theight: number\n\t}\n) {\n\tconst { type, quality, scale, width, height } = options\n\n\tlet [clampedWidth, clampedHeight] = await clampToBrowserMaxCanvasSize(\n\t\twidth * scale,\n\t\theight * scale\n\t)\n\tclampedWidth = Math.floor(clampedWidth)\n\tclampedHeight = Math.floor(clampedHeight)\n\tconst effectiveScale = clampedWidth / width\n\n\tconst svgUrl = URL.createObjectURL(new Blob([svgString], { type: 'image/svg+xml' }))\n\n\tconst canvas = await new Promise<HTMLCanvasElement | null>((resolve) => {\n\t\tconst image = new Image()\n\t\timage.crossOrigin = 'anonymous'\n\n\t\timage.onload = async () => {\n\t\t\t// safari will fire `onLoad` before the fonts in the SVG are\n\t\t\t// actually loaded. just waiting around a while is brittle, but\n\t\t\t// there doesn't seem to be any better solution for now :( see\n\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=219770\n\t\t\tif (isSafari) {\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 250))\n\t\t\t}\n\n\t\t\tconst canvas = document.createElement('canvas') as HTMLCanvasElement\n\t\t\tconst ctx = canvas.getContext('2d')!\n\n\t\t\tcanvas.width = clampedWidth\n\t\t\tcanvas.height = clampedHeight\n\n\t\t\tctx.imageSmoothingEnabled = true\n\t\t\tctx.imageSmoothingQuality = 'high'\n\t\t\tctx.drawImage(image, 0, 0, clampedWidth, clampedHeight)\n\n\t\t\tURL.revokeObjectURL(svgUrl)\n\n\t\t\tresolve(canvas)\n\t\t}\n\n\t\timage.onerror = () => {\n\t\t\tresolve(null)\n\t\t}\n\n\t\timage.src = svgUrl\n\t})\n\n\tif (!canvas) return null\n\n\tconst blob = await new Promise<Blob | null>((resolve) =>\n\t\tcanvas.toBlob(\n\t\t\t(blob) => {\n\t\t\t\tif (!blob || debugFlags.throwToBlob.get()) {\n\t\t\t\t\tresolve(null)\n\t\t\t\t}\n\t\t\t\tresolve(blob)\n\t\t\t},\n\t\t\t'image/' + type,\n\t\t\tquality\n\t\t)\n\t)\n\n\tif (!blob) return null\n\n\tif (type === 'png') {\n\t\tconst view = new DataView(await blob.arrayBuffer())\n\t\treturn PngHelpers.setPhysChunk(view, effectiveScale, {\n\t\t\ttype: 'image/' + type,\n\t\t})\n\t} else {\n\t\treturn blob\n\t}\n}\n\nasync function getSvgString(editor: Editor, ids: TLShapeId[], opts: Partial<TLSvgOptions>) {\n\tconst svg = await editor.getSvgString(ids?.length ? ids : [...editor.getCurrentPageShapeIds()], {\n\t\tscale: 1,\n\t\tbackground: editor.getInstanceState().exportBackground,\n\t\t...opts,\n\t})\n\tif (!svg) {\n\t\tthrow new Error('Could not construct SVG.')\n\t}\n\treturn svg\n}\n\nexport async function exportToString(\n\teditor: Editor,\n\tids: TLShapeId[],\n\tformat: 'svg' | 'json',\n\topts = {} as Partial<TLSvgOptions>\n) {\n\tswitch (format) {\n\t\tcase 'svg': {\n\t\t\treturn (await getSvgString(editor, ids, opts))?.svg\n\t\t}\n\t\tcase 'json': {\n\t\t\tconst data = editor.getContentFromCurrentPage(ids)\n\t\t\treturn JSON.stringify(data)\n\t\t}\n\t\tdefault: {\n\t\t\texhaustiveSwitchError(format)\n\t\t}\n\t}\n}\n\n/**\n * Export the given shapes as a blob.\n * @param editor - The editor instance.\n * @param ids - The ids of the shapes to export.\n * @param format - The format to export as.\n * @param opts - Rendering options.\n * @returns A promise that resolves to a blob.\n * @public\n */\nexport async function exportToBlob({\n\teditor,\n\tids,\n\tformat,\n\topts = {} as Partial<TLSvgOptions>,\n}: {\n\teditor: Editor\n\tids: TLShapeId[]\n\tformat: 'svg' | 'png' | 'jpeg' | 'webp' | 'json'\n\topts?: Partial<TLSvgOptions>\n}): Promise<Blob> {\n\tswitch (format) {\n\t\tcase 'svg':\n\t\t\treturn new Blob([await exportToString(editor, ids, 'svg', opts)], { type: 'text/plain' })\n\t\tcase 'json':\n\t\t\treturn new Blob([await exportToString(editor, ids, 'json', opts)], { type: 'text/plain' })\n\t\tcase 'jpeg':\n\t\tcase 'png':\n\t\tcase 'webp': {\n\t\t\tconst svgResult = await getSvgString(editor, ids, opts)\n\t\t\tif (!svgResult) throw new Error('Could not construct image.')\n\t\t\tconst image = await getSvgAsImage(svgResult.svg, editor.environment.isSafari, {\n\t\t\t\ttype: format,\n\t\t\t\tquality: 1,\n\t\t\t\tscale: 2,\n\t\t\t\twidth: svgResult.width,\n\t\t\t\theight: svgResult.height,\n\t\t\t})\n\t\t\tif (!image) {\n\t\t\t\tthrow new Error('Could not construct image.')\n\t\t\t}\n\t\t\treturn image\n\t\t}\n\t\tdefault: {\n\t\t\texhaustiveSwitchError(format)\n\t\t}\n\t}\n}\n\nconst mimeTypeByFormat = {\n\tjpeg: 'image/jpeg',\n\tpng: 'image/png',\n\twebp: 'image/webp',\n\tjson: 'text/plain',\n\tsvg: 'text/plain',\n}\n\nexport function exportToBlobPromise(\n\teditor: Editor,\n\tids: TLShapeId[],\n\tformat: 'svg' | 'png' | 'jpeg' | 'webp' | 'json',\n\topts = {} as Partial<TLSvgOptions>\n): { blobPromise: Promise<Blob>; mimeType: string } {\n\treturn {\n\t\tblobPromise: exportToBlob({ editor, ids, format, opts }),\n\t\tmimeType: mimeTypeByFormat[format],\n\t}\n}\n", "import { Editor, TLShapeId, TLSvgOptions, exhaustiveSwitchError } from '@tldraw/editor'\nimport { exportToBlobPromise, exportToString } from './export'\n\n/** @public */\nexport type TLCopyType = 'svg' | 'png' | 'jpeg' | 'json'\n\n/**\n * Copy the given shapes to the clipboard.\n *\n * @param editor - The editor instance.\n * @param ids - The ids of the shapes to copy.\n * @param format - The format to copy as.\n * @param opts - Options for the copy.\n *\n * @public\n */\nexport function copyAs(\n\teditor: Editor,\n\tids: TLShapeId[],\n\tformat: TLCopyType = 'svg',\n\topts = {} as Partial<TLSvgOptions>\n): Promise<void> {\n\t// Note:  it's important that this function itself isn't async and doesn't really use promises -\n\t// we need to create the relevant `ClipboardItem`s and call window.navigator.clipboard.write\n\t// synchronously to make sure safari knows that the user _wants_ to copy See\n\t// https://bugs.webkit.org/show_bug.cgi?id=222262\n\n\tif (!window.navigator.clipboard) return Promise.reject(new Error('Copy not supported'))\n\tif (window.navigator.clipboard.write) {\n\t\tconst { blobPromise, mimeType } = exportToBlobPromise(editor, ids, format, opts)\n\n\t\treturn window.navigator.clipboard\n\t\t\t.write([new ClipboardItem({ [mimeType]: blobPromise })])\n\t\t\t.catch((err) => {\n\t\t\t\t// Firefox will fail with the above if `dom.events.asyncClipboard.clipboardItem` is enabled.\n\t\t\t\t// See <https://github.com/tldraw/tldraw/issues/1325>\n\t\t\t\tconsole.error(err)\n\t\t\t\treturn blobPromise.then((blob) => {\n\t\t\t\t\treturn window.navigator.clipboard.write([new ClipboardItem({ [mimeType]: blob })])\n\t\t\t\t})\n\t\t\t})\n\t}\n\n\tswitch (format) {\n\t\tcase 'json':\n\t\tcase 'svg':\n\t\t\treturn fallbackWriteTextAsync(async () => exportToString(editor, ids, format, opts))\n\n\t\tcase 'jpeg':\n\t\tcase 'png':\n\t\t\tthrow new Error('Copy not supported')\n\t\tdefault:\n\t\t\texhaustiveSwitchError(format)\n\t}\n}\n\nasync function fallbackWriteTextAsync(getText: () => Promise<string>) {\n\tawait navigator.clipboard?.writeText?.(await getText())\n}\n", "import { TLShapeId, useEditor } from '@tldraw/editor'\nimport { useCallback } from 'react'\nimport { TLExportType, exportAs } from '../../utils/export/exportAs'\nimport { useToasts } from '../context/toasts'\nimport { useTranslation } from './useTranslation/useTranslation'\n\n/** @public */\nexport function useExportAs() {\n\tconst editor = useEditor()\n\tconst { addToast } = useToasts()\n\tconst msg = useTranslation()\n\n\treturn useCallback(\n\t\t(ids: TLShapeId[], format: TLExportType = 'png', name: string | undefined) => {\n\t\t\texportAs(editor, ids, format, name, {\n\t\t\t\tscale: 1,\n\t\t\t\tbackground: editor.getInstanceState().exportBackground,\n\t\t\t}).catch((e) => {\n\t\t\t\tconsole.error(e.message)\n\t\t\t\taddToast({\n\t\t\t\t\tid: 'export-fail',\n\t\t\t\t\ttitle: msg('toast.error.export-fail.title'),\n\t\t\t\t\tdescription: msg('toast.error.export-fail.desc'),\n\t\t\t\t\tseverity: 'error',\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\t\t[editor, addToast, msg]\n\t)\n}\n", "import { Editor, TLFrameShape, TLShapeId, TLSvgOptions } from '@tldraw/editor'\nimport { exportToBlob } from './export'\n\n/** @public */\nexport type TLExportType = 'svg' | 'png' | 'jpeg' | 'webp' | 'json'\n\n/**\n * Export the given shapes as files.\n *\n * @param editor - The editor instance.\n * @param ids - The ids of the shapes to export.\n * @param format - The format to export as.\n * @param name - Name of the exported file. If undefined a predefined name, based on the selection, will be used.\n * @param opts - Options for the export.\n *\n * @public\n */\nexport async function exportAs(\n\teditor: Editor,\n\tids: TLShapeId[],\n\tformat: TLExportType = 'png',\n\tname: string | undefined,\n\topts = {} as Partial<TLSvgOptions>\n) {\n\t// If we don't get name then use a predefined one\n\tif (!name) {\n\t\tname = `shapes at ${getTimestamp()}`\n\t\tif (ids.length === 1) {\n\t\t\tconst first = editor.getShape(ids[0])!\n\t\t\tif (editor.isShapeOfType<TLFrameShape>(first, 'frame')) {\n\t\t\t\tname = first.props.name ?? 'frame'\n\t\t\t} else {\n\t\t\t\tname = `${first.id.replace(/:/, '_')} at ${getTimestamp()}`\n\t\t\t}\n\t\t}\n\t}\n\tname += `.${format}`\n\n\tconst blob = await exportToBlob({ editor, ids, format, opts })\n\tconst file = new File([blob], name, { type: blob.type })\n\tdownloadFile(file)\n}\n\nfunction getTimestamp() {\n\tconst now = new Date()\n\n\tconst year = String(now.getFullYear()).slice(2)\n\tconst month = String(now.getMonth() + 1).padStart(2, '0')\n\tconst day = String(now.getDate()).padStart(2, '0')\n\tconst hours = String(now.getHours()).padStart(2, '0')\n\tconst minutes = String(now.getMinutes()).padStart(2, '0')\n\tconst seconds = String(now.getSeconds()).padStart(2, '0')\n\n\treturn `${year}-${month}-${day} ${hours}.${minutes}.${seconds}`\n}\n\nfunction downloadFile(file: File) {\n\tconst link = document.createElement('a')\n\tconst url = URL.createObjectURL(file)\n\tlink.href = url\n\tlink.download = file.name\n\tlink.click()\n\tURL.revokeObjectURL(url)\n}\n", "import { uniqueId, useEditor } from '@tldraw/editor'\nimport { useCallback, useRef } from 'react'\n\n/** @internal */\nexport function usePrint() {\n\tconst editor = useEditor()\n\tconst prevPrintEl = useRef<HTMLDivElement | null>(null)\n\tconst prevStyleEl = useRef<HTMLStyleElement | null>(null)\n\n\treturn useCallback(\n\t\tasync function printSelectionOrPages() {\n\t\t\tconst el = document.createElement('div')\n\t\t\tconst style = document.createElement('style')\n\n\t\t\t// todo: why are these using a ref? this seems like it could be a function rather than a hook\n\t\t\tconst clearElements = (printEl: HTMLDivElement | null, styleEl: HTMLStyleElement | null) => {\n\t\t\t\tif (printEl) printEl.innerHTML = ''\n\t\t\t\tif (styleEl && document.head.contains(styleEl)) document.head.removeChild(styleEl)\n\t\t\t\tif (printEl && document.body.contains(printEl)) {\n\t\t\t\t\tdocument.body.removeChild(printEl)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Always make sure we have a clean root element.\n\t\t\tclearElements(prevPrintEl.current, prevStyleEl.current)\n\t\t\tprevPrintEl.current = el\n\t\t\tprevStyleEl.current = style\n\n\t\t\t// Random because this isn't for end users\n\t\t\tconst className = `tl-print-surface-${uniqueId()}`\n\n\t\t\tel.className = className\n\t\t\t// NOTE: Works in most envs except safari, needs further review\n\t\t\tconst enableMargins = false\n\t\t\t// NOTE: Currently buggy needs further investigation\n\t\t\tconst allowAllPages = false\n\t\t\tstyle.innerHTML = `\n\t\t\t.${className} {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\t.${className} svg {\n\t\t\t\tmax-width: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\n\t\t\t@media print {\t\t\t\t  \n\t\t\t\thtml, body {\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\n\t\t\t\tbody {\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\n\t\t\t\tbody > * {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.tldraw__editor {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.${className} {\n\t\t\t\t\tdisplay: block !important;\n\t\t\t\t\tbackground: white;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmax-width: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item {\n\t\t\t\t\tpadding: 10mm;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tpage-break-after: always;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item__main {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tmax-height: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item__header {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item__footer {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item__footer__hide {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t${\n\t\t\t\t\t!enableMargins\n\t\t\t\t\t\t? ''\n\t\t\t\t\t\t: `\n\t\t\t\t\t/**\n\t\t\t\t\t * Note: Safari doesn't support removing the page margins to remove them all!\n\t\t\t\t\t */\n\t\t\t\t\t@page {\n\t\t\t\t\t\tmargin:0;\n\t\t\t\t\t}\n\n\t\t\t\t\t.${className} .${className}__item__header {\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t}\n\n\t\t\t\t\t.${className} .${className}__item__footer {\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t}\n\t\t\t\t`\n\t\t\t\t}\n\t\t\t}\n\n\t\t`\n\n\t\t\tconst beforePrintHandler = () => {\n\t\t\t\tdocument.head.appendChild(style)\n\t\t\t\tdocument.body.appendChild(el)\n\t\t\t}\n\n\t\t\tconst afterPrintHandler = () => {\n\t\t\t\teditor.once('change-history', () => {\n\t\t\t\t\tclearElements(el, style)\n\t\t\t\t})\n\t\t\t}\n\n\t\t\twindow.addEventListener('beforeprint', beforePrintHandler)\n\t\t\twindow.addEventListener('afterprint', afterPrintHandler)\n\n\t\t\tfunction addPageToPrint(title: string, footer: string | null, svg: string) {\n\t\t\t\ttry {\n\t\t\t\t\tel.innerHTML += `<div class=\"${className}__item\">\n        <div class=\"${className}__item__header\">\n          ${title.replace(/</g, '&lt;').replace(/>/g, '&gt;')}\n        </div>\n        <div class=\"${className}__item__main\">\n          ${svg}\n        </div>\n        <div class=\"${className}__item__footer ${className}__item__footer__${footer ? '' : 'hide'}\">\n          ${footer ?? ''}\n        </div>\n      </div>`\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction triggerPrint() {\n\t\t\t\tif (editor.environment.isChromeForIos) {\n\t\t\t\t\tbeforePrintHandler()\n\t\t\t\t\twindow.print()\n\t\t\t\t} else if (editor.environment.isSafari) {\n\t\t\t\t\tbeforePrintHandler()\n\t\t\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\t\t\tdocument.execCommand('print', false)\n\t\t\t\t} else {\n\t\t\t\t\twindow.print()\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\tconst currentPageId = editor.getCurrentPageId()\n\t\t\tconst pages = editor.getPages()\n\n\t\t\tconst preserveAspectRatio = 'xMidYMid meet'\n\n\t\t\tconst svgOpts = {\n\t\t\t\tscale: 1,\n\t\t\t\tbackground: false,\n\t\t\t\tdarkMode: false,\n\t\t\t\tpreserveAspectRatio,\n\t\t\t}\n\n\t\t\tif (editor.getSelectedShapeIds().length > 0) {\n\t\t\t\t// Print the selected ids from the current page\n\t\t\t\tconst svgExport = await editor.getSvgString(selectedShapeIds, svgOpts)\n\n\t\t\t\tif (svgExport) {\n\t\t\t\t\tconst page = pages.find((p) => p.id === currentPageId)\n\t\t\t\t\taddPageToPrint(`tldraw \u2014 ${page?.name}`, null, svgExport.svg)\n\t\t\t\t\ttriggerPrint()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (allowAllPages) {\n\t\t\t\t\t// Print all pages\n\t\t\t\t\tfor (let i = 0; i < pages.length; i++) {\n\t\t\t\t\t\tconst page = pages[i]\n\t\t\t\t\t\tconst svgExport = await editor.getSvgString(\n\t\t\t\t\t\t\teditor.getSortedChildIdsForParent(page.id),\n\t\t\t\t\t\t\tsvgOpts\n\t\t\t\t\t\t)\n\t\t\t\t\t\tif (svgExport) {\n\t\t\t\t\t\t\taddPageToPrint(`tldraw \u2014 ${page.name}`, `${i}/${pages.length}`, svgExport.svg)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ttriggerPrint()\n\t\t\t\t} else {\n\t\t\t\t\tconst page = editor.getCurrentPage()\n\t\t\t\t\tconst svgExport = await editor.getSvgString(\n\t\t\t\t\t\teditor.getSortedChildIdsForParent(page.id),\n\t\t\t\t\t\tsvgOpts\n\t\t\t\t\t)\n\t\t\t\t\tif (svgExport) {\n\t\t\t\t\t\taddPageToPrint(`tldraw \u2014 ${page.name}`, null, svgExport.svg)\n\t\t\t\t\t\ttriggerPrint()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twindow.removeEventListener('beforeprint', beforePrintHandler)\n\t\t\twindow.removeEventListener('afterprint', afterPrintHandler)\n\t\t},\n\t\t[editor]\n\t)\n}\n", "import { useShallowObjectIdentity } from '@tldraw/editor'\nimport { ComponentType, ReactNode, createContext, useContext, useMemo } from 'react'\nimport {\n\tDefaultActionsMenu,\n\tTLUiActionsMenuProps,\n} from '../components/ActionsMenu/DefaultActionsMenu'\nimport {\n\tDefaultContextMenu,\n\tTLUiContextMenuProps,\n} from '../components/ContextMenu/DefaultContextMenu'\nimport { DefaultDebugMenu } from '../components/DebugMenu/DefaultDebugMenu'\nimport { DefaultDebugPanel } from '../components/DefaultDebugPanel'\nimport { DefaultHelpMenu, TLUiHelpMenuProps } from '../components/HelpMenu/DefaultHelpMenu'\nimport {\n\tDefaultHelperButtons,\n\tTLUiHelperButtonsProps,\n} from '../components/HelperButtons/DefaultHelperButtons'\nimport {\n\tDefaultKeyboardShortcutsDialog,\n\tTLUiKeyboardShortcutsDialogProps,\n} from '../components/KeyboardShortcutsDialog/DefaultKeyboardShortcutsDialog'\nimport { DefaultMainMenu, TLUiMainMenuProps } from '../components/MainMenu/DefaultMainMenu'\nimport { DefaultMenuPanel } from '../components/MenuPanel'\nimport { DefaultMinimap } from '../components/Minimap/DefaultMinimap'\nimport { DefaultNavigationPanel } from '../components/NavigationPanel/DefaultNavigationPanel'\nimport { DefaultPageMenu } from '../components/PageMenu/DefaultPageMenu'\nimport {\n\tDefaultQuickActions,\n\tTLUiQuickActionsProps,\n} from '../components/QuickActions/DefaultQuickActions'\nimport { DefaultStylePanel, TLUiStylePanelProps } from '../components/StylePanel/DefaultStylePanel'\nimport { DefaultToolbar } from '../components/Toolbar/DefaultToolbar'\nimport { DefaultZoomMenu, TLUiZoomMenuProps } from '../components/ZoomMenu/DefaultZoomMenu'\n\nexport interface BaseTLUiComponents {\n\tContextMenu: ComponentType<TLUiContextMenuProps>\n\tActionsMenu: ComponentType<TLUiActionsMenuProps>\n\tHelpMenu: ComponentType<TLUiHelpMenuProps>\n\tZoomMenu: ComponentType<TLUiZoomMenuProps>\n\tMainMenu: ComponentType<TLUiMainMenuProps>\n\tMinimap: ComponentType\n\tStylePanel: ComponentType<TLUiStylePanelProps>\n\tPageMenu: ComponentType\n\tNavigationPanel: ComponentType\n\tToolbar: ComponentType\n\tKeyboardShortcutsDialog: ComponentType<TLUiKeyboardShortcutsDialogProps>\n\tQuickActions: ComponentType<TLUiQuickActionsProps>\n\tHelperButtons: ComponentType<TLUiHelperButtonsProps>\n\tDebugPanel: ComponentType\n\tDebugMenu: ComponentType\n\tMenuPanel: ComponentType\n\tTopPanel: ComponentType\n\tSharePanel: ComponentType\n}\n\n/** @public */\nexport type TLUiComponents = Partial<{\n\t[K in keyof BaseTLUiComponents]: BaseTLUiComponents[K] | null\n}>\n\nconst TldrawUiComponentsContext = createContext({} as TLUiComponents)\n\n/** @public */\nexport type TLUiComponentsProviderProps = {\n\toverrides?: TLUiComponents\n\tchildren: ReactNode\n}\n\n/** @public */\nexport function TldrawUiComponentsProvider({\n\toverrides = {},\n\tchildren,\n}: TLUiComponentsProviderProps) {\n\tconst _overrides = useShallowObjectIdentity(overrides)\n\n\treturn (\n\t\t<TldrawUiComponentsContext.Provider\n\t\t\tvalue={useMemo(\n\t\t\t\t() => ({\n\t\t\t\t\tContextMenu: DefaultContextMenu,\n\t\t\t\t\tActionsMenu: DefaultActionsMenu,\n\t\t\t\t\tHelpMenu: DefaultHelpMenu,\n\t\t\t\t\tZoomMenu: DefaultZoomMenu,\n\t\t\t\t\tMainMenu: DefaultMainMenu,\n\t\t\t\t\tMinimap: DefaultMinimap,\n\t\t\t\t\tStylePanel: DefaultStylePanel,\n\t\t\t\t\tPageMenu: DefaultPageMenu,\n\t\t\t\t\tNavigationPanel: DefaultNavigationPanel,\n\t\t\t\t\tToolbar: DefaultToolbar,\n\t\t\t\t\tKeyboardShortcutsDialog: DefaultKeyboardShortcutsDialog,\n\t\t\t\t\tQuickActions: DefaultQuickActions,\n\t\t\t\t\tHelperButtons: DefaultHelperButtons,\n\t\t\t\t\tDebugPanel: DefaultDebugPanel,\n\t\t\t\t\tDebugMenu: DefaultDebugMenu,\n\t\t\t\t\tMenuPanel: DefaultMenuPanel,\n\t\t\t\t\t..._overrides,\n\t\t\t\t}),\n\t\t\t\t[_overrides]\n\t\t\t)}\n\t\t>\n\t\t\t{children}\n\t\t</TldrawUiComponentsContext.Provider>\n\t)\n}\n\n/** @public */\nexport function useTldrawUiComponents() {\n\treturn useContext(TldrawUiComponentsContext)\n}\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport { ReactNode, memo } from 'react'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { useReadonly } from '../../hooks/useReadonly'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport {\n\tTldrawUiPopover,\n\tTldrawUiPopoverContent,\n\tTldrawUiPopoverTrigger,\n} from '../primitives/TldrawUiPopover'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultActionsMenuContent } from './DefaultActionsMenuContent'\n\n/** @public */\nexport type TLUiActionsMenuProps = {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport const DefaultActionsMenu = memo(function DefaultActionsMenu({\n\tchildren,\n}: TLUiActionsMenuProps) {\n\tconst msg = useTranslation()\n\tconst breakpoint = useBreakpoint()\n\n\tconst isReadonlyMode = useReadonly()\n\n\tconst editor = useEditor()\n\tconst isInAcceptableReadonlyState = useValue(\n\t\t'should display quick actions when in readonly',\n\t\t() => editor.isInAny('hand', 'zoom'),\n\t\t[editor]\n\t)\n\n\t// Get the actions menu content, either the default component or the user's\n\t// override. If there's no menu content, then the user has set it to null,\n\t// so skip rendering the menu.\n\n\tconst content = children ?? <DefaultActionsMenuContent />\n\tif (isReadonlyMode && !isInAcceptableReadonlyState) return\n\n\treturn (\n\t\t<TldrawUiPopover id=\"actions-menu\">\n\t\t\t<TldrawUiPopoverTrigger>\n\t\t\t\t<TldrawUiButton\n\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\tdata-testid=\"actions-menu.button\"\n\t\t\t\t\ttitle={msg('actions-menu.title')}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiButtonIcon icon=\"dots-vertical\" small />\n\t\t\t\t</TldrawUiButton>\n\t\t\t</TldrawUiPopoverTrigger>\n\t\t\t<TldrawUiPopoverContent\n\t\t\t\tside={breakpoint >= PORTRAIT_BREAKPOINT.TABLET ? 'bottom' : 'top'}\n\t\t\t\tsideOffset={6}\n\t\t\t>\n\t\t\t\t<div className=\"tlui-actions-menu tlui-buttons__grid\" data-testid=\"actions-menu.content\">\n\t\t\t\t\t<TldrawUiMenuContextProvider type=\"icons\" sourceId=\"actions-menu\">\n\t\t\t\t\t\t{content}\n\t\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t\t</div>\n\t\t\t</TldrawUiPopoverContent>\n\t\t</TldrawUiPopover>\n\t)\n})\n", "import * as PopoverPrimitive from '@radix-ui/react-popover'\nimport { useContainer } from '@tldraw/editor'\nimport React from 'react'\nimport { useMenuIsOpen } from '../../hooks/useMenuIsOpen'\n\n/** @public */\nexport type TLUiPopoverProps = {\n\tid: string\n\topen?: boolean\n\tchildren: React.ReactNode\n\tonOpenChange?: (isOpen: boolean) => void\n}\n\n/** @public */\nexport function TldrawUiPopover({ id, children, onOpenChange, open }: TLUiPopoverProps) {\n\tconst [isOpen, handleOpenChange] = useMenuIsOpen(id, onOpenChange)\n\n\treturn (\n\t\t<PopoverPrimitive.Root\n\t\t\tonOpenChange={handleOpenChange}\n\t\t\topen={open || isOpen /* allow debugging */}\n\t\t>\n\t\t\t<div className=\"tlui-popover\">{children}</div>\n\t\t</PopoverPrimitive.Root>\n\t)\n}\n\n/** @public */\nexport interface TLUiPopoverTriggerProps {\n\tchildren?: React.ReactNode\n}\n\n/** @public */\nexport function TldrawUiPopoverTrigger({ children }: TLUiPopoverTriggerProps) {\n\treturn (\n\t\t<PopoverPrimitive.Trigger asChild dir=\"ltr\">\n\t\t\t{children}\n\t\t</PopoverPrimitive.Trigger>\n\t)\n}\n\n/** @public */\nexport type TLUiPopoverContentProps = {\n\tchildren: React.ReactNode\n\tside: 'top' | 'bottom' | 'left' | 'right'\n\talign?: 'start' | 'center' | 'end'\n\talignOffset?: number\n\tsideOffset?: number\n}\n\n/** @public */\nexport function TldrawUiPopoverContent({\n\tside,\n\tchildren,\n\talign = 'center',\n\tsideOffset = 8,\n\talignOffset = 0,\n}: TLUiPopoverContentProps) {\n\tconst container = useContainer()\n\treturn (\n\t\t<PopoverPrimitive.Portal container={container}>\n\t\t\t<PopoverPrimitive.Content\n\t\t\t\tclassName=\"tlui-popover__content\"\n\t\t\t\tside={side}\n\t\t\t\tsideOffset={sideOffset}\n\t\t\t\talign={align}\n\t\t\t\talignOffset={alignOffset}\n\t\t\t\tdir=\"ltr\"\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t\t{/* <StyledArrow /> */}\n\t\t\t</PopoverPrimitive.Content>\n\t\t</PopoverPrimitive.Portal>\n\t)\n}\n", "import { arrow as arrow$1, computePosition } from '@floating-ui/dom';\nexport { autoPlacement, autoUpdate, computePosition, detectOverflow, flip, getOverflowAncestors, hide, inline, limitShift, offset, platform, shift, size } from '@floating-ui/dom';\nimport * as React from 'react';\nimport { useLayoutEffect, useEffect } from 'react';\nimport * as ReactDOM from 'react-dom';\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * This wraps the core `arrow` middleware to allow React refs as the element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = options => {\n  function isRef(value) {\n    return {}.hasOwnProperty.call(value, 'current');\n  }\n  return {\n    name: 'arrow',\n    options,\n    fn(state) {\n      const {\n        element,\n        padding\n      } = typeof options === 'function' ? options(state) : options;\n      if (element && isRef(element)) {\n        if (element.current != null) {\n          return arrow$1({\n            element: element.current,\n            padding\n          }).fn(state);\n        }\n        return {};\n      }\n      if (element) {\n        return arrow$1({\n          element,\n          padding\n        }).fn(state);\n      }\n      return {};\n    }\n  };\n};\n\nvar index = typeof document !== 'undefined' ? useLayoutEffect : useEffect;\n\n// Fork of `fast-deep-equal` that only does the comparisons we need and compares\n// functions\nfunction deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (typeof a === 'function' && a.toString() === b.toString()) {\n    return true;\n  }\n  let length;\n  let i;\n  let keys;\n  if (a && b && typeof a === 'object') {\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length !== b.length) return false;\n      for (i = length; i-- !== 0;) {\n        if (!deepEqual(a[i], b[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) {\n      return false;\n    }\n    for (i = length; i-- !== 0;) {\n      if (!{}.hasOwnProperty.call(b, keys[i])) {\n        return false;\n      }\n    }\n    for (i = length; i-- !== 0;) {\n      const key = keys[i];\n      if (key === '_owner' && a.$$typeof) {\n        continue;\n      }\n      if (!deepEqual(a[key], b[key])) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return a !== a && b !== b;\n}\n\nfunction getDPR(element) {\n  if (typeof window === 'undefined') {\n    return 1;\n  }\n  const win = element.ownerDocument.defaultView || window;\n  return win.devicePixelRatio || 1;\n}\n\nfunction roundByDPR(element, value) {\n  const dpr = getDPR(element);\n  return Math.round(value * dpr) / dpr;\n}\n\nfunction useLatestRef(value) {\n  const ref = React.useRef(value);\n  index(() => {\n    ref.current = value;\n  });\n  return ref;\n}\n\n/**\n * Provides data to position a floating element.\n * @see https://floating-ui.com/docs/useFloating\n */\nfunction useFloating(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  const {\n    placement = 'bottom',\n    strategy = 'absolute',\n    middleware = [],\n    platform,\n    elements: {\n      reference: externalReference,\n      floating: externalFloating\n    } = {},\n    transform = true,\n    whileElementsMounted,\n    open\n  } = options;\n  const [data, setData] = React.useState({\n    x: 0,\n    y: 0,\n    strategy,\n    placement,\n    middlewareData: {},\n    isPositioned: false\n  });\n  const [latestMiddleware, setLatestMiddleware] = React.useState(middleware);\n  if (!deepEqual(latestMiddleware, middleware)) {\n    setLatestMiddleware(middleware);\n  }\n  const [_reference, _setReference] = React.useState(null);\n  const [_floating, _setFloating] = React.useState(null);\n  const setReference = React.useCallback(node => {\n    if (node !== referenceRef.current) {\n      referenceRef.current = node;\n      _setReference(node);\n    }\n  }, []);\n  const setFloating = React.useCallback(node => {\n    if (node !== floatingRef.current) {\n      floatingRef.current = node;\n      _setFloating(node);\n    }\n  }, []);\n  const referenceEl = externalReference || _reference;\n  const floatingEl = externalFloating || _floating;\n  const referenceRef = React.useRef(null);\n  const floatingRef = React.useRef(null);\n  const dataRef = React.useRef(data);\n  const hasWhileElementsMounted = whileElementsMounted != null;\n  const whileElementsMountedRef = useLatestRef(whileElementsMounted);\n  const platformRef = useLatestRef(platform);\n  const update = React.useCallback(() => {\n    if (!referenceRef.current || !floatingRef.current) {\n      return;\n    }\n    const config = {\n      placement,\n      strategy,\n      middleware: latestMiddleware\n    };\n    if (platformRef.current) {\n      config.platform = platformRef.current;\n    }\n    computePosition(referenceRef.current, floatingRef.current, config).then(data => {\n      const fullData = {\n        ...data,\n        isPositioned: true\n      };\n      if (isMountedRef.current && !deepEqual(dataRef.current, fullData)) {\n        dataRef.current = fullData;\n        ReactDOM.flushSync(() => {\n          setData(fullData);\n        });\n      }\n    });\n  }, [latestMiddleware, placement, strategy, platformRef]);\n  index(() => {\n    if (open === false && dataRef.current.isPositioned) {\n      dataRef.current.isPositioned = false;\n      setData(data => ({\n        ...data,\n        isPositioned: false\n      }));\n    }\n  }, [open]);\n  const isMountedRef = React.useRef(false);\n  index(() => {\n    isMountedRef.current = true;\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n  index(() => {\n    if (referenceEl) referenceRef.current = referenceEl;\n    if (floatingEl) floatingRef.current = floatingEl;\n    if (referenceEl && floatingEl) {\n      if (whileElementsMountedRef.current) {\n        return whileElementsMountedRef.current(referenceEl, floatingEl, update);\n      }\n      update();\n    }\n  }, [referenceEl, floatingEl, update, whileElementsMountedRef, hasWhileElementsMounted]);\n  const refs = React.useMemo(() => ({\n    reference: referenceRef,\n    floating: floatingRef,\n    setReference,\n    setFloating\n  }), [setReference, setFloating]);\n  const elements = React.useMemo(() => ({\n    reference: referenceEl,\n    floating: floatingEl\n  }), [referenceEl, floatingEl]);\n  const floatingStyles = React.useMemo(() => {\n    const initialStyles = {\n      position: strategy,\n      left: 0,\n      top: 0\n    };\n    if (!elements.floating) {\n      return initialStyles;\n    }\n    const x = roundByDPR(elements.floating, data.x);\n    const y = roundByDPR(elements.floating, data.y);\n    if (transform) {\n      return {\n        ...initialStyles,\n        transform: \"translate(\" + x + \"px, \" + y + \"px)\",\n        ...(getDPR(elements.floating) >= 1.5 && {\n          willChange: 'transform'\n        })\n      };\n    }\n    return {\n      position: strategy,\n      left: x,\n      top: y\n    };\n  }, [strategy, transform, elements.floating, data.x, data.y]);\n  return React.useMemo(() => ({\n    ...data,\n    update,\n    refs,\n    elements,\n    floatingStyles\n  }), [data, update, refs, elements, floatingStyles]);\n}\n\nexport { arrow, useFloating };\n", "export {\n  Arrow,\n  //\n  Root,\n} from './Arrow';\nexport type { ArrowProps } from './Arrow';\n", "import * as React from 'react';\nimport { Primitive } from '@radix-ui/react-primitive';\n\nimport type * as Radix from '@radix-ui/react-primitive';\n\n/* -------------------------------------------------------------------------------------------------\n * Arrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst NAME = 'Arrow';\n\ntype ArrowElement = React.ElementRef<typeof Primitive.svg>;\ntype PrimitiveSvgProps = Radix.ComponentPropsWithoutRef<typeof Primitive.svg>;\ninterface ArrowProps extends PrimitiveSvgProps {}\n\nconst Arrow = React.forwardRef<ArrowElement, ArrowProps>((props, forwardedRef) => {\n  const { children, width = 10, height = 5, ...arrowProps } = props;\n  return (\n    <Primitive.svg\n      {...arrowProps}\n      ref={forwardedRef}\n      width={width}\n      height={height}\n      viewBox=\"0 0 30 10\"\n      preserveAspectRatio=\"none\"\n    >\n      {/* We use their children if they're slotting to replace the whole svg */}\n      {props.asChild ? children : <polygon points=\"0,0 30,0 15,10\" />}\n    </Primitive.svg>\n  );\n});\n\nArrow.displayName = NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = Arrow;\n\nexport {\n  Arrow,\n  //\n  Root,\n};\nexport type { ArrowProps };\n", "export { useSize } from './useSize';\n", "/// <reference types=\"resize-observer-browser\" />\n\nimport * as React from 'react';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\n\nfunction useSize(element: HTMLElement | null) {\n  const [size, setSize] = React.useState<{ width: number; height: number } | undefined>(undefined);\n\n  useLayoutEffect(() => {\n    if (element) {\n      // provide size as early as possible\n      setSize({ width: element.offsetWidth, height: element.offsetHeight });\n\n      const resizeObserver = new ResizeObserver((entries) => {\n        if (!Array.isArray(entries)) {\n          return;\n        }\n\n        // Since we only observe the one element, we don't need to loop over the\n        // array\n        if (!entries.length) {\n          return;\n        }\n\n        const entry = entries[0];\n        let width: number;\n        let height: number;\n\n        if ('borderBoxSize' in entry) {\n          const borderSizeEntry = entry['borderBoxSize'];\n          // iron out differences between browsers\n          const borderSize = Array.isArray(borderSizeEntry) ? borderSizeEntry[0] : borderSizeEntry;\n          width = borderSize['inlineSize'];\n          height = borderSize['blockSize'];\n        } else {\n          // for browsers that don't support `borderBoxSize`\n          // we calculate it ourselves to get the correct border box.\n          width = element.offsetWidth;\n          height = element.offsetHeight;\n        }\n\n        setSize({ width, height });\n      });\n\n      resizeObserver.observe(element, { box: 'border-box' });\n\n      return () => resizeObserver.unobserve(element);\n    } else {\n      // We only want to reset to `undefined` when the element becomes `null`,\n      // not if it changes to another element.\n      setSize(undefined);\n    }\n  }, [element]);\n\n  return size;\n}\n\nexport { useSize };\n", "export {\n  createPopperScope,\n  //\n  Popper,\n  PopperAnchor,\n  PopperContent,\n  PopperArrow,\n  //\n  Root,\n  Anchor,\n  Content,\n  Arrow,\n  //\n  SIDE_OPTIONS,\n  ALIGN_OPTIONS,\n} from './Popper';\nexport type {\n  PopperProps,\n  PopperAnchorProps,\n  PopperContentProps,\n  PopperArrowProps,\n} from './Popper';\n", "import * as React from 'react';\nimport {\n  useFloating,\n  autoUpdate,\n  offset,\n  shift,\n  limitShift,\n  hide,\n  arrow as floatingUIarrow,\n  flip,\n  size,\n} from '@floating-ui/react-dom';\nimport * as ArrowPrimitive from '@radix-ui/react-arrow';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useLayoutEffect } from '@radix-ui/react-use-layout-effect';\nimport { useSize } from '@radix-ui/react-use-size';\n\nimport type { Placement, Middleware } from '@floating-ui/react-dom';\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\nimport type { Measurable } from '@radix-ui/rect';\n\nconst SIDE_OPTIONS = ['top', 'right', 'bottom', 'left'] as const;\nconst ALIGN_OPTIONS = ['start', 'center', 'end'] as const;\n\ntype Side = typeof SIDE_OPTIONS[number];\ntype Align = typeof ALIGN_OPTIONS[number];\n\n/* -------------------------------------------------------------------------------------------------\n * Popper\n * -----------------------------------------------------------------------------------------------*/\n\nconst POPPER_NAME = 'Popper';\n\ntype ScopedProps<P> = P & { __scopePopper?: Scope };\nconst [createPopperContext, createPopperScope] = createContextScope(POPPER_NAME);\n\ntype PopperContextValue = {\n  anchor: Measurable | null;\n  onAnchorChange(anchor: Measurable | null): void;\n};\nconst [PopperProvider, usePopperContext] = createPopperContext<PopperContextValue>(POPPER_NAME);\n\ninterface PopperProps {\n  children?: React.ReactNode;\n}\nconst Popper: React.FC<PopperProps> = (props: ScopedProps<PopperProps>) => {\n  const { __scopePopper, children } = props;\n  const [anchor, setAnchor] = React.useState<Measurable | null>(null);\n  return (\n    <PopperProvider scope={__scopePopper} anchor={anchor} onAnchorChange={setAnchor}>\n      {children}\n    </PopperProvider>\n  );\n};\n\nPopper.displayName = POPPER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopperAnchor\n * -----------------------------------------------------------------------------------------------*/\n\nconst ANCHOR_NAME = 'PopperAnchor';\n\ntype PopperAnchorElement = React.ElementRef<typeof Primitive.div>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface PopperAnchorProps extends PrimitiveDivProps {\n  virtualRef?: React.RefObject<Measurable>;\n}\n\nconst PopperAnchor = React.forwardRef<PopperAnchorElement, PopperAnchorProps>(\n  (props: ScopedProps<PopperAnchorProps>, forwardedRef) => {\n    const { __scopePopper, virtualRef, ...anchorProps } = props;\n    const context = usePopperContext(ANCHOR_NAME, __scopePopper);\n    const ref = React.useRef<PopperAnchorElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n\n    React.useEffect(() => {\n      // Consumer can anchor the popper to something that isn't\n      // a DOM node e.g. pointer position, so we override the\n      // `anchorRef` with their virtual ref in this case.\n      context.onAnchorChange(virtualRef?.current || ref.current);\n    });\n\n    return virtualRef ? null : <Primitive.div {...anchorProps} ref={composedRefs} />;\n  }\n);\n\nPopperAnchor.displayName = ANCHOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopperContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'PopperContent';\n\ntype PopperContentContextValue = {\n  placedSide: Side;\n  onArrowChange(arrow: HTMLSpanElement | null): void;\n  arrowX?: number;\n  arrowY?: number;\n  shouldHideArrow: boolean;\n};\n\nconst [PopperContentProvider, useContentContext] =\n  createPopperContext<PopperContentContextValue>(CONTENT_NAME);\n\ntype Boundary = Element | null;\n\ntype PopperContentElement = React.ElementRef<typeof Primitive.div>;\ninterface PopperContentProps extends PrimitiveDivProps {\n  side?: Side;\n  sideOffset?: number;\n  align?: Align;\n  alignOffset?: number;\n  arrowPadding?: number;\n  avoidCollisions?: boolean;\n  collisionBoundary?: Boundary | Boundary[];\n  collisionPadding?: number | Partial<Record<Side, number>>;\n  sticky?: 'partial' | 'always';\n  hideWhenDetached?: boolean;\n  updatePositionStrategy?: 'optimized' | 'always';\n  onPlaced?: () => void;\n}\n\nconst PopperContent = React.forwardRef<PopperContentElement, PopperContentProps>(\n  (props: ScopedProps<PopperContentProps>, forwardedRef) => {\n    const {\n      __scopePopper,\n      side = 'bottom',\n      sideOffset = 0,\n      align = 'center',\n      alignOffset = 0,\n      arrowPadding = 0,\n      avoidCollisions = true,\n      collisionBoundary = [],\n      collisionPadding: collisionPaddingProp = 0,\n      sticky = 'partial',\n      hideWhenDetached = false,\n      updatePositionStrategy = 'optimized',\n      onPlaced,\n      ...contentProps\n    } = props;\n\n    const context = usePopperContext(CONTENT_NAME, __scopePopper);\n\n    const [content, setContent] = React.useState<HTMLDivElement | null>(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setContent(node));\n\n    const [arrow, setArrow] = React.useState<HTMLSpanElement | null>(null);\n    const arrowSize = useSize(arrow);\n    const arrowWidth = arrowSize?.width ?? 0;\n    const arrowHeight = arrowSize?.height ?? 0;\n\n    const desiredPlacement = (side + (align !== 'center' ? '-' + align : '')) as Placement;\n\n    const collisionPadding =\n      typeof collisionPaddingProp === 'number'\n        ? collisionPaddingProp\n        : { top: 0, right: 0, bottom: 0, left: 0, ...collisionPaddingProp };\n\n    const boundary = Array.isArray(collisionBoundary) ? collisionBoundary : [collisionBoundary];\n    const hasExplicitBoundaries = boundary.length > 0;\n\n    const detectOverflowOptions = {\n      padding: collisionPadding,\n      boundary: boundary.filter(isNotNull),\n      // with `strategy: 'fixed'`, this is the only way to get it to respect boundaries\n      altBoundary: hasExplicitBoundaries,\n    };\n\n    const { refs, floatingStyles, placement, isPositioned, middlewareData } = useFloating({\n      // default to `fixed` strategy so users don't have to pick and we also avoid focus scroll issues\n      strategy: 'fixed',\n      placement: desiredPlacement,\n      whileElementsMounted: (...args) => {\n        const cleanup = autoUpdate(...args, {\n          animationFrame: updatePositionStrategy === 'always',\n        });\n        return cleanup;\n      },\n      elements: {\n        reference: context.anchor,\n      },\n      middleware: [\n        offset({ mainAxis: sideOffset + arrowHeight, alignmentAxis: alignOffset }),\n        avoidCollisions &&\n          shift({\n            mainAxis: true,\n            crossAxis: false,\n            limiter: sticky === 'partial' ? limitShift() : undefined,\n            ...detectOverflowOptions,\n          }),\n        avoidCollisions && flip({ ...detectOverflowOptions }),\n        size({\n          ...detectOverflowOptions,\n          apply: ({ elements, rects, availableWidth, availableHeight }) => {\n            const { width: anchorWidth, height: anchorHeight } = rects.reference;\n            const contentStyle = elements.floating.style;\n            contentStyle.setProperty('--radix-popper-available-width', `${availableWidth}px`);\n            contentStyle.setProperty('--radix-popper-available-height', `${availableHeight}px`);\n            contentStyle.setProperty('--radix-popper-anchor-width', `${anchorWidth}px`);\n            contentStyle.setProperty('--radix-popper-anchor-height', `${anchorHeight}px`);\n          },\n        }),\n        arrow && floatingUIarrow({ element: arrow, padding: arrowPadding }),\n        transformOrigin({ arrowWidth, arrowHeight }),\n        hideWhenDetached && hide({ strategy: 'referenceHidden', ...detectOverflowOptions }),\n      ],\n    });\n\n    const [placedSide, placedAlign] = getSideAndAlignFromPlacement(placement);\n\n    const handlePlaced = useCallbackRef(onPlaced);\n    useLayoutEffect(() => {\n      if (isPositioned) {\n        handlePlaced?.();\n      }\n    }, [isPositioned, handlePlaced]);\n\n    const arrowX = middlewareData.arrow?.x;\n    const arrowY = middlewareData.arrow?.y;\n    const cannotCenterArrow = middlewareData.arrow?.centerOffset !== 0;\n\n    const [contentZIndex, setContentZIndex] = React.useState<string>();\n    useLayoutEffect(() => {\n      if (content) setContentZIndex(window.getComputedStyle(content).zIndex);\n    }, [content]);\n\n    return (\n      <div\n        ref={refs.setFloating}\n        data-radix-popper-content-wrapper=\"\"\n        style={{\n          ...floatingStyles,\n          transform: isPositioned ? floatingStyles.transform : 'translate(0, -200%)', // keep off the page when measuring\n          minWidth: 'max-content',\n          zIndex: contentZIndex,\n          ['--radix-popper-transform-origin' as any]: [\n            middlewareData.transformOrigin?.x,\n            middlewareData.transformOrigin?.y,\n          ].join(' '),\n        }}\n        // Floating UI interally calculates logical alignment based the `dir` attribute on\n        // the reference/floating node, we must add this attribute here to ensure\n        // this is calculated when portalled as well as inline.\n        dir={props.dir}\n      >\n        <PopperContentProvider\n          scope={__scopePopper}\n          placedSide={placedSide}\n          onArrowChange={setArrow}\n          arrowX={arrowX}\n          arrowY={arrowY}\n          shouldHideArrow={cannotCenterArrow}\n        >\n          <Primitive.div\n            data-side={placedSide}\n            data-align={placedAlign}\n            {...contentProps}\n            ref={composedRefs}\n            style={{\n              ...contentProps.style,\n              // if the PopperContent hasn't been placed yet (not all measurements done)\n              // we prevent animations so that users's animation don't kick in too early referring wrong sides\n              animation: !isPositioned ? 'none' : undefined,\n              // hide the content if using the hide middleware and should be hidden\n              opacity: middlewareData.hide?.referenceHidden ? 0 : undefined,\n            }}\n          />\n        </PopperContentProvider>\n      </div>\n    );\n  }\n);\n\nPopperContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopperArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'PopperArrow';\n\nconst OPPOSITE_SIDE: Record<Side, Side> = {\n  top: 'bottom',\n  right: 'left',\n  bottom: 'top',\n  left: 'right',\n};\n\ntype PopperArrowElement = React.ElementRef<typeof ArrowPrimitive.Root>;\ntype ArrowProps = Radix.ComponentPropsWithoutRef<typeof ArrowPrimitive.Root>;\ninterface PopperArrowProps extends ArrowProps {}\n\nconst PopperArrow = React.forwardRef<PopperArrowElement, PopperArrowProps>(function PopperArrow(\n  props: ScopedProps<PopperArrowProps>,\n  forwardedRef\n) {\n  const { __scopePopper, ...arrowProps } = props;\n  const contentContext = useContentContext(ARROW_NAME, __scopePopper);\n  const baseSide = OPPOSITE_SIDE[contentContext.placedSide];\n\n  return (\n    // we have to use an extra wrapper because `ResizeObserver` (used by `useSize`)\n    // doesn't report size as we'd expect on SVG elements.\n    // it reports their bounding box which is effectively the largest path inside the SVG.\n    <span\n      ref={contentContext.onArrowChange}\n      style={{\n        position: 'absolute',\n        left: contentContext.arrowX,\n        top: contentContext.arrowY,\n        [baseSide]: 0,\n        transformOrigin: {\n          top: '',\n          right: '0 0',\n          bottom: 'center 0',\n          left: '100% 0',\n        }[contentContext.placedSide],\n        transform: {\n          top: 'translateY(100%)',\n          right: 'translateY(50%) rotate(90deg) translateX(-50%)',\n          bottom: `rotate(180deg)`,\n          left: 'translateY(50%) rotate(-90deg) translateX(50%)',\n        }[contentContext.placedSide],\n        visibility: contentContext.shouldHideArrow ? 'hidden' : undefined,\n      }}\n    >\n      <ArrowPrimitive.Root\n        {...arrowProps}\n        ref={forwardedRef}\n        style={{\n          ...arrowProps.style,\n          // ensures the element can be measured correctly (mostly for if SVG)\n          display: 'block',\n        }}\n      />\n    </span>\n  );\n});\n\nPopperArrow.displayName = ARROW_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction isNotNull<T>(value: T | null): value is T {\n  return value !== null;\n}\n\nconst transformOrigin = (options: { arrowWidth: number; arrowHeight: number }): Middleware => ({\n  name: 'transformOrigin',\n  options,\n  fn(data) {\n    const { placement, rects, middlewareData } = data;\n\n    const cannotCenterArrow = middlewareData.arrow?.centerOffset !== 0;\n    const isArrowHidden = cannotCenterArrow;\n    const arrowWidth = isArrowHidden ? 0 : options.arrowWidth;\n    const arrowHeight = isArrowHidden ? 0 : options.arrowHeight;\n\n    const [placedSide, placedAlign] = getSideAndAlignFromPlacement(placement);\n    const noArrowAlign = { start: '0%', center: '50%', end: '100%' }[placedAlign];\n\n    const arrowXCenter = (middlewareData.arrow?.x ?? 0) + arrowWidth / 2;\n    const arrowYCenter = (middlewareData.arrow?.y ?? 0) + arrowHeight / 2;\n\n    let x = '';\n    let y = '';\n\n    if (placedSide === 'bottom') {\n      x = isArrowHidden ? noArrowAlign : `${arrowXCenter}px`;\n      y = `${-arrowHeight}px`;\n    } else if (placedSide === 'top') {\n      x = isArrowHidden ? noArrowAlign : `${arrowXCenter}px`;\n      y = `${rects.floating.height + arrowHeight}px`;\n    } else if (placedSide === 'right') {\n      x = `${-arrowHeight}px`;\n      y = isArrowHidden ? noArrowAlign : `${arrowYCenter}px`;\n    } else if (placedSide === 'left') {\n      x = `${rects.floating.width + arrowHeight}px`;\n      y = isArrowHidden ? noArrowAlign : `${arrowYCenter}px`;\n    }\n    return { data: { x, y } };\n  },\n});\n\nfunction getSideAndAlignFromPlacement(placement: Placement) {\n  const [side, align = 'center'] = placement.split('-');\n  return [side as Side, align as Align] as const;\n}\n\nconst Root = Popper;\nconst Anchor = PopperAnchor;\nconst Content = PopperContent;\nconst Arrow = PopperArrow;\n\nexport {\n  createPopperScope,\n  //\n  Popper,\n  PopperAnchor,\n  PopperContent,\n  PopperArrow,\n  //\n  Root,\n  Anchor,\n  Content,\n  Arrow,\n  //\n  SIDE_OPTIONS,\n  ALIGN_OPTIONS,\n};\nexport type { PopperProps, PopperAnchorProps, PopperContentProps, PopperArrowProps };\n", "export {\n  createPopoverScope,\n  //\n  Popover,\n  PopoverAnchor,\n  PopoverTrigger,\n  PopoverPortal,\n  PopoverContent,\n  PopoverClose,\n  PopoverArrow,\n  //\n  Root,\n  Anchor,\n  Trigger,\n  Portal,\n  Content,\n  Close,\n  Arrow,\n} from './Popover';\nexport type {\n  PopoverProps,\n  PopoverAnchorProps,\n  PopoverTriggerProps,\n  PopoverPortalProps,\n  PopoverContentProps,\n  PopoverCloseProps,\n  PopoverArrowProps,\n} from './Popover';\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { DismissableLayer } from '@radix-ui/react-dismissable-layer';\nimport { useFocusGuards } from '@radix-ui/react-focus-guards';\nimport { FocusScope } from '@radix-ui/react-focus-scope';\nimport { useId } from '@radix-ui/react-id';\nimport * as PopperPrimitive from '@radix-ui/react-popper';\nimport { createPopperScope } from '@radix-ui/react-popper';\nimport { Portal as PortalPrimitive } from '@radix-ui/react-portal';\nimport { Presence } from '@radix-ui/react-presence';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { Slot } from '@radix-ui/react-slot';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { hideOthers } from 'aria-hidden';\nimport { RemoveScroll } from 'react-remove-scroll';\n\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\n\n/* -------------------------------------------------------------------------------------------------\n * Popover\n * -----------------------------------------------------------------------------------------------*/\n\nconst POPOVER_NAME = 'Popover';\n\ntype ScopedProps<P> = P & { __scopePopover?: Scope };\nconst [createPopoverContext, createPopoverScope] = createContextScope(POPOVER_NAME, [\n  createPopperScope,\n]);\nconst usePopperScope = createPopperScope();\n\ntype PopoverContextValue = {\n  triggerRef: React.RefObject<HTMLButtonElement>;\n  contentId: string;\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  onOpenToggle(): void;\n  hasCustomAnchor: boolean;\n  onCustomAnchorAdd(): void;\n  onCustomAnchorRemove(): void;\n  modal: boolean;\n};\n\nconst [PopoverProvider, usePopoverContext] =\n  createPopoverContext<PopoverContextValue>(POPOVER_NAME);\n\ninterface PopoverProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  modal?: boolean;\n}\n\nconst Popover: React.FC<PopoverProps> = (props: ScopedProps<PopoverProps>) => {\n  const {\n    __scopePopover,\n    children,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    modal = false,\n  } = props;\n  const popperScope = usePopperScope(__scopePopover);\n  const triggerRef = React.useRef<HTMLButtonElement>(null);\n  const [hasCustomAnchor, setHasCustomAnchor] = React.useState(false);\n  const [open = false, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen,\n    onChange: onOpenChange,\n  });\n\n  return (\n    <PopperPrimitive.Root {...popperScope}>\n      <PopoverProvider\n        scope={__scopePopover}\n        contentId={useId()}\n        triggerRef={triggerRef}\n        open={open}\n        onOpenChange={setOpen}\n        onOpenToggle={React.useCallback(() => setOpen((prevOpen) => !prevOpen), [setOpen])}\n        hasCustomAnchor={hasCustomAnchor}\n        onCustomAnchorAdd={React.useCallback(() => setHasCustomAnchor(true), [])}\n        onCustomAnchorRemove={React.useCallback(() => setHasCustomAnchor(false), [])}\n        modal={modal}\n      >\n        {children}\n      </PopoverProvider>\n    </PopperPrimitive.Root>\n  );\n};\n\nPopover.displayName = POPOVER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverAnchor\n * -----------------------------------------------------------------------------------------------*/\n\nconst ANCHOR_NAME = 'PopoverAnchor';\n\ntype PopoverAnchorElement = React.ElementRef<typeof PopperPrimitive.Anchor>;\ntype PopperAnchorProps = Radix.ComponentPropsWithoutRef<typeof PopperPrimitive.Anchor>;\ninterface PopoverAnchorProps extends PopperAnchorProps {}\n\nconst PopoverAnchor = React.forwardRef<PopoverAnchorElement, PopoverAnchorProps>(\n  (props: ScopedProps<PopoverAnchorProps>, forwardedRef) => {\n    const { __scopePopover, ...anchorProps } = props;\n    const context = usePopoverContext(ANCHOR_NAME, __scopePopover);\n    const popperScope = usePopperScope(__scopePopover);\n    const { onCustomAnchorAdd, onCustomAnchorRemove } = context;\n\n    React.useEffect(() => {\n      onCustomAnchorAdd();\n      return () => onCustomAnchorRemove();\n    }, [onCustomAnchorAdd, onCustomAnchorRemove]);\n\n    return <PopperPrimitive.Anchor {...popperScope} {...anchorProps} ref={forwardedRef} />;\n  }\n);\n\nPopoverAnchor.displayName = ANCHOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'PopoverTrigger';\n\ntype PopoverTriggerElement = React.ElementRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = Radix.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface PopoverTriggerProps extends PrimitiveButtonProps {}\n\nconst PopoverTrigger = React.forwardRef<PopoverTriggerElement, PopoverTriggerProps>(\n  (props: ScopedProps<PopoverTriggerProps>, forwardedRef) => {\n    const { __scopePopover, ...triggerProps } = props;\n    const context = usePopoverContext(TRIGGER_NAME, __scopePopover);\n    const popperScope = usePopperScope(__scopePopover);\n    const composedTriggerRef = useComposedRefs(forwardedRef, context.triggerRef);\n\n    const trigger = (\n      <Primitive.button\n        type=\"button\"\n        aria-haspopup=\"dialog\"\n        aria-expanded={context.open}\n        aria-controls={context.contentId}\n        data-state={getState(context.open)}\n        {...triggerProps}\n        ref={composedTriggerRef}\n        onClick={composeEventHandlers(props.onClick, context.onOpenToggle)}\n      />\n    );\n\n    return context.hasCustomAnchor ? (\n      trigger\n    ) : (\n      <PopperPrimitive.Anchor asChild {...popperScope}>\n        {trigger}\n      </PopperPrimitive.Anchor>\n    );\n  }\n);\n\nPopoverTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'PopoverPortal';\n\ntype PortalContextValue = { forceMount?: true };\nconst [PortalProvider, usePortalContext] = createPopoverContext<PortalContextValue>(PORTAL_NAME, {\n  forceMount: undefined,\n});\n\ntype PortalProps = React.ComponentPropsWithoutRef<typeof PortalPrimitive>;\ninterface PopoverPortalProps {\n  children?: React.ReactNode;\n  /**\n   * Specify a container element to portal the content into.\n   */\n  container?: PortalProps['container'];\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst PopoverPortal: React.FC<PopoverPortalProps> = (props: ScopedProps<PopoverPortalProps>) => {\n  const { __scopePopover, forceMount, children, container } = props;\n  const context = usePopoverContext(PORTAL_NAME, __scopePopover);\n  return (\n    <PortalProvider scope={__scopePopover} forceMount={forceMount}>\n      <Presence present={forceMount || context.open}>\n        <PortalPrimitive asChild container={container}>\n          {children}\n        </PortalPrimitive>\n      </Presence>\n    </PortalProvider>\n  );\n};\n\nPopoverPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'PopoverContent';\n\ninterface PopoverContentProps extends PopoverContentTypeProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst PopoverContent = React.forwardRef<PopoverContentTypeElement, PopoverContentProps>(\n  (props: ScopedProps<PopoverContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopePopover);\n    const { forceMount = portalContext.forceMount, ...contentProps } = props;\n    const context = usePopoverContext(CONTENT_NAME, props.__scopePopover);\n    return (\n      <Presence present={forceMount || context.open}>\n        {context.modal ? (\n          <PopoverContentModal {...contentProps} ref={forwardedRef} />\n        ) : (\n          <PopoverContentNonModal {...contentProps} ref={forwardedRef} />\n        )}\n      </Presence>\n    );\n  }\n);\n\nPopoverContent.displayName = CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype PopoverContentTypeElement = PopoverContentImplElement;\ninterface PopoverContentTypeProps\n  extends Omit<PopoverContentImplProps, 'trapFocus' | 'disableOutsidePointerEvents'> {}\n\nconst PopoverContentModal = React.forwardRef<PopoverContentTypeElement, PopoverContentTypeProps>(\n  (props: ScopedProps<PopoverContentTypeProps>, forwardedRef) => {\n    const context = usePopoverContext(CONTENT_NAME, props.__scopePopover);\n    const contentRef = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef);\n    const isRightClickOutsideRef = React.useRef(false);\n\n    // aria-hide everything except the content (better supported equivalent to setting aria-modal)\n    React.useEffect(() => {\n      const content = contentRef.current;\n      if (content) return hideOthers(content);\n    }, []);\n\n    return (\n      <RemoveScroll as={Slot} allowPinchZoom>\n        <PopoverContentImpl\n          {...props}\n          ref={composedRefs}\n          // we make sure we're not trapping once it's been closed\n          // (closed !== unmounted when animating out)\n          trapFocus={context.open}\n          disableOutsidePointerEvents\n          onCloseAutoFocus={composeEventHandlers(props.onCloseAutoFocus, (event) => {\n            event.preventDefault();\n            if (!isRightClickOutsideRef.current) context.triggerRef.current?.focus();\n          })}\n          onPointerDownOutside={composeEventHandlers(\n            props.onPointerDownOutside,\n            (event) => {\n              const originalEvent = event.detail.originalEvent;\n              const ctrlLeftClick = originalEvent.button === 0 && originalEvent.ctrlKey === true;\n              const isRightClick = originalEvent.button === 2 || ctrlLeftClick;\n\n              isRightClickOutsideRef.current = isRightClick;\n            },\n            { checkForDefaultPrevented: false }\n          )}\n          // When focus is trapped, a `focusout` event may still happen.\n          // We make sure we don't trigger our `onDismiss` in such case.\n          onFocusOutside={composeEventHandlers(\n            props.onFocusOutside,\n            (event) => event.preventDefault(),\n            { checkForDefaultPrevented: false }\n          )}\n        />\n      </RemoveScroll>\n    );\n  }\n);\n\nconst PopoverContentNonModal = React.forwardRef<PopoverContentTypeElement, PopoverContentTypeProps>(\n  (props: ScopedProps<PopoverContentTypeProps>, forwardedRef) => {\n    const context = usePopoverContext(CONTENT_NAME, props.__scopePopover);\n    const hasInteractedOutsideRef = React.useRef(false);\n    const hasPointerDownOutsideRef = React.useRef(false);\n\n    return (\n      <PopoverContentImpl\n        {...props}\n        ref={forwardedRef}\n        trapFocus={false}\n        disableOutsidePointerEvents={false}\n        onCloseAutoFocus={(event) => {\n          props.onCloseAutoFocus?.(event);\n\n          if (!event.defaultPrevented) {\n            if (!hasInteractedOutsideRef.current) context.triggerRef.current?.focus();\n            // Always prevent auto focus because we either focus manually or want user agent focus\n            event.preventDefault();\n          }\n\n          hasInteractedOutsideRef.current = false;\n          hasPointerDownOutsideRef.current = false;\n        }}\n        onInteractOutside={(event) => {\n          props.onInteractOutside?.(event);\n\n          if (!event.defaultPrevented) {\n            hasInteractedOutsideRef.current = true;\n            if (event.detail.originalEvent.type === 'pointerdown') {\n              hasPointerDownOutsideRef.current = true;\n            }\n          }\n\n          // Prevent dismissing when clicking the trigger.\n          // As the trigger is already setup to close, without doing so would\n          // cause it to close and immediately open.\n          const target = event.target as HTMLElement;\n          const targetIsTrigger = context.triggerRef.current?.contains(target);\n          if (targetIsTrigger) event.preventDefault();\n\n          // On Safari if the trigger is inside a container with tabIndex={0}, when clicked\n          // we will get the pointer down outside event on the trigger, but then a subsequent\n          // focus outside event on the container, we ignore any focus outside event when we've\n          // already had a pointer down outside event.\n          if (event.detail.originalEvent.type === 'focusin' && hasPointerDownOutsideRef.current) {\n            event.preventDefault();\n          }\n        }}\n      />\n    );\n  }\n);\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype PopoverContentImplElement = React.ElementRef<typeof PopperPrimitive.Content>;\ntype FocusScopeProps = Radix.ComponentPropsWithoutRef<typeof FocusScope>;\ntype DismissableLayerProps = Radix.ComponentPropsWithoutRef<typeof DismissableLayer>;\ntype PopperContentProps = Radix.ComponentPropsWithoutRef<typeof PopperPrimitive.Content>;\ninterface PopoverContentImplProps\n  extends Omit<PopperContentProps, 'onPlaced'>,\n    Omit<DismissableLayerProps, 'onDismiss'> {\n  /**\n   * Whether focus should be trapped within the `Popover`\n   * (default: false)\n   */\n  trapFocus?: FocusScopeProps['trapped'];\n\n  /**\n   * Event handler called when auto-focusing on open.\n   * Can be prevented.\n   */\n  onOpenAutoFocus?: FocusScopeProps['onMountAutoFocus'];\n\n  /**\n   * Event handler called when auto-focusing on close.\n   * Can be prevented.\n   */\n  onCloseAutoFocus?: FocusScopeProps['onUnmountAutoFocus'];\n}\n\nconst PopoverContentImpl = React.forwardRef<PopoverContentImplElement, PopoverContentImplProps>(\n  (props: ScopedProps<PopoverContentImplProps>, forwardedRef) => {\n    const {\n      __scopePopover,\n      trapFocus,\n      onOpenAutoFocus,\n      onCloseAutoFocus,\n      disableOutsidePointerEvents,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      onFocusOutside,\n      onInteractOutside,\n      ...contentProps\n    } = props;\n    const context = usePopoverContext(CONTENT_NAME, __scopePopover);\n    const popperScope = usePopperScope(__scopePopover);\n\n    // Make sure the whole tree has focus guards as our `Popover` may be\n    // the last element in the DOM (beacuse of the `Portal`)\n    useFocusGuards();\n\n    return (\n      <FocusScope\n        asChild\n        loop\n        trapped={trapFocus}\n        onMountAutoFocus={onOpenAutoFocus}\n        onUnmountAutoFocus={onCloseAutoFocus}\n      >\n        <DismissableLayer\n          asChild\n          disableOutsidePointerEvents={disableOutsidePointerEvents}\n          onInteractOutside={onInteractOutside}\n          onEscapeKeyDown={onEscapeKeyDown}\n          onPointerDownOutside={onPointerDownOutside}\n          onFocusOutside={onFocusOutside}\n          onDismiss={() => context.onOpenChange(false)}\n        >\n          <PopperPrimitive.Content\n            data-state={getState(context.open)}\n            role=\"dialog\"\n            id={context.contentId}\n            {...popperScope}\n            {...contentProps}\n            ref={forwardedRef}\n            style={{\n              ...contentProps.style,\n              // re-namespace exposed content custom properties\n              ...{\n                '--radix-popover-content-transform-origin': 'var(--radix-popper-transform-origin)',\n                '--radix-popover-content-available-width': 'var(--radix-popper-available-width)',\n                '--radix-popover-content-available-height': 'var(--radix-popper-available-height)',\n                '--radix-popover-trigger-width': 'var(--radix-popper-anchor-width)',\n                '--radix-popover-trigger-height': 'var(--radix-popper-anchor-height)',\n              },\n            }}\n          />\n        </DismissableLayer>\n      </FocusScope>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverClose\n * -----------------------------------------------------------------------------------------------*/\n\nconst CLOSE_NAME = 'PopoverClose';\n\ntype PopoverCloseElement = React.ElementRef<typeof Primitive.button>;\ninterface PopoverCloseProps extends PrimitiveButtonProps {}\n\nconst PopoverClose = React.forwardRef<PopoverCloseElement, PopoverCloseProps>(\n  (props: ScopedProps<PopoverCloseProps>, forwardedRef) => {\n    const { __scopePopover, ...closeProps } = props;\n    const context = usePopoverContext(CLOSE_NAME, __scopePopover);\n    return (\n      <Primitive.button\n        type=\"button\"\n        {...closeProps}\n        ref={forwardedRef}\n        onClick={composeEventHandlers(props.onClick, () => context.onOpenChange(false))}\n      />\n    );\n  }\n);\n\nPopoverClose.displayName = CLOSE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * PopoverArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'PopoverArrow';\n\ntype PopoverArrowElement = React.ElementRef<typeof PopperPrimitive.Arrow>;\ntype PopperArrowProps = Radix.ComponentPropsWithoutRef<typeof PopperPrimitive.Arrow>;\ninterface PopoverArrowProps extends PopperArrowProps {}\n\nconst PopoverArrow = React.forwardRef<PopoverArrowElement, PopoverArrowProps>(\n  (props: ScopedProps<PopoverArrowProps>, forwardedRef) => {\n    const { __scopePopover, ...arrowProps } = props;\n    const popperScope = usePopperScope(__scopePopover);\n    return <PopperPrimitive.Arrow {...popperScope} {...arrowProps} ref={forwardedRef} />;\n  }\n);\n\nPopoverArrow.displayName = ARROW_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction getState(open: boolean) {\n  return open ? 'open' : 'closed';\n}\n\nconst Root = Popover;\nconst Anchor = PopoverAnchor;\nconst Trigger = PopoverTrigger;\nconst Portal = PopoverPortal;\nconst Content = PopoverContent;\nconst Close = PopoverClose;\nconst Arrow = PopoverArrow;\n\nexport {\n  createPopoverScope,\n  //\n  Popover,\n  PopoverAnchor,\n  PopoverTrigger,\n  PopoverPortal,\n  PopoverContent,\n  PopoverClose,\n  PopoverArrow,\n  //\n  Root,\n  Anchor,\n  Trigger,\n  Portal,\n  Content,\n  Close,\n  Arrow,\n};\nexport type {\n  PopoverProps,\n  PopoverAnchorProps,\n  PopoverTriggerProps,\n  PopoverPortalProps,\n  PopoverContentProps,\n  PopoverCloseProps,\n  PopoverArrowProps,\n};\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport { useCallback, useEffect, useRef } from 'react'\nimport { useUiEvents } from '../context/events'\n\n/** @public */\nexport function useMenuIsOpen(id: string, cb?: (isOpen: boolean) => void) {\n\tconst editor = useEditor()\n\tconst rIsOpen = useRef(false)\n\tconst trackEvent = useUiEvents()\n\n\tconst onOpenChange = useCallback(\n\t\t(isOpen: boolean) => {\n\t\t\trIsOpen.current = isOpen\n\n\t\t\teditor.batch(() => {\n\t\t\t\tif (isOpen) {\n\t\t\t\t\teditor.complete()\n\t\t\t\t\teditor.addOpenMenu(id)\n\t\t\t\t} else {\n\t\t\t\t\teditor.updateInstanceState({\n\t\t\t\t\t\topenMenus: editor.getOpenMenus().filter((m) => !m.startsWith(id)),\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tcb?.(isOpen)\n\t\t\t})\n\t\t},\n\t\t[editor, id, cb]\n\t)\n\n\tconst isOpen = useValue('is menu open', () => editor.getOpenMenus().includes(id), [editor, id])\n\n\tuseEffect(() => {\n\t\t// When the effect runs, if the menu is open then\n\t\t// add it to the open menus list.\n\n\t\t// This is necessary for cases where the user closes\n\t\t// the parent of a submenu before closing the submenu.\n\t\t// There is some duplication between this and `onOpenChange`\n\t\t// hook but it's necessary to handle the case where the\n\t\t// this effect runs twice or re-runs.\n\t\tif (rIsOpen.current) {\n\t\t\ttrackEvent('open-menu', { source: 'unknown', id })\n\t\t\teditor.addOpenMenu(id)\n\t\t}\n\n\t\treturn () => {\n\t\t\tif (rIsOpen.current) {\n\t\t\t\t// Close menu on unmount\n\t\t\t\teditor.deleteOpenMenu(id)\n\n\t\t\t\t// Close menu and all submenus when the parent is closed\n\t\t\t\teditor.getOpenMenus().forEach((menuId) => {\n\t\t\t\t\tif (menuId.startsWith(id)) {\n\t\t\t\t\t\ttrackEvent('close-menu', { source: 'unknown', id })\n\t\t\t\t\t\teditor.deleteOpenMenu(menuId)\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\trIsOpen.current = false\n\t\t\t}\n\t\t}\n\t}, [editor, id, trackEvent])\n\n\treturn [isOpen, onOpenChange] as const\n}\n", "import { createContext, useContext } from 'react'\nimport { TLUiEventSource } from '../../../context/events'\n\n/** @public */\nexport type TldrawUiMenuContextType =\n\t| 'panel'\n\t| 'menu'\n\t| 'small-icons'\n\t| 'context-menu'\n\t| 'icons'\n\t| 'keyboard-shortcuts'\n\t| 'helper-buttons'\n\t| 'toolbar'\n\t| 'toolbar-overflow'\n\nconst menuContext = createContext<{\n\ttype: TldrawUiMenuContextType\n\tsourceId: TLUiEventSource\n}>({ type: 'menu', sourceId: 'main-menu' })\n\n/** @public */\nexport function useTldrawUiMenuContext() {\n\treturn useContext(menuContext)\n}\n\n/** @public */\nexport type TLUiMenuContextProviderProps = {\n\ttype: TldrawUiMenuContextType\n\tsourceId: TLUiEventSource\n\tchildren: React.ReactNode\n}\n\n/** @public */\nexport function TldrawUiMenuContextProvider({\n\ttype,\n\tsourceId,\n\tchildren,\n}: TLUiMenuContextProviderProps) {\n\treturn <menuContext.Provider value={{ type, sourceId }}>{children}</menuContext.Provider>\n}\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useActions } from '../../context/actions'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport {\n\tuseAllowGroup,\n\tuseAllowUngroup,\n\tuseHasLinkShapeSelected,\n\tuseThreeStackableItems,\n\tuseUnlockedSelectedShapesCount,\n} from '../../hooks/menu-hooks'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\n/** @public */\nexport function DefaultActionsMenuContent() {\n\treturn (\n\t\t<>\n\t\t\t<AlignMenuItems />\n\t\t\t<DistributeMenuItems />\n\t\t\t<StackMenuItems />\n\t\t\t<ReorderMenuItems />\n\t\t\t<ZoomOrRotateMenuItem />\n\t\t\t<RotateCWMenuItem />\n\t\t\t<EditLinkMenuItem />\n\t\t\t<GroupOrUngroupMenuItem />\n\t\t</>\n\t)\n}\n\n/** @public */\nexport function AlignMenuItems() {\n\tconst actions = useActions()\n\tconst twoSelected = useUnlockedSelectedShapesCount(2)\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuItem {...actions['align-left']} disabled={!twoSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['align-center-horizontal']} disabled={!twoSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['align-right']} disabled={!twoSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['stretch-horizontal']} disabled={!twoSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['align-top']} disabled={!twoSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['align-center-vertical']} disabled={!twoSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['align-bottom']} disabled={!twoSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['stretch-vertical']} disabled={!twoSelected} />\n\t\t</>\n\t)\n}\n\n/** @public */\nexport function DistributeMenuItems() {\n\tconst actions = useActions()\n\tconst threeSelected = useUnlockedSelectedShapesCount(3)\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuItem {...actions['distribute-horizontal']} disabled={!threeSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['distribute-vertical']} disabled={!threeSelected} />\n\t\t</>\n\t)\n}\n\n/** @public */\nexport function StackMenuItems() {\n\tconst actions = useActions()\n\tconst threeStackableItems = useThreeStackableItems()\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuItem {...actions['stack-horizontal']} disabled={!threeStackableItems} />\n\t\t\t<TldrawUiMenuItem {...actions['stack-vertical']} disabled={!threeStackableItems} />\n\t\t</>\n\t)\n}\n\n/** @public */\nexport function ReorderMenuItems() {\n\tconst actions = useActions()\n\tconst oneSelected = useUnlockedSelectedShapesCount(1)\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuItem {...actions['send-to-back']} disabled={!oneSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['send-backward']} disabled={!oneSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['bring-forward']} disabled={!oneSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['bring-to-front']} disabled={!oneSelected} />\n\t\t</>\n\t)\n}\n\n/** @public */\n\nexport function ZoomOrRotateMenuItem() {\n\tconst breakpoint = useBreakpoint()\n\treturn breakpoint < PORTRAIT_BREAKPOINT.TABLET_SM ? <ZoomTo100MenuItem /> : <RotateCCWMenuItem />\n}\n/** @public */\n\nexport function ZoomTo100MenuItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isZoomedTo100 = useValue('zoom is 1', () => editor.getZoomLevel() === 1, [editor])\n\n\treturn <TldrawUiMenuItem {...actions['zoom-to-100']} disabled={isZoomedTo100} />\n}\n/** @public */\n\nexport function RotateCCWMenuItem() {\n\tconst actions = useActions()\n\tconst oneSelected = useUnlockedSelectedShapesCount(1)\n\n\treturn <TldrawUiMenuItem {...actions['rotate-ccw']} disabled={!oneSelected} />\n}\n/** @public */\n\nexport function RotateCWMenuItem() {\n\tconst actions = useActions()\n\tconst oneSelected = useUnlockedSelectedShapesCount(1)\n\n\treturn <TldrawUiMenuItem {...actions['rotate-cw']} disabled={!oneSelected} />\n}\n/** @public */\n\nexport function EditLinkMenuItem() {\n\tconst actions = useActions()\n\tconst showEditLink = useHasLinkShapeSelected()\n\n\treturn <TldrawUiMenuItem {...actions['edit-link']} disabled={!showEditLink} />\n}\n/** @public */\n\nexport function GroupOrUngroupMenuItem() {\n\tconst allowGroup = useAllowGroup()\n\tconst allowUngroup = useAllowUngroup()\n\treturn allowGroup ? <GroupMenuItem /> : allowUngroup ? <UngroupMenuItem /> : <GroupMenuItem />\n}\n/** @public */\n\nexport function GroupMenuItem() {\n\tconst actions = useActions()\n\tconst twoSelected = useUnlockedSelectedShapesCount(2)\n\n\treturn <TldrawUiMenuItem {...actions['group']} disabled={!twoSelected} />\n}\n/** @public */\n\nexport function UngroupMenuItem() {\n\tconst actions = useActions()\n\treturn <TldrawUiMenuItem {...actions['ungroup']} />\n}\n", "import { ContextMenuItem } from '@radix-ui/react-context-menu'\nimport { exhaustiveSwitchError, preventDefault } from '@tldraw/editor'\nimport { useState } from 'react'\nimport { unwrapLabel } from '../../../context/actions'\nimport { TLUiEventSource } from '../../../context/events'\nimport { useReadonly } from '../../../hooks/useReadonly'\nimport { TLUiTranslationKey } from '../../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../../hooks/useTranslation/useTranslation'\nimport { kbdStr } from '../../../kbd-utils'\nimport { Spinner } from '../../Spinner'\nimport { TldrawUiButton } from '../Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../Button/TldrawUiButtonIcon'\nimport { TldrawUiButtonLabel } from '../Button/TldrawUiButtonLabel'\nimport { TldrawUiDropdownMenuItem } from '../TldrawUiDropdownMenu'\nimport { TldrawUiKbd } from '../TldrawUiKbd'\nimport { useTldrawUiMenuContext } from './TldrawUiMenuContext'\n\n/** @public */\nexport type TLUiMenuItemProps<\n\tTranslationKey extends string = string,\n\tIconType extends string = string,\n> = {\n\tid: string\n\t/**\n\t * The icon to display on the item.\n\t */\n\ticon?: IconType\n\t/**\n\t * The keyboard shortcut to display on the item.\n\t */\n\tkbd?: string\n\t/**\n\t * The label to display on the item. If it's a string, it will be translated. If it's an object, the keys will be used as the language keys and the values will be translated.\n\t */\n\tlabel?: TranslationKey | { [key: string]: TranslationKey }\n\t/**\n\t * If the editor is in readonly mode and the item is not marked as readonlyok, it will not be rendered.\n\t */\n\treadonlyOk?: boolean\n\t/**\n\t * The function to call when the item is clicked.\n\t */\n\tonSelect: (source: TLUiEventSource) => Promise<void> | void\n\t/**\n\t * Whether this item should be disabled.\n\t */\n\tdisabled?: boolean\n\t/**\n\t * Prevent the menu from closing when the item is clicked\n\t */\n\tnoClose?: boolean\n\t/**\n\t * Whether to show a spinner on the item.\n\t */\n\tspinner?: boolean\n\t/**\n\t * Whether the item is selected.\n\t */\n\tisSelected?: boolean\n}\n\n/** @public */\nexport function TldrawUiMenuItem<\n\tTranslationKey extends string = string,\n\tIconType extends string = string,\n>({\n\tdisabled = false,\n\tspinner = false,\n\treadonlyOk = false,\n\tid,\n\tkbd,\n\tlabel,\n\ticon,\n\tonSelect,\n\tnoClose,\n\tisSelected,\n}: TLUiMenuItemProps<TranslationKey, IconType>) {\n\tconst { type: menuType, sourceId } = useTldrawUiMenuContext()\n\n\tconst msg = useTranslation()\n\n\tconst [disableClicks, setDisableClicks] = useState(false)\n\n\tconst isReadonlyMode = useReadonly()\n\tif (isReadonlyMode && !readonlyOk) return null\n\n\tconst labelToUse = unwrapLabel(label, menuType)\n\tconst kbdTouse = kbd ? kbdStr(kbd) : undefined\n\n\tconst labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined\n\tconst titleStr = labelStr && kbdTouse ? `${labelStr} ${kbdTouse}` : labelStr\n\n\tswitch (menuType) {\n\t\tcase 'menu': {\n\t\t\treturn (\n\t\t\t\t<TldrawUiDropdownMenuItem>\n\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\ttype=\"menu\"\n\t\t\t\t\t\tdata-testid={`${sourceId}.${id}`}\n\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\ttitle={titleStr}\n\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\tif (noClose) {\n\t\t\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (disableClicks) {\n\t\t\t\t\t\t\t\tsetDisableClicks(false)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tonSelect(sourceId)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>\n\t\t\t\t\t\t{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}\n\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t</TldrawUiDropdownMenuItem>\n\t\t\t)\n\t\t}\n\t\tcase 'context-menu': {\n\t\t\t// Hide disabled context menu items\n\t\t\tif (disabled) return null\n\n\t\t\treturn (\n\t\t\t\t<ContextMenuItem\n\t\t\t\t\tdir=\"ltr\"\n\t\t\t\t\ttitle={titleStr}\n\t\t\t\t\tdraggable={false}\n\t\t\t\t\tclassName=\"tlui-button tlui-button__menu\"\n\t\t\t\t\tdata-testid={`${sourceId}.${id}`}\n\t\t\t\t\tonSelect={(e) => {\n\t\t\t\t\t\tif (noClose) preventDefault(e)\n\t\t\t\t\t\tif (disableClicks) {\n\t\t\t\t\t\t\tsetDisableClicks(false)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonSelect(sourceId)\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<span className=\"tlui-button__label\" draggable={false}>\n\t\t\t\t\t\t{labelStr}\n\t\t\t\t\t</span>\n\t\t\t\t\t{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}\n\t\t\t\t\t{spinner && <Spinner />}\n\t\t\t\t</ContextMenuItem>\n\t\t\t)\n\t\t}\n\t\tcase 'panel': {\n\t\t\treturn (\n\t\t\t\t<TldrawUiButton\n\t\t\t\t\tdata-testid={`${sourceId}.${id}`}\n\t\t\t\t\ttype=\"menu\"\n\t\t\t\t\ttitle={titleStr}\n\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\tonClick={() => onSelect(sourceId)}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>\n\t\t\t\t\t{icon && <TldrawUiButtonIcon icon={icon} />}\n\t\t\t\t</TldrawUiButton>\n\t\t\t)\n\t\t}\n\t\tcase 'small-icons':\n\t\tcase 'icons': {\n\t\t\treturn (\n\t\t\t\t<TldrawUiButton\n\t\t\t\t\tdata-testid={`${sourceId}.${id}`}\n\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\ttitle={titleStr}\n\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\tonClick={() => onSelect(sourceId)}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiButtonIcon icon={icon!} small={menuType === 'small-icons'} />\n\t\t\t\t</TldrawUiButton>\n\t\t\t)\n\t\t}\n\t\tcase 'keyboard-shortcuts': {\n\t\t\tif (!kbd) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`Menu item '${label}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`\n\t\t\t\t)\n\t\t\t\treturn null\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<div className=\"tlui-shortcuts-dialog__key-pair\" data-testid={`${sourceId}.${id}`}>\n\t\t\t\t\t<div className=\"tlui-shortcuts-dialog__key-pair__key\">{labelStr}</div>\n\t\t\t\t\t<div className=\"tlui-shortcuts-dialog__key-pair__value\">\n\t\t\t\t\t\t<TldrawUiKbd visibleOnMobileLayout>{kbd}</TldrawUiKbd>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)\n\t\t}\n\t\tcase 'helper-buttons': {\n\t\t\treturn (\n\t\t\t\t<TldrawUiButton type=\"low\" onClick={() => onSelect(sourceId)}>\n\t\t\t\t\t<TldrawUiButtonIcon icon={icon!} />\n\t\t\t\t\t<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>\n\t\t\t\t</TldrawUiButton>\n\t\t\t)\n\t\t}\n\t\tcase 'toolbar': {\n\t\t\treturn (\n\t\t\t\t<TldrawUiButton\n\t\t\t\t\ttype=\"tool\"\n\t\t\t\t\tdata-testid={`tools.${id}`}\n\t\t\t\t\taria-label={labelToUse}\n\t\t\t\t\tdata-value={id}\n\t\t\t\t\tonClick={() => onSelect('toolbar')}\n\t\t\t\t\ttitle={titleStr}\n\t\t\t\t\tonTouchStart={(e) => {\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t\tonSelect('toolbar')\n\t\t\t\t\t}}\n\t\t\t\t\trole=\"radio\"\n\t\t\t\t\taria-checked={isSelected ? 'true' : 'false'}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiButtonIcon icon={icon!} />\n\t\t\t\t</TldrawUiButton>\n\t\t\t)\n\t\t}\n\t\tcase 'toolbar-overflow': {\n\t\t\treturn (\n\t\t\t\t<TldrawUiDropdownMenuItem aria-label={label}>\n\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\tclassName=\"tlui-button-grid__button\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tonSelect('toolbar')\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdata-testid={`tools.more.${id}`}\n\t\t\t\t\t\ttitle={titleStr}\n\t\t\t\t\t\trole=\"radio\"\n\t\t\t\t\t\taria-checked={isSelected ? 'true' : 'false'}\n\t\t\t\t\t\tdata-value={id}\n\t\t\t\t\t>\n\t\t\t\t\t\t<TldrawUiButtonIcon icon={icon!} />\n\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t</TldrawUiDropdownMenuItem>\n\t\t\t)\n\t\t}\n\t\tdefault: {\n\t\t\tthrow exhaustiveSwitchError(menuType)\n\t\t}\n\t}\n}\n", "export {\n  useDirection,\n  //\n  Provider,\n  //\n  DirectionProvider,\n} from './Direction';\n", "import * as React from 'react';\n\ntype Direction = 'ltr' | 'rtl';\nconst DirectionContext = React.createContext<Direction | undefined>(undefined);\n\n/* -------------------------------------------------------------------------------------------------\n * Direction\n * -----------------------------------------------------------------------------------------------*/\n\ninterface DirectionProviderProps {\n  children?: React.ReactNode;\n  dir: Direction;\n}\nconst DirectionProvider: React.FC<DirectionProviderProps> = (props) => {\n  const { dir, children } = props;\n  return <DirectionContext.Provider value={dir}>{children}</DirectionContext.Provider>;\n};\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction useDirection(localDir?: Direction) {\n  const globalDir = React.useContext(DirectionContext);\n  return localDir || globalDir || 'ltr';\n}\n\nconst Provider = DirectionProvider;\n\nexport {\n  useDirection,\n  //\n  Provider,\n  //\n  DirectionProvider,\n};\n", "export {\n  createRovingFocusGroupScope,\n  //\n  RovingFocusGroup,\n  RovingFocusGroupItem,\n  //\n  Root,\n  Item,\n} from './RovingFocusGroup';\nexport type { RovingFocusGroupProps, RovingFocusItemProps } from './RovingFocusGroup';\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { createCollection } from '@radix-ui/react-collection';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useId } from '@radix-ui/react-id';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { useDirection } from '@radix-ui/react-direction';\n\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\n\nconst ENTRY_FOCUS = 'rovingFocusGroup.onEntryFocus';\nconst EVENT_OPTIONS = { bubbles: false, cancelable: true };\n\n/* -------------------------------------------------------------------------------------------------\n * RovingFocusGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst GROUP_NAME = 'RovingFocusGroup';\n\ntype ItemData = { id: string; focusable: boolean; active: boolean };\nconst [Collection, useCollection, createCollectionScope] = createCollection<\n  HTMLSpanElement,\n  ItemData\n>(GROUP_NAME);\n\ntype ScopedProps<P> = P & { __scopeRovingFocusGroup?: Scope };\nconst [createRovingFocusGroupContext, createRovingFocusGroupScope] = createContextScope(\n  GROUP_NAME,\n  [createCollectionScope]\n);\n\ntype Orientation = React.AriaAttributes['aria-orientation'];\ntype Direction = 'ltr' | 'rtl';\n\ninterface RovingFocusGroupOptions {\n  /**\n   * The orientation of the group.\n   * Mainly so arrow navigation is done accordingly (left & right vs. up & down)\n   */\n  orientation?: Orientation;\n  /**\n   * The direction of navigation between items.\n   */\n  dir?: Direction;\n  /**\n   * Whether keyboard navigation should loop around\n   * @defaultValue false\n   */\n  loop?: boolean;\n}\n\ntype RovingContextValue = RovingFocusGroupOptions & {\n  currentTabStopId: string | null;\n  onItemFocus(tabStopId: string): void;\n  onItemShiftTab(): void;\n  onFocusableItemAdd(): void;\n  onFocusableItemRemove(): void;\n};\n\nconst [RovingFocusProvider, useRovingFocusContext] =\n  createRovingFocusGroupContext<RovingContextValue>(GROUP_NAME);\n\ntype RovingFocusGroupElement = RovingFocusGroupImplElement;\ninterface RovingFocusGroupProps extends RovingFocusGroupImplProps {}\n\nconst RovingFocusGroup = React.forwardRef<RovingFocusGroupElement, RovingFocusGroupProps>(\n  (props: ScopedProps<RovingFocusGroupProps>, forwardedRef) => {\n    return (\n      <Collection.Provider scope={props.__scopeRovingFocusGroup}>\n        <Collection.Slot scope={props.__scopeRovingFocusGroup}>\n          <RovingFocusGroupImpl {...props} ref={forwardedRef} />\n        </Collection.Slot>\n      </Collection.Provider>\n    );\n  }\n);\n\nRovingFocusGroup.displayName = GROUP_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\ntype RovingFocusGroupImplElement = React.ElementRef<typeof Primitive.div>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface RovingFocusGroupImplProps\n  extends Omit<PrimitiveDivProps, 'dir'>,\n    RovingFocusGroupOptions {\n  currentTabStopId?: string | null;\n  defaultCurrentTabStopId?: string;\n  onCurrentTabStopIdChange?: (tabStopId: string | null) => void;\n  onEntryFocus?: (event: Event) => void;\n}\n\nconst RovingFocusGroupImpl = React.forwardRef<\n  RovingFocusGroupImplElement,\n  RovingFocusGroupImplProps\n>((props: ScopedProps<RovingFocusGroupImplProps>, forwardedRef) => {\n  const {\n    __scopeRovingFocusGroup,\n    orientation,\n    loop = false,\n    dir,\n    currentTabStopId: currentTabStopIdProp,\n    defaultCurrentTabStopId,\n    onCurrentTabStopIdChange,\n    onEntryFocus,\n    ...groupProps\n  } = props;\n  const ref = React.useRef<RovingFocusGroupImplElement>(null);\n  const composedRefs = useComposedRefs(forwardedRef, ref);\n  const direction = useDirection(dir);\n  const [currentTabStopId = null, setCurrentTabStopId] = useControllableState({\n    prop: currentTabStopIdProp,\n    defaultProp: defaultCurrentTabStopId,\n    onChange: onCurrentTabStopIdChange,\n  });\n  const [isTabbingBackOut, setIsTabbingBackOut] = React.useState(false);\n  const handleEntryFocus = useCallbackRef(onEntryFocus);\n  const getItems = useCollection(__scopeRovingFocusGroup);\n  const isClickFocusRef = React.useRef(false);\n  const [focusableItemsCount, setFocusableItemsCount] = React.useState(0);\n\n  React.useEffect(() => {\n    const node = ref.current;\n    if (node) {\n      node.addEventListener(ENTRY_FOCUS, handleEntryFocus);\n      return () => node.removeEventListener(ENTRY_FOCUS, handleEntryFocus);\n    }\n  }, [handleEntryFocus]);\n\n  return (\n    <RovingFocusProvider\n      scope={__scopeRovingFocusGroup}\n      orientation={orientation}\n      dir={direction}\n      loop={loop}\n      currentTabStopId={currentTabStopId}\n      onItemFocus={React.useCallback(\n        (tabStopId) => setCurrentTabStopId(tabStopId),\n        [setCurrentTabStopId]\n      )}\n      onItemShiftTab={React.useCallback(() => setIsTabbingBackOut(true), [])}\n      onFocusableItemAdd={React.useCallback(\n        () => setFocusableItemsCount((prevCount) => prevCount + 1),\n        []\n      )}\n      onFocusableItemRemove={React.useCallback(\n        () => setFocusableItemsCount((prevCount) => prevCount - 1),\n        []\n      )}\n    >\n      <Primitive.div\n        tabIndex={isTabbingBackOut || focusableItemsCount === 0 ? -1 : 0}\n        data-orientation={orientation}\n        {...groupProps}\n        ref={composedRefs}\n        style={{ outline: 'none', ...props.style }}\n        onMouseDown={composeEventHandlers(props.onMouseDown, () => {\n          isClickFocusRef.current = true;\n        })}\n        onFocus={composeEventHandlers(props.onFocus, (event) => {\n          // We normally wouldn't need this check, because we already check\n          // that the focus is on the current target and not bubbling to it.\n          // We do this because Safari doesn't focus buttons when clicked, and\n          // instead, the wrapper will get focused and not through a bubbling event.\n          const isKeyboardFocus = !isClickFocusRef.current;\n\n          if (event.target === event.currentTarget && isKeyboardFocus && !isTabbingBackOut) {\n            const entryFocusEvent = new CustomEvent(ENTRY_FOCUS, EVENT_OPTIONS);\n            event.currentTarget.dispatchEvent(entryFocusEvent);\n\n            if (!entryFocusEvent.defaultPrevented) {\n              const items = getItems().filter((item) => item.focusable);\n              const activeItem = items.find((item) => item.active);\n              const currentItem = items.find((item) => item.id === currentTabStopId);\n              const candidateItems = [activeItem, currentItem, ...items].filter(\n                Boolean\n              ) as typeof items;\n              const candidateNodes = candidateItems.map((item) => item.ref.current!);\n              focusFirst(candidateNodes);\n            }\n          }\n\n          isClickFocusRef.current = false;\n        })}\n        onBlur={composeEventHandlers(props.onBlur, () => setIsTabbingBackOut(false))}\n      />\n    </RovingFocusProvider>\n  );\n});\n\n/* -------------------------------------------------------------------------------------------------\n * RovingFocusGroupItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_NAME = 'RovingFocusGroupItem';\n\ntype RovingFocusItemElement = React.ElementRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = Radix.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface RovingFocusItemProps extends PrimitiveSpanProps {\n  tabStopId?: string;\n  focusable?: boolean;\n  active?: boolean;\n}\n\nconst RovingFocusGroupItem = React.forwardRef<RovingFocusItemElement, RovingFocusItemProps>(\n  (props: ScopedProps<RovingFocusItemProps>, forwardedRef) => {\n    const {\n      __scopeRovingFocusGroup,\n      focusable = true,\n      active = false,\n      tabStopId,\n      ...itemProps\n    } = props;\n    const autoId = useId();\n    const id = tabStopId || autoId;\n    const context = useRovingFocusContext(ITEM_NAME, __scopeRovingFocusGroup);\n    const isCurrentTabStop = context.currentTabStopId === id;\n    const getItems = useCollection(__scopeRovingFocusGroup);\n\n    const { onFocusableItemAdd, onFocusableItemRemove } = context;\n\n    React.useEffect(() => {\n      if (focusable) {\n        onFocusableItemAdd();\n        return () => onFocusableItemRemove();\n      }\n    }, [focusable, onFocusableItemAdd, onFocusableItemRemove]);\n\n    return (\n      <Collection.ItemSlot\n        scope={__scopeRovingFocusGroup}\n        id={id}\n        focusable={focusable}\n        active={active}\n      >\n        <Primitive.span\n          tabIndex={isCurrentTabStop ? 0 : -1}\n          data-orientation={context.orientation}\n          {...itemProps}\n          ref={forwardedRef}\n          onMouseDown={composeEventHandlers(props.onMouseDown, (event) => {\n            // We prevent focusing non-focusable items on `mousedown`.\n            // Even though the item has tabIndex={-1}, that only means take it out of the tab order.\n            if (!focusable) event.preventDefault();\n            // Safari doesn't focus a button when clicked so we run our logic on mousedown also\n            else context.onItemFocus(id);\n          })}\n          onFocus={composeEventHandlers(props.onFocus, () => context.onItemFocus(id))}\n          onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n            if (event.key === 'Tab' && event.shiftKey) {\n              context.onItemShiftTab();\n              return;\n            }\n\n            if (event.target !== event.currentTarget) return;\n\n            const focusIntent = getFocusIntent(event, context.orientation, context.dir);\n\n            if (focusIntent !== undefined) {\n              event.preventDefault();\n              const items = getItems().filter((item) => item.focusable);\n              let candidateNodes = items.map((item) => item.ref.current!);\n\n              if (focusIntent === 'last') candidateNodes.reverse();\n              else if (focusIntent === 'prev' || focusIntent === 'next') {\n                if (focusIntent === 'prev') candidateNodes.reverse();\n                const currentIndex = candidateNodes.indexOf(event.currentTarget);\n                candidateNodes = context.loop\n                  ? wrapArray(candidateNodes, currentIndex + 1)\n                  : candidateNodes.slice(currentIndex + 1);\n              }\n\n              /**\n               * Imperative focus during keydown is risky so we prevent React's batching updates\n               * to avoid potential bugs. See: https://github.com/facebook/react/issues/20332\n               */\n              setTimeout(() => focusFirst(candidateNodes));\n            }\n          })}\n        />\n      </Collection.ItemSlot>\n    );\n  }\n);\n\nRovingFocusGroupItem.displayName = ITEM_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\n// prettier-ignore\nconst MAP_KEY_TO_FOCUS_INTENT: Record<string, FocusIntent> = {\n  ArrowLeft: 'prev', ArrowUp: 'prev',\n  ArrowRight: 'next', ArrowDown: 'next',\n  PageUp: 'first', Home: 'first',\n  PageDown: 'last', End: 'last',\n};\n\nfunction getDirectionAwareKey(key: string, dir?: Direction) {\n  if (dir !== 'rtl') return key;\n  return key === 'ArrowLeft' ? 'ArrowRight' : key === 'ArrowRight' ? 'ArrowLeft' : key;\n}\n\ntype FocusIntent = 'first' | 'last' | 'prev' | 'next';\n\nfunction getFocusIntent(event: React.KeyboardEvent, orientation?: Orientation, dir?: Direction) {\n  const key = getDirectionAwareKey(event.key, dir);\n  if (orientation === 'vertical' && ['ArrowLeft', 'ArrowRight'].includes(key)) return undefined;\n  if (orientation === 'horizontal' && ['ArrowUp', 'ArrowDown'].includes(key)) return undefined;\n  return MAP_KEY_TO_FOCUS_INTENT[key];\n}\n\nfunction focusFirst(candidates: HTMLElement[]) {\n  const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;\n  for (const candidate of candidates) {\n    // if focus is already where we want to go, we don't want to keep going through the candidates\n    if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;\n    candidate.focus();\n    if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;\n  }\n}\n\n/**\n * Wraps an array around itself at a given start index\n * Example: `wrapArray(['a', 'b', 'c', 'd'], 2) === ['c', 'd', 'a', 'b']`\n */\nfunction wrapArray<T>(array: T[], startIndex: number) {\n  return array.map((_, index) => array[(startIndex + index) % array.length]);\n}\n\nconst Root = RovingFocusGroup;\nconst Item = RovingFocusGroupItem;\n\nexport {\n  createRovingFocusGroupScope,\n  //\n  RovingFocusGroup,\n  RovingFocusGroupItem,\n  //\n  Root,\n  Item,\n};\nexport type { RovingFocusGroupProps, RovingFocusItemProps };\n", "export {\n  createMenuScope,\n  //\n  Menu,\n  MenuAnchor,\n  MenuPortal,\n  MenuContent,\n  MenuGroup,\n  MenuLabel,\n  MenuItem,\n  MenuCheckboxItem,\n  MenuRadioGroup,\n  MenuRadioItem,\n  MenuItemIndicator,\n  MenuSeparator,\n  MenuArrow,\n  MenuSub,\n  MenuSubTrigger,\n  MenuSubContent,\n  //\n  Root,\n  Anchor,\n  Portal,\n  Content,\n  Group,\n  Label,\n  Item,\n  CheckboxItem,\n  RadioGroup,\n  RadioItem,\n  ItemIndicator,\n  Separator,\n  Arrow,\n  Sub,\n  SubTrigger,\n  SubContent,\n} from './Menu';\nexport type {\n  MenuProps,\n  MenuAnchorProps,\n  MenuPortalProps,\n  MenuContentProps,\n  MenuGroupProps,\n  MenuLabelProps,\n  MenuItemProps,\n  MenuCheckboxItemProps,\n  MenuRadioGroupProps,\n  MenuRadioItemProps,\n  MenuItemIndicatorProps,\n  MenuSeparatorProps,\n  MenuArrowProps,\n  MenuSubProps,\n  MenuSubTriggerProps,\n  MenuSubContentProps,\n} from './Menu';\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { createCollection } from '@radix-ui/react-collection';\nimport { useComposedRefs, composeRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useDirection } from '@radix-ui/react-direction';\nimport { DismissableLayer } from '@radix-ui/react-dismissable-layer';\nimport { useFocusGuards } from '@radix-ui/react-focus-guards';\nimport { FocusScope } from '@radix-ui/react-focus-scope';\nimport { useId } from '@radix-ui/react-id';\nimport * as PopperPrimitive from '@radix-ui/react-popper';\nimport { createPopperScope } from '@radix-ui/react-popper';\nimport { Portal as PortalPrimitive } from '@radix-ui/react-portal';\nimport { Presence } from '@radix-ui/react-presence';\nimport { Primitive, dispatchDiscreteCustomEvent } from '@radix-ui/react-primitive';\nimport * as RovingFocusGroup from '@radix-ui/react-roving-focus';\nimport { createRovingFocusGroupScope } from '@radix-ui/react-roving-focus';\nimport { Slot } from '@radix-ui/react-slot';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { hideOthers } from 'aria-hidden';\nimport { RemoveScroll } from 'react-remove-scroll';\n\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\n\ntype Direction = 'ltr' | 'rtl';\n\nconst SELECTION_KEYS = ['Enter', ' '];\nconst FIRST_KEYS = ['ArrowDown', 'PageUp', 'Home'];\nconst LAST_KEYS = ['ArrowUp', 'PageDown', 'End'];\nconst FIRST_LAST_KEYS = [...FIRST_KEYS, ...LAST_KEYS];\nconst SUB_OPEN_KEYS: Record<Direction, string[]> = {\n  ltr: [...SELECTION_KEYS, 'ArrowRight'],\n  rtl: [...SELECTION_KEYS, 'ArrowLeft'],\n};\nconst SUB_CLOSE_KEYS: Record<Direction, string[]> = {\n  ltr: ['ArrowLeft'],\n  rtl: ['ArrowRight'],\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Menu\n * -----------------------------------------------------------------------------------------------*/\n\nconst MENU_NAME = 'Menu';\n\ntype ItemData = { disabled: boolean; textValue: string };\nconst [Collection, useCollection, createCollectionScope] = createCollection<\n  MenuItemElement,\n  ItemData\n>(MENU_NAME);\n\ntype ScopedProps<P> = P & { __scopeMenu?: Scope };\nconst [createMenuContext, createMenuScope] = createContextScope(MENU_NAME, [\n  createCollectionScope,\n  createPopperScope,\n  createRovingFocusGroupScope,\n]);\nconst usePopperScope = createPopperScope();\nconst useRovingFocusGroupScope = createRovingFocusGroupScope();\n\ntype MenuContextValue = {\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  content: MenuContentElement | null;\n  onContentChange(content: MenuContentElement | null): void;\n};\n\nconst [MenuProvider, useMenuContext] = createMenuContext<MenuContextValue>(MENU_NAME);\n\ntype MenuRootContextValue = {\n  onClose(): void;\n  isUsingKeyboardRef: React.RefObject<boolean>;\n  dir: Direction;\n  modal: boolean;\n};\n\nconst [MenuRootProvider, useMenuRootContext] = createMenuContext<MenuRootContextValue>(MENU_NAME);\n\ninterface MenuProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  onOpenChange?(open: boolean): void;\n  dir?: Direction;\n  modal?: boolean;\n}\n\nconst Menu: React.FC<MenuProps> = (props: ScopedProps<MenuProps>) => {\n  const { __scopeMenu, open = false, children, dir, onOpenChange, modal = true } = props;\n  const popperScope = usePopperScope(__scopeMenu);\n  const [content, setContent] = React.useState<MenuContentElement | null>(null);\n  const isUsingKeyboardRef = React.useRef(false);\n  const handleOpenChange = useCallbackRef(onOpenChange);\n  const direction = useDirection(dir);\n\n  React.useEffect(() => {\n    // Capture phase ensures we set the boolean before any side effects execute\n    // in response to the key or pointer event as they might depend on this value.\n    const handleKeyDown = () => {\n      isUsingKeyboardRef.current = true;\n      document.addEventListener('pointerdown', handlePointer, { capture: true, once: true });\n      document.addEventListener('pointermove', handlePointer, { capture: true, once: true });\n    };\n    const handlePointer = () => (isUsingKeyboardRef.current = false);\n    document.addEventListener('keydown', handleKeyDown, { capture: true });\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown, { capture: true });\n      document.removeEventListener('pointerdown', handlePointer, { capture: true });\n      document.removeEventListener('pointermove', handlePointer, { capture: true });\n    };\n  }, []);\n\n  return (\n    <PopperPrimitive.Root {...popperScope}>\n      <MenuProvider\n        scope={__scopeMenu}\n        open={open}\n        onOpenChange={handleOpenChange}\n        content={content}\n        onContentChange={setContent}\n      >\n        <MenuRootProvider\n          scope={__scopeMenu}\n          onClose={React.useCallback(() => handleOpenChange(false), [handleOpenChange])}\n          isUsingKeyboardRef={isUsingKeyboardRef}\n          dir={direction}\n          modal={modal}\n        >\n          {children}\n        </MenuRootProvider>\n      </MenuProvider>\n    </PopperPrimitive.Root>\n  );\n};\n\nMenu.displayName = MENU_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuAnchor\n * -----------------------------------------------------------------------------------------------*/\n\nconst ANCHOR_NAME = 'MenuAnchor';\n\ntype MenuAnchorElement = React.ElementRef<typeof PopperPrimitive.Anchor>;\ntype PopperAnchorProps = Radix.ComponentPropsWithoutRef<typeof PopperPrimitive.Anchor>;\ninterface MenuAnchorProps extends PopperAnchorProps {}\n\nconst MenuAnchor = React.forwardRef<MenuAnchorElement, MenuAnchorProps>(\n  (props: ScopedProps<MenuAnchorProps>, forwardedRef) => {\n    const { __scopeMenu, ...anchorProps } = props;\n    const popperScope = usePopperScope(__scopeMenu);\n    return <PopperPrimitive.Anchor {...popperScope} {...anchorProps} ref={forwardedRef} />;\n  }\n);\n\nMenuAnchor.displayName = ANCHOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'MenuPortal';\n\ntype PortalContextValue = { forceMount?: true };\nconst [PortalProvider, usePortalContext] = createMenuContext<PortalContextValue>(PORTAL_NAME, {\n  forceMount: undefined,\n});\n\ntype PortalProps = React.ComponentPropsWithoutRef<typeof PortalPrimitive>;\ninterface MenuPortalProps {\n  children?: React.ReactNode;\n  /**\n   * Specify a container element to portal the content into.\n   */\n  container?: PortalProps['container'];\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst MenuPortal: React.FC<MenuPortalProps> = (props: ScopedProps<MenuPortalProps>) => {\n  const { __scopeMenu, forceMount, children, container } = props;\n  const context = useMenuContext(PORTAL_NAME, __scopeMenu);\n  return (\n    <PortalProvider scope={__scopeMenu} forceMount={forceMount}>\n      <Presence present={forceMount || context.open}>\n        <PortalPrimitive asChild container={container}>\n          {children}\n        </PortalPrimitive>\n      </Presence>\n    </PortalProvider>\n  );\n};\n\nMenuPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'MenuContent';\n\ntype MenuContentContextValue = {\n  onItemEnter(event: React.PointerEvent): void;\n  onItemLeave(event: React.PointerEvent): void;\n  onTriggerLeave(event: React.PointerEvent): void;\n  searchRef: React.RefObject<string>;\n  pointerGraceTimerRef: React.MutableRefObject<number>;\n  onPointerGraceIntentChange(intent: GraceIntent | null): void;\n};\nconst [MenuContentProvider, useMenuContentContext] =\n  createMenuContext<MenuContentContextValue>(CONTENT_NAME);\n\ntype MenuContentElement = MenuRootContentTypeElement;\n/**\n * We purposefully don't union MenuRootContent and MenuSubContent props here because\n * they have conflicting prop types. We agreed that we would allow MenuSubContent to\n * accept props that it would just ignore.\n */\ninterface MenuContentProps extends MenuRootContentTypeProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst MenuContent = React.forwardRef<MenuContentElement, MenuContentProps>(\n  (props: ScopedProps<MenuContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeMenu);\n    const { forceMount = portalContext.forceMount, ...contentProps } = props;\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, props.__scopeMenu);\n\n    return (\n      <Collection.Provider scope={props.__scopeMenu}>\n        <Presence present={forceMount || context.open}>\n          <Collection.Slot scope={props.__scopeMenu}>\n            {rootContext.modal ? (\n              <MenuRootContentModal {...contentProps} ref={forwardedRef} />\n            ) : (\n              <MenuRootContentNonModal {...contentProps} ref={forwardedRef} />\n            )}\n          </Collection.Slot>\n        </Presence>\n      </Collection.Provider>\n    );\n  }\n);\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype MenuRootContentTypeElement = MenuContentImplElement;\ninterface MenuRootContentTypeProps\n  extends Omit<MenuContentImplProps, keyof MenuContentImplPrivateProps> {}\n\nconst MenuRootContentModal = React.forwardRef<MenuRootContentTypeElement, MenuRootContentTypeProps>(\n  (props: ScopedProps<MenuRootContentTypeProps>, forwardedRef) => {\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const ref = React.useRef<MenuRootContentTypeElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n\n    // Hide everything from ARIA except the `MenuContent`\n    React.useEffect(() => {\n      const content = ref.current;\n      if (content) return hideOthers(content);\n    }, []);\n\n    return (\n      <MenuContentImpl\n        {...props}\n        ref={composedRefs}\n        // we make sure we're not trapping once it's been closed\n        // (closed !== unmounted when animating out)\n        trapFocus={context.open}\n        // make sure to only disable pointer events when open\n        // this avoids blocking interactions while animating out\n        disableOutsidePointerEvents={context.open}\n        disableOutsideScroll\n        // When focus is trapped, a `focusout` event may still happen.\n        // We make sure we don't trigger our `onDismiss` in such case.\n        onFocusOutside={composeEventHandlers(\n          props.onFocusOutside,\n          (event) => event.preventDefault(),\n          { checkForDefaultPrevented: false }\n        )}\n        onDismiss={() => context.onOpenChange(false)}\n      />\n    );\n  }\n);\n\nconst MenuRootContentNonModal = React.forwardRef<\n  MenuRootContentTypeElement,\n  MenuRootContentTypeProps\n>((props: ScopedProps<MenuRootContentTypeProps>, forwardedRef) => {\n  const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n  return (\n    <MenuContentImpl\n      {...props}\n      ref={forwardedRef}\n      trapFocus={false}\n      disableOutsidePointerEvents={false}\n      disableOutsideScroll={false}\n      onDismiss={() => context.onOpenChange(false)}\n    />\n  );\n});\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype MenuContentImplElement = React.ElementRef<typeof PopperPrimitive.Content>;\ntype FocusScopeProps = Radix.ComponentPropsWithoutRef<typeof FocusScope>;\ntype DismissableLayerProps = Radix.ComponentPropsWithoutRef<typeof DismissableLayer>;\ntype RovingFocusGroupProps = Radix.ComponentPropsWithoutRef<typeof RovingFocusGroup.Root>;\ntype PopperContentProps = Radix.ComponentPropsWithoutRef<typeof PopperPrimitive.Content>;\ntype MenuContentImplPrivateProps = {\n  onOpenAutoFocus?: FocusScopeProps['onMountAutoFocus'];\n  onDismiss?: DismissableLayerProps['onDismiss'];\n  disableOutsidePointerEvents?: DismissableLayerProps['disableOutsidePointerEvents'];\n\n  /**\n   * Whether scrolling outside the `MenuContent` should be prevented\n   * (default: `false`)\n   */\n  disableOutsideScroll?: boolean;\n\n  /**\n   * Whether focus should be trapped within the `MenuContent`\n   * (default: false)\n   */\n  trapFocus?: FocusScopeProps['trapped'];\n};\ninterface MenuContentImplProps\n  extends MenuContentImplPrivateProps,\n    Omit<PopperContentProps, 'dir' | 'onPlaced'> {\n  /**\n   * Event handler called when auto-focusing on close.\n   * Can be prevented.\n   */\n  onCloseAutoFocus?: FocusScopeProps['onUnmountAutoFocus'];\n\n  /**\n   * Whether keyboard navigation should loop around\n   * @defaultValue false\n   */\n  loop?: RovingFocusGroupProps['loop'];\n\n  onEntryFocus?: RovingFocusGroupProps['onEntryFocus'];\n  onEscapeKeyDown?: DismissableLayerProps['onEscapeKeyDown'];\n  onPointerDownOutside?: DismissableLayerProps['onPointerDownOutside'];\n  onFocusOutside?: DismissableLayerProps['onFocusOutside'];\n  onInteractOutside?: DismissableLayerProps['onInteractOutside'];\n}\n\nconst MenuContentImpl = React.forwardRef<MenuContentImplElement, MenuContentImplProps>(\n  (props: ScopedProps<MenuContentImplProps>, forwardedRef) => {\n    const {\n      __scopeMenu,\n      loop = false,\n      trapFocus,\n      onOpenAutoFocus,\n      onCloseAutoFocus,\n      disableOutsidePointerEvents,\n      onEntryFocus,\n      onEscapeKeyDown,\n      onPointerDownOutside,\n      onFocusOutside,\n      onInteractOutside,\n      onDismiss,\n      disableOutsideScroll,\n      ...contentProps\n    } = props;\n    const context = useMenuContext(CONTENT_NAME, __scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, __scopeMenu);\n    const popperScope = usePopperScope(__scopeMenu);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenu);\n    const getItems = useCollection(__scopeMenu);\n    const [currentItemId, setCurrentItemId] = React.useState<string | null>(null);\n    const contentRef = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef, context.onContentChange);\n    const timerRef = React.useRef(0);\n    const searchRef = React.useRef('');\n    const pointerGraceTimerRef = React.useRef(0);\n    const pointerGraceIntentRef = React.useRef<GraceIntent | null>(null);\n    const pointerDirRef = React.useRef<Side>('right');\n    const lastPointerXRef = React.useRef(0);\n\n    const ScrollLockWrapper = disableOutsideScroll ? RemoveScroll : React.Fragment;\n    const scrollLockWrapperProps = disableOutsideScroll\n      ? { as: Slot, allowPinchZoom: true }\n      : undefined;\n\n    const handleTypeaheadSearch = (key: string) => {\n      const search = searchRef.current + key;\n      const items = getItems().filter((item) => !item.disabled);\n      const currentItem = document.activeElement;\n      const currentMatch = items.find((item) => item.ref.current === currentItem)?.textValue;\n      const values = items.map((item) => item.textValue);\n      const nextMatch = getNextMatch(values, search, currentMatch);\n      const newItem = items.find((item) => item.textValue === nextMatch)?.ref.current;\n\n      // Reset `searchRef` 1 second after it was last updated\n      (function updateSearch(value: string) {\n        searchRef.current = value;\n        window.clearTimeout(timerRef.current);\n        if (value !== '') timerRef.current = window.setTimeout(() => updateSearch(''), 1000);\n      })(search);\n\n      if (newItem) {\n        /**\n         * Imperative focus during keydown is risky so we prevent React's batching updates\n         * to avoid potential bugs. See: https://github.com/facebook/react/issues/20332\n         */\n        setTimeout(() => (newItem as HTMLElement).focus());\n      }\n    };\n\n    React.useEffect(() => {\n      return () => window.clearTimeout(timerRef.current);\n    }, []);\n\n    // Make sure the whole tree has focus guards as our `MenuContent` may be\n    // the last element in the DOM (beacuse of the `Portal`)\n    useFocusGuards();\n\n    const isPointerMovingToSubmenu = React.useCallback((event: React.PointerEvent) => {\n      const isMovingTowards = pointerDirRef.current === pointerGraceIntentRef.current?.side;\n      return isMovingTowards && isPointerInGraceArea(event, pointerGraceIntentRef.current?.area);\n    }, []);\n\n    return (\n      <MenuContentProvider\n        scope={__scopeMenu}\n        searchRef={searchRef}\n        onItemEnter={React.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) event.preventDefault();\n          },\n          [isPointerMovingToSubmenu]\n        )}\n        onItemLeave={React.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) return;\n            contentRef.current?.focus();\n            setCurrentItemId(null);\n          },\n          [isPointerMovingToSubmenu]\n        )}\n        onTriggerLeave={React.useCallback(\n          (event) => {\n            if (isPointerMovingToSubmenu(event)) event.preventDefault();\n          },\n          [isPointerMovingToSubmenu]\n        )}\n        pointerGraceTimerRef={pointerGraceTimerRef}\n        onPointerGraceIntentChange={React.useCallback((intent) => {\n          pointerGraceIntentRef.current = intent;\n        }, [])}\n      >\n        <ScrollLockWrapper {...scrollLockWrapperProps}>\n          <FocusScope\n            asChild\n            trapped={trapFocus}\n            onMountAutoFocus={composeEventHandlers(onOpenAutoFocus, (event) => {\n              // when opening, explicitly focus the content area only and leave\n              // `onEntryFocus` in  control of focusing first item\n              event.preventDefault();\n              contentRef.current?.focus();\n            })}\n            onUnmountAutoFocus={onCloseAutoFocus}\n          >\n            <DismissableLayer\n              asChild\n              disableOutsidePointerEvents={disableOutsidePointerEvents}\n              onEscapeKeyDown={onEscapeKeyDown}\n              onPointerDownOutside={onPointerDownOutside}\n              onFocusOutside={onFocusOutside}\n              onInteractOutside={onInteractOutside}\n              onDismiss={onDismiss}\n            >\n              <RovingFocusGroup.Root\n                asChild\n                {...rovingFocusGroupScope}\n                dir={rootContext.dir}\n                orientation=\"vertical\"\n                loop={loop}\n                currentTabStopId={currentItemId}\n                onCurrentTabStopIdChange={setCurrentItemId}\n                onEntryFocus={composeEventHandlers(onEntryFocus, (event) => {\n                  // only focus first item when using keyboard\n                  if (!rootContext.isUsingKeyboardRef.current) event.preventDefault();\n                })}\n              >\n                <PopperPrimitive.Content\n                  role=\"menu\"\n                  aria-orientation=\"vertical\"\n                  data-state={getOpenState(context.open)}\n                  data-radix-menu-content=\"\"\n                  dir={rootContext.dir}\n                  {...popperScope}\n                  {...contentProps}\n                  ref={composedRefs}\n                  style={{ outline: 'none', ...contentProps.style }}\n                  onKeyDown={composeEventHandlers(contentProps.onKeyDown, (event) => {\n                    // submenu key events bubble through portals. We only care about keys in this menu.\n                    const target = event.target as HTMLElement;\n                    const isKeyDownInside =\n                      target.closest('[data-radix-menu-content]') === event.currentTarget;\n                    const isModifierKey = event.ctrlKey || event.altKey || event.metaKey;\n                    const isCharacterKey = event.key.length === 1;\n                    if (isKeyDownInside) {\n                      // menus should not be navigated using tab key so we prevent it\n                      if (event.key === 'Tab') event.preventDefault();\n                      if (!isModifierKey && isCharacterKey) handleTypeaheadSearch(event.key);\n                    }\n                    // focus first/last item based on key pressed\n                    const content = contentRef.current;\n                    if (event.target !== content) return;\n                    if (!FIRST_LAST_KEYS.includes(event.key)) return;\n                    event.preventDefault();\n                    const items = getItems().filter((item) => !item.disabled);\n                    const candidateNodes = items.map((item) => item.ref.current!);\n                    if (LAST_KEYS.includes(event.key)) candidateNodes.reverse();\n                    focusFirst(candidateNodes);\n                  })}\n                  onBlur={composeEventHandlers(props.onBlur, (event) => {\n                    // clear search buffer when leaving the menu\n                    if (!event.currentTarget.contains(event.target)) {\n                      window.clearTimeout(timerRef.current);\n                      searchRef.current = '';\n                    }\n                  })}\n                  onPointerMove={composeEventHandlers(\n                    props.onPointerMove,\n                    whenMouse((event) => {\n                      const target = event.target as HTMLElement;\n                      const pointerXHasChanged = lastPointerXRef.current !== event.clientX;\n\n                      // We don't use `event.movementX` for this check because Safari will\n                      // always return `0` on a pointer event.\n                      if (event.currentTarget.contains(target) && pointerXHasChanged) {\n                        const newDir = event.clientX > lastPointerXRef.current ? 'right' : 'left';\n                        pointerDirRef.current = newDir;\n                        lastPointerXRef.current = event.clientX;\n                      }\n                    })\n                  )}\n                />\n              </RovingFocusGroup.Root>\n            </DismissableLayer>\n          </FocusScope>\n        </ScrollLockWrapper>\n      </MenuContentProvider>\n    );\n  }\n);\n\nMenuContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst GROUP_NAME = 'MenuGroup';\n\ntype MenuGroupElement = React.ElementRef<typeof Primitive.div>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ninterface MenuGroupProps extends PrimitiveDivProps {}\n\nconst MenuGroup = React.forwardRef<MenuGroupElement, MenuGroupProps>(\n  (props: ScopedProps<MenuGroupProps>, forwardedRef) => {\n    const { __scopeMenu, ...groupProps } = props;\n    return <Primitive.div role=\"group\" {...groupProps} ref={forwardedRef} />;\n  }\n);\n\nMenuGroup.displayName = GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuLabel\n * -----------------------------------------------------------------------------------------------*/\n\nconst LABEL_NAME = 'MenuLabel';\n\ntype MenuLabelElement = React.ElementRef<typeof Primitive.div>;\ninterface MenuLabelProps extends PrimitiveDivProps {}\n\nconst MenuLabel = React.forwardRef<MenuLabelElement, MenuLabelProps>(\n  (props: ScopedProps<MenuLabelProps>, forwardedRef) => {\n    const { __scopeMenu, ...labelProps } = props;\n    return <Primitive.div {...labelProps} ref={forwardedRef} />;\n  }\n);\n\nMenuLabel.displayName = LABEL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_NAME = 'MenuItem';\nconst ITEM_SELECT = 'menu.itemSelect';\n\ntype MenuItemElement = MenuItemImplElement;\ninterface MenuItemProps extends Omit<MenuItemImplProps, 'onSelect'> {\n  onSelect?: (event: Event) => void;\n}\n\nconst MenuItem = React.forwardRef<MenuItemElement, MenuItemProps>(\n  (props: ScopedProps<MenuItemProps>, forwardedRef) => {\n    const { disabled = false, onSelect, ...itemProps } = props;\n    const ref = React.useRef<HTMLDivElement>(null);\n    const rootContext = useMenuRootContext(ITEM_NAME, props.__scopeMenu);\n    const contentContext = useMenuContentContext(ITEM_NAME, props.__scopeMenu);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const isPointerDownRef = React.useRef(false);\n\n    const handleSelect = () => {\n      const menuItem = ref.current;\n      if (!disabled && menuItem) {\n        const itemSelectEvent = new CustomEvent(ITEM_SELECT, { bubbles: true, cancelable: true });\n        menuItem.addEventListener(ITEM_SELECT, (event) => onSelect?.(event), { once: true });\n        dispatchDiscreteCustomEvent(menuItem, itemSelectEvent);\n        if (itemSelectEvent.defaultPrevented) {\n          isPointerDownRef.current = false;\n        } else {\n          rootContext.onClose();\n        }\n      }\n    };\n\n    return (\n      <MenuItemImpl\n        {...itemProps}\n        ref={composedRefs}\n        disabled={disabled}\n        onClick={composeEventHandlers(props.onClick, handleSelect)}\n        onPointerDown={(event) => {\n          props.onPointerDown?.(event);\n          isPointerDownRef.current = true;\n        }}\n        onPointerUp={composeEventHandlers(props.onPointerUp, (event) => {\n          // Pointer down can move to a different menu item which should activate it on pointer up.\n          // We dispatch a click for selection to allow composition with click based triggers and to\n          // prevent Firefox from getting stuck in text selection mode when the menu closes.\n          if (!isPointerDownRef.current) event.currentTarget?.click();\n        })}\n        onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n          const isTypingAhead = contentContext.searchRef.current !== '';\n          if (disabled || (isTypingAhead && event.key === ' ')) return;\n          if (SELECTION_KEYS.includes(event.key)) {\n            event.currentTarget.click();\n            /**\n             * We prevent default browser behaviour for selection keys as they should trigger\n             * a selection only:\n             * - prevents space from scrolling the page.\n             * - if keydown causes focus to move, prevents keydown from firing on the new target.\n             */\n            event.preventDefault();\n          }\n        })}\n      />\n    );\n  }\n);\n\nMenuItem.displayName = ITEM_NAME;\n\n/* ---------------------------------------------------------------------------------------------- */\n\ntype MenuItemImplElement = React.ElementRef<typeof Primitive.div>;\ninterface MenuItemImplProps extends PrimitiveDivProps {\n  disabled?: boolean;\n  textValue?: string;\n}\n\nconst MenuItemImpl = React.forwardRef<MenuItemImplElement, MenuItemImplProps>(\n  (props: ScopedProps<MenuItemImplProps>, forwardedRef) => {\n    const { __scopeMenu, disabled = false, textValue, ...itemProps } = props;\n    const contentContext = useMenuContentContext(ITEM_NAME, __scopeMenu);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeMenu);\n    const ref = React.useRef<HTMLDivElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const [isFocused, setIsFocused] = React.useState(false);\n\n    // get the item's `.textContent` as default strategy for typeahead `textValue`\n    const [textContent, setTextContent] = React.useState('');\n    React.useEffect(() => {\n      const menuItem = ref.current;\n      if (menuItem) {\n        setTextContent((menuItem.textContent ?? '').trim());\n      }\n    }, [itemProps.children]);\n\n    return (\n      <Collection.ItemSlot\n        scope={__scopeMenu}\n        disabled={disabled}\n        textValue={textValue ?? textContent}\n      >\n        <RovingFocusGroup.Item asChild {...rovingFocusGroupScope} focusable={!disabled}>\n          <Primitive.div\n            role=\"menuitem\"\n            data-highlighted={isFocused ? '' : undefined}\n            aria-disabled={disabled || undefined}\n            data-disabled={disabled ? '' : undefined}\n            {...itemProps}\n            ref={composedRefs}\n            /**\n             * We focus items on `pointerMove` to achieve the following:\n             *\n             * - Mouse over an item (it focuses)\n             * - Leave mouse where it is and use keyboard to focus a different item\n             * - Wiggle mouse without it leaving previously focused item\n             * - Previously focused item should re-focus\n             *\n             * If we used `mouseOver`/`mouseEnter` it would not re-focus when the mouse\n             * wiggles. This is to match native menu implementation.\n             */\n            onPointerMove={composeEventHandlers(\n              props.onPointerMove,\n              whenMouse((event) => {\n                if (disabled) {\n                  contentContext.onItemLeave(event);\n                } else {\n                  contentContext.onItemEnter(event);\n                  if (!event.defaultPrevented) {\n                    const item = event.currentTarget;\n                    item.focus();\n                  }\n                }\n              })\n            )}\n            onPointerLeave={composeEventHandlers(\n              props.onPointerLeave,\n              whenMouse((event) => contentContext.onItemLeave(event))\n            )}\n            onFocus={composeEventHandlers(props.onFocus, () => setIsFocused(true))}\n            onBlur={composeEventHandlers(props.onBlur, () => setIsFocused(false))}\n          />\n        </RovingFocusGroup.Item>\n      </Collection.ItemSlot>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * MenuCheckboxItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst CHECKBOX_ITEM_NAME = 'MenuCheckboxItem';\n\ntype MenuCheckboxItemElement = MenuItemElement;\n\ntype CheckedState = boolean | 'indeterminate';\n\ninterface MenuCheckboxItemProps extends MenuItemProps {\n  checked?: CheckedState;\n  // `onCheckedChange` can never be called with `\"indeterminate\"` from the inside\n  onCheckedChange?: (checked: boolean) => void;\n}\n\nconst MenuCheckboxItem = React.forwardRef<MenuCheckboxItemElement, MenuCheckboxItemProps>(\n  (props: ScopedProps<MenuCheckboxItemProps>, forwardedRef) => {\n    const { checked = false, onCheckedChange, ...checkboxItemProps } = props;\n    return (\n      <ItemIndicatorProvider scope={props.__scopeMenu} checked={checked}>\n        <MenuItem\n          role=\"menuitemcheckbox\"\n          aria-checked={isIndeterminate(checked) ? 'mixed' : checked}\n          {...checkboxItemProps}\n          ref={forwardedRef}\n          data-state={getCheckedState(checked)}\n          onSelect={composeEventHandlers(\n            checkboxItemProps.onSelect,\n            () => onCheckedChange?.(isIndeterminate(checked) ? true : !checked),\n            { checkForDefaultPrevented: false }\n          )}\n        />\n      </ItemIndicatorProvider>\n    );\n  }\n);\n\nMenuCheckboxItem.displayName = CHECKBOX_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuRadioGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_GROUP_NAME = 'MenuRadioGroup';\n\nconst [RadioGroupProvider, useRadioGroupContext] = createMenuContext<MenuRadioGroupProps>(\n  RADIO_GROUP_NAME,\n  { value: undefined, onValueChange: () => {} }\n);\n\ntype MenuRadioGroupElement = React.ElementRef<typeof MenuGroup>;\ninterface MenuRadioGroupProps extends MenuGroupProps {\n  value?: string;\n  onValueChange?: (value: string) => void;\n}\n\nconst MenuRadioGroup = React.forwardRef<MenuRadioGroupElement, MenuRadioGroupProps>(\n  (props: ScopedProps<MenuRadioGroupProps>, forwardedRef) => {\n    const { value, onValueChange, ...groupProps } = props;\n    const handleValueChange = useCallbackRef(onValueChange);\n    return (\n      <RadioGroupProvider scope={props.__scopeMenu} value={value} onValueChange={handleValueChange}>\n        <MenuGroup {...groupProps} ref={forwardedRef} />\n      </RadioGroupProvider>\n    );\n  }\n);\n\nMenuRadioGroup.displayName = RADIO_GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuRadioItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_ITEM_NAME = 'MenuRadioItem';\n\ntype MenuRadioItemElement = React.ElementRef<typeof MenuItem>;\ninterface MenuRadioItemProps extends MenuItemProps {\n  value: string;\n}\n\nconst MenuRadioItem = React.forwardRef<MenuRadioItemElement, MenuRadioItemProps>(\n  (props: ScopedProps<MenuRadioItemProps>, forwardedRef) => {\n    const { value, ...radioItemProps } = props;\n    const context = useRadioGroupContext(RADIO_ITEM_NAME, props.__scopeMenu);\n    const checked = value === context.value;\n    return (\n      <ItemIndicatorProvider scope={props.__scopeMenu} checked={checked}>\n        <MenuItem\n          role=\"menuitemradio\"\n          aria-checked={checked}\n          {...radioItemProps}\n          ref={forwardedRef}\n          data-state={getCheckedState(checked)}\n          onSelect={composeEventHandlers(\n            radioItemProps.onSelect,\n            () => context.onValueChange?.(value),\n            { checkForDefaultPrevented: false }\n          )}\n        />\n      </ItemIndicatorProvider>\n    );\n  }\n);\n\nMenuRadioItem.displayName = RADIO_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuItemIndicator\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_INDICATOR_NAME = 'MenuItemIndicator';\n\ntype CheckboxContextValue = { checked: CheckedState };\n\nconst [ItemIndicatorProvider, useItemIndicatorContext] = createMenuContext<CheckboxContextValue>(\n  ITEM_INDICATOR_NAME,\n  { checked: false }\n);\n\ntype MenuItemIndicatorElement = React.ElementRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = Radix.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface MenuItemIndicatorProps extends PrimitiveSpanProps {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst MenuItemIndicator = React.forwardRef<MenuItemIndicatorElement, MenuItemIndicatorProps>(\n  (props: ScopedProps<MenuItemIndicatorProps>, forwardedRef) => {\n    const { __scopeMenu, forceMount, ...itemIndicatorProps } = props;\n    const indicatorContext = useItemIndicatorContext(ITEM_INDICATOR_NAME, __scopeMenu);\n    return (\n      <Presence\n        present={\n          forceMount ||\n          isIndeterminate(indicatorContext.checked) ||\n          indicatorContext.checked === true\n        }\n      >\n        <Primitive.span\n          {...itemIndicatorProps}\n          ref={forwardedRef}\n          data-state={getCheckedState(indicatorContext.checked)}\n        />\n      </Presence>\n    );\n  }\n);\n\nMenuItemIndicator.displayName = ITEM_INDICATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuSeparator\n * -----------------------------------------------------------------------------------------------*/\n\nconst SEPARATOR_NAME = 'MenuSeparator';\n\ntype MenuSeparatorElement = React.ElementRef<typeof Primitive.div>;\ninterface MenuSeparatorProps extends PrimitiveDivProps {}\n\nconst MenuSeparator = React.forwardRef<MenuSeparatorElement, MenuSeparatorProps>(\n  (props: ScopedProps<MenuSeparatorProps>, forwardedRef) => {\n    const { __scopeMenu, ...separatorProps } = props;\n    return (\n      <Primitive.div\n        role=\"separator\"\n        aria-orientation=\"horizontal\"\n        {...separatorProps}\n        ref={forwardedRef}\n      />\n    );\n  }\n);\n\nMenuSeparator.displayName = SEPARATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'MenuArrow';\n\ntype MenuArrowElement = React.ElementRef<typeof PopperPrimitive.Arrow>;\ntype PopperArrowProps = Radix.ComponentPropsWithoutRef<typeof PopperPrimitive.Arrow>;\ninterface MenuArrowProps extends PopperArrowProps {}\n\nconst MenuArrow = React.forwardRef<MenuArrowElement, MenuArrowProps>(\n  (props: ScopedProps<MenuArrowProps>, forwardedRef) => {\n    const { __scopeMenu, ...arrowProps } = props;\n    const popperScope = usePopperScope(__scopeMenu);\n    return <PopperPrimitive.Arrow {...popperScope} {...arrowProps} ref={forwardedRef} />;\n  }\n);\n\nMenuArrow.displayName = ARROW_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuSub\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_NAME = 'MenuSub';\n\ntype MenuSubContextValue = {\n  contentId: string;\n  triggerId: string;\n  trigger: MenuSubTriggerElement | null;\n  onTriggerChange(trigger: MenuSubTriggerElement | null): void;\n};\n\nconst [MenuSubProvider, useMenuSubContext] = createMenuContext<MenuSubContextValue>(SUB_NAME);\n\ninterface MenuSubProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  onOpenChange?(open: boolean): void;\n}\n\nconst MenuSub: React.FC<MenuSubProps> = (props: ScopedProps<MenuSubProps>) => {\n  const { __scopeMenu, children, open = false, onOpenChange } = props;\n  const parentMenuContext = useMenuContext(SUB_NAME, __scopeMenu);\n  const popperScope = usePopperScope(__scopeMenu);\n  const [trigger, setTrigger] = React.useState<MenuSubTriggerElement | null>(null);\n  const [content, setContent] = React.useState<MenuContentElement | null>(null);\n  const handleOpenChange = useCallbackRef(onOpenChange);\n\n  // Prevent the parent menu from reopening with open submenus.\n  React.useEffect(() => {\n    if (parentMenuContext.open === false) handleOpenChange(false);\n    return () => handleOpenChange(false);\n  }, [parentMenuContext.open, handleOpenChange]);\n\n  return (\n    <PopperPrimitive.Root {...popperScope}>\n      <MenuProvider\n        scope={__scopeMenu}\n        open={open}\n        onOpenChange={handleOpenChange}\n        content={content}\n        onContentChange={setContent}\n      >\n        <MenuSubProvider\n          scope={__scopeMenu}\n          contentId={useId()}\n          triggerId={useId()}\n          trigger={trigger}\n          onTriggerChange={setTrigger}\n        >\n          {children}\n        </MenuSubProvider>\n      </MenuProvider>\n    </PopperPrimitive.Root>\n  );\n};\n\nMenuSub.displayName = SUB_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuSubTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_TRIGGER_NAME = 'MenuSubTrigger';\n\ntype MenuSubTriggerElement = MenuItemImplElement;\ninterface MenuSubTriggerProps extends MenuItemImplProps {}\n\nconst MenuSubTrigger = React.forwardRef<MenuSubTriggerElement, MenuSubTriggerProps>(\n  (props: ScopedProps<MenuSubTriggerProps>, forwardedRef) => {\n    const context = useMenuContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const subContext = useMenuSubContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const contentContext = useMenuContentContext(SUB_TRIGGER_NAME, props.__scopeMenu);\n    const openTimerRef = React.useRef<number | null>(null);\n    const { pointerGraceTimerRef, onPointerGraceIntentChange } = contentContext;\n    const scope = { __scopeMenu: props.__scopeMenu };\n\n    const clearOpenTimer = React.useCallback(() => {\n      if (openTimerRef.current) window.clearTimeout(openTimerRef.current);\n      openTimerRef.current = null;\n    }, []);\n\n    React.useEffect(() => clearOpenTimer, [clearOpenTimer]);\n\n    React.useEffect(() => {\n      const pointerGraceTimer = pointerGraceTimerRef.current;\n      return () => {\n        window.clearTimeout(pointerGraceTimer);\n        onPointerGraceIntentChange(null);\n      };\n    }, [pointerGraceTimerRef, onPointerGraceIntentChange]);\n\n    return (\n      <MenuAnchor asChild {...scope}>\n        <MenuItemImpl\n          id={subContext.triggerId}\n          aria-haspopup=\"menu\"\n          aria-expanded={context.open}\n          aria-controls={subContext.contentId}\n          data-state={getOpenState(context.open)}\n          {...props}\n          ref={composeRefs(forwardedRef, subContext.onTriggerChange)}\n          // This is redundant for mouse users but we cannot determine pointer type from\n          // click event and we cannot use pointerup event (see git history for reasons why)\n          onClick={(event) => {\n            props.onClick?.(event);\n            if (props.disabled || event.defaultPrevented) return;\n            /**\n             * We manually focus because iOS Safari doesn't always focus on click (e.g. buttons)\n             * and we rely heavily on `onFocusOutside` for submenus to close when switching\n             * between separate submenus.\n             */\n            event.currentTarget.focus();\n            if (!context.open) context.onOpenChange(true);\n          }}\n          onPointerMove={composeEventHandlers(\n            props.onPointerMove,\n            whenMouse((event) => {\n              contentContext.onItemEnter(event);\n              if (event.defaultPrevented) return;\n              if (!props.disabled && !context.open && !openTimerRef.current) {\n                contentContext.onPointerGraceIntentChange(null);\n                openTimerRef.current = window.setTimeout(() => {\n                  context.onOpenChange(true);\n                  clearOpenTimer();\n                }, 100);\n              }\n            })\n          )}\n          onPointerLeave={composeEventHandlers(\n            props.onPointerLeave,\n            whenMouse((event) => {\n              clearOpenTimer();\n\n              const contentRect = context.content?.getBoundingClientRect();\n              if (contentRect) {\n                // TODO: make sure to update this when we change positioning logic\n                const side = context.content?.dataset.side as Side;\n                const rightSide = side === 'right';\n                const bleed = rightSide ? -5 : +5;\n                const contentNearEdge = contentRect[rightSide ? 'left' : 'right'];\n                const contentFarEdge = contentRect[rightSide ? 'right' : 'left'];\n\n                contentContext.onPointerGraceIntentChange({\n                  area: [\n                    // Apply a bleed on clientX to ensure that our exit point is\n                    // consistently within polygon bounds\n                    { x: event.clientX + bleed, y: event.clientY },\n                    { x: contentNearEdge, y: contentRect.top },\n                    { x: contentFarEdge, y: contentRect.top },\n                    { x: contentFarEdge, y: contentRect.bottom },\n                    { x: contentNearEdge, y: contentRect.bottom },\n                  ],\n                  side,\n                });\n\n                window.clearTimeout(pointerGraceTimerRef.current);\n                pointerGraceTimerRef.current = window.setTimeout(\n                  () => contentContext.onPointerGraceIntentChange(null),\n                  300\n                );\n              } else {\n                contentContext.onTriggerLeave(event);\n                if (event.defaultPrevented) return;\n\n                // There's 100ms where the user may leave an item before the submenu was opened.\n                contentContext.onPointerGraceIntentChange(null);\n              }\n            })\n          )}\n          onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n            const isTypingAhead = contentContext.searchRef.current !== '';\n            if (props.disabled || (isTypingAhead && event.key === ' ')) return;\n            if (SUB_OPEN_KEYS[rootContext.dir].includes(event.key)) {\n              context.onOpenChange(true);\n              // The trigger may hold focus if opened via pointer interaction\n              // so we ensure content is given focus again when switching to keyboard.\n              context.content?.focus();\n              // prevent window from scrolling\n              event.preventDefault();\n            }\n          })}\n        />\n      </MenuAnchor>\n    );\n  }\n);\n\nMenuSubTrigger.displayName = SUB_TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * MenuSubContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_CONTENT_NAME = 'MenuSubContent';\n\ntype MenuSubContentElement = MenuContentImplElement;\ninterface MenuSubContentProps\n  extends Omit<\n    MenuContentImplProps,\n    keyof MenuContentImplPrivateProps | 'onCloseAutoFocus' | 'onEntryFocus' | 'side' | 'align'\n  > {\n  /**\n   * Used to force mounting when more control is needed. Useful when\n   * controlling animation with React animation libraries.\n   */\n  forceMount?: true;\n}\n\nconst MenuSubContent = React.forwardRef<MenuSubContentElement, MenuSubContentProps>(\n  (props: ScopedProps<MenuSubContentProps>, forwardedRef) => {\n    const portalContext = usePortalContext(CONTENT_NAME, props.__scopeMenu);\n    const { forceMount = portalContext.forceMount, ...subContentProps } = props;\n    const context = useMenuContext(CONTENT_NAME, props.__scopeMenu);\n    const rootContext = useMenuRootContext(CONTENT_NAME, props.__scopeMenu);\n    const subContext = useMenuSubContext(SUB_CONTENT_NAME, props.__scopeMenu);\n    const ref = React.useRef<MenuSubContentElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    return (\n      <Collection.Provider scope={props.__scopeMenu}>\n        <Presence present={forceMount || context.open}>\n          <Collection.Slot scope={props.__scopeMenu}>\n            <MenuContentImpl\n              id={subContext.contentId}\n              aria-labelledby={subContext.triggerId}\n              {...subContentProps}\n              ref={composedRefs}\n              align=\"start\"\n              side={rootContext.dir === 'rtl' ? 'left' : 'right'}\n              disableOutsidePointerEvents={false}\n              disableOutsideScroll={false}\n              trapFocus={false}\n              onOpenAutoFocus={(event) => {\n                // when opening a submenu, focus content for keyboard users only\n                if (rootContext.isUsingKeyboardRef.current) ref.current?.focus();\n                event.preventDefault();\n              }}\n              // The menu might close because of focusing another menu item in the parent menu. We\n              // don't want it to refocus the trigger in that case so we handle trigger focus ourselves.\n              onCloseAutoFocus={(event) => event.preventDefault()}\n              onFocusOutside={composeEventHandlers(props.onFocusOutside, (event) => {\n                // We prevent closing when the trigger is focused to avoid triggering a re-open animation\n                // on pointer interaction.\n                if (event.target !== subContext.trigger) context.onOpenChange(false);\n              })}\n              onEscapeKeyDown={composeEventHandlers(props.onEscapeKeyDown, (event) => {\n                rootContext.onClose();\n                // ensure pressing escape in submenu doesn't escape full screen mode\n                event.preventDefault();\n              })}\n              onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n                // Submenu key events bubble through portals. We only care about keys in this menu.\n                const isKeyDownInside = event.currentTarget.contains(event.target as HTMLElement);\n                const isCloseKey = SUB_CLOSE_KEYS[rootContext.dir].includes(event.key);\n                if (isKeyDownInside && isCloseKey) {\n                  context.onOpenChange(false);\n                  // We focus manually because we prevented it in `onCloseAutoFocus`\n                  subContext.trigger?.focus();\n                  // prevent window from scrolling\n                  event.preventDefault();\n                }\n              })}\n            />\n          </Collection.Slot>\n        </Presence>\n      </Collection.Provider>\n    );\n  }\n);\n\nMenuSubContent.displayName = SUB_CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction getOpenState(open: boolean) {\n  return open ? 'open' : 'closed';\n}\n\nfunction isIndeterminate(checked?: CheckedState): checked is 'indeterminate' {\n  return checked === 'indeterminate';\n}\n\nfunction getCheckedState(checked: CheckedState) {\n  return isIndeterminate(checked) ? 'indeterminate' : checked ? 'checked' : 'unchecked';\n}\n\nfunction focusFirst(candidates: HTMLElement[]) {\n  const PREVIOUSLY_FOCUSED_ELEMENT = document.activeElement;\n  for (const candidate of candidates) {\n    // if focus is already where we want to go, we don't want to keep going through the candidates\n    if (candidate === PREVIOUSLY_FOCUSED_ELEMENT) return;\n    candidate.focus();\n    if (document.activeElement !== PREVIOUSLY_FOCUSED_ELEMENT) return;\n  }\n}\n\n/**\n * Wraps an array around itself at a given start index\n * Example: `wrapArray(['a', 'b', 'c', 'd'], 2) === ['c', 'd', 'a', 'b']`\n */\nfunction wrapArray<T>(array: T[], startIndex: number) {\n  return array.map((_, index) => array[(startIndex + index) % array.length]);\n}\n\n/**\n * This is the \"meat\" of the typeahead matching logic. It takes in all the values,\n * the search and the current match, and returns the next match (or `undefined`).\n *\n * We normalize the search because if a user has repeatedly pressed a character,\n * we want the exact same behavior as if we only had that one character\n * (ie. cycle through options starting with that character)\n *\n * We also reorder the values by wrapping the array around the current match.\n * This is so we always look forward from the current match, and picking the first\n * match will always be the correct one.\n *\n * Finally, if the normalized search is exactly one character, we exclude the\n * current match from the values because otherwise it would be the first to match always\n * and focus would never move. This is as opposed to the regular case, where we\n * don't want focus to move if the current match still matches.\n */\nfunction getNextMatch(values: string[], search: string, currentMatch?: string) {\n  const isRepeated = search.length > 1 && Array.from(search).every((char) => char === search[0]);\n  const normalizedSearch = isRepeated ? search[0] : search;\n  const currentMatchIndex = currentMatch ? values.indexOf(currentMatch) : -1;\n  let wrappedValues = wrapArray(values, Math.max(currentMatchIndex, 0));\n  const excludeCurrentMatch = normalizedSearch.length === 1;\n  if (excludeCurrentMatch) wrappedValues = wrappedValues.filter((v) => v !== currentMatch);\n  const nextMatch = wrappedValues.find((value) =>\n    value.toLowerCase().startsWith(normalizedSearch.toLowerCase())\n  );\n  return nextMatch !== currentMatch ? nextMatch : undefined;\n}\n\ntype Point = { x: number; y: number };\ntype Polygon = Point[];\ntype Side = 'left' | 'right';\ntype GraceIntent = { area: Polygon; side: Side };\n\n// Determine if a point is inside of a polygon.\n// Based on https://github.com/substack/point-in-polygon\nfunction isPointInPolygon(point: Point, polygon: Polygon) {\n  const { x, y } = point;\n  let inside = false;\n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n    const xi = polygon[i].x;\n    const yi = polygon[i].y;\n    const xj = polygon[j].x;\n    const yj = polygon[j].y;\n\n    // prettier-ignore\n    const intersect = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n    if (intersect) inside = !inside;\n  }\n\n  return inside;\n}\n\nfunction isPointerInGraceArea(event: React.PointerEvent, area?: Polygon) {\n  if (!area) return false;\n  const cursorPos = { x: event.clientX, y: event.clientY };\n  return isPointInPolygon(cursorPos, area);\n}\n\nfunction whenMouse<E>(handler: React.PointerEventHandler<E>): React.PointerEventHandler<E> {\n  return (event) => (event.pointerType === 'mouse' ? handler(event) : undefined);\n}\n\nconst Root = Menu;\nconst Anchor = MenuAnchor;\nconst Portal = MenuPortal;\nconst Content = MenuContent;\nconst Group = MenuGroup;\nconst Label = MenuLabel;\nconst Item = MenuItem;\nconst CheckboxItem = MenuCheckboxItem;\nconst RadioGroup = MenuRadioGroup;\nconst RadioItem = MenuRadioItem;\nconst ItemIndicator = MenuItemIndicator;\nconst Separator = MenuSeparator;\nconst Arrow = MenuArrow;\nconst Sub = MenuSub;\nconst SubTrigger = MenuSubTrigger;\nconst SubContent = MenuSubContent;\n\nexport {\n  createMenuScope,\n  //\n  Menu,\n  MenuAnchor,\n  MenuPortal,\n  MenuContent,\n  MenuGroup,\n  MenuLabel,\n  MenuItem,\n  MenuCheckboxItem,\n  MenuRadioGroup,\n  MenuRadioItem,\n  MenuItemIndicator,\n  MenuSeparator,\n  MenuArrow,\n  MenuSub,\n  MenuSubTrigger,\n  MenuSubContent,\n  //\n  Root,\n  Anchor,\n  Portal,\n  Content,\n  Group,\n  Label,\n  Item,\n  CheckboxItem,\n  RadioGroup,\n  RadioItem,\n  ItemIndicator,\n  Separator,\n  Arrow,\n  Sub,\n  SubTrigger,\n  SubContent,\n};\nexport type {\n  MenuProps,\n  MenuAnchorProps,\n  MenuPortalProps,\n  MenuContentProps,\n  MenuGroupProps,\n  MenuLabelProps,\n  MenuItemProps,\n  MenuCheckboxItemProps,\n  MenuRadioGroupProps,\n  MenuRadioItemProps,\n  MenuItemIndicatorProps,\n  MenuSeparatorProps,\n  MenuArrowProps,\n  MenuSubProps,\n  MenuSubTriggerProps,\n  MenuSubContentProps,\n};\n", "export {\n  createContextMenuScope,\n  //\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuPortal,\n  ContextMenuContent,\n  ContextMenuGroup,\n  ContextMenuLabel,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioGroup,\n  ContextMenuRadioItem,\n  ContextMenuItemIndicator,\n  ContextMenuSeparator,\n  ContextMenuArrow,\n  ContextMenuSub,\n  ContextMenuSubTrigger,\n  ContextMenuSubContent,\n  //\n  Root,\n  Trigger,\n  Portal,\n  Content,\n  Group,\n  Label,\n  Item,\n  CheckboxItem,\n  RadioGroup,\n  RadioItem,\n  ItemIndicator,\n  Separator,\n  Arrow,\n  Sub,\n  SubTrigger,\n  SubContent,\n} from './ContextMenu';\nexport type {\n  ContextMenuProps,\n  ContextMenuTriggerProps,\n  ContextMenuPortalProps,\n  ContextMenuContentProps,\n  ContextMenuGroupProps,\n  ContextMenuLabelProps,\n  ContextMenuItemProps,\n  ContextMenuCheckboxItemProps,\n  ContextMenuRadioGroupProps,\n  ContextMenuRadioItemProps,\n  ContextMenuItemIndicatorProps,\n  ContextMenuSeparatorProps,\n  ContextMenuArrowProps,\n  ContextMenuSubProps,\n  ContextMenuSubTriggerProps,\n  ContextMenuSubContentProps,\n} from './ContextMenu';\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport * as MenuPrimitive from '@radix-ui/react-menu';\nimport { createMenuScope } from '@radix-ui/react-menu';\nimport { useCallbackRef } from '@radix-ui/react-use-callback-ref';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\n\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\n\ntype Direction = 'ltr' | 'rtl';\ntype Point = { x: number; y: number };\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenu\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTEXT_MENU_NAME = 'ContextMenu';\n\ntype ScopedProps<P> = P & { __scopeContextMenu?: Scope };\nconst [createContextMenuContext, createContextMenuScope] = createContextScope(CONTEXT_MENU_NAME, [\n  createMenuScope,\n]);\nconst useMenuScope = createMenuScope();\n\ntype ContextMenuContextValue = {\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  modal: boolean;\n};\n\nconst [ContextMenuProvider, useContextMenuContext] =\n  createContextMenuContext<ContextMenuContextValue>(CONTEXT_MENU_NAME);\n\ninterface ContextMenuProps {\n  children?: React.ReactNode;\n  onOpenChange?(open: boolean): void;\n  dir?: Direction;\n  modal?: boolean;\n}\n\nconst ContextMenu: React.FC<ContextMenuProps> = (props: ScopedProps<ContextMenuProps>) => {\n  const { __scopeContextMenu, children, onOpenChange, dir, modal = true } = props;\n  const [open, setOpen] = React.useState(false);\n  const menuScope = useMenuScope(__scopeContextMenu);\n  const handleOpenChangeProp = useCallbackRef(onOpenChange);\n\n  const handleOpenChange = React.useCallback(\n    (open: boolean) => {\n      setOpen(open);\n      handleOpenChangeProp(open);\n    },\n    [handleOpenChangeProp]\n  );\n\n  return (\n    <ContextMenuProvider\n      scope={__scopeContextMenu}\n      open={open}\n      onOpenChange={handleOpenChange}\n      modal={modal}\n    >\n      <MenuPrimitive.Root\n        {...menuScope}\n        dir={dir}\n        open={open}\n        onOpenChange={handleOpenChange}\n        modal={modal}\n      >\n        {children}\n      </MenuPrimitive.Root>\n    </ContextMenuProvider>\n  );\n};\n\nContextMenu.displayName = CONTEXT_MENU_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'ContextMenuTrigger';\n\ntype ContextMenuTriggerElement = React.ElementRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = Radix.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface ContextMenuTriggerProps extends PrimitiveSpanProps {\n  disabled?: boolean;\n}\n\nconst ContextMenuTrigger = React.forwardRef<ContextMenuTriggerElement, ContextMenuTriggerProps>(\n  (props: ScopedProps<ContextMenuTriggerProps>, forwardedRef) => {\n    const { __scopeContextMenu, disabled = false, ...triggerProps } = props;\n    const context = useContextMenuContext(TRIGGER_NAME, __scopeContextMenu);\n    const menuScope = useMenuScope(__scopeContextMenu);\n    const pointRef = React.useRef<Point>({ x: 0, y: 0 });\n    const virtualRef = React.useRef({\n      getBoundingClientRect: () => DOMRect.fromRect({ width: 0, height: 0, ...pointRef.current }),\n    });\n    const longPressTimerRef = React.useRef(0);\n    const clearLongPress = React.useCallback(\n      () => window.clearTimeout(longPressTimerRef.current),\n      []\n    );\n    const handleOpen = (event: React.MouseEvent | React.PointerEvent) => {\n      pointRef.current = { x: event.clientX, y: event.clientY };\n      context.onOpenChange(true);\n    };\n\n    React.useEffect(() => clearLongPress, [clearLongPress]);\n    React.useEffect(() => void (disabled && clearLongPress()), [disabled, clearLongPress]);\n\n    return (\n      <>\n        <MenuPrimitive.Anchor {...menuScope} virtualRef={virtualRef} />\n        <Primitive.span\n          data-state={context.open ? 'open' : 'closed'}\n          data-disabled={disabled ? '' : undefined}\n          {...triggerProps}\n          ref={forwardedRef}\n          // prevent iOS context menu from appearing\n          style={{ WebkitTouchCallout: 'none', ...props.style }}\n          // if trigger is disabled, enable the native Context Menu\n          onContextMenu={\n            disabled\n              ? props.onContextMenu\n              : composeEventHandlers(props.onContextMenu, (event) => {\n                  // clearing the long press here because some platforms already support\n                  // long press to trigger a `contextmenu` event\n                  clearLongPress();\n                  handleOpen(event);\n                  event.preventDefault();\n                })\n          }\n          onPointerDown={\n            disabled\n              ? props.onPointerDown\n              : composeEventHandlers(\n                  props.onPointerDown,\n                  whenTouchOrPen((event) => {\n                    // clear the long press here in case there's multiple touch points\n                    clearLongPress();\n                    longPressTimerRef.current = window.setTimeout(() => handleOpen(event), 700);\n                  })\n                )\n          }\n          onPointerMove={\n            disabled\n              ? props.onPointerMove\n              : composeEventHandlers(props.onPointerMove, whenTouchOrPen(clearLongPress))\n          }\n          onPointerCancel={\n            disabled\n              ? props.onPointerCancel\n              : composeEventHandlers(props.onPointerCancel, whenTouchOrPen(clearLongPress))\n          }\n          onPointerUp={\n            disabled\n              ? props.onPointerUp\n              : composeEventHandlers(props.onPointerUp, whenTouchOrPen(clearLongPress))\n          }\n        />\n      </>\n    );\n  }\n);\n\nContextMenuTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'ContextMenuPortal';\n\ntype MenuPortalProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Portal>;\ninterface ContextMenuPortalProps extends MenuPortalProps {}\n\nconst ContextMenuPortal: React.FC<ContextMenuPortalProps> = (\n  props: ScopedProps<ContextMenuPortalProps>\n) => {\n  const { __scopeContextMenu, ...portalProps } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n  return <MenuPrimitive.Portal {...menuScope} {...portalProps} />;\n};\n\nContextMenuPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'ContextMenuContent';\n\ntype ContextMenuContentElement = React.ElementRef<typeof MenuPrimitive.Content>;\ntype MenuContentProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Content>;\ninterface ContextMenuContentProps\n  extends Omit<MenuContentProps, 'onEntryFocus' | 'side' | 'sideOffset' | 'align'> {}\n\nconst ContextMenuContent = React.forwardRef<ContextMenuContentElement, ContextMenuContentProps>(\n  (props: ScopedProps<ContextMenuContentProps>, forwardedRef) => {\n    const { __scopeContextMenu, ...contentProps } = props;\n    const context = useContextMenuContext(CONTENT_NAME, __scopeContextMenu);\n    const menuScope = useMenuScope(__scopeContextMenu);\n    const hasInteractedOutsideRef = React.useRef(false);\n\n    return (\n      <MenuPrimitive.Content\n        {...menuScope}\n        {...contentProps}\n        ref={forwardedRef}\n        side=\"right\"\n        sideOffset={2}\n        align=\"start\"\n        onCloseAutoFocus={(event) => {\n          props.onCloseAutoFocus?.(event);\n\n          if (!event.defaultPrevented && hasInteractedOutsideRef.current) {\n            event.preventDefault();\n          }\n\n          hasInteractedOutsideRef.current = false;\n        }}\n        onInteractOutside={(event) => {\n          props.onInteractOutside?.(event);\n\n          if (!event.defaultPrevented && !context.modal) hasInteractedOutsideRef.current = true;\n        }}\n        style={{\n          ...props.style,\n          // re-namespace exposed content custom properties\n          ...{\n            '--radix-context-menu-content-transform-origin': 'var(--radix-popper-transform-origin)',\n            '--radix-context-menu-content-available-width': 'var(--radix-popper-available-width)',\n            '--radix-context-menu-content-available-height': 'var(--radix-popper-available-height)',\n            '--radix-context-menu-trigger-width': 'var(--radix-popper-anchor-width)',\n            '--radix-context-menu-trigger-height': 'var(--radix-popper-anchor-height)',\n          },\n        }}\n      />\n    );\n  }\n);\n\nContextMenuContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst GROUP_NAME = 'ContextMenuGroup';\n\ntype ContextMenuGroupElement = React.ElementRef<typeof MenuPrimitive.Group>;\ntype MenuGroupProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Group>;\ninterface ContextMenuGroupProps extends MenuGroupProps {}\n\nconst ContextMenuGroup = React.forwardRef<ContextMenuGroupElement, ContextMenuGroupProps>(\n  (props: ScopedProps<ContextMenuGroupProps>, forwardedRef) => {\n    const { __scopeContextMenu, ...groupProps } = props;\n    const menuScope = useMenuScope(__scopeContextMenu);\n    return <MenuPrimitive.Group {...menuScope} {...groupProps} ref={forwardedRef} />;\n  }\n);\n\nContextMenuGroup.displayName = GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuLabel\n * -----------------------------------------------------------------------------------------------*/\n\nconst LABEL_NAME = 'ContextMenuLabel';\n\ntype ContextMenuLabelElement = React.ElementRef<typeof MenuPrimitive.Label>;\ntype MenuLabelProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Label>;\ninterface ContextMenuLabelProps extends MenuLabelProps {}\n\nconst ContextMenuLabel = React.forwardRef<ContextMenuLabelElement, ContextMenuLabelProps>(\n  (props: ScopedProps<ContextMenuLabelProps>, forwardedRef) => {\n    const { __scopeContextMenu, ...labelProps } = props;\n    const menuScope = useMenuScope(__scopeContextMenu);\n    return <MenuPrimitive.Label {...menuScope} {...labelProps} ref={forwardedRef} />;\n  }\n);\n\nContextMenuLabel.displayName = LABEL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_NAME = 'ContextMenuItem';\n\ntype ContextMenuItemElement = React.ElementRef<typeof MenuPrimitive.Item>;\ntype MenuItemProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Item>;\ninterface ContextMenuItemProps extends MenuItemProps {}\n\nconst ContextMenuItem = React.forwardRef<ContextMenuItemElement, ContextMenuItemProps>(\n  (props: ScopedProps<ContextMenuItemProps>, forwardedRef) => {\n    const { __scopeContextMenu, ...itemProps } = props;\n    const menuScope = useMenuScope(__scopeContextMenu);\n    return <MenuPrimitive.Item {...menuScope} {...itemProps} ref={forwardedRef} />;\n  }\n);\n\nContextMenuItem.displayName = ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuCheckboxItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst CHECKBOX_ITEM_NAME = 'ContextMenuCheckboxItem';\n\ntype ContextMenuCheckboxItemElement = React.ElementRef<typeof MenuPrimitive.CheckboxItem>;\ntype MenuCheckboxItemProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.CheckboxItem>;\ninterface ContextMenuCheckboxItemProps extends MenuCheckboxItemProps {}\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  ContextMenuCheckboxItemElement,\n  ContextMenuCheckboxItemProps\n>((props: ScopedProps<ContextMenuCheckboxItemProps>, forwardedRef) => {\n  const { __scopeContextMenu, ...checkboxItemProps } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n  return <MenuPrimitive.CheckboxItem {...menuScope} {...checkboxItemProps} ref={forwardedRef} />;\n});\n\nContextMenuCheckboxItem.displayName = CHECKBOX_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuRadioGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_GROUP_NAME = 'ContextMenuRadioGroup';\n\ntype ContextMenuRadioGroupElement = React.ElementRef<typeof MenuPrimitive.RadioGroup>;\ntype MenuRadioGroupProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.RadioGroup>;\ninterface ContextMenuRadioGroupProps extends MenuRadioGroupProps {}\n\nconst ContextMenuRadioGroup = React.forwardRef<\n  ContextMenuRadioGroupElement,\n  ContextMenuRadioGroupProps\n>((props: ScopedProps<ContextMenuRadioGroupProps>, forwardedRef) => {\n  const { __scopeContextMenu, ...radioGroupProps } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n  return <MenuPrimitive.RadioGroup {...menuScope} {...radioGroupProps} ref={forwardedRef} />;\n});\n\nContextMenuRadioGroup.displayName = RADIO_GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuRadioItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_ITEM_NAME = 'ContextMenuRadioItem';\n\ntype ContextMenuRadioItemElement = React.ElementRef<typeof MenuPrimitive.RadioItem>;\ntype MenuRadioItemProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.RadioItem>;\ninterface ContextMenuRadioItemProps extends MenuRadioItemProps {}\n\nconst ContextMenuRadioItem = React.forwardRef<\n  ContextMenuRadioItemElement,\n  ContextMenuRadioItemProps\n>((props: ScopedProps<ContextMenuRadioItemProps>, forwardedRef) => {\n  const { __scopeContextMenu, ...radioItemProps } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n  return <MenuPrimitive.RadioItem {...menuScope} {...radioItemProps} ref={forwardedRef} />;\n});\n\nContextMenuRadioItem.displayName = RADIO_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuItemIndicator\n * -----------------------------------------------------------------------------------------------*/\n\nconst INDICATOR_NAME = 'ContextMenuItemIndicator';\n\ntype ContextMenuItemIndicatorElement = React.ElementRef<typeof MenuPrimitive.ItemIndicator>;\ntype MenuItemIndicatorProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.ItemIndicator>;\ninterface ContextMenuItemIndicatorProps extends MenuItemIndicatorProps {}\n\nconst ContextMenuItemIndicator = React.forwardRef<\n  ContextMenuItemIndicatorElement,\n  ContextMenuItemIndicatorProps\n>((props: ScopedProps<ContextMenuItemIndicatorProps>, forwardedRef) => {\n  const { __scopeContextMenu, ...itemIndicatorProps } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n  return <MenuPrimitive.ItemIndicator {...menuScope} {...itemIndicatorProps} ref={forwardedRef} />;\n});\n\nContextMenuItemIndicator.displayName = INDICATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuSeparator\n * -----------------------------------------------------------------------------------------------*/\n\nconst SEPARATOR_NAME = 'ContextMenuSeparator';\n\ntype ContextMenuSeparatorElement = React.ElementRef<typeof MenuPrimitive.Separator>;\ntype MenuSeparatorProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Separator>;\ninterface ContextMenuSeparatorProps extends MenuSeparatorProps {}\n\nconst ContextMenuSeparator = React.forwardRef<\n  ContextMenuSeparatorElement,\n  ContextMenuSeparatorProps\n>((props: ScopedProps<ContextMenuSeparatorProps>, forwardedRef) => {\n  const { __scopeContextMenu, ...separatorProps } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n  return <MenuPrimitive.Separator {...menuScope} {...separatorProps} ref={forwardedRef} />;\n});\n\nContextMenuSeparator.displayName = SEPARATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'ContextMenuArrow';\n\ntype ContextMenuArrowElement = React.ElementRef<typeof MenuPrimitive.Arrow>;\ntype MenuArrowProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Arrow>;\ninterface ContextMenuArrowProps extends MenuArrowProps {}\n\nconst ContextMenuArrow = React.forwardRef<ContextMenuArrowElement, ContextMenuArrowProps>(\n  (props: ScopedProps<ContextMenuArrowProps>, forwardedRef) => {\n    const { __scopeContextMenu, ...arrowProps } = props;\n    const menuScope = useMenuScope(__scopeContextMenu);\n    return <MenuPrimitive.Arrow {...menuScope} {...arrowProps} ref={forwardedRef} />;\n  }\n);\n\nContextMenuArrow.displayName = ARROW_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuSub\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_NAME = 'ContextMenuSub';\n\ninterface ContextMenuSubProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n}\n\nconst ContextMenuSub: React.FC<ContextMenuSubProps> = (props: ScopedProps<ContextMenuSubProps>) => {\n  const { __scopeContextMenu, children, onOpenChange, open: openProp, defaultOpen } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen,\n    onChange: onOpenChange,\n  });\n\n  return (\n    <MenuPrimitive.Sub {...menuScope} open={open} onOpenChange={setOpen}>\n      {children}\n    </MenuPrimitive.Sub>\n  );\n};\n\nContextMenuSub.displayName = SUB_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuSubTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_TRIGGER_NAME = 'ContextMenuSubTrigger';\n\ntype ContextMenuSubTriggerElement = React.ElementRef<typeof MenuPrimitive.SubTrigger>;\ntype MenuSubTriggerProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.SubTrigger>;\ninterface ContextMenuSubTriggerProps extends MenuSubTriggerProps {}\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  ContextMenuSubTriggerElement,\n  ContextMenuSubTriggerProps\n>((props: ScopedProps<ContextMenuSubTriggerProps>, forwardedRef) => {\n  const { __scopeContextMenu, ...triggerItemProps } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n  return <MenuPrimitive.SubTrigger {...menuScope} {...triggerItemProps} ref={forwardedRef} />;\n});\n\nContextMenuSubTrigger.displayName = SUB_TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * ContextMenuSubContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_CONTENT_NAME = 'ContextMenuSubContent';\n\ntype ContextMenuSubContentElement = React.ElementRef<typeof MenuPrimitive.Content>;\ntype MenuSubContentProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.SubContent>;\ninterface ContextMenuSubContentProps extends MenuSubContentProps {}\n\nconst ContextMenuSubContent = React.forwardRef<\n  ContextMenuSubContentElement,\n  ContextMenuSubContentProps\n>((props: ScopedProps<ContextMenuSubContentProps>, forwardedRef) => {\n  const { __scopeContextMenu, ...subContentProps } = props;\n  const menuScope = useMenuScope(__scopeContextMenu);\n\n  return (\n    <MenuPrimitive.SubContent\n      {...menuScope}\n      {...subContentProps}\n      ref={forwardedRef}\n      style={{\n        ...props.style,\n        // re-namespace exposed content custom properties\n        ...{\n          '--radix-context-menu-content-transform-origin': 'var(--radix-popper-transform-origin)',\n          '--radix-context-menu-content-available-width': 'var(--radix-popper-available-width)',\n          '--radix-context-menu-content-available-height': 'var(--radix-popper-available-height)',\n          '--radix-context-menu-trigger-width': 'var(--radix-popper-anchor-width)',\n          '--radix-context-menu-trigger-height': 'var(--radix-popper-anchor-height)',\n        },\n      }}\n    />\n  );\n});\n\nContextMenuSubContent.displayName = SUB_CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nfunction whenTouchOrPen<E>(handler: React.PointerEventHandler<E>): React.PointerEventHandler<E> {\n  return (event) => (event.pointerType !== 'mouse' ? handler(event) : undefined);\n}\n\nconst Root = ContextMenu;\nconst Trigger = ContextMenuTrigger;\nconst Portal = ContextMenuPortal;\nconst Content = ContextMenuContent;\nconst Group = ContextMenuGroup;\nconst Label = ContextMenuLabel;\nconst Item = ContextMenuItem;\nconst CheckboxItem = ContextMenuCheckboxItem;\nconst RadioGroup = ContextMenuRadioGroup;\nconst RadioItem = ContextMenuRadioItem;\nconst ItemIndicator = ContextMenuItemIndicator;\nconst Separator = ContextMenuSeparator;\nconst Arrow = ContextMenuArrow;\nconst Sub = ContextMenuSub;\nconst SubTrigger = ContextMenuSubTrigger;\nconst SubContent = ContextMenuSubContent;\n\nexport {\n  createContextMenuScope,\n  //\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuPortal,\n  ContextMenuContent,\n  ContextMenuGroup,\n  ContextMenuLabel,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioGroup,\n  ContextMenuRadioItem,\n  ContextMenuItemIndicator,\n  ContextMenuSeparator,\n  ContextMenuArrow,\n  ContextMenuSub,\n  ContextMenuSubTrigger,\n  ContextMenuSubContent,\n  //\n  Root,\n  Trigger,\n  Portal,\n  Content,\n  Group,\n  Label,\n  Item,\n  CheckboxItem,\n  RadioGroup,\n  RadioItem,\n  ItemIndicator,\n  Separator,\n  Arrow,\n  Sub,\n  SubTrigger,\n  SubContent,\n};\nexport type {\n  ContextMenuProps,\n  ContextMenuTriggerProps,\n  ContextMenuPortalProps,\n  ContextMenuContentProps,\n  ContextMenuGroupProps,\n  ContextMenuLabelProps,\n  ContextMenuItemProps,\n  ContextMenuCheckboxItemProps,\n  ContextMenuRadioGroupProps,\n  ContextMenuRadioItemProps,\n  ContextMenuItemIndicatorProps,\n  ContextMenuSeparatorProps,\n  ContextMenuArrowProps,\n  ContextMenuSubProps,\n  ContextMenuSubTriggerProps,\n  ContextMenuSubContentProps,\n};\n", "const isDarwin =\n\ttypeof window === 'undefined'\n\t\t? false\n\t\t: window.navigator.userAgent.toLowerCase().indexOf('mac') > -1\nconst cmdKey = isDarwin ? '\u2318' : 'Ctrl'\nconst altKey = isDarwin ? '\u2325' : 'Alt'\n\n/** @public */\nexport function kbd(str: string) {\n\treturn str\n\t\t.split(',')[0]\n\t\t.split('')\n\t\t.map((sub) => {\n\t\t\tconst subStr = sub.replace(/\\$/g, cmdKey).replace(/\\?/g, altKey).replace(/!/g, '\u21E7')\n\t\t\treturn subStr[0].toUpperCase() + subStr.slice(1)\n\t\t})\n}\n\n/** @public */\nexport function kbdStr(str: string) {\n\treturn '\u2014 ' + kbd(str).join('\u2009')\n}\n", "import React from 'react'\n\n/** @internal */\nexport function Spinner(props: React.SVGProps<SVGSVGElement>) {\n\treturn (\n\t\t<svg width={16} height={16} viewBox=\"0 0 16 16\" {...props}>\n\t\t\t<g strokeWidth={2} fill=\"none\" fillRule=\"evenodd\">\n\t\t\t\t<circle strokeOpacity={0.25} cx={8} cy={8} r={7} stroke=\"currentColor\" />\n\t\t\t\t<path strokeLinecap=\"round\" d=\"M15 8c0-4.5-4.5-7-7-7\" stroke=\"currentColor\">\n\t\t\t\t\t<animateTransform\n\t\t\t\t\t\tattributeName=\"transform\"\n\t\t\t\t\t\ttype=\"rotate\"\n\t\t\t\t\t\tfrom=\"0 8 8\"\n\t\t\t\t\t\tto=\"360 8 8\"\n\t\t\t\t\t\tdur=\"1s\"\n\t\t\t\t\t\trepeatCount=\"indefinite\"\n\t\t\t\t\t/>\n\t\t\t\t</path>\n\t\t\t</g>\n\t\t</svg>\n\t)\n}\n", "import * as _DropdownMenu from '@radix-ui/react-dropdown-menu'\nimport { preventDefault, useContainer } from '@tldraw/editor'\nimport { ReactNode } from 'react'\nimport { useMenuIsOpen } from '../../hooks/useMenuIsOpen'\nimport { TldrawUiButton } from './Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from './Button/TldrawUiButtonIcon'\nimport { TldrawUiButtonLabel } from './Button/TldrawUiButtonLabel'\nimport { TldrawUiIcon } from './TldrawUiIcon'\n\n/** @public */\nexport type TLUiDropdownMenuRootProps = {\n\tid: string\n\tchildren: ReactNode\n\tmodal?: boolean\n\tdebugOpen?: boolean\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuRoot({\n\tid,\n\tchildren,\n\tmodal = false,\n\tdebugOpen = false,\n}: TLUiDropdownMenuRootProps) {\n\tconst [open, onOpenChange] = useMenuIsOpen(id)\n\n\treturn (\n\t\t<_DropdownMenu.Root\n\t\t\topen={debugOpen || open}\n\t\t\tdir=\"ltr\"\n\t\t\tmodal={modal}\n\t\t\tonOpenChange={onOpenChange}\n\t\t>\n\t\t\t{children}\n\t\t</_DropdownMenu.Root>\n\t)\n}\n\n/** @public */\nexport interface TLUiDropdownMenuTriggerProps {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuTrigger({ children, ...rest }: TLUiDropdownMenuTriggerProps) {\n\treturn (\n\t\t<_DropdownMenu.Trigger\n\t\t\tdir=\"ltr\"\n\t\t\tasChild\n\t\t\t// Firefox fix: Stop the dropdown immediately closing after touch\n\t\t\tonTouchEnd={(e) => preventDefault(e)}\n\t\t\t{...rest}\n\t\t>\n\t\t\t{children}\n\t\t</_DropdownMenu.Trigger>\n\t)\n}\n\n/** @public */\nexport type TLUiDropdownMenuContentProps = {\n\tid?: string\n\tchildren: ReactNode\n\talignOffset?: number\n\tsideOffset?: number\n\talign?: 'start' | 'center' | 'end'\n\tside?: 'bottom' | 'top' | 'right' | 'left'\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuContent({\n\tside = 'bottom',\n\talign = 'start',\n\tsideOffset = 8,\n\talignOffset = 8,\n\tchildren,\n}: TLUiDropdownMenuContentProps) {\n\tconst container = useContainer()\n\n\treturn (\n\t\t<_DropdownMenu.Portal container={container}>\n\t\t\t<_DropdownMenu.Content\n\t\t\t\tclassName=\"tlui-menu\"\n\t\t\t\tside={side}\n\t\t\t\tsideOffset={sideOffset}\n\t\t\t\talign={align}\n\t\t\t\talignOffset={alignOffset}\n\t\t\t\tcollisionPadding={4}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</_DropdownMenu.Content>\n\t\t</_DropdownMenu.Portal>\n\t)\n}\n\n/** @public */\nexport type TLUiDropdownMenuSubProps = { id: string; children: ReactNode }\n\n/** @public */\nexport function TldrawUiDropdownMenuSub({ id, children }: TLUiDropdownMenuSubProps) {\n\tconst [open, onOpenChange] = useMenuIsOpen(id)\n\n\treturn (\n\t\t<_DropdownMenu.Sub open={open} onOpenChange={onOpenChange}>\n\t\t\t{children}\n\t\t</_DropdownMenu.Sub>\n\t)\n}\n\n/** @public */\nexport type TLUiDropdownMenuSubTriggerProps = {\n\tlabel: string\n\tid?: string\n\ttitle?: string\n\tdisabled?: boolean\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuSubTrigger({\n\tid,\n\tlabel,\n\ttitle,\n\tdisabled,\n}: TLUiDropdownMenuSubTriggerProps) {\n\treturn (\n\t\t<_DropdownMenu.SubTrigger dir=\"ltr\" asChild disabled={disabled}>\n\t\t\t<TldrawUiButton\n\t\t\t\tdata-testid={id}\n\t\t\t\ttype=\"menu\"\n\t\t\t\tclassName=\"tlui-menu__submenu__trigger\"\n\t\t\t\tdisabled={disabled}\n\t\t\t\ttitle={title}\n\t\t\t>\n\t\t\t\t<TldrawUiButtonLabel>{label}</TldrawUiButtonLabel>\n\t\t\t\t<TldrawUiButtonIcon icon=\"chevron-right\" small />\n\t\t\t</TldrawUiButton>\n\t\t</_DropdownMenu.SubTrigger>\n\t)\n}\n\n/** @public */\nexport type TLUiDropdownMenuSubContentProps = {\n\tid?: string\n\talignOffset?: number\n\tsideOffset?: number\n\tsize?: 'tiny' | 'small' | 'medium' | 'wide'\n\tchildren: ReactNode\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuSubContent({\n\tid,\n\talignOffset = -1,\n\tsideOffset = -4,\n\tsize = 'small',\n\tchildren,\n}: TLUiDropdownMenuSubContentProps) {\n\tconst container = useContainer()\n\treturn (\n\t\t<_DropdownMenu.Portal container={container}>\n\t\t\t<_DropdownMenu.SubContent\n\t\t\t\tdata-testid={id}\n\t\t\t\tclassName=\"tlui-menu tlui-menu__submenu__content\"\n\t\t\t\talignOffset={alignOffset}\n\t\t\t\tsideOffset={sideOffset}\n\t\t\t\tcollisionPadding={4}\n\t\t\t\tdata-size={size}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</_DropdownMenu.SubContent>\n\t\t</_DropdownMenu.Portal>\n\t)\n}\n\n/** @public */\nexport type TLUiDropdownMenuGroupProps = {\n\tchildren: ReactNode\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuGroup({ children }: TLUiDropdownMenuGroupProps) {\n\treturn (\n\t\t<_DropdownMenu.Group dir=\"ltr\" className=\"tlui-menu__group\">\n\t\t\t{children}\n\t\t</_DropdownMenu.Group>\n\t)\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuIndicator() {\n\treturn (\n\t\t<_DropdownMenu.ItemIndicator dir=\"ltr\" asChild>\n\t\t\t<TldrawUiIcon icon=\"check\" />\n\t\t</_DropdownMenu.ItemIndicator>\n\t)\n}\n\n/** @public */\nexport interface TLUiDropdownMenuItemProps {\n\tnoClose?: boolean\n\tchildren: ReactNode\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuItem({ noClose, children }: TLUiDropdownMenuItemProps) {\n\treturn (\n\t\t<_DropdownMenu.Item dir=\"ltr\" asChild onClick={noClose ? preventDefault : undefined}>\n\t\t\t{children}\n\t\t</_DropdownMenu.Item>\n\t)\n}\n\n/** @public */\nexport interface TLUiDropdownMenuCheckboxItemProps {\n\tchecked?: boolean\n\tonSelect?: (e: Event) => void\n\tdisabled?: boolean\n\ttitle: string\n\tchildren: ReactNode\n}\n\n/** @public */\nexport function TldrawUiDropdownMenuCheckboxItem({\n\tchildren,\n\tonSelect,\n\t...rest\n}: TLUiDropdownMenuCheckboxItemProps) {\n\treturn (\n\t\t<_DropdownMenu.CheckboxItem\n\t\t\tdir=\"ltr\"\n\t\t\tclassName=\"tlui-button tlui-button__menu tlui-button__checkbox\"\n\t\t\tonSelect={(e) => {\n\t\t\t\tonSelect?.(e)\n\t\t\t\tpreventDefault(e)\n\t\t\t}}\n\t\t\t{...rest}\n\t\t>\n\t\t\t<div className=\"tlui-button__checkbox__indicator\">\n\t\t\t\t<_DropdownMenu.ItemIndicator dir=\"ltr\">\n\t\t\t\t\t<TldrawUiIcon icon=\"check\" small />\n\t\t\t\t</_DropdownMenu.ItemIndicator>\n\t\t\t</div>\n\t\t\t{children}\n\t\t</_DropdownMenu.CheckboxItem>\n\t)\n}\n", "export {\n  createDropdownMenuScope,\n  //\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuPortal,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuLabel,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioGroup,\n  DropdownMenuRadioItem,\n  DropdownMenuItemIndicator,\n  DropdownMenuSeparator,\n  DropdownMenuArrow,\n  DropdownMenuSub,\n  DropdownMenuSubTrigger,\n  DropdownMenuSubContent,\n  //\n  Root,\n  Trigger,\n  Portal,\n  Content,\n  Group,\n  Label,\n  Item,\n  CheckboxItem,\n  RadioGroup,\n  RadioItem,\n  ItemIndicator,\n  Separator,\n  Arrow,\n  Sub,\n  SubTrigger,\n  SubContent,\n} from './DropdownMenu';\nexport type {\n  DropdownMenuProps,\n  DropdownMenuTriggerProps,\n  DropdownMenuPortalProps,\n  DropdownMenuContentProps,\n  DropdownMenuGroupProps,\n  DropdownMenuLabelProps,\n  DropdownMenuItemProps,\n  DropdownMenuCheckboxItemProps,\n  DropdownMenuRadioGroupProps,\n  DropdownMenuRadioItemProps,\n  DropdownMenuItemIndicatorProps,\n  DropdownMenuSeparatorProps,\n  DropdownMenuArrowProps,\n  DropdownMenuSubProps,\n  DropdownMenuSubTriggerProps,\n  DropdownMenuSubContentProps,\n} from './DropdownMenu';\n", "import * as React from 'react';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { composeRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport * as MenuPrimitive from '@radix-ui/react-menu';\nimport { createMenuScope } from '@radix-ui/react-menu';\nimport { useId } from '@radix-ui/react-id';\n\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\n\ntype Direction = 'ltr' | 'rtl';\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenu\n * -----------------------------------------------------------------------------------------------*/\n\nconst DROPDOWN_MENU_NAME = 'DropdownMenu';\n\ntype ScopedProps<P> = P & { __scopeDropdownMenu?: Scope };\nconst [createDropdownMenuContext, createDropdownMenuScope] = createContextScope(\n  DROPDOWN_MENU_NAME,\n  [createMenuScope]\n);\nconst useMenuScope = createMenuScope();\n\ntype DropdownMenuContextValue = {\n  triggerId: string;\n  triggerRef: React.RefObject<HTMLButtonElement>;\n  contentId: string;\n  open: boolean;\n  onOpenChange(open: boolean): void;\n  onOpenToggle(): void;\n  modal: boolean;\n};\n\nconst [DropdownMenuProvider, useDropdownMenuContext] =\n  createDropdownMenuContext<DropdownMenuContextValue>(DROPDOWN_MENU_NAME);\n\ninterface DropdownMenuProps {\n  children?: React.ReactNode;\n  dir?: Direction;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n  modal?: boolean;\n}\n\nconst DropdownMenu: React.FC<DropdownMenuProps> = (props: ScopedProps<DropdownMenuProps>) => {\n  const {\n    __scopeDropdownMenu,\n    children,\n    dir,\n    open: openProp,\n    defaultOpen,\n    onOpenChange,\n    modal = true,\n  } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  const triggerRef = React.useRef<HTMLButtonElement>(null);\n  const [open = false, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen,\n    onChange: onOpenChange,\n  });\n\n  return (\n    <DropdownMenuProvider\n      scope={__scopeDropdownMenu}\n      triggerId={useId()}\n      triggerRef={triggerRef}\n      contentId={useId()}\n      open={open}\n      onOpenChange={setOpen}\n      onOpenToggle={React.useCallback(() => setOpen((prevOpen) => !prevOpen), [setOpen])}\n      modal={modal}\n    >\n      <MenuPrimitive.Root {...menuScope} open={open} onOpenChange={setOpen} dir={dir} modal={modal}>\n        {children}\n      </MenuPrimitive.Root>\n    </DropdownMenuProvider>\n  );\n};\n\nDropdownMenu.displayName = DROPDOWN_MENU_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRIGGER_NAME = 'DropdownMenuTrigger';\n\ntype DropdownMenuTriggerElement = React.ElementRef<typeof Primitive.button>;\ntype PrimitiveButtonProps = Radix.ComponentPropsWithoutRef<typeof Primitive.button>;\ninterface DropdownMenuTriggerProps extends PrimitiveButtonProps {}\n\nconst DropdownMenuTrigger = React.forwardRef<DropdownMenuTriggerElement, DropdownMenuTriggerProps>(\n  (props: ScopedProps<DropdownMenuTriggerProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, disabled = false, ...triggerProps } = props;\n    const context = useDropdownMenuContext(TRIGGER_NAME, __scopeDropdownMenu);\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return (\n      <MenuPrimitive.Anchor asChild {...menuScope}>\n        <Primitive.button\n          type=\"button\"\n          id={context.triggerId}\n          aria-haspopup=\"menu\"\n          aria-expanded={context.open}\n          aria-controls={context.open ? context.contentId : undefined}\n          data-state={context.open ? 'open' : 'closed'}\n          data-disabled={disabled ? '' : undefined}\n          disabled={disabled}\n          {...triggerProps}\n          ref={composeRefs(forwardedRef, context.triggerRef)}\n          onPointerDown={composeEventHandlers(props.onPointerDown, (event) => {\n            // only call handler if it's the left button (mousedown gets triggered by all mouse buttons)\n            // but not when the control key is pressed (avoiding MacOS right click)\n            if (!disabled && event.button === 0 && event.ctrlKey === false) {\n              context.onOpenToggle();\n              // prevent trigger focusing when opening\n              // this allows the content to be given focus without competition\n              if (!context.open) event.preventDefault();\n            }\n          })}\n          onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n            if (disabled) return;\n            if (['Enter', ' '].includes(event.key)) context.onOpenToggle();\n            if (event.key === 'ArrowDown') context.onOpenChange(true);\n            // prevent keydown from scrolling window / first focused item to execute\n            // that keydown (inadvertently closing the menu)\n            if (['Enter', ' ', 'ArrowDown'].includes(event.key)) event.preventDefault();\n          })}\n        />\n      </MenuPrimitive.Anchor>\n    );\n  }\n);\n\nDropdownMenuTrigger.displayName = TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuPortal\n * -----------------------------------------------------------------------------------------------*/\n\nconst PORTAL_NAME = 'DropdownMenuPortal';\n\ntype MenuPortalProps = React.ComponentPropsWithoutRef<typeof MenuPrimitive.Portal>;\ninterface DropdownMenuPortalProps extends MenuPortalProps {}\n\nconst DropdownMenuPortal: React.FC<DropdownMenuPortalProps> = (\n  props: ScopedProps<DropdownMenuPortalProps>\n) => {\n  const { __scopeDropdownMenu, ...portalProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.Portal {...menuScope} {...portalProps} />;\n};\n\nDropdownMenuPortal.displayName = PORTAL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst CONTENT_NAME = 'DropdownMenuContent';\n\ntype DropdownMenuContentElement = React.ElementRef<typeof MenuPrimitive.Content>;\ntype MenuContentProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Content>;\ninterface DropdownMenuContentProps extends Omit<MenuContentProps, 'onEntryFocus'> {}\n\nconst DropdownMenuContent = React.forwardRef<DropdownMenuContentElement, DropdownMenuContentProps>(\n  (props: ScopedProps<DropdownMenuContentProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...contentProps } = props;\n    const context = useDropdownMenuContext(CONTENT_NAME, __scopeDropdownMenu);\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    const hasInteractedOutsideRef = React.useRef(false);\n\n    return (\n      <MenuPrimitive.Content\n        id={context.contentId}\n        aria-labelledby={context.triggerId}\n        {...menuScope}\n        {...contentProps}\n        ref={forwardedRef}\n        onCloseAutoFocus={composeEventHandlers(props.onCloseAutoFocus, (event) => {\n          if (!hasInteractedOutsideRef.current) context.triggerRef.current?.focus();\n          hasInteractedOutsideRef.current = false;\n          // Always prevent auto focus because we either focus manually or want user agent focus\n          event.preventDefault();\n        })}\n        onInteractOutside={composeEventHandlers(props.onInteractOutside, (event) => {\n          const originalEvent = event.detail.originalEvent as PointerEvent;\n          const ctrlLeftClick = originalEvent.button === 0 && originalEvent.ctrlKey === true;\n          const isRightClick = originalEvent.button === 2 || ctrlLeftClick;\n          if (!context.modal || isRightClick) hasInteractedOutsideRef.current = true;\n        })}\n        style={{\n          ...props.style,\n          // re-namespace exposed content custom properties\n          ...{\n            '--radix-dropdown-menu-content-transform-origin':\n              'var(--radix-popper-transform-origin)',\n            '--radix-dropdown-menu-content-available-width': 'var(--radix-popper-available-width)',\n            '--radix-dropdown-menu-content-available-height':\n              'var(--radix-popper-available-height)',\n            '--radix-dropdown-menu-trigger-width': 'var(--radix-popper-anchor-width)',\n            '--radix-dropdown-menu-trigger-height': 'var(--radix-popper-anchor-height)',\n          },\n        }}\n      />\n    );\n  }\n);\n\nDropdownMenuContent.displayName = CONTENT_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst GROUP_NAME = 'DropdownMenuGroup';\n\ntype DropdownMenuGroupElement = React.ElementRef<typeof MenuPrimitive.Group>;\ntype MenuGroupProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Group>;\ninterface DropdownMenuGroupProps extends MenuGroupProps {}\n\nconst DropdownMenuGroup = React.forwardRef<DropdownMenuGroupElement, DropdownMenuGroupProps>(\n  (props: ScopedProps<DropdownMenuGroupProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...groupProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return <MenuPrimitive.Group {...menuScope} {...groupProps} ref={forwardedRef} />;\n  }\n);\n\nDropdownMenuGroup.displayName = GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuLabel\n * -----------------------------------------------------------------------------------------------*/\n\nconst LABEL_NAME = 'DropdownMenuLabel';\n\ntype DropdownMenuLabelElement = React.ElementRef<typeof MenuPrimitive.Label>;\ntype MenuLabelProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Label>;\ninterface DropdownMenuLabelProps extends MenuLabelProps {}\n\nconst DropdownMenuLabel = React.forwardRef<DropdownMenuLabelElement, DropdownMenuLabelProps>(\n  (props: ScopedProps<DropdownMenuLabelProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...labelProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return <MenuPrimitive.Label {...menuScope} {...labelProps} ref={forwardedRef} />;\n  }\n);\n\nDropdownMenuLabel.displayName = LABEL_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst ITEM_NAME = 'DropdownMenuItem';\n\ntype DropdownMenuItemElement = React.ElementRef<typeof MenuPrimitive.Item>;\ntype MenuItemProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Item>;\ninterface DropdownMenuItemProps extends MenuItemProps {}\n\nconst DropdownMenuItem = React.forwardRef<DropdownMenuItemElement, DropdownMenuItemProps>(\n  (props: ScopedProps<DropdownMenuItemProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...itemProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return <MenuPrimitive.Item {...menuScope} {...itemProps} ref={forwardedRef} />;\n  }\n);\n\nDropdownMenuItem.displayName = ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuCheckboxItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst CHECKBOX_ITEM_NAME = 'DropdownMenuCheckboxItem';\n\ntype DropdownMenuCheckboxItemElement = React.ElementRef<typeof MenuPrimitive.CheckboxItem>;\ntype MenuCheckboxItemProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.CheckboxItem>;\ninterface DropdownMenuCheckboxItemProps extends MenuCheckboxItemProps {}\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  DropdownMenuCheckboxItemElement,\n  DropdownMenuCheckboxItemProps\n>((props: ScopedProps<DropdownMenuCheckboxItemProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...checkboxItemProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.CheckboxItem {...menuScope} {...checkboxItemProps} ref={forwardedRef} />;\n});\n\nDropdownMenuCheckboxItem.displayName = CHECKBOX_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuRadioGroup\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_GROUP_NAME = 'DropdownMenuRadioGroup';\n\ntype DropdownMenuRadioGroupElement = React.ElementRef<typeof MenuPrimitive.RadioGroup>;\ntype MenuRadioGroupProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.RadioGroup>;\ninterface DropdownMenuRadioGroupProps extends MenuRadioGroupProps {}\n\nconst DropdownMenuRadioGroup = React.forwardRef<\n  DropdownMenuRadioGroupElement,\n  DropdownMenuRadioGroupProps\n>((props: ScopedProps<DropdownMenuRadioGroupProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...radioGroupProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.RadioGroup {...menuScope} {...radioGroupProps} ref={forwardedRef} />;\n});\n\nDropdownMenuRadioGroup.displayName = RADIO_GROUP_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuRadioItem\n * -----------------------------------------------------------------------------------------------*/\n\nconst RADIO_ITEM_NAME = 'DropdownMenuRadioItem';\n\ntype DropdownMenuRadioItemElement = React.ElementRef<typeof MenuPrimitive.RadioItem>;\ntype MenuRadioItemProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.RadioItem>;\ninterface DropdownMenuRadioItemProps extends MenuRadioItemProps {}\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  DropdownMenuRadioItemElement,\n  DropdownMenuRadioItemProps\n>((props: ScopedProps<DropdownMenuRadioItemProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...radioItemProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.RadioItem {...menuScope} {...radioItemProps} ref={forwardedRef} />;\n});\n\nDropdownMenuRadioItem.displayName = RADIO_ITEM_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuItemIndicator\n * -----------------------------------------------------------------------------------------------*/\n\nconst INDICATOR_NAME = 'DropdownMenuItemIndicator';\n\ntype DropdownMenuItemIndicatorElement = React.ElementRef<typeof MenuPrimitive.ItemIndicator>;\ntype MenuItemIndicatorProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.ItemIndicator>;\ninterface DropdownMenuItemIndicatorProps extends MenuItemIndicatorProps {}\n\nconst DropdownMenuItemIndicator = React.forwardRef<\n  DropdownMenuItemIndicatorElement,\n  DropdownMenuItemIndicatorProps\n>((props: ScopedProps<DropdownMenuItemIndicatorProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...itemIndicatorProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.ItemIndicator {...menuScope} {...itemIndicatorProps} ref={forwardedRef} />;\n});\n\nDropdownMenuItemIndicator.displayName = INDICATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuSeparator\n * -----------------------------------------------------------------------------------------------*/\n\nconst SEPARATOR_NAME = 'DropdownMenuSeparator';\n\ntype DropdownMenuSeparatorElement = React.ElementRef<typeof MenuPrimitive.Separator>;\ntype MenuSeparatorProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Separator>;\ninterface DropdownMenuSeparatorProps extends MenuSeparatorProps {}\n\nconst DropdownMenuSeparator = React.forwardRef<\n  DropdownMenuSeparatorElement,\n  DropdownMenuSeparatorProps\n>((props: ScopedProps<DropdownMenuSeparatorProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...separatorProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.Separator {...menuScope} {...separatorProps} ref={forwardedRef} />;\n});\n\nDropdownMenuSeparator.displayName = SEPARATOR_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuArrow\n * -----------------------------------------------------------------------------------------------*/\n\nconst ARROW_NAME = 'DropdownMenuArrow';\n\ntype DropdownMenuArrowElement = React.ElementRef<typeof MenuPrimitive.Arrow>;\ntype MenuArrowProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.Arrow>;\ninterface DropdownMenuArrowProps extends MenuArrowProps {}\n\nconst DropdownMenuArrow = React.forwardRef<DropdownMenuArrowElement, DropdownMenuArrowProps>(\n  (props: ScopedProps<DropdownMenuArrowProps>, forwardedRef) => {\n    const { __scopeDropdownMenu, ...arrowProps } = props;\n    const menuScope = useMenuScope(__scopeDropdownMenu);\n    return <MenuPrimitive.Arrow {...menuScope} {...arrowProps} ref={forwardedRef} />;\n  }\n);\n\nDropdownMenuArrow.displayName = ARROW_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuSub\n * -----------------------------------------------------------------------------------------------*/\n\ninterface DropdownMenuSubProps {\n  children?: React.ReactNode;\n  open?: boolean;\n  defaultOpen?: boolean;\n  onOpenChange?(open: boolean): void;\n}\n\nconst DropdownMenuSub: React.FC<DropdownMenuSubProps> = (\n  props: ScopedProps<DropdownMenuSubProps>\n) => {\n  const { __scopeDropdownMenu, children, open: openProp, onOpenChange, defaultOpen } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  const [open = false, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen,\n    onChange: onOpenChange,\n  });\n\n  return (\n    <MenuPrimitive.Sub {...menuScope} open={open} onOpenChange={setOpen}>\n      {children}\n    </MenuPrimitive.Sub>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuSubTrigger\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_TRIGGER_NAME = 'DropdownMenuSubTrigger';\n\ntype DropdownMenuSubTriggerElement = React.ElementRef<typeof MenuPrimitive.SubTrigger>;\ntype MenuSubTriggerProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.SubTrigger>;\ninterface DropdownMenuSubTriggerProps extends MenuSubTriggerProps {}\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  DropdownMenuSubTriggerElement,\n  DropdownMenuSubTriggerProps\n>((props: ScopedProps<DropdownMenuSubTriggerProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...subTriggerProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n  return <MenuPrimitive.SubTrigger {...menuScope} {...subTriggerProps} ref={forwardedRef} />;\n});\n\nDropdownMenuSubTrigger.displayName = SUB_TRIGGER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * DropdownMenuSubContent\n * -----------------------------------------------------------------------------------------------*/\n\nconst SUB_CONTENT_NAME = 'DropdownMenuSubContent';\n\ntype DropdownMenuSubContentElement = React.ElementRef<typeof MenuPrimitive.Content>;\ntype MenuSubContentProps = Radix.ComponentPropsWithoutRef<typeof MenuPrimitive.SubContent>;\ninterface DropdownMenuSubContentProps extends MenuSubContentProps {}\n\nconst DropdownMenuSubContent = React.forwardRef<\n  DropdownMenuSubContentElement,\n  DropdownMenuSubContentProps\n>((props: ScopedProps<DropdownMenuSubContentProps>, forwardedRef) => {\n  const { __scopeDropdownMenu, ...subContentProps } = props;\n  const menuScope = useMenuScope(__scopeDropdownMenu);\n\n  return (\n    <MenuPrimitive.SubContent\n      {...menuScope}\n      {...subContentProps}\n      ref={forwardedRef}\n      style={{\n        ...props.style,\n        // re-namespace exposed content custom properties\n        ...{\n          '--radix-dropdown-menu-content-transform-origin': 'var(--radix-popper-transform-origin)',\n          '--radix-dropdown-menu-content-available-width': 'var(--radix-popper-available-width)',\n          '--radix-dropdown-menu-content-available-height': 'var(--radix-popper-available-height)',\n          '--radix-dropdown-menu-trigger-width': 'var(--radix-popper-anchor-width)',\n          '--radix-dropdown-menu-trigger-height': 'var(--radix-popper-anchor-height)',\n        },\n      }}\n    />\n  );\n});\n\nDropdownMenuSubContent.displayName = SUB_CONTENT_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst Root = DropdownMenu;\nconst Trigger = DropdownMenuTrigger;\nconst Portal = DropdownMenuPortal;\nconst Content = DropdownMenuContent;\nconst Group = DropdownMenuGroup;\nconst Label = DropdownMenuLabel;\nconst Item = DropdownMenuItem;\nconst CheckboxItem = DropdownMenuCheckboxItem;\nconst RadioGroup = DropdownMenuRadioGroup;\nconst RadioItem = DropdownMenuRadioItem;\nconst ItemIndicator = DropdownMenuItemIndicator;\nconst Separator = DropdownMenuSeparator;\nconst Arrow = DropdownMenuArrow;\nconst Sub = DropdownMenuSub;\nconst SubTrigger = DropdownMenuSubTrigger;\nconst SubContent = DropdownMenuSubContent;\n\nexport {\n  createDropdownMenuScope,\n  //\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuPortal,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuLabel,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioGroup,\n  DropdownMenuRadioItem,\n  DropdownMenuItemIndicator,\n  DropdownMenuSeparator,\n  DropdownMenuArrow,\n  DropdownMenuSub,\n  DropdownMenuSubTrigger,\n  DropdownMenuSubContent,\n  //\n  Root,\n  Trigger,\n  Portal,\n  Content,\n  Group,\n  Label,\n  Item,\n  CheckboxItem,\n  RadioGroup,\n  RadioItem,\n  ItemIndicator,\n  Separator,\n  Arrow,\n  Sub,\n  SubTrigger,\n  SubContent,\n};\nexport type {\n  DropdownMenuProps,\n  DropdownMenuTriggerProps,\n  DropdownMenuPortalProps,\n  DropdownMenuContentProps,\n  DropdownMenuGroupProps,\n  DropdownMenuLabelProps,\n  DropdownMenuItemProps,\n  DropdownMenuCheckboxItemProps,\n  DropdownMenuRadioGroupProps,\n  DropdownMenuRadioItemProps,\n  DropdownMenuItemIndicatorProps,\n  DropdownMenuSeparatorProps,\n  DropdownMenuArrowProps,\n  DropdownMenuSubProps,\n  DropdownMenuSubTriggerProps,\n  DropdownMenuSubContentProps,\n};\n", "import { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { kbd } from '../../kbd-utils'\n\n/** @public */\nexport interface TLUiKbdProps {\n\tchildren: string\n\tvisibleOnMobileLayout?: boolean\n}\n\n/** @public */\nexport function TldrawUiKbd({ children, visibleOnMobileLayout = false }: TLUiKbdProps) {\n\tconst breakpoint = useBreakpoint()\n\tif (!visibleOnMobileLayout && breakpoint < PORTRAIT_BREAKPOINT.MOBILE) return null\n\treturn (\n\t\t<kbd className=\"tlui-kbd\">\n\t\t\t{kbd(children).map((k, i) => (\n\t\t\t\t<span key={i}>{k}</span>\n\t\t\t))}\n\t\t</kbd>\n\t)\n}\n", "import * as _ContextMenu from '@radix-ui/react-context-menu'\nimport { preventDefault, useContainer, useEditor, useEditorComponents } from '@tldraw/editor'\nimport { ReactNode, memo, useCallback } from 'react'\nimport { useMenuIsOpen } from '../../hooks/useMenuIsOpen'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultContextMenuContent } from './DefaultContextMenuContent'\n\n/** @public */\nexport interface TLUiContextMenuProps {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport const DefaultContextMenu = memo(function DefaultContextMenu({\n\tchildren,\n}: TLUiContextMenuProps) {\n\tconst editor = useEditor()\n\n\tconst { Canvas } = useEditorComponents()\n\n\tconst cb = useCallback(\n\t\t(isOpen: boolean) => {\n\t\t\tif (!isOpen) {\n\t\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\n\t\t\t\tif (onlySelectedShape && editor.isShapeOrAncestorLocked(onlySelectedShape)) {\n\t\t\t\t\teditor.setSelectedShapes([])\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Weird route: selecting locked shapes on long press\n\t\t\t\tif (editor.getInstanceState().isCoarsePointer) {\n\t\t\t\t\tconst selectedShapes = editor.getSelectedShapes()\n\t\t\t\t\tconst {\n\t\t\t\t\t\tinputs: { currentPagePoint },\n\t\t\t\t\t} = editor\n\n\t\t\t\t\t// get all of the shapes under the current pointer\n\t\t\t\t\tconst shapesAtPoint = editor.getShapesAtPoint(currentPagePoint)\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t// if there are no selected shapes\n\t\t\t\t\t\t!editor.getSelectedShapes().length ||\n\t\t\t\t\t\t// OR if none of the shapes at the point include the selected shape\n\t\t\t\t\t\t!shapesAtPoint.some((s) => selectedShapes.includes(s))\n\t\t\t\t\t) {\n\t\t\t\t\t\t// then are there any locked shapes under the current pointer?\n\t\t\t\t\t\tconst lockedShapes = shapesAtPoint.filter((s) => editor.isShapeOrAncestorLocked(s))\n\n\t\t\t\t\t\tif (lockedShapes.length) {\n\t\t\t\t\t\t\t// nice, let's select them\n\t\t\t\t\t\t\teditor.select(...lockedShapes.map((s) => s.id))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst container = useContainer()\n\tconst [isOpen, handleOpenChange] = useMenuIsOpen('context menu', cb)\n\n\t// Get the context menu content, either the default component or the user's\n\t// override. If there's no menu content, then the user has set it to null,\n\t// so skip rendering the menu.\n\tconst content = children ?? <DefaultContextMenuContent />\n\n\treturn (\n\t\t<_ContextMenu.Root dir=\"ltr\" onOpenChange={handleOpenChange} modal={false}>\n\t\t\t<_ContextMenu.Trigger onContextMenu={undefined} dir=\"ltr\">\n\t\t\t\t{Canvas ? <Canvas /> : null}\n\t\t\t</_ContextMenu.Trigger>\n\t\t\t{isOpen && (\n\t\t\t\t<_ContextMenu.Portal container={container}>\n\t\t\t\t\t<_ContextMenu.Content\n\t\t\t\t\t\tclassName=\"tlui-menu scrollable\"\n\t\t\t\t\t\tdata-testid=\"context-menu\"\n\t\t\t\t\t\talignOffset={-4}\n\t\t\t\t\t\tcollisionPadding={4}\n\t\t\t\t\t\tonContextMenu={preventDefault}\n\t\t\t\t\t>\n\t\t\t\t\t\t<TldrawUiMenuContextProvider type=\"context-menu\" sourceId=\"context-menu\">\n\t\t\t\t\t\t\t{content}\n\t\t\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t\t\t</_ContextMenu.Content>\n\t\t\t\t</_ContextMenu.Portal>\n\t\t\t)}\n\t\t</_ContextMenu.Root>\n\t)\n})\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport {\n\tArrangeMenuSubmenu,\n\tClipboardMenuGroup,\n\tConversionsMenuGroup,\n\tConvertToBookmarkMenuItem,\n\tConvertToEmbedMenuItem,\n\tEditLinkMenuItem,\n\tFitFrameToContentMenuItem,\n\tGroupMenuItem,\n\tMoveToPageMenu,\n\tRemoveFrameMenuItem,\n\tReorderMenuSubmenu,\n\tSelectAllMenuItem,\n\tToggleAutoSizeMenuItem,\n\tToggleLockMenuItem,\n\tUngroupMenuItem,\n} from '../menu-items'\nimport { TldrawUiMenuGroup } from '../primitives/menus/TldrawUiMenuGroup'\n\n/** @public */\nexport function DefaultContextMenuContent() {\n\tconst editor = useEditor()\n\n\tconst selectToolActive = useValue(\n\t\t'isSelectToolActive',\n\t\t() => editor.getCurrentToolId() === 'select',\n\t\t[editor]\n\t)\n\n\tif (!selectToolActive) return null\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuGroup id=\"misc\">\n\t\t\t\t<GroupMenuItem />\n\t\t\t\t<UngroupMenuItem />\n\t\t\t\t<EditLinkMenuItem />\n\t\t\t\t<ToggleAutoSizeMenuItem />\n\t\t\t\t<RemoveFrameMenuItem />\n\t\t\t\t<FitFrameToContentMenuItem />\n\t\t\t\t<ConvertToEmbedMenuItem />\n\t\t\t\t<ConvertToBookmarkMenuItem />\n\t\t\t\t<ToggleLockMenuItem />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup id=\"modify\">\n\t\t\t\t<ArrangeMenuSubmenu />\n\t\t\t\t<ReorderMenuSubmenu />\n\t\t\t\t<MoveToPageMenu />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<ClipboardMenuGroup />\n\t\t\t<ConversionsMenuGroup />\n\t\t\t<TldrawUiMenuGroup id=\"select-all\">\n\t\t\t\t<SelectAllMenuItem />\n\t\t\t</TldrawUiMenuGroup>\n\t\t</>\n\t)\n}\n", "import {\n\tTLBookmarkShape,\n\tTLEmbedShape,\n\tTLFrameShape,\n\tTLPageId,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\nimport { getEmbedInfo } from '../../utils/embeds/embeds'\nimport { useActions } from '../context/actions'\nimport { useUiEvents } from '../context/events'\nimport { useToasts } from '../context/toasts'\nimport {\n\tshowMenuPaste,\n\tuseAllowGroup,\n\tuseAllowUngroup,\n\tuseAnySelectedShapesCount,\n\tuseHasLinkShapeSelected,\n\tuseOnlyFlippableShape,\n\tuseShowAutoSizeToggle,\n\tuseThreeStackableItems,\n\tuseUnlockedSelectedShapesCount,\n} from '../hooks/menu-hooks'\nimport { TldrawUiMenuCheckboxItem } from './primitives/menus/TldrawUiMenuCheckboxItem'\nimport { TldrawUiMenuGroup } from './primitives/menus/TldrawUiMenuGroup'\nimport { TldrawUiMenuItem } from './primitives/menus/TldrawUiMenuItem'\nimport { TldrawUiMenuSubmenu } from './primitives/menus/TldrawUiMenuSubmenu'\n\n/* -------------------- Selection ------------------- */\n/** @public */\nexport function ToggleAutoSizeMenuItem() {\n\tconst actions = useActions()\n\tconst shouldDisplay = useShowAutoSizeToggle()\n\tif (!shouldDisplay) return null\n\treturn <TldrawUiMenuItem {...actions['toggle-auto-size']} />\n}\n/** @public */\nexport function EditLinkMenuItem() {\n\tconst actions = useActions()\n\tconst shouldDisplay = useHasLinkShapeSelected()\n\tif (!shouldDisplay) return null\n\n\treturn <TldrawUiMenuItem {...actions['edit-link']} />\n}\n/** @public */\nexport function DuplicateMenuItem() {\n\tconst actions = useActions()\n\tconst shouldDisplay = useUnlockedSelectedShapesCount(1)\n\tif (!shouldDisplay) return null\n\n\treturn <TldrawUiMenuItem {...actions['duplicate']} />\n}\n/** @public */\nexport function GroupMenuItem() {\n\tconst actions = useActions()\n\tconst shouldDisplay = useAllowGroup()\n\tif (!shouldDisplay) return null\n\n\treturn <TldrawUiMenuItem {...actions['group']} />\n}\n/** @public */\nexport function UngroupMenuItem() {\n\tconst actions = useActions()\n\tconst shouldDisplay = useAllowUngroup()\n\tif (!shouldDisplay) return null\n\n\treturn <TldrawUiMenuItem {...actions['ungroup']} />\n}\n/** @public */\nexport function RemoveFrameMenuItem() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\tconst shouldDisplay = useValue(\n\t\t'allow unframe',\n\t\t() => {\n\t\t\tconst selectedShapes = editor.getSelectedShapes()\n\t\t\tif (selectedShapes.length === 0) return false\n\t\t\treturn selectedShapes.every((shape) => editor.isShapeOfType<TLFrameShape>(shape, 'frame'))\n\t\t},\n\t\t[editor]\n\t)\n\tif (!shouldDisplay) return null\n\n\treturn <TldrawUiMenuItem {...actions['remove-frame']} />\n}\n/** @public */\nexport function FitFrameToContentMenuItem() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\tconst shouldDisplay = useValue(\n\t\t'allow fit frame to content',\n\t\t() => {\n\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\t\tif (!onlySelectedShape) return false\n\t\t\treturn (\n\t\t\t\teditor.isShapeOfType<TLFrameShape>(onlySelectedShape, 'frame') &&\n\t\t\t\teditor.getSortedChildIdsForParent(onlySelectedShape).length > 0\n\t\t\t)\n\t\t},\n\t\t[editor]\n\t)\n\tif (!shouldDisplay) return null\n\n\treturn <TldrawUiMenuItem {...actions['fit-frame-to-content']} />\n}\n/** @public */\nexport function ToggleLockMenuItem() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\tconst shouldDisplay = useValue('selected shapes', () => editor.getSelectedShapes().length > 0, [\n\t\teditor,\n\t])\n\tif (!shouldDisplay) return null\n\n\treturn <TldrawUiMenuItem {...actions['toggle-lock']} />\n}\n/** @public */\nexport function ToggleTransparentBgMenuItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isTransparentBg = useValue(\n\t\t'isTransparentBg',\n\t\t() => !editor.getInstanceState().exportBackground,\n\t\t[editor]\n\t)\n\treturn <TldrawUiMenuCheckboxItem {...actions['toggle-transparent']} checked={isTransparentBg} />\n}\n/** @public */\nexport function UnlockAllMenuItem() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\tconst shouldDisplay = useValue('any shapes', () => editor.getCurrentPageShapeIds().size > 0, [\n\t\teditor,\n\t])\n\n\treturn <TldrawUiMenuItem {...actions['unlock-all']} disabled={!shouldDisplay} />\n}\n\n/* ---------------------- Zoom ---------------------- */\n/** @public */\nexport function ZoomTo100MenuItem() {\n\tconst editor = useEditor()\n\tconst isZoomedTo100 = useValue('zoomed to 100', () => editor.getZoomLevel() === 1, [editor])\n\tconst actions = useActions()\n\n\treturn <TldrawUiMenuItem {...actions['zoom-to-100']} noClose disabled={isZoomedTo100} />\n}\n/** @public */\nexport function ZoomToFitMenuItem() {\n\tconst editor = useEditor()\n\tconst hasShapes = useValue('has shapes', () => editor.getCurrentPageShapeIds().size > 0, [editor])\n\tconst actions = useActions()\n\n\treturn (\n\t\t<TldrawUiMenuItem\n\t\t\t{...actions['zoom-to-fit']}\n\t\t\tdisabled={!hasShapes}\n\t\t\tdata-testid=\"minimap.zoom-menu.zoom-to-fit\"\n\t\t\tnoClose\n\t\t/>\n\t)\n}\n/** @public */\nexport function ZoomToSelectionMenuItem() {\n\tconst editor = useEditor()\n\tconst hasSelected = useValue('has shapes', () => editor.getSelectedShapeIds().length > 0, [\n\t\teditor,\n\t])\n\tconst actions = useActions()\n\n\treturn (\n\t\t<TldrawUiMenuItem\n\t\t\t{...actions['zoom-to-selection']}\n\t\t\tdisabled={!hasSelected}\n\t\t\tdata-testid=\"minimap.zoom-menu.zoom-to-selection\"\n\t\t\tnoClose\n\t\t/>\n\t)\n}\n\n/* -------------------- Clipboard ------------------- */\n\n/** @public */\nexport function ClipboardMenuGroup() {\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"clipboard\">\n\t\t\t<CutMenuItem />\n\t\t\t<CopyMenuItem />\n\t\t\t<PasteMenuItem />\n\t\t\t<DuplicateMenuItem />\n\t\t\t<DeleteMenuItem />\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n\n/** @public */\nexport function CopyAsMenuGroup() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\tconst atLeastOneShapeOnPage = useValue(\n\t\t'atLeastOneShapeOnPage',\n\t\t() => editor.getCurrentPageShapeIds().size > 0,\n\t\t[editor]\n\t)\n\n\treturn (\n\t\t<TldrawUiMenuSubmenu\n\t\t\tid=\"copy-as\"\n\t\t\tlabel=\"context-menu.copy-as\"\n\t\t\tsize=\"small\"\n\t\t\tdisabled={!atLeastOneShapeOnPage}\n\t\t>\n\t\t\t<TldrawUiMenuGroup id=\"copy-as-group\">\n\t\t\t\t<TldrawUiMenuItem {...actions['copy-as-svg']} />\n\t\t\t\t{Boolean(window.navigator.clipboard?.write) && (\n\t\t\t\t\t<TldrawUiMenuItem {...actions['copy-as-png']} />\n\t\t\t\t)}\n\t\t\t\t<TldrawUiMenuItem {...actions['copy-as-json']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup id=\"copy-as-bg\">\n\t\t\t\t<ToggleTransparentBgMenuItem />\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n\n/** @public */\nexport function CutMenuItem() {\n\tconst actions = useActions()\n\tconst shouldDisplay = useUnlockedSelectedShapesCount(1)\n\n\treturn <TldrawUiMenuItem {...actions['cut']} disabled={!shouldDisplay} />\n}\n\n/** @public */\nexport function CopyMenuItem() {\n\tconst actions = useActions()\n\tconst shouldDisplay = useAnySelectedShapesCount(1)\n\n\treturn <TldrawUiMenuItem {...actions['copy']} disabled={!shouldDisplay} />\n}\n\n/** @public */\nexport function PasteMenuItem() {\n\tconst actions = useActions()\n\tconst shouldDisplay = showMenuPaste\n\n\treturn <TldrawUiMenuItem {...actions['paste']} disabled={!shouldDisplay} />\n}\n\n/* ------------------- Conversions ------------------ */\n\n/** @public */\nexport function ConversionsMenuGroup() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\tconst atLeastOneShapeOnPage = useValue(\n\t\t'atLeastOneShapeOnPage',\n\t\t() => editor.getCurrentPageShapeIds().size > 0,\n\t\t[editor]\n\t)\n\n\tif (!atLeastOneShapeOnPage) return null\n\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"conversions\">\n\t\t\t<CopyAsMenuGroup />\n\t\t\t<TldrawUiMenuSubmenu id=\"export-as\" label=\"context-menu.export-as\" size=\"small\">\n\t\t\t\t<TldrawUiMenuGroup id=\"export-as-group\">\n\t\t\t\t\t<TldrawUiMenuItem {...actions['export-as-svg']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['export-as-png']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['export-as-json']} />\n\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t\t<TldrawUiMenuGroup id=\"export-as-bg\">\n\t\t\t\t\t<ToggleTransparentBgMenuItem />\n\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t</TldrawUiMenuSubmenu>\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n\n/* ------------------ Set Selection ----------------- */\n/** @public */\nexport function SelectAllMenuItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst atLeastOneShapeOnPage = useValue(\n\t\t'atLeastOneShapeOnPage',\n\t\t() => editor.getCurrentPageShapeIds().size > 0,\n\t\t[editor]\n\t)\n\n\treturn <TldrawUiMenuItem {...actions['select-all']} disabled={!atLeastOneShapeOnPage} />\n}\n\n/* ------------------ Delete Group ------------------ */\n/** @public */\nexport function DeleteMenuItem() {\n\tconst actions = useActions()\n\tconst oneSelected = useUnlockedSelectedShapesCount(1)\n\n\treturn <TldrawUiMenuItem {...actions['delete']} disabled={!oneSelected} />\n}\n\n/* --------------------- Modify --------------------- */\n/** @public */\nexport function ArrangeMenuSubmenu() {\n\tconst twoSelected = useUnlockedSelectedShapesCount(2)\n\tconst onlyFlippableShapeSelected = useOnlyFlippableShape()\n\tconst actions = useActions()\n\n\tif (!(twoSelected || onlyFlippableShapeSelected)) return null\n\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"arrange\" label=\"context-menu.arrange\" size=\"small\">\n\t\t\t{twoSelected && (\n\t\t\t\t<TldrawUiMenuGroup id=\"align\">\n\t\t\t\t\t<TldrawUiMenuItem {...actions['align-left']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['align-center-horizontal']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['align-right']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['align-top']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['align-center-vertical']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['align-bottom']} />\n\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t)}\n\t\t\t<DistributeMenuGroup />\n\t\t\t{twoSelected && (\n\t\t\t\t<TldrawUiMenuGroup id=\"stretch\">\n\t\t\t\t\t<TldrawUiMenuItem {...actions['stretch-horizontal']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['stretch-vertical']} />\n\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t)}\n\t\t\t{(twoSelected || onlyFlippableShapeSelected) && (\n\t\t\t\t<TldrawUiMenuGroup id=\"flip\">\n\t\t\t\t\t<TldrawUiMenuItem {...actions['flip-horizontal']} />\n\t\t\t\t\t<TldrawUiMenuItem {...actions['flip-vertical']} />\n\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t)}\n\t\t\t<OrderMenuGroup />\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n\nfunction DistributeMenuGroup() {\n\tconst actions = useActions()\n\tconst threeSelected = useUnlockedSelectedShapesCount(3)\n\tif (!threeSelected) return null\n\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"distribute\">\n\t\t\t<TldrawUiMenuItem {...actions['distribute-horizontal']} />\n\t\t\t<TldrawUiMenuItem {...actions['distribute-vertical']} />\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n\nfunction OrderMenuGroup() {\n\tconst actions = useActions()\n\tconst twoSelected = useUnlockedSelectedShapesCount(2)\n\tconst threeStackableItems = useThreeStackableItems()\n\tif (!twoSelected) return null\n\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"order\">\n\t\t\t<TldrawUiMenuItem {...actions['pack']} />\n\t\t\t{threeStackableItems && <TldrawUiMenuItem {...actions['stack-horizontal']} />}\n\t\t\t{threeStackableItems && <TldrawUiMenuItem {...actions['stack-vertical']} />}\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n/** @public */\nexport function ReorderMenuSubmenu() {\n\tconst actions = useActions()\n\tconst oneSelected = useUnlockedSelectedShapesCount(1)\n\tif (!oneSelected) return null\n\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"reorder\" label=\"context-menu.reorder\" size=\"small\">\n\t\t\t<TldrawUiMenuGroup id=\"reorder\">\n\t\t\t\t<TldrawUiMenuItem {...actions['bring-to-front']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['bring-forward']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['send-backward']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['send-to-back']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n/** @public */\nexport function MoveToPageMenu() {\n\tconst editor = useEditor()\n\tconst pages = useValue('pages', () => editor.getPages(), [editor])\n\tconst currentPageId = useValue('current page id', () => editor.getCurrentPageId(), [editor])\n\tconst { addToast } = useToasts()\n\tconst actions = useActions()\n\tconst trackEvent = useUiEvents()\n\n\tconst oneSelected = useUnlockedSelectedShapesCount(1)\n\tif (!oneSelected) return null\n\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"move-to-page\" label=\"context-menu.move-to-page\" size=\"small\">\n\t\t\t<TldrawUiMenuGroup id=\"pages\">\n\t\t\t\t{pages.map((page) => (\n\t\t\t\t\t<TldrawUiMenuItem\n\t\t\t\t\t\tid={page.id}\n\t\t\t\t\t\tkey={page.id}\n\t\t\t\t\t\tdisabled={currentPageId === page.id}\n\t\t\t\t\t\tlabel={page.name}\n\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\teditor.mark('move_shapes_to_page')\n\t\t\t\t\t\t\teditor.moveShapesToPage(editor.getSelectedShapeIds(), page.id as TLPageId)\n\n\t\t\t\t\t\t\tconst toPage = editor.getPage(page.id)\n\n\t\t\t\t\t\t\tif (toPage) {\n\t\t\t\t\t\t\t\taddToast({\n\t\t\t\t\t\t\t\t\ttitle: 'Changed Page',\n\t\t\t\t\t\t\t\t\tdescription: `Moved to ${toPage.name}.`,\n\t\t\t\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tlabel: 'Go Back',\n\t\t\t\t\t\t\t\t\t\t\ttype: 'primary',\n\t\t\t\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\t\t\t\teditor.mark('change-page')\n\t\t\t\t\t\t\t\t\t\t\t\teditor.setCurrentPage(currentPageId)\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttrackEvent('move-to-page', { source: 'context-menu' })\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup id=\"new-page\">\n\t\t\t\t<TldrawUiMenuItem {...actions['new-page']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n\n/** @public */\nexport function ConvertToBookmarkMenuItem() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\n\tconst oneEmbedSelected = useValue(\n\t\t'oneEmbedSelected',\n\t\t() => {\n\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\t\tif (!onlySelectedShape) return false\n\t\t\treturn !!(\n\t\t\t\teditor.isShapeOfType<TLEmbedShape>(onlySelectedShape, 'embed') &&\n\t\t\t\tonlySelectedShape.props.url &&\n\t\t\t\t!editor.isShapeOrAncestorLocked(onlySelectedShape)\n\t\t\t)\n\t\t},\n\t\t[editor]\n\t)\n\n\tif (!oneEmbedSelected) return null\n\treturn <TldrawUiMenuItem {...actions['convert-to-bookmark']} />\n}\n\n/** @public */\nexport function ConvertToEmbedMenuItem() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\n\tconst oneEmbeddableBookmarkSelected = useValue(\n\t\t'oneEmbeddableBookmarkSelected',\n\t\t() => {\n\t\t\tconst onlySelectedShape = editor.getOnlySelectedShape()\n\t\t\tif (!onlySelectedShape) return false\n\t\t\treturn !!(\n\t\t\t\teditor.isShapeOfType<TLBookmarkShape>(onlySelectedShape, 'bookmark') &&\n\t\t\t\tonlySelectedShape.props.url &&\n\t\t\t\tgetEmbedInfo(onlySelectedShape.props.url) &&\n\t\t\t\t!editor.isShapeOrAncestorLocked(onlySelectedShape)\n\t\t\t)\n\t\t},\n\t\t[editor]\n\t)\n\n\tif (!oneEmbeddableBookmarkSelected) return null\n\n\treturn <TldrawUiMenuItem {...actions['convert-to-embed']} />\n}\n\n/* ------------------- Preferences ------------------ */\n/** @public */\nexport function ToggleSnapModeItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isSnapMode = useValue('isSnapMode', () => editor.user.getIsSnapMode(), [editor])\n\treturn <TldrawUiMenuCheckboxItem {...actions['toggle-snap-mode']} checked={isSnapMode} />\n}\n/** @public */\nexport function ToggleToolLockItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isToolLock = useValue('isToolLock', () => editor.getInstanceState().isToolLocked, [editor])\n\treturn <TldrawUiMenuCheckboxItem {...actions['toggle-tool-lock']} checked={isToolLock} />\n}\n/** @public */\nexport function ToggleGridItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isGridMode = useValue('isGridMode', () => editor.getInstanceState().isGridMode, [editor])\n\treturn <TldrawUiMenuCheckboxItem {...actions['toggle-grid']} checked={isGridMode} />\n}\n\n/** @public */\nexport function ToggleWrapModeItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isWrapMode = useValue('isWrapMode', () => editor.user.getIsWrapMode(), [editor])\n\treturn <TldrawUiMenuCheckboxItem {...actions['toggle-wrap-mode']} checked={isWrapMode} />\n}\n\n/** @public */\nexport function ToggleDarkModeItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isDarkMode = useValue('isDarkMode', () => editor.user.getIsDarkMode(), [editor])\n\treturn <TldrawUiMenuCheckboxItem {...actions['toggle-dark-mode']} checked={isDarkMode} />\n}\n/** @public */\nexport function ToggleFocusModeItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isFocusMode = useValue('isFocusMode', () => editor.getInstanceState().isFocusMode, [editor])\n\treturn <TldrawUiMenuCheckboxItem {...actions['toggle-focus-mode']} checked={isFocusMode} />\n}\n/** @public */\nexport function ToggleEdgeScrollingItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst edgeScrollSpeed = useValue('edgeScrollSpeed', () => editor.user.getEdgeScrollSpeed(), [\n\t\teditor,\n\t])\n\treturn (\n\t\t<TldrawUiMenuCheckboxItem\n\t\t\t{...actions['toggle-edge-scrolling']}\n\t\t\tchecked={edgeScrollSpeed === 1}\n\t\t/>\n\t)\n}\n/** @public */\nexport function ToggleReduceMotionItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst animationSpeed = useValue('animationSpeed', () => editor.user.getAnimationSpeed(), [editor])\n\treturn (\n\t\t<TldrawUiMenuCheckboxItem {...actions['toggle-reduce-motion']} checked={animationSpeed === 0} />\n\t)\n}\n/** @public */\nexport function ToggleDebugModeItem() {\n\tconst actions = useActions()\n\tconst editor = useEditor()\n\tconst isDebugMode = useValue('isDebugMode', () => editor.getInstanceState().isDebugMode, [editor])\n\treturn <TldrawUiMenuCheckboxItem {...actions['toggle-debug-mode']} checked={isDebugMode} />\n}\n\n/* ---------------------- Print --------------------- */\n/** @public */\nexport function PrintItem() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\tconst emptyPage = useValue('emptyPage', () => editor.getCurrentPageShapeIds().size === 0, [\n\t\teditor,\n\t])\n\treturn <TldrawUiMenuItem {...actions['print']} disabled={emptyPage} />\n}\n", "import * as _ContextMenu from '@radix-ui/react-context-menu'\nimport * as _DropdownMenu from '@radix-ui/react-dropdown-menu'\nimport { preventDefault } from '@tldraw/editor'\nimport { unwrapLabel } from '../../../context/actions'\nimport { TLUiEventSource } from '../../../context/events'\nimport { useReadonly } from '../../../hooks/useReadonly'\nimport { TLUiTranslationKey } from '../../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../../hooks/useTranslation/useTranslation'\nimport { TldrawUiIcon } from '../TldrawUiIcon'\nimport { TldrawUiKbd } from '../TldrawUiKbd'\nimport { useTldrawUiMenuContext } from './TldrawUiMenuContext'\n\n/** @public */\nexport type TLUiMenuCheckboxItemProps<\n\tTranslationKey extends string = string,\n\tIconType extends string = string,\n> = {\n\ticon?: IconType\n\tid: string\n\tkbd?: string\n\ttitle?: string\n\tlabel?: TranslationKey | { [key: string]: TranslationKey }\n\treadonlyOk?: boolean\n\tonSelect: (source: TLUiEventSource) => Promise<void> | void\n\tchecked?: boolean\n\tdisabled?: boolean\n}\n\n/** @public */\nexport function TldrawUiMenuCheckboxItem<\n\tTranslationKey extends string = string,\n\tIconType extends string = string,\n>({\n\tid,\n\tkbd,\n\tlabel,\n\treadonlyOk,\n\tonSelect,\n\tdisabled = false,\n\tchecked = false,\n}: TLUiMenuCheckboxItemProps<TranslationKey, IconType>) {\n\tconst { type: menuType, sourceId } = useTldrawUiMenuContext()\n\tconst isReadonlyMode = useReadonly()\n\tconst msg = useTranslation()\n\n\t// If the editor is in readonly mode and the item is not marked as readonlyok, return null\n\tif (isReadonlyMode && !readonlyOk) return null\n\n\tconst labelToUse = unwrapLabel(label, menuType)\n\tconst labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined\n\n\tswitch (menuType) {\n\t\tcase 'menu': {\n\t\t\treturn (\n\t\t\t\t<_DropdownMenu.CheckboxItem\n\t\t\t\t\tdir=\"ltr\"\n\t\t\t\t\tclassName=\"tlui-button tlui-button__menu tlui-button__checkbox\"\n\t\t\t\t\ttitle={labelStr}\n\t\t\t\t\tonSelect={(e) => {\n\t\t\t\t\t\tonSelect?.(sourceId)\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t}}\n\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\tchecked={checked}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiIcon small icon={checked ? 'check' : 'checkbox-empty'} />\n\t\t\t\t\t{labelStr && (\n\t\t\t\t\t\t<span className=\"tlui-button__label\" draggable={false}>\n\t\t\t\t\t\t\t{labelStr}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t\t{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}\n\t\t\t\t</_DropdownMenu.CheckboxItem>\n\t\t\t)\n\t\t}\n\t\tcase 'context-menu': {\n\t\t\treturn (\n\t\t\t\t<_ContextMenu.CheckboxItem\n\t\t\t\t\tkey={id}\n\t\t\t\t\tclassName=\"tlui-button tlui-button__menu tlui-button__checkbox\"\n\t\t\t\t\tdir=\"ltr\"\n\t\t\t\t\ttitle={labelStr}\n\t\t\t\t\tonSelect={(e) => {\n\t\t\t\t\t\tonSelect(sourceId)\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t}}\n\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\tchecked={checked}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiIcon small icon={checked ? 'check' : 'checkbox-empty'} />\n\t\t\t\t\t{labelStr && (\n\t\t\t\t\t\t<span className=\"tlui-button__label\" draggable={false}>\n\t\t\t\t\t\t\t{labelStr}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t\t{kbd && <TldrawUiKbd>{kbd}</TldrawUiKbd>}\n\t\t\t\t</_ContextMenu.CheckboxItem>\n\t\t\t)\n\t\t}\n\t\tdefault: {\n\t\t\t// no checkbox items in actions menu\n\t\t\treturn null\n\t\t}\n\t}\n}\n", "import { ContextMenuGroup } from '@radix-ui/react-context-menu'\nimport { ReactNode } from 'react'\nimport { unwrapLabel } from '../../../context/actions'\nimport { TLUiTranslationKey } from '../../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../../hooks/useTranslation/useTranslation'\nimport { TldrawUiDropdownMenuGroup } from '../TldrawUiDropdownMenu'\nimport { useTldrawUiMenuContext } from './TldrawUiMenuContext'\n\n/** @public */\nexport type TLUiMenuGroupProps<TranslationKey extends string = string> = {\n\tid: string\n\t/**\n\t * The label to display on the item. If it's a string, it will be translated. If it's an object, the keys will be used as the language keys and the values will be translated.\n\t */\n\tlabel?: TranslationKey | { [key: string]: TranslationKey }\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport function TldrawUiMenuGroup({ id, label, children }: TLUiMenuGroupProps) {\n\tconst { type: menuType, sourceId } = useTldrawUiMenuContext()\n\tconst msg = useTranslation()\n\tconst labelToUse = unwrapLabel(label, menuType)\n\tconst labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined\n\n\tswitch (menuType) {\n\t\tcase 'panel': {\n\t\t\treturn (\n\t\t\t\t<div className=\"tlui-menu__group\" data-testid={`${sourceId}-group.${id}`}>\n\t\t\t\t\t{children}\n\t\t\t\t</div>\n\t\t\t)\n\t\t}\n\t\tcase 'menu': {\n\t\t\treturn (\n\t\t\t\t<TldrawUiDropdownMenuGroup data-testid={`${sourceId}-group.${id}`}>\n\t\t\t\t\t{children}\n\t\t\t\t</TldrawUiDropdownMenuGroup>\n\t\t\t)\n\t\t}\n\t\tcase 'context-menu': {\n\t\t\treturn (\n\t\t\t\t<ContextMenuGroup\n\t\t\t\t\tdir=\"ltr\"\n\t\t\t\t\tclassName=\"tlui-menu__group\"\n\t\t\t\t\tdata-testid={`${sourceId}-group.${id}`}\n\t\t\t\t>\n\t\t\t\t\t{children}\n\t\t\t\t</ContextMenuGroup>\n\t\t\t)\n\t\t}\n\t\tcase 'keyboard-shortcuts': {\n\t\t\t// todo: if groups need a label, let's give em a label\n\t\t\treturn (\n\t\t\t\t<div className=\"tlui-shortcuts-dialog__group\" data-testid={`${sourceId}-group.${id}`}>\n\t\t\t\t\t<h2 className=\"tlui-shortcuts-dialog__group__title\">{labelStr}</h2>\n\t\t\t\t\t<div className=\"tlui-shortcuts-dialog__group__content\">{children}</div>\n\t\t\t\t</div>\n\t\t\t)\n\t\t}\n\t\tdefault: {\n\t\t\treturn children\n\t\t}\n\t}\n}\n", "import {\n\tContextMenuPortal,\n\tContextMenuSub,\n\tContextMenuSubContent,\n\tContextMenuSubTrigger,\n} from '@radix-ui/react-context-menu'\nimport { useContainer } from '@tldraw/editor'\nimport { ReactNode } from 'react'\nimport { useMenuIsOpen } from '../../../hooks/useMenuIsOpen'\nimport { TLUiTranslationKey } from '../../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../Button/TldrawUiButtonIcon'\nimport { TldrawUiButtonLabel } from '../Button/TldrawUiButtonLabel'\nimport {\n\tTldrawUiDropdownMenuSub,\n\tTldrawUiDropdownMenuSubContent,\n\tTldrawUiDropdownMenuSubTrigger,\n} from '../TldrawUiDropdownMenu'\nimport { useTldrawUiMenuContext } from './TldrawUiMenuContext'\n\n/** @public */\nexport type TLUiMenuSubmenuProps<Translation extends string = string> = {\n\tid: string\n\tlabel?: Translation | { [key: string]: Translation }\n\tdisabled?: boolean\n\tchildren: ReactNode\n\tsize?: 'tiny' | 'small' | 'medium' | 'wide'\n}\n\n/** @public */\nexport function TldrawUiMenuSubmenu<Translation extends string = string>({\n\tid,\n\tdisabled = false,\n\tlabel,\n\tsize = 'small',\n\tchildren,\n}: TLUiMenuSubmenuProps<Translation>) {\n\tconst { type: menuType, sourceId } = useTldrawUiMenuContext()\n\tconst container = useContainer()\n\tconst msg = useTranslation()\n\tconst labelToUse = label\n\t\t? typeof label === 'string'\n\t\t\t? label\n\t\t\t: label[menuType] ?? label['default']\n\t\t: undefined\n\tconst labelStr = labelToUse ? msg(labelToUse as TLUiTranslationKey) : undefined\n\n\tswitch (menuType) {\n\t\tcase 'menu': {\n\t\t\treturn (\n\t\t\t\t<TldrawUiDropdownMenuSub id={`${sourceId}-sub.${id}`}>\n\t\t\t\t\t<TldrawUiDropdownMenuSubTrigger\n\t\t\t\t\t\tid={`${sourceId}-sub.${labelStr ? labelStr.toLowerCase() + '-button' : ''}`}\n\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\tlabel={labelStr!}\n\t\t\t\t\t\ttitle={labelStr!}\n\t\t\t\t\t/>\n\t\t\t\t\t<TldrawUiDropdownMenuSubContent\n\t\t\t\t\t\tid={`${sourceId}-sub.${labelStr ? labelStr.toLowerCase() + '-content' : ''}`}\n\t\t\t\t\t\tsize={size}\n\t\t\t\t\t>\n\t\t\t\t\t\t{children}\n\t\t\t\t\t</TldrawUiDropdownMenuSubContent>\n\t\t\t\t</TldrawUiDropdownMenuSub>\n\t\t\t)\n\t\t}\n\t\tcase 'context-menu': {\n\t\t\tif (disabled) return null\n\n\t\t\treturn (\n\t\t\t\t<ContextMenuSubWithMenu id={`${sourceId}-sub.${id}`}>\n\t\t\t\t\t<ContextMenuSubTrigger dir=\"ltr\" disabled={disabled} asChild>\n\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\tdata-testid={`${sourceId}-sub-trigger.${id}`}\n\t\t\t\t\t\t\ttype=\"menu\"\n\t\t\t\t\t\t\tclassName=\"tlui-menu__submenu__trigger\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>\n\t\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"chevron-right\" small />\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t</ContextMenuSubTrigger>\n\t\t\t\t\t<ContextMenuPortal container={container}>\n\t\t\t\t\t\t<ContextMenuSubContent\n\t\t\t\t\t\t\tdata-testid={`${sourceId}-sub-content.${id}`}\n\t\t\t\t\t\t\tclassName=\"tlui-menu tlui-menu__submenu__content\"\n\t\t\t\t\t\t\talignOffset={-1}\n\t\t\t\t\t\t\tsideOffset={-4}\n\t\t\t\t\t\t\tcollisionPadding={4}\n\t\t\t\t\t\t\tdata-size={size}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{children}\n\t\t\t\t\t\t</ContextMenuSubContent>\n\t\t\t\t\t</ContextMenuPortal>\n\t\t\t\t</ContextMenuSubWithMenu>\n\t\t\t)\n\t\t}\n\t\tdefault: {\n\t\t\t// no submenus in actions\n\t\t\treturn children\n\t\t}\n\t}\n}\n\n/** @private */\nexport type TLUiContextMenuSubProps = { id: string; children: ReactNode }\n\n/** @private */\nexport function ContextMenuSubWithMenu({ id, children }: TLUiContextMenuSubProps) {\n\tconst [open, onOpenChange] = useMenuIsOpen(id)\n\n\treturn (\n\t\t<ContextMenuSub open={open} onOpenChange={onOpenChange}>\n\t\t\t{children}\n\t\t</ContextMenuSub>\n\t)\n}\n", "import { ReactNode } from 'react'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport {\n\tTldrawUiDropdownMenuContent,\n\tTldrawUiDropdownMenuRoot,\n\tTldrawUiDropdownMenuTrigger,\n} from '../primitives/TldrawUiDropdownMenu'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultDebugMenuContent } from './DefaultDebugMenuContent'\n\n/** @public */\nexport type TLUiDebugMenuProps = {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport function DefaultDebugMenu({ children }: TLUiDebugMenuProps) {\n\tconst content = children ?? <DefaultDebugMenuContent />\n\n\treturn (\n\t\t<TldrawUiDropdownMenuRoot id=\"debug\">\n\t\t\t<TldrawUiDropdownMenuTrigger>\n\t\t\t\t<TldrawUiButton type=\"icon\" title=\"Debug menu\">\n\t\t\t\t\t<TldrawUiButtonIcon icon=\"dots-horizontal\" />\n\t\t\t\t</TldrawUiButton>\n\t\t\t</TldrawUiDropdownMenuTrigger>\n\t\t\t<TldrawUiDropdownMenuContent side=\"top\" align=\"end\" alignOffset={0}>\n\t\t\t\t<TldrawUiMenuContextProvider type=\"menu\" sourceId=\"debug-panel\">\n\t\t\t\t\t{content}\n\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t</TldrawUiDropdownMenuContent>\n\t\t</TldrawUiDropdownMenuRoot>\n\t)\n}\n", "import {\n\tDebugFlag,\n\tEditor,\n\tTLShapePartial,\n\tcreateShapeId,\n\tdebugFlags,\n\tfeatureFlags,\n\thardResetEditor,\n\ttrack,\n\tuniqueId,\n\tuseEditor,\n} from '@tldraw/editor'\nimport React from 'react'\nimport { useDialogs } from '../../context/dialogs'\nimport { useToasts } from '../../context/toasts'\nimport { untranslated } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonCheck } from '../primitives/Button/TldrawUiButtonCheck'\nimport { TldrawUiButtonLabel } from '../primitives/Button/TldrawUiButtonLabel'\nimport {\n\tTldrawUiDialogBody,\n\tTldrawUiDialogCloseButton,\n\tTldrawUiDialogFooter,\n\tTldrawUiDialogHeader,\n\tTldrawUiDialogTitle,\n} from '../primitives/TldrawUiDialog'\nimport { TldrawUiMenuCheckboxItem } from '../primitives/menus/TldrawUiMenuCheckboxItem'\nimport { TldrawUiMenuGroup } from '../primitives/menus/TldrawUiMenuGroup'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\nimport { TldrawUiMenuSubmenu } from '../primitives/menus/TldrawUiMenuSubmenu'\n\n/** @public */\nexport function DefaultDebugMenuContent() {\n\tconst editor = useEditor()\n\tconst { addToast } = useToasts()\n\tconst { addDialog } = useDialogs()\n\tconst [error, setError] = React.useState<boolean>(false)\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuGroup id=\"items\">\n\t\t\t\t<TldrawUiMenuItem\n\t\t\t\t\tid=\"add-toast\"\n\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\taddToast({\n\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\ttitle: 'Something good happened',\n\t\t\t\t\t\t\tdescription: 'Hey, attend to this thing over here. It might be important!',\n\t\t\t\t\t\t\tkeepOpen: true,\n\t\t\t\t\t\t\tseverity: 'success',\n\t\t\t\t\t\t\t// icon?: string\n\t\t\t\t\t\t\t// title?: string\n\t\t\t\t\t\t\t// description?: string\n\t\t\t\t\t\t\t// actions?: TLUiToastAction[]\n\t\t\t\t\t\t})\n\t\t\t\t\t\taddToast({\n\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\ttitle: 'Something happened',\n\t\t\t\t\t\t\tdescription: 'Hey, attend to this thing over here. It might be important!',\n\t\t\t\t\t\t\tkeepOpen: true,\n\t\t\t\t\t\t\tseverity: 'info',\n\t\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: 'Primary',\n\t\t\t\t\t\t\t\t\ttype: 'primary',\n\t\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\t\tvoid null\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: 'Normal',\n\t\t\t\t\t\t\t\t\ttype: 'normal',\n\t\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\t\tvoid null\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: 'Danger',\n\t\t\t\t\t\t\t\t\ttype: 'danger',\n\t\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\t\tvoid null\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t// icon?: string\n\t\t\t\t\t\t\t// title?: string\n\t\t\t\t\t\t\t// description?: string\n\t\t\t\t\t\t\t// actions?: TLUiToastAction[]\n\t\t\t\t\t\t})\n\t\t\t\t\t\taddToast({\n\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\ttitle: 'Something maybe bad happened',\n\t\t\t\t\t\t\tdescription: 'Hey, attend to this thing over here. It might be important!',\n\t\t\t\t\t\t\tkeepOpen: true,\n\t\t\t\t\t\t\tseverity: 'warning',\n\t\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: 'Primary',\n\t\t\t\t\t\t\t\t\ttype: 'primary',\n\t\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\t\tvoid null\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: 'Normal',\n\t\t\t\t\t\t\t\t\ttype: 'normal',\n\t\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\t\tvoid null\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: 'Danger',\n\t\t\t\t\t\t\t\t\ttype: 'danger',\n\t\t\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\t\t\tvoid null\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t})\n\t\t\t\t\t\taddToast({\n\t\t\t\t\t\t\tid: uniqueId(),\n\t\t\t\t\t\t\ttitle: 'Something bad happened',\n\t\t\t\t\t\t\tseverity: 'error',\n\t\t\t\t\t\t\tkeepOpen: true,\n\t\t\t\t\t\t})\n\t\t\t\t\t}}\n\t\t\t\t\tlabel={untranslated('Show toast')}\n\t\t\t\t/>\n\t\t\t\t<TldrawUiMenuItem\n\t\t\t\t\tid=\"show-dialog\"\n\t\t\t\t\tlabel={'Show dialog'}\n\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\taddDialog({\n\t\t\t\t\t\t\tcomponent: ({ onClose }) => (\n\t\t\t\t\t\t\t\t<ExampleDialog\n\t\t\t\t\t\t\t\t\tdisplayDontShowAgain\n\t\t\t\t\t\t\t\t\tonCancel={() => onClose()}\n\t\t\t\t\t\t\t\t\tonContinue={() => onClose()}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\t\tvoid null\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<TldrawUiMenuItem\n\t\t\t\t\tid=\"create-shapes\"\n\t\t\t\t\tlabel={'Create 100 shapes'}\n\t\t\t\t\tonSelect={() => createNShapes(editor, 100)}\n\t\t\t\t/>\n\t\t\t\t<TldrawUiMenuItem\n\t\t\t\t\tid=\"count-nodes\"\n\t\t\t\t\tlabel={'Count shapes / nodes'}\n\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\tconst selectedShapes = editor.getSelectedShapes()\n\t\t\t\t\t\tconst shapes =\n\t\t\t\t\t\t\tselectedShapes.length === 0 ? editor.getRenderingShapes() : selectedShapes\n\t\t\t\t\t\twindow.alert(\n\t\t\t\t\t\t\t`Shapes ${shapes.length}, DOM nodes:${document.querySelector('.tl-shapes')!.querySelectorAll('*')?.length}`\n\t\t\t\t\t\t)\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t{(() => {\n\t\t\t\t\tif (error) throw Error('oh no!')\n\t\t\t\t\treturn null\n\t\t\t\t})()}\n\t\t\t\t<TldrawUiMenuItem id=\"throw-error\" onSelect={() => setError(true)} label={'Throw error'} />\n\t\t\t\t<TldrawUiMenuItem id=\"hard-reset\" onSelect={hardResetEditor} label={'Hard reset'} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup id=\"flags\">\n\t\t\t\t<DebugFlags />\n\t\t\t\t<FeatureFlags />\n\t\t\t</TldrawUiMenuGroup>\n\n\t\t\t{/* {...children} */}\n\t\t</>\n\t)\n}\n/** @public */\nexport function DebugFlags() {\n\tconst items = Object.values(debugFlags)\n\tif (!items.length) return null\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"debug flags\" label=\"Debug Flags\">\n\t\t\t<TldrawUiMenuGroup id=\"debug flags\">\n\t\t\t\t{items.map((flag) => (\n\t\t\t\t\t<DebugFlagToggle key={flag.name} flag={flag} />\n\t\t\t\t))}\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n/** @public */\nexport function FeatureFlags() {\n\tconst items = Object.values(featureFlags)\n\tif (!items.length) return null\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"feature flags\" label=\"Feature Flags\">\n\t\t\t<TldrawUiMenuGroup id=\"feature flags\">\n\t\t\t\t{items.map((flag) => (\n\t\t\t\t\t<DebugFlagToggle key={flag.name} flag={flag} />\n\t\t\t\t))}\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n/** @public */\nexport function ExampleDialog({\n\ttitle = 'title',\n\tbody = 'hello hello hello',\n\tcancel = 'Cancel',\n\tconfirm = 'Continue',\n\tdisplayDontShowAgain = false,\n\tonCancel,\n\tonContinue,\n}: {\n\ttitle?: string\n\tbody?: string\n\tcancel?: string\n\tconfirm?: string\n\tdisplayDontShowAgain?: boolean\n\tonCancel: () => void\n\tonContinue: () => void\n}) {\n\tconst [dontShowAgain, setDontShowAgain] = React.useState(false)\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiDialogHeader>\n\t\t\t\t<TldrawUiDialogTitle>{title}</TldrawUiDialogTitle>\n\t\t\t\t<TldrawUiDialogCloseButton />\n\t\t\t</TldrawUiDialogHeader>\n\t\t\t<TldrawUiDialogBody style={{ maxWidth: 350 }}>{body}</TldrawUiDialogBody>\n\t\t\t<TldrawUiDialogFooter className=\"tlui-dialog__footer__actions\">\n\t\t\t\t{displayDontShowAgain && (\n\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\ttype=\"normal\"\n\t\t\t\t\t\tonClick={() => setDontShowAgain(!dontShowAgain)}\n\t\t\t\t\t\tstyle={{ marginRight: 'auto' }}\n\t\t\t\t\t>\n\t\t\t\t\t\t<TldrawUiButtonCheck checked={dontShowAgain} />\n\t\t\t\t\t\t<TldrawUiButtonLabel>Don't show again</TldrawUiButtonLabel>\n\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t)}\n\t\t\t\t<TldrawUiButton type=\"normal\" onClick={onCancel}>\n\t\t\t\t\t<TldrawUiButtonLabel>{cancel}</TldrawUiButtonLabel>\n\t\t\t\t</TldrawUiButton>\n\t\t\t\t<TldrawUiButton type=\"primary\" onClick={async () => onContinue()}>\n\t\t\t\t\t<TldrawUiButtonLabel>{confirm}</TldrawUiButtonLabel>\n\t\t\t\t</TldrawUiButton>\n\t\t\t</TldrawUiDialogFooter>\n\t\t</>\n\t)\n}\n\nconst DebugFlagToggle = track(function DebugFlagToggle({\n\tflag,\n\tonChange,\n}: {\n\tflag: DebugFlag<boolean>\n\tonChange?: (newValue: boolean) => void\n}) {\n\tconst value = flag.get()\n\treturn (\n\t\t<TldrawUiMenuCheckboxItem\n\t\t\tid={flag.name}\n\t\t\ttitle={flag.name}\n\t\t\tlabel={flag.name\n\t\t\t\t.replace(/([a-z0-9])([A-Z])/g, (m) => `${m[0]} ${m[1].toLowerCase()}`)\n\t\t\t\t.replace(/^[a-z]/, (m) => m.toUpperCase())}\n\t\t\tchecked={value}\n\t\t\tonSelect={() => {\n\t\t\t\tflag.set(!value)\n\t\t\t\tonChange?.(!value)\n\t\t\t}}\n\t\t/>\n\t)\n})\n\nlet t = 0\n\nfunction createNShapes(editor: Editor, n: number) {\n\tconst shapesToCreate: TLShapePartial[] = Array(n)\n\tconst cols = Math.floor(Math.sqrt(n))\n\n\tfor (let i = 0; i < n; i++) {\n\t\tt++\n\t\tshapesToCreate[i] = {\n\t\t\tid: createShapeId('box' + t),\n\t\t\ttype: 'geo',\n\t\t\tx: (i % cols) * 132,\n\t\t\ty: Math.floor(i / cols) * 132,\n\t\t}\n\t}\n\n\teditor.batch(() => {\n\t\teditor.createShapes(shapesToCreate).setSelectedShapes(shapesToCreate.map((s) => s.id))\n\t})\n}\n", "import { TldrawUiIcon } from '../TldrawUiIcon'\n\n/** @public */\nexport type TLUiButtonCheckProps = { checked: boolean }\n\n/** @public */\nexport function TldrawUiButtonCheck({ checked }: TLUiButtonCheckProps) {\n\treturn (\n\t\t<TldrawUiIcon icon={checked ? 'check' : 'checkbox-empty'} className=\"tlui-button__icon\" small />\n\t)\n}\n", "import { debugFlags, track, useEditor, useValue, Vec } from '@tldraw/editor'\nimport { memo, useEffect, useRef, useState } from 'react'\nimport { useTldrawUiComponents } from '../context/components'\n\n/** @internal */\nexport const DefaultDebugPanel = memo(function DefaultDebugPanel() {\n\tconst { DebugMenu } = useTldrawUiComponents()\n\n\treturn (\n\t\t<div className=\"tlui-debug-panel\">\n\t\t\t<CurrentState />\n\t\t\t<FPS />\n\t\t\t{DebugMenu && <DebugMenu />}\n\t\t</div>\n\t)\n})\n\nfunction useTick(isEnabled = true) {\n\tconst [_, setTick] = useState(0)\n\tconst editor = useEditor()\n\tuseEffect(() => {\n\t\tif (!isEnabled) return\n\t\tconst update = () => setTick((tick) => tick + 1)\n\t\teditor.on('tick', update)\n\t\treturn () => {\n\t\t\teditor.off('tick', update)\n\t\t}\n\t}, [editor, isEnabled])\n}\n\nconst CurrentState = track(function CurrentState() {\n\tuseTick()\n\n\tconst editor = useEditor()\n\n\tconst path = editor.getPath()\n\tconst hoverShape = editor.getHoveredShape()\n\tconst selectedShape = editor.getOnlySelectedShape()\n\tconst shape = path === 'select.idle' || !path.includes('select.') ? hoverShape : selectedShape\n\tconst shapeInfo =\n\t\tshape && path.includes('select.')\n\t\t\t? ` / ${shape.type || ''}${\n\t\t\t\t\t'geo' in shape.props ? ' / ' + shape.props.geo : ''\n\t\t\t\t} / [${Vec.ToFixed(editor.getPointInShapeSpace(shape, editor.inputs.currentPagePoint), 0)}]`\n\t\t\t: ''\n\tconst ruler =\n\t\tpath.startsWith('select.') && !path.includes('.idle')\n\t\t\t? ` / [${Vec.ToFixed(editor.inputs.originPagePoint, 0)}] \u2192 [${Vec.ToFixed(\n\t\t\t\t\teditor.inputs.currentPagePoint,\n\t\t\t\t\t0\n\t\t\t\t)}] = ${Vec.Dist(editor.inputs.originPagePoint, editor.inputs.currentPagePoint).toFixed(0)}`\n\t\t\t: ''\n\n\treturn <div className=\"tlui-debug-panel__current-state\">{`${path}${shapeInfo}${ruler}`}</div>\n})\n\nfunction FPS() {\n\tconst showFps = useValue('show_fps', () => debugFlags.showFps.get(), [debugFlags])\n\n\tconst fpsRef = useRef<HTMLDivElement>(null)\n\n\tuseEffect(() => {\n\t\tif (!showFps) return\n\n\t\tconst TICK_LENGTH = 250\n\t\tlet maxKnownFps = 0\n\t\tlet cancelled = false\n\n\t\tlet start = performance.now()\n\t\tlet currentTickLength = 0\n\t\tlet framesInCurrentTick = 0\n\t\tlet isSlow = false\n\n\t\t// A \"tick\" is the amount of time between renders. Even though\n\t\t// we'll loop on every frame, we will only paint when the time\n\t\t// since the last paint is greater than the tick length.\n\n\t\t// When we paint, we'll calculate the FPS based on the number\n\t\t// of frames that we've seen since the last time we rendered,\n\t\t// and the actual time since the last render.\n\t\tfunction loop() {\n\t\t\tif (cancelled) return\n\n\t\t\t// Count the frame\n\t\t\tframesInCurrentTick++\n\n\t\t\t// Check if we should render\n\t\t\tcurrentTickLength = performance.now() - start\n\n\t\t\tif (currentTickLength > TICK_LENGTH) {\n\t\t\t\t// Calculate the FPS and paint it\n\t\t\t\tconst fps = Math.round(\n\t\t\t\t\tframesInCurrentTick * (TICK_LENGTH / currentTickLength) * (1000 / TICK_LENGTH)\n\t\t\t\t)\n\n\t\t\t\tif (fps > maxKnownFps) {\n\t\t\t\t\tmaxKnownFps = fps\n\t\t\t\t}\n\n\t\t\t\tconst slowFps = maxKnownFps * 0.75\n\t\t\t\tif ((fps < slowFps && !isSlow) || (fps >= slowFps && isSlow)) {\n\t\t\t\t\tisSlow = !isSlow\n\t\t\t\t}\n\n\t\t\t\tfpsRef.current!.innerHTML = `FPS ${fps.toString()}`\n\t\t\t\tfpsRef.current!.className =\n\t\t\t\t\t`tlui-debug-panel__fps` + (isSlow ? ` tlui-debug-panel__fps__slow` : ``)\n\n\t\t\t\t// Reset the values\n\t\t\t\tcurrentTickLength -= TICK_LENGTH\n\t\t\t\tframesInCurrentTick = 0\n\t\t\t\tstart = performance.now()\n\t\t\t}\n\n\t\t\trequestAnimationFrame(loop)\n\t\t}\n\n\t\tloop()\n\n\t\treturn () => {\n\t\t\tcancelled = true\n\t\t}\n\t}, [showFps])\n\n\tif (!showFps) return null\n\n\treturn <div ref={fpsRef} />\n}\n", "import { ReactNode, memo } from 'react'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport {\n\tTldrawUiDropdownMenuContent,\n\tTldrawUiDropdownMenuRoot,\n\tTldrawUiDropdownMenuTrigger,\n} from '../primitives/TldrawUiDropdownMenu'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultHelpMenuContent } from './DefaultHelpMenuContent'\n\n/** @public */\nexport type TLUiHelpMenuProps = {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport const DefaultHelpMenu = memo(function DefaultHelpMenu({ children }: TLUiHelpMenuProps) {\n\tconst msg = useTranslation()\n\tconst breakpoint = useBreakpoint()\n\n\t// Get the help menu content, either the default component or the user's\n\t// override. If there's no menu content, then the user has set it to null,\n\t// so skip rendering the menu.\n\tconst content = children ?? <DefaultHelpMenuContent />\n\n\tif (breakpoint < PORTRAIT_BREAKPOINT.MOBILE) return null\n\n\treturn (\n\t\t<div className=\"tlui-help-menu\">\n\t\t\t<TldrawUiDropdownMenuRoot id=\"help menu\">\n\t\t\t\t<TldrawUiDropdownMenuTrigger>\n\t\t\t\t\t<TldrawUiButton type=\"help\" title={msg('help-menu.title')} data-testid=\"help-menu.button\">\n\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"question-mark\" small />\n\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t</TldrawUiDropdownMenuTrigger>\n\t\t\t\t<TldrawUiDropdownMenuContent side=\"top\" align=\"end\" alignOffset={0} sideOffset={8}>\n\t\t\t\t\t<TldrawUiMenuContextProvider type=\"menu\" sourceId=\"help-menu\">\n\t\t\t\t\t\t{content}\n\t\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t\t</TldrawUiDropdownMenuContent>\n\t\t\t</TldrawUiDropdownMenuRoot>\n\t\t</div>\n\t)\n})\n", "import { useTldrawUiComponents } from '../../context/components'\nimport { useDialogs } from '../../context/dialogs'\nimport { LanguageMenu } from '../LanguageMenu'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\n/** @public */\nexport function DefaultHelpMenuContent() {\n\treturn (\n\t\t<>\n\t\t\t<LanguageMenu />\n\t\t\t<KeyboardShortcutsMenuItem />\n\t\t</>\n\t)\n}\n/** @public */\nexport function KeyboardShortcutsMenuItem() {\n\tconst { KeyboardShortcutsDialog } = useTldrawUiComponents()\n\tconst { addDialog } = useDialogs()\n\n\tif (!KeyboardShortcutsDialog) return null\n\n\treturn (\n\t\t<TldrawUiMenuItem\n\t\t\tid=\"keyboard-shortcuts-button\"\n\t\t\tlabel=\"help-menu.keyboard-shortcuts\"\n\t\t\treadonlyOk\n\t\t\tonSelect={() => {\n\t\t\t\taddDialog({ component: KeyboardShortcutsDialog })\n\t\t\t}}\n\t\t/>\n\t)\n}\n", "import { LANGUAGES, useEditor, useValue } from '@tldraw/editor'\nimport { useUiEvents } from '../context/events'\nimport { TldrawUiMenuCheckboxItem } from './primitives/menus/TldrawUiMenuCheckboxItem'\nimport { TldrawUiMenuGroup } from './primitives/menus/TldrawUiMenuGroup'\nimport { TldrawUiMenuSubmenu } from './primitives/menus/TldrawUiMenuSubmenu'\n\n/** @public */\nexport function LanguageMenu() {\n\tconst editor = useEditor()\n\tconst trackEvent = useUiEvents()\n\tconst currentLanguage = useValue('locale', () => editor.user.getLocale(), [editor])\n\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"help menu language\" label=\"menu.language\">\n\t\t\t<TldrawUiMenuGroup id=\"languages\">\n\t\t\t\t{LANGUAGES.map(({ locale, label }) => (\n\t\t\t\t\t<TldrawUiMenuCheckboxItem\n\t\t\t\t\t\tid={`language-${locale}`}\n\t\t\t\t\t\tkey={locale}\n\t\t\t\t\t\ttitle={locale}\n\t\t\t\t\t\tlabel={label}\n\t\t\t\t\t\tchecked={locale === currentLanguage}\n\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\teditor.user.updateUserPreferences({ locale })\n\t\t\t\t\t\t\ttrackEvent('change-language', { source: 'menu', locale })\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n", "import { ReactNode } from 'react'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultHelperButtonsContent } from './DefaultHelperButtonsContent'\n\n/** @public */\nexport type TLUiHelperButtonsProps = {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport function DefaultHelperButtons({ children }: TLUiHelperButtonsProps) {\n\tconst content = children ?? <DefaultHelperButtonsContent />\n\treturn (\n\t\t<div className=\"tlui-helper-buttons\">\n\t\t\t<TldrawUiMenuContextProvider type=\"helper-buttons\" sourceId=\"helper-buttons\">\n\t\t\t\t{content}\n\t\t\t</TldrawUiMenuContextProvider>\n\t\t</div>\n\t)\n}\n", "import { BackToContent } from './BackToContent'\nimport { ExitPenMode } from './ExitPenMode'\nimport { StopFollowing } from './StopFollowing'\n\n/** @public */\nexport function DefaultHelperButtonsContent() {\n\treturn (\n\t\t<>\n\t\t\t<ExitPenMode />\n\t\t\t<BackToContent />\n\t\t\t<StopFollowing />\n\t\t</>\n\t)\n}\n", "import { useEditor, useQuickReactor } from '@tldraw/editor'\nimport { useRef, useState } from 'react'\nimport { useActions } from '../../context/actions'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\nexport function BackToContent() {\n\tconst editor = useEditor()\n\n\tconst actions = useActions()\n\n\tconst [showBackToContent, setShowBackToContent] = useState(false)\n\tconst rIsShowing = useRef(false)\n\n\tuseQuickReactor(\n\t\t'toggle showback to content',\n\t\t() => {\n\t\t\tconst showBackToContentPrev = rIsShowing.current\n\t\t\tconst shapeIds = editor.getCurrentPageShapeIds()\n\t\t\tlet showBackToContentNow = false\n\t\t\tif (shapeIds.size) {\n\t\t\t\tshowBackToContentNow = shapeIds.size === editor.getCulledShapes().size\n\t\t\t}\n\n\t\t\tif (showBackToContentPrev !== showBackToContentNow) {\n\t\t\t\tsetShowBackToContent(showBackToContentNow)\n\t\t\t\trIsShowing.current = showBackToContentNow\n\t\t\t}\n\t\t},\n\t\t[editor]\n\t)\n\n\tif (!showBackToContent) return null\n\n\treturn (\n\t\t<TldrawUiMenuItem\n\t\t\t{...actions['back-to-content']}\n\t\t\tonSelect={() => {\n\t\t\t\tactions['back-to-content'].onSelect('helper-buttons')\n\t\t\t\tsetShowBackToContent(false)\n\t\t\t}}\n\t\t/>\n\t)\n}\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport { useActions } from '../../context/actions'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\nexport function ExitPenMode() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\tconst isPenMode = useValue('is pen mode', () => editor.getInstanceState().isPenMode, [editor])\n\n\tif (!isPenMode) return null\n\n\treturn <TldrawUiMenuItem {...actions['exit-pen-mode']} />\n}\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport { useActions } from '../../context/actions'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\nexport function StopFollowing() {\n\tconst editor = useEditor()\n\tconst actions = useActions()\n\n\tconst followingUser = useValue(\n\t\t'is following user',\n\t\t() => !!editor.getInstanceState().followingUserId,\n\t\t[editor]\n\t)\n\tif (!followingUser) return null\n\n\treturn <TldrawUiMenuItem {...actions['stop-following']} />\n}\n", "import classNames from 'classnames'\nimport { ReactNode, memo } from 'react'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { TLUiDialogProps } from '../../context/dialogs'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport {\n\tTldrawUiDialogBody,\n\tTldrawUiDialogCloseButton,\n\tTldrawUiDialogHeader,\n\tTldrawUiDialogTitle,\n} from '../primitives/TldrawUiDialog'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultKeyboardShortcutsDialogContent } from './DefaultKeyboardShortcutsDialogContent'\n\n/** @public */\nexport type TLUiKeyboardShortcutsDialogProps = TLUiDialogProps & {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport const DefaultKeyboardShortcutsDialog = memo(function DefaultKeyboardShortcutsDialog({\n\tchildren,\n}: TLUiKeyboardShortcutsDialogProps) {\n\tconst msg = useTranslation()\n\tconst breakpoint = useBreakpoint()\n\n\tconst content = children ?? <DefaultKeyboardShortcutsDialogContent />\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiDialogHeader className=\"tlui-shortcuts-dialog__header\">\n\t\t\t\t<TldrawUiDialogTitle>{msg('shortcuts-dialog.title')}</TldrawUiDialogTitle>\n\t\t\t\t<TldrawUiDialogCloseButton />\n\t\t\t</TldrawUiDialogHeader>\n\t\t\t<TldrawUiDialogBody\n\t\t\t\tclassName={classNames('tlui-shortcuts-dialog__body', {\n\t\t\t\t\t'tlui-shortcuts-dialog__body__mobile': breakpoint <= PORTRAIT_BREAKPOINT.MOBILE_XS,\n\t\t\t\t\t'tlui-shortcuts-dialog__body__tablet': breakpoint <= PORTRAIT_BREAKPOINT.TABLET,\n\t\t\t\t})}\n\t\t\t>\n\t\t\t\t<TldrawUiMenuContextProvider type=\"keyboard-shortcuts\" sourceId=\"kbd\">\n\t\t\t\t\t{content}\n\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t</TldrawUiDialogBody>\n\t\t\t<div className=\"tlui-dialog__scrim\" />\n\t\t</>\n\t)\n})\n", "import { useActions } from '../../context/actions'\nimport { useTools } from '../../hooks/useTools'\nimport { TldrawUiMenuGroup } from '../primitives/menus/TldrawUiMenuGroup'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\n/** @public */\nexport function DefaultKeyboardShortcutsDialogContent() {\n\tconst actions = useActions()\n\tconst tools = useTools()\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuGroup label=\"shortcuts-dialog.tools\" id=\"tools\">\n\t\t\t\t<TldrawUiMenuItem {...actions['toggle-tool-lock']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['insert-media']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['select']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['draw']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['eraser']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['hand']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['rectangle']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['ellipse']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['arrow']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['line']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['text']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['frame']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['note']} />\n\t\t\t\t<TldrawUiMenuItem {...tools['laser']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup label=\"shortcuts-dialog.preferences\" id=\"preferences\">\n\t\t\t\t<TldrawUiMenuItem {...actions['toggle-dark-mode']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['toggle-focus-mode']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['toggle-grid']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup label=\"shortcuts-dialog.edit\" id=\"edit\">\n\t\t\t\t<TldrawUiMenuItem {...actions['undo']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['redo']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['cut']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['copy']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['paste']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['select-all']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['delete']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['duplicate']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup label=\"shortcuts-dialog.view\" id=\"view\">\n\t\t\t\t<TldrawUiMenuItem {...actions['zoom-in']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['zoom-out']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['zoom-to-100']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['zoom-to-fit']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['zoom-to-selection']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup label=\"shortcuts-dialog.transform\" id=\"transform\">\n\t\t\t\t<TldrawUiMenuItem {...actions['bring-to-front']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['bring-forward']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['send-backward']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['send-to-back']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['group']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['ungroup']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['flip-horizontal']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['flip-vertical']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['align-top']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['align-center-vertical']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['align-bottom']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['align-left']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['align-center-horizontal']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['align-right']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t</>\n\t)\n}\n", "import * as _Dropdown from '@radix-ui/react-dropdown-menu'\nimport { useContainer } from '@tldraw/editor'\nimport { ReactNode, memo } from 'react'\nimport { useMenuIsOpen } from '../../hooks/useMenuIsOpen'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultMainMenuContent } from './DefaultMainMenuContent'\n\n/** @public */\nexport type TLUiMainMenuProps = {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport const DefaultMainMenu = memo(function DefaultMainMenu({ children }: TLUiMainMenuProps) {\n\tconst container = useContainer()\n\tconst [isOpen, onOpenChange] = useMenuIsOpen('main menu')\n\tconst msg = useTranslation()\n\n\t// Get the main menu content, either the default component or the user's\n\t// override. If there's no menu content, then the user has set it to null,\n\t// so skip rendering the menu.\n\tconst content = children ?? <DefaultMainMenuContent />\n\n\treturn (\n\t\t<_Dropdown.Root dir=\"ltr\" open={isOpen} onOpenChange={onOpenChange} modal={false}>\n\t\t\t<_Dropdown.Trigger asChild dir=\"ltr\">\n\t\t\t\t<TldrawUiButton type=\"icon\" data-testid=\"main-menu.button\" title={msg('menu.title')}>\n\t\t\t\t\t<TldrawUiButtonIcon icon=\"menu\" small />\n\t\t\t\t</TldrawUiButton>\n\t\t\t</_Dropdown.Trigger>\n\t\t\t<_Dropdown.Portal container={container}>\n\t\t\t\t<_Dropdown.Content\n\t\t\t\t\tclassName=\"tlui-menu\"\n\t\t\t\t\tside=\"bottom\"\n\t\t\t\t\talign=\"start\"\n\t\t\t\t\tcollisionPadding={4}\n\t\t\t\t\talignOffset={0}\n\t\t\t\t\tsideOffset={6}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiMenuContextProvider type=\"menu\" sourceId=\"main-menu\">\n\t\t\t\t\t\t{content}\n\t\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t\t</_Dropdown.Content>\n\t\t\t</_Dropdown.Portal>\n\t\t</_Dropdown.Root>\n\t)\n})\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport { useActions } from '../../context/actions'\nimport { useCanRedo, useCanUndo } from '../../hooks/menu-hooks'\nimport { LanguageMenu } from '../LanguageMenu'\nimport {\n\tClipboardMenuGroup,\n\tConversionsMenuGroup,\n\tConvertToBookmarkMenuItem,\n\tConvertToEmbedMenuItem,\n\tEditLinkMenuItem,\n\tFitFrameToContentMenuItem,\n\tGroupMenuItem,\n\tRemoveFrameMenuItem,\n\tSelectAllMenuItem,\n\tToggleAutoSizeMenuItem,\n\tToggleDarkModeItem,\n\tToggleDebugModeItem,\n\tToggleEdgeScrollingItem,\n\tToggleFocusModeItem,\n\tToggleGridItem,\n\tToggleLockMenuItem,\n\tToggleReduceMotionItem,\n\tToggleSnapModeItem,\n\tToggleToolLockItem,\n\tToggleTransparentBgMenuItem,\n\tToggleWrapModeItem,\n\tUngroupMenuItem,\n\tUnlockAllMenuItem,\n\tZoomTo100MenuItem,\n\tZoomToFitMenuItem,\n\tZoomToSelectionMenuItem,\n} from '../menu-items'\nimport { TldrawUiMenuGroup } from '../primitives/menus/TldrawUiMenuGroup'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\nimport { TldrawUiMenuSubmenu } from '../primitives/menus/TldrawUiMenuSubmenu'\n\n/** @public */\nexport function DefaultMainMenuContent() {\n\treturn (\n\t\t<>\n\t\t\t<EditSubmenu />\n\t\t\t<ViewSubmenu />\n\t\t\t<ExportFileContentSubMenu />\n\t\t\t<ExtrasGroup />\n\t\t\t<PreferencesGroup />\n\t\t</>\n\t)\n}\n\n/** @public */\nexport function ExportFileContentSubMenu() {\n\tconst actions = useActions()\n\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"export-all-as\" label=\"context-menu.export-all-as\" size=\"small\">\n\t\t\t<TldrawUiMenuGroup id=\"export-all-as-group\">\n\t\t\t\t<TldrawUiMenuItem {...actions['export-all-as-svg']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['export-all-as-png']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['export-all-as-json']} />\n\t\t\t</TldrawUiMenuGroup>\n\t\t\t<TldrawUiMenuGroup id=\"export-all-as-bg\">\n\t\t\t\t<ToggleTransparentBgMenuItem />\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n\n/** @public */\nexport function EditSubmenu() {\n\tconst editor = useEditor()\n\n\tconst selectToolActive = useValue(\n\t\t'isSelectToolActive',\n\t\t() => editor.getCurrentToolId() === 'select',\n\t\t[editor]\n\t)\n\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"edit\" label=\"menu.edit\" disabled={!selectToolActive}>\n\t\t\t<UndoRedoGroup />\n\t\t\t<ClipboardMenuGroup />\n\t\t\t<ConversionsMenuGroup />\n\t\t\t<MiscMenuGroup />\n\t\t\t<LockGroup />\n\t\t\t<TldrawUiMenuGroup id=\"select-all\">\n\t\t\t\t<SelectAllMenuItem />\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n\n/** @public */\nexport function MiscMenuGroup() {\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"misc\">\n\t\t\t<GroupMenuItem />\n\t\t\t<UngroupMenuItem />\n\t\t\t<EditLinkMenuItem />\n\t\t\t<ToggleAutoSizeMenuItem />\n\t\t\t<RemoveFrameMenuItem />\n\t\t\t<FitFrameToContentMenuItem />\n\t\t\t<ConvertToEmbedMenuItem />\n\t\t\t<ConvertToBookmarkMenuItem />\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n\n/** @public */\nexport function LockGroup() {\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"lock\">\n\t\t\t<ToggleLockMenuItem />\n\t\t\t<UnlockAllMenuItem />\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n\n/** @public */\nexport function UndoRedoGroup() {\n\tconst actions = useActions()\n\tconst canUndo = useCanUndo()\n\tconst canRedo = useCanRedo()\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"undo-redo\">\n\t\t\t<TldrawUiMenuItem {...actions['undo']} disabled={!canUndo} />\n\t\t\t<TldrawUiMenuItem {...actions['redo']} disabled={!canRedo} />\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n\n/** @public */\nexport function ViewSubmenu() {\n\tconst actions = useActions()\n\treturn (\n\t\t<TldrawUiMenuSubmenu id=\"view\" label=\"menu.view\">\n\t\t\t<TldrawUiMenuGroup id=\"view-actions\">\n\t\t\t\t<TldrawUiMenuItem {...actions['zoom-in']} />\n\t\t\t\t<TldrawUiMenuItem {...actions['zoom-out']} />\n\t\t\t\t<ZoomTo100MenuItem />\n\t\t\t\t<ZoomToFitMenuItem />\n\t\t\t\t<ZoomToSelectionMenuItem />\n\t\t\t</TldrawUiMenuGroup>\n\t\t</TldrawUiMenuSubmenu>\n\t)\n}\n\n/** @public */\nexport function ExtrasGroup() {\n\tconst actions = useActions()\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"extras\">\n\t\t\t<TldrawUiMenuItem {...actions['insert-embed']} />\n\t\t\t<TldrawUiMenuItem {...actions['insert-media']} />\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n\n/* ------------------- Preferences ------------------ */\n\n/** @public */\nexport function PreferencesGroup() {\n\treturn (\n\t\t<TldrawUiMenuGroup id=\"preferences\">\n\t\t\t<TldrawUiMenuSubmenu id=\"preferences\" label=\"menu.preferences\">\n\t\t\t\t<TldrawUiMenuGroup id=\"preferences-actions\">\n\t\t\t\t\t<ToggleSnapModeItem />\n\t\t\t\t\t<ToggleToolLockItem />\n\t\t\t\t\t<ToggleGridItem />\n\t\t\t\t\t<ToggleWrapModeItem />\n\t\t\t\t\t<ToggleDarkModeItem />\n\t\t\t\t\t<ToggleFocusModeItem />\n\t\t\t\t\t<ToggleEdgeScrollingItem />\n\t\t\t\t\t<ToggleReduceMotionItem />\n\t\t\t\t\t<ToggleDebugModeItem />\n\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t\t<TldrawUiMenuGroup id=\"language\">\n\t\t\t\t\t<LanguageMenu />\n\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t</TldrawUiMenuSubmenu>\n\t\t</TldrawUiMenuGroup>\n\t)\n}\n", "import { memo } from 'react'\nimport { useBreakpoint } from '../context/breakpoints'\nimport { useTldrawUiComponents } from '../context/components'\n\n/** @public */\nexport const DefaultMenuPanel = memo(function MenuPanel() {\n\tconst breakpoint = useBreakpoint()\n\n\tconst { MainMenu, QuickActions, ActionsMenu, PageMenu } = useTldrawUiComponents()\n\n\tif (!MainMenu && !PageMenu && breakpoint < 6) return null\n\n\treturn (\n\t\t<div className=\"tlui-menu-zone\">\n\t\t\t<div className=\"tlui-buttons__horizontal\">\n\t\t\t\t{MainMenu && <MainMenu />}\n\t\t\t\t{PageMenu && <PageMenu />}\n\t\t\t\t{breakpoint < 6 ? null : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t{QuickActions && <QuickActions />}\n\t\t\t\t\t\t{ActionsMenu && <ActionsMenu />}\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t)\n})\n", "import {\n\tANIMATION_MEDIUM_MS,\n\tTLPointerEventInfo,\n\tVec,\n\tgetPointerInfo,\n\tnormalizeWheel,\n\treleasePointerCapture,\n\tsetPointerCapture,\n\tuseEditor,\n\tuseIsDarkMode,\n} from '@tldraw/editor'\nimport * as React from 'react'\nimport { MinimapManager } from './MinimapManager'\n\n/** @public */\nexport function DefaultMinimap() {\n\tconst editor = useEditor()\n\n\tconst rCanvas = React.useRef<HTMLCanvasElement>(null!)\n\tconst rPointing = React.useRef(false)\n\n\tconst minimapRef = React.useRef<MinimapManager>()\n\n\tReact.useEffect(() => {\n\t\tconst minimap = new MinimapManager(editor, rCanvas.current)\n\t\tminimapRef.current = minimap\n\t\treturn minimapRef.current.close\n\t}, [editor])\n\n\tconst onDoubleClick = React.useCallback(\n\t\t(e: React.MouseEvent<HTMLCanvasElement>) => {\n\t\t\tif (!editor.getCurrentPageShapeIds().size) return\n\t\t\tif (!minimapRef.current) return\n\n\t\t\tconst point = minimapRef.current.minimapScreenPointToPagePoint(\n\t\t\t\te.clientX,\n\t\t\t\te.clientY,\n\t\t\t\tfalse,\n\t\t\t\tfalse\n\t\t\t)\n\n\t\t\tconst clampedPoint = minimapRef.current.minimapScreenPointToPagePoint(\n\t\t\t\te.clientX,\n\t\t\t\te.clientY,\n\t\t\t\tfalse,\n\t\t\t\ttrue\n\t\t\t)\n\n\t\t\tminimapRef.current.originPagePoint.setTo(clampedPoint)\n\t\t\tminimapRef.current.originPageCenter.setTo(editor.getViewportPageBounds().center)\n\n\t\t\teditor.centerOnPoint(point, { duration: ANIMATION_MEDIUM_MS })\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst onPointerDown = React.useCallback(\n\t\t(e: React.PointerEvent<HTMLCanvasElement>) => {\n\t\t\tif (!minimapRef.current) return\n\t\t\tconst elm = e.currentTarget\n\t\t\tsetPointerCapture(elm, e)\n\t\t\tif (!editor.getCurrentPageShapeIds().size) return\n\n\t\t\trPointing.current = true\n\n\t\t\tminimapRef.current.isInViewport = false\n\n\t\t\tconst point = minimapRef.current.minimapScreenPointToPagePoint(\n\t\t\t\te.clientX,\n\t\t\t\te.clientY,\n\t\t\t\tfalse,\n\t\t\t\tfalse\n\t\t\t)\n\n\t\t\tconst clampedPoint = minimapRef.current.minimapScreenPointToPagePoint(\n\t\t\t\te.clientX,\n\t\t\t\te.clientY,\n\t\t\t\tfalse,\n\t\t\t\ttrue\n\t\t\t)\n\n\t\t\tconst _vpPageBounds = editor.getViewportPageBounds()\n\n\t\t\tminimapRef.current.isInViewport = _vpPageBounds.containsPoint(clampedPoint)\n\n\t\t\tif (minimapRef.current.isInViewport) {\n\t\t\t\tminimapRef.current.originPagePoint.setTo(clampedPoint)\n\t\t\t\tminimapRef.current.originPageCenter.setTo(_vpPageBounds.center)\n\t\t\t} else {\n\t\t\t\tconst delta = Vec.Sub(_vpPageBounds.center, _vpPageBounds.point)\n\t\t\t\tconst pagePoint = Vec.Add(point, delta)\n\t\t\t\tminimapRef.current.originPagePoint.setTo(pagePoint)\n\t\t\t\tminimapRef.current.originPageCenter.setTo(point)\n\t\t\t\teditor.centerOnPoint(point, { duration: ANIMATION_MEDIUM_MS })\n\t\t\t}\n\n\t\t\tfunction release(e: PointerEvent) {\n\t\t\t\tif (elm) {\n\t\t\t\t\treleasePointerCapture(elm, e)\n\t\t\t\t}\n\t\t\t\trPointing.current = false\n\t\t\t\tdocument.body.removeEventListener('pointerup', release)\n\t\t\t}\n\n\t\t\tdocument.body.addEventListener('pointerup', release)\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst onPointerMove = React.useCallback(\n\t\t(e: React.PointerEvent<HTMLCanvasElement>) => {\n\t\t\tif (!minimapRef.current) return\n\t\t\tconst point = minimapRef.current.minimapScreenPointToPagePoint(\n\t\t\t\te.clientX,\n\t\t\t\te.clientY,\n\t\t\t\te.shiftKey,\n\t\t\t\ttrue\n\t\t\t)\n\n\t\t\tif (rPointing.current) {\n\t\t\t\tif (minimapRef.current.isInViewport) {\n\t\t\t\t\tconst delta = minimapRef.current.originPagePoint\n\t\t\t\t\t\t.clone()\n\t\t\t\t\t\t.sub(minimapRef.current.originPageCenter)\n\t\t\t\t\teditor.centerOnPoint(Vec.Sub(point, delta))\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\teditor.centerOnPoint(point)\n\t\t\t}\n\n\t\t\tconst pagePoint = minimapRef.current.getMinimapPagePoint(e.clientX, e.clientY)\n\n\t\t\tconst screenPoint = editor.pageToScreen(pagePoint)\n\n\t\t\tconst info: TLPointerEventInfo = {\n\t\t\t\ttype: 'pointer',\n\t\t\t\ttarget: 'canvas',\n\t\t\t\tname: 'pointer_move',\n\t\t\t\t...getPointerInfo(e),\n\t\t\t\tpoint: screenPoint,\n\t\t\t\tisPen: editor.getInstanceState().isPenMode,\n\t\t\t}\n\n\t\t\teditor.dispatch(info)\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst onWheel = React.useCallback(\n\t\t(e: React.WheelEvent<HTMLCanvasElement>) => {\n\t\t\tconst offset = normalizeWheel(e)\n\n\t\t\teditor.dispatch({\n\t\t\t\ttype: 'wheel',\n\t\t\t\tname: 'wheel',\n\t\t\t\tdelta: offset,\n\t\t\t\tpoint: new Vec(e.clientX, e.clientY),\n\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tctrlKey: e.metaKey || e.ctrlKey,\n\t\t\t})\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst isDarkMode = useIsDarkMode()\n\n\tReact.useEffect(() => {\n\t\t// need to wait a tick for next theme css to be applied\n\t\t// otherwise the minimap will render with the wrong colors\n\t\tsetTimeout(() => {\n\t\t\tminimapRef.current?.updateColors()\n\t\t\tminimapRef.current?.render()\n\t\t})\n\t}, [isDarkMode])\n\n\treturn (\n\t\t<div className=\"tlui-minimap\">\n\t\t\t<canvas\n\t\t\t\trole=\"img\"\n\t\t\t\taria-label=\"minimap\"\n\t\t\t\tref={rCanvas}\n\t\t\t\tclassName=\"tlui-minimap__canvas\"\n\t\t\t\tonDoubleClick={onDoubleClick}\n\t\t\t\tonPointerMove={onPointerMove}\n\t\t\t\tonPointerDown={onPointerDown}\n\t\t\t\tonWheel={onWheel}\n\t\t\t/>\n\t\t</div>\n\t)\n}\n", "const memo = {} as Record<string, Float32Array>\n\nexport function getRgba(colorString: string) {\n\tif (memo[colorString]) {\n\t\treturn memo[colorString]\n\t}\n\tconst canvas = document.createElement('canvas')\n\tconst context = canvas.getContext('2d')\n\tcontext!.fillStyle = colorString\n\tcontext!.fillRect(0, 0, 1, 1)\n\tconst [r, g, b, a] = context!.getImageData(0, 0, 1, 1).data\n\tconst result = new Float32Array([r / 255, g / 255, b / 255, a / 255])\n\n\tmemo[colorString] = result\n\treturn result\n}\n", "import { Box, HALF_PI, PI, PI2, Vec } from '@tldraw/editor'\n\nexport const numArcSegmentsPerCorner = 10\n\nexport const roundedRectangleDataSize =\n\t// num triangles in corners\n\t4 * 6 * numArcSegmentsPerCorner +\n\t// num triangles in center rect\n\t12 +\n\t// num triangles in outer rects\n\t4 * 12\n\nexport function pie(\n\tarray: Float32Array,\n\t{\n\t\tcenter,\n\t\tradius,\n\t\tnumArcSegments = 20,\n\t\tstartAngle = 0,\n\t\tendAngle = PI2,\n\t\toffset = 0,\n\t}: {\n\t\tcenter: Vec\n\t\tradius: number\n\t\tnumArcSegments?: number\n\t\tstartAngle?: number\n\t\tendAngle?: number\n\t\toffset?: number\n\t}\n) {\n\tconst angle = (endAngle - startAngle) / numArcSegments\n\tlet i = offset\n\tfor (let a = startAngle; a < endAngle; a += angle) {\n\t\tarray[i++] = center.x\n\t\tarray[i++] = center.y\n\t\tarray[i++] = center.x + Math.cos(a) * radius\n\t\tarray[i++] = center.y + Math.sin(a) * radius\n\t\tarray[i++] = center.x + Math.cos(a + angle) * radius\n\t\tarray[i++] = center.y + Math.sin(a + angle) * radius\n\t}\n\treturn array\n}\n\n/** @internal **/\nexport function rectangle(\n\tarray: Float32Array,\n\toffset: number,\n\tx: number,\n\ty: number,\n\tw: number,\n\th: number\n) {\n\tarray[offset++] = x\n\tarray[offset++] = y\n\tarray[offset++] = x\n\tarray[offset++] = y + h\n\tarray[offset++] = x + w\n\tarray[offset++] = y\n\n\tarray[offset++] = x + w\n\tarray[offset++] = y\n\tarray[offset++] = x\n\tarray[offset++] = y + h\n\tarray[offset++] = x + w\n\tarray[offset++] = y + h\n}\n\nexport function roundedRectangle(data: Float32Array, box: Box, radius: number): number {\n\tconst numArcSegments = numArcSegmentsPerCorner\n\tradius = Math.min(radius, Math.min(box.w, box.h) / 2)\n\t// first draw the inner box\n\tconst innerBox = Box.ExpandBy(box, -radius)\n\tif (innerBox.w <= 0 || innerBox.h <= 0) {\n\t\t// just draw a circle\n\t\tpie(data, { center: box.center, radius: radius, numArcSegments: numArcSegmentsPerCorner * 4 })\n\t\treturn numArcSegmentsPerCorner * 4 * 6\n\t}\n\tlet offset = 0\n\t// draw center rect first\n\trectangle(data, offset, innerBox.minX, innerBox.minY, innerBox.w, innerBox.h)\n\toffset += 12\n\t// then top rect\n\trectangle(data, offset, innerBox.minX, box.minY, innerBox.w, radius)\n\toffset += 12\n\t// then right rect\n\trectangle(data, offset, innerBox.maxX, innerBox.minY, radius, innerBox.h)\n\toffset += 12\n\t// then bottom rect\n\trectangle(data, offset, innerBox.minX, innerBox.maxY, innerBox.w, radius)\n\toffset += 12\n\t// then left rect\n\trectangle(data, offset, box.minX, innerBox.minY, radius, innerBox.h)\n\toffset += 12\n\n\t// draw the corners\n\n\t// top left\n\tpie(data, {\n\t\tnumArcSegments,\n\t\toffset,\n\t\tcenter: innerBox.point,\n\t\tradius,\n\t\tstartAngle: PI,\n\t\tendAngle: PI * 1.5,\n\t})\n\n\toffset += numArcSegments * 6\n\n\t// top right\n\tpie(data, {\n\t\tnumArcSegments,\n\t\toffset,\n\t\tcenter: Vec.Add(innerBox.point, new Vec(innerBox.w, 0)),\n\t\tradius,\n\t\tstartAngle: PI * 1.5,\n\t\tendAngle: PI2,\n\t})\n\n\toffset += numArcSegments * 6\n\n\t// bottom right\n\tpie(data, {\n\t\tnumArcSegments,\n\t\toffset,\n\t\tcenter: Vec.Add(innerBox.point, innerBox.size),\n\t\tradius,\n\t\tstartAngle: 0,\n\t\tendAngle: HALF_PI,\n\t})\n\n\toffset += numArcSegments * 6\n\n\t// bottom left\n\tpie(data, {\n\t\tnumArcSegments,\n\t\toffset,\n\t\tcenter: Vec.Add(innerBox.point, new Vec(0, innerBox.h)),\n\t\tradius,\n\t\tstartAngle: HALF_PI,\n\t\tendAngle: PI,\n\t})\n\n\treturn roundedRectangleDataSize\n}\n", "import { roundedRectangleDataSize } from './minimap-webgl-shapes'\n\nexport function setupWebGl(canvas: HTMLCanvasElement | null) {\n\tif (!canvas) throw new Error('Canvas element not found')\n\n\tconst context = canvas.getContext('webgl2', {\n\t\tpremultipliedAlpha: false,\n\t})\n\tif (!context) throw new Error('Failed to get webgl2 context')\n\n\tconst vertexShaderSourceCode = `#version 300 es\n  precision mediump float;\n  \n  in vec2 shapeVertexPosition;\n\n\tuniform vec4 canvasPageBounds;\n\n\t// taken (with thanks) from\n\t// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html\n  void main() {\n\t\t// convert the position from pixels to 0.0 to 1.0\n\t\tvec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;\n\t\n\t\t// convert from 0->1 to 0->2\n\t\tvec2 zeroToTwo = zeroToOne * 2.0;\n\t\n\t\t// convert from 0->2 to -1->+1 (clipspace)\n\t\tvec2 clipSpace = zeroToTwo - 1.0;\n\t\n\t\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  }`\n\n\tconst vertexShader = context.createShader(context.VERTEX_SHADER)\n\tif (!vertexShader) {\n\t\tthrow new Error('Failed to create vertex shader')\n\t}\n\tcontext.shaderSource(vertexShader, vertexShaderSourceCode)\n\tcontext.compileShader(vertexShader)\n\tif (!context.getShaderParameter(vertexShader, context.COMPILE_STATUS)) {\n\t\tthrow new Error('Failed to compile vertex shader')\n\t}\n\n\tconst fragmentShaderSourceCode = `#version 300 es\n  precision mediump float;\n  \n\tuniform vec4 fillColor;\n  out vec4 outputColor;\n\n  void main() {\n\toutputColor = fillColor;\n  }`\n\n\tconst fragmentShader = context.createShader(context.FRAGMENT_SHADER)\n\tif (!fragmentShader) {\n\t\tthrow new Error('Failed to create fragment shader')\n\t}\n\tcontext.shaderSource(fragmentShader, fragmentShaderSourceCode)\n\tcontext.compileShader(fragmentShader)\n\tif (!context.getShaderParameter(fragmentShader, context.COMPILE_STATUS)) {\n\t\tthrow new Error('Failed to compile fragment shader')\n\t}\n\n\tconst program = context.createProgram()\n\tif (!program) {\n\t\tthrow new Error('Failed to create program')\n\t}\n\tcontext.attachShader(program, vertexShader)\n\tcontext.attachShader(program, fragmentShader)\n\tcontext.linkProgram(program)\n\tif (!context.getProgramParameter(program, context.LINK_STATUS)) {\n\t\tthrow new Error('Failed to link program')\n\t}\n\tcontext.useProgram(program)\n\n\tconst shapeVertexPositionAttributeLocation = context.getAttribLocation(\n\t\tprogram,\n\t\t'shapeVertexPosition'\n\t)\n\tif (shapeVertexPositionAttributeLocation < 0) {\n\t\tthrow new Error('Failed to get shapeVertexPosition attribute location')\n\t}\n\tcontext.enableVertexAttribArray(shapeVertexPositionAttributeLocation)\n\n\tconst canvasPageBoundsLocation = context.getUniformLocation(program, 'canvasPageBounds')\n\tconst fillColorLocation = context.getUniformLocation(program, 'fillColor')\n\n\tconst selectedShapesBuffer = context.createBuffer()\n\tif (!selectedShapesBuffer) throw new Error('Failed to create buffer')\n\n\tconst unselectedShapesBuffer = context.createBuffer()\n\tif (!unselectedShapesBuffer) throw new Error('Failed to create buffer')\n\n\treturn {\n\t\tcontext,\n\t\tselectedShapes: allocateBuffer(context, 1024),\n\t\tunselectedShapes: allocateBuffer(context, 4096),\n\t\tviewport: allocateBuffer(context, roundedRectangleDataSize),\n\t\tcollaborators: allocateBuffer(context, 1024),\n\n\t\tprepareTriangles(stuff: BufferStuff, len: number) {\n\t\t\tcontext.bindBuffer(context.ARRAY_BUFFER, stuff.buffer)\n\t\t\tcontext.bufferData(context.ARRAY_BUFFER, stuff.vertices, context.STATIC_DRAW, 0, len)\n\t\t\tcontext.enableVertexAttribArray(shapeVertexPositionAttributeLocation)\n\t\t\tcontext.vertexAttribPointer(\n\t\t\t\tshapeVertexPositionAttributeLocation,\n\t\t\t\t2,\n\t\t\t\tcontext.FLOAT,\n\t\t\t\tfalse,\n\t\t\t\t0,\n\t\t\t\t0\n\t\t\t)\n\t\t},\n\n\t\tdrawTrianglesTransparently(len: number) {\n\t\t\tcontext.enable(context.BLEND)\n\t\t\tcontext.blendFunc(context.SRC_ALPHA, context.ONE_MINUS_SRC_ALPHA)\n\t\t\tcontext.drawArrays(context.TRIANGLES, 0, len / 2)\n\t\t\tcontext.disable(context.BLEND)\n\t\t},\n\n\t\tdrawTriangles(len: number) {\n\t\t\tcontext.drawArrays(context.TRIANGLES, 0, len / 2)\n\t\t},\n\n\t\tsetFillColor(color: Float32Array) {\n\t\t\tcontext.uniform4fv(fillColorLocation, color)\n\t\t},\n\n\t\tsetCanvasPageBounds(bounds: Float32Array) {\n\t\t\tcontext.uniform4fv(canvasPageBoundsLocation, bounds)\n\t\t},\n\t}\n}\n\nexport type BufferStuff = ReturnType<typeof allocateBuffer>\n\nfunction allocateBuffer(context: WebGL2RenderingContext, size: number) {\n\tconst buffer = context.createBuffer()\n\tif (!buffer) throw new Error('Failed to create buffer')\n\treturn { buffer, vertices: new Float32Array(size) }\n}\n\nexport function appendVertices(bufferStuff: BufferStuff, offset: number, data: Float32Array) {\n\tlet len = bufferStuff.vertices.length\n\twhile (len < offset + data.length) {\n\t\tlen *= 2\n\t}\n\tif (len != bufferStuff.vertices.length) {\n\t\tconst newVertices = new Float32Array(len)\n\t\tnewVertices.set(bufferStuff.vertices)\n\t\tbufferStuff.vertices = newVertices\n\t}\n\n\tbufferStuff.vertices.set(data, offset)\n}\n", "import {\n\tBox,\n\tComputedCache,\n\tEditor,\n\tTLShape,\n\tVec,\n\tatom,\n\tclamp,\n\tcomputed,\n\treact,\n\tuniqueId,\n} from '@tldraw/editor'\nimport { getRgba } from './getRgba'\nimport { BufferStuff, appendVertices, setupWebGl } from './minimap-webgl-setup'\nimport { pie, rectangle, roundedRectangle } from './minimap-webgl-shapes'\n\nexport class MinimapManager {\n\tdisposables = [] as (() => void)[]\n\tclose = () => this.disposables.forEach((d) => d())\n\tgl: ReturnType<typeof setupWebGl>\n\tshapeGeometryCache: ComputedCache<Float32Array | null, TLShape>\n\tconstructor(\n\t\tpublic editor: Editor,\n\t\tpublic readonly elem: HTMLCanvasElement\n\t) {\n\t\tthis.gl = setupWebGl(elem)\n\t\tthis.shapeGeometryCache = editor.store.createComputedCache('webgl-geometry', (r: TLShape) => {\n\t\t\tconst bounds = editor.getShapeMaskedPageBounds(r.id)\n\t\t\tif (!bounds) return null\n\t\t\tconst arr = new Float32Array(12)\n\t\t\trectangle(arr, 0, bounds.x, bounds.y, bounds.w, bounds.h)\n\t\t\treturn arr\n\t\t})\n\t\tthis.colors = this._getColors()\n\t\tthis.disposables.push(this._listenForCanvasResize(), react('minimap render', this.render))\n\t}\n\n\tprivate _getColors() {\n\t\tconst style = getComputedStyle(this.editor.getContainer())\n\n\t\treturn {\n\t\t\tshapeFill: getRgba(style.getPropertyValue('--color-text-3').trim()),\n\t\t\tselectFill: getRgba(style.getPropertyValue('--color-selected').trim()),\n\t\t\tviewportFill: getRgba(style.getPropertyValue('--color-muted-1').trim()),\n\t\t\tbackground: getRgba(style.getPropertyValue('--color-low').trim()),\n\t\t}\n\t}\n\n\tprivate colors: ReturnType<MinimapManager['_getColors']>\n\t// this should be called after dark/light mode changes have propagated to the dom\n\tupdateColors() {\n\t\tthis.colors = this._getColors()\n\t}\n\n\treadonly id = uniqueId()\n\t@computed\n\tgetDpr() {\n\t\treturn this.editor.getInstanceState().devicePixelRatio\n\t}\n\n\t@computed\n\tgetContentPageBounds() {\n\t\tconst viewportPageBounds = this.editor.getViewportPageBounds()\n\t\tconst commonShapeBounds = this.editor.getCurrentPageBounds()\n\t\treturn commonShapeBounds\n\t\t\t? Box.Expand(commonShapeBounds, viewportPageBounds)\n\t\t\t: viewportPageBounds\n\t}\n\n\t@computed\n\tgetContentScreenBounds() {\n\t\tconst contentPageBounds = this.getContentPageBounds()\n\t\tconst topLeft = this.editor.pageToScreen(contentPageBounds.point)\n\t\tconst bottomRight = this.editor.pageToScreen(\n\t\t\tnew Vec(contentPageBounds.maxX, contentPageBounds.maxY)\n\t\t)\n\t\treturn new Box(topLeft.x, topLeft.y, bottomRight.x - topLeft.x, bottomRight.y - topLeft.y)\n\t}\n\n\tprivate _getCanvasBoundingRect() {\n\t\tconst { x, y, width, height } = this.elem.getBoundingClientRect()\n\t\treturn new Box(x, y, width, height)\n\t}\n\n\tprivate readonly canvasBoundingClientRect = atom('canvasBoundingClientRect', new Box())\n\n\tgetCanvasScreenBounds() {\n\t\treturn this.canvasBoundingClientRect.get()\n\t}\n\n\tprivate _listenForCanvasResize() {\n\t\tconst observer = new ResizeObserver(() => {\n\t\t\tconst rect = this._getCanvasBoundingRect()\n\t\t\tthis.canvasBoundingClientRect.set(rect)\n\t\t})\n\t\tobserver.observe(this.elem)\n\t\treturn () => observer.disconnect()\n\t}\n\n\t@computed\n\tgetCanvasSize() {\n\t\tconst rect = this.canvasBoundingClientRect.get()\n\t\tconst dpr = this.getDpr()\n\t\treturn new Vec(rect.width * dpr, rect.height * dpr)\n\t}\n\n\t@computed\n\tgetCanvasClientPosition() {\n\t\treturn this.canvasBoundingClientRect.get().point\n\t}\n\n\toriginPagePoint = new Vec()\n\toriginPageCenter = new Vec()\n\n\tisInViewport = false\n\n\t/** Get the canvas's true bounds converted to page bounds. */\n\t@computed getCanvasPageBounds() {\n\t\tconst canvasScreenBounds = this.getCanvasScreenBounds()\n\t\tconst contentPageBounds = this.getContentPageBounds()\n\n\t\tconst aspectRatio = canvasScreenBounds.width / canvasScreenBounds.height\n\n\t\tlet targetWidth = contentPageBounds.width\n\t\tlet targetHeight = targetWidth / aspectRatio\n\t\tif (targetHeight < contentPageBounds.height) {\n\t\t\ttargetHeight = contentPageBounds.height\n\t\t\ttargetWidth = targetHeight * aspectRatio\n\t\t}\n\n\t\tconst box = new Box(0, 0, targetWidth, targetHeight)\n\t\tbox.center = contentPageBounds.center\n\t\treturn box\n\t}\n\n\t@computed getZoom() {\n\t\treturn this.getCanvasPageBounds().width / this.getCanvasScreenBounds().width\n\t}\n\n\t@computed getCanvasPageBoundsArray() {\n\t\tconst { x, y, w, h } = this.getCanvasPageBounds()\n\t\treturn new Float32Array([x, y, w, h])\n\t}\n\n\tgetMinimapPagePoint = (clientX: number, clientY: number) => {\n\t\tconst canvasPageBounds = this.getCanvasPageBounds()\n\t\tconst canvasScreenBounds = this.getCanvasScreenBounds()\n\n\t\t// first offset the canvas position\n\t\tlet x = clientX - canvasScreenBounds.x\n\t\tlet y = clientY - canvasScreenBounds.y\n\n\t\t// then multiply by the ratio between the page and screen bounds\n\t\tx *= canvasPageBounds.width / canvasScreenBounds.width\n\t\ty *= canvasPageBounds.height / canvasScreenBounds.height\n\n\t\t// then add the canvas page bounds' offset\n\t\tx += canvasPageBounds.minX\n\t\ty += canvasPageBounds.minY\n\n\t\treturn new Vec(x, y, 1)\n\t}\n\n\tminimapScreenPointToPagePoint = (\n\t\tx: number,\n\t\ty: number,\n\t\tshiftKey = false,\n\t\tclampToBounds = false\n\t) => {\n\t\tconst { editor } = this\n\t\tconst viewportPageBounds = editor.getViewportPageBounds()\n\n\t\tlet { x: px, y: py } = this.getMinimapPagePoint(x, y)\n\n\t\tif (clampToBounds) {\n\t\t\tconst shapesPageBounds = this.editor.getCurrentPageBounds() ?? new Box()\n\t\t\tconst vpPageBounds = viewportPageBounds\n\n\t\t\tconst minX = shapesPageBounds.minX - vpPageBounds.width / 2\n\t\t\tconst maxX = shapesPageBounds.maxX + vpPageBounds.width / 2\n\t\t\tconst minY = shapesPageBounds.minY - vpPageBounds.height / 2\n\t\t\tconst maxY = shapesPageBounds.maxY + vpPageBounds.height / 2\n\n\t\t\tconst lx = Math.max(0, minX + vpPageBounds.width - px)\n\t\t\tconst rx = Math.max(0, -(maxX - vpPageBounds.width - px))\n\t\t\tconst ly = Math.max(0, minY + vpPageBounds.height - py)\n\t\t\tconst ry = Math.max(0, -(maxY - vpPageBounds.height - py))\n\n\t\t\tconst ql = Math.max(0, lx - rx)\n\t\t\tconst qr = Math.max(0, rx - lx)\n\t\t\tconst qt = Math.max(0, ly - ry)\n\t\t\tconst qb = Math.max(0, ry - ly)\n\n\t\t\tif (ql && ql > qr) {\n\t\t\t\tpx += ql / 2\n\t\t\t} else if (qr) {\n\t\t\t\tpx -= qr / 2\n\t\t\t}\n\n\t\t\tif (qt && qt > qb) {\n\t\t\t\tpy += qt / 2\n\t\t\t} else if (qb) {\n\t\t\t\tpy -= qb / 2\n\t\t\t}\n\n\t\t\tpx = clamp(px, minX, maxX)\n\t\t\tpy = clamp(py, minY, maxY)\n\t\t}\n\n\t\tif (shiftKey) {\n\t\t\tconst { originPagePoint } = this\n\t\t\tconst dx = Math.abs(px - originPagePoint.x)\n\t\t\tconst dy = Math.abs(py - originPagePoint.y)\n\t\t\tif (dx > dy) {\n\t\t\t\tpy = originPagePoint.y\n\t\t\t} else {\n\t\t\t\tpx = originPagePoint.x\n\t\t\t}\n\t\t}\n\n\t\treturn new Vec(px, py)\n\t}\n\n\trender = () => {\n\t\t// make sure we update when dark mode switches\n\t\tconst context = this.gl.context\n\t\tconst canvasSize = this.getCanvasSize()\n\n\t\tthis.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray())\n\n\t\tthis.elem.width = canvasSize.x\n\t\tthis.elem.height = canvasSize.y\n\t\tcontext.viewport(0, 0, canvasSize.x, canvasSize.y)\n\n\t\t// this affects which color transparent shapes are blended with\n\t\t// during rendering. If we were to invert this any shapes narrower\n\t\t// than 1 px in screen space would have much lower contrast. e.g.\n\t\t// draw shapes on a large canvas.\n\t\tcontext.clearColor(\n\t\t\tthis.colors.background[0],\n\t\t\tthis.colors.background[1],\n\t\t\tthis.colors.background[2],\n\t\t\t1\n\t\t)\n\n\t\tcontext.clear(context.COLOR_BUFFER_BIT)\n\n\t\tconst selectedShapes = new Set(this.editor.getSelectedShapeIds())\n\n\t\tconst colors = this.colors\n\t\tlet selectedShapeOffset = 0\n\t\tlet unselectedShapeOffset = 0\n\n\t\tconst ids = this.editor.getCurrentPageShapeIdsSorted()\n\n\t\tfor (let i = 0, len = ids.length; i < len; i++) {\n\t\t\tconst shapeId = ids[i]\n\t\t\tconst geometry = this.shapeGeometryCache.get(shapeId)\n\t\t\tif (!geometry) continue\n\n\t\t\tconst len = geometry.length\n\n\t\t\tif (selectedShapes.has(shapeId)) {\n\t\t\t\tappendVertices(this.gl.selectedShapes, selectedShapeOffset, geometry)\n\t\t\t\tselectedShapeOffset += len\n\t\t\t} else {\n\t\t\t\tappendVertices(this.gl.unselectedShapes, unselectedShapeOffset, geometry)\n\t\t\t\tunselectedShapeOffset += len\n\t\t\t}\n\t\t}\n\n\t\tthis.drawShapes(this.gl.unselectedShapes, unselectedShapeOffset, colors.shapeFill)\n\t\tthis.drawShapes(this.gl.selectedShapes, selectedShapeOffset, colors.selectFill)\n\n\t\tthis.drawViewport()\n\t\tthis.drawCollaborators()\n\t}\n\n\tprivate drawShapes(stuff: BufferStuff, len: number, color: Float32Array) {\n\t\tthis.gl.prepareTriangles(stuff, len)\n\t\tthis.gl.setFillColor(color)\n\t\tthis.gl.drawTriangles(len)\n\t}\n\n\tprivate drawViewport() {\n\t\tconst viewport = this.editor.getViewportPageBounds()\n\t\tconst len = roundedRectangle(this.gl.viewport.vertices, viewport, 4 * this.getZoom())\n\n\t\tthis.gl.prepareTriangles(this.gl.viewport, len)\n\t\tthis.gl.setFillColor(this.colors.viewportFill)\n\t\tthis.gl.drawTrianglesTransparently(len)\n\t}\n\n\tdrawCollaborators() {\n\t\tconst collaborators = this.editor.getCollaboratorsOnCurrentPage()\n\t\tif (!collaborators.length) return\n\n\t\t// just draw a little circle for each collaborator\n\t\tconst numSegmentsPerCircle = 20\n\t\tconst dataSizePerCircle = numSegmentsPerCircle * 6\n\t\tconst totalSize = dataSizePerCircle * collaborators.length\n\n\t\t// expand vertex array if needed\n\t\tif (this.gl.collaborators.vertices.length < totalSize) {\n\t\t\tthis.gl.collaborators.vertices = new Float32Array(totalSize)\n\t\t}\n\n\t\tconst vertices = this.gl.collaborators.vertices\n\t\tlet offset = 0\n\t\tconst zoom = this.getZoom()\n\t\tfor (const { cursor } of collaborators) {\n\t\t\tpie(vertices, {\n\t\t\t\tcenter: Vec.From(cursor),\n\t\t\t\tradius: 3 * zoom,\n\t\t\t\toffset,\n\t\t\t\tnumArcSegments: numSegmentsPerCircle,\n\t\t\t})\n\t\t\toffset += dataSizePerCircle\n\t\t}\n\n\t\tthis.gl.prepareTriangles(this.gl.collaborators, totalSize)\n\n\t\toffset = 0\n\t\tfor (const { color } of collaborators) {\n\t\t\tthis.gl.setFillColor(getRgba(color))\n\t\t\tthis.gl.context.drawArrays(this.gl.context.TRIANGLES, offset / 2, dataSizePerCircle / 2)\n\t\t\toffset += dataSizePerCircle\n\t\t}\n\t}\n}\n", "import { memo, useCallback } from 'react'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { unwrapLabel, useActions } from '../../context/actions'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { useTldrawUiComponents } from '../../context/components'\nimport { useLocalStorageState } from '../../hooks/useLocalStorageState'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { kbdStr } from '../../kbd-utils'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\n\n/** @public */\nexport const DefaultNavigationPanel = memo(function DefaultNavigationPanel() {\n\tconst actions = useActions()\n\tconst msg = useTranslation()\n\tconst breakpoint = useBreakpoint()\n\n\tconst [collapsed, setCollapsed] = useLocalStorageState('minimap', true)\n\n\tconst toggleMinimap = useCallback(() => {\n\t\tsetCollapsed((s) => !s)\n\t}, [setCollapsed])\n\n\tconst { ZoomMenu, Minimap } = useTldrawUiComponents()\n\n\tif (breakpoint < PORTRAIT_BREAKPOINT.MOBILE) {\n\t\treturn null\n\t}\n\n\treturn (\n\t\t<div className=\"tlui-navigation-panel\">\n\t\t\t<div className=\"tlui-buttons__horizontal\">\n\t\t\t\t{ZoomMenu && breakpoint < PORTRAIT_BREAKPOINT.TABLET ? (\n\t\t\t\t\t<ZoomMenu />\n\t\t\t\t) : collapsed ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t{ZoomMenu && <ZoomMenu />}\n\t\t\t\t\t\t{Minimap && (\n\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\tdata-testid=\"minimap.toggle-button\"\n\t\t\t\t\t\t\t\ttitle={msg('navigation-zone.toggle-minimap')}\n\t\t\t\t\t\t\t\tclassName=\"tlui-navigation-panel__toggle\"\n\t\t\t\t\t\t\t\tonClick={toggleMinimap}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon={collapsed ? 'chevrons-ne' : 'chevrons-sw'} />\n\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\tdata-testid=\"minimap.zoom-out\"\n\t\t\t\t\t\t\ttitle={`${msg(unwrapLabel(actions['zoom-out'].label))} ${kbdStr(actions['zoom-out'].kbd!)}`}\n\t\t\t\t\t\t\tonClick={() => actions['zoom-out'].onSelect('navigation-zone')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"minus\" />\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t{ZoomMenu && <ZoomMenu />}\n\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\tdata-testid=\"minimap.zoom-in\"\n\t\t\t\t\t\t\ttitle={`${msg(unwrapLabel(actions['zoom-in'].label))} ${kbdStr(actions['zoom-in'].kbd!)}`}\n\t\t\t\t\t\t\tonClick={() => actions['zoom-in'].onSelect('navigation-zone')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"plus\" />\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t{Minimap && (\n\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\tdata-testid=\"minimap.toggle-button\"\n\t\t\t\t\t\t\t\ttitle={msg('navigation-zone.toggle-minimap')}\n\t\t\t\t\t\t\t\tclassName=\"tlui-navigation-panel__toggle\"\n\t\t\t\t\t\t\t\tonClick={toggleMinimap}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon={collapsed ? 'chevrons-ne' : 'chevrons-sw'} />\n\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t\t{Minimap && breakpoint >= PORTRAIT_BREAKPOINT.TABLET && !collapsed && <Minimap />}\n\t\t</div>\n\t)\n})\n", "import { getFromLocalStorage, setInLocalStorage } from '@tldraw/editor'\nimport React from 'react'\n\n/** @public */\nexport function useLocalStorageState<T = any>(key: string, defaultValue: T) {\n\tconst [state, setState] = React.useState(defaultValue)\n\n\tReact.useLayoutEffect(() => {\n\t\tconst value = getFromLocalStorage(key)\n\t\tif (value) {\n\t\t\ttry {\n\t\t\t\tsetState(JSON.parse(value))\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(`Could not restore value ${key} from local storage.`)\n\t\t\t}\n\t\t}\n\t}, [key])\n\n\tconst updateValue = React.useCallback(\n\t\t(setter: T | ((value: T) => T)) => {\n\t\t\tsetState((s) => {\n\t\t\t\tconst value = typeof setter === 'function' ? (setter as any)(s) : setter\n\t\t\t\tsetInLocalStorage(key, JSON.stringify(value))\n\t\t\t\treturn value\n\t\t\t})\n\t\t},\n\t\t[key]\n\t)\n\n\treturn [state, updateValue] as const\n}\n", "import {\n\tMAX_PAGES,\n\tPageRecordType,\n\tTLPageId,\n\treleasePointerCapture,\n\tsetPointerCapture,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\nimport { memo, useCallback, useEffect, useLayoutEffect, useRef, useState } from 'react'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { useMenuIsOpen } from '../../hooks/useMenuIsOpen'\nimport { useReadonly } from '../../hooks/useReadonly'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonCheck } from '../primitives/Button/TldrawUiButtonCheck'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport { TldrawUiButtonLabel } from '../primitives/Button/TldrawUiButtonLabel'\nimport {\n\tTldrawUiPopover,\n\tTldrawUiPopoverContent,\n\tTldrawUiPopoverTrigger,\n} from '../primitives/TldrawUiPopover'\nimport { PageItemInput } from './PageItemInput'\nimport { PageItemSubmenu } from './PageItemSubmenu'\nimport { onMovePage } from './edit-pages-shared'\n\n/** @public */\nexport const DefaultPageMenu = memo(function DefaultPageMenu() {\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\tconst breakpoint = useBreakpoint()\n\n\tconst handleOpenChange = useCallback(() => setIsEditing(false), [])\n\n\tconst [isOpen, onOpenChange] = useMenuIsOpen('page-menu', handleOpenChange)\n\n\tconst ITEM_HEIGHT = 36\n\n\tconst rSortableContainer = useRef<HTMLDivElement>(null)\n\n\tconst pages = useValue('pages', () => editor.getPages(), [editor])\n\tconst currentPage = useValue('currentPage', () => editor.getCurrentPage(), [editor])\n\tconst currentPageId = useValue('currentPageId', () => editor.getCurrentPageId(), [editor])\n\n\t// When in readonly mode, we don't allow a user to edit the pages\n\tconst isReadonlyMode = useReadonly()\n\n\t// If the user has reached the max page count, we disable the \"add page\" button\n\tconst maxPageCountReached = useValue(\n\t\t'maxPageCountReached',\n\t\t() => editor.getPages().length >= MAX_PAGES,\n\t\t[editor]\n\t)\n\n\tconst isCoarsePointer = useValue(\n\t\t'isCoarsePointer',\n\t\t() => editor.getInstanceState().isCoarsePointer,\n\t\t[editor]\n\t)\n\n\t// The component has an \"editing state\" that may be toggled to expose additional controls\n\tconst [isEditing, setIsEditing] = useState(false)\n\n\tconst toggleEditing = useCallback(() => {\n\t\tif (isReadonlyMode) return\n\t\tsetIsEditing((s) => !s)\n\t}, [isReadonlyMode])\n\n\tconst rMutables = useRef({\n\t\tisPointing: false,\n\t\tstatus: 'idle' as 'idle' | 'pointing' | 'dragging',\n\t\tpointing: null as { id: string; index: number } | null,\n\t\tstartY: 0,\n\t\tstartIndex: 0,\n\t\tdragIndex: 0,\n\t})\n\n\tconst [sortablePositionItems, setSortablePositionItems] = useState(\n\t\tObject.fromEntries(\n\t\t\tpages.map((page, i) => [page.id, { y: i * ITEM_HEIGHT, offsetY: 0, isSelected: false }])\n\t\t)\n\t)\n\n\t// Update the sortable position items when the pages change\n\tuseLayoutEffect(() => {\n\t\tsetSortablePositionItems(\n\t\t\tObject.fromEntries(\n\t\t\t\tpages.map((page, i) => [page.id, { y: i * ITEM_HEIGHT, offsetY: 0, isSelected: false }])\n\t\t\t)\n\t\t)\n\t}, [ITEM_HEIGHT, pages])\n\n\t// Scroll the current page into view when the menu opens / when current page changes\n\tuseEffect(() => {\n\t\tif (!isOpen) return\n\t\trequestAnimationFrame(() => {\n\t\t\tconst elm = document.querySelector(\n\t\t\t\t`[data-testid=\"page-menu-item-${currentPageId}\"]`\n\t\t\t) as HTMLDivElement\n\n\t\t\tif (elm) {\n\t\t\t\tconst container = rSortableContainer.current\n\t\t\t\tif (!container) return\n\t\t\t\t// Scroll into view is slightly borked on iOS Safari\n\n\t\t\t\t// if top of less than top cuttoff, scroll into view at top\n\t\t\t\tconst elmTopPosition = elm.offsetTop\n\t\t\t\tconst containerScrollTopPosition = container.scrollTop\n\t\t\t\tif (elmTopPosition < containerScrollTopPosition) {\n\t\t\t\t\tcontainer.scrollTo({ top: elmTopPosition })\n\t\t\t\t}\n\t\t\t\t// if bottom position is greater than bottom cutoff, scroll into view at bottom\n\t\t\t\tconst elmBottomPosition = elmTopPosition + ITEM_HEIGHT\n\t\t\t\tconst containerScrollBottomPosition = container.scrollTop + container.offsetHeight\n\t\t\t\tif (elmBottomPosition > containerScrollBottomPosition) {\n\t\t\t\t\tcontainer.scrollTo({ top: elmBottomPosition - container.offsetHeight })\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}, [ITEM_HEIGHT, currentPageId, isOpen])\n\n\tconst handlePointerDown = useCallback(\n\t\t(e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst { clientY, currentTarget } = e\n\t\t\tconst {\n\t\t\t\tdataset: { id, index },\n\t\t\t} = currentTarget\n\n\t\t\tif (!id || !index) return\n\n\t\t\tconst mut = rMutables.current\n\n\t\t\tsetPointerCapture(e.currentTarget, e)\n\n\t\t\tmut.status = 'pointing'\n\t\t\tmut.pointing = { id, index: +index! }\n\t\t\tconst current = sortablePositionItems[id]\n\t\t\tconst dragY = current.y\n\n\t\t\tmut.startY = clientY\n\t\t\tmut.startIndex = Math.max(0, Math.min(Math.round(dragY / ITEM_HEIGHT), pages.length - 1))\n\t\t},\n\t\t[ITEM_HEIGHT, pages.length, sortablePositionItems]\n\t)\n\n\tconst handlePointerMove = useCallback(\n\t\t(e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst mut = rMutables.current\n\t\t\tif (mut.status === 'pointing') {\n\t\t\t\tconst { clientY } = e\n\t\t\t\tconst offset = clientY - mut.startY\n\t\t\t\tif (Math.abs(offset) > 5) {\n\t\t\t\t\tmut.status = 'dragging'\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (mut.status === 'dragging') {\n\t\t\t\tconst { clientY } = e\n\t\t\t\tconst offsetY = clientY - mut.startY\n\t\t\t\tconst current = sortablePositionItems[mut.pointing!.id]\n\n\t\t\t\tconst { startIndex, pointing } = mut\n\t\t\t\tconst dragY = current.y + offsetY\n\t\t\t\tconst dragIndex = Math.max(0, Math.min(Math.round(dragY / ITEM_HEIGHT), pages.length - 1))\n\n\t\t\t\tconst next = { ...sortablePositionItems }\n\t\t\t\tnext[pointing!.id] = {\n\t\t\t\t\ty: current.y,\n\t\t\t\t\toffsetY,\n\t\t\t\t\tisSelected: true,\n\t\t\t\t}\n\n\t\t\t\tif (dragIndex !== mut.dragIndex) {\n\t\t\t\t\tmut.dragIndex = dragIndex\n\n\t\t\t\t\tfor (let i = 0; i < pages.length; i++) {\n\t\t\t\t\t\tconst item = pages[i]\n\t\t\t\t\t\tif (item.id === mut.pointing!.id) {\n\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet { y } = next[item.id]\n\n\t\t\t\t\t\tif (dragIndex === startIndex) {\n\t\t\t\t\t\t\ty = i * ITEM_HEIGHT\n\t\t\t\t\t\t} else if (dragIndex < startIndex) {\n\t\t\t\t\t\t\tif (dragIndex <= i && i < startIndex) {\n\t\t\t\t\t\t\t\ty = (i + 1) * ITEM_HEIGHT\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ty = i * ITEM_HEIGHT\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (dragIndex > startIndex) {\n\t\t\t\t\t\t\tif (dragIndex >= i && i > startIndex) {\n\t\t\t\t\t\t\t\ty = (i - 1) * ITEM_HEIGHT\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ty = i * ITEM_HEIGHT\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (y !== next[item.id].y) {\n\t\t\t\t\t\t\tnext[item.id] = { y, offsetY: 0, isSelected: true }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsetSortablePositionItems(next)\n\t\t\t}\n\t\t},\n\t\t[ITEM_HEIGHT, pages, sortablePositionItems]\n\t)\n\n\tconst handlePointerUp = useCallback(\n\t\t(e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst mut = rMutables.current\n\n\t\t\tif (mut.status === 'dragging') {\n\t\t\t\tconst { id, index } = mut.pointing!\n\t\t\t\tonMovePage(editor, id as TLPageId, index, mut.dragIndex)\n\t\t\t}\n\n\t\t\treleasePointerCapture(e.currentTarget, e)\n\t\t\tmut.status = 'idle'\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst handleKeyDown = useCallback(\n\t\t(e: React.KeyboardEvent<HTMLButtonElement>) => {\n\t\t\tconst mut = rMutables.current\n\t\t\t// bail on escape\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tif (mut.status === 'dragging') {\n\t\t\t\t\tsetSortablePositionItems(\n\t\t\t\t\t\tObject.fromEntries(\n\t\t\t\t\t\t\tpages.map((page, i) => [\n\t\t\t\t\t\t\t\tpage.id,\n\t\t\t\t\t\t\t\t{ y: i * ITEM_HEIGHT, offsetY: 0, isSelected: false },\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tmut.status = 'idle'\n\t\t\t}\n\t\t},\n\t\t[ITEM_HEIGHT, pages]\n\t)\n\n\tconst handleCreatePageClick = useCallback(() => {\n\t\tif (isReadonlyMode) return\n\n\t\teditor.batch(() => {\n\t\t\teditor.mark('creating page')\n\t\t\tconst newPageId = PageRecordType.createId()\n\t\t\teditor.createPage({ name: msg('page-menu.new-page-initial-name'), id: newPageId })\n\t\t\teditor.setCurrentPage(newPageId)\n\t\t\tsetIsEditing(true)\n\t\t})\n\t}, [editor, msg, isReadonlyMode])\n\n\treturn (\n\t\t<TldrawUiPopover id=\"pages\" onOpenChange={onOpenChange} open={isOpen}>\n\t\t\t<TldrawUiPopoverTrigger data-testid=\"main.page-menu\">\n\t\t\t\t<TldrawUiButton\n\t\t\t\t\ttype=\"menu\"\n\t\t\t\t\ttitle={currentPage.name}\n\t\t\t\t\tdata-testid=\"page-menu.button\"\n\t\t\t\t\tclassName=\"tlui-page-menu__trigger\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"tlui-page-menu__name\">{currentPage.name}</div>\n\t\t\t\t\t<TldrawUiButtonIcon icon=\"chevron-down\" small />\n\t\t\t\t</TldrawUiButton>\n\t\t\t</TldrawUiPopoverTrigger>\n\t\t\t<TldrawUiPopoverContent side=\"bottom\" align=\"start\" sideOffset={6}>\n\t\t\t\t<div className=\"tlui-page-menu__wrapper\">\n\t\t\t\t\t<div className=\"tlui-page-menu__header\">\n\t\t\t\t\t\t<div className=\"tlui-page-menu__header__title\">{msg('page-menu.title')}</div>\n\t\t\t\t\t\t{!isReadonlyMode && (\n\t\t\t\t\t\t\t<div className=\"tlui-buttons__horizontal\">\n\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\t\tdata-testid=\"page-menu.edit\"\n\t\t\t\t\t\t\t\t\ttitle={msg(isEditing ? 'page-menu.edit-done' : 'page-menu.edit-start')}\n\t\t\t\t\t\t\t\t\tonClick={toggleEditing}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon={isEditing ? 'check' : 'edit'} />\n\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\t\tdata-testid=\"page-menu.create\"\n\t\t\t\t\t\t\t\t\ttitle={msg(\n\t\t\t\t\t\t\t\t\t\tmaxPageCountReached\n\t\t\t\t\t\t\t\t\t\t\t? 'page-menu.max-page-count-reached'\n\t\t\t\t\t\t\t\t\t\t\t: 'page-menu.create-new-page'\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tdisabled={maxPageCountReached}\n\t\t\t\t\t\t\t\t\tonClick={handleCreatePageClick}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"plus\" />\n\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tdata-testid=\"page-menu.list\"\n\t\t\t\t\t\tclassName=\"tlui-page-menu__list tlui-menu__group\"\n\t\t\t\t\t\tstyle={{ height: ITEM_HEIGHT * pages.length + 4 }}\n\t\t\t\t\t\tref={rSortableContainer}\n\t\t\t\t\t>\n\t\t\t\t\t\t{pages.map((page, index) => {\n\t\t\t\t\t\t\tconst position = sortablePositionItems[page.id] ?? {\n\t\t\t\t\t\t\t\tposition: index * 40,\n\t\t\t\t\t\t\t\toffsetY: 0,\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn isEditing ? (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={page.id + '_editing'}\n\t\t\t\t\t\t\t\t\tdata-testid=\"page-menu.item\"\n\t\t\t\t\t\t\t\t\tclassName=\"tlui-page_menu__item__sortable\"\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\tzIndex: page.id === currentPage.id ? 888 : index,\n\t\t\t\t\t\t\t\t\t\ttransform: `translate(0px, ${position.y + position.offsetY}px)`,\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\t\t\ttabIndex={-1}\n\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-page_menu__item__sortable__handle\"\n\t\t\t\t\t\t\t\t\t\tonPointerDown={handlePointerDown}\n\t\t\t\t\t\t\t\t\t\tonPointerUp={handlePointerUp}\n\t\t\t\t\t\t\t\t\t\tonPointerMove={handlePointerMove}\n\t\t\t\t\t\t\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t\t\t\t\t\t\tdata-id={page.id}\n\t\t\t\t\t\t\t\t\t\tdata-index={index}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"drag-handle-dots\" />\n\t\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t\t\t{breakpoint < PORTRAIT_BREAKPOINT.TABLET_SM && isCoarsePointer ? (\n\t\t\t\t\t\t\t\t\t\t// sigh, this is a workaround for iOS Safari\n\t\t\t\t\t\t\t\t\t\t// because the device and the radix popover seem\n\t\t\t\t\t\t\t\t\t\t// to be fighting over scroll position. Nothing\n\t\t\t\t\t\t\t\t\t\t// else seems to work!\n\t\t\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\t\t\ttype=\"normal\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-page-menu__item__button\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst name = window.prompt('Rename page', page.name)\n\t\t\t\t\t\t\t\t\t\t\t\tif (name && name !== page.name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\teditor.renamePage(page.id, name)\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonDoubleClick={toggleEditing}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<TldrawUiButtonCheck checked={page.id === currentPage.id} />\n\t\t\t\t\t\t\t\t\t\t\t<TldrawUiButtonLabel>{page.name}</TldrawUiButtonLabel>\n\t\t\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-page_menu__item__sortable__title\"\n\t\t\t\t\t\t\t\t\t\t\tstyle={{ height: ITEM_HEIGHT }}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<PageItemInput\n\t\t\t\t\t\t\t\t\t\t\t\tid={page.id}\n\t\t\t\t\t\t\t\t\t\t\t\tname={page.name}\n\t\t\t\t\t\t\t\t\t\t\t\tisCurrentPage={page.id === currentPage.id}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{!isReadonlyMode && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"tlui-page_menu__item__submenu\" data-isediting={isEditing}>\n\t\t\t\t\t\t\t\t\t\t\t<PageItemSubmenu index={index} item={page} listSize={pages.length} />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div key={page.id} data-testid=\"page-menu.item\" className=\"tlui-page-menu__item\">\n\t\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\t\ttype=\"normal\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"tlui-page-menu__item__button\"\n\t\t\t\t\t\t\t\t\t\tonClick={() => editor.setCurrentPage(page.id)}\n\t\t\t\t\t\t\t\t\t\tonDoubleClick={toggleEditing}\n\t\t\t\t\t\t\t\t\t\ttitle={msg('page-menu.go-to-page')}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<TldrawUiButtonCheck checked={page.id === currentPage.id} />\n\t\t\t\t\t\t\t\t\t\t<TldrawUiButtonLabel>{page.name}</TldrawUiButtonLabel>\n\t\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t\t\t{!isReadonlyMode && (\n\t\t\t\t\t\t\t\t\t\t<div className=\"tlui-page_menu__item__submenu\">\n\t\t\t\t\t\t\t\t\t\t\t<PageItemSubmenu\n\t\t\t\t\t\t\t\t\t\t\t\tindex={index}\n\t\t\t\t\t\t\t\t\t\t\t\titem={page}\n\t\t\t\t\t\t\t\t\t\t\t\tlistSize={pages.length}\n\t\t\t\t\t\t\t\t\t\t\t\tonRename={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (editor.environment.isIos) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst name = window.prompt('Rename page', page.name)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (name && name !== page.name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\teditor.renamePage(page.id, name)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\teditor.batch(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetIsEditing(true)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\teditor.setCurrentPage(page.id)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</TldrawUiPopoverContent>\n\t\t</TldrawUiPopover>\n\t)\n})\n", "import { TLPageId, useEditor } from '@tldraw/editor'\nimport { useCallback, useRef } from 'react'\nimport { TldrawUiInput } from '../primitives/TldrawUiInput'\n/** @public */\nexport const PageItemInput = function PageItemInput({\n\tname,\n\tid,\n\tisCurrentPage,\n}: {\n\tname: string\n\tid: TLPageId\n\tisCurrentPage: boolean\n}) {\n\tconst editor = useEditor()\n\n\tconst rInput = useRef<HTMLInputElement | null>(null)\n\n\tconst handleChange = useCallback(\n\t\t(value: string) => {\n\t\t\teditor.renamePage(id, value ? value : 'New Page', { ephemeral: true })\n\t\t},\n\t\t[editor, id]\n\t)\n\n\tconst handleComplete = useCallback(\n\t\t(value: string) => {\n\t\t\teditor.mark('rename page')\n\t\t\teditor.renamePage(id, value || 'New Page', { ephemeral: false })\n\t\t},\n\t\t[editor, id]\n\t)\n\n\treturn (\n\t\t<TldrawUiInput\n\t\t\tclassName=\"tlui-page-menu__item__input\"\n\t\t\tref={(el) => (rInput.current = el)}\n\t\t\tdefaultValue={name}\n\t\t\tonValueChange={handleChange}\n\t\t\tonComplete={handleComplete}\n\t\t\tonCancel={handleComplete}\n\t\t\tshouldManuallyMaintainScrollPositionWhenFocused\n\t\t\tautofocus={isCurrentPage}\n\t\t\tautoselect\n\t\t/>\n\t)\n}\n", "import { MAX_PAGES, PageRecordType, TLPageId, track, useEditor } from '@tldraw/editor'\nimport { useCallback } from 'react'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport {\n\tTldrawUiDropdownMenuContent,\n\tTldrawUiDropdownMenuRoot,\n\tTldrawUiDropdownMenuTrigger,\n} from '../primitives/TldrawUiDropdownMenu'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { TldrawUiMenuGroup } from '../primitives/menus/TldrawUiMenuGroup'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\nimport { onMovePage } from './edit-pages-shared'\n/** @public */\nexport interface PageItemSubmenuProps {\n\tindex: number\n\titem: { id: string; name: string }\n\tlistSize: number\n\tonRename?: () => void\n}\n/** @public */\nexport const PageItemSubmenu = track(function PageItemSubmenu({\n\tindex,\n\tlistSize,\n\titem,\n\tonRename,\n}: PageItemSubmenuProps) {\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\tconst pages = editor.getPages()\n\n\tconst onDuplicate = useCallback(() => {\n\t\teditor.mark('creating page')\n\t\tconst newId = PageRecordType.createId()\n\t\teditor.duplicatePage(item.id as TLPageId, newId)\n\t}, [editor, item])\n\n\tconst onMoveUp = useCallback(() => {\n\t\tonMovePage(editor, item.id as TLPageId, index, index - 1)\n\t}, [editor, item, index])\n\n\tconst onMoveDown = useCallback(() => {\n\t\tonMovePage(editor, item.id as TLPageId, index, index + 1)\n\t}, [editor, item, index])\n\n\tconst onDelete = useCallback(() => {\n\t\teditor.mark('deleting page')\n\t\teditor.deletePage(item.id as TLPageId)\n\t}, [editor, item])\n\n\treturn (\n\t\t<TldrawUiDropdownMenuRoot id={`page item submenu ${index}`}>\n\t\t\t<TldrawUiDropdownMenuTrigger>\n\t\t\t\t<TldrawUiButton type=\"icon\" title={msg('page-menu.submenu.title')}>\n\t\t\t\t\t<TldrawUiButtonIcon icon=\"dots-vertical\" />\n\t\t\t\t</TldrawUiButton>\n\t\t\t</TldrawUiDropdownMenuTrigger>\n\t\t\t<TldrawUiDropdownMenuContent alignOffset={0} side=\"right\" sideOffset={-4}>\n\t\t\t\t<TldrawUiMenuContextProvider type=\"menu\" sourceId=\"page-menu\">\n\t\t\t\t\t<TldrawUiMenuGroup id=\"modify\">\n\t\t\t\t\t\t{onRename && (\n\t\t\t\t\t\t\t<TldrawUiMenuItem id=\"rename\" label=\"page-menu.submenu.rename\" onSelect={onRename} />\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<TldrawUiMenuItem\n\t\t\t\t\t\t\tid=\"duplicate\"\n\t\t\t\t\t\t\tlabel=\"page-menu.submenu.duplicate-page\"\n\t\t\t\t\t\t\tonSelect={onDuplicate}\n\t\t\t\t\t\t\tdisabled={pages.length >= MAX_PAGES}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{index > 0 && (\n\t\t\t\t\t\t\t<TldrawUiMenuItem\n\t\t\t\t\t\t\t\tid=\"move-up\"\n\t\t\t\t\t\t\t\tonSelect={onMoveUp}\n\t\t\t\t\t\t\t\tlabel=\"page-menu.submenu.move-up\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{index < listSize - 1 && (\n\t\t\t\t\t\t\t<TldrawUiMenuItem\n\t\t\t\t\t\t\t\tid=\"move-down\"\n\t\t\t\t\t\t\t\tlabel=\"page-menu.submenu.move-down\"\n\t\t\t\t\t\t\t\tonSelect={onMoveDown}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t\t\t{listSize > 1 && (\n\t\t\t\t\t\t<TldrawUiMenuGroup id=\"delete\">\n\t\t\t\t\t\t\t<TldrawUiMenuItem id=\"delete\" onSelect={onDelete} label=\"page-menu.submenu.delete\" />\n\t\t\t\t\t\t</TldrawUiMenuGroup>\n\t\t\t\t\t)}\n\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t</TldrawUiDropdownMenuContent>\n\t\t</TldrawUiDropdownMenuRoot>\n\t)\n})\n", "import {\n\tEditor,\n\tgetIndexAbove,\n\tgetIndexBelow,\n\tgetIndexBetween,\n\tIndexKey,\n\tTLPageId,\n} from '@tldraw/editor'\n\nexport const onMovePage = (editor: Editor, id: TLPageId, from: number, to: number) => {\n\tlet index: IndexKey\n\n\tconst pages = editor.getPages()\n\n\tconst below = from > to ? pages[to - 1] : pages[to]\n\tconst above = from > to ? pages[to] : pages[to + 1]\n\n\tif (below && !above) {\n\t\tindex = getIndexAbove(below.index)\n\t} else if (!below && above) {\n\t\tindex = getIndexBelow(pages[0].index)\n\t} else {\n\t\tindex = getIndexBetween(below.index, above.index)\n\t}\n\n\tif (index !== pages[from].index) {\n\t\teditor.mark('moving page')\n\t\teditor.updatePage({\n\t\t\tid: id as TLPageId,\n\t\t\tindex,\n\t\t})\n\t}\n}\n", "import { ReactNode, memo } from 'react'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultQuickActionsContent } from './DefaultQuickActionsContent'\n\n/** @public */\nexport type TLUiQuickActionsProps = {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport const DefaultQuickActions = memo(function DefaultQuickActions({\n\tchildren,\n}: TLUiQuickActionsProps) {\n\tconst content = children ?? <DefaultQuickActionsContent />\n\n\treturn (\n\t\t<TldrawUiMenuContextProvider type=\"small-icons\" sourceId=\"quick-actions\">\n\t\t\t{content}\n\t\t</TldrawUiMenuContextProvider>\n\t)\n})\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport { useActions } from '../../context/actions'\nimport { useCanRedo, useCanUndo, useUnlockedSelectedShapesCount } from '../../hooks/menu-hooks'\nimport { useReadonly } from '../../hooks/useReadonly'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\n/** @public */\nexport function DefaultQuickActionsContent() {\n\tconst actions = useActions()\n\n\tconst editor = useEditor()\n\n\tconst canUndo = useCanUndo()\n\tconst canRedo = useCanRedo()\n\tconst oneSelected = useUnlockedSelectedShapesCount(1)\n\n\tconst isReadonlyMode = useReadonly()\n\n\tconst isInAcceptableReadonlyState = useValue(\n\t\t'should display quick actions',\n\t\t() => editor.isInAny('select', 'hand', 'zoom'),\n\t\t[editor]\n\t)\n\n\tif (isReadonlyMode && !isInAcceptableReadonlyState) return\n\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuItem {...actions['undo']} disabled={!canUndo} />\n\t\t\t<TldrawUiMenuItem {...actions['redo']} disabled={!canRedo} />\n\t\t\t<TldrawUiMenuItem {...actions['delete']} disabled={!oneSelected} />\n\t\t\t<TldrawUiMenuItem {...actions['duplicate']} disabled={!oneSelected} />\n\t\t</>\n\t)\n}\n", "import { useEditor } from '@tldraw/editor'\nimport classNames from 'classnames'\nimport { ReactNode, memo, useCallback } from 'react'\nimport { useRelevantStyles } from '../../hooks/useRelevantStyles'\nimport { DefaultStylePanelContent } from './DefaultStylePanelContent'\n\n/** @public */\nexport interface TLUiStylePanelProps {\n\tisMobile?: boolean\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport const DefaultStylePanel = memo(function DefaultStylePanel({\n\tisMobile,\n\tchildren,\n}: TLUiStylePanelProps) {\n\tconst editor = useEditor()\n\n\tconst styles = useRelevantStyles()\n\n\tconst handlePointerOut = useCallback(() => {\n\t\tif (!isMobile) {\n\t\t\teditor.updateInstanceState({ isChangingStyle: false }, { ephemeral: true })\n\t\t}\n\t}, [editor, isMobile])\n\n\tconst content = children ?? <DefaultStylePanelContent styles={styles} />\n\n\treturn (\n\t\t<div\n\t\t\tclassName={classNames('tlui-style-panel', { 'tlui-style-panel__wrapper': !isMobile })}\n\t\t\tdata-ismobile={isMobile}\n\t\t\tonPointerLeave={handlePointerOut}\n\t\t>\n\t\t\t{content}\n\t\t</div>\n\t)\n})\n", "import {\n\tDefaultColorStyle,\n\tDefaultDashStyle,\n\tDefaultFillStyle,\n\tDefaultSizeStyle,\n\tReadonlySharedStyleMap,\n\tSharedStyleMap,\n\tStyleProp,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\n\nconst selectToolStyles: readonly StyleProp<any>[] = Object.freeze([\n\tDefaultColorStyle,\n\tDefaultDashStyle,\n\tDefaultFillStyle,\n\tDefaultSizeStyle,\n])\n\n/** @public */\nexport function useRelevantStyles(stylesToCheck = selectToolStyles): ReadonlySharedStyleMap | null {\n\tconst editor = useEditor()\n\treturn useValue(\n\t\t'getRelevantStyles',\n\t\t() => {\n\t\t\tconst styles = new SharedStyleMap(editor.getSharedStyles())\n\t\t\tconst isInShapeSpecificTool = !!editor.root.getCurrent()?.shapeType\n\t\t\tconst hasShapesSelected = editor.isIn('select') && editor.getSelectedShapeIds().length > 0\n\n\t\t\tif (styles.size === 0 && editor.isIn('select') && editor.getSelectedShapeIds().length === 0) {\n\t\t\t\tfor (const style of stylesToCheck) {\n\t\t\t\t\tstyles.applyValue(style, editor.getStyleForNextShape(style))\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isInShapeSpecificTool || hasShapesSelected || styles.size > 0) {\n\t\t\t\t// If size is 0 we may still want to return an empty styles map to allow\n\t\t\t\t// the opacity slider to show up.\n\t\t\t\t// This can happen in two situations:\n\t\t\t\t// 1. When the user is in the select tool and has multiple shapes selected but they have no supported styles (beyond opacity).\n\t\t\t\t// 2. When the user is in a shape-specific tool and the shape has no supported styles (beyond opacity obvs).\n\t\t\t\treturn styles\n\t\t\t}\n\n\t\t\treturn null\n\t\t},\n\t\t[editor]\n\t)\n}\n", "import {\n\tArrowShapeArrowheadEndStyle,\n\tArrowShapeArrowheadStartStyle,\n\tDefaultColorStyle,\n\tDefaultDashStyle,\n\tDefaultFillStyle,\n\tDefaultFontStyle,\n\tDefaultHorizontalAlignStyle,\n\tDefaultSizeStyle,\n\tDefaultVerticalAlignStyle,\n\tGeoShapeGeoStyle,\n\tLineShapeSplineStyle,\n\tReadonlySharedStyleMap,\n\tStyleProp,\n\tTLArrowShapeArrowheadStyle,\n\tTLDefaultColorTheme,\n\tgetDefaultColorTheme,\n\tminBy,\n\tuseEditor,\n\tuseIsDarkMode,\n\tuseValue,\n} from '@tldraw/editor'\nimport React from 'react'\nimport { STYLES } from '../../../styles'\nimport { kickoutOccludedShapes } from '../../../tools/SelectTool/selectHelpers'\nimport { useUiEvents } from '../../context/events'\nimport { useRelevantStyles } from '../../hooks/useRelevantStyles'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport { TldrawUiButtonPicker } from '../primitives/TldrawUiButtonPicker'\nimport { TldrawUiSlider } from '../primitives/TldrawUiSlider'\nimport { DoubleDropdownPicker } from './DoubleDropdownPicker'\nimport { DropdownPicker } from './DropdownPicker'\n\n/** @public */\nexport type TLUiStylePanelContentProps = {\n\tstyles: ReturnType<typeof useRelevantStyles>\n}\n\n/** @public */\nexport function DefaultStylePanelContent({ styles }: TLUiStylePanelContentProps) {\n\tconst isDarkMode = useIsDarkMode()\n\n\tif (!styles) return null\n\n\tconst geo = styles.get(GeoShapeGeoStyle)\n\tconst arrowheadEnd = styles.get(ArrowShapeArrowheadEndStyle)\n\tconst arrowheadStart = styles.get(ArrowShapeArrowheadStartStyle)\n\tconst spline = styles.get(LineShapeSplineStyle)\n\tconst font = styles.get(DefaultFontStyle)\n\n\tconst hideGeo = geo === undefined\n\tconst hideArrowHeads = arrowheadEnd === undefined && arrowheadStart === undefined\n\tconst hideSpline = spline === undefined\n\tconst hideText = font === undefined\n\n\tconst theme = getDefaultColorTheme({ isDarkMode: isDarkMode })\n\n\treturn (\n\t\t<>\n\t\t\t<CommonStylePickerSet theme={theme} styles={styles} />\n\t\t\t{!hideText && <TextStylePickerSet theme={theme} styles={styles} />}\n\t\t\t{!(hideGeo && hideArrowHeads && hideSpline) && (\n\t\t\t\t<div className=\"tlui-style-panel__section\" aria-label=\"style panel styles\">\n\t\t\t\t\t<GeoStylePickerSet styles={styles} />\n\t\t\t\t\t<ArrowheadStylePickerSet styles={styles} />\n\t\t\t\t\t<SplineStylePickerSet styles={styles} />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</>\n\t)\n}\n\nfunction useStyleChangeCallback() {\n\tconst editor = useEditor()\n\tconst trackEvent = useUiEvents()\n\n\treturn React.useMemo(\n\t\t() =>\n\t\t\tfunction handleStyleChange<T>(style: StyleProp<T>, value: T, squashing: boolean) {\n\t\t\t\teditor.batch(() => {\n\t\t\t\t\tif (editor.isIn('select')) {\n\t\t\t\t\t\teditor.setStyleForSelectedShapes(style, value, { squashing })\n\t\t\t\t\t}\n\t\t\t\t\teditor.setStyleForNextShapes(style, value, { squashing })\n\t\t\t\t\teditor.updateInstanceState({ isChangingStyle: true }, { ephemeral: true })\n\t\t\t\t})\n\n\t\t\t\ttrackEvent('set-style', { source: 'style-panel', id: style.id, value: value as string })\n\t\t\t},\n\t\t[editor, trackEvent]\n\t)\n}\n\n/** @public */\nexport function CommonStylePickerSet({\n\tstyles,\n\ttheme,\n}: {\n\tstyles: ReadonlySharedStyleMap\n\ttheme: TLDefaultColorTheme\n}) {\n\tconst msg = useTranslation()\n\tconst editor = useEditor()\n\n\tconst handleValueChange = useStyleChangeCallback()\n\n\tconst color = styles.get(DefaultColorStyle)\n\tconst fill = styles.get(DefaultFillStyle)\n\tconst dash = styles.get(DefaultDashStyle)\n\tconst size = styles.get(DefaultSizeStyle)\n\n\tconst showPickers = fill !== undefined || dash !== undefined || size !== undefined\n\n\treturn (\n\t\t<>\n\t\t\t<div\n\t\t\t\ttabIndex={-1}\n\t\t\t\tclassName=\"tlui-style-panel__section__common\"\n\t\t\t\taria-label=\"style panel styles\"\n\t\t\t\tdata-testid=\"style.panel\"\n\t\t\t>\n\t\t\t\t{color === undefined ? null : (\n\t\t\t\t\t<TldrawUiButtonPicker\n\t\t\t\t\t\ttitle={msg('style-panel.color')}\n\t\t\t\t\t\tuiType=\"color\"\n\t\t\t\t\t\tstyle={DefaultColorStyle}\n\t\t\t\t\t\titems={STYLES.color}\n\t\t\t\t\t\tvalue={color}\n\t\t\t\t\t\tonValueChange={handleValueChange}\n\t\t\t\t\t\ttheme={theme}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t<OpacitySlider />\n\t\t\t</div>\n\t\t\t{showPickers && (\n\t\t\t\t<div className=\"tlui-style-panel__section\" aria-label=\"style panel styles\">\n\t\t\t\t\t{fill === undefined ? null : (\n\t\t\t\t\t\t<TldrawUiButtonPicker\n\t\t\t\t\t\t\ttitle={msg('style-panel.fill')}\n\t\t\t\t\t\t\tuiType=\"fill\"\n\t\t\t\t\t\t\tstyle={DefaultFillStyle}\n\t\t\t\t\t\t\titems={STYLES.fill}\n\t\t\t\t\t\t\tvalue={fill}\n\t\t\t\t\t\t\tonValueChange={handleValueChange}\n\t\t\t\t\t\t\ttheme={theme}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\t{dash === undefined ? null : (\n\t\t\t\t\t\t<TldrawUiButtonPicker\n\t\t\t\t\t\t\ttitle={msg('style-panel.dash')}\n\t\t\t\t\t\t\tuiType=\"dash\"\n\t\t\t\t\t\t\tstyle={DefaultDashStyle}\n\t\t\t\t\t\t\titems={STYLES.dash}\n\t\t\t\t\t\t\tvalue={dash}\n\t\t\t\t\t\t\tonValueChange={handleValueChange}\n\t\t\t\t\t\t\ttheme={theme}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\t{size === undefined ? null : (\n\t\t\t\t\t\t<TldrawUiButtonPicker\n\t\t\t\t\t\t\ttitle={msg('style-panel.size')}\n\t\t\t\t\t\t\tuiType=\"size\"\n\t\t\t\t\t\t\tstyle={DefaultSizeStyle}\n\t\t\t\t\t\t\titems={STYLES.size}\n\t\t\t\t\t\t\tvalue={size}\n\t\t\t\t\t\t\tonValueChange={(style, value, squashing) => {\n\t\t\t\t\t\t\t\thandleValueChange(style, value, squashing)\n\t\t\t\t\t\t\t\tconst selectedShapeIds = editor.getSelectedShapeIds()\n\t\t\t\t\t\t\t\tif (selectedShapeIds.length > 0) {\n\t\t\t\t\t\t\t\t\tkickoutOccludedShapes(editor, selectedShapeIds)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ttheme={theme}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</>\n\t)\n}\n\n/** @public */\nexport function TextStylePickerSet({\n\ttheme,\n\tstyles,\n}: {\n\ttheme: TLDefaultColorTheme\n\tstyles: ReadonlySharedStyleMap\n}) {\n\tconst msg = useTranslation()\n\tconst handleValueChange = useStyleChangeCallback()\n\n\tconst font = styles.get(DefaultFontStyle)\n\tconst align = styles.get(DefaultHorizontalAlignStyle)\n\tconst verticalAlign = styles.get(DefaultVerticalAlignStyle)\n\tif (font === undefined && align === undefined) {\n\t\treturn null\n\t}\n\n\treturn (\n\t\t<div className=\"tlui-style-panel__section\" aria-label=\"style panel text\">\n\t\t\t{font === undefined ? null : (\n\t\t\t\t<TldrawUiButtonPicker\n\t\t\t\t\ttitle={msg('style-panel.font')}\n\t\t\t\t\tuiType=\"font\"\n\t\t\t\t\tstyle={DefaultFontStyle}\n\t\t\t\t\titems={STYLES.font}\n\t\t\t\t\tvalue={font}\n\t\t\t\t\tonValueChange={handleValueChange}\n\t\t\t\t\ttheme={theme}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{align === undefined ? null : (\n\t\t\t\t<div className=\"tlui-style-panel__row\">\n\t\t\t\t\t<TldrawUiButtonPicker\n\t\t\t\t\t\ttitle={msg('style-panel.align')}\n\t\t\t\t\t\tuiType=\"align\"\n\t\t\t\t\t\tstyle={DefaultHorizontalAlignStyle}\n\t\t\t\t\t\titems={STYLES.horizontalAlign}\n\t\t\t\t\t\tvalue={align}\n\t\t\t\t\t\tonValueChange={handleValueChange}\n\t\t\t\t\t\ttheme={theme}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"tlui-style-panel__row__extra-button\">\n\t\t\t\t\t\t{verticalAlign === undefined ? (\n\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\ttitle={msg('style-panel.vertical-align')}\n\t\t\t\t\t\t\t\tdata-testid=\"vertical-align\"\n\t\t\t\t\t\t\t\tdisabled\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"vertical-align-center\" />\n\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<DropdownPicker\n\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\tid=\"geo-vertical-alignment\"\n\t\t\t\t\t\t\t\tuiType=\"verticalAlign\"\n\t\t\t\t\t\t\t\tstyle={DefaultVerticalAlignStyle}\n\t\t\t\t\t\t\t\titems={STYLES.verticalAlign}\n\t\t\t\t\t\t\t\tvalue={verticalAlign}\n\t\t\t\t\t\t\t\tonValueChange={handleValueChange}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t)\n}\n/** @public */\nexport function GeoStylePickerSet({ styles }: { styles: ReadonlySharedStyleMap }) {\n\tconst handleValueChange = useStyleChangeCallback()\n\n\tconst geo = styles.get(GeoShapeGeoStyle)\n\tif (geo === undefined) {\n\t\treturn null\n\t}\n\n\treturn (\n\t\t<DropdownPicker\n\t\t\tid=\"geo\"\n\t\t\ttype=\"menu\"\n\t\t\tlabel={'style-panel.geo'}\n\t\t\tuiType=\"geo\"\n\t\t\tstyle={GeoShapeGeoStyle}\n\t\t\titems={STYLES.geo}\n\t\t\tvalue={geo}\n\t\t\tonValueChange={handleValueChange}\n\t\t/>\n\t)\n}\n/** @public */\nexport function SplineStylePickerSet({ styles }: { styles: ReadonlySharedStyleMap }) {\n\tconst handleValueChange = useStyleChangeCallback()\n\n\tconst spline = styles.get(LineShapeSplineStyle)\n\tif (spline === undefined) {\n\t\treturn null\n\t}\n\n\treturn (\n\t\t<DropdownPicker\n\t\t\tid=\"spline\"\n\t\t\ttype=\"menu\"\n\t\t\tlabel={'style-panel.spline'}\n\t\t\tuiType=\"spline\"\n\t\t\tstyle={LineShapeSplineStyle}\n\t\t\titems={STYLES.spline}\n\t\t\tvalue={spline}\n\t\t\tonValueChange={handleValueChange}\n\t\t/>\n\t)\n}\n\n/** @public */\nexport function ArrowheadStylePickerSet({ styles }: { styles: ReadonlySharedStyleMap }) {\n\tconst handleValueChange = useStyleChangeCallback()\n\n\tconst arrowheadEnd = styles.get(ArrowShapeArrowheadEndStyle)\n\tconst arrowheadStart = styles.get(ArrowShapeArrowheadStartStyle)\n\tif (!arrowheadEnd || !arrowheadStart) {\n\t\treturn null\n\t}\n\n\treturn (\n\t\t<DoubleDropdownPicker<TLArrowShapeArrowheadStyle>\n\t\t\tlabel={'style-panel.arrowheads'}\n\t\t\tuiTypeA=\"arrowheadStart\"\n\t\t\tstyleA={ArrowShapeArrowheadStartStyle}\n\t\t\titemsA={STYLES.arrowheadStart}\n\t\t\tvalueA={arrowheadStart}\n\t\t\tuiTypeB=\"arrowheadEnd\"\n\t\t\tstyleB={ArrowShapeArrowheadEndStyle}\n\t\t\titemsB={STYLES.arrowheadEnd}\n\t\t\tvalueB={arrowheadEnd}\n\t\t\tonValueChange={handleValueChange}\n\t\t\tlabelA=\"style-panel.arrowhead-start\"\n\t\t\tlabelB=\"style-panel.arrowhead-end\"\n\t\t/>\n\t)\n}\n\nconst tldrawSupportedOpacities = [0.1, 0.25, 0.5, 0.75, 1] as const\n/** @public */\nexport function OpacitySlider() {\n\tconst editor = useEditor()\n\tconst opacity = useValue('opacity', () => editor.getSharedOpacity(), [editor])\n\tconst trackEvent = useUiEvents()\n\tconst msg = useTranslation()\n\n\tconst handleOpacityValueChange = React.useCallback(\n\t\t(value: number, squashing: boolean) => {\n\t\t\tconst item = tldrawSupportedOpacities[value]\n\t\t\teditor.batch(() => {\n\t\t\t\tif (editor.isIn('select')) {\n\t\t\t\t\teditor.setOpacityForSelectedShapes(item, { squashing })\n\t\t\t\t}\n\t\t\t\teditor.setOpacityForNextShapes(item, { squashing })\n\t\t\t\teditor.updateInstanceState({ isChangingStyle: true }, { ephemeral: true })\n\t\t\t})\n\n\t\t\ttrackEvent('set-style', { source: 'style-panel', id: 'opacity', value })\n\t\t},\n\t\t[editor, trackEvent]\n\t)\n\n\tif (opacity === undefined) return null\n\n\tconst opacityIndex =\n\t\topacity.type === 'mixed'\n\t\t\t? -1\n\t\t\t: tldrawSupportedOpacities.indexOf(\n\t\t\t\t\tminBy(tldrawSupportedOpacities, (supportedOpacity) =>\n\t\t\t\t\t\tMath.abs(supportedOpacity - opacity.value)\n\t\t\t\t\t)!\n\t\t\t\t)\n\n\treturn (\n\t\t<TldrawUiSlider\n\t\t\tdata-testid=\"style.opacity\"\n\t\t\tvalue={opacityIndex >= 0 ? opacityIndex : tldrawSupportedOpacities.length - 1}\n\t\t\tlabel={opacity.type === 'mixed' ? 'style-panel.mixed' : `opacity-style.${opacity.value}`}\n\t\t\tonValueChange={handleOpacityValueChange}\n\t\t\tsteps={tldrawSupportedOpacities.length - 1}\n\t\t\ttitle={msg('style-panel.opacity')}\n\t\t/>\n\t)\n}\n", "export type StyleValuesForUi<T> = readonly {\n\treadonly value: T\n\treadonly icon: string\n}[]\n\n// todo: default styles prop?\nexport const STYLES = {\n\tcolor: [\n\t\t{ value: 'black', icon: 'color' },\n\t\t{ value: 'grey', icon: 'color' },\n\t\t{ value: 'light-violet', icon: 'color' },\n\t\t{ value: 'violet', icon: 'color' },\n\t\t{ value: 'blue', icon: 'color' },\n\t\t{ value: 'light-blue', icon: 'color' },\n\t\t{ value: 'yellow', icon: 'color' },\n\t\t{ value: 'orange', icon: 'color' },\n\t\t{ value: 'green', icon: 'color' },\n\t\t{ value: 'light-green', icon: 'color' },\n\t\t{ value: 'light-red', icon: 'color' },\n\t\t{ value: 'red', icon: 'color' },\n\t],\n\tfill: [\n\t\t{ value: 'none', icon: 'fill-none' },\n\t\t{ value: 'semi', icon: 'fill-semi' },\n\t\t{ value: 'solid', icon: 'fill-solid' },\n\t\t{ value: 'pattern', icon: 'fill-pattern' },\n\t],\n\tdash: [\n\t\t{ value: 'draw', icon: 'dash-draw' },\n\t\t{ value: 'dashed', icon: 'dash-dashed' },\n\t\t{ value: 'dotted', icon: 'dash-dotted' },\n\t\t{ value: 'solid', icon: 'dash-solid' },\n\t],\n\tsize: [\n\t\t{ value: 's', icon: 'size-small' },\n\t\t{ value: 'm', icon: 'size-medium' },\n\t\t{ value: 'l', icon: 'size-large' },\n\t\t{ value: 'xl', icon: 'size-extra-large' },\n\t],\n\tfont: [\n\t\t{ value: 'draw', icon: 'font-draw' },\n\t\t{ value: 'sans', icon: 'font-sans' },\n\t\t{ value: 'serif', icon: 'font-serif' },\n\t\t{ value: 'mono', icon: 'font-mono' },\n\t],\n\thorizontalAlign: [\n\t\t{ value: 'start', icon: 'text-align-left' },\n\t\t{ value: 'middle', icon: 'text-align-center' },\n\t\t{ value: 'end', icon: 'text-align-right' },\n\t],\n\tverticalAlign: [\n\t\t{ value: 'start', icon: 'vertical-align-start' },\n\t\t{ value: 'middle', icon: 'vertical-align-center' },\n\t\t{ value: 'end', icon: 'vertical-align-end' },\n\t],\n\tgeo: [\n\t\t{ value: 'rectangle', icon: 'geo-rectangle' },\n\t\t{ value: 'ellipse', icon: 'geo-ellipse' },\n\t\t{ value: 'cloud', icon: 'geo-cloud' },\n\t\t{ value: 'triangle', icon: 'geo-triangle' },\n\t\t{ value: 'diamond', icon: 'geo-diamond' },\n\t\t{ value: 'pentagon', icon: 'geo-pentagon' },\n\t\t{ value: 'hexagon', icon: 'geo-hexagon' },\n\t\t{ value: 'octagon', icon: 'geo-octagon' },\n\t\t{ value: 'star', icon: 'geo-star' },\n\t\t{ value: 'rhombus', icon: 'geo-rhombus' },\n\t\t{ value: 'rhombus-2', icon: 'geo-rhombus-2' },\n\t\t{ value: 'oval', icon: 'geo-oval' },\n\t\t{ value: 'trapezoid', icon: 'geo-trapezoid' },\n\t\t{ value: 'arrow-right', icon: 'geo-arrow-right' },\n\t\t{ value: 'arrow-left', icon: 'geo-arrow-left' },\n\t\t{ value: 'arrow-up', icon: 'geo-arrow-up' },\n\t\t{ value: 'arrow-down', icon: 'geo-arrow-down' },\n\t\t{ value: 'x-box', icon: 'geo-x-box' },\n\t\t{ value: 'check-box', icon: 'geo-check-box' },\n\t],\n\tarrowheadStart: [\n\t\t{ value: 'none', icon: 'arrowhead-none' },\n\t\t{ value: 'arrow', icon: 'arrowhead-arrow' },\n\t\t{ value: 'triangle', icon: 'arrowhead-triangle' },\n\t\t{ value: 'square', icon: 'arrowhead-square' },\n\t\t{ value: 'dot', icon: 'arrowhead-dot' },\n\t\t{ value: 'diamond', icon: 'arrowhead-diamond' },\n\t\t{ value: 'inverted', icon: 'arrowhead-triangle-inverted' },\n\t\t{ value: 'bar', icon: 'arrowhead-bar' },\n\t],\n\tarrowheadEnd: [\n\t\t{ value: 'none', icon: 'arrowhead-none' },\n\t\t{ value: 'arrow', icon: 'arrowhead-arrow' },\n\t\t{ value: 'triangle', icon: 'arrowhead-triangle' },\n\t\t{ value: 'square', icon: 'arrowhead-square' },\n\t\t{ value: 'dot', icon: 'arrowhead-dot' },\n\t\t{ value: 'diamond', icon: 'arrowhead-diamond' },\n\t\t{ value: 'inverted', icon: 'arrowhead-triangle-inverted' },\n\t\t{ value: 'bar', icon: 'arrowhead-bar' },\n\t],\n\tspline: [\n\t\t{ value: 'line', icon: 'spline-line' },\n\t\t{ value: 'cubic', icon: 'spline-cubic' },\n\t],\n} as const satisfies Record<string, StyleValuesForUi<string>>\n", "import {\n\tDefaultColorStyle,\n\tSharedStyle,\n\tStyleProp,\n\tTLDefaultColorStyle,\n\tTLDefaultColorTheme,\n\tuseEditor,\n} from '@tldraw/editor'\nimport classNames from 'classnames'\nimport { memo, useMemo, useRef } from 'react'\nimport { StyleValuesForUi } from '../../../styles'\nimport { TLUiTranslationKey } from '../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from './Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from './Button/TldrawUiButtonIcon'\n\n/** @public */\nexport interface TLUiButtonPickerProps<T extends string> {\n\ttitle: string\n\tuiType: string\n\tstyle: StyleProp<T>\n\tvalue: SharedStyle<T>\n\titems: StyleValuesForUi<T>\n\ttheme: TLDefaultColorTheme\n\tonValueChange: (style: StyleProp<T>, value: T, squashing: boolean) => void\n}\n\nfunction _TldrawUiButtonPicker<T extends string>(props: TLUiButtonPickerProps<T>) {\n\tconst {\n\t\tuiType,\n\t\titems,\n\t\ttitle,\n\t\tstyle,\n\t\tvalue,\n\t\t// columns = clamp(items.length, 2, 4),\n\t\tonValueChange,\n\t\ttheme,\n\t} = props\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\n\tconst rPointing = useRef(false)\n\n\tconst {\n\t\thandleButtonClick,\n\t\thandleButtonPointerDown,\n\t\thandleButtonPointerEnter,\n\t\thandleButtonPointerUp,\n\t} = useMemo(() => {\n\t\tconst handlePointerUp = () => {\n\t\t\trPointing.current = false\n\t\t\twindow.removeEventListener('pointerup', handlePointerUp)\n\t\t}\n\n\t\tconst handleButtonClick = (e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst { id } = e.currentTarget.dataset\n\t\t\tif (value.type === 'shared' && value.value === id) return\n\n\t\t\teditor.mark('point picker item')\n\t\t\tonValueChange(style, id as T, false)\n\t\t}\n\n\t\tconst handleButtonPointerDown = (e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst { id } = e.currentTarget.dataset\n\n\t\t\teditor.mark('point picker item')\n\t\t\tonValueChange(style, id as T, true)\n\n\t\t\trPointing.current = true\n\t\t\twindow.addEventListener('pointerup', handlePointerUp) // see TLD-658\n\t\t}\n\n\t\tconst handleButtonPointerEnter = (e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tif (!rPointing.current) return\n\n\t\t\tconst { id } = e.currentTarget.dataset\n\t\t\tonValueChange(style, id as T, true)\n\t\t}\n\n\t\tconst handleButtonPointerUp = (e: React.PointerEvent<HTMLButtonElement>) => {\n\t\t\tconst { id } = e.currentTarget.dataset\n\t\t\tif (value.type === 'shared' && value.value === id) return\n\n\t\t\tonValueChange(style, id as T, false)\n\t\t}\n\n\t\treturn {\n\t\t\thandleButtonClick,\n\t\t\thandleButtonPointerDown,\n\t\t\thandleButtonPointerEnter,\n\t\t\thandleButtonPointerUp,\n\t\t}\n\t}, [value, editor, onValueChange, style])\n\n\treturn (\n\t\t<div data-testid={`style.${uiType}`} className={classNames('tlui-buttons__grid')}>\n\t\t\t{items.map((item) => (\n\t\t\t\t<TldrawUiButton\n\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\tkey={item.value}\n\t\t\t\t\tdata-id={item.value}\n\t\t\t\t\tdata-testid={`style.${uiType}.${item.value}`}\n\t\t\t\t\taria-label={item.value}\n\t\t\t\t\tdata-state={value.type === 'shared' && value.value === item.value ? 'hinted' : undefined}\n\t\t\t\t\ttitle={title + ' \u2014 ' + msg(`${uiType}-style.${item.value}` as TLUiTranslationKey)}\n\t\t\t\t\tclassName={classNames('tlui-button-grid__button')}\n\t\t\t\t\tstyle={\n\t\t\t\t\t\tstyle === (DefaultColorStyle as StyleProp<unknown>)\n\t\t\t\t\t\t\t? { color: theme[item.value as TLDefaultColorStyle].solid }\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t\tonPointerEnter={handleButtonPointerEnter}\n\t\t\t\t\tonPointerDown={handleButtonPointerDown}\n\t\t\t\t\tonPointerUp={handleButtonPointerUp}\n\t\t\t\t\tonClick={handleButtonClick}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiButtonIcon icon={item.icon} />\n\t\t\t\t</TldrawUiButton>\n\t\t\t))}\n\t\t</div>\n\t)\n}\n/** @public */\nexport const TldrawUiButtonPicker = memo(_TldrawUiButtonPicker) as typeof _TldrawUiButtonPicker\n", "import { Range, Root, Thumb, Track } from '@radix-ui/react-slider'\nimport { useEditor } from '@tldraw/editor'\nimport { memo, useCallback } from 'react'\nimport { TLUiTranslationKey } from '../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\n\n/** @internal */\nexport interface TLUiSliderProps {\n\tsteps: number\n\tvalue: number | null\n\tlabel: string\n\ttitle: string\n\tonValueChange: (value: number, squashing: boolean) => void\n\t'data-testid'?: string\n}\n\n/** @internal */\nexport const TldrawUiSlider = memo(function Slider(props: TLUiSliderProps) {\n\tconst { title, steps, value, label, onValueChange } = props\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\n\tconst handleValueChange = useCallback(\n\t\t(value: number[]) => {\n\t\t\tonValueChange(value[0], true)\n\t\t},\n\t\t[onValueChange]\n\t)\n\n\tconst handlePointerDown = useCallback(() => {\n\t\teditor.mark('click slider')\n\t}, [editor])\n\n\tconst handlePointerUp = useCallback(() => {\n\t\tif (!value) return\n\t\tonValueChange(value, false)\n\t}, [value, onValueChange])\n\n\treturn (\n\t\t<div className=\"tlui-slider__container\">\n\t\t\t<Root\n\t\t\t\tdata-testid={props['data-testid']}\n\t\t\t\tclassName=\"tlui-slider\"\n\t\t\t\tarea-label=\"Opacity\"\n\t\t\t\tdir=\"ltr\"\n\t\t\t\tmin={0}\n\t\t\t\tmax={steps}\n\t\t\t\tstep={1}\n\t\t\t\tvalue={value ? [value] : undefined}\n\t\t\t\tonPointerDown={handlePointerDown}\n\t\t\t\tonValueChange={handleValueChange}\n\t\t\t\tonPointerUp={handlePointerUp}\n\t\t\t\ttitle={title + ' \u2014 ' + msg(label as TLUiTranslationKey)}\n\t\t\t>\n\t\t\t\t<Track className=\"tlui-slider__track\" dir=\"ltr\">\n\t\t\t\t\t{value !== null && <Range className=\"tlui-slider__range\" dir=\"ltr\" />}\n\t\t\t\t</Track>\n\t\t\t\t{value !== null && <Thumb className=\"tlui-slider__thumb\" dir=\"ltr\" />}\n\t\t\t</Root>\n\t\t</div>\n\t)\n})\n", "export { clamp } from './number';\n", "function clamp(value: number, [min, max]: [number, number]): number {\n  return Math.min(max, Math.max(min, value));\n}\n\nexport { clamp };\n", "export { usePrevious } from './usePrevious';\n", "import * as React from 'react';\n\nfunction usePrevious<T>(value: T) {\n  const ref = React.useRef({ value, previous: value });\n\n  // We compare values before making an update to ensure that\n  // a change has been made. This ensures the previous value is\n  // persisted correctly between renders.\n  return React.useMemo(() => {\n    if (ref.current.value !== value) {\n      ref.current.previous = ref.current.value;\n      ref.current.value = value;\n    }\n    return ref.current.previous;\n  }, [value]);\n}\n\nexport { usePrevious };\n", "export {\n  createSliderScope,\n  //\n  Slider,\n  SliderTrack,\n  SliderRange,\n  SliderThumb,\n  //\n  Root,\n  Track,\n  Range,\n  Thumb,\n} from './Slider';\nexport type { SliderProps, SliderTrackProps, SliderRangeProps, SliderThumbProps } from './Slider';\n", "import * as React from 'react';\nimport { clamp } from '@radix-ui/number';\nimport { composeEventHandlers } from '@radix-ui/primitive';\nimport { useComposedRefs } from '@radix-ui/react-compose-refs';\nimport { createContextScope } from '@radix-ui/react-context';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport { useDirection } from '@radix-ui/react-direction';\nimport { usePrevious } from '@radix-ui/react-use-previous';\nimport { useSize } from '@radix-ui/react-use-size';\nimport { Primitive } from '@radix-ui/react-primitive';\nimport { createCollection } from '@radix-ui/react-collection';\n\nimport type * as Radix from '@radix-ui/react-primitive';\nimport type { Scope } from '@radix-ui/react-context';\n\ntype Direction = 'ltr' | 'rtl';\n\nconst PAGE_KEYS = ['PageUp', 'PageDown'];\nconst ARROW_KEYS = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];\n\ntype SlideDirection = 'from-left' | 'from-right' | 'from-bottom' | 'from-top';\nconst BACK_KEYS: Record<SlideDirection, string[]> = {\n  'from-left': ['Home', 'PageDown', 'ArrowDown', 'ArrowLeft'],\n  'from-right': ['Home', 'PageDown', 'ArrowDown', 'ArrowRight'],\n  'from-bottom': ['Home', 'PageDown', 'ArrowDown', 'ArrowLeft'],\n  'from-top': ['Home', 'PageDown', 'ArrowUp', 'ArrowLeft'],\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Slider\n * -----------------------------------------------------------------------------------------------*/\n\nconst SLIDER_NAME = 'Slider';\n\nconst [Collection, useCollection, createCollectionScope] =\n  createCollection<SliderThumbElement>(SLIDER_NAME);\n\ntype ScopedProps<P> = P & { __scopeSlider?: Scope };\nconst [createSliderContext, createSliderScope] = createContextScope(SLIDER_NAME, [\n  createCollectionScope,\n]);\n\ntype SliderContextValue = {\n  disabled?: boolean;\n  min: number;\n  max: number;\n  values: number[];\n  valueIndexToChangeRef: React.MutableRefObject<number>;\n  thumbs: Set<SliderThumbElement>;\n  orientation: SliderProps['orientation'];\n};\n\nconst [SliderProvider, useSliderContext] = createSliderContext<SliderContextValue>(SLIDER_NAME);\n\ntype SliderElement = SliderHorizontalElement | SliderVerticalElement;\ninterface SliderProps\n  extends Omit<\n    SliderHorizontalProps | SliderVerticalProps,\n    keyof SliderOrientationPrivateProps | 'defaultValue'\n  > {\n  name?: string;\n  disabled?: boolean;\n  orientation?: React.AriaAttributes['aria-orientation'];\n  dir?: Direction;\n  min?: number;\n  max?: number;\n  step?: number;\n  minStepsBetweenThumbs?: number;\n  value?: number[];\n  defaultValue?: number[];\n  onValueChange?(value: number[]): void;\n  onValueCommit?(value: number[]): void;\n  inverted?: boolean;\n}\n\nconst Slider = React.forwardRef<SliderElement, SliderProps>(\n  (props: ScopedProps<SliderProps>, forwardedRef) => {\n    const {\n      name,\n      min = 0,\n      max = 100,\n      step = 1,\n      orientation = 'horizontal',\n      disabled = false,\n      minStepsBetweenThumbs = 0,\n      defaultValue = [min],\n      value,\n      onValueChange = () => {},\n      onValueCommit = () => {},\n      inverted = false,\n      ...sliderProps\n    } = props;\n    const [slider, setSlider] = React.useState<HTMLSpanElement | null>(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setSlider(node));\n    const thumbRefs = React.useRef<SliderContextValue['thumbs']>(new Set());\n    const valueIndexToChangeRef = React.useRef<number>(0);\n    const isHorizontal = orientation === 'horizontal';\n    // We set this to true by default so that events bubble to forms without JS (SSR)\n    const isFormControl = slider ? Boolean(slider.closest('form')) : true;\n    const SliderOrientation = isHorizontal ? SliderHorizontal : SliderVertical;\n\n    const [values = [], setValues] = useControllableState({\n      prop: value,\n      defaultProp: defaultValue,\n      onChange: (value) => {\n        const thumbs = [...thumbRefs.current];\n        thumbs[valueIndexToChangeRef.current]?.focus();\n        onValueChange(value);\n      },\n    });\n    const valuesBeforeSlideStartRef = React.useRef(values);\n\n    function handleSlideStart(value: number) {\n      const closestIndex = getClosestValueIndex(values, value);\n      updateValues(value, closestIndex);\n    }\n\n    function handleSlideMove(value: number) {\n      updateValues(value, valueIndexToChangeRef.current);\n    }\n\n    function handleSlideEnd() {\n      const prevValue = valuesBeforeSlideStartRef.current[valueIndexToChangeRef.current];\n      const nextValue = values[valueIndexToChangeRef.current];\n      const hasChanged = nextValue !== prevValue;\n      if (hasChanged) onValueCommit(values);\n    }\n\n    function updateValues(value: number, atIndex: number, { commit } = { commit: false }) {\n      const decimalCount = getDecimalCount(step);\n      const snapToStep = roundValue(Math.round((value - min) / step) * step + min, decimalCount);\n      const nextValue = clamp(snapToStep, [min, max]);\n\n      setValues((prevValues = []) => {\n        const nextValues = getNextSortedValues(prevValues, nextValue, atIndex);\n        if (hasMinStepsBetweenValues(nextValues, minStepsBetweenThumbs * step)) {\n          valueIndexToChangeRef.current = nextValues.indexOf(nextValue);\n          const hasChanged = String(nextValues) !== String(prevValues);\n          if (hasChanged && commit) onValueCommit(nextValues);\n          return hasChanged ? nextValues : prevValues;\n        } else {\n          return prevValues;\n        }\n      });\n    }\n\n    return (\n      <SliderProvider\n        scope={props.__scopeSlider}\n        disabled={disabled}\n        min={min}\n        max={max}\n        valueIndexToChangeRef={valueIndexToChangeRef}\n        thumbs={thumbRefs.current}\n        values={values}\n        orientation={orientation}\n      >\n        <Collection.Provider scope={props.__scopeSlider}>\n          <Collection.Slot scope={props.__scopeSlider}>\n            <SliderOrientation\n              aria-disabled={disabled}\n              data-disabled={disabled ? '' : undefined}\n              {...sliderProps}\n              ref={composedRefs}\n              onPointerDown={composeEventHandlers(sliderProps.onPointerDown, () => {\n                if (!disabled) valuesBeforeSlideStartRef.current = values;\n              })}\n              min={min}\n              max={max}\n              inverted={inverted}\n              onSlideStart={disabled ? undefined : handleSlideStart}\n              onSlideMove={disabled ? undefined : handleSlideMove}\n              onSlideEnd={disabled ? undefined : handleSlideEnd}\n              onHomeKeyDown={() => !disabled && updateValues(min, 0, { commit: true })}\n              onEndKeyDown={() =>\n                !disabled && updateValues(max, values.length - 1, { commit: true })\n              }\n              onStepKeyDown={({ event, direction: stepDirection }) => {\n                if (!disabled) {\n                  const isPageKey = PAGE_KEYS.includes(event.key);\n                  const isSkipKey = isPageKey || (event.shiftKey && ARROW_KEYS.includes(event.key));\n                  const multiplier = isSkipKey ? 10 : 1;\n                  const atIndex = valueIndexToChangeRef.current;\n                  const value = values[atIndex];\n                  const stepInDirection = step * multiplier * stepDirection;\n                  updateValues(value + stepInDirection, atIndex, { commit: true });\n                }\n              }}\n            />\n          </Collection.Slot>\n        </Collection.Provider>\n        {isFormControl &&\n          values.map((value, index) => (\n            <BubbleInput\n              key={index}\n              name={name ? name + (values.length > 1 ? '[]' : '') : undefined}\n              value={value}\n            />\n          ))}\n      </SliderProvider>\n    );\n  }\n);\n\nSlider.displayName = SLIDER_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SliderHorizontal\n * -----------------------------------------------------------------------------------------------*/\n\ntype Side = 'top' | 'right' | 'bottom' | 'left';\n\nconst [SliderOrientationProvider, useSliderOrientationContext] = createSliderContext<{\n  startEdge: Side;\n  endEdge: Side;\n  size: keyof NonNullable<ReturnType<typeof useSize>>;\n  direction: number;\n}>(SLIDER_NAME, {\n  startEdge: 'left',\n  endEdge: 'right',\n  size: 'width',\n  direction: 1,\n});\n\ntype SliderOrientationPrivateProps = {\n  min: number;\n  max: number;\n  inverted: boolean;\n  onSlideStart?(value: number): void;\n  onSlideMove?(value: number): void;\n  onSlideEnd?(): void;\n  onHomeKeyDown(event: React.KeyboardEvent): void;\n  onEndKeyDown(event: React.KeyboardEvent): void;\n  onStepKeyDown(step: { event: React.KeyboardEvent; direction: number }): void;\n};\ninterface SliderOrientationProps\n  extends Omit<SliderImplProps, keyof SliderImplPrivateProps>,\n    SliderOrientationPrivateProps {}\n\ntype SliderHorizontalElement = SliderImplElement;\ninterface SliderHorizontalProps extends SliderOrientationProps {\n  dir?: Direction;\n}\n\nconst SliderHorizontal = React.forwardRef<SliderHorizontalElement, SliderHorizontalProps>(\n  (props: ScopedProps<SliderHorizontalProps>, forwardedRef) => {\n    const {\n      min,\n      max,\n      dir,\n      inverted,\n      onSlideStart,\n      onSlideMove,\n      onSlideEnd,\n      onStepKeyDown,\n      ...sliderProps\n    } = props;\n    const [slider, setSlider] = React.useState<SliderImplElement | null>(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setSlider(node));\n    const rectRef = React.useRef<ClientRect>();\n    const direction = useDirection(dir);\n    const isDirectionLTR = direction === 'ltr';\n    const isSlidingFromLeft = (isDirectionLTR && !inverted) || (!isDirectionLTR && inverted);\n\n    function getValueFromPointer(pointerPosition: number) {\n      const rect = rectRef.current || slider!.getBoundingClientRect();\n      const input: [number, number] = [0, rect.width];\n      const output: [number, number] = isSlidingFromLeft ? [min, max] : [max, min];\n      const value = linearScale(input, output);\n\n      rectRef.current = rect;\n      return value(pointerPosition - rect.left);\n    }\n\n    return (\n      <SliderOrientationProvider\n        scope={props.__scopeSlider}\n        startEdge={isSlidingFromLeft ? 'left' : 'right'}\n        endEdge={isSlidingFromLeft ? 'right' : 'left'}\n        direction={isSlidingFromLeft ? 1 : -1}\n        size=\"width\"\n      >\n        <SliderImpl\n          dir={direction}\n          data-orientation=\"horizontal\"\n          {...sliderProps}\n          ref={composedRefs}\n          style={{\n            ...sliderProps.style,\n            ['--radix-slider-thumb-transform' as any]: 'translateX(-50%)',\n          }}\n          onSlideStart={(event) => {\n            const value = getValueFromPointer(event.clientX);\n            onSlideStart?.(value);\n          }}\n          onSlideMove={(event) => {\n            const value = getValueFromPointer(event.clientX);\n            onSlideMove?.(value);\n          }}\n          onSlideEnd={() => {\n            rectRef.current = undefined;\n            onSlideEnd?.();\n          }}\n          onStepKeyDown={(event) => {\n            const slideDirection = isSlidingFromLeft ? 'from-left' : 'from-right';\n            const isBackKey = BACK_KEYS[slideDirection].includes(event.key);\n            onStepKeyDown?.({ event, direction: isBackKey ? -1 : 1 });\n          }}\n        />\n      </SliderOrientationProvider>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * SliderVertical\n * -----------------------------------------------------------------------------------------------*/\n\ntype SliderVerticalElement = SliderImplElement;\ninterface SliderVerticalProps extends SliderOrientationProps {}\n\nconst SliderVertical = React.forwardRef<SliderVerticalElement, SliderVerticalProps>(\n  (props: ScopedProps<SliderVerticalProps>, forwardedRef) => {\n    const {\n      min,\n      max,\n      inverted,\n      onSlideStart,\n      onSlideMove,\n      onSlideEnd,\n      onStepKeyDown,\n      ...sliderProps\n    } = props;\n    const sliderRef = React.useRef<SliderImplElement>(null);\n    const ref = useComposedRefs(forwardedRef, sliderRef);\n    const rectRef = React.useRef<ClientRect>();\n    const isSlidingFromBottom = !inverted;\n\n    function getValueFromPointer(pointerPosition: number) {\n      const rect = rectRef.current || sliderRef.current!.getBoundingClientRect();\n      const input: [number, number] = [0, rect.height];\n      const output: [number, number] = isSlidingFromBottom ? [max, min] : [min, max];\n      const value = linearScale(input, output);\n\n      rectRef.current = rect;\n      return value(pointerPosition - rect.top);\n    }\n\n    return (\n      <SliderOrientationProvider\n        scope={props.__scopeSlider}\n        startEdge={isSlidingFromBottom ? 'bottom' : 'top'}\n        endEdge={isSlidingFromBottom ? 'top' : 'bottom'}\n        size=\"height\"\n        direction={isSlidingFromBottom ? 1 : -1}\n      >\n        <SliderImpl\n          data-orientation=\"vertical\"\n          {...sliderProps}\n          ref={ref}\n          style={{\n            ...sliderProps.style,\n            ['--radix-slider-thumb-transform' as any]: 'translateY(50%)',\n          }}\n          onSlideStart={(event) => {\n            const value = getValueFromPointer(event.clientY);\n            onSlideStart?.(value);\n          }}\n          onSlideMove={(event) => {\n            const value = getValueFromPointer(event.clientY);\n            onSlideMove?.(value);\n          }}\n          onSlideEnd={() => {\n            rectRef.current = undefined;\n            onSlideEnd?.();\n          }}\n          onStepKeyDown={(event) => {\n            const slideDirection = isSlidingFromBottom ? 'from-bottom' : 'from-top';\n            const isBackKey = BACK_KEYS[slideDirection].includes(event.key);\n            onStepKeyDown?.({ event, direction: isBackKey ? -1 : 1 });\n          }}\n        />\n      </SliderOrientationProvider>\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * SliderImpl\n * -----------------------------------------------------------------------------------------------*/\n\ntype SliderImplElement = React.ElementRef<typeof Primitive.span>;\ntype PrimitiveDivProps = Radix.ComponentPropsWithoutRef<typeof Primitive.div>;\ntype SliderImplPrivateProps = {\n  onSlideStart(event: React.PointerEvent): void;\n  onSlideMove(event: React.PointerEvent): void;\n  onSlideEnd(event: React.PointerEvent): void;\n  onHomeKeyDown(event: React.KeyboardEvent): void;\n  onEndKeyDown(event: React.KeyboardEvent): void;\n  onStepKeyDown(event: React.KeyboardEvent): void;\n};\ninterface SliderImplProps extends PrimitiveDivProps, SliderImplPrivateProps {}\n\nconst SliderImpl = React.forwardRef<SliderImplElement, SliderImplProps>(\n  (props: ScopedProps<SliderImplProps>, forwardedRef) => {\n    const {\n      __scopeSlider,\n      onSlideStart,\n      onSlideMove,\n      onSlideEnd,\n      onHomeKeyDown,\n      onEndKeyDown,\n      onStepKeyDown,\n      ...sliderProps\n    } = props;\n    const context = useSliderContext(SLIDER_NAME, __scopeSlider);\n\n    return (\n      <Primitive.span\n        {...sliderProps}\n        ref={forwardedRef}\n        onKeyDown={composeEventHandlers(props.onKeyDown, (event) => {\n          if (event.key === 'Home') {\n            onHomeKeyDown(event);\n            // Prevent scrolling to page start\n            event.preventDefault();\n          } else if (event.key === 'End') {\n            onEndKeyDown(event);\n            // Prevent scrolling to page end\n            event.preventDefault();\n          } else if (PAGE_KEYS.concat(ARROW_KEYS).includes(event.key)) {\n            onStepKeyDown(event);\n            // Prevent scrolling for directional key presses\n            event.preventDefault();\n          }\n        })}\n        onPointerDown={composeEventHandlers(props.onPointerDown, (event) => {\n          const target = event.target as HTMLElement;\n          target.setPointerCapture(event.pointerId);\n          // Prevent browser focus behaviour because we focus a thumb manually when values change.\n          event.preventDefault();\n          // Touch devices have a delay before focusing so won't focus if touch immediately moves\n          // away from target (sliding). We want thumb to focus regardless.\n          if (context.thumbs.has(target)) {\n            target.focus();\n          } else {\n            onSlideStart(event);\n          }\n        })}\n        onPointerMove={composeEventHandlers(props.onPointerMove, (event) => {\n          const target = event.target as HTMLElement;\n          if (target.hasPointerCapture(event.pointerId)) onSlideMove(event);\n        })}\n        onPointerUp={composeEventHandlers(props.onPointerUp, (event) => {\n          const target = event.target as HTMLElement;\n          if (target.hasPointerCapture(event.pointerId)) {\n            target.releasePointerCapture(event.pointerId);\n            onSlideEnd(event);\n          }\n        })}\n      />\n    );\n  }\n);\n\n/* -------------------------------------------------------------------------------------------------\n * SliderTrack\n * -----------------------------------------------------------------------------------------------*/\n\nconst TRACK_NAME = 'SliderTrack';\n\ntype SliderTrackElement = React.ElementRef<typeof Primitive.span>;\ntype PrimitiveSpanProps = Radix.ComponentPropsWithoutRef<typeof Primitive.span>;\ninterface SliderTrackProps extends PrimitiveSpanProps {}\n\nconst SliderTrack = React.forwardRef<SliderTrackElement, SliderTrackProps>(\n  (props: ScopedProps<SliderTrackProps>, forwardedRef) => {\n    const { __scopeSlider, ...trackProps } = props;\n    const context = useSliderContext(TRACK_NAME, __scopeSlider);\n    return (\n      <Primitive.span\n        data-disabled={context.disabled ? '' : undefined}\n        data-orientation={context.orientation}\n        {...trackProps}\n        ref={forwardedRef}\n      />\n    );\n  }\n);\n\nSliderTrack.displayName = TRACK_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SliderRange\n * -----------------------------------------------------------------------------------------------*/\n\nconst RANGE_NAME = 'SliderRange';\n\ntype SliderRangeElement = React.ElementRef<typeof Primitive.span>;\ninterface SliderRangeProps extends PrimitiveSpanProps {}\n\nconst SliderRange = React.forwardRef<SliderRangeElement, SliderRangeProps>(\n  (props: ScopedProps<SliderRangeProps>, forwardedRef) => {\n    const { __scopeSlider, ...rangeProps } = props;\n    const context = useSliderContext(RANGE_NAME, __scopeSlider);\n    const orientation = useSliderOrientationContext(RANGE_NAME, __scopeSlider);\n    const ref = React.useRef<HTMLSpanElement>(null);\n    const composedRefs = useComposedRefs(forwardedRef, ref);\n    const valuesCount = context.values.length;\n    const percentages = context.values.map((value) =>\n      convertValueToPercentage(value, context.min, context.max)\n    );\n    const offsetStart = valuesCount > 1 ? Math.min(...percentages) : 0;\n    const offsetEnd = 100 - Math.max(...percentages);\n\n    return (\n      <Primitive.span\n        data-orientation={context.orientation}\n        data-disabled={context.disabled ? '' : undefined}\n        {...rangeProps}\n        ref={composedRefs}\n        style={{\n          ...props.style,\n          [orientation.startEdge]: offsetStart + '%',\n          [orientation.endEdge]: offsetEnd + '%',\n        }}\n      />\n    );\n  }\n);\n\nSliderRange.displayName = RANGE_NAME;\n\n/* -------------------------------------------------------------------------------------------------\n * SliderThumb\n * -----------------------------------------------------------------------------------------------*/\n\nconst THUMB_NAME = 'SliderThumb';\n\ntype SliderThumbElement = SliderThumbImplElement;\ninterface SliderThumbProps extends Omit<SliderThumbImplProps, 'index'> {}\n\nconst SliderThumb = React.forwardRef<SliderThumbElement, SliderThumbProps>(\n  (props: ScopedProps<SliderThumbProps>, forwardedRef) => {\n    const getItems = useCollection(props.__scopeSlider);\n    const [thumb, setThumb] = React.useState<SliderThumbImplElement | null>(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setThumb(node));\n    const index = React.useMemo(\n      () => (thumb ? getItems().findIndex((item) => item.ref.current === thumb) : -1),\n      [getItems, thumb]\n    );\n    return <SliderThumbImpl {...props} ref={composedRefs} index={index} />;\n  }\n);\n\ntype SliderThumbImplElement = React.ElementRef<typeof Primitive.span>;\ninterface SliderThumbImplProps extends PrimitiveSpanProps {\n  index: number;\n}\n\nconst SliderThumbImpl = React.forwardRef<SliderThumbImplElement, SliderThumbImplProps>(\n  (props: ScopedProps<SliderThumbImplProps>, forwardedRef) => {\n    const { __scopeSlider, index, ...thumbProps } = props;\n    const context = useSliderContext(THUMB_NAME, __scopeSlider);\n    const orientation = useSliderOrientationContext(THUMB_NAME, __scopeSlider);\n    const [thumb, setThumb] = React.useState<HTMLSpanElement | null>(null);\n    const composedRefs = useComposedRefs(forwardedRef, (node) => setThumb(node));\n    const size = useSize(thumb);\n    // We cast because index could be `-1` which would return undefined\n    const value = context.values[index] as number | undefined;\n    const percent =\n      value === undefined ? 0 : convertValueToPercentage(value, context.min, context.max);\n    const label = getLabel(index, context.values.length);\n    const orientationSize = size?.[orientation.size];\n    const thumbInBoundsOffset = orientationSize\n      ? getThumbInBoundsOffset(orientationSize, percent, orientation.direction)\n      : 0;\n\n    React.useEffect(() => {\n      if (thumb) {\n        context.thumbs.add(thumb);\n        return () => {\n          context.thumbs.delete(thumb);\n        };\n      }\n    }, [thumb, context.thumbs]);\n\n    return (\n      <span\n        style={{\n          transform: 'var(--radix-slider-thumb-transform)',\n          position: 'absolute',\n          [orientation.startEdge]: `calc(${percent}% + ${thumbInBoundsOffset}px)`,\n        }}\n      >\n        <Collection.ItemSlot scope={props.__scopeSlider}>\n          <Primitive.span\n            role=\"slider\"\n            aria-label={props['aria-label'] || label}\n            aria-valuemin={context.min}\n            aria-valuenow={value}\n            aria-valuemax={context.max}\n            aria-orientation={context.orientation}\n            data-orientation={context.orientation}\n            data-disabled={context.disabled ? '' : undefined}\n            tabIndex={context.disabled ? undefined : 0}\n            {...thumbProps}\n            ref={composedRefs}\n            /**\n             * There will be no value on initial render while we work out the index so we hide thumbs\n             * without a value, otherwise SSR will render them in the wrong position before they\n             * snap into the correct position during hydration which would be visually jarring for\n             * slower connections.\n             */\n            style={value === undefined ? { display: 'none' } : props.style}\n            onFocus={composeEventHandlers(props.onFocus, () => {\n              context.valueIndexToChangeRef.current = index;\n            })}\n          />\n        </Collection.ItemSlot>\n      </span>\n    );\n  }\n);\n\nSliderThumb.displayName = THUMB_NAME;\n\n/* -----------------------------------------------------------------------------------------------*/\n\nconst BubbleInput = (props: Radix.ComponentPropsWithoutRef<'input'>) => {\n  const { value, ...inputProps } = props;\n  const ref = React.useRef<HTMLInputElement>(null);\n  const prevValue = usePrevious(value);\n\n  // Bubble value change to parents (e.g form change event)\n  React.useEffect(() => {\n    const input = ref.current!;\n    const inputProto = window.HTMLInputElement.prototype;\n    const descriptor = Object.getOwnPropertyDescriptor(inputProto, 'value') as PropertyDescriptor;\n    const setValue = descriptor.set;\n    if (prevValue !== value && setValue) {\n      const event = new Event('input', { bubbles: true });\n      setValue.call(input, value);\n      input.dispatchEvent(event);\n    }\n  }, [prevValue, value]);\n\n  /**\n   * We purposefully do not use `type=\"hidden\"` here otherwise forms that\n   * wrap it will not be able to access its value via the FormData API.\n   *\n   * We purposefully do not add the `value` attribute here to allow the value\n   * to be set programatically and bubble to any parent form `onChange` event.\n   * Adding the `value` will cause React to consider the programatic\n   * dispatch a duplicate and it will get swallowed.\n   */\n  return <input style={{ display: 'none' }} {...inputProps} ref={ref} defaultValue={value} />;\n};\n\nfunction getNextSortedValues(prevValues: number[] = [], nextValue: number, atIndex: number) {\n  const nextValues = [...prevValues];\n  nextValues[atIndex] = nextValue;\n  return nextValues.sort((a, b) => a - b);\n}\n\nfunction convertValueToPercentage(value: number, min: number, max: number) {\n  const maxSteps = max - min;\n  const percentPerStep = 100 / maxSteps;\n  const percentage = percentPerStep * (value - min);\n  return clamp(percentage, [0, 100]);\n}\n\n/**\n * Returns a label for each thumb when there are two or more thumbs\n */\nfunction getLabel(index: number, totalValues: number) {\n  if (totalValues > 2) {\n    return `Value ${index + 1} of ${totalValues}`;\n  } else if (totalValues === 2) {\n    return ['Minimum', 'Maximum'][index];\n  } else {\n    return undefined;\n  }\n}\n\n/**\n * Given a `values` array and a `nextValue`, determine which value in\n * the array is closest to `nextValue` and return its index.\n *\n * @example\n * // returns 1\n * getClosestValueIndex([10, 30], 25);\n */\nfunction getClosestValueIndex(values: number[], nextValue: number) {\n  if (values.length === 1) return 0;\n  const distances = values.map((value) => Math.abs(value - nextValue));\n  const closestDistance = Math.min(...distances);\n  return distances.indexOf(closestDistance);\n}\n\n/**\n * Offsets the thumb centre point while sliding to ensure it remains\n * within the bounds of the slider when reaching the edges\n */\nfunction getThumbInBoundsOffset(width: number, left: number, direction: number) {\n  const halfWidth = width / 2;\n  const halfPercent = 50;\n  const offset = linearScale([0, halfPercent], [0, halfWidth]);\n  return (halfWidth - offset(left) * direction) * direction;\n}\n\n/**\n * Gets an array of steps between each value.\n *\n * @example\n * // returns [1, 9]\n * getStepsBetweenValues([10, 11, 20]);\n */\nfunction getStepsBetweenValues(values: number[]) {\n  return values.slice(0, -1).map((value, index) => values[index + 1] - value);\n}\n\n/**\n * Verifies the minimum steps between all values is greater than or equal\n * to the expected minimum steps.\n *\n * @example\n * // returns false\n * hasMinStepsBetweenValues([1,2,3], 2);\n *\n * @example\n * // returns true\n * hasMinStepsBetweenValues([1,2,3], 1);\n */\nfunction hasMinStepsBetweenValues(values: number[], minStepsBetweenValues: number) {\n  if (minStepsBetweenValues > 0) {\n    const stepsBetweenValues = getStepsBetweenValues(values);\n    const actualMinStepsBetweenValues = Math.min(...stepsBetweenValues);\n    return actualMinStepsBetweenValues >= minStepsBetweenValues;\n  }\n  return true;\n}\n\n// https://github.com/tmcw-up-for-adoption/simple-linear-scale/blob/master/index.js\nfunction linearScale(input: readonly [number, number], output: readonly [number, number]) {\n  return (value: number) => {\n    if (input[0] === input[1] || output[0] === output[1]) return output[0];\n    const ratio = (output[1] - output[0]) / (input[1] - input[0]);\n    return output[0] + ratio * (value - input[0]);\n  };\n}\n\nfunction getDecimalCount(value: number) {\n  return (String(value).split('.')[1] || '').length;\n}\n\nfunction roundValue(value: number, decimalCount: number) {\n  const rounder = Math.pow(10, decimalCount);\n  return Math.round(value * rounder) / rounder;\n}\n\nconst Root = Slider;\nconst Track = SliderTrack;\nconst Range = SliderRange;\nconst Thumb = SliderThumb;\n\nexport {\n  createSliderScope,\n  //\n  Slider,\n  SliderTrack,\n  SliderRange,\n  SliderThumb,\n  //\n  Root,\n  Track,\n  Range,\n  Thumb,\n};\nexport type { SliderProps, SliderTrackProps, SliderRangeProps, SliderThumbProps };\n", "import { SharedStyle, StyleProp } from '@tldraw/editor'\nimport * as React from 'react'\nimport { StyleValuesForUi } from '../../../styles'\nimport { TLUiTranslationKey } from '../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport {\n\tTldrawUiDropdownMenuContent,\n\tTldrawUiDropdownMenuItem,\n\tTldrawUiDropdownMenuRoot,\n\tTldrawUiDropdownMenuTrigger,\n} from '../primitives/TldrawUiDropdownMenu'\n\ninterface DoubleDropdownPickerProps<T extends string> {\n\tuiTypeA: string\n\tuiTypeB: string\n\tlabel: TLUiTranslationKey | Exclude<string, TLUiTranslationKey>\n\tlabelA: TLUiTranslationKey | Exclude<string, TLUiTranslationKey>\n\tlabelB: TLUiTranslationKey | Exclude<string, TLUiTranslationKey>\n\titemsA: StyleValuesForUi<T>\n\titemsB: StyleValuesForUi<T>\n\tstyleA: StyleProp<T>\n\tstyleB: StyleProp<T>\n\tvalueA: SharedStyle<T>\n\tvalueB: SharedStyle<T>\n\tonValueChange: (style: StyleProp<T>, value: T, squashing: boolean) => void\n}\n\nfunction _DoubleDropdownPicker<T extends string>({\n\tlabel,\n\tuiTypeA,\n\tuiTypeB,\n\tlabelA,\n\tlabelB,\n\titemsA,\n\titemsB,\n\tstyleA,\n\tstyleB,\n\tvalueA,\n\tvalueB,\n\tonValueChange,\n}: DoubleDropdownPickerProps<T>) {\n\tconst msg = useTranslation()\n\n\tconst iconA = React.useMemo(\n\t\t() =>\n\t\t\titemsA.find((item) => valueA.type === 'shared' && valueA.value === item.value)?.icon ??\n\t\t\t'mixed',\n\t\t[itemsA, valueA]\n\t)\n\tconst iconB = React.useMemo(\n\t\t() =>\n\t\t\titemsB.find((item) => valueB.type === 'shared' && valueB.value === item.value)?.icon ??\n\t\t\t'mixed',\n\t\t[itemsB, valueB]\n\t)\n\n\tif (valueA === undefined && valueB === undefined) return null\n\n\treturn (\n\t\t<div className=\"tlui-style-panel__double-select-picker\">\n\t\t\t<div title={msg(label)} className=\"tlui-style-panel__double-select-picker-label\">\n\t\t\t\t{msg(label)}\n\t\t\t</div>\n\t\t\t<div className=\"tlui-buttons__horizontal\">\n\t\t\t\t<TldrawUiDropdownMenuRoot id={`style panel ${uiTypeA} A`}>\n\t\t\t\t\t<TldrawUiDropdownMenuTrigger>\n\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\tdata-testid={`style.${uiTypeA}`}\n\t\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\t\tmsg(labelA) +\n\t\t\t\t\t\t\t\t' \u2014 ' +\n\t\t\t\t\t\t\t\t(valueA === null || valueA.type === 'mixed'\n\t\t\t\t\t\t\t\t\t? msg('style-panel.mixed')\n\t\t\t\t\t\t\t\t\t: msg(`${uiTypeA}-style.${valueA.value}` as TLUiTranslationKey))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TldrawUiButtonIcon icon={iconA} small invertIcon />\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t</TldrawUiDropdownMenuTrigger>\n\t\t\t\t\t<TldrawUiDropdownMenuContent side=\"bottom\" align=\"end\" sideOffset={0} alignOffset={-2}>\n\t\t\t\t\t\t<div className=\"tlui-buttons__grid\">\n\t\t\t\t\t\t\t{itemsA.map((item, i) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<TldrawUiDropdownMenuItem key={i} data-testid={`style.${uiTypeA}.${item.value}`}>\n\t\t\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\tkey={item.value}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => onValueChange(styleA, item.value, false)}\n\t\t\t\t\t\t\t\t\t\t\ttitle={`${msg(labelA)} \u2014 ${msg(`${uiTypeA}-style.${item.value}`)}`}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon={item.icon} invertIcon />\n\t\t\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t\t\t</TldrawUiDropdownMenuItem>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</TldrawUiDropdownMenuContent>\n\t\t\t\t</TldrawUiDropdownMenuRoot>\n\t\t\t\t<TldrawUiDropdownMenuRoot id={`style panel ${uiTypeB}`}>\n\t\t\t\t\t<TldrawUiDropdownMenuTrigger>\n\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\tdata-testid={`style.${uiTypeB}`}\n\t\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\t\tmsg(labelB) +\n\t\t\t\t\t\t\t\t' \u2014 ' +\n\t\t\t\t\t\t\t\t(valueB === null || valueB.type === 'mixed'\n\t\t\t\t\t\t\t\t\t? msg('style-panel.mixed')\n\t\t\t\t\t\t\t\t\t: msg(`${uiTypeB}-style.${valueB.value}` as TLUiTranslationKey))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TldrawUiButtonIcon icon={iconB} small />\n\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t</TldrawUiDropdownMenuTrigger>\n\t\t\t\t\t<TldrawUiDropdownMenuContent side=\"bottom\" align=\"end\" sideOffset={0} alignOffset={-2}>\n\t\t\t\t\t\t<div className=\"tlui-buttons__grid\">\n\t\t\t\t\t\t\t{itemsB.map((item) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<TldrawUiDropdownMenuItem key={item.value}>\n\t\t\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\ttitle={`${msg(labelB)} \u2014 ${msg(`${uiTypeB}-style.${item.value}` as TLUiTranslationKey)}`}\n\t\t\t\t\t\t\t\t\t\t\tdata-testid={`style.${uiTypeB}.${item.value}`}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => onValueChange(styleB, item.value, false)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon={item.icon} />\n\t\t\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t\t\t</TldrawUiDropdownMenuItem>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</TldrawUiDropdownMenuContent>\n\t\t\t\t</TldrawUiDropdownMenuRoot>\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n\n// need to memo like this to get generics\nexport const DoubleDropdownPicker = React.memo(\n\t_DoubleDropdownPicker\n) as typeof _DoubleDropdownPicker\n", "import { SharedStyle, StyleProp, useEditor } from '@tldraw/editor'\nimport * as React from 'react'\nimport { StyleValuesForUi } from '../../../styles'\nimport { TLUiTranslationKey } from '../../hooks/useTranslation/TLUiTranslationKey'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TLUiIconType } from '../../icon-types'\nimport { TLUiButtonProps, TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport { TldrawUiButtonLabel } from '../primitives/Button/TldrawUiButtonLabel'\nimport {\n\tTldrawUiDropdownMenuContent,\n\tTldrawUiDropdownMenuItem,\n\tTldrawUiDropdownMenuRoot,\n\tTldrawUiDropdownMenuTrigger,\n} from '../primitives/TldrawUiDropdownMenu'\n\ninterface DropdownPickerProps<T extends string> {\n\tid: string\n\tlabel?: TLUiTranslationKey | Exclude<string, TLUiTranslationKey>\n\tuiType: string\n\tstyle: StyleProp<T>\n\tvalue: SharedStyle<T>\n\titems: StyleValuesForUi<T>\n\ttype: TLUiButtonProps['type']\n\tonValueChange: (style: StyleProp<T>, value: T, squashing: boolean) => void\n}\n\nfunction _DropdownPicker<T extends string>({\n\tid,\n\tlabel,\n\tuiType,\n\tstyle,\n\titems,\n\ttype,\n\tvalue,\n\tonValueChange,\n}: DropdownPickerProps<T>) {\n\tconst msg = useTranslation()\n\tconst editor = useEditor()\n\n\tconst icon = React.useMemo(\n\t\t() => items.find((item) => value.type === 'shared' && item.value === value.value)?.icon,\n\t\t[items, value]\n\t)\n\n\tconst titleStr =\n\t\tvalue.type === 'mixed'\n\t\t\t? msg('style-panel.mixed')\n\t\t\t: msg(`${uiType}-style.${value.value}` as TLUiTranslationKey)\n\tconst labelStr = label ? msg(label) : ''\n\n\treturn (\n\t\t<TldrawUiDropdownMenuRoot id={`style panel ${id}`}>\n\t\t\t<TldrawUiDropdownMenuTrigger>\n\t\t\t\t<TldrawUiButton type={type} data-testid={`style.${uiType}`} title={titleStr}>\n\t\t\t\t\t<TldrawUiButtonLabel>{labelStr}</TldrawUiButtonLabel>\n\t\t\t\t\t<TldrawUiButtonIcon icon={(icon as TLUiIconType) ?? 'mixed'} />\n\t\t\t\t</TldrawUiButton>\n\t\t\t</TldrawUiDropdownMenuTrigger>\n\t\t\t<TldrawUiDropdownMenuContent side=\"left\" align=\"center\" alignOffset={0}>\n\t\t\t\t<div className=\"tlui-buttons__grid\">\n\t\t\t\t\t{items.map((item) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<TldrawUiDropdownMenuItem key={item.value}>\n\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\ttype=\"icon\"\n\t\t\t\t\t\t\t\t\tdata-testid={`style.${uiType}.${item.value}`}\n\t\t\t\t\t\t\t\t\ttitle={msg(`${uiType}-style.${item.value}` as TLUiTranslationKey)}\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\teditor.mark('select style dropdown item')\n\t\t\t\t\t\t\t\t\t\tonValueChange(style, item.value, false)\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon={item.icon} />\n\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t</TldrawUiDropdownMenuItem>\n\t\t\t\t\t\t)\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t</TldrawUiDropdownMenuContent>\n\t\t</TldrawUiDropdownMenuRoot>\n\t)\n}\n\n// need to export like this to get generics\nexport const DropdownPicker = React.memo(_DropdownPicker) as typeof _DropdownPicker\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport { ReactNode, memo } from 'react'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { useTldrawUiComponents } from '../../context/components'\nimport { useReadonly } from '../../hooks/useReadonly'\nimport { MobileStylePanel } from '../MobileStylePanel'\nimport { DefaultToolbarContent } from './DefaultToolbarContent'\nimport { OverflowingToolbar } from './OverflowingToolbar'\nimport { ToggleToolLockedButton } from './ToggleToolLockedButton'\n\n/** @public */\nexport interface DefaultToolbarProps {\n\tchildren?: ReactNode\n}\n\n/**\n * The default toolbar for the editor. `children` defaults to the `DefaultToolbarContent` component.\n * Depending on the screen size, the children will overflow into a drop-down menu, with the most\n * recently active item from the overflow being shown in the main toolbar.\n *\n * @public\n */\nexport const DefaultToolbar = memo(function DefaultToolbar({ children }: { children?: ReactNode }) {\n\tconst editor = useEditor()\n\tconst breakpoint = useBreakpoint()\n\tconst isReadonlyMode = useReadonly()\n\tconst activeToolId = useValue('current tool id', () => editor.getCurrentToolId(), [editor])\n\n\tconst { ActionsMenu, QuickActions } = useTldrawUiComponents()\n\n\treturn (\n\t\t<div className=\"tlui-toolbar\">\n\t\t\t<div className=\"tlui-toolbar__inner\">\n\t\t\t\t<div className=\"tlui-toolbar__left\">\n\t\t\t\t\t{!isReadonlyMode && (\n\t\t\t\t\t\t<div className=\"tlui-toolbar__extras\">\n\t\t\t\t\t\t\t{breakpoint < PORTRAIT_BREAKPOINT.TABLET && (\n\t\t\t\t\t\t\t\t<div className=\"tlui-toolbar__extras__controls tlui-buttons__horizontal\">\n\t\t\t\t\t\t\t\t\t{QuickActions && <QuickActions />}\n\t\t\t\t\t\t\t\t\t{ActionsMenu && <ActionsMenu />}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<ToggleToolLockedButton activeToolId={activeToolId} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<OverflowingToolbar>{children ?? <DefaultToolbarContent />}</OverflowingToolbar>\n\t\t\t\t</div>\n\t\t\t\t{breakpoint < PORTRAIT_BREAKPOINT.TABLET_SM && !isReadonlyMode && (\n\t\t\t\t\t<div className=\"tlui-toolbar__tools\">\n\t\t\t\t\t\t<MobileStylePanel />\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t)\n})\n", "import {\n\tDefaultColorStyle,\n\tTLDefaultColorStyle,\n\tgetDefaultColorTheme,\n\tuseEditor,\n\tuseValue,\n} from '@tldraw/editor'\nimport { useCallback } from 'react'\nimport { useTldrawUiComponents } from '../context/components'\nimport { useRelevantStyles } from '../hooks/useRelevantStyles'\nimport { useTranslation } from '../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from './primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from './primitives/Button/TldrawUiButtonIcon'\nimport {\n\tTldrawUiPopover,\n\tTldrawUiPopoverContent,\n\tTldrawUiPopoverTrigger,\n} from './primitives/TldrawUiPopover'\n\nexport function MobileStylePanel() {\n\tconst editor = useEditor()\n\tconst msg = useTranslation()\n\n\tconst relevantStyles = useRelevantStyles()\n\tconst color = relevantStyles?.get(DefaultColorStyle)\n\tconst theme = getDefaultColorTheme({ isDarkMode: editor.user.getIsDarkMode() })\n\tconst currentColor = (\n\t\tcolor?.type === 'shared' ? theme[color.value as TLDefaultColorStyle] : theme.black\n\t).solid\n\n\tconst disableStylePanel = useValue(\n\t\t'disable style panel',\n\t\t() => editor.isInAny('hand', 'zoom', 'eraser', 'laser'),\n\t\t[editor]\n\t)\n\n\tconst handleStylesOpenChange = useCallback(\n\t\t(isOpen: boolean) => {\n\t\t\tif (!isOpen) {\n\t\t\t\teditor.updateInstanceState({ isChangingStyle: false }, { ephemeral: true })\n\t\t\t}\n\t\t},\n\t\t[editor]\n\t)\n\n\tconst { StylePanel } = useTldrawUiComponents()\n\tif (!StylePanel) return null\n\n\treturn (\n\t\t<TldrawUiPopover id=\"mobile style menu\" onOpenChange={handleStylesOpenChange}>\n\t\t\t<TldrawUiPopoverTrigger>\n\t\t\t\t<TldrawUiButton\n\t\t\t\t\ttype=\"tool\"\n\t\t\t\t\tdata-testid=\"mobile-styles.button\"\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tcolor: disableStylePanel ? 'var(--color-muted-1)' : currentColor,\n\t\t\t\t\t}}\n\t\t\t\t\ttitle={msg('style-panel.title')}\n\t\t\t\t\tdisabled={disableStylePanel}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiButtonIcon\n\t\t\t\t\t\ticon={disableStylePanel ? 'blob' : color?.type === 'mixed' ? 'mixed' : 'blob'}\n\t\t\t\t\t/>\n\t\t\t\t</TldrawUiButton>\n\t\t\t</TldrawUiPopoverTrigger>\n\t\t\t<TldrawUiPopoverContent side=\"top\" align=\"end\">\n\t\t\t\t{StylePanel && <StylePanel isMobile />}\n\t\t\t</TldrawUiPopoverContent>\n\t\t</TldrawUiPopover>\n\t)\n}\n", "import { GeoShapeGeoStyle, useEditor, useValue } from '@tldraw/editor'\nimport { TLUiToolItem, useTools } from '../../hooks/useTools'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\n/** @public */\nexport function DefaultToolbarContent() {\n\treturn (\n\t\t<>\n\t\t\t<SelectToolbarItem />\n\t\t\t<HandToolbarItem />\n\t\t\t<DrawToolbarItem />\n\t\t\t<EraserToolbarItem />\n\t\t\t<ArrowToolbarItem />\n\t\t\t<TextToolbarItem />\n\t\t\t<NoteToolbarItem />\n\t\t\t<AssetToolbarItem />\n\t\t\t<RectangleToolbarItem />\n\t\t\t<EllipseToolbarItem />\n\t\t\t<DiamondToolbarItem />\n\t\t\t<TriangleToolbarItem />\n\t\t\t<TrapezoidToolbarItem />\n\t\t\t<RhombusToolbarItem />\n\t\t\t<HexagonToolbarItem />\n\t\t\t<CloudToolbarItem />\n\t\t\t<StarToolbarItem />\n\t\t\t<OvalToolbarItem />\n\t\t\t<XBoxToolbarItem />\n\t\t\t<CheckBoxToolbarItem />\n\t\t\t<ArrowLeftToolbarItem />\n\t\t\t<ArrowUpToolbarItem />\n\t\t\t<ArrowDownToolbarItem />\n\t\t\t<ArrowRightToolbarItem />\n\t\t\t<LineToolbarItem />\n\t\t\t<HighlightToolbarItem />\n\t\t\t<FrameToolbarItem />\n\t\t\t<LaserToolbarItem />\n\t\t</>\n\t)\n}\n\n/** @public */\nexport function useIsToolSelected(tool: TLUiToolItem) {\n\tconst editor = useEditor()\n\tconst geo = tool.meta?.geo\n\treturn useValue(\n\t\t'is tool selected',\n\t\t() => {\n\t\t\tconst activeToolId = editor.getCurrentToolId()\n\t\t\tconst geoState = editor.getSharedStyles().getAsKnownValue(GeoShapeGeoStyle)\n\t\t\treturn geo ? activeToolId === 'geo' && geoState === geo : activeToolId === tool.id\n\t\t},\n\t\t[editor, tool.id, geo]\n\t)\n}\n\n/** @public */\nexport function SelectToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['select'])\n\treturn <TldrawUiMenuItem {...tools['select']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function HandToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['hand'])\n\treturn <TldrawUiMenuItem {...tools['hand']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function DrawToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['draw'])\n\treturn <TldrawUiMenuItem {...tools['draw']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function EraserToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['eraser'])\n\treturn <TldrawUiMenuItem {...tools['eraser']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function ArrowToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['arrow'])\n\treturn <TldrawUiMenuItem {...tools['arrow']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function TextToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['text'])\n\treturn <TldrawUiMenuItem {...tools['text']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function NoteToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['note'])\n\treturn <TldrawUiMenuItem {...tools['note']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function AssetToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['asset'])\n\treturn <TldrawUiMenuItem {...tools['asset']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function RectangleToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['rectangle'])\n\treturn <TldrawUiMenuItem {...tools['rectangle']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function EllipseToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['ellipse'])\n\treturn <TldrawUiMenuItem {...tools['ellipse']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function DiamondToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['diamond'])\n\treturn <TldrawUiMenuItem {...tools['diamond']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function TriangleToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['triangle'])\n\treturn <TldrawUiMenuItem {...tools['triangle']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function TrapezoidToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['trapezoid'])\n\treturn <TldrawUiMenuItem {...tools['trapezoid']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function RhombusToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['rhombus'])\n\treturn <TldrawUiMenuItem {...tools['rhombus']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function HexagonToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['hexagon'])\n\treturn <TldrawUiMenuItem {...tools['hexagon']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function CloudToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['cloud'])\n\treturn <TldrawUiMenuItem {...tools['cloud']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function StarToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['star'])\n\treturn <TldrawUiMenuItem {...tools['star']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function OvalToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['oval'])\n\treturn <TldrawUiMenuItem {...tools['oval']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function XBoxToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['x-box'])\n\treturn <TldrawUiMenuItem {...tools['x-box']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function CheckBoxToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['check-box'])\n\treturn <TldrawUiMenuItem {...tools['check-box']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function ArrowLeftToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['arrow-left'])\n\treturn <TldrawUiMenuItem {...tools['arrow-left']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function ArrowUpToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['arrow-up'])\n\treturn <TldrawUiMenuItem {...tools['arrow-up']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function ArrowDownToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['arrow-down'])\n\treturn <TldrawUiMenuItem {...tools['arrow-down']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function ArrowRightToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['arrow-right'])\n\treturn <TldrawUiMenuItem {...tools['arrow-right']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function LineToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['line'])\n\treturn <TldrawUiMenuItem {...tools['line']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function HighlightToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['highlight'])\n\treturn <TldrawUiMenuItem {...tools['highlight']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function FrameToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['frame'])\n\treturn <TldrawUiMenuItem {...tools['frame']} isSelected={isSelected} />\n}\n\n/** @public */\nexport function LaserToolbarItem() {\n\tconst tools = useTools()\n\tconst isSelected = useIsToolSelected(tools['laser'])\n\treturn <TldrawUiMenuItem {...tools['laser']} isSelected={isSelected} />\n}\n", "import { preventDefault, useEditor, useEvent, useSafeId } from '@tldraw/editor'\nimport classNames from 'classnames'\nimport hotkeys from 'hotkeys-js'\nimport { createContext, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { areShortcutsDisabled } from '../../hooks/useKeyboardShortcuts'\nimport { TLUiToolItem } from '../../hooks/useTools'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\nimport {\n\tTldrawUiDropdownMenuContent,\n\tTldrawUiDropdownMenuRoot,\n\tTldrawUiDropdownMenuTrigger,\n} from '../primitives/TldrawUiDropdownMenu'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\n\nexport const IsInOverflowContext = createContext(false)\n\nexport function OverflowingToolbar({ children }: { children: React.ReactNode }) {\n\tconst editor = useEditor()\n\tconst id = useSafeId()\n\tconst breakpoint = useBreakpoint()\n\tconst msg = useTranslation()\n\n\tconst overflowIndex = Math.min(8, 5 + breakpoint)\n\n\tconst [totalItems, setTotalItems] = useState(0)\n\tconst mainToolsRef = useRef<HTMLDivElement>(null)\n\tconst [lastActiveOverflowItem, setLastActiveOverflowItem] = useState<string | null>(null)\n\n\tconst css = useMemo(() => {\n\t\tconst showInMainSelectors = []\n\t\tconst hideFromOverflowSelectors = []\n\n\t\tif (lastActiveOverflowItem) {\n\t\t\tshowInMainSelectors.push(`[data-value=\"${lastActiveOverflowItem}\"]`)\n\t\t} else {\n\t\t\tshowInMainSelectors.push(`:nth-child(${overflowIndex + 1})`)\n\t\t}\n\n\t\tfor (let i = 0; i < overflowIndex; i++) {\n\t\t\tshowInMainSelectors.push(`:nth-child(${i + 1})`)\n\t\t\thideFromOverflowSelectors.push(`:nth-child(${i + 1})`)\n\t\t}\n\n\t\treturn `\n\t\t\t#${id}_main > *:not(${showInMainSelectors.join(', ')}) {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t\t${hideFromOverflowSelectors.map((s) => `#${id}_more > *${s}`).join(', ')} {\n\t\t\t\tdisplay: none;\n\t\t\t}\n        `\n\t}, [lastActiveOverflowItem, id, overflowIndex])\n\n\tconst onDomUpdate = useEvent(() => {\n\t\tif (!mainToolsRef.current) return\n\n\t\tconst children = Array.from(mainToolsRef.current.children)\n\t\tsetTotalItems(children.length)\n\n\t\t// If the last active overflow item is no longer in the overflow, clear it\n\t\tconst lastActiveElementIdx = children.findIndex(\n\t\t\t(el) => el.getAttribute('data-value') === lastActiveOverflowItem\n\t\t)\n\t\tif (lastActiveElementIdx <= overflowIndex) {\n\t\t\tsetLastActiveOverflowItem(null)\n\t\t}\n\n\t\t// But if there's a new active item...\n\t\tconst activeElementIdx = Array.from(mainToolsRef.current.children).findIndex(\n\t\t\t(el) => el.getAttribute('aria-checked') === 'true'\n\t\t)\n\t\tif (activeElementIdx === -1) return\n\n\t\t// ...and it's in the overflow, set it as the last active overflow item\n\t\tif (activeElementIdx >= overflowIndex) {\n\t\t\tsetLastActiveOverflowItem(children[activeElementIdx].getAttribute('data-value'))\n\t\t}\n\t})\n\n\tuseLayoutEffect(() => {\n\t\tonDomUpdate()\n\t})\n\n\tuseLayoutEffect(() => {\n\t\tif (!mainToolsRef.current) return\n\n\t\tconst mutationObserver = new MutationObserver(onDomUpdate)\n\t\tmutationObserver.observe(mainToolsRef.current, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true,\n\t\t\tattributeFilter: ['data-value', 'aria-checked'],\n\t\t})\n\n\t\treturn () => {\n\t\t\tmutationObserver.disconnect()\n\t\t}\n\t}, [onDomUpdate])\n\n\tuseEffect(() => {\n\t\tconst keys = [\n\t\t\t['1', 0],\n\t\t\t['2', 1],\n\t\t\t['3', 2],\n\t\t\t['4', 3],\n\t\t\t['5', 4],\n\t\t\t['6', 5],\n\t\t\t['7', 6],\n\t\t\t['8', 7],\n\t\t\t['9', 8],\n\t\t\t['0', 9],\n\t\t] as const\n\n\t\tfor (const [key, index] of keys) {\n\t\t\thotkeys(key, (event) => {\n\t\t\t\tif (areShortcutsDisabled(editor)) return\n\t\t\t\tpreventDefault(event)\n\n\t\t\t\tconst relevantEls = Array.from(mainToolsRef.current?.children ?? []).filter(\n\t\t\t\t\t(el): el is HTMLElement => {\n\t\t\t\t\t\t// only count html elements...\n\t\t\t\t\t\tif (!(el instanceof HTMLElement)) return false\n\n\t\t\t\t\t\t// ...that are buttons...\n\t\t\t\t\t\tif (el.tagName.toLowerCase() !== 'button') return false\n\n\t\t\t\t\t\t// ...that are actually visible\n\t\t\t\t\t\treturn !!(el.offsetWidth || el.offsetHeight)\n\t\t\t\t\t}\n\t\t\t\t)\n\n\t\t\t\tconst el = relevantEls[index]\n\t\t\t\tif (el) el.click()\n\t\t\t})\n\t\t}\n\n\t\treturn () => {\n\t\t\thotkeys.unbind('1,2,3,4,5,6,7,8,9,0')\n\t\t}\n\t}, [editor])\n\n\treturn (\n\t\t<>\n\t\t\t<style>{css}</style>\n\t\t\t<div\n\t\t\t\tclassName={classNames('tlui-toolbar__tools', {\n\t\t\t\t\t'tlui-toolbar__tools__mobile': breakpoint < PORTRAIT_BREAKPOINT.TABLET_SM,\n\t\t\t\t})}\n\t\t\t\trole=\"radiogroup\"\n\t\t\t>\n\t\t\t\t<div id={`${id}_main`} ref={mainToolsRef} className=\"tlui-toolbar__tools__list\">\n\t\t\t\t\t<TldrawUiMenuContextProvider type=\"toolbar\" sourceId=\"toolbar\">\n\t\t\t\t\t\t{children}\n\t\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t\t</div>\n\t\t\t\t{totalItems > overflowIndex && (\n\t\t\t\t\t<IsInOverflowContext.Provider value={true}>\n\t\t\t\t\t\t<TldrawUiDropdownMenuRoot id=\"toolbar overflow\" modal={false}>\n\t\t\t\t\t\t\t<TldrawUiDropdownMenuTrigger>\n\t\t\t\t\t\t\t\t<TldrawUiButton\n\t\t\t\t\t\t\t\t\ttitle={msg('tool-panel.more')}\n\t\t\t\t\t\t\t\t\ttype=\"tool\"\n\t\t\t\t\t\t\t\t\tclassName=\"tlui-toolbar__overflow\"\n\t\t\t\t\t\t\t\t\tdata-testid=\"tools.more-button\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TldrawUiButtonIcon icon=\"chevron-up\" />\n\t\t\t\t\t\t\t\t</TldrawUiButton>\n\t\t\t\t\t\t\t</TldrawUiDropdownMenuTrigger>\n\t\t\t\t\t\t\t<TldrawUiDropdownMenuContent side=\"top\" align=\"center\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName=\"tlui-buttons__grid\"\n\t\t\t\t\t\t\t\t\tdata-testid=\"tools.more-content\"\n\t\t\t\t\t\t\t\t\tid={`${id}_more`}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TldrawUiMenuContextProvider type=\"toolbar-overflow\" sourceId=\"toolbar\">\n\t\t\t\t\t\t\t\t\t\t{children}\n\t\t\t\t\t\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</TldrawUiDropdownMenuContent>\n\t\t\t\t\t\t</TldrawUiDropdownMenuRoot>\n\t\t\t\t\t</IsInOverflowContext.Provider>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</>\n\t)\n}\n\nexport const isActiveTLUiToolItem = (\n\titem: TLUiToolItem,\n\tactiveToolId: string | undefined,\n\tgeoState: string | null | undefined\n) => {\n\treturn item.meta?.geo\n\t\t? activeToolId === 'geo' && geoState === item.meta?.geo\n\t\t: activeToolId === item.id\n}\n", "/**! \n * hotkeys-js v3.13.7 \n * A simple micro-library for defining and dispatching keyboard shortcuts. It has no dependencies. \n * \n * Copyright (c) 2024 kenny wong <wowohoo@qq.com> \n * https://github.com/jaywcjlove/hotkeys-js.git \n * \n * @website: https://jaywcjlove.github.io/hotkeys-js\n \n * Licensed under the MIT license \n */\n\nconst isff = typeof navigator !== 'undefined' ? navigator.userAgent.toLowerCase().indexOf('firefox') > 0 : false;\n\n// 绑定事件\nfunction addEvent(object, event, method, useCapture) {\n  if (object.addEventListener) {\n    object.addEventListener(event, method, useCapture);\n  } else if (object.attachEvent) {\n    object.attachEvent(\"on\".concat(event), method);\n  }\n}\nfunction removeEvent(object, event, method, useCapture) {\n  if (object.removeEventListener) {\n    object.removeEventListener(event, method, useCapture);\n  } else if (object.detachEvent) {\n    object.detachEvent(\"on\".concat(event), method);\n  }\n}\n\n// 修饰键转换成对应的键码\nfunction getMods(modifier, key) {\n  const mods = key.slice(0, key.length - 1);\n  for (let i = 0; i < mods.length; i++) mods[i] = modifier[mods[i].toLowerCase()];\n  return mods;\n}\n\n// 处理传的key字符串转换成数组\nfunction getKeys(key) {\n  if (typeof key !== 'string') key = '';\n  key = key.replace(/\\s/g, ''); // 匹配任何空白字符,包括空格、制表符、换页符等等\n  const keys = key.split(','); // 同时设置多个快捷键，以','分割\n  let index = keys.lastIndexOf('');\n\n  // 快捷键可能包含','，需特殊处理\n  for (; index >= 0;) {\n    keys[index - 1] += ',';\n    keys.splice(index, 1);\n    index = keys.lastIndexOf('');\n  }\n  return keys;\n}\n\n// 比较修饰键的数组\nfunction compareArray(a1, a2) {\n  const arr1 = a1.length >= a2.length ? a1 : a2;\n  const arr2 = a1.length >= a2.length ? a2 : a1;\n  let isIndex = true;\n  for (let i = 0; i < arr1.length; i++) {\n    if (arr2.indexOf(arr1[i]) === -1) isIndex = false;\n  }\n  return isIndex;\n}\n\n// Special Keys\nconst _keyMap = {\n  backspace: 8,\n  '⌫': 8,\n  tab: 9,\n  clear: 12,\n  enter: 13,\n  '↩': 13,\n  return: 13,\n  esc: 27,\n  escape: 27,\n  space: 32,\n  left: 37,\n  up: 38,\n  right: 39,\n  down: 40,\n  del: 46,\n  delete: 46,\n  ins: 45,\n  insert: 45,\n  home: 36,\n  end: 35,\n  pageup: 33,\n  pagedown: 34,\n  capslock: 20,\n  num_0: 96,\n  num_1: 97,\n  num_2: 98,\n  num_3: 99,\n  num_4: 100,\n  num_5: 101,\n  num_6: 102,\n  num_7: 103,\n  num_8: 104,\n  num_9: 105,\n  num_multiply: 106,\n  num_add: 107,\n  num_enter: 108,\n  num_subtract: 109,\n  num_decimal: 110,\n  num_divide: 111,\n  '⇪': 20,\n  ',': 188,\n  '.': 190,\n  '/': 191,\n  '`': 192,\n  '-': isff ? 173 : 189,\n  '=': isff ? 61 : 187,\n  ';': isff ? 59 : 186,\n  '\\'': 222,\n  '[': 219,\n  ']': 221,\n  '\\\\': 220\n};\n\n// Modifier Keys\nconst _modifier = {\n  // shiftKey\n  '⇧': 16,\n  shift: 16,\n  // altKey\n  '⌥': 18,\n  alt: 18,\n  option: 18,\n  // ctrlKey\n  '⌃': 17,\n  ctrl: 17,\n  control: 17,\n  // metaKey\n  '⌘': 91,\n  cmd: 91,\n  command: 91\n};\nconst modifierMap = {\n  16: 'shiftKey',\n  18: 'altKey',\n  17: 'ctrlKey',\n  91: 'metaKey',\n  shiftKey: 16,\n  ctrlKey: 17,\n  altKey: 18,\n  metaKey: 91\n};\nconst _mods = {\n  16: false,\n  18: false,\n  17: false,\n  91: false\n};\nconst _handlers = {};\n\n// F1~F12 special key\nfor (let k = 1; k < 20; k++) {\n  _keyMap[\"f\".concat(k)] = 111 + k;\n}\n\nlet _downKeys = []; // 记录摁下的绑定键\nlet winListendFocus = null; // window是否已经监听了focus事件\nlet _scope = 'all'; // 默认热键范围\nconst elementEventMap = new Map(); // 已绑定事件的节点记录\n\n// 返回键码\nconst code = x => _keyMap[x.toLowerCase()] || _modifier[x.toLowerCase()] || x.toUpperCase().charCodeAt(0);\nconst getKey = x => Object.keys(_keyMap).find(k => _keyMap[k] === x);\nconst getModifier = x => Object.keys(_modifier).find(k => _modifier[k] === x);\n\n// 设置获取当前范围（默认为'所有'）\nfunction setScope(scope) {\n  _scope = scope || 'all';\n}\n// 获取当前范围\nfunction getScope() {\n  return _scope || 'all';\n}\n// 获取摁下绑定键的键值\nfunction getPressedKeyCodes() {\n  return _downKeys.slice(0);\n}\nfunction getPressedKeyString() {\n  return _downKeys.map(c => getKey(c) || getModifier(c) || String.fromCharCode(c));\n}\nfunction getAllKeyCodes() {\n  const result = [];\n  Object.keys(_handlers).forEach(k => {\n    _handlers[k].forEach(_ref => {\n      let {\n        key,\n        scope,\n        mods,\n        shortcut\n      } = _ref;\n      result.push({\n        scope,\n        shortcut,\n        mods,\n        keys: key.split('+').map(v => code(v))\n      });\n    });\n  });\n  return result;\n}\n\n// 表单控件控件判断 返回 Boolean\n// hotkey is effective only when filter return true\nfunction filter(event) {\n  const target = event.target || event.srcElement;\n  const {\n    tagName\n  } = target;\n  let flag = true;\n  const isInput = tagName === 'INPUT' && !['checkbox', 'radio', 'range', 'button', 'file', 'reset', 'submit', 'color'].includes(target.type);\n  // ignore: isContentEditable === 'true', <input> and <textarea> when readOnly state is false, <select>\n  if (target.isContentEditable || (isInput || tagName === 'TEXTAREA' || tagName === 'SELECT') && !target.readOnly) {\n    flag = false;\n  }\n  return flag;\n}\n\n// 判断摁下的键是否为某个键，返回true或者false\nfunction isPressed(keyCode) {\n  if (typeof keyCode === 'string') {\n    keyCode = code(keyCode); // 转换成键码\n  }\n  return _downKeys.indexOf(keyCode) !== -1;\n}\n\n// 循环删除handlers中的所有 scope(范围)\nfunction deleteScope(scope, newScope) {\n  let handlers;\n  let i;\n\n  // 没有指定scope，获取scope\n  if (!scope) scope = getScope();\n  for (const key in _handlers) {\n    if (Object.prototype.hasOwnProperty.call(_handlers, key)) {\n      handlers = _handlers[key];\n      for (i = 0; i < handlers.length;) {\n        if (handlers[i].scope === scope) {\n          const deleteItems = handlers.splice(i, 1);\n          deleteItems.forEach(_ref2 => {\n            let {\n              element\n            } = _ref2;\n            return removeKeyEvent(element);\n          });\n        } else {\n          i++;\n        }\n      }\n    }\n  }\n\n  // 如果scope被删除，将scope重置为all\n  if (getScope() === scope) setScope(newScope || 'all');\n}\n\n// 清除修饰键\nfunction clearModifier(event) {\n  let key = event.keyCode || event.which || event.charCode;\n  const i = _downKeys.indexOf(key);\n\n  // 从列表中清除按压过的键\n  if (i >= 0) {\n    _downKeys.splice(i, 1);\n  }\n  // 特殊处理 cmmand 键，在 cmmand 组合快捷键 keyup 只执行一次的问题\n  if (event.key && event.key.toLowerCase() === 'meta') {\n    _downKeys.splice(0, _downKeys.length);\n  }\n\n  // 修饰键 shiftKey altKey ctrlKey (command||metaKey) 清除\n  if (key === 93 || key === 224) key = 91;\n  if (key in _mods) {\n    _mods[key] = false;\n\n    // 将修饰键重置为false\n    for (const k in _modifier) if (_modifier[k] === key) hotkeys[k] = false;\n  }\n}\nfunction unbind(keysInfo) {\n  // unbind(), unbind all keys\n  if (typeof keysInfo === 'undefined') {\n    Object.keys(_handlers).forEach(key => {\n      Array.isArray(_handlers[key]) && _handlers[key].forEach(info => eachUnbind(info));\n      delete _handlers[key];\n    });\n    removeKeyEvent(null);\n  } else if (Array.isArray(keysInfo)) {\n    // support like : unbind([{key: 'ctrl+a', scope: 's1'}, {key: 'ctrl-a', scope: 's2', splitKey: '-'}])\n    keysInfo.forEach(info => {\n      if (info.key) eachUnbind(info);\n    });\n  } else if (typeof keysInfo === 'object') {\n    // support like unbind({key: 'ctrl+a, ctrl+b', scope:'abc'})\n    if (keysInfo.key) eachUnbind(keysInfo);\n  } else if (typeof keysInfo === 'string') {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    // support old method\n    // eslint-disable-line\n    let [scope, method] = args;\n    if (typeof scope === 'function') {\n      method = scope;\n      scope = '';\n    }\n    eachUnbind({\n      key: keysInfo,\n      scope,\n      method,\n      splitKey: '+'\n    });\n  }\n}\n\n// 解除绑定某个范围的快捷键\nconst eachUnbind = _ref3 => {\n  let {\n    key,\n    scope,\n    method,\n    splitKey = '+'\n  } = _ref3;\n  const multipleKeys = getKeys(key);\n  multipleKeys.forEach(originKey => {\n    const unbindKeys = originKey.split(splitKey);\n    const len = unbindKeys.length;\n    const lastKey = unbindKeys[len - 1];\n    const keyCode = lastKey === '*' ? '*' : code(lastKey);\n    if (!_handlers[keyCode]) return;\n    // 判断是否传入范围，没有就获取范围\n    if (!scope) scope = getScope();\n    const mods = len > 1 ? getMods(_modifier, unbindKeys) : [];\n    const unbindElements = [];\n    _handlers[keyCode] = _handlers[keyCode].filter(record => {\n      // 通过函数判断，是否解除绑定，函数相等直接返回\n      const isMatchingMethod = method ? record.method === method : true;\n      const isUnbind = isMatchingMethod && record.scope === scope && compareArray(record.mods, mods);\n      if (isUnbind) unbindElements.push(record.element);\n      return !isUnbind;\n    });\n    unbindElements.forEach(element => removeKeyEvent(element));\n  });\n};\n\n// 对监听对应快捷键的回调函数进行处理\nfunction eventHandler(event, handler, scope, element) {\n  if (handler.element !== element) {\n    return;\n  }\n  let modifiersMatch;\n\n  // 看它是否在当前范围\n  if (handler.scope === scope || handler.scope === 'all') {\n    // 检查是否匹配修饰符（如果有返回true）\n    modifiersMatch = handler.mods.length > 0;\n    for (const y in _mods) {\n      if (Object.prototype.hasOwnProperty.call(_mods, y)) {\n        if (!_mods[y] && handler.mods.indexOf(+y) > -1 || _mods[y] && handler.mods.indexOf(+y) === -1) {\n          modifiersMatch = false;\n        }\n      }\n    }\n\n    // 调用处理程序，如果是修饰键不做处理\n    if (handler.mods.length === 0 && !_mods[16] && !_mods[18] && !_mods[17] && !_mods[91] || modifiersMatch || handler.shortcut === '*') {\n      handler.keys = [];\n      handler.keys = handler.keys.concat(_downKeys);\n      if (handler.method(event, handler) === false) {\n        if (event.preventDefault) event.preventDefault();else event.returnValue = false;\n        if (event.stopPropagation) event.stopPropagation();\n        if (event.cancelBubble) event.cancelBubble = true;\n      }\n    }\n  }\n}\n\n// 处理keydown事件\nfunction dispatch(event, element) {\n  const asterisk = _handlers['*'];\n  let key = event.keyCode || event.which || event.charCode;\n\n  // 表单控件过滤 默认表单控件不触发快捷键\n  if (!hotkeys.filter.call(this, event)) return;\n\n  // Gecko(Firefox)的command键值224，在Webkit(Chrome)中保持一致\n  // Webkit左右 command 键值不一样\n  if (key === 93 || key === 224) key = 91;\n\n  /**\n   * Collect bound keys\n   * If an Input Method Editor is processing key input and the event is keydown, return 229.\n   * https://stackoverflow.com/questions/25043934/is-it-ok-to-ignore-keydown-events-with-keycode-229\n   * http://lists.w3.org/Archives/Public/www-dom/2010JulSep/att-0182/keyCode-spec.html\n   */\n  if (_downKeys.indexOf(key) === -1 && key !== 229) _downKeys.push(key);\n  /**\n   * Jest test cases are required.\n   * ===============================\n   */\n  ['ctrlKey', 'altKey', 'shiftKey', 'metaKey'].forEach(keyName => {\n    const keyNum = modifierMap[keyName];\n    if (event[keyName] && _downKeys.indexOf(keyNum) === -1) {\n      _downKeys.push(keyNum);\n    } else if (!event[keyName] && _downKeys.indexOf(keyNum) > -1) {\n      _downKeys.splice(_downKeys.indexOf(keyNum), 1);\n    } else if (keyName === 'metaKey' && event[keyName] && _downKeys.length === 3) {\n      /**\n       * Fix if Command is pressed:\n       * ===============================\n       */\n      if (!(event.ctrlKey || event.shiftKey || event.altKey)) {\n        _downKeys = _downKeys.slice(_downKeys.indexOf(keyNum));\n      }\n    }\n  });\n  /**\n   * -------------------------------\n   */\n\n  if (key in _mods) {\n    _mods[key] = true;\n\n    // 将特殊字符的key注册到 hotkeys 上\n    for (const k in _modifier) {\n      if (_modifier[k] === key) hotkeys[k] = true;\n    }\n    if (!asterisk) return;\n  }\n\n  // 将 modifierMap 里面的修饰键绑定到 event 中\n  for (const e in _mods) {\n    if (Object.prototype.hasOwnProperty.call(_mods, e)) {\n      _mods[e] = event[modifierMap[e]];\n    }\n  }\n  /**\n   * https://github.com/jaywcjlove/hotkeys/pull/129\n   * This solves the issue in Firefox on Windows where hotkeys corresponding to special characters would not trigger.\n   * An example of this is ctrl+alt+m on a Swedish keyboard which is used to type μ.\n   * Browser support: https://caniuse.com/#feat=keyboardevent-getmodifierstate\n   */\n  if (event.getModifierState && !(event.altKey && !event.ctrlKey) && event.getModifierState('AltGraph')) {\n    if (_downKeys.indexOf(17) === -1) {\n      _downKeys.push(17);\n    }\n    if (_downKeys.indexOf(18) === -1) {\n      _downKeys.push(18);\n    }\n    _mods[17] = true;\n    _mods[18] = true;\n  }\n\n  // 获取范围 默认为 `all`\n  const scope = getScope();\n  // 对任何快捷键都需要做的处理\n  if (asterisk) {\n    for (let i = 0; i < asterisk.length; i++) {\n      if (asterisk[i].scope === scope && (event.type === 'keydown' && asterisk[i].keydown || event.type === 'keyup' && asterisk[i].keyup)) {\n        eventHandler(event, asterisk[i], scope, element);\n      }\n    }\n  }\n  // key 不在 _handlers 中返回\n  if (!(key in _handlers)) return;\n  const handlerKey = _handlers[key];\n  const keyLen = handlerKey.length;\n  for (let i = 0; i < keyLen; i++) {\n    if (event.type === 'keydown' && handlerKey[i].keydown || event.type === 'keyup' && handlerKey[i].keyup) {\n      if (handlerKey[i].key) {\n        const record = handlerKey[i];\n        const {\n          splitKey\n        } = record;\n        const keyShortcut = record.key.split(splitKey);\n        const _downKeysCurrent = []; // 记录当前按键键值\n        for (let a = 0; a < keyShortcut.length; a++) {\n          _downKeysCurrent.push(code(keyShortcut[a]));\n        }\n        if (_downKeysCurrent.sort().join('') === _downKeys.sort().join('')) {\n          // 找到处理内容\n          eventHandler(event, record, scope, element);\n        }\n      }\n    }\n  }\n}\nfunction hotkeys(key, option, method) {\n  _downKeys = [];\n  const keys = getKeys(key); // 需要处理的快捷键列表\n  let mods = [];\n  let scope = 'all'; // scope默认为all，所有范围都有效\n  let element = document; // 快捷键事件绑定节点\n  let i = 0;\n  let keyup = false;\n  let keydown = true;\n  let splitKey = '+';\n  let capture = false;\n  let single = false; // 单个callback\n\n  // 对为设定范围的判断\n  if (method === undefined && typeof option === 'function') {\n    method = option;\n  }\n  if (Object.prototype.toString.call(option) === '[object Object]') {\n    if (option.scope) scope = option.scope; // eslint-disable-line\n    if (option.element) element = option.element; // eslint-disable-line\n    if (option.keyup) keyup = option.keyup; // eslint-disable-line\n    if (option.keydown !== undefined) keydown = option.keydown; // eslint-disable-line\n    if (option.capture !== undefined) capture = option.capture; // eslint-disable-line\n    if (typeof option.splitKey === 'string') splitKey = option.splitKey; // eslint-disable-line\n    if (option.single === true) single = true; // eslint-disable-line\n  }\n  if (typeof option === 'string') scope = option;\n\n  // 如果只允许单个callback，先unbind\n  if (single) unbind(key, scope);\n\n  // 对于每个快捷键进行处理\n  for (; i < keys.length; i++) {\n    key = keys[i].split(splitKey); // 按键列表\n    mods = [];\n\n    // 如果是组合快捷键取得组合快捷键\n    if (key.length > 1) mods = getMods(_modifier, key);\n\n    // 将非修饰键转化为键码\n    key = key[key.length - 1];\n    key = key === '*' ? '*' : code(key); // *表示匹配所有快捷键\n\n    // 判断key是否在_handlers中，不在就赋一个空数组\n    if (!(key in _handlers)) _handlers[key] = [];\n    _handlers[key].push({\n      keyup,\n      keydown,\n      scope,\n      mods,\n      shortcut: keys[i],\n      method,\n      key: keys[i],\n      splitKey,\n      element\n    });\n  }\n  // 在全局document上设置快捷键\n  if (typeof element !== 'undefined' && window) {\n    if (!elementEventMap.has(element)) {\n      const keydownListener = function () {\n        let event = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.event;\n        return dispatch(event, element);\n      };\n      const keyupListenr = function () {\n        let event = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.event;\n        dispatch(event, element);\n        clearModifier(event);\n      };\n      elementEventMap.set(element, {\n        keydownListener,\n        keyupListenr,\n        capture\n      });\n      addEvent(element, 'keydown', keydownListener, capture);\n      addEvent(element, 'keyup', keyupListenr, capture);\n    }\n    if (!winListendFocus) {\n      const listener = () => {\n        _downKeys = [];\n      };\n      winListendFocus = {\n        listener,\n        capture\n      };\n      addEvent(window, 'focus', listener, capture);\n    }\n  }\n}\nfunction trigger(shortcut) {\n  let scope = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'all';\n  Object.keys(_handlers).forEach(key => {\n    const dataList = _handlers[key].filter(item => item.scope === scope && item.shortcut === shortcut);\n    dataList.forEach(data => {\n      if (data && data.method) {\n        data.method();\n      }\n    });\n  });\n}\n\n// 销毁事件,unbind之后判断element上是否还有键盘快捷键，如果没有移除监听\nfunction removeKeyEvent(element) {\n  const values = Object.values(_handlers).flat();\n  const findindex = values.findIndex(_ref4 => {\n    let {\n      element: el\n    } = _ref4;\n    return el === element;\n  });\n  if (findindex < 0) {\n    const {\n      keydownListener,\n      keyupListenr,\n      capture\n    } = elementEventMap.get(element) || {};\n    if (keydownListener && keyupListenr) {\n      removeEvent(element, 'keyup', keyupListenr, capture);\n      removeEvent(element, 'keydown', keydownListener, capture);\n      elementEventMap.delete(element);\n    }\n  }\n  if (values.length <= 0 || elementEventMap.size <= 0) {\n    // 移除所有的元素上的监听\n    const eventKeys = Object.keys(elementEventMap);\n    eventKeys.forEach(el => {\n      const {\n        keydownListener,\n        keyupListenr,\n        capture\n      } = elementEventMap.get(el) || {};\n      if (keydownListener && keyupListenr) {\n        removeEvent(el, 'keyup', keyupListenr, capture);\n        removeEvent(el, 'keydown', keydownListener, capture);\n        elementEventMap.delete(el);\n      }\n    });\n    // 清空 elementEventMap\n    elementEventMap.clear();\n    // 清空 _handlers\n    Object.keys(_handlers).forEach(key => delete _handlers[key]);\n    // 移除window上的focus监听\n    if (winListendFocus) {\n      const {\n        listener,\n        capture\n      } = winListendFocus;\n      removeEvent(window, 'focus', listener, capture);\n      winListendFocus = null;\n    }\n  }\n}\nconst _api = {\n  getPressedKeyString,\n  setScope,\n  getScope,\n  deleteScope,\n  getPressedKeyCodes,\n  getAllKeyCodes,\n  isPressed,\n  filter,\n  trigger,\n  unbind,\n  keyMap: _keyMap,\n  modifier: _modifier,\n  modifierMap\n};\nfor (const a in _api) {\n  if (Object.prototype.hasOwnProperty.call(_api, a)) {\n    hotkeys[a] = _api[a];\n  }\n}\nif (typeof window !== 'undefined') {\n  const _hotkeys = window.hotkeys;\n  hotkeys.noConflict = deep => {\n    if (deep && window.hotkeys === hotkeys) {\n      window.hotkeys = _hotkeys;\n    }\n    return hotkeys;\n  };\n  window.hotkeys = hotkeys;\n}\n\nexport { hotkeys as default };\n", "import { Editor, TLPointerEventInfo, preventDefault, useEditor, useValue } from '@tldraw/editor'\nimport hotkeys from 'hotkeys-js'\nimport { useEffect } from 'react'\nimport { useActions } from '../context/actions'\nimport { useReadonly } from './useReadonly'\nimport { useTools } from './useTools'\n\nconst SKIP_KBDS = [\n\t// we set these in useNativeClipboardEvents instead\n\t'copy',\n\t'cut',\n\t'paste',\n\t// There's also an upload asset action, so we don't want to set the kbd twice\n\t'asset',\n]\n\n/** @public */\nexport function useKeyboardShortcuts() {\n\tconst editor = useEditor()\n\n\tconst isReadonlyMode = useReadonly()\n\tconst actions = useActions()\n\tconst tools = useTools()\n\tconst isFocused = useValue('is focused', () => editor.getInstanceState().isFocused, [editor])\n\n\tuseEffect(() => {\n\t\tif (!isFocused) return\n\n\t\tconst container = editor.getContainer()\n\n\t\thotkeys.setScope(editor.store.id)\n\n\t\tconst hot = (keys: string, callback: (event: KeyboardEvent) => void) => {\n\t\t\thotkeys(keys, { element: document.body, scope: editor.store.id }, callback)\n\t\t}\n\n\t\tconst hotUp = (keys: string, callback: (event: KeyboardEvent) => void) => {\n\t\t\thotkeys(\n\t\t\t\tkeys,\n\t\t\t\t{ element: document.body, keyup: true, keydown: false, scope: editor.store.id },\n\t\t\t\tcallback\n\t\t\t)\n\t\t}\n\n\t\t// Add hotkeys for actions and tools.\n\t\t// Except those that in SKIP_KBDS!\n\t\tfor (const action of Object.values(actions)) {\n\t\t\tif (!action.kbd) continue\n\t\t\tif (isReadonlyMode && !action.readonlyOk) continue\n\t\t\tif (SKIP_KBDS.includes(action.id)) continue\n\n\t\t\thot(getHotkeysStringFromKbd(action.kbd), (event) => {\n\t\t\t\tif (areShortcutsDisabled(editor)) return\n\t\t\t\tpreventDefault(event)\n\t\t\t\taction.onSelect('kbd')\n\t\t\t})\n\t\t}\n\n\t\tfor (const tool of Object.values(tools)) {\n\t\t\tif (!tool.kbd || (!tool.readonlyOk && editor.getInstanceState().isReadonly)) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (SKIP_KBDS.includes(tool.id)) continue\n\n\t\t\thot(getHotkeysStringFromKbd(tool.kbd), (event) => {\n\t\t\t\tif (areShortcutsDisabled(editor)) return\n\t\t\t\tpreventDefault(event)\n\t\t\t\ttool.onSelect('kbd')\n\t\t\t})\n\t\t}\n\n\t\thot(',', (e) => {\n\t\t\t// Skip if shortcuts are disabled\n\t\t\tif (areShortcutsDisabled(editor)) return\n\n\t\t\t// Don't press again if already pressed\n\t\t\tif (editor.inputs.keys.has('Comma')) return\n\n\t\t\tpreventDefault(e) // prevent whatever would normally happen\n\t\t\tcontainer.focus() // Focus if not already focused\n\n\t\t\teditor.inputs.keys.add('Comma')\n\n\t\t\tconst { x, y, z } = editor.inputs.currentScreenPoint\n\t\t\tconst info: TLPointerEventInfo = {\n\t\t\t\ttype: 'pointer',\n\t\t\t\tname: 'pointer_down',\n\t\t\t\tpoint: { x, y, z },\n\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tctrlKey: e.metaKey || e.ctrlKey,\n\t\t\t\tpointerId: 0,\n\t\t\t\tbutton: 0,\n\t\t\t\tisPen: editor.getInstanceState().isPenMode,\n\t\t\t\ttarget: 'canvas',\n\t\t\t}\n\n\t\t\teditor.dispatch(info)\n\t\t})\n\n\t\thotUp(',', (e) => {\n\t\t\tif (areShortcutsDisabled(editor)) return\n\t\t\tif (!editor.inputs.keys.has('Comma')) return\n\n\t\t\teditor.inputs.keys.delete('Comma')\n\n\t\t\tconst { x, y, z } = editor.inputs.currentScreenPoint\n\t\t\tconst info: TLPointerEventInfo = {\n\t\t\t\ttype: 'pointer',\n\t\t\t\tname: 'pointer_up',\n\t\t\t\tpoint: { x, y, z },\n\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tctrlKey: e.metaKey || e.ctrlKey,\n\t\t\t\tpointerId: 0,\n\t\t\t\tbutton: 0,\n\t\t\t\tisPen: editor.getInstanceState().isPenMode,\n\t\t\t\ttarget: 'canvas',\n\t\t\t}\n\n\t\t\teditor.dispatch(info)\n\t\t})\n\n\t\treturn () => {\n\t\t\thotkeys.deleteScope(editor.store.id)\n\t\t}\n\t}, [actions, tools, isReadonlyMode, editor, isFocused])\n}\n\nfunction getHotkeysStringFromKbd(kbd: string) {\n\treturn getKeys(kbd)\n\t\t.map((kbd) => {\n\t\t\tlet str = ''\n\t\t\tconst chars = kbd.split('')\n\t\t\tif (chars.length === 1) {\n\t\t\t\tstr = chars[0]\n\t\t\t} else {\n\t\t\t\tif (chars[0] === '!') {\n\t\t\t\t\tstr = `shift+${chars[1]}`\n\t\t\t\t} else if (chars[0] === '?') {\n\t\t\t\t\tif (chars.length === 3 && chars[1] === '!') {\n\t\t\t\t\t\tstr = `alt+shift+${chars[2]}`\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstr = `alt+${chars[1]}`\n\t\t\t\t\t}\n\t\t\t\t} else if (chars[0] === '$') {\n\t\t\t\t\tif (chars[1] === '!') {\n\t\t\t\t\t\tstr = `cmd+shift+${chars[2]},ctrl+shift+${chars[2]}`\n\t\t\t\t\t} else if (chars[1] === '?') {\n\t\t\t\t\t\tstr = `cmd+\u2325+${chars[2]},ctrl+alt+${chars[2]}`\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstr = `cmd+${chars[1]},ctrl+${chars[1]}`\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstr = kbd\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn str\n\t\t})\n\t\t.join(',')\n}\n\n// Logic to split kbd string from hotkeys-js util.\nfunction getKeys(key: string) {\n\tif (typeof key !== 'string') key = ''\n\tkey = key.replace(/\\s/g, '')\n\tconst keys = key.split(',')\n\tlet index = keys.lastIndexOf('')\n\n\tfor (; index >= 0; ) {\n\t\tkeys[index - 1] += ','\n\t\tkeys.splice(index, 1)\n\t\tindex = keys.lastIndexOf('')\n\t}\n\n\treturn keys\n}\n\nexport function areShortcutsDisabled(editor: Editor) {\n\treturn editor.getIsMenuOpen() || editor.getEditingShapeId() !== null || editor.getCrashingError()\n}\n", "import { useEditor, useValue } from '@tldraw/editor'\nimport classNames from 'classnames'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiButtonIcon } from '../primitives/Button/TldrawUiButtonIcon'\n\ninterface ToggleToolLockedButtonProps {\n\tactiveToolId?: string\n}\n\nconst NOT_LOCKABLE_TOOLS = [\n\t'select',\n\t'hand',\n\t'draw',\n\t'eraser',\n\t'text',\n\t'zoom',\n\t'laser',\n\t'highlight',\n]\n\nexport function ToggleToolLockedButton({ activeToolId }: ToggleToolLockedButtonProps) {\n\tconst editor = useEditor()\n\tconst breakpoint = useBreakpoint()\n\tconst msg = useTranslation()\n\n\tconst isToolLocked = useValue('is tool locked', () => editor.getInstanceState().isToolLocked, [\n\t\teditor,\n\t])\n\n\tif (!activeToolId || NOT_LOCKABLE_TOOLS.includes(activeToolId)) return null\n\n\treturn (\n\t\t<TldrawUiButton\n\t\t\ttype=\"normal\"\n\t\t\ttitle={msg('action.toggle-tool-lock')}\n\t\t\tdata-testid=\"tool-lock\"\n\t\t\tclassName={classNames('tlui-toolbar__lock-button', {\n\t\t\t\t'tlui-toolbar__lock-button__mobile': breakpoint < PORTRAIT_BREAKPOINT.TABLET_SM,\n\t\t\t})}\n\t\t\tonClick={() => editor.updateInstanceState({ isToolLocked: !isToolLocked })}\n\t\t>\n\t\t\t<TldrawUiButtonIcon icon={isToolLocked ? 'lock' : 'unlock'} small />\n\t\t</TldrawUiButton>\n\t)\n}\n", "import * as _Dropdown from '@radix-ui/react-dropdown-menu'\nimport { ANIMATION_MEDIUM_MS, useContainer, useEditor, useValue } from '@tldraw/editor'\nimport { ReactNode, forwardRef, memo, useCallback } from 'react'\nimport { PORTRAIT_BREAKPOINT } from '../../constants'\nimport { useBreakpoint } from '../../context/breakpoints'\nimport { useMenuIsOpen } from '../../hooks/useMenuIsOpen'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiButton } from '../primitives/Button/TldrawUiButton'\nimport { TldrawUiMenuContextProvider } from '../primitives/menus/TldrawUiMenuContext'\nimport { DefaultZoomMenuContent } from './DefaultZoomMenuContent'\n\n/** @public */\nexport type TLUiZoomMenuProps = {\n\tchildren?: ReactNode\n}\n\n/** @public */\nexport const DefaultZoomMenu = memo(function DefaultZoomMenu({ children }: TLUiZoomMenuProps) {\n\tconst container = useContainer()\n\tconst [isOpen, onOpenChange] = useMenuIsOpen('zoom menu')\n\n\t// Get the zoom menu content, either the default component or the user's\n\t// override. If there's no menu content, then the user has set it to null,\n\t// so skip rendering the menu.\n\tconst content = children ?? <DefaultZoomMenuContent />\n\n\treturn (\n\t\t<_Dropdown.Root dir=\"ltr\" open={isOpen} onOpenChange={onOpenChange} modal={false}>\n\t\t\t<_Dropdown.Trigger asChild dir=\"ltr\">\n\t\t\t\t<ZoomTriggerButton />\n\t\t\t</_Dropdown.Trigger>\n\t\t\t<_Dropdown.Portal container={container}>\n\t\t\t\t<_Dropdown.Content\n\t\t\t\t\tclassName=\"tlui-menu\"\n\t\t\t\t\tside=\"top\"\n\t\t\t\t\talign=\"start\"\n\t\t\t\t\talignOffset={0}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t\tcollisionPadding={4}\n\t\t\t\t>\n\t\t\t\t\t<TldrawUiMenuContextProvider type=\"menu\" sourceId=\"zoom-menu\">\n\t\t\t\t\t\t{content}\n\t\t\t\t\t</TldrawUiMenuContextProvider>\n\t\t\t\t</_Dropdown.Content>\n\t\t\t</_Dropdown.Portal>\n\t\t</_Dropdown.Root>\n\t)\n})\n\nconst ZoomTriggerButton = forwardRef<HTMLButtonElement, any>(\n\tfunction ZoomTriggerButton(props, ref) {\n\t\tconst editor = useEditor()\n\t\tconst breakpoint = useBreakpoint()\n\t\tconst zoom = useValue('zoom', () => editor.getZoomLevel(), [editor])\n\t\tconst msg = useTranslation()\n\n\t\tconst handleDoubleClick = useCallback(() => {\n\t\t\teditor.resetZoom(editor.getViewportScreenCenter(), { duration: ANIMATION_MEDIUM_MS })\n\t\t}, [editor])\n\n\t\treturn (\n\t\t\t<TldrawUiButton\n\t\t\t\tref={ref}\n\t\t\t\t{...props}\n\t\t\t\ttype=\"icon\"\n\t\t\t\ttitle={`${msg('navigation-zone.zoom')}`}\n\t\t\t\tdata-testid=\"minimap.zoom-menu-button\"\n\t\t\t\tclassName={\n\t\t\t\t\tbreakpoint < PORTRAIT_BREAKPOINT.TABLET_SM\n\t\t\t\t\t\t? 'tlui-zoom-menu__button'\n\t\t\t\t\t\t: 'tlui-zoom-menu__button__pct'\n\t\t\t\t}\n\t\t\t\tonDoubleClick={handleDoubleClick}\n\t\t\t\ticon={breakpoint < PORTRAIT_BREAKPOINT.MOBILE ? 'zoom-in' : undefined}\n\t\t\t>\n\t\t\t\t{breakpoint < PORTRAIT_BREAKPOINT.MOBILE ? null : (\n\t\t\t\t\t<span style={{ flexGrow: 0, textAlign: 'center' }}>{Math.floor(zoom * 100)}%</span>\n\t\t\t\t)}\n\t\t\t</TldrawUiButton>\n\t\t)\n\t}\n)\n", "import { useActions } from '../../context/actions'\nimport { ZoomTo100MenuItem, ZoomToFitMenuItem, ZoomToSelectionMenuItem } from '../menu-items'\nimport { TldrawUiMenuItem } from '../primitives/menus/TldrawUiMenuItem'\n\n/** @public */\nexport function DefaultZoomMenuContent() {\n\tconst actions = useActions()\n\treturn (\n\t\t<>\n\t\t\t<TldrawUiMenuItem {...actions['zoom-in']} noClose />\n\t\t\t<TldrawUiMenuItem {...actions['zoom-out']} noClose />\n\t\t\t<ZoomTo100MenuItem />\n\t\t\t<ZoomToFitMenuItem />\n\t\t\t<ZoomToSelectionMenuItem />\n\t\t</>\n\t)\n}\n", "import { useEditor } from '@tldraw/editor'\nimport { useEffect } from 'react'\nimport { useToasts } from '../context/toasts'\n\n/** @internal */\nexport function useEditorEvents() {\n\tconst editor = useEditor()\n\tconst { addToast } = useToasts()\n\n\tuseEffect(() => {\n\t\tfunction handleMaxShapes({ name, count }: { name: string; pageId: string; count: number }) {\n\t\t\taddToast({\n\t\t\t\ttitle: 'Maximum Shapes Reached',\n\t\t\t\tdescription: `You've reached the maximum number of shapes allowed on ${name} (${count}). Please delete some shapes or move to a different page to continue.`,\n\t\t\t\tseverity: 'warning',\n\t\t\t})\n\t\t}\n\n\t\teditor.addListener('max-shapes', handleMaxShapes)\n\t\treturn () => {\n\t\t\teditor.removeListener('max-shapes', handleMaxShapes)\n\t\t}\n\t}, [editor, addToast])\n}\n", "import { useEffect, useMemo, useState } from 'react'\nimport { TLTypeFace, preloadFont } from '../../utils/assets/preload-font'\nimport { TLEditorAssetUrls } from '../../utils/static-assets/assetUrls'\n\nenum PreloadStatus {\n\tSUCCESS,\n\tFAILED,\n\tWAITING,\n}\n\nconst usePreloadFont = (id: string, font: TLTypeFace): PreloadStatus => {\n\tconst [state, setState] = useState<PreloadStatus>(PreloadStatus.WAITING)\n\n\tuseEffect(() => {\n\t\tlet cancelled = false\n\n\t\tsetState(PreloadStatus.WAITING)\n\n\t\tpreloadFont(id, font)\n\t\t\t.then(() => {\n\t\t\t\tif (cancelled) return\n\t\t\t\tsetState(PreloadStatus.SUCCESS)\n\t\t\t})\n\t\t\t.catch((err: any) => {\n\t\t\t\tif (cancelled) return\n\t\t\t\tconsole.error(err)\n\t\t\t\tsetState(PreloadStatus.FAILED)\n\t\t\t})\n\n\t\treturn () => {\n\t\t\tcancelled = true\n\t\t}\n\t}, [id, font])\n\n\treturn state\n}\n\nfunction getTypefaces(assetUrls: TLEditorAssetUrls) {\n\treturn {\n\t\tdraw: {\n\t\t\turl: assetUrls.fonts.draw,\n\t\t\tformat: assetUrls.fonts.draw.split('.').pop(),\n\t\t},\n\t\tserif: {\n\t\t\turl: assetUrls.fonts.serif,\n\t\t\tformat: assetUrls.fonts.serif.split('.').pop(),\n\t\t},\n\t\tsansSerif: {\n\t\t\turl: assetUrls.fonts.sansSerif,\n\t\t\tformat: assetUrls.fonts.sansSerif.split('.').pop(),\n\t\t},\n\t\tmonospace: {\n\t\t\turl: assetUrls.fonts.monospace,\n\t\t\tformat: assetUrls.fonts.monospace.split('.').pop(),\n\t\t},\n\t}\n}\n\n/** @public */\nexport function usePreloadAssets(assetUrls: TLEditorAssetUrls) {\n\tconst typefaces = useMemo(() => getTypefaces(assetUrls), [assetUrls])\n\n\tconst results = [\n\t\tusePreloadFont('tldraw_draw', typefaces.draw),\n\t\tusePreloadFont('tldraw_serif', typefaces.serif),\n\t\tusePreloadFont('tldraw_sans', typefaces.sansSerif),\n\t\tusePreloadFont('tldraw_mono', typefaces.monospace),\n\t]\n\n\treturn {\n\t\t// If any of the results have errored, then preloading has failed\n\t\terror: results.some((result) => result === PreloadStatus.FAILED),\n\t\t// If any of the results are waiting, then we're not done yet\n\t\tdone: !results.some((result) => result === PreloadStatus.WAITING),\n\t}\n}\n", "import {\n\tEditor,\n\tErrorScreen,\n\tExpand,\n\tLoadingScreen,\n\tStoreSnapshot,\n\tTLAnyShapeUtilConstructor,\n\tTLPageId,\n\tTLRecord,\n\tTLSvgOptions,\n\tuseShallowArrayIdentity,\n\tuseTLStore,\n} from '@tldraw/editor'\nimport { memo, useLayoutEffect, useMemo, useState } from 'react'\nimport { defaultShapeUtils } from './defaultShapeUtils'\nimport { usePreloadAssets } from './ui/hooks/usePreloadAssets'\nimport { getSvgAsImage } from './utils/export/export'\nimport { useDefaultEditorAssetsWithOverrides } from './utils/static-assets/assetUrls'\n\n/**\n * Props for the {@link tldraw#TldrawImage} component.\n *\n * @public\n **/\nexport type TldrawImageProps = Expand<\n\t{\n\t\t/**\n\t\t * The snapshot to display.\n\t\t */\n\t\tsnapshot: StoreSnapshot<TLRecord>\n\n\t\t/**\n\t\t * The image format to use. Defaults to 'svg'.\n\t\t */\n\t\tformat?: 'svg' | 'png'\n\n\t\t/**\n\t\t * The page to display. Defaults to the first page.\n\t\t */\n\t\tpageId?: TLPageId\n\n\t\t/**\n\t\t * Additional shape utils to use.\n\t\t */\n\t\tshapeUtils?: readonly TLAnyShapeUtilConstructor[]\n\t} & Partial<TLSvgOptions>\n>\n\n/**\n * A renderered SVG image of a Tldraw snapshot.\n *\n * @example\n * ```tsx\n * <TldrawImage\n * \tsnapshot={snapshot}\n * \tpageId={pageId}\n * \tbackground={false}\n *  darkMode={true}\n *  bounds={new Box(0,0,600,400)}\n *  scale={1}\n * />\n * ```\n *\n * @public\n */\nexport const TldrawImage = memo(function TldrawImage(props: TldrawImageProps) {\n\tconst [url, setUrl] = useState<string | null>(null)\n\tconst [container, setContainer] = useState<HTMLDivElement | null>(null)\n\n\tconst shapeUtils = useShallowArrayIdentity(props.shapeUtils ?? [])\n\tconst shapeUtilsWithDefaults = useMemo(() => [...defaultShapeUtils, ...shapeUtils], [shapeUtils])\n\tconst store = useTLStore({ snapshot: props.snapshot, shapeUtils: shapeUtilsWithDefaults })\n\n\tconst assets = useDefaultEditorAssetsWithOverrides()\n\tconst { done: preloadingComplete, error: preloadingError } = usePreloadAssets(assets)\n\n\tconst {\n\t\tpageId,\n\t\tbounds,\n\t\tscale,\n\t\tbackground,\n\t\tpadding,\n\t\tdarkMode,\n\t\tpreserveAspectRatio,\n\t\tformat = 'svg',\n\t} = props\n\n\tuseLayoutEffect(() => {\n\t\tif (!container) return\n\t\tif (!store) return\n\t\tif (!preloadingComplete) return\n\n\t\tlet isCancelled = false\n\n\t\tconst tempElm = document.createElement('div')\n\t\tcontainer.appendChild(tempElm)\n\t\tcontainer.classList.add('tl-container', 'tl-theme__light')\n\n\t\tconst editor = new Editor({\n\t\t\tstore,\n\t\t\tshapeUtils: shapeUtilsWithDefaults ?? [],\n\t\t\ttools: [],\n\t\t\tgetContainer: () => tempElm,\n\t\t})\n\n\t\tif (pageId) editor.setCurrentPage(pageId)\n\n\t\tconst shapeIds = editor.getCurrentPageShapeIds()\n\n\t\tasync function setSvg() {\n\t\t\tconst svgResult = await editor.getSvgString([...shapeIds], {\n\t\t\t\tbounds,\n\t\t\t\tscale,\n\t\t\t\tbackground,\n\t\t\t\tpadding,\n\t\t\t\tdarkMode,\n\t\t\t\tpreserveAspectRatio,\n\t\t\t})\n\n\t\t\tif (svgResult && !isCancelled) {\n\t\t\t\tif (format === 'svg') {\n\t\t\t\t\tif (!isCancelled) {\n\t\t\t\t\t\tconst blob = new Blob([svgResult.svg], { type: 'image/svg+xml' })\n\t\t\t\t\t\tconst url = URL.createObjectURL(blob)\n\t\t\t\t\t\tsetUrl(url)\n\t\t\t\t\t}\n\t\t\t\t} else if (format === 'png') {\n\t\t\t\t\tconst blob = await getSvgAsImage(svgResult.svg, editor.environment.isSafari, {\n\t\t\t\t\t\ttype: format,\n\t\t\t\t\t\tquality: 1,\n\t\t\t\t\t\tscale: 2,\n\t\t\t\t\t\twidth: svgResult.width,\n\t\t\t\t\t\theight: svgResult.height,\n\t\t\t\t\t})\n\t\t\t\t\tif (blob && !isCancelled) {\n\t\t\t\t\t\tconst url = URL.createObjectURL(blob)\n\t\t\t\t\t\tsetUrl(url)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\teditor.dispose()\n\t\t}\n\n\t\tsetSvg()\n\n\t\treturn () => {\n\t\t\tisCancelled = true\n\t\t}\n\t}, [\n\t\tformat,\n\t\tcontainer,\n\t\tstore,\n\t\tshapeUtilsWithDefaults,\n\t\tpageId,\n\t\tbounds,\n\t\tscale,\n\t\tbackground,\n\t\tpadding,\n\t\tdarkMode,\n\t\tpreserveAspectRatio,\n\t\tpreloadingComplete,\n\t\tpreloadingError,\n\t])\n\n\tif (preloadingError) {\n\t\treturn <ErrorScreen>Could not load assets.</ErrorScreen>\n\t}\n\n\tif (!preloadingComplete) {\n\t\treturn <LoadingScreen>Loading assets...</LoadingScreen>\n\t}\n\n\treturn (\n\t\t<div ref={setContainer} style={{ position: 'relative', width: '100%', height: '100%' }}>\n\t\t\t{url && <img src={url} style={{ width: '100%', height: '100%' }} />}\n\t\t</div>\n\t)\n})\n", "import classNames from 'classnames'\nimport { useRef } from 'react'\nimport { useTranslation } from '../../hooks/useTranslation/useTranslation'\nimport { TldrawUiIcon } from '../primitives/TldrawUiIcon'\n\n/** @public */\nexport function OfflineIndicator() {\n\tconst msg = useTranslation()\n\tconst rContainer = useRef<HTMLDivElement>(null)\n\n\treturn (\n\t\t<div className={classNames('tlui-offline-indicator')} ref={rContainer}>\n\t\t\t{msg('status.offline')}\n\t\t\t<TldrawUiIcon aria-label=\"offline\" icon=\"status-offline\" small />\n\t\t</div>\n\t)\n}\n", "import {\n\tAssetRecordType,\n\tEditor,\n\tMAX_SHAPES_PER_PAGE,\n\tPageRecordType,\n\tTLArrowShape,\n\tTLArrowShapeArrowheadStyle,\n\tTLArrowShapeTerminal,\n\tTLAsset,\n\tTLAssetId,\n\tTLDefaultColorStyle,\n\tTLDefaultDashStyle,\n\tTLDefaultFontStyle,\n\tTLDefaultHorizontalAlignStyle,\n\tTLDefaultSizeStyle,\n\tTLDrawShape,\n\tTLGeoShape,\n\tTLImageShape,\n\tTLNoteShape,\n\tTLPageId,\n\tTLShapeId,\n\tTLTextShape,\n\tTLVideoShape,\n\tVec,\n\tVecModel,\n\tclamp,\n\tcreateShapeId,\n} from '@tldraw/editor'\n\nconst TLDRAW_V1_VERSION = 15.5\n\n/** @internal */\nexport function buildFromV1Document(editor: Editor, document: LegacyTldrawDocument) {\n\teditor.batch(() => {\n\t\tdocument = migrate(document, TLDRAW_V1_VERSION)\n\t\t// Cancel any interactions / states\n\t\teditor.cancel().cancel().cancel().cancel()\n\n\t\tconst firstPageId = editor.getPages()[0].id\n\n\t\t// Set the current page to the first page\n\t\teditor.setCurrentPage(firstPageId)\n\n\t\t// Delete all pages except first page\n\t\tfor (const page of editor.getPages().slice(1)) {\n\t\t\teditor.deletePage(page.id)\n\t\t}\n\n\t\t// Delete all of the shapes on the current page\n\t\teditor.selectAll()\n\t\teditor.deleteShapes(editor.getSelectedShapeIds())\n\n\t\t// Create assets\n\t\tconst v1AssetIdsToV2AssetIds = new Map<string, TLAssetId>()\n\n\t\tObject.values(document.assets ?? {}).forEach((v1Asset) => {\n\t\t\tswitch (v1Asset.type) {\n\t\t\t\tcase TDAssetType.Image: {\n\t\t\t\t\tconst assetId: TLAssetId = AssetRecordType.createId()\n\t\t\t\t\tv1AssetIdsToV2AssetIds.set(v1Asset.id, assetId)\n\t\t\t\t\tconst placeholderAsset: TLAsset = {\n\t\t\t\t\t\tid: assetId,\n\t\t\t\t\t\ttypeName: 'asset',\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tw: coerceDimension(v1Asset.size[0]),\n\t\t\t\t\t\t\th: coerceDimension(v1Asset.size[1]),\n\t\t\t\t\t\t\tname: v1Asset.fileName ?? 'Untitled',\n\t\t\t\t\t\t\tisAnimated: false,\n\t\t\t\t\t\t\tmimeType: null,\n\t\t\t\t\t\t\tsrc: v1Asset.src,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmeta: {},\n\t\t\t\t\t}\n\t\t\t\t\teditor.createAssets([placeholderAsset])\n\t\t\t\t\ttryMigrateAsset(editor, placeholderAsset)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase TDAssetType.Video:\n\t\t\t\t\t{\n\t\t\t\t\t\tconst assetId: TLAssetId = AssetRecordType.createId()\n\t\t\t\t\t\tv1AssetIdsToV2AssetIds.set(v1Asset.id, assetId)\n\t\t\t\t\t\teditor.createAssets([\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid: assetId,\n\t\t\t\t\t\t\t\ttypeName: 'asset',\n\t\t\t\t\t\t\t\ttype: 'video',\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\tw: coerceDimension(v1Asset.size[0]),\n\t\t\t\t\t\t\t\t\th: coerceDimension(v1Asset.size[1]),\n\t\t\t\t\t\t\t\t\tname: v1Asset.fileName ?? 'Untitled',\n\t\t\t\t\t\t\t\t\tisAnimated: true,\n\t\t\t\t\t\t\t\t\tmimeType: null,\n\t\t\t\t\t\t\t\t\tsrc: v1Asset.src,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmeta: {},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t])\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t})\n\n\t\t// Create pages\n\n\t\tconst v1PageIdsToV2PageIds = new Map<string, TLPageId>()\n\n\t\tObject.values(document.pages ?? {})\n\t\t\t.sort((a, b) => ((a.childIndex ?? 1) < (b.childIndex ?? 1) ? -1 : 1))\n\t\t\t.forEach((v1Page, i) => {\n\t\t\t\tif (i === 0) {\n\t\t\t\t\tv1PageIdsToV2PageIds.set(v1Page.id, editor.getCurrentPageId())\n\t\t\t\t} else {\n\t\t\t\t\tconst pageId = PageRecordType.createId()\n\t\t\t\t\tv1PageIdsToV2PageIds.set(v1Page.id, pageId)\n\t\t\t\t\teditor.createPage({ name: v1Page.name ?? 'Page', id: pageId })\n\t\t\t\t}\n\t\t\t})\n\n\t\tObject.values(document.pages ?? {})\n\t\t\t.sort((a, b) => ((a.childIndex ?? 1) < (b.childIndex ?? 1) ? -1 : 1))\n\t\t\t.forEach((v1Page) => {\n\t\t\t\t// Set the current page id to the current page\n\t\t\t\teditor.setCurrentPage(v1PageIdsToV2PageIds.get(v1Page.id)!)\n\n\t\t\t\tconst v1ShapeIdsToV2ShapeIds = new Map<string, TLShapeId>()\n\t\t\t\tconst v1GroupShapeIdsToV1ChildIds = new Map<string, string[]>()\n\n\t\t\t\tconst v1Shapes = Object.values(v1Page.shapes ?? {})\n\t\t\t\t\t.sort((a, b) => (a.childIndex < b.childIndex ? -1 : 1))\n\t\t\t\t\t.slice(0, MAX_SHAPES_PER_PAGE)\n\n\t\t\t\t// Groups only\n\t\t\t\tv1Shapes.forEach((v1Shape) => {\n\t\t\t\t\tif (v1Shape.type !== TDShapeType.Group) return\n\n\t\t\t\t\tconst shapeId = createShapeId()\n\t\t\t\t\tv1ShapeIdsToV2ShapeIds.set(v1Shape.id, shapeId)\n\t\t\t\t\tv1GroupShapeIdsToV1ChildIds.set(v1Shape.id, [])\n\t\t\t\t})\n\n\t\t\t\tfunction decideNotToCreateShape(v1Shape: TDShape) {\n\t\t\t\t\tv1ShapeIdsToV2ShapeIds.delete(v1Shape.id)\n\t\t\t\t\tconst v1GroupParent = v1GroupShapeIdsToV1ChildIds.has(v1Shape.parentId)\n\t\t\t\t\tif (v1GroupParent) {\n\t\t\t\t\t\tconst ids = v1GroupShapeIdsToV1ChildIds\n\t\t\t\t\t\t\t.get(v1Shape.parentId)!\n\t\t\t\t\t\t\t.filter((id) => id !== v1Shape.id)\n\t\t\t\t\t\tv1GroupShapeIdsToV1ChildIds.set(v1Shape.parentId, ids)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Non-groups only\n\t\t\t\tv1Shapes.forEach((v1Shape) => {\n\t\t\t\t\t// Skip groups for now, we'll create groups via the app's API\n\t\t\t\t\tif (v1Shape.type === TDShapeType.Group) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tconst shapeId = createShapeId()\n\t\t\t\t\tv1ShapeIdsToV2ShapeIds.set(v1Shape.id, shapeId)\n\n\t\t\t\t\tif (v1Shape.parentId !== v1Page.id) {\n\t\t\t\t\t\t// If the parent is a group, then add the shape to the group's children\n\t\t\t\t\t\tif (v1GroupShapeIdsToV1ChildIds.has(v1Shape.parentId)) {\n\t\t\t\t\t\t\tv1GroupShapeIdsToV1ChildIds.get(v1Shape.parentId)!.push(v1Shape.id)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.warn('parent does not exist', v1Shape)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// First, try to find the shape's parent among the existing groups\n\t\t\t\t\tconst parentId = v1PageIdsToV2PageIds.get(v1Page.id)!\n\n\t\t\t\t\tconst inCommon = {\n\t\t\t\t\t\tid: shapeId,\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t\tx: coerceNumber(v1Shape.point[0]),\n\t\t\t\t\t\ty: coerceNumber(v1Shape.point[1]),\n\t\t\t\t\t\trotation: 0,\n\t\t\t\t\t\tisLocked: !!v1Shape.isLocked,\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (v1Shape.type) {\n\t\t\t\t\t\tcase TDShapeType.Sticky: {\n\t\t\t\t\t\t\teditor.createShapes<TLNoteShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'note',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\ttext: v1Shape.text ?? '',\n\t\t\t\t\t\t\t\t\t\tcolor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tsize: getV2Size(v1Shape.style.size),\n\t\t\t\t\t\t\t\t\t\tfont: getV2Font(v1Shape.style.font),\n\t\t\t\t\t\t\t\t\t\talign: getV2Align(v1Shape.style.textAlign),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase TDShapeType.Rectangle: {\n\t\t\t\t\t\t\teditor.createShapes<TLGeoShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tgeo: 'rectangle',\n\t\t\t\t\t\t\t\t\t\tw: coerceDimension(v1Shape.size[0]),\n\t\t\t\t\t\t\t\t\t\th: coerceDimension(v1Shape.size[1]),\n\t\t\t\t\t\t\t\t\t\ttext: v1Shape.label ?? '',\n\t\t\t\t\t\t\t\t\t\tfill: getV2Fill(v1Shape.style.isFilled, v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tlabelColor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tcolor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tsize: getV2Size(v1Shape.style.size),\n\t\t\t\t\t\t\t\t\t\tfont: getV2Font(v1Shape.style.font),\n\t\t\t\t\t\t\t\t\t\tdash: getV2Dash(v1Shape.style.dash),\n\t\t\t\t\t\t\t\t\t\talign: 'middle',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\n\t\t\t\t\t\t\tconst pageBoundsBeforeLabel = editor.getShapePageBounds(inCommon.id)!\n\n\t\t\t\t\t\t\teditor.updateShapes([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid: inCommon.id,\n\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\ttext: v1Shape.label ?? '',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\n\t\t\t\t\t\t\tif (pageBoundsBeforeLabel.width === pageBoundsBeforeLabel.height) {\n\t\t\t\t\t\t\t\tconst shape = editor.getShape<TLGeoShape>(inCommon.id)!\n\t\t\t\t\t\t\t\tconst { growY } = shape.props\n\t\t\t\t\t\t\t\tconst w = coerceDimension(shape.props.w)\n\t\t\t\t\t\t\t\tconst h = coerceDimension(shape.props.h)\n\t\t\t\t\t\t\t\tconst newW = w + growY / 2\n\t\t\t\t\t\t\t\tconst newH = h + growY / 2\n\n\t\t\t\t\t\t\t\teditor.updateShapes([\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: inCommon.id,\n\t\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\t\tx: coerceNumber(shape.x) - (newW - w) / 2,\n\t\t\t\t\t\t\t\t\t\ty: coerceNumber(shape.y) - (newH - h) / 2,\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tw: newW,\n\t\t\t\t\t\t\t\t\t\t\th: newH,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase TDShapeType.Triangle: {\n\t\t\t\t\t\t\teditor.createShapes<TLGeoShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tgeo: 'triangle',\n\t\t\t\t\t\t\t\t\t\tw: coerceDimension(v1Shape.size[0]),\n\t\t\t\t\t\t\t\t\t\th: coerceDimension(v1Shape.size[1]),\n\t\t\t\t\t\t\t\t\t\tfill: getV2Fill(v1Shape.style.isFilled, v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tlabelColor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tcolor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tsize: getV2Size(v1Shape.style.size),\n\t\t\t\t\t\t\t\t\t\tfont: getV2Font(v1Shape.style.font),\n\t\t\t\t\t\t\t\t\t\tdash: getV2Dash(v1Shape.style.dash),\n\t\t\t\t\t\t\t\t\t\talign: 'middle',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\n\t\t\t\t\t\t\tconst pageBoundsBeforeLabel = editor.getShapePageBounds(inCommon.id)!\n\n\t\t\t\t\t\t\teditor.updateShapes([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid: inCommon.id,\n\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\ttext: v1Shape.label ?? '',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\n\t\t\t\t\t\t\tif (pageBoundsBeforeLabel.width === pageBoundsBeforeLabel.height) {\n\t\t\t\t\t\t\t\tconst shape = editor.getShape<TLGeoShape>(inCommon.id)!\n\t\t\t\t\t\t\t\tconst { growY } = shape.props\n\t\t\t\t\t\t\t\tconst w = coerceDimension(shape.props.w)\n\t\t\t\t\t\t\t\tconst h = coerceDimension(shape.props.h)\n\t\t\t\t\t\t\t\tconst newW = w + growY / 2\n\t\t\t\t\t\t\t\tconst newH = h + growY / 2\n\n\t\t\t\t\t\t\t\teditor.updateShapes([\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: inCommon.id,\n\t\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\t\tx: coerceNumber(shape.x) - (newW - w) / 2,\n\t\t\t\t\t\t\t\t\t\ty: coerceNumber(shape.y) - (newH - h) / 2,\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tw: newW,\n\t\t\t\t\t\t\t\t\t\t\th: newH,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase TDShapeType.Ellipse: {\n\t\t\t\t\t\t\teditor.createShapes<TLGeoShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tgeo: 'ellipse',\n\t\t\t\t\t\t\t\t\t\tw: coerceDimension(v1Shape.radius[0]) * 2,\n\t\t\t\t\t\t\t\t\t\th: coerceDimension(v1Shape.radius[1]) * 2,\n\t\t\t\t\t\t\t\t\t\tfill: getV2Fill(v1Shape.style.isFilled, v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tlabelColor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tcolor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tsize: getV2Size(v1Shape.style.size),\n\t\t\t\t\t\t\t\t\t\tfont: getV2Font(v1Shape.style.font),\n\t\t\t\t\t\t\t\t\t\tdash: getV2Dash(v1Shape.style.dash),\n\t\t\t\t\t\t\t\t\t\talign: 'middle',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\n\t\t\t\t\t\t\tconst pageBoundsBeforeLabel = editor.getShapePageBounds(inCommon.id)!\n\n\t\t\t\t\t\t\teditor.updateShapes([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid: inCommon.id,\n\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\ttext: v1Shape.label ?? '',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\n\t\t\t\t\t\t\tif (pageBoundsBeforeLabel.width === pageBoundsBeforeLabel.height) {\n\t\t\t\t\t\t\t\tconst shape = editor.getShape<TLGeoShape>(inCommon.id)!\n\t\t\t\t\t\t\t\tconst { growY } = shape.props\n\t\t\t\t\t\t\t\tconst w = coerceDimension(shape.props.w)\n\t\t\t\t\t\t\t\tconst h = coerceDimension(shape.props.h)\n\t\t\t\t\t\t\t\tconst newW = w + growY / 2\n\t\t\t\t\t\t\t\tconst newH = h + growY / 2\n\n\t\t\t\t\t\t\t\teditor.updateShapes([\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: inCommon.id,\n\t\t\t\t\t\t\t\t\t\ttype: 'geo',\n\t\t\t\t\t\t\t\t\t\tx: coerceNumber(shape.x) - (newW - w) / 2,\n\t\t\t\t\t\t\t\t\t\ty: coerceNumber(shape.y) - (newH - h) / 2,\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tw: newW,\n\t\t\t\t\t\t\t\t\t\t\th: newH,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase TDShapeType.Draw: {\n\t\t\t\t\t\t\tif (v1Shape.points.length === 0) {\n\t\t\t\t\t\t\t\tdecideNotToCreateShape(v1Shape)\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\teditor.createShapes<TLDrawShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'draw',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tfill: getV2Fill(v1Shape.style.isFilled, v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tcolor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tsize: getV2Size(v1Shape.style.size),\n\t\t\t\t\t\t\t\t\t\tdash: getV2Dash(v1Shape.style.dash),\n\t\t\t\t\t\t\t\t\t\tisPen: false,\n\t\t\t\t\t\t\t\t\t\tisComplete: v1Shape.isComplete,\n\t\t\t\t\t\t\t\t\t\tsegments: [{ type: 'free', points: v1Shape.points.map(getV2Point) }],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase TDShapeType.Arrow: {\n\t\t\t\t\t\t\tconst v1Bend = coerceNumber(v1Shape.bend)\n\t\t\t\t\t\t\tconst v1Start = getV2Point(v1Shape.handles.start.point)\n\t\t\t\t\t\t\tconst v1End = getV2Point(v1Shape.handles.end.point)\n\t\t\t\t\t\t\tconst dist = Vec.Dist(v1Start, v1End)\n\t\t\t\t\t\t\tconst v2Bend = (dist * -v1Bend) / 2\n\n\t\t\t\t\t\t\t// Could also be a line... but we'll use it as an arrow anyway\n\t\t\t\t\t\t\teditor.createShapes<TLArrowShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'arrow',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\ttext: v1Shape.label ?? '',\n\t\t\t\t\t\t\t\t\t\tcolor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tlabelColor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tsize: getV2Size(v1Shape.style.size),\n\t\t\t\t\t\t\t\t\t\tfont: getV2Font(v1Shape.style.font),\n\t\t\t\t\t\t\t\t\t\tdash: getV2Dash(v1Shape.style.dash),\n\t\t\t\t\t\t\t\t\t\tarrowheadStart: getV2Arrowhead(v1Shape.decorations?.start),\n\t\t\t\t\t\t\t\t\t\tarrowheadEnd: getV2Arrowhead(v1Shape.decorations?.end),\n\t\t\t\t\t\t\t\t\t\tstart: {\n\t\t\t\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\t\t\t\tx: coerceNumber(v1Shape.handles.start.point[0]),\n\t\t\t\t\t\t\t\t\t\t\ty: coerceNumber(v1Shape.handles.start.point[1]),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tend: {\n\t\t\t\t\t\t\t\t\t\t\ttype: 'point',\n\t\t\t\t\t\t\t\t\t\t\tx: coerceNumber(v1Shape.handles.end.point[0]),\n\t\t\t\t\t\t\t\t\t\t\ty: coerceNumber(v1Shape.handles.end.point[1]),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tbend: v2Bend,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase TDShapeType.Text: {\n\t\t\t\t\t\t\teditor.createShapes<TLTextShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\ttext: v1Shape.text ?? ' ',\n\t\t\t\t\t\t\t\t\t\tcolor: getV2Color(v1Shape.style.color),\n\t\t\t\t\t\t\t\t\t\tsize: getV2TextSize(v1Shape.style.size),\n\t\t\t\t\t\t\t\t\t\tfont: getV2Font(v1Shape.style.font),\n\t\t\t\t\t\t\t\t\t\talign: getV2Align(v1Shape.style.textAlign),\n\t\t\t\t\t\t\t\t\t\tscale: v1Shape.style.scale ?? 1,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase TDShapeType.Image: {\n\t\t\t\t\t\t\tconst assetId = v1AssetIdsToV2AssetIds.get(v1Shape.assetId)\n\n\t\t\t\t\t\t\tif (!assetId) {\n\t\t\t\t\t\t\t\tconsole.warn('Could not find asset id', v1Shape.assetId)\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\teditor.createShapes<TLImageShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tw: coerceDimension(v1Shape.size[0]),\n\t\t\t\t\t\t\t\t\t\th: coerceDimension(v1Shape.size[1]),\n\t\t\t\t\t\t\t\t\t\tassetId,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase TDShapeType.Video: {\n\t\t\t\t\t\t\tconst assetId = v1AssetIdsToV2AssetIds.get(v1Shape.assetId)\n\n\t\t\t\t\t\t\tif (!assetId) {\n\t\t\t\t\t\t\t\tconsole.warn('Could not find asset id', v1Shape.assetId)\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\teditor.createShapes<TLVideoShape>([\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...inCommon,\n\t\t\t\t\t\t\t\t\ttype: 'video',\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tw: coerceDimension(v1Shape.size[0]),\n\t\t\t\t\t\t\t\t\t\th: coerceDimension(v1Shape.size[1]),\n\t\t\t\t\t\t\t\t\t\tassetId,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst rotation = coerceNumber(v1Shape.rotation)\n\n\t\t\t\t\tif (rotation !== 0) {\n\t\t\t\t\t\teditor.select(shapeId)\n\t\t\t\t\t\teditor.rotateShapesBy([shapeId], rotation)\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\t// Create groups\n\t\t\t\tv1GroupShapeIdsToV1ChildIds.forEach((v1ChildIds, v1GroupId) => {\n\t\t\t\t\tconst v2ChildShapeIds = v1ChildIds.map((id) => v1ShapeIdsToV2ShapeIds.get(id)!)\n\t\t\t\t\tconst v2GroupId = v1ShapeIdsToV2ShapeIds.get(v1GroupId)!\n\t\t\t\t\teditor.groupShapes(v2ChildShapeIds, v2GroupId)\n\n\t\t\t\t\tconst v1Group = v1Page.shapes[v1GroupId]\n\t\t\t\t\tconst rotation = coerceNumber(v1Group.rotation)\n\n\t\t\t\t\tif (rotation !== 0) {\n\t\t\t\t\t\teditor.select(v2GroupId)\n\t\t\t\t\t\teditor.rotateShapesBy([v2GroupId], rotation)\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\t// Bind arrows to shapes\n\n\t\t\t\tv1Shapes.forEach((v1Shape) => {\n\t\t\t\t\tif (v1Shape.type !== TDShapeType.Arrow) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tconst v2ShapeId = v1ShapeIdsToV2ShapeIds.get(v1Shape.id)!\n\t\t\t\t\tconst util = editor.getShapeUtil<TLArrowShape>('arrow')\n\n\t\t\t\t\t// dumb but necessary\n\t\t\t\t\teditor.inputs.ctrlKey = false\n\n\t\t\t\t\tfor (const handleId of ['start', 'end'] as const) {\n\t\t\t\t\t\tconst bindingId = v1Shape.handles[handleId].bindingId\n\t\t\t\t\t\tif (bindingId) {\n\t\t\t\t\t\t\tconst binding = v1Page.bindings[bindingId]\n\t\t\t\t\t\t\tif (!binding) {\n\t\t\t\t\t\t\t\t// arrow has a reference to a binding that no longer exists\n\t\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst targetId = v1ShapeIdsToV2ShapeIds.get(binding.toId)!\n\n\t\t\t\t\t\t\tconst targetShape = editor.getShape(targetId)!\n\n\t\t\t\t\t\t\t// (unexpected) We didn't create the target shape\n\t\t\t\t\t\t\tif (!targetShape) continue\n\n\t\t\t\t\t\t\tif (targetId) {\n\t\t\t\t\t\t\t\tconst bounds = editor.getShapePageBounds(targetId)!\n\n\t\t\t\t\t\t\t\tconst v2ShapeFresh = editor.getShape<TLArrowShape>(v2ShapeId)!\n\n\t\t\t\t\t\t\t\tconst nx = clamp((coerceNumber(binding.point[0]) + 0.5) / 2, 0.2, 0.8)\n\t\t\t\t\t\t\t\tconst ny = clamp((coerceNumber(binding.point[1]) + 0.5) / 2, 0.2, 0.8)\n\n\t\t\t\t\t\t\t\tconst point = editor.getPointInShapeSpace(v2ShapeFresh, {\n\t\t\t\t\t\t\t\t\tx: bounds.minX + bounds.width * nx,\n\t\t\t\t\t\t\t\t\ty: bounds.minY + bounds.height * ny,\n\t\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\t\tconst handles = editor.getShapeHandles(v2ShapeFresh)!\n\t\t\t\t\t\t\t\tconst change = util.onHandleDrag!(v2ShapeFresh, {\n\t\t\t\t\t\t\t\t\thandle: {\n\t\t\t\t\t\t\t\t\t\t...handles.find((h) => h.id === handleId)!,\n\t\t\t\t\t\t\t\t\t\tx: point.x,\n\t\t\t\t\t\t\t\t\t\ty: point.y,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tisPrecise: point.x !== 0.5 || point.y !== 0.5,\n\t\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\t\tif (change) {\n\t\t\t\t\t\t\t\t\tif (change.props?.[handleId]) {\n\t\t\t\t\t\t\t\t\t\tconst terminal = change.props?.[handleId] as TLArrowShapeTerminal\n\t\t\t\t\t\t\t\t\t\tif (terminal.type === 'binding') {\n\t\t\t\t\t\t\t\t\t\t\tterminal.isExact = binding.distance === 0\n\n\t\t\t\t\t\t\t\t\t\t\tif (terminal.boundShapeId !== targetId) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.warn('Hit the wrong shape!')\n\t\t\t\t\t\t\t\t\t\t\t\tterminal.boundShapeId = targetId\n\t\t\t\t\t\t\t\t\t\t\t\tterminal.normalizedAnchor = { x: 0.5, y: 0.5 }\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\teditor.updateShapes([change])\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\n\t\t// Set the current page to the first page again\n\t\teditor.setCurrentPage(firstPageId)\n\n\t\teditor.history.clear()\n\t\teditor.selectNone()\n\n\t\tconst bounds = editor.getCurrentPageBounds()\n\t\tif (bounds) {\n\t\t\teditor.zoomToBounds(bounds, { targetZoom: 1 })\n\t\t}\n\t})\n}\n\nfunction coerceNumber(n: unknown): number {\n\tif (typeof n !== 'number') return 0\n\tif (Number.isNaN(n)) return 0\n\tif (!Number.isFinite(n)) return 0\n\treturn n\n}\n\nfunction coerceDimension(d: unknown): number {\n\tconst n = coerceNumber(d)\n\tif (n <= 0) return 1\n\treturn n\n}\n\n/**\n * We want to move assets over to our new S3 bucket & extract any relevant metadata. That process is\n * async though, where the rest of our migration is synchronous.\n *\n * We'll write placeholder assets to the app using the old asset URLs, then kick off a process async\n * to try and download the real assets, extract the metadata, and upload them to our new bucket.\n * It's not a big deal if this fails though.\n */\nasync function tryMigrateAsset(editor: Editor, placeholderAsset: TLAsset) {\n\ttry {\n\t\tif (placeholderAsset.type === 'bookmark' || !placeholderAsset.props.src) return\n\n\t\tconst response = await fetch(placeholderAsset.props.src)\n\t\tif (!response.ok) return\n\n\t\tconst file = new File([await response.blob()], placeholderAsset.props.name, {\n\t\t\ttype: response.headers.get('content-type') ?? placeholderAsset.props.mimeType ?? undefined,\n\t\t})\n\n\t\tconst newAsset = await editor.getAssetForExternalContent({ type: 'file', file })\n\t\tif (!newAsset) throw new Error('Could not get asset for external content')\n\t\tif (newAsset.type === 'bookmark') return\n\n\t\teditor.updateAssets([\n\t\t\t{\n\t\t\t\tid: placeholderAsset.id,\n\t\t\t\ttype: placeholderAsset.type,\n\t\t\t\tprops: {\n\t\t\t\t\t...newAsset.props,\n\t\t\t\t\tname: placeholderAsset.props.name,\n\t\t\t\t},\n\t\t\t},\n\t\t])\n\t} catch (err) {\n\t\t// not a big deal, we'll just keep the placeholder asset\n\t}\n}\n\nfunction migrate(document: LegacyTldrawDocument, newVersion: number): LegacyTldrawDocument {\n\tconst { version = 0 } = document\n\n\tif (!document.assets) {\n\t\tdocument.assets = {}\n\t}\n\n\t// Remove unused assets when loading a document\n\tconst assetIdsInUse = new Set<string>()\n\n\tObject.values(document.pages).forEach((page) =>\n\t\tObject.values(page.shapes).forEach((shape) => {\n\t\t\tconst { parentId, children, assetId } = shape\n\n\t\t\tif (assetId) {\n\t\t\t\tassetIdsInUse.add(assetId)\n\t\t\t}\n\n\t\t\t// Fix missing parent bug\n\t\t\tif (parentId !== page.id && !page.shapes[parentId]) {\n\t\t\t\tconsole.warn('Encountered a shape with a missing parent!')\n\t\t\t\tshape.parentId = page.id\n\t\t\t}\n\n\t\t\tif (shape.type === TDShapeType.Group && children) {\n\t\t\t\tchildren.forEach((childId) => {\n\t\t\t\t\tif (!page.shapes[childId]) {\n\t\t\t\t\t\tconsole.warn('Encountered a parent with a missing child!', shape.id, childId)\n\t\t\t\t\t\tchildren?.splice(children.indexOf(childId), 1)\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\t// TODO: Remove the shape if it has no children\n\t\t\t}\n\t\t})\n\t)\n\n\tObject.keys(document.assets).forEach((assetId) => {\n\t\tif (!assetIdsInUse.has(assetId)) {\n\t\t\tdelete document.assets[assetId]\n\t\t}\n\t})\n\n\tif (version !== newVersion) {\n\t\tif (version < 14) {\n\t\t\tObject.values(document.pages).forEach((page) => {\n\t\t\t\tObject.values(page.shapes)\n\t\t\t\t\t.filter((shape) => shape.type === TDShapeType.Text)\n\t\t\t\t\t.forEach((shape) => {\n\t\t\t\t\t\tif ((shape as TextShape).style.font === undefined) {\n\t\t\t\t\t\t\t;(shape as TextShape).style.font === FontStyle.Script\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t\t// Lowercase styles, move binding meta to binding\n\t\tif (version <= 13) {\n\t\t\tObject.values(document.pages).forEach((page) => {\n\t\t\t\tObject.values(page.bindings).forEach((binding) => {\n\t\t\t\t\tObject.assign(binding, (binding as any).meta)\n\t\t\t\t})\n\n\t\t\t\tObject.values(page.shapes).forEach((shape) => {\n\t\t\t\t\tObject.entries(shape.style).forEach(([id, style]) => {\n\t\t\t\t\t\tif (typeof style === 'string') {\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\tshape.style[id] = style.toLowerCase()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\n\t\t\t\t\tif (shape.type === TDShapeType.Arrow) {\n\t\t\t\t\t\tif (shape.decorations) {\n\t\t\t\t\t\t\tObject.entries(shape.decorations).forEach(([id, decoration]) => {\n\t\t\t\t\t\t\t\tif ((decoration as unknown) === 'Arrow') {\n\t\t\t\t\t\t\t\t\tshape.decorations = {\n\t\t\t\t\t\t\t\t\t\t...shape.decorations,\n\t\t\t\t\t\t\t\t\t\t[id]: Decoration.Arrow,\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t\t// Add document name and file system handle\n\t\tif (version <= 13.1 && document.name == null) {\n\t\t\tdocument.name = 'New Document'\n\t\t}\n\n\t\tif (version < 15 && document.assets == null) {\n\t\t\tdocument.assets = {}\n\t\t}\n\n\t\tObject.values(document.pages).forEach((page) => {\n\t\t\tObject.values(page.shapes).forEach((shape) => {\n\t\t\t\tif (version < 15.2) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(shape.type === TDShapeType.Image || shape.type === TDShapeType.Video) &&\n\t\t\t\t\t\tshape.style.isFilled == null\n\t\t\t\t\t) {\n\t\t\t\t\t\tshape.style.isFilled = true\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (version < 15.3) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tshape.type === TDShapeType.Rectangle ||\n\t\t\t\t\t\tshape.type === TDShapeType.Triangle ||\n\t\t\t\t\t\tshape.type === TDShapeType.Ellipse ||\n\t\t\t\t\t\tshape.type === TDShapeType.Arrow\n\t\t\t\t\t) {\n\t\t\t\t\t\tif ('text' in shape && typeof shape.text === 'string') {\n\t\t\t\t\t\t\tshape.label = shape.text\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!shape.label) {\n\t\t\t\t\t\t\tshape.label = ''\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!shape.labelPoint) {\n\t\t\t\t\t\t\tshape.labelPoint = [0.5, 0.5]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\t// Cleanup\n\tObject.values(document.pageStates).forEach((pageState) => {\n\t\tpageState.selectedIds = pageState.selectedIds.filter((id) => {\n\t\t\treturn document.pages[pageState.id].shapes[id] !== undefined\n\t\t})\n\t\tpageState.bindingId = undefined\n\t\tpageState.editingId = undefined\n\t\tpageState.hoveredId = undefined\n\t\tpageState.pointedId = undefined\n\t})\n\n\tdocument.version = newVersion\n\n\treturn document\n}\n\n/* -------------------- TLV1 Types -------------------- */\n\ninterface TLV1Handle {\n\tid: string\n\tindex: number\n\tpoint: number[]\n}\n\ninterface TLV1Binding {\n\tid: string\n\ttoId: string\n\tfromId: string\n}\n\ninterface TLV1Shape {\n\tid: string\n\ttype: string\n\tparentId: string\n\tchildIndex: number\n\tname: string\n\tpoint: number[]\n\tassetId?: string\n\trotation?: number\n\tchildren?: string[]\n\thandles?: Record<string, TLV1Handle>\n\tisGhost?: boolean\n\tisHidden?: boolean\n\tisLocked?: boolean\n\tisGenerated?: boolean\n\tisAspectRatioLocked?: boolean\n}\n\nenum TDShapeType {\n\tSticky = 'sticky',\n\tEllipse = 'ellipse',\n\tRectangle = 'rectangle',\n\tTriangle = 'triangle',\n\tDraw = 'draw',\n\tArrow = 'arrow',\n\tText = 'text',\n\tGroup = 'group',\n\tImage = 'image',\n\tVideo = 'video',\n}\n\nenum ColorStyle {\n\tWhite = 'white',\n\tLightGray = 'lightGray',\n\tGray = 'gray',\n\tBlack = 'black',\n\tGreen = 'green',\n\tCyan = 'cyan',\n\tBlue = 'blue',\n\tIndigo = 'indigo',\n\tViolet = 'violet',\n\tRed = 'red',\n\tOrange = 'orange',\n\tYellow = 'yellow',\n}\n\nenum SizeStyle {\n\tSmall = 'small',\n\tMedium = 'medium',\n\tLarge = 'large',\n}\n\nenum DashStyle {\n\tDraw = 'draw',\n\tSolid = 'solid',\n\tDashed = 'dashed',\n\tDotted = 'dotted',\n}\n\nenum AlignStyle {\n\tStart = 'start',\n\tMiddle = 'middle',\n\tEnd = 'end',\n\tJustify = 'justify',\n}\n\nenum FontStyle {\n\tScript = 'script',\n\tSans = 'sans',\n\tSerif = 'serif',\n\tMono = 'mono',\n}\n\ntype ShapeStyles = {\n\tcolor: ColorStyle\n\tsize: SizeStyle\n\tdash: DashStyle\n\tfont?: FontStyle\n\ttextAlign?: AlignStyle\n\tisFilled?: boolean\n\tscale?: number\n}\n\ninterface TDBaseShape extends TLV1Shape {\n\tstyle: ShapeStyles\n\ttype: TDShapeType\n\tlabel?: string\n\thandles?: Record<string, TDHandle>\n}\n\ninterface DrawShape extends TDBaseShape {\n\ttype: TDShapeType.Draw\n\tpoints: number[][]\n\tisComplete: boolean\n}\n\n// The extended handle (used for arrows)\ninterface TDHandle extends TLV1Handle {\n\tcanBind?: boolean\n\tbindingId?: string\n}\n\ninterface RectangleShape extends TDBaseShape {\n\ttype: TDShapeType.Rectangle\n\tsize: number[]\n\tlabel?: string\n\tlabelPoint?: number[]\n}\n\ninterface EllipseShape extends TDBaseShape {\n\ttype: TDShapeType.Ellipse\n\tradius: number[]\n\tlabel?: string\n\tlabelPoint?: number[]\n}\n\ninterface TriangleShape extends TDBaseShape {\n\ttype: TDShapeType.Triangle\n\tsize: number[]\n\tlabel?: string\n\tlabelPoint?: number[]\n}\n\nenum Decoration {\n\tArrow = 'arrow',\n}\n\n// The shape created with the arrow tool\ninterface ArrowShape extends TDBaseShape {\n\ttype: TDShapeType.Arrow\n\tbend: number\n\thandles: {\n\t\tstart: TDHandle\n\t\tbend: TDHandle\n\t\tend: TDHandle\n\t}\n\tdecorations?: {\n\t\tstart?: Decoration\n\t\tend?: Decoration\n\t\tmiddle?: Decoration\n\t}\n\tlabel?: string\n\tlabelPoint?: number[]\n}\n\ninterface ArrowBinding extends TLV1Binding {\n\thandleId: keyof ArrowShape['handles']\n\tdistance: number\n\tpoint: number[]\n}\n\ntype TDBinding = ArrowBinding\n\ninterface ImageShape extends TDBaseShape {\n\ttype: TDShapeType.Image\n\tsize: number[]\n\tassetId: string\n}\n\ninterface VideoShape extends TDBaseShape {\n\ttype: TDShapeType.Video\n\tsize: number[]\n\tassetId: string\n\tisPlaying: boolean\n\tcurrentTime: number\n}\n\n// The shape created by the text tool\ninterface TextShape extends TDBaseShape {\n\ttype: TDShapeType.Text\n\ttext: string\n}\n\n// The shape created by the sticky tool\ninterface StickyShape extends TDBaseShape {\n\ttype: TDShapeType.Sticky\n\tsize: number[]\n\ttext: string\n}\n\n// The shape created when multiple shapes are grouped\ninterface GroupShape extends TDBaseShape {\n\ttype: TDShapeType.Group\n\tsize: number[]\n\tchildren: string[]\n}\n\ntype TDShape =\n\t| RectangleShape\n\t| EllipseShape\n\t| TriangleShape\n\t| DrawShape\n\t| ArrowShape\n\t| TextShape\n\t| GroupShape\n\t| StickyShape\n\t| ImageShape\n\t| VideoShape\n\ntype TDPage = {\n\tid: string\n\tname?: string\n\tchildIndex?: number\n\tshapes: Record<string, TDShape>\n\tbindings: Record<string, TDBinding>\n}\n\ninterface TLV1Bounds {\n\tminX: number\n\tminY: number\n\tmaxX: number\n\tmaxY: number\n\twidth: number\n\theight: number\n\trotation?: number\n}\n\ninterface TLV1PageState {\n\tid: string\n\tselectedIds: string[]\n\tcamera: {\n\t\tpoint: number[]\n\t\tzoom: number\n\t}\n\tbrush?: TLV1Bounds | null\n\tpointedId?: string | null\n\thoveredId?: string | null\n\teditingId?: string | null\n\tbindingId?: string | null\n}\n\nenum TDAssetType {\n\tImage = 'image',\n\tVideo = 'video',\n}\n\ninterface TDImageAsset extends TLV1Asset {\n\ttype: TDAssetType.Image\n\tfileName: string\n\tsrc: string\n\tsize: number[]\n}\n\ninterface TDVideoAsset extends TLV1Asset {\n\ttype: TDAssetType.Video\n\tfileName: string\n\tsrc: string\n\tsize: number[]\n}\n\ninterface TLV1Asset {\n\tid: string\n\ttype: string\n}\n\ntype TDAsset = TDImageAsset | TDVideoAsset\n\ntype TDAssets = Record<string, TDAsset>\n\n/** @internal */\nexport interface LegacyTldrawDocument {\n\tid: string\n\tname: string\n\tversion: number\n\tpages: Record<string, TDPage>\n\tpageStates: Record<string, TLV1PageState>\n\tassets: TDAssets\n}\n\n/* ------------------ Translations ------------------ */\n\nconst v1ColorsToV2Colors: Record<ColorStyle, TLDefaultColorStyle> = {\n\t[ColorStyle.White]: 'black',\n\t[ColorStyle.Black]: 'black',\n\t[ColorStyle.LightGray]: 'grey',\n\t[ColorStyle.Gray]: 'grey',\n\t[ColorStyle.Green]: 'light-green',\n\t[ColorStyle.Cyan]: 'green',\n\t[ColorStyle.Blue]: 'light-blue',\n\t[ColorStyle.Indigo]: 'blue',\n\t[ColorStyle.Orange]: 'orange',\n\t[ColorStyle.Yellow]: 'yellow',\n\t[ColorStyle.Red]: 'red',\n\t[ColorStyle.Violet]: 'light-violet',\n}\n\nconst v1FontsToV2Fonts: Record<FontStyle, TLDefaultFontStyle> = {\n\t[FontStyle.Mono]: 'mono',\n\t[FontStyle.Sans]: 'sans',\n\t[FontStyle.Script]: 'draw',\n\t[FontStyle.Serif]: 'serif',\n}\n\nconst v1AlignsToV2Aligns: Record<AlignStyle, TLDefaultHorizontalAlignStyle> = {\n\t[AlignStyle.Start]: 'start',\n\t[AlignStyle.Middle]: 'middle',\n\t[AlignStyle.End]: 'end',\n\t[AlignStyle.Justify]: 'start',\n}\n\nconst v1TextSizesToV2TextSizes: Record<SizeStyle, TLDefaultSizeStyle> = {\n\t[SizeStyle.Small]: 's',\n\t[SizeStyle.Medium]: 'l',\n\t[SizeStyle.Large]: 'xl',\n}\n\nconst v1SizesToV2Sizes: Record<SizeStyle, TLDefaultSizeStyle> = {\n\t[SizeStyle.Small]: 'm',\n\t[SizeStyle.Medium]: 'l',\n\t[SizeStyle.Large]: 'xl',\n}\n\nconst v1DashesToV2Dashes: Record<DashStyle, TLDefaultDashStyle> = {\n\t[DashStyle.Solid]: 'solid',\n\t[DashStyle.Dashed]: 'dashed',\n\t[DashStyle.Dotted]: 'dotted',\n\t[DashStyle.Draw]: 'draw',\n}\n\nfunction getV2Color(color: ColorStyle | undefined): TLDefaultColorStyle {\n\treturn color ? v1ColorsToV2Colors[color] ?? 'black' : 'black'\n}\n\nfunction getV2Font(font: FontStyle | undefined): TLDefaultFontStyle {\n\treturn font ? v1FontsToV2Fonts[font] ?? 'draw' : 'draw'\n}\n\nfunction getV2Align(align: AlignStyle | undefined): TLDefaultHorizontalAlignStyle {\n\treturn align ? v1AlignsToV2Aligns[align] ?? 'middle' : 'middle'\n}\n\nfunction getV2TextSize(size: SizeStyle | undefined): TLDefaultSizeStyle {\n\treturn size ? v1TextSizesToV2TextSizes[size] ?? 'm' : 'm'\n}\n\nfunction getV2Size(size: SizeStyle | undefined): TLDefaultSizeStyle {\n\treturn size ? v1SizesToV2Sizes[size] ?? 'l' : 'l'\n}\n\nfunction getV2Dash(dash: DashStyle | undefined): TLDefaultDashStyle {\n\treturn dash ? v1DashesToV2Dashes[dash] ?? 'draw' : 'draw'\n}\n\nfunction getV2Point(point: number[]): VecModel {\n\treturn {\n\t\tx: coerceNumber(point[0]),\n\t\ty: coerceNumber(point[1]),\n\t\tz: point[2] == null ? 0.5 : coerceNumber(point[2]),\n\t}\n}\n\nfunction getV2Arrowhead(decoration: Decoration | undefined): TLArrowShapeArrowheadStyle {\n\treturn decoration === Decoration.Arrow ? 'arrow' : 'none'\n}\n\nfunction getV2Fill(isFilled: boolean | undefined, color: ColorStyle) {\n\treturn isFilled\n\t\t? color === ColorStyle.Black || color === ColorStyle.White\n\t\t\t? 'semi'\n\t\t\t: 'solid'\n\t\t: 'none'\n}\n", "import {\n\tEditor,\n\tFileHelpers,\n\tMigrationFailureReason,\n\tMigrationResult,\n\tRecordId,\n\tResult,\n\tSerializedSchema,\n\tSerializedSchemaV1,\n\tSerializedSchemaV2,\n\tSerializedStore,\n\tT,\n\tTLAsset,\n\tTLAssetId,\n\tTLRecord,\n\tTLSchema,\n\tTLStore,\n\tUnknownRecord,\n\tcreateTLStore,\n\texhaustiveSwitchError,\n\tpartition,\n\ttransact,\n} from '@tldraw/editor'\nimport { TLUiToastsContextType } from '../../ui/context/toasts'\nimport { TLUiTranslationKey } from '../../ui/hooks/useTranslation/TLUiTranslationKey'\nimport { buildFromV1Document } from '../tldr/buildFromV1Document'\n\n/** @public */\nexport const TLDRAW_FILE_MIMETYPE = 'application/vnd.tldraw+json' as const\n\n/** @public */\nexport const TLDRAW_FILE_EXTENSION = '.tldr' as const\n\n// When incrementing this, you'll need to update parseTldrawJsonFile to handle\n// both your new changes and the old file format\nconst LATEST_TLDRAW_FILE_FORMAT_VERSION = 1\n\n/** @public */\nexport interface TldrawFile {\n\ttldrawFileFormatVersion: number\n\tschema: SerializedSchema\n\trecords: UnknownRecord[]\n}\n\nconst schemaV1 = T.object<SerializedSchemaV1>({\n\tschemaVersion: T.literal(1),\n\tstoreVersion: T.positiveInteger,\n\trecordVersions: T.dict(\n\t\tT.string,\n\t\tT.object({\n\t\t\tversion: T.positiveInteger,\n\t\t\tsubTypeVersions: T.dict(T.string, T.positiveInteger).optional(),\n\t\t\tsubTypeKey: T.string.optional(),\n\t\t})\n\t),\n})\n\nconst schemaV2 = T.object<SerializedSchemaV2>({\n\tschemaVersion: T.literal(2),\n\tsequences: T.dict(T.string, T.positiveInteger),\n})\n\nconst tldrawFileValidator: T.Validator<TldrawFile> = T.object({\n\ttldrawFileFormatVersion: T.nonZeroInteger,\n\tschema: T.numberUnion('schemaVersion', {\n\t\t1: schemaV1,\n\t\t2: schemaV2,\n\t}),\n\trecords: T.arrayOf(\n\t\tT.object({\n\t\t\tid: T.string as any as T.Validator<RecordId<any>>,\n\t\t\ttypeName: T.string,\n\t\t}).allowUnknownProperties()\n\t),\n})\n\n/** @public */\nexport function isV1File(data: any) {\n\ttry {\n\t\tif (data.document?.version) {\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t} catch (e) {\n\t\treturn false\n\t}\n}\n\n/** @public */\nexport type TldrawFileParseError =\n\t| { type: 'v1File'; data: any }\n\t| { type: 'notATldrawFile'; cause: unknown }\n\t| { type: 'fileFormatVersionTooNew'; version: number }\n\t| { type: 'migrationFailed'; reason: MigrationFailureReason }\n\t| { type: 'invalidRecords'; cause: unknown }\n\n/** @public */\nexport function parseTldrawJsonFile({\n\tjson,\n\tschema,\n}: {\n\tschema: TLSchema\n\tjson: string\n}): Result<TLStore, TldrawFileParseError> {\n\t// first off, we parse .json file and check it matches the general shape of\n\t// a tldraw file\n\tlet data\n\ttry {\n\t\tdata = tldrawFileValidator.validate(JSON.parse(json))\n\t} catch (e) {\n\t\t// could be a v1 file!\n\t\ttry {\n\t\t\tdata = JSON.parse(json)\n\t\t\tif (isV1File(data)) {\n\t\t\t\treturn Result.err({ type: 'v1File', data })\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// noop\n\t\t}\n\n\t\treturn Result.err({ type: 'notATldrawFile', cause: e })\n\t}\n\n\t// if the file format version isn't supported, we can't open it - it's\n\t// probably from a newer version of tldraw\n\tif (data.tldrawFileFormatVersion > LATEST_TLDRAW_FILE_FORMAT_VERSION) {\n\t\treturn Result.err({\n\t\t\ttype: 'fileFormatVersionTooNew',\n\t\t\tversion: data.tldrawFileFormatVersion,\n\t\t})\n\t}\n\n\t// even if the file version is up to date, it might contain old-format\n\t// records. lets create a store with the records and migrate it to the\n\t// latest version\n\tlet migrationResult: MigrationResult<SerializedStore<TLRecord>>\n\ttry {\n\t\tconst storeSnapshot = Object.fromEntries(data.records.map((r) => [r.id, r as TLRecord]))\n\t\tmigrationResult = schema.migrateStoreSnapshot({ store: storeSnapshot, schema: data.schema })\n\t} catch (e) {\n\t\t// junk data in the migration\n\t\treturn Result.err({ type: 'invalidRecords', cause: e })\n\t}\n\t// if the migration failed, we can't open the file\n\tif (migrationResult.type === 'error') {\n\t\treturn Result.err({ type: 'migrationFailed', reason: migrationResult.reason })\n\t}\n\n\t// at this stage, the store should have records at the latest versions, so\n\t// we should be able to validate them. if any of the records at this stage\n\t// are invalid, we don't open the file\n\ttry {\n\t\treturn Result.ok(\n\t\t\tcreateTLStore({\n\t\t\t\tinitialData: migrationResult.value,\n\t\t\t\tschema,\n\t\t\t})\n\t\t)\n\t} catch (e) {\n\t\t// junk data in the records (they're not validated yet!) could cause the\n\t\t// migrations to crash. We treat any throw from a migration as an\n\t\t// invalid record\n\t\treturn Result.err({ type: 'invalidRecords', cause: e })\n\t}\n}\n\n/** @public */\nexport async function serializeTldrawJson(store: TLStore): Promise<string> {\n\tconst records: TLRecord[] = []\n\tconst usedAssets = new Set<TLAssetId | null>()\n\tconst assets: TLAsset[] = []\n\tfor (const record of store.allRecords()) {\n\t\tswitch (record.typeName) {\n\t\t\tcase 'asset':\n\t\t\t\tif (\n\t\t\t\t\trecord.type !== 'bookmark' &&\n\t\t\t\t\trecord.props.src &&\n\t\t\t\t\t!record.props.src.startsWith('data:')\n\t\t\t\t) {\n\t\t\t\t\tlet assetSrcToSave\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// try to save the asset as a base64 string\n\t\t\t\t\t\tassetSrcToSave = await FileHelpers.blobToDataUrl(\n\t\t\t\t\t\t\tawait (await fetch(record.props.src)).blob()\n\t\t\t\t\t\t)\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t// if that fails, just save the original src\n\t\t\t\t\t\tassetSrcToSave = record.props.src\n\t\t\t\t\t}\n\n\t\t\t\t\tassets.push({\n\t\t\t\t\t\t...record,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t...record.props,\n\t\t\t\t\t\t\tsrc: assetSrcToSave,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tassets.push(record)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'shape':\n\t\t\t\tif ('assetId' in record.props) {\n\t\t\t\t\tusedAssets.add(record.props.assetId)\n\t\t\t\t}\n\t\t\t\trecords.push(record)\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\trecords.push(record)\n\t\t\t\tbreak\n\t\t}\n\t}\n\tconst recordsToSave = records.concat(assets.filter((a) => usedAssets.has(a.id)))\n\n\treturn JSON.stringify({\n\t\ttldrawFileFormatVersion: LATEST_TLDRAW_FILE_FORMAT_VERSION,\n\t\tschema: store.schema.serialize(),\n\t\trecords: recordsToSave,\n\t})\n}\n\n/** @public */\nexport async function serializeTldrawJsonBlob(store: TLStore): Promise<Blob> {\n\treturn new Blob([await serializeTldrawJson(store)], { type: TLDRAW_FILE_MIMETYPE })\n}\n\n/** @internal */\nexport async function parseAndLoadDocument(\n\teditor: Editor,\n\tdocument: string,\n\tmsg: (id: TLUiTranslationKey | Exclude<string, TLUiTranslationKey>) => string,\n\taddToast: TLUiToastsContextType['addToast'],\n\tonV1FileLoad?: () => void,\n\tforceDarkMode?: boolean\n) {\n\tconst parseFileResult = parseTldrawJsonFile({\n\t\tschema: editor.store.schema,\n\t\tjson: document,\n\t})\n\tif (!parseFileResult.ok) {\n\t\tlet description\n\t\tswitch (parseFileResult.error.type) {\n\t\t\tcase 'notATldrawFile':\n\t\t\t\teditor.annotateError(parseFileResult.error.cause, {\n\t\t\t\t\torigin: 'file-system.open.parse',\n\t\t\t\t\twillCrashApp: false,\n\t\t\t\t\ttags: { parseErrorType: parseFileResult.error.type },\n\t\t\t\t})\n\t\t\t\treportError(parseFileResult.error.cause)\n\t\t\t\tdescription = msg('file-system.file-open-error.not-a-tldraw-file')\n\t\t\t\tbreak\n\t\t\tcase 'fileFormatVersionTooNew':\n\t\t\t\tdescription = msg('file-system.file-open-error.file-format-version-too-new')\n\t\t\t\tbreak\n\t\t\tcase 'migrationFailed':\n\t\t\t\tif (parseFileResult.error.reason === MigrationFailureReason.TargetVersionTooNew) {\n\t\t\t\t\tdescription = msg('file-system.file-open-error.file-format-version-too-new')\n\t\t\t\t} else {\n\t\t\t\t\tdescription = msg('file-system.file-open-error.generic-corrupted-file')\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 'invalidRecords':\n\t\t\t\teditor.annotateError(parseFileResult.error.cause, {\n\t\t\t\t\torigin: 'file-system.open.parse',\n\t\t\t\t\twillCrashApp: false,\n\t\t\t\t\ttags: { parseErrorType: parseFileResult.error.type },\n\t\t\t\t})\n\t\t\t\treportError(parseFileResult.error.cause)\n\t\t\t\tdescription = msg('file-system.file-open-error.generic-corrupted-file')\n\t\t\t\tbreak\n\t\t\tcase 'v1File': {\n\t\t\t\tbuildFromV1Document(editor, parseFileResult.error.data.document)\n\t\t\t\tonV1FileLoad?.()\n\t\t\t\treturn\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\texhaustiveSwitchError(parseFileResult.error, 'type')\n\t\t}\n\t\taddToast({\n\t\t\ttitle: msg('file-system.file-open-error.title'),\n\t\t\tdescription,\n\t\t\tseverity: 'error',\n\t\t})\n\n\t\treturn\n\t}\n\n\t// tldraw file contain the full state of the app,\n\t// including ephemeral data. it up to the opener to\n\t// decide what to restore and what to retain. Here, we\n\t// just restore everything, so if the user has opened\n\t// this file before they'll get their camera etc.\n\t// restored. we could change this in the future.\n\ttransact(() => {\n\t\tconst initialBounds = editor.getViewportScreenBounds().clone()\n\t\tconst isFocused = editor.getInstanceState().isFocused\n\t\teditor.store.clear()\n\t\tconst [shapes, nonShapes] = partition(\n\t\t\tparseFileResult.value.allRecords(),\n\t\t\t(record) => record.typeName === 'shape'\n\t\t)\n\t\teditor.store.put(nonShapes, 'initialize')\n\t\teditor.store.ensureStoreIsUsable()\n\t\teditor.store.put(shapes, 'initialize')\n\t\teditor.history.clear()\n\t\t// Put the old bounds back in place\n\t\teditor.updateViewportScreenBounds(initialBounds)\n\t\teditor.updateRenderingBounds()\n\n\t\tconst bounds = editor.getCurrentPageBounds()\n\t\tif (bounds) {\n\t\t\teditor.zoomToBounds(bounds, { targetZoom: 1 })\n\t\t}\n\t\teditor.updateInstanceState({ isFocused })\n\t})\n\n\tif (forceDarkMode) editor.user.updateUserPreferences({ isDarkMode: true })\n}\n"],
  "mappings": "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D;EACD;AAEA,SAAO;AACR;AAGO,SAAS,sBAAsB,QAAyC;AAC9E,SAAO,iBAA0B,SAAS;IACzC,OAAO;IACP,WAAW,mBAAE;MACZ;MACA,mBAAE;QACD;QACA;UAAmB;UAAQ,CAAC,MAAM,EAAE,OAAO,KAAK,MAC/C,qBAAqB,MAAM,OAAO,IAAI;QACvC;MACD;IACD;EACD,CAAC,EAAE,sBAAsB,OAAO;IAC/B,GAAG;IACH,GAAG;IACH,UAAU;IACV,UAAU;IACV,SAAS;IACT,MAAM,CAAC;EACR,EAAE;AACH;;;ACpVA,IAAM,SAAS;EACd;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACD;AA4BO,IAAM,2BAGT;EACH,WAAW;IACV,IAAI;IACJ,MAAM;IACN,YAAY;IACZ,OAAO;IACP,OAAO;MACN,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,MAAM;MACL,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,OAAO;MACN,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,MAAM;MACL,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,cAAc;MACb,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,eAAe;MACd,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,aAAa;MACZ,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,gBAAgB;MACf,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,QAAQ;MACP,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,KAAK;MACJ,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,QAAQ;MACP,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,QAAQ;MACP,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,OAAO;MACN,OAAO;MACP,MAAM;MACN,SAAS;MACT,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;EACD;EACA,UAAU;IACT,IAAI;IACJ,MAAM;IACN,YAAY;IACZ,OAAO;IAEP,OAAO;MACN,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,MAAM;MACL,OAAO;;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,OAAO;MACN,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,MAAM;MACL,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,cAAc;MACb,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,eAAe;MACd,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,aAAa;MACZ,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,gBAAgB;MACf,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,QAAQ;MACP,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,KAAK;MACJ,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,QAAQ;MACP,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,QAAQ;MACP,OAAO;MACP,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,MAAM;MACN,SAAS;MACT,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;IACA,OAAO;MACN,OAAO;MACP,MAAM;MACN,SAAS;MACT,MAAM;QACL,MAAM;QACN,MAAM;MACP;MACA,WAAW;QACV,MAAM;QACN,IAAI;MACL;IACD;EACD;AACD;AAGO,SAAS,qBAAqB,MAAoD;AACxF,SAAO,KAAK,aAAa,yBAAyB,WAAW,yBAAyB;AACvF;AAGO,IA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;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACD;;;ACxUO,IAAI,qBAAoC;EAC9C,GAAG;EACH,OAAO,OAAO;IACb,UAAU,IAAI,CAAC,SAAS;MACvB;MACA,oCAAoC,OAAO,eAAe,IAAI;IAC/D,CAAC;EACF;EACA,cAAc,OAAO;IACpB,UAAU,IAAI,CAAC,SAAS;MACvB,KAAK;MACL,oCAAoC,OAAO,iBAAiB,KAAK,MAAM;IACxE,CAAC;EACF;EACA,YAAY,OAAO;IAClB,kBAAkB,IAAI,CAAC,QAAQ;MAC9B,IAAI;MACJ,oCAAoC,OAAO,gBAAgB,IAAI,IAAI;IACpE,CAAC;EACF;AACD;AAGO,SAAS,sBAAsB,MAAqB;AAC1D,uBAAqB;AACtB;AAGO,SAAS,mCACf,WACgB;AAChB,MAAI,CAAC;AAAW,WAAO;AAEvB,SAAO;IACN,OAAO,OAAO,OAAO,EAAE,GAAG,mBAAmB,MAAM,GAAG,EAAE,GAAG,uCAAW,MAAM,CAAC;IAC7E,OAAO,OAAO,OAAO,EAAE,GAAG,mBAAmB,MAAM,GAAG,EAAE,GAAG,uCAAW,MAAM,CAAC;IAC7E,YAAY,OAAO,OAAO,EAAE,GAAG,mBAAmB,WAAW,GAAG,EAAE,GAAG,uCAAW,WAAW,CAAC;IAC5F,cAAc,OAAO;MACpB,EAAE,GAAG,mBAAmB,aAAa;MACrC,EAAE,G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",
  "names": ["array", "index", "offset", "object", "hasOwnProperty", "Symbol", "Uint8Array", "DataView", "Map", "Promise", "Set", "WeakMap", "size", "stack", "othValue", "isEqual", "require_lodash", "debounce", "time", "result", "flush", "throttle", "require_lodash", "array", "index", "object", "hasOwnProperty", "Map", "Set", "computed", "noop", "uniq", "EventEmitter", "test", "call", "V", "call", "global", "global", "process", "version", "global", "V", "call", "global", "globalThis", "hasOwnProperty", "global", "Symbol", "call", "getMethod", "global", "document", "createElement", "call", "object", "global", "WeakMap", "global", "TypeError", "WeakMap", "number", "min", "index", "integer", "min", "index", "object", "ownKeys", "ownKeys", "string", "global", "index", "activeXDocument", "index", "global", "require_at", "test", "noop", "require_flat_map", "require_flat", "index", "require_at", "require_at", "global", "global", "global", "call", "string", "object", "call", "call", "size", "index", "call", "call", "getMethod", "min", "string", "global", "call", "call", "getMethod", "string", "require_replace_all", "LZString", "index", "global", "index", "offset", "frame", "options", "atom", "inst", "isUninitialized", "import_react", "React", "subscribe", "scheduler", "getSnapshot", "Component", "import_react", "import_react", "import_react", "import_react", "import_react", "offset", "equals", "min", "string", "crc", "index", "offset", "size", "t", "clamp", "object", "index", "ib", "fb", "ia", "fa", "i", "c", "last", "index", "size", "object", "index", "index", "atom", "remove", "isEqual", "object", "record", "atom", "isEqual", "t", "chunk", "version", "process", "MigrationFailureReason", "version", "object", "number", "key", "value", "error", "document", "sortByIndex", "Versions", "Versions", "nanoid", "size", "uniqueId", "nanoid", "result", "version", "Versions", "Versions", "Versions", "Versions", "index", "Versions", "Versions", "Versions", "Versions", "t", "import_jsx_runtime", "import_react", "import_classnames", "React", "import_jsx_runtime", "import_classnames", "import_react", "import_react", "React", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_jsx_runtime", "import_react", "import_react", "t", "V", "min", "t", "clamp", "min", "t", "import_jsx_runtime", "import_react", "import_react", "defaults", "env", "import_react", "import_jsx_runtime", "import_react", "import_react", "remove", "import_react", "clamp", "min", "t", "r", "string", "altKey", "noop", "rubberband", "memo", "offset", "import_react", "window", "remove", "Engine", "_handlers", "memo", "React", "useGesture", "_handlers", "React", "time", "offset", "React", "import_lodash", "import_react", "size", "V", "t", "container", "throttle", "model", "import_jsx_runtime", "import_react", "tick", "GeometryDebuggingView", "import_jsx_runtime", "import_react", "import_lodash", "array", "_uniq", "CollaboratorGuard", "Collaborator", "import_jsx_runtime", "import_react", "Shape", "index", "shape", "annotateError", "InnerShape", "InnerShapeBackground", "offset", "Component", "classNames", "handles", "Fragment", "import_jsx_runtime", "import_classnames", "import_react", "classNames", "import_jsx_runtime", "import_classnames", "import_react", "DefaultCursor", "classNames", "import_jsx_runtime", "size", "min", "import_jsx_runtime", "import_classnames", "fr", "index", "classNames", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "classNames", "import_jsx_runtime", "React", "import_jsx_runtime", "import_classnames", "import_react", "classNames", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "import_react", "DefaultShapeIndicator", "classNames", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "React", "import_jsx_runtime", "import_react", "isEqual", "noop", "classNames", "nanoid", "size", "nanoid", "Versions", "isTest", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "classNames", "import_jsx_runtime", "shape", "index", "arrow", "editor", "notVisibleShapes", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_react", "index", "_a", "_b", "stack", "annotateError", "next", "prev", "array", "index", "offset", "__decorateClass", "__decorateClass", "throttleToNextFrame", "frame", "__decorateClass", "size", "dAB", "u", "size", "t", "id", "initialState", "index", "cy", "arrow", "shape", "offset", "t", "highlightedUserIds", "notVisibleShapes", "filter", "distance", "ancestor", "ids", "min", "gap", "maxWidth", "last", "i", "animatingShapes", "n", "group", "__decorateClass", "import_react", "React", "import_react", "import_react", "import_react", "import_react", "window", "Versions", "object", "version", "target", "msg", "channel", "t", "data", "import_react", "React", "iOS", "React", "TldrawEditor", "React", "classNames", "initialState", "editor", "import_jsx_runtime", "import_classnames", "classNames", "maxWidth", "maxHeight", "offset", "import_react", "import_react", "t", "t", "last", "min", "t", "import_at", "min", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "PI", "size", "offset", "t", "start", "size", "t", "pt", "last", "size", "t", "max", "classNames", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "import_react", "import_jsx_runtime", "import_classnames", "size", "offset", "classNames", "TldrawSelectionForeground", "size", "classNames", "RotateCornerHandle", "STROKE_SIZES", "canvasTest", "settings", "size", "sizes", "shift", "width", "Math", "max", "ceil", "height", "fill", "job", "Date", "now", "isWorker", "WorkerGlobalScope", "self", "cropCvs", "testCvs", "OffscreenCanvas", "document", "createElement", "cropCtx", "getContext", "testCtx", "fillRect", "apply", "drawImage", "isTestPass", "getImageData", "data", "benchmark", "forEach", "cvs", "postMessage", "length", "onSuccess", "onError", "testSizes", "area", "defaults", "min", "step", "usePromise", "useWorker", "Function", "prototype", "workerJobs", "createSizesArray", "isArea", "isWidth", "isHeight", "testSize", "push", "testMin", "testStep", "handleMethod", "hasCanvasSupport", "window", "hasOffscreenCanvasSupport", "jobID", "settingsWithoutCallbacks", "_objectWithoutProperties", "_excluded", "worker", "js", "concat", "toString", "blob", "Blob", "type", "blobURL", "URL", "createObjectURL", "Worker", "revokeObjectURL", "onmessage", "e", "_e$data", "Promise", "resolve", "reject", "promiseSettings", "_objectSpread", "isLastTest", "_settings$sizes$slice", "slice", "_settings$sizes$slice2", "_slicedToArray", "_settings$sizes$slice3", "lastWidth", "lastHeight", "canvasSize", "maxArea", "options", "arguments", "undefined", "_toConsumableArray", "maxHeight", "maxWidth", "test", "maxWidth", "maxHeight", "maxArea", "offset", "containBoxSize", "blob", "string", "document", "wrap", "selection", "msg", "size", "isAnimated", "offset", "Idle", "Pointing", "Idle", "Pointing", "size", "STROKE_SIZES", "pressure", "newPoint", "z", "Idle", "Idle", "shape", "frame", "Idle", "Pointing", "Idle", "Pointing", "Idle", "Idle", "Pointing", "Idle", "Pointing", "Idle", "Pointing", "offset", "min", "Idle", "Pointing", "Idle", "Pointing", "Idle", "Pointing", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_react", "React", "ShapeFill", "PatternFill", "import_jsx_runtime", "import_jsx_runtime", "import_jsx_runtime", "import_react", "t", "size", "getPerfectDashProps", "size", "STROKE_SIZES", "furthest", "t", "import_jsx_runtime", "React", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_react", "TextArea", "import_react", "text", "noop", "React", "TextLabel", "wrap", "ArrowTextLabel", "size", "ARROW_HANDLES", "point", "precise", "STROKE_SIZES", "ArrowSvg", "React", "getPerfectDashProps", "strokeDashoffset", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "classNames", "import_jsx_runtime", "partition", "t", "STROKE_SIZES", "import_jsx_runtime", "import_react", "resizeBox", "maxWidth", "maxHeight", "offset", "resizeBox", "import_jsx_runtime", "import_classnames", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_react", "name", "FrameHeading", "frame", "classNames", "import_jsx_runtime", "precise", "rng", "t", "offset", "size", "rightMutPoint", "t", "t", "import_jsx_runtime", "size", "import_jsx_runtime", "React", "size", "getPerfectDashProps", "import_jsx_runtime", "React", "DashStyleEllipse", "getPerfectDashProps", "import_jsx_runtime", "React", "offset", "DashStyleOval", "getPerfectDashProps", "import_jsx_runtime", "React", "DashStylePolygon", "getPerfectDashProps", "import_jsx_runtime", "React", "size", "import_jsx_runtime", "React", "DrawStylePolygon", "import_jsx_runtime", "React", "SolidStyleCloud", "size", "import_jsx_runtime", "React", "SolidStyleEllipse", "import_jsx_runtime", "React", "SolidStyleOval", "offset", "import_jsx_runtime", "React", "SolidStylePolygon", "size", "STROKE_SIZES", "DashStylePolygon", "offset", "STROKE_SIZES", "cx", "cy", "size", "import_jsx_runtime", "import_react", "getIsDot", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_react", "import_jsx_runtime", "d", "index", "STROKE_SIZES", "getPerfectDashProps", "import_jsx_runtime", "import_react", "import_jsx_runtime", "React", "import_jsx_runtime", "import_react", "t", "TranslationProvider", "msg", "string", "getLabelSize", "offset", "size", "import_jsx_runtime", "import_react", "offset", "offset", "size", "import_jsx_runtime", "import_react", "time", "Idle", "Pointing", "Idle", "Pointing", "Idle", "Pointing", "Idle", "Pointing", "Idle", "Idle", "altKey", "i", "Idle", "Idle", "index", "handle", "altKey", "altKey", "Idle", "altKey", "id", "altKey", "rotateSelectionHandle", "ORDERED_SELECTION_HANDLES", "offset", "min", "Idle", "Idle", "Pointing", "Idle", "Pointing", "import_jsx_runtime", "composeEventHandlers", "originalEventHandler", "ourEventHandler", "checkForDefaultPrevented", "handleEvent", "event", "defaultPrevented", "setRef", "ref", "value", "undefined", "current", "composeRefs", "refs", "node", "forEach", "useComposedRefs", "React", "createContext", "rootComponentName", "defaultContext", "Context", "React", "Provider", "props", "context", "value", "Object", "values", "$3bkAK$createElement", "children", "useContext", "consumerName", "undefined", "Error", "displayName", "createContextScope", "scopeName", "createContextScopeDeps", "defaultContexts", "BaseContext", "index", "length", "scope", "createScope", "scopeContexts", "map", "useScope", "contexts", "composeContextScopes", "scopes", "baseScope", "scopeHooks", "useComposedScopes", "overrideScopes", "nextScopes", "reduce", "scopeProps", "currentScope", "Slot", "React", "props", "forwardedRef", "slotProps", "childrenArray", "toArray", "children", "slottable", "find", "isSlottable", "newElement", "newChildren", "map", "child", "count", "only", "$9IrjX$createElement", "undefined", "displayName", "SlotClone", "mergeProps", "ref", "composeRefs", "Slottable", "$9IrjX$Fragment", "type", "childProps", "overrideProps", "propName", "slotPropValue", "childPropValue", "isHandler", "test", "args", "filter", "Boolean", "join", "createCollection", "name", "PROVIDER_NAME", "createCollectionContext", "createCollectionScope", "createContextScope", "CollectionProviderImpl", "useCollectionContext", "collectionRef", "current", "itemMap", "Map", "CollectionProvider", "props", "children", "ref", "React", "useRef", "$6vYhU$react", "COLLECTION_SLOT_NAME", "CollectionSlot", "forwardRef", "forwardedRef", "context", "scope", "composedRefs", "useComposedRefs", "ITEM_SLOT_NAME", "ITEM_DATA_ATTR", "CollectionItemSlot", "itemData", "useEffect", "set", "delete", "useCollection", "getItems", "useCallback", "collectionNode", "orderedNodes", "Array", "from", "querySelectorAll", "items", "values", "orderedItems", "sort", "a", "b", "indexOf", "Provider", "Slot", "ItemSlot", "NODES", "Primitive", "reduce", "primitive", "node", "Node", "React", "props", "forwardedRef", "primitiveProps", "Comp", "asChild", "Slot", "window", "Symbol", "for", "$4q5Fq$createElement", "displayName", "dispatchDiscreteCustomEvent", "target", "event", "ReactDOM", "dispatchEvent", "useCallbackRef", "callback", "callbackRef", "React", "current", "args", "useEscapeKeydown", "onEscapeKeyDownProp", "ownerDocument", "globalThis", "document", "onEscapeKeyDown", "useCallbackRef", "React", "handleKeyDown", "event", "key", "addEventListener", "removeEventListener", "DISMISSABLE_LAYER_NAME", "CONTEXT_UPDATE", "POINTER_DOWN_OUTSIDE", "FOCUS_OUTSIDE", "originalBodyPointerEvents", "DismissableLayerContext", "React", "layers", "Set", "layersWithOutsidePointerEventsDisabled", "branches", "DismissableLayer", "props", "forwardedRef", "layerProps", "context", "node", "setNode", "ownerDocument", "globalThis", "document", "force", "composedRefs", "useComposedRefs", "Array", "from", "highestLayerWithOutsidePointerEventsDisabled", "slice", "highestLayerWithOutsidePointerEventsDisabledIndex", "indexOf", "index", "isBodyPointerEventsDisabled", "size", "isPointerEventsEnabled", "pointerDownOutside", "usePointerDownOutside", "event", "target", "isPointerDownOnBranch", "some", "branch", "contains", "onPointerDownOutside", "onInteractOutside", "defaultPrevented", "onDismiss", "focusOutside", "useFocusOutside", "isFocusInBranch", "onFocusOutside", "useEscapeKeydown", "isHighestLayer", "onEscapeKeyDown", "preventDefault", "disableOutsidePointerEvents", "body", "style", "pointerEvents", "add", "dispatchUpdate", "delete", "handleUpdate", "addEventListener", "removeEventListener", "$kqwpH$createElement", "undefined", "composeEventHandlers", "onFocusCapture", "onBlurCapture", "onPointerDownCapture", "BRANCH_NAME", "DismissableLayerBranch", "ref", "current", "handlePointerDownOutside", "useCallbackRef", "isPointerInsideReactTreeRef", "handleClickRef", "handlePointerDown", "handleAndDispatchPointerDownOutsideEvent", "handleAndDispatchCustomEvent", "eventDetail", "discrete", "originalEvent", "pointerType", "once", "timerId", "window", "setTimeout", "clearTimeout", "handleFocusOutside", "isFocusInsideReactTreeRef", "handleFocus", "CustomEvent", "dispatchEvent", "name", "handler", "detail", "bubbles", "cancelable", "dispatchDiscreteCustomEvent", "Root", "Branch", "PORTAL_NAME", "Portal", "React", "props", "forwardedRef", "globalThis", "document", "body", "portalProps", "container", "ReactDOM", "createPortal", "$7SXl2$createElement", "useLayoutEffect", "Boolean", "globalThis", "document", "React", "useStateMachine", "initialState", "machine", "React", "state", "event", "nextState", "Presence", "props", "children", "presence", "usePresence", "present", "child", "isPresent", "only", "ref", "useComposedRefs", "forceMount", "displayName", "node", "setNode", "stylesRef", "prevPresentRef", "prevAnimationNameRef", "send", "mounted", "UNMOUNT", "ANIMATION_OUT", "unmountSuspended", "MOUNT", "ANIMATION_END", "unmounted", "currentAnimationName", "getAnimationName", "current", "useLayoutEffect", "styles", "wasPresent", "hasPresentChanged", "prevAnimationName", "display", "isAnimating", "handleAnimationEnd", "isCurrentAnimation", "includes", "animationName", "target", "ReactDOM", "handleAnimationStart", "addEventListener", "removeEventListener", "getComputedStyle", "useControllableState", "onChange", "uncontrolledProp", "setUncontrolledProp", "useUncontrolledState", "isControlled", "prop", "undefined", "value", "handleChange", "useCallbackRef", "setValue", "React", "nextValue", "setter", "uncontrolledState", "defaultProp", "prevValueRef", "current", "NAME", "VisuallyHidden", "React", "props", "forwardedRef", "$kVwnw$createElement", "position", "border", "width", "height", "padding", "margin", "overflow", "clip", "whiteSpace", "wordWrap", "style", "PROVIDER_NAME", "Collection", "useCollection", "createCollectionScope", "createCollection", "createToastContext", "createToastScope", "createContextScope", "ToastProviderProvider", "useToastProviderContext", "ToastProvider", "props", "children", "viewport", "setViewport", "React", "toastCount", "setToastCount", "isFocusedToastEscapeKeyDownRef", "isClosePausedRef", "$eyrYI$createElement", "__scopeToast", "prevCount", "propTypes", "label", "trim", "error", "Error", "VIEWPORT_NAME", "VIEWPORT_DEFAULT_HOTKEY", "VIEWPORT_PAUSE", "VIEWPORT_RESUME", "ToastViewport", "forwardedRef", "viewportProps", "context", "getItems", "wrapperRef", "headFocusProxyRef", "tailFocusProxyRef", "ref", "composedRefs", "useComposedRefs", "onViewportChange", "hotkeyLabel", "hotkey", "join", "replace", "hasToasts", "handleKeyDown", "event", "isHotkeyPressed", "every", "key", "code", "current", "focus", "document", "addEventListener", "removeEventListener", "wrapper", "handlePause", "pauseEvent", "CustomEvent", "dispatchEvent", "handleResume", "resumeEvent", "handleFocusOutResume", "isFocusMovingOutside", "contains", "relatedTarget", "handlePointerLeaveResume", "isFocusInside", "activeElement", "window", "getSortedTabbableCandidates", "tabbingDirection", "toastItems", "tabbableCandidates", "map", "toastItem", "toastNode", "toastTabbableCandidates", "getTabbableCandidates", "reverse", "flat", "isMetaKey", "altKey", "ctrlKey", "metaKey", "isTabKey", "focusedElement", "isTabbingBackwards", "shiftKey", "targetIsViewport", "target", "sortedCandidates", "index", "findIndex", "candidate", "focusFirst", "slice", "preventDefault", "pointerEvents", "undefined", "FOCUS_PROXY_NAME", "FocusProxy", "proxyProps", "position", "prevFocusedElement", "isFocusFromOutsideViewport", "onFocusFromOutsideViewport", "TOAST_NAME", "TOAST_SWIPE_START", "TOAST_SWIPE_MOVE", "TOAST_SWIPE_CANCEL", "TOAST_SWIPE_END", "Toast", "open", "openProp", "toastProps", "setOpen", "useControllableState", "prop", "defaultProp", "defaultOpen", "onChange", "onOpenChange", "forceMount", "useCallbackRef", "onPause", "onResume", "composeEventHandlers", "onSwipeStart", "currentTarget", "setAttribute", "onSwipeMove", "y", "detail", "delta", "style", "setProperty", "x", "onSwipeCancel", "removeProperty", "onSwipeEnd", "ToastInteractiveProvider", "useToastInteractiveContext", "onClose", "ToastImpl", "duration", "durationProp", "node", "setNode", "pointerStartRef", "swipeDeltaRef", "closeTimerStartTimeRef", "closeTimerRemainingTimeRef", "closeTimerRef", "onToastRemove", "handleClose", "isFocusInToast", "startTimer", "Infinity", "clearTimeout", "Date", "getTime", "setTimeout", "elapsedTime", "onToastAdd", "announceTextContent", "getAnnounceTextContent", "$eyrYI$Fragment", "type", "ReactDOM", "onEscapeKeyDown", "swipeDirection", "userSelect", "touchAction", "onKeyDown", "nativeEvent", "defaultPrevented", "onPointerDown", "button", "clientX", "clientY", "onPointerMove", "hasSwipeMoveStarted", "Boolean", "isHorizontalSwipe", "includes", "clamp", "Math", "min", "max", "clampedX", "clampedY", "moveStartBuffer", "pointerType", "eventDetail", "originalEvent", "handleAndDispatchCustomEvent", "discrete", "isDeltaInDirection", "setPointerCapture", "pointerId", "abs", "onPointerUp", "hasPointerCapture", "releasePointerCapture", "toast", "swipeThreshold", "once", "ToastAnnounce", "announceProps", "renderAnnounceText", "setRenderAnnounceText", "isAnnounced", "setIsAnnounced", "useNextFrame", "timer", "TITLE_NAME", "ToastTitle", "titleProps", "DESCRIPTION_NAME", "ToastDescription", "descriptionProps", "ACTION_NAME", "ToastAction", "actionProps", "altText", "CLOSE_NAME", "ToastClose", "closeProps", "interactiveContext", "onClick", "ToastAnnounceExclude", "announceExcludeProps", "container", "textContent", "childNodes", "Array", "from", "forEach", "nodeType", "TEXT_NODE", "push", "isHTMLElement", "isHidden", "ariaHidden", "hidden", "display", "isExcluded", "dataset", "radixToastAnnounceExclude", "radixToastAnnounceAlt", "name", "handler", "bubbles", "cancelable", "dispatchDiscreteCustomEvent", "direction", "threshold", "deltaX", "deltaY", "isDeltaX", "callback", "fn", "useLayoutEffect", "raf1", "raf2", "requestAnimationFrame", "cancelAnimationFrame", "ELEMENT_NODE", "nodes", "walker", "createTreeWalker", "NodeFilter", "SHOW_ELEMENT", "acceptNode", "isHiddenInput", "tagName", "disabled", "FILTER_SKIP", "tabIndex", "FILTER_ACCEPT", "nextNode", "currentNode", "candidates", "previouslyFocusedElement", "some", "Root", "Toast", "Title", "ToastTitle", "Description", "ToastDescription", "Action", "ToastAction", "Close", "ToastClose", "import_classnames", "import_react", "import_jsx_runtime", "useReactId", "React", "toString", "undefined", "count", "useId", "deterministicId", "id", "setId", "useState", "useLayoutEffect", "reactId", "String", "AUTOFOCUS_ON_MOUNT", "AUTOFOCUS_ON_UNMOUNT", "EVENT_OPTIONS", "bubbles", "cancelable", "FOCUS_SCOPE_NAME", "FocusScope", "React", "props", "forwardedRef", "onMountAutoFocus", "onMountAutoFocusProp", "onUnmountAutoFocus", "onUnmountAutoFocusProp", "scopeProps", "container", "setContainer", "useCallbackRef", "lastFocusedElementRef", "composedRefs", "useComposedRefs", "node", "focusScope", "paused", "pause", "resume", "current", "trapped", "handleFocusIn", "event", "target", "contains", "focus", "select", "handleFocusOut", "relatedTarget", "handleMutations", "mutations", "focusedElement", "document", "activeElement", "body", "mutation", "removedNodes", "length", "addEventListener", "mutationObserver", "MutationObserver", "observe", "childList", "subtree", "removeEventListener", "disconnect", "focusScopesStack", "add", "previouslyFocusedElement", "hasFocusedCandidate", "mountEvent", "CustomEvent", "dispatchEvent", "defaultPrevented", "focusFirst", "removeLinks", "getTabbableCandidates", "setTimeout", "unmountEvent", "remove", "handleKeyDown", "loop", "isTabKey", "key", "altKey", "ctrlKey", "metaKey", "currentTarget", "first", "last", "getTabbableEdges", "hasTabbableElementsInside", "preventDefault", "shiftKey", "$45QHv$createElement", "candidates", "candidate", "findVisible", "reverse", "nodes", "walker", "createTreeWalker", "NodeFilter", "SHOW_ELEMENT", "acceptNode", "isHiddenInput", "tagName", "type", "disabled", "hidden", "FILTER_SKIP", "tabIndex", "FILTER_ACCEPT", "nextNode", "push", "currentNode", "elements", "element", "isHidden", "upTo", "getComputedStyle", "visibility", "undefined", "display", "parentElement", "isSelectableInput", "HTMLInputElement", "preventScroll", "createFocusScopesStack", "stack", "activeFocusScope", "arrayRemove", "unshift", "array", "item", "updatedArray", "index", "indexOf", "splice", "items", "filter", "count", "useFocusGuards", "React", "edgeGuards", "document", "querySelectorAll", "body", "insertAdjacentElement", "createFocusGuard", "count", "forEach", "node", "remove", "element", "createElement", "setAttribute", "tabIndex", "style", "cssText", "__assign", "t", "React", "React", "import_react", "last", "React", "React", "import_react", "defaults", "cbs", "filter", "React", "import_react", "React", "SideCar", "React", "React", "React", "parse", "Style", "inst", "DIALOG_NAME", "createDialogContext", "createDialogScope", "createContextScope", "DialogProvider", "useDialogContext", "Dialog", "props", "open", "openProp", "modal", "triggerRef", "React", "contentRef", "setOpen", "useControllableState", "prop", "defaultProp", "defaultOpen", "onChange", "onOpenChange", "$67UHm$createElement", "__scopeDialog", "useId", "prevOpen", "children", "TRIGGER_NAME", "DialogTrigger", "forwardedRef", "triggerProps", "context", "composedTriggerRef", "useComposedRefs", "contentId", "getState", "composeEventHandlers", "onClick", "onOpenToggle", "PORTAL_NAME", "PortalProvider", "usePortalContext", "forceMount", "undefined", "DialogPortal", "container", "map", "child", "OVERLAY_NAME", "DialogOverlay", "portalContext", "overlayProps", "DialogOverlayImpl", "Slot", "pointerEvents", "style", "CONTENT_NAME", "DialogContent", "contentProps", "DialogContentModal", "composedRefs", "content", "current", "hideOthers", "onCloseAutoFocus", "event", "preventDefault", "focus", "onPointerDownOutside", "originalEvent", "detail", "ctrlLeftClick", "button", "ctrlKey", "isRightClick", "onFocusOutside", "DialogContentNonModal", "hasInteractedOutsideRef", "hasPointerDownOutsideRef", "defaultPrevented", "onInteractOutside", "type", "target", "targetIsTrigger", "contains", "DialogContentImpl", "useFocusGuards", "$67UHm$Fragment", "trapFocus", "onOpenAutoFocus", "descriptionId", "titleId", "process", "TITLE_NAME", "DialogTitle", "titleProps", "DESCRIPTION_NAME", "DialogDescription", "descriptionProps", "CLOSE_NAME", "DialogClose", "closeProps", "TITLE_WARNING_NAME", "WarningProvider", "useWarningContext", "createContext", "contentName", "titleName", "docsSlug", "Root", "Dialog", "Portal", "DialogPortal", "Overlay", "DialogOverlay", "Content", "DialogContent", "import_react", "import_jsx_runtime", "import_react", "import_jsx_runtime", "React", "eventHandler", "React", "import_jsx_runtime", "import_jsx_runtime", "React", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_classnames", "React", "TldrawUiButton", "classnames", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "import_react", "classNames", "msg", "import_jsx_runtime", "PORTRAIT_BREAKPOINT", "import_jsx_runtime", "import_react", "import_jsx_runtime", "React", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_classnames", "classNames", "import_jsx_runtime", "import_classnames", "React", "TldrawUiInput", "msg", "value", "classNames", "EmbedDialog", "msg", "import_react", "tools", "t", "import_react", "import_jsx_runtime", "import_react", "React", "msg", "array", "import_jsx_runtime", "React", "frame", "id", "import_jsx_runtime", "import_react", "EditLinkDialog", "EditLinkDialogInner", "msg", "import_react", "index", "id", "size", "t", "url", "INPUTS", "t", "import_react", "resolve", "canvas", "blob", "msg", "import_react", "msg", "import_react", "msg", "copyAs", "exportAs", "offset", "actions", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_react", "import_jsx_runtime", "React", "import_react", "arrow", "platform", "data", "NAME", "Arrow", "React", "props", "forwardedRef", "arrowProps", "$jbnEx$createElement", "asChild", "children", "Root", "useSize", "element", "size", "setSize", "React", "undefined", "useLayoutEffect", "width", "offsetWidth", "height", "offsetHeight", "resizeObserver", "ResizeObserver", "entries", "Array", "isArray", "length", "entry", "borderSizeEntry", "borderSize", "observe", "box", "unobserve", "POPPER_NAME", "createPopperContext", "createPopperScope", "createContextScope", "PopperProvider", "usePopperContext", "Popper", "props", "children", "anchor", "setAnchor", "React", "$kY93V$createElement", "__scopePopper", "ANCHOR_NAME", "PopperAnchor", "forwardedRef", "anchorProps", "context", "ref", "composedRefs", "useComposedRefs", "onAnchorChange", "virtualRef", "current", "CONTENT_NAME", "PopperContentProvider", "useContentContext", "PopperContent", "collisionPadding", "collisionPaddingProp", "contentProps", "content", "setContent", "node", "arrow", "setArrow", "arrowSize", "useSize", "arrowWidth", "width", "arrowHeight", "height", "desiredPlacement", "side", "align", "top", "right", "bottom", "left", "boundary", "Array", "isArray", "collisionBoundary", "hasExplicitBoundaries", "length", "detectOverflowOptions", "padding", "filter", "isNotNull", "altBoundary", "middlewareData", "useFloating", "strategy", "placement", "whileElementsMounted", "args", "cleanup", "autoUpdate", "animationFrame", "updatePositionStrategy", "elements", "reference", "middleware", "offset", "mainAxis", "sideOffset", "alignmentAxis", "alignOffset", "avoidCollisions", "shift", "crossAxis", "limiter", "sticky", "limitShift", "undefined", "flip", "size", "apply", "availableHeight", "anchorWidth", "anchorHeight", "rects", "contentStyle", "floating", "style", "setProperty", "availableWidth", "floatingUIarrow", "element", "arrowPadding", "transformOrigin", "hideWhenDetached", "hide", "placedSide", "placedAlign", "getSideAndAlignFromPlacement", "handlePlaced", "useCallbackRef", "onPlaced", "useLayoutEffect", "isPositioned", "arrowX", "x", "arrowY", "y", "cannotCenterArrow", "centerOffset", "contentZIndex", "setContentZIndex", "window", "getComputedStyle", "zIndex", "refs", "setFloating", "floatingStyles", "transform", "minWidth", "join", "dir", "animation", "opacity", "referenceHidden", "ARROW_NAME", "OPPOSITE_SIDE", "PopperArrow", "arrowProps", "contentContext", "baseSide", "onArrowChange", "position", "visibility", "shouldHideArrow", "display", "value", "options", "name", "fn", "data", "isArrowHidden", "noArrowAlign", "start", "center", "end", "arrowXCenter", "arrowYCenter", "split", "Root", "Anchor", "Content", "Arrow", "POPOVER_NAME", "createPopoverContext", "createPopoverScope", "createContextScope", "createPopperScope", "usePopperScope", "PopoverProvider", "usePopoverContext", "Popover", "props", "open", "openProp", "modal", "popperScope", "__scopePopover", "triggerRef", "React", "hasCustomAnchor", "setHasCustomAnchor", "setOpen", "useControllableState", "prop", "defaultProp", "defaultOpen", "onChange", "onOpenChange", "$am6gm$createElement", "useId", "prevOpen", "children", "ANCHOR_NAME", "PopoverAnchor", "forwardedRef", "anchorProps", "context", "onCustomAnchorRemove", "onCustomAnchorAdd", "TRIGGER_NAME", "PopoverTrigger", "triggerProps", "composedTriggerRef", "useComposedRefs", "trigger", "contentId", "getState", "composeEventHandlers", "onClick", "onOpenToggle", "PORTAL_NAME", "PortalProvider", "usePortalContext", "forceMount", "undefined", "PopoverPortal", "container", "CONTENT_NAME", "PopoverContent", "portalContext", "contentProps", "PopoverContentModal", "contentRef", "composedRefs", "isRightClickOutsideRef", "content", "current", "hideOthers", "Slot", "onCloseAutoFocus", "event", "preventDefault", "focus", "onPointerDownOutside", "originalEvent", "detail", "ctrlLeftClick", "button", "ctrlKey", "isRightClick", "checkForDefaultPrevented", "onFocusOutside", "PopoverContentNonModal", "hasInteractedOutsideRef", "hasPointerDownOutsideRef", "defaultPrevented", "onInteractOutside", "type", "target", "targetIsTrigger", "contains", "PopoverContentImpl", "useFocusGuards", "trapFocus", "onOpenAutoFocus", "style", "CLOSE_NAME", "PopoverClose", "closeProps", "ARROW_NAME", "PopoverArrow", "arrowProps", "Root", "Trigger", "PopoverTrigger", "Portal", "PopoverPortal", "Content", "PopoverContent", "import_react", "isOpen", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_jsx_runtime", "DirectionContext", "React", "undefined", "useDirection", "localDir", "globalDir", "React", "DirectionContext", "ENTRY_FOCUS", "EVENT_OPTIONS", "bubbles", "cancelable", "GROUP_NAME", "Collection", "useCollection", "createCollectionScope", "createCollection", "createRovingFocusGroupContext", "createRovingFocusGroupScope", "createContextScope", "RovingFocusProvider", "useRovingFocusContext", "RovingFocusGroup", "React", "props", "forwardedRef", "$98Iye$createElement", "__scopeRovingFocusGroup", "RovingFocusGroupImpl", "currentTabStopId", "currentTabStopIdProp", "groupProps", "ref", "composedRefs", "useComposedRefs", "direction", "useDirection", "dir", "setCurrentTabStopId", "useControllableState", "prop", "defaultProp", "defaultCurrentTabStopId", "onChange", "onCurrentTabStopIdChange", "isTabbingBackOut", "setIsTabbingBackOut", "handleEntryFocus", "useCallbackRef", "onEntryFocus", "getItems", "isClickFocusRef", "focusableItemsCount", "setFocusableItemsCount", "node", "current", "addEventListener", "removeEventListener", "tabStopId", "prevCount", "orientation", "outline", "style", "composeEventHandlers", "onMouseDown", "onFocus", "event", "isKeyboardFocus", "target", "currentTarget", "entryFocusEvent", "CustomEvent", "dispatchEvent", "defaultPrevented", "items", "filter", "item", "focusable", "activeItem", "find", "active", "currentItem", "id", "candidateItems", "Boolean", "candidateNodes", "map", "focusFirst", "onBlur", "ITEM_NAME", "RovingFocusGroupItem", "itemProps", "autoId", "useId", "context", "isCurrentTabStop", "onFocusableItemRemove", "onFocusableItemAdd", "preventDefault", "onItemFocus", "onKeyDown", "key", "shiftKey", "onItemShiftTab", "focusIntent", "getFocusIntent", "undefined", "reverse", "currentIndex", "indexOf", "loop", "wrapArray", "slice", "setTimeout", "MAP_KEY_TO_FOCUS_INTENT", "ArrowLeft", "ArrowUp", "ArrowRight", "ArrowDown", "PageUp", "Home", "PageDown", "End", "getDirectionAwareKey", "includes", "candidates", "PREVIOUSLY_FOCUSED_ELEMENT", "document", "activeElement", "candidate", "focus", "array", "startIndex", "_", "index", "length", "Root", "Item", "SELECTION_KEYS", "FIRST_KEYS", "LAST_KEYS", "FIRST_LAST_KEYS", "SUB_OPEN_KEYS", "ltr", "rtl", "SUB_CLOSE_KEYS", "MENU_NAME", "Collection", "useCollection", "createCollectionScope", "createCollection", "createMenuContext", "createMenuScope", "createContextScope", "createPopperScope", "createRovingFocusGroupScope", "usePopperScope", "useRovingFocusGroupScope", "MenuProvider", "useMenuContext", "MenuRootProvider", "useMenuRootContext", "Menu", "props", "modal", "popperScope", "__scopeMenu", "content", "setContent", "React", "isUsingKeyboardRef", "handleOpenChange", "useCallbackRef", "onOpenChange", "direction", "useDirection", "dir", "handleKeyDown", "current", "document", "addEventListener", "handlePointer", "capture", "once", "removeEventListener", "$epM9y$createElement", "children", "ANCHOR_NAME", "MenuAnchor", "forwardedRef", "anchorProps", "PORTAL_NAME", "PortalProvider", "usePortalContext", "forceMount", "undefined", "MenuPortal", "container", "context", "open", "CONTENT_NAME", "MenuContentProvider", "useMenuContentContext", "MenuContent", "portalContext", "contentProps", "rootContext", "MenuRootContentModal", "ref", "composedRefs", "useComposedRefs", "hideOthers", "composeEventHandlers", "onFocusOutside", "event", "preventDefault", "checkForDefaultPrevented", "MenuRootContentNonModal", "MenuContentImpl", "rovingFocusGroupScope", "getItems", "currentItemId", "setCurrentItemId", "contentRef", "onContentChange", "timerRef", "searchRef", "pointerGraceTimerRef", "pointerGraceIntentRef", "pointerDirRef", "lastPointerXRef", "ScrollLockWrapper", "disableOutsideScroll", "RemoveScroll", "scrollLockWrapperProps", "as", "Slot", "allowPinchZoom", "handleTypeaheadSearch", "key", "search", "items", "filter", "item", "disabled", "currentItem", "activeElement", "currentMatch", "find", "textValue", "values", "map", "nextMatch", "getNextMatch", "newItem", "updateSearch", "value", "window", "clearTimeout", "setTimeout", "focus", "useFocusGuards", "isPointerMovingToSubmenu", "isMovingTowards", "side", "isPointerInGraceArea", "area", "intent", "trapFocus", "onOpenAutoFocus", "onCloseAutoFocus", "onEntryFocus", "getOpenState", "outline", "style", "onKeyDown", "target", "isKeyDownInside", "closest", "currentTarget", "isModifierKey", "ctrlKey", "altKey", "metaKey", "isCharacterKey", "length", "includes", "candidateNodes", "reverse", "focusFirst", "onBlur", "contains", "onPointerMove", "whenMouse", "pointerXHasChanged", "clientX", "newDir", "GROUP_NAME", "MenuGroup", "groupProps", "LABEL_NAME", "MenuLabel", "labelProps", "ITEM_NAME", "ITEM_SELECT", "MenuItem", "itemProps", "contentContext", "isPointerDownRef", "handleSelect", "menuItem", "itemSelectEvent", "CustomEvent", "bubbles", "cancelable", "onSelect", "dispatchDiscreteCustomEvent", "defaultPrevented", "onClose", "onClick", "onPointerDown", "onPointerUp", "click", "isTypingAhead", "MenuItemImpl", "isFocused", "setIsFocused", "textContent", "setTextContent", "trim", "onItemLeave", "onItemEnter", "onPointerLeave", "onFocus", "CHECKBOX_ITEM_NAME", "MenuCheckboxItem", "checkboxItemProps", "isIndeterminate", "checked", "getCheckedState", "onCheckedChange", "RADIO_GROUP_NAME", "RadioGroupProvider", "useRadioGroupContext", "onValueChange", "MenuRadioGroup", "handleValueChange", "RADIO_ITEM_NAME", "MenuRadioItem", "radioItemProps", "ITEM_INDICATOR_NAME", "ItemIndicatorProvider", "useItemIndicatorContext", "MenuItemIndicator", "itemIndicatorProps", "indicatorContext", "SEPARATOR_NAME", "MenuSeparator", "separatorProps", "ARROW_NAME", "MenuArrow", "arrowProps", "SUB_NAME", "MenuSubProvider", "useMenuSubContext", "MenuSub", "parentMenuContext", "trigger", "setTrigger", "useId", "SUB_TRIGGER_NAME", "MenuSubTrigger", "subContext", "openTimerRef", "onPointerGraceIntentChange", "scope", "clearOpenTimer", "pointerGraceTimer", "triggerId", "contentId", "composeRefs", "onTriggerChange", "contentRect", "getBoundingClientRect", "dataset", "rightSide", "bleed", "contentNearEdge", "contentFarEdge", "x", "y", "clientY", "top", "bottom", "onTriggerLeave", "SUB_CONTENT_NAME", "MenuSubContent", "subContentProps", "onEscapeKeyDown", "isCloseKey", "candidates", "PREVIOUSLY_FOCUSED_ELEMENT", "candidate", "wrapArray", "array", "startIndex", "_", "index", "isRepeated", "Array", "from", "every", "char", "normalizedSearch", "currentMatchIndex", "indexOf", "wrappedValues", "Math", "max", "excludeCurrentMatch", "v", "toLowerCase", "startsWith", "isPointInPolygon", "point", "polygon", "inside", "i", "j", "xi", "yi", "xj", "yj", "intersect", "cursorPos", "handler", "pointerType", "Root", "Anchor", "Portal", "Content", "Group", "Label", "Item", "CheckboxItem", "RadioGroup", "RadioItem", "ItemIndicator", "Separator", "Arrow", "Sub", "SubTrigger", "SubContent", "CONTEXT_MENU_NAME", "createContextMenuContext", "createContextMenuScope", "createContextScope", "createMenuScope", "useMenuScope", "ContextMenuProvider", "useContextMenuContext", "ContextMenu", "props", "modal", "open", "setOpen", "React", "menuScope", "__scopeContextMenu", "handleOpenChangeProp", "useCallbackRef", "onOpenChange", "handleOpenChange", "$3TiJz$createElement", "children", "TRIGGER_NAME", "ContextMenuTrigger", "forwardedRef", "triggerProps", "context", "pointRef", "x", "y", "virtualRef", "getBoundingClientRect", "DOMRect", "fromRect", "width", "height", "current", "longPressTimerRef", "clearLongPress", "window", "clearTimeout", "handleOpen", "event", "clientX", "clientY", "disabled", "$3TiJz$Fragment", "undefined", "WebkitTouchCallout", "style", "onContextMenu", "composeEventHandlers", "preventDefault", "onPointerDown", "whenTouchOrPen", "setTimeout", "onPointerMove", "onPointerCancel", "onPointerUp", "PORTAL_NAME", "ContextMenuPortal", "portalProps", "CONTENT_NAME", "ContextMenuContent", "contentProps", "hasInteractedOutsideRef", "onCloseAutoFocus", "defaultPrevented", "onInteractOutside", "GROUP_NAME", "ContextMenuGroup", "groupProps", "LABEL_NAME", "ContextMenuLabel", "labelProps", "ITEM_NAME", "ContextMenuItem", "itemProps", "CHECKBOX_ITEM_NAME", "ContextMenuCheckboxItem", "checkboxItemProps", "RADIO_GROUP_NAME", "ContextMenuRadioGroup", "radioGroupProps", "RADIO_ITEM_NAME", "ContextMenuRadioItem", "radioItemProps", "INDICATOR_NAME", "ContextMenuItemIndicator", "itemIndicatorProps", "SEPARATOR_NAME", "ContextMenuSeparator", "separatorProps", "ARROW_NAME", "ContextMenuArrow", "arrowProps", "SUB_NAME", "ContextMenuSub", "openProp", "defaultOpen", "useControllableState", "prop", "defaultProp", "onChange", "SUB_TRIGGER_NAME", "ContextMenuSubTrigger", "triggerItemProps", "SUB_CONTENT_NAME", "ContextMenuSubContent", "subContentProps", "handler", "pointerType", "Root", "Trigger", "Portal", "Content", "CheckboxItem", "ContextMenuCheckboxItem", "import_react", "import_jsx_runtime", "import_jsx_runtime", "DROPDOWN_MENU_NAME", "createDropdownMenuContext", "createDropdownMenuScope", "createContextScope", "createMenuScope", "useMenuScope", "DropdownMenuProvider", "useDropdownMenuContext", "DropdownMenu", "props", "open", "openProp", "modal", "menuScope", "__scopeDropdownMenu", "triggerRef", "React", "setOpen", "useControllableState", "prop", "defaultProp", "defaultOpen", "onChange", "onOpenChange", "$9kmUS$createElement", "useId", "prevOpen", "children", "TRIGGER_NAME", "DropdownMenuTrigger", "forwardedRef", "triggerProps", "context", "triggerId", "contentId", "undefined", "disabled", "composeRefs", "composeEventHandlers", "onPointerDown", "event", "button", "ctrlKey", "onOpenToggle", "preventDefault", "onKeyDown", "includes", "key", "PORTAL_NAME", "DropdownMenuPortal", "portalProps", "CONTENT_NAME", "DropdownMenuContent", "contentProps", "hasInteractedOutsideRef", "onCloseAutoFocus", "current", "focus", "onInteractOutside", "originalEvent", "detail", "ctrlLeftClick", "isRightClick", "style", "GROUP_NAME", "DropdownMenuGroup", "groupProps", "LABEL_NAME", "DropdownMenuLabel", "labelProps", "ITEM_NAME", "DropdownMenuItem", "itemProps", "CHECKBOX_ITEM_NAME", "DropdownMenuCheckboxItem", "checkboxItemProps", "RADIO_GROUP_NAME", "DropdownMenuRadioGroup", "radioGroupProps", "RADIO_ITEM_NAME", "DropdownMenuRadioItem", "radioItemProps", "INDICATOR_NAME", "DropdownMenuItemIndicator", "itemIndicatorProps", "SEPARATOR_NAME", "DropdownMenuSeparator", "separatorProps", "ARROW_NAME", "DropdownMenuArrow", "arrowProps", "DropdownMenuSub", "SUB_TRIGGER_NAME", "DropdownMenuSubTrigger", "subTriggerProps", "SUB_CONTENT_NAME", "DropdownMenuSubContent", "subContentProps", "Root", "Trigger", "Portal", "Content", "Group", "Item", "DropdownMenuItem", "CheckboxItem", "DropdownMenuCheckboxItem", "ItemIndicator", "DropdownMenuItemIndicator", "Sub", "DropdownMenuSub", "SubTrigger", "DropdownMenuSubTrigger", "SubContent", "DropdownMenuSubContent", "size", "import_jsx_runtime", "kbd", "msg", "DefaultActionsMenu", "msg", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_jsx_runtime", "import_jsx_runtime", "kbd", "msg", "import_jsx_runtime", "msg", "import_jsx_runtime", "size", "msg", "EditLinkMenuItem", "GroupMenuItem", "UngroupMenuItem", "ZoomTo100MenuItem", "GroupMenuItem", "UngroupMenuItem", "EditLinkMenuItem", "DefaultContextMenu", "isOpen", "import_jsx_runtime", "import_jsx_runtime", "import_react", "import_jsx_runtime", "React", "DebugFlagToggle", "import_jsx_runtime", "import_react", "DefaultDebugPanel", "useTick", "tick", "CurrentState", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_jsx_runtime", "DefaultHelpMenu", "msg", "import_jsx_runtime", "import_jsx_runtime", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "import_react", "import_jsx_runtime", "DefaultKeyboardShortcutsDialog", "msg", "classNames", "import_jsx_runtime", "import_react", "import_jsx_runtime", "GroupMenuItem", "UngroupMenuItem", "EditLinkMenuItem", "ZoomTo100MenuItem", "DefaultMainMenu", "msg", "import_jsx_runtime", "import_react", "import_jsx_runtime", "React", "memo", "array", "offset", "size", "offset", "canvasSize", "colors", "len", "offset", "__decorateClass", "e", "offset", "import_jsx_runtime", "import_react", "import_react", "React", "DefaultNavigationPanel", "msg", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_react", "PageItemInput", "import_jsx_runtime", "import_react", "index", "PageItemSubmenu", "index", "msg", "DefaultPageMenu", "msg", "index", "offset", "import_jsx_runtime", "import_react", "import_jsx_runtime", "DefaultQuickActions", "import_jsx_runtime", "import_classnames", "import_react", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_classnames", "import_react", "msg", "handleButtonClick", "handleButtonPointerDown", "handleButtonPointerEnter", "handleButtonPointerUp", "classNames", "import_jsx_runtime", "clamp", "value", "min", "max", "Math", "usePrevious", "value", "ref", "React", "previous", "current", "PAGE_KEYS", "ARROW_KEYS", "BACK_KEYS", "SLIDER_NAME", "Collection", "useCollection", "createCollectionScope", "createCollection", "createSliderContext", "createSliderScope", "createContextScope", "SliderProvider", "useSliderContext", "Slider", "React", "props", "forwardedRef", "min", "value", "sliderProps", "slider", "setSlider", "composedRefs", "useComposedRefs", "node", "thumbRefs", "Set", "valueIndexToChangeRef", "isHorizontal", "orientation", "isFormControl", "Boolean", "closest", "SliderOrientation", "SliderHorizontal", "SliderVertical", "values", "setValues", "useControllableState", "prop", "defaultProp", "defaultValue", "onChange", "thumbs", "current", "focus", "onValueChange", "valuesBeforeSlideStartRef", "handleSlideStart", "closestIndex", "getClosestValueIndex", "updateValues", "handleSlideMove", "handleSlideEnd", "prevValue", "nextValue", "hasChanged", "onValueCommit", "atIndex", "commit", "decimalCount", "getDecimalCount", "step", "snapToStep", "roundValue", "Math", "round", "clamp", "max", "prevValues", "nextValues", "getNextSortedValues", "hasMinStepsBetweenValues", "minStepsBetweenThumbs", "indexOf", "String", "$g1Vy2$createElement", "__scopeSlider", "disabled", "undefined", "composeEventHandlers", "onPointerDown", "length", "direction", "stepDirection", "isPageKey", "includes", "event", "key", "isSkipKey", "shiftKey", "multiplier", "stepInDirection", "map", "index", "name", "SliderOrientationProvider", "useSliderOrientationContext", "startEdge", "endEdge", "size", "rectRef", "useDirection", "dir", "isDirectionLTR", "isSlidingFromLeft", "inverted", "getValueFromPointer", "pointerPosition", "rect", "getBoundingClientRect", "input", "width", "output", "linearScale", "left", "style", "clientX", "onSlideStart", "onSlideMove", "onSlideEnd", "slideDirection", "isBackKey", "onStepKeyDown", "sliderRef", "ref", "isSlidingFromBottom", "height", "top", "clientY", "SliderImpl", "context", "onKeyDown", "onHomeKeyDown", "preventDefault", "onEndKeyDown", "concat", "target", "setPointerCapture", "pointerId", "has", "onPointerMove", "hasPointerCapture", "onPointerUp", "releasePointerCapture", "TRACK_NAME", "SliderTrack", "trackProps", "RANGE_NAME", "SliderRange", "rangeProps", "valuesCount", "percentages", "convertValueToPercentage", "offsetStart", "offsetEnd", "THUMB_NAME", "SliderThumb", "getItems", "thumb", "setThumb", "findIndex", "item", "SliderThumbImpl", "thumbProps", "useSize", "percent", "label", "getLabel", "orientationSize", "thumbInBoundsOffset", "getThumbInBoundsOffset", "add", "delete", "transform", "position", "display", "onFocus", "BubbleInput", "inputProps", "usePrevious", "inputProto", "window", "HTMLInputElement", "prototype", "descriptor", "Object", "getOwnPropertyDescriptor", "setValue", "set", "Event", "bubbles", "call", "dispatchEvent", "sort", "a", "b", "maxSteps", "percentPerStep", "percentage", "totalValues", "distances", "abs", "closestDistance", "halfWidth", "halfPercent", "offset", "getStepsBetweenValues", "slice", "minStepsBetweenValues", "stepsBetweenValues", "actualMinStepsBetweenValues", "ratio", "split", "rounder", "pow", "Root", "Track", "Range", "Thumb", "import_react", "msg", "value", "import_jsx_runtime", "React", "msg", "import_jsx_runtime", "React", "msg", "React", "msg", "size", "DefaultStylePanel", "classNames", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_react", "msg", "import_jsx_runtime", "import_jsx_runtime", "import_classnames", "object", "index", "import_react", "import_react", "kbd", "getKeys", "index", "msg", "children", "index", "el", "classNames", "import_jsx_runtime", "import_classnames", "msg", "classNames", "DefaultToolbar", "import_jsx_runtime", "import_react", "import_jsx_runtime", "ZoomTo100MenuItem", "DefaultZoomMenu", "ZoomTriggerButton", "msg", "import_react", "TldrawUi", "React", "TldrawUiInner", "msg", "MenuPanel", "classNames", "import_react", "PreloadStatus", "TldrawUi", "msg", "editor", "import_jsx_runtime", "import_react", "TldrawImage", "url", "import_jsx_runtime", "import_classnames", "import_react", "msg", "classNames", "document", "migrate", "bounds", "version", "TDShapeType", "ColorStyle", "SizeStyle", "DashStyle", "AlignStyle", "FontStyle", "Decoration", "TDAssetType", "size", "e", "document", "msg"]
}
